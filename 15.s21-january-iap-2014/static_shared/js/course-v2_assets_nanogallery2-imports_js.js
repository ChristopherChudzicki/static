/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkocw_hugo_themes"] = self["webpackChunkocw_hugo_themes"] || []).push([["course-v2_assets_nanogallery2-imports_js"],{

/***/ "./node_modules/nanogallery2/src/css/nanogallery2.css":
/*!************************************************************!*\
  !*** ./node_modules/nanogallery2/src/css/nanogallery2.css ***!
  \************************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/*** IMPORTS FROM imports-loader ***/\nvar module = (module || {});\nmodule.exports = undefined;\nvar exports = undefined;\n\n// extracted by mini-css-extract-plugin\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvbmFub2dhbGxlcnkyL3NyYy9jc3MvbmFub2dhbGxlcnkyLmNzcy5qcyIsIm1hcHBpbmdzIjoiO0FBQUE7QUFDQSwwQkFBMEI7QUFDMUI7QUFDQTs7QUFFQTtBQUNVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2N3LWh1Z28tdGhlbWVzLy4vbm9kZV9tb2R1bGVzL25hbm9nYWxsZXJ5Mi9zcmMvY3NzL25hbm9nYWxsZXJ5Mi5jc3M/OTUzYiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKioqIElNUE9SVFMgRlJPTSBpbXBvcnRzLWxvYWRlciAqKiovXG52YXIgbW9kdWxlID0gKG1vZHVsZSB8fCB7fSk7XG5tb2R1bGUuZXhwb3J0cyA9IHVuZGVmaW5lZDtcbnZhciBleHBvcnRzID0gdW5kZWZpbmVkO1xuXG4vLyBleHRyYWN0ZWQgYnkgbWluaS1jc3MtZXh0cmFjdC1wbHVnaW5cbmV4cG9ydCB7fTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/nanogallery2/src/css/nanogallery2.css\n");

/***/ }),

/***/ "./node_modules/nanogallery2/src/jquery.nanogallery2.core.js":
/*!*******************************************************************!*\
  !*** ./node_modules/nanogallery2/src/jquery.nanogallery2.core.js ***!
  \*******************************************************************/
/***/ (function(module, exports, __webpack_require__) {

eval("/* provided dependency */ var jQuery = __webpack_require__(/*! jquery */ \"./node_modules/jquery/dist/jquery.js\");\nvar __WEBPACK_AMD_DEFINE_RESULT__;var __WEBPACK_AMD_DEFINE_RESULT__;var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*** IMPORTS FROM imports-loader ***/\nvar module = (module || {});\nmodule.exports = undefined;\nvar exports = undefined;\n\n/**!\r\n * @preserve nanogallery2 - javascript photo / video gallery and lightbox\r\n * Homepage: http://nanogallery2.nanostudio.org\r\n * Sources:  https://github.com/nanostudio-org/nanogallery2\r\n *\r\n * License:  GPLv3 and commercial licence\r\n * \r\n * Requirements:\r\n *  - jQuery (http://www.jquery.com) - version >= 1.7.1\r\n *\r\n * Embeded components:\r\n *  - shifty (https://github.com/jeremyckahn/shifty)\r\n *  - imagesloaded (https://github.com/desandro/imagesloaded)\r\n *  - hammer.js (http://hammerjs.github.io/)\r\n *  - screenfull.js (https://github.com/sindresorhus/screenfull.js)\r\n * Tools:\r\n *  - webfont generated with http://fontello.com - mainly based on Font Awesome Copyright (C) 2012 by Dave Gandy (http://fontawesome.io/)\r\n *  - ICO online converter: https://iconverticons.com/online/\r\n */\r\n\r\n \r\n \r\n// ###########################################\r\n// ##### nanogallery2 as a JQUERY PLUGIN #####\r\n// ###########################################\r\n\r\n\r\n// Expose plugin as an AMD module if AMD loader is present:\r\n(function (factory) {\r\n    \"use strict\";\r\n    if (true) {\r\n        // AMD. Register as an anonymous module.\r\n        // define('nanogallery2', ['jquery'], factory);\r\n        !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! jquery */ \"./node_modules/jquery/dist/jquery.js\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n    } else {}\r\n}(function ($) {\r\n// ;(function ($) {\r\n  \"use strict\";\r\n\r\n  //##### TOOLS/HELPERS ####\r\n\r\n  // Convert color to RGB/RGBA\r\n  function ColorHelperToRGB( color ) {\r\n    var obj = document.getElementById('ngyColorHelperToRGB');\r\n    if (obj === null) {\r\n      obj = document.createElement('div');\r\n      obj.id = \"ngyColorHelperToRGB\";\r\n      obj.style.cssText = 'display: none; color:' + color + ';';\r\n      document.body.appendChild(obj);\r\n    }\r\n    \r\n    var rgb = getComputedStyle(obj).color;\r\n\r\n    // to get HEX value:\r\n    // var rgb = getComputedStyle(obj).color.match(/\\d+/g);\r\n    // var r = parseInt(rgb[0]).toString(16);\r\n    // var g = parseInt(rgb[1]).toString(16);\r\n    // var b = parseInt(rgb[2]).toString(16);\r\n    // var hex = '#' + r + g + b;\r\n\r\n    return rgb;\r\n  }\r\n\r\n  \r\n  // ##### helper for color handling\r\n  // - normalise RGB/RGBA/HEX format\r\n  // - lighten/darken color\r\n  // Inspired by:          \r\n  // https://stackoverflow.com/questions/5560248/programmatically-lighten-or-darken-a-hex-color-or-rgb-and-blend-colors\r\n  // http://www.pimptrizkit.com/?t=20%20Shades\r\n  function ShadeBlendConvert (p, from, to) {\r\n    var rgba='';\r\n    if( from.toUpperCase().substring(0,5) == 'RGBA(' ) {\r\n      rgba='a';\r\n      from='rgb('+from.substring(5);\r\n    }\r\n\r\n    if(typeof(p)!=\"number\"||p<-1||p>1||typeof(from)!=\"string\"||(from[0]!='r'&&from[0]!='#')||(typeof(to)!=\"string\"&&typeof(to)!=\"undefined\"))return null;\r\n    //if(!this.sbcRip)this.sbcRip=function(d){\r\n    function sbcRip(d){\r\n      var l=d.length,RGB=new Object();\r\n      if(l>9){\r\n        d=d.split(\",\");\r\n        if(d.length<3||d.length>4)return null;\r\n        RGB[0]=i(d[0].slice(4)),RGB[1]=i(d[1]),RGB[2]=i(d[2]),RGB[3]=d[3]?parseFloat(d[3]):-1;\r\n      }else{\r\n        if(l==8||l==6||l<4)return null;\r\n        if(l<6)d=\"#\"+d[1]+d[1]+d[2]+d[2]+d[3]+d[3]+(l>4?d[4]+\"\"+d[4]:\"\");\r\n        d=i(d.slice(1),16),RGB[0]=d>>16&255,RGB[1]=d>>8&255,RGB[2]=d&255,RGB[3]=l==9||l==5?r(((d>>24&255)/255)*10000)/10000:-1;\r\n      }\r\n      return RGB;\r\n    }\r\n    var i=parseInt,r=Math.round,h=from.length>9,h=typeof(to)==\"string\"?to.length>9?true:to==\"c\"?!h:false:h,b=p<0,p=b?p*-1:p,to=to&&to!=\"c\"?to:b?\"#000000\":\"#FFFFFF\",f=sbcRip(from),t=sbcRip(to);\r\n    if(!f||!t)return null;\r\n    if(h)return \"rgb\"+rgba+\"(\"+r((t[0]-f[0])*p+f[0])+\",\"+r((t[1]-f[1])*p+f[1])+\",\"+r((t[2]-f[2])*p+f[2])+(f[3]<0&&t[3]<0?\")\":\",\"+(f[3]>-1&&t[3]>-1?r(((t[3]-f[3])*p+f[3])*10000)/10000:t[3]<0?f[3]:t[3])+\")\");\r\n    else return \"#\"+(0x100000000+(f[3]>-1&&t[3]>-1?r(((t[3]-f[3])*p+f[3])*255):t[3]>-1?r(t[3]*255):f[3]>-1?r(f[3]*255):255)*0x1000000+r((t[0]-f[0])*p+f[0])*0x10000+r((t[1]-f[1])*p+f[1])*0x100+r((t[2]-f[2])*p+f[2])).toString(16).slice(f[3]>-1||t[3]>-1?1:3);\r\n  }\r\n  \r\n  \r\n  // ##### clone a javascript object\r\n  function cloneJSObject( obj ) {\r\n    if (obj === null || typeof obj !== 'object') {\r\n      return obj;\r\n    }\r\n\r\n    var temp = obj.constructor(); // give temp the original obj's constructor\r\n    for (var key in obj) {\r\n        temp[key] = cloneJSObject(obj[key]);\r\n    }\r\n    return temp;\r\n  }\r\n  \r\n  // get viewport coordinates and size\r\n  function getViewport() {\r\n    var $win = jQuery(window);\r\n    return {\r\n      l: $win.scrollLeft(),\r\n      t: $win.scrollTop(),\r\n      w: $win.width(),\r\n      h: $win.height()\r\n    }\r\n  }\r\n\r\n\r\n  // avoid if possible (performance issue)\r\n  function inViewport( $elt, threshold ) {\r\n    var wp = getViewport(),\r\n    eltOS = $elt.offset(),\r\n    th = $elt.outerHeight(true),\r\n    tw = $elt.outerWidth(true);\r\n    if( eltOS.top >= (wp.t - threshold) \r\n      && (eltOS.top + th) <= (wp.t + wp.h + threshold)\r\n      && eltOS.left >= (wp.l - threshold) \r\n      && (eltOS.left + tw) <= (wp.l + wp.w + threshold) ) {\r\n      return true;\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // avoid if possible (performance issue)\r\n  function inViewportVert( $elt, threshold ) {\r\n    var wp = getViewport(),\r\n    eltOS = $elt.offset(),\r\n    th = $elt.outerHeight(true);\r\n    //var tw=$elt.outerWidth(true);\r\n\r\n    if( wp.t == 0 && (eltOS.top) <= (wp.t + wp.h ) ) { return true; }\r\n\r\n    if( eltOS.top >= (wp.t) \r\n      && (eltOS.top + th) <= (wp.t + wp.h - threshold) ) {\r\n        return true;\r\n    }\r\n    else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n\r\n  // set z-index to display 2 elements on top of all others\r\n  function set2ElementsOnTop( start, elt1, elt2 ) {\r\n    var highest_index = 0;\r\n    if( start=='' ) { start= '*'; }\r\n    jQuery(start).each(function() {\r\n      var cur = parseInt(jQuery(this).css('z-index'));\r\n      highest_index = cur > highest_index ? cur : highest_index;\r\n    });\r\n    highest_index++;\r\n    jQuery(elt2).css('z-index',highest_index+1);\r\n    jQuery(elt1).css('z-index',highest_index);\r\n  }\r\n\r\n  // set z-index to display element on top of all others\r\n  function setElementOnTop( start, elt ) {\r\n    var highest_index = 0;\r\n    if( start == '' ) { start = '*'; }\r\n    jQuery(start).each(function() {\r\n      var cur = parseInt(jQuery(this).css('z-index'));\r\n      highest_index = cur > highest_index ? cur : highest_index;\r\n    });\r\n    highest_index++;\r\n    jQuery(elt).css('z-index',highest_index);\r\n  }\r\n  \r\n  // return the real type of the object\r\n  var toType = function( obj ) {\r\n    // by Angus Croll - http://javascriptweblog.wordpress.com/2011/08/08/fixing-the-javascript-typeof-operator/\r\n    return ({}).toString.call(obj).match(/\\s([a-zA-Z]+)/)[1].toLowerCase()\r\n  };    \r\n    \r\n\r\n  $.nanogallery2 = function (elt, options) {\r\n    // To avoid scope issues, use '_this' instead of 'this'\r\n    // to reference this class from internal events and functions.\r\n    var _this = this;\r\n\r\n    // Access to jQuery and DOM versions of element\r\n    _this.$e  = jQuery(elt);\r\n    _this.e   = elt;\r\n\r\n    // Add a reverse reference to the DOM object\r\n    _this.$e.data('nanogallery2data', _this);\r\n\r\n    _this.init = function () {\r\n  \r\n      // define these global objects only once per HTML page\r\n      if (typeof window.NGY2Item === 'undefined') {\r\n  \r\n        window.NGY2Tools = (function () {\r\n\r\n          function NGY2Tools() {\r\n            var nextId = 1;                   // private static --> all instances\r\n          }\r\n\r\n          // check album name - albumList/blackList/whiteList\r\n          NGY2Tools.FilterAlbumName = function( title, ID ) {\r\n            var s = title.toUpperCase();\r\n            if( this.albumList.length > 0 ) {\r\n              for( var j=0; j < this.albumList.length; j++) {\r\n                if( s === this.albumList[j].toUpperCase() || ID === this.albumList[j] ) {\r\n                  return true;\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              var found = false;\r\n              if( this.whiteList !== null ) {\r\n                //whiteList : authorize only album cointaining one of the specified keyword in the title\r\n                for( var j = 0; j < this.whiteList.length; j++) {\r\n                  if( s.indexOf(this.whiteList[j]) !== -1 ) {\r\n                    found = true;\r\n                  }\r\n                }\r\n                if( !found ) { return false; }\r\n              }\r\n\r\n\r\n              if( this.blackList !== null ) {\r\n                //blackList : ignore album cointaining one of the specified keyword in the title\r\n                for( var j = 0; j < this.blackList.length; j++) {\r\n                  if( s.indexOf(this.blackList[j]) !== -1 ) { \r\n                    return false;\r\n                  }\r\n                }\r\n              }\r\n              return true;\r\n            }\r\n          };\r\n\r\n\r\n          /** @function nanoAlert */\r\n          /* Display an alert message in a specific element */\r\n          NGY2Tools.NanoAlert = function(context, msg, verbose) {\r\n            NGY2Tools.NanoConsoleLog.call(context, msg);\r\n            if( context.$E.conConsole != null ) {\r\n              context.$E.conConsole.css({visibility: 'visible', minHeight: '100px'});\r\n              if( verbose == false ) {\r\n                context.$E.conConsole.append('<p>' + msg + '</p>');\r\n              }\r\n              else {\r\n                context.$E.conConsole.append('<p>nanogallery2: '+ msg + ' [' + context.baseEltID + ']</p>');\r\n              }\r\n            }\r\n          };\r\n          \r\n  \r\n          /** @function NanoConsoleLog */\r\n          /* write message to the browser console */\r\n          NGY2Tools.NanoConsoleLog = function(context, msg) {\r\n            if (window.console) { console.log('nanogallery2: ' + msg + ' [' + context.baseEltID + ']'); }\r\n          };\r\n          \r\n\r\n          /** @function PreloaderDisplay() */\r\n          /* Display/hide preloader */\r\n          NGY2Tools.PreloaderDisplay = function(display) {\r\n            if( display === true ) {\r\n              this.$E.conLoadingB.removeClass('nanoGalleryLBarOff').addClass('nanoGalleryLBar');\r\n            }\r\n            else {\r\n              this.$E.conLoadingB.removeClass('nanoGalleryLBar').addClass('nanoGalleryLBarOff');\r\n            }\r\n          };\r\n\r\n          //+ Jonas Raoni Soares Silva\r\n          //@ http://jsfromhell.com/array/shuffle [v1.0]\r\n          NGY2Tools.AreaShuffle = function (o) {\r\n            for (var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);\r\n            return o;\r\n          };\r\n          \r\n          /** @function GetImageTitleFromURL() */\r\n          /* retrieve filemane */\r\n          NGY2Tools.GetImageTitleFromURL = function( imageURL ) {\r\n            if( this.O.thumbnailLabel.get('title') == '%filename' ) {\r\n              return (imageURL.split('/').pop()).replace('_',' ');\r\n            }\r\n            \r\n            if( this.O.thumbnailLabel.get('title') == '%filenameNoExt' ) {\r\n              var s=imageURL.split('/').pop();\r\n              return (s.split('.').shift()).replace('_',' ');\r\n            }\r\n            // return imageURL;\r\n            return '';\r\n          };\r\n          \r\n\r\n          /** @function AlbumPostProcess() */\r\n          /* post process one album based on plugin general parameters  --> sorting/maxItems*/\r\n          NGY2Tools.AlbumPostProcess = function(albumID) {\r\n\r\n            // this function can probably be optimized....\r\n          \r\n            var sortOrder = this.gallerySorting[this.GOM.curNavLevel];\r\n            var maxItems = this.galleryMaxItems[this.GOM.curNavLevel];\r\n          \r\n            if( sortOrder != '' || maxItems > 0 ) {\r\n            \r\n              // copy album's items to a new array\r\n              var currentAlbum = this.I.filter( function( obj ) {\r\n                return( obj.albumID == albumID && obj.kind != 'albumUp' );\r\n              });\r\n        \r\n              // sorting options\r\n              switch( sortOrder ) {\r\n                case 'RANDOM':\r\n                  currentAlbum = NGY2Tools.AreaShuffle(currentAlbum);\r\n                  break;\r\n                case 'REVERSED':\r\n                  currentAlbum = currentAlbum.reverse();\r\n                  break;\r\n                case 'TITLEASC':\r\n                  currentAlbum.sort(function (a, b) {\r\n                    return( (a.title.toUpperCase() < b.title.toUpperCase()) ? -1 : ((a.title.toUpperCase() > b.title.toUpperCase()) ? 1 : 0) );\r\n                  });\r\n                  break;\r\n                case 'TITLEDESC':\r\n                  currentAlbum.sort(function (a, b) {\r\n                    return( (a.title.toUpperCase() > b.title.toUpperCase()) ? -1 : ((a.title.toUpperCase() < b.title.toUpperCase()) ? 1 : 0) );\r\n                  });\r\n                  break;\r\n              }     \r\n\r\n              // max Items\r\n              if( maxItems > 0 && currentAlbum.length > maxItems ) {\r\n                currentAlbum.splice(maxItems - 1, currentAlbum.length-maxItems );\r\n              }\r\n              \r\n              // remove the albums's items from the global items array\r\n              this.I.removeIf( function( obj ) {\r\n                return( obj.albumID == albumID && obj.kind != 'albumUp' );\r\n              });\r\n              \r\n              // add the sorted items back to the album\r\n              this.I.push.apply(this.I, currentAlbum);\r\n\r\n            }\r\n          };\r\n          \r\n          return NGY2Tools;\r\n        })(); \r\n\r\n        // ====================\r\n        // ===== NGY2Item =====\r\n        // ====================\r\n        window.NGY2Item = (function() {\r\n          var nextId = 1;                   // private static --> all instances\r\n\r\n          // constructor\r\n          function NGY2Item( itemID ) {\r\n          //window.NGY2Item = function( itemID ) {\r\n            var ID = 0;                     // private\r\n\r\n            // public (this instance only)\r\n            if( itemID === undefined || itemID === null ) {\r\n              ID = nextId++;\r\n            }\r\n            else {\r\n              ID = itemID;\r\n            }\r\n            this.GetID = function () { return ID; };\r\n            \r\n            // public\r\n            this.kind =                 '';       // 'image', 'album' or 'albumUp'\r\n            this.mediaKind =            'img';    // 'img', 'iframe'\r\n            this.mediaMarkup =          '';\r\n            this.G =                    null;     // pointer to global instance\r\n            this.title =                '';       // image title\r\n            this.description =          '';       // image description\r\n            this.albumID =              0;        // ID of the parent album\r\n            this.src =                  '';       // full sized image URL\r\n            this.width =                0;        // image width\r\n            this.height =               0;        // image height\r\n            this.destinationURL =       '';       // thumbnail destination URL --> open URL instead of displaying image\r\n            this.downloadURL =          '';       // thumbnail download URL --> specify the image for download button\r\n            this.author =               '';       // image/album author\r\n            this.left=                  0;        // store position to animate from old to new\r\n            this.top=                   0;\r\n            this.width=                 0;        // store size to avoid setting width/height if not required\r\n            this.height=                0;\r\n            this.resizedContentWidth=   0;        // store size of content (image) to avoid setting width/height if not required\r\n            this.resizedContentHeight=  0;\r\n            this.thumbs = {                       // URLs and sizes for user defined\r\n              url:    { l1: { xs: '', sm:'', me: '', la: '', xl: '' }, lN: { xs: '', sm: '', me: '', la:'', xl: '' } },\r\n              width:  { l1: { xs: 0,  sm: 0, me: 0,  la: 0 , xl: 0  }, lN: { xs: 0 , sm: 0,  me: 0,  la: 0, xl: 0  } },\r\n              height: { l1: { xs: 0,  sm: 0, me: 0,  la: 0 , xl: 0  }, lN: { xs: 0,  sm: 0,  me: 0,  la: 0, xl: 0  } }\r\n            };\r\n            this.thumbnailImgRevealed   = false;  // thumbnail image already revealed\r\n            this.imageDominantColors    = null;   // base64 GIF\r\n            this.imageDominantColor     = null;   // HEX RGB\r\n            this.featured =             false;    // featured element\r\n            this.flickrThumbSizes =     {};       // store URLs for all available thumbnail sizes (flickr)\r\n            this.picasaThumbs =         null;     // store URLs and sizes\r\n            this.hovered =              false;    // is the thumbnail currently hovered?\r\n            this.hoverInitDone =        false;\r\n            this.contentIsLoaded =      false;    // album: are items already loaded?\r\n            this.contentLength =        0;        // album: number of items (real number of items in memory)\r\n            this.numberItems =          0;        // album: number of items (value returned by data source)\r\n            this.mediaNumber =          0;        // media number in the album\r\n            this.imageCounter =         0;        // number of images in an album\r\n            this.eltTransform =         [];       // store the CSS transformations\r\n            this.eltFilter =            [];       // store the CSS filters\r\n            this.eltEffect =            [];       // store data about hover effects animations\r\n            this.authkey =              '';       // for Google Photos private (hidden) albums\r\n            this.paginationLastPage =   0;        // for albums\r\n            this.paginationLastWidth =  0;        // for albums\r\n            this.customData =           {};\r\n            this.selected =             false;\r\n            this.imageWidth =           0;        // image natural (real) width\r\n            this.imageHeight =          0;        // image natural (real) height\r\n            this.$elt =                 null;     // pointer to the corresponding DOM element\r\n            this.$Elts =                [];       // cached pointers to the thumbnail content -> to avoid jQuery().find()\r\n            this.tags =                 [];       // list of tags of the current item\r\n            this.albumTagList =         [];       // list of all the tags of the items contained in the current album\r\n            this.albumTagListSel =      [];       // list of currently selected tags (only for albums)\r\n            this.exif = { exposure: '', flash: '', focallength: '', fstop: '', iso: '', model: '', time: '', location: ''};\r\n            this.deleted =              false;    // item is deleted -> do not display anymore\n            this.rotationAngle =        0;        // image display rotation angle\r\n          }\r\n\r\n          // public static\r\n          \r\n          NGY2Item.Get = function( instance, ID ) {\r\n            var l = instance.I.length;\r\n            for( var i = 0; i < l; i++ ) {\r\n              if( instance.I[i].GetID() == ID ) {\r\n                return instance.I[i];\r\n              }\r\n            }\r\n            return null;\r\n          };\r\n            \r\n          NGY2Item.GetIdx = function( instance, ID ) {\r\n            var l = instance.I.length;\r\n            for( var i = 0; i < l; i++ ) {\r\n              if( instance.I[i].GetID() == ID ) {\r\n                return i;\r\n              }\r\n            }\r\n            return -1;\r\n          };\r\n          \r\n          // create new item (image, album or albumUp)\r\n          NGY2Item.New = function( instance, title, description, ID, albumID, kind, tags ) {\r\n            var album = NGY2Item.Get( instance, albumID );\r\n            \r\n            if( albumID != -1 && albumID != 0 && title !='image gallery by nanogallery2 [build]'  ) {\r\n              if( instance.O.thumbnailLevelUp && album.getContentLength(false) == 0 && instance.O.album == '' ) {\r\n                // add navigation thumbnail (album up)\r\n                var item = new NGY2Item('0');\r\n                instance.I.push( item );\r\n                album.contentLength += 1;\r\n                item.title = 'UP';\r\n                item.albumID = albumID;\r\n                item.kind = 'albumUp';\r\n                item.G = instance;\r\n\r\n                jQuery.extend( true, item.thumbs.width, instance.tn.defaultSize.width);\r\n                jQuery.extend( true, item.thumbs.height, instance.tn.defaultSize.height);\r\n              }\r\n            }\r\n            \r\n            var item = NGY2Item.Get(instance, ID);\r\n            if( item === null ){\r\n              // create a new item (otherwise, just update the existing one)\r\n              item = new NGY2Item(ID);\r\n              instance.I.push(item);\r\n              if( albumID != -1 && title !='image gallery by nanogallery2 [build]' ) {\r\n                album.contentLength+=1;\r\n              }\r\n            }\r\n            item.G = instance;\r\n\r\n            item.albumID = albumID;\r\n            item.kind = kind;\r\n            if( kind == 'image' ) {\r\n              album.imageCounter += 1;\r\n              item.mediaNumber = album.imageCounter;\r\n            }\r\n\r\n            // check keyword to find features images/albums\r\n            var kw = instance.O.thumbnailFeaturedKeyword;\r\n            if( kw != '' ) {\r\n              // check if item featured based on a keyword in the title or in the description\r\n              kw = kw.toUpperCase();\r\n              var p = title.toUpperCase().indexOf(kw);\r\n              if( p > -1) {\r\n                item.featured = true;\r\n                // remove keyword case unsensitive\r\n                title = title.substring(0, p) + title.substring(p+kw.length, title.length);\r\n              }\r\n              p = description.toUpperCase().indexOf(kw);\r\n              if( p > -1) {\r\n                item.featured=true;\r\n                // remove keyword case unsensitive\r\n                description=description.substring(0, p) + description.substring(p + kw.length, description.length);\r\n              }\r\n            }\r\n            \r\n            // TAGS \r\n            // if( instance.galleryFilterTags.Get() != false ) {\r\n              // if( instance.galleryFilterTags.Get() == true ) {\r\n                // if( tags != '' && tags != undefined ) {\r\n                  // use set tags\r\n                  // item.setTags(tags.split(' '));\r\n                // }\r\n              // }\r\n              // else {\r\n                // extract tags starting with # (in title)\r\n              if( typeof instance.galleryFilterTags.Get() == 'string' ) {\r\n                switch( instance.galleryFilterTags.Get().toUpperCase() ) {\r\n                  case 'TITLE':\r\n                    var re = /(?:^|\\W)#(\\w+)(?!\\w)/g, match, matches = [];\r\n                    var tags = \"\";\r\n                    while (match = re.exec(title)) {\r\n                      matches.push(match[1].replace(/^\\s*|\\s*$/, ''));   //trim trailing/leading whitespace\r\n                    }\r\n                    item.setTags(matches);  //tags;\r\n                    title = title.split('#').join('');   //replaceall\r\n                    break;\r\n                  case 'DESCRIPTION':\r\n                    var re = /(?:^|\\W)#(\\w+)(?!\\w)/g, match, matches = [];\r\n                    var tags = \"\";\r\n                    while (match = re.exec(description)) {\r\n                      matches.push(match[1].replace(/^\\s*|\\s*$/, ''));   //trim trailing/leading whitespace\r\n                    }\r\n                    item.setTags(matches);  //tags;\r\n                    description = description.split('#').join('');   //replaceall\r\n                    break;\r\n                }\r\n              }\r\n                else {\r\n                  if( tags != '' && tags != undefined ) {\r\n                    // use set tags\r\n                    item.setTags(tags.split(' '));\r\n                  }\r\n                }\r\n              // }\r\n            // }\r\n            \r\n            // set (maybe modified) fields title and description\r\n            item.title = escapeHtml(instance, title);\r\n            item.description = escapeHtml(instance, description);\r\n            return item;\r\n          };\r\n          \r\n          \r\n          // removes logically current item\r\n          NGY2Item.prototype.delete = function( ) {\r\n            this.deleted = true;\r\n            \r\n            // update content length of parent album\r\n            this.G.I[NGY2Item.GetIdx(this.G, this.albumID)].contentLength--;\r\n            this.G.I[NGY2Item.GetIdx(this.G, this.albumID)].numberItems--;\r\n            \r\n            // check if in DOM and removes it\r\n            var nbTn = this.G.GOM.items.length;\r\n            var ID = this.GetID();\r\n            var foundIdx = -1;\r\n            var foundGOMidx = -1;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = this.G.GOM.items[i];\r\n              var item=this.G.I[curTn.thumbnailIdx];\r\n              if( item.GetID() == ID ) {\r\n                // FOUND\r\n                if( !curTn.neverDisplayed ) {\r\n                  foundIdx= curTn.thumbnailIdx;\r\n                  foundGOMidx= i;\r\n                }\r\n              }\r\n              else {\r\n                if( foundIdx != -1 ) {\r\n                  if( !curTn.neverDisplayed ) {\r\n                    // update index value\r\n                    item.$getElt('.nGY2GThumbnail').data('index', i-1);\r\n                    item.$getElt('.nGY2GThumbnailImg').data('index', i-1);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n            if( foundIdx != -1 ) {\r\n              // delete item in GOM and delete thumbnail\r\n              var G = this.G;\r\n              if( this.selected == true ) {\r\n                this.selected = false;\r\n                G.GOM.nbSelected--;    // update the global counter\r\n              }\r\n              if( G.I[foundIdx].$elt !== null ) {\r\n                G.I[foundIdx].$elt.remove();      // delete thumbnail DOM object\r\n              }\r\n              G.GOM.items.splice(foundGOMidx, 1);   // delete in GOM\r\n              if( G.GOM.lastDisplayedIdx != -1 ) {\r\n                G.GOM.lastDisplayedIdx-=1;\r\n              }\r\n            }\r\n          }\r\n\r\n          NGY2Item.prototype.addToGOM = function( ) {\r\n            // retrieve index\r\n            var ID = this.GetID();\r\n            var l = this.G.I.length;\r\n            for( var idx = 0; idx < l; idx++ ) {\r\n              var item = this.G.I[idx];\r\n              if( item.GetID() == ID ) {\r\n                var w = item.thumbImg().width;\r\n                var h = item.thumbImg().height;\r\n                // set default size if required\r\n                if( h == 0 ) {\r\n                  h = this.G.tn.defaultSize.getHeight();\r\n                }\r\n                if( w == 0 ) {\r\n                  w = this.G.tn.defaultSize.getWidth();\r\n                }\r\n                // add to GOM -> will be displayed on next refresh/resize\r\n                var tn = new this.G.GOM.GTn(idx, w, h);\r\n                this.G.GOM.items.push(tn);\r\n                break;\r\n              }\r\n            }\r\n            \r\n          }\r\n          \r\n          \r\n          // function to avoid XSS issue - Cross Site Scripting\r\n          // original: https://github.com/janl/mustache.js/blob/master/mustache.js#L55\r\n          var entityMap = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '\"': '&quot;', \"'\": '&#39;', '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;' };\r\n          function escapeHtml (instance, string) {\r\n            if( instance.O.allowHTMLinData == true ) {\r\n              return string;\r\n            }\r\n            else {\r\n              return String(string).replace(/[&<>\"'`=\\/]/g, function fromEntityMap (s) {\r\n                return entityMap[s];\r\n              });\r\n            }\r\n          }\r\n          \r\n          \r\n          NGY2Item.get_nextId = function () {\r\n            return nextId;\r\n          };\r\n\r\n          //=== public (shared across instances)\r\n\r\n          //--- cached sub elements\r\n          NGY2Item.prototype.$getElt = function( elt, forceRefresh ) {\r\n            if( this.$elt == null ) { return null; }\r\n            if( this.$Elts[elt] !== undefined && !forceRefresh == true ) {\r\n              return this.$Elts[elt];\r\n            }\r\n            else {\r\n              if( elt == '.nGY2GThumbnail' ) {\r\n                this.$Elts[elt]=this.$elt;\r\n              }\r\n              else {\r\n                this.$Elts[elt]=this.$elt.find(elt);\r\n              }\r\n              return this.$Elts[elt];\r\n            }\r\n          };\r\n          \r\n          // remove one element (in DOM and in cache)\r\n          NGY2Item.prototype.removeElt = function( elt ) {\r\n            if( this.$elt == null ) { return; }\r\n            if( this.$Elts[elt] == undefined) { return; }\r\n            this.$Elts[elt].remove();\r\n            var index = this.$Elts.indexOf(elt);\r\n            this.$Elts.splice(index, 1);\r\n          };\r\n\r\n          //--- returns the album containing the item\r\n          NGY2Item.prototype.album = function() {\r\n            return this.G.I[NGY2Item.GetIdx(this.G, this.albumID)];\r\n          };\r\n          \r\n          //--- viewer - transition can be disabled per media kind - returns true if current media supports transition (swipe)\r\n          NGY2Item.prototype.mediaTransition = function( ) {\r\n            if( this.G.O.viewerTransitionMediaKind.indexOf( this.mediaKind ) > -1 ) {\r\n              return true;\r\n            }\r\n            return false;\r\n          };\r\n\r\n          //--- set one image (url and size)\r\n          NGY2Item.prototype.imageSet = function( src, w, h ) {\r\n            this.src = src;\r\n            this.width = w;\r\n            this.height = h;\r\n          };\r\n          \r\n          //--- set one thumbnail (url and size) - screenSize and level are optionnal\r\n          NGY2Item.prototype.thumbSet = function( src, w, h, screenSize, level ) {\r\n            var lst=['xs','sm','me','la','xl'];\r\n            if( typeof screenSize === 'undefined' || screenSize == '' || screenSize == null ) {\r\n              for( var i=0; i< lst.length; i++ ) {\r\n                if( typeof level === 'undefined' || level == '' ) {\r\n                  this.thumbs.url.l1[lst[i]]=src;\r\n                  this.thumbs.height.l1[lst[i]]=h;\r\n                  this.thumbs.width.l1[lst[i]]=w;\r\n                  this.thumbs.url.lN[lst[i]]=src;\r\n                  this.thumbs.height.lN[lst[i]]=h;\r\n                  this.thumbs.width.lN[lst[i]]=w;\r\n                }\r\n                else {\r\n                  this.thumbs.url[level][lst[i]]=src;\r\n                  this.thumbs.height[level][lst[i]]=h;\r\n                  this.thumbs.width[level][lst[i]]=w;\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              if( typeof level === 'undefined' || level == '' || level == null ) {\r\n                this.thumbs.url.l1[screenSize]=src;\r\n                this.thumbs.height.l1[screenSize]=h;\r\n                this.thumbs.width.l1[screenSize]=w;\r\n                this.thumbs.url.lN[screenSize]=src;\r\n                this.thumbs.height.lN[screenSize]=h;\r\n                this.thumbs.width.lN[screenSize]=w;\r\n              }\r\n              else {\r\n                this.thumbs.url[level][screenSize]=src;\r\n                this.thumbs.height[level][screenSize]=h;\r\n                this.thumbs.width[level][screenSize]=w;\r\n              }\r\n            }\r\n          \r\n            var lst=['xs','sm','me','la','xl'];\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              this.thumbs.height.l1[lst[i]]=h;\r\n            }\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.lN[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.height.lN[lst[i]]=h;\r\n              }\r\n            }\r\n          };\r\n\r\n          //--- set thumbnail image real height for current level/resolution, and for all others level/resolutions having the same settings\r\n          NGY2Item.prototype.thumbSetImgHeight = function( h ) {              \r\n            var lst=['xs','sm','me','la','xl'];\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.l1[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.height.l1[lst[i]]=h;\r\n              }\r\n            }\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.lN[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.height.lN[lst[i]]=h;\r\n              }\r\n            }\r\n          };\r\n\r\n          //--- set thumbnail image real width for current level/resolution, and for all others level/resolutions having the same settings\r\n          NGY2Item.prototype.thumbSetImgWidth = function( w ) {              \r\n            var lst=['xs','sm','me','la','xl'];\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.l1[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.width.l1[lst[i]]=w;\r\n              }\r\n            }\r\n            for( var i=0; i< lst.length; i++ ) {\r\n              if( this.G.tn.settings.height.lN[lst[i]] == this.G.tn.settings.getH() && this.G.tn.settings.width.l1[lst[i]] == this.G.tn.settings.getW() ) {\r\n                this.thumbs.width.lN[lst[i]]=w;\r\n              }\r\n            }\r\n          };\r\n          \r\n          //--- Returns Thumbnail image (depending of the screen resolution)\r\n          NGY2Item.prototype.thumbImg = function () {   \r\n            var tnImg = { src: '', width: 0, height: 0 };\r\n\r\n            if( this.title == 'image gallery by nanogallery2 [build]' ) {\r\n              tnImg.src = this.G.emptyGif;\r\n              tnImg.url = this.G.emptyGif;\r\n              return tnImg;\r\n            }\r\n            tnImg.src = this.thumbs.url[this.G.GOM.curNavLevel][this.G.GOM.curWidth];\r\n            tnImg.width = this.thumbs.width[this.G.GOM.curNavLevel][this.G.GOM.curWidth];\r\n            tnImg.height = this.thumbs.height[this.G.GOM.curNavLevel][this.G.GOM.curWidth];\r\n            return tnImg;\r\n          };\r\n          \r\n          //--- Set tags to items and add these tags to the album\r\n          NGY2Item.prototype.setTags = function( tags ) {              \r\n          if( tags.length > 0 ) {\r\n              this.tags = tags;\r\n              var lstTags = this.album().albumTagList;\r\n              for( var i = 0; i < tags.length; i++ ) {\r\n                var tfound = false;\r\n                for( var j = 0; j < lstTags.length; j++ ) {\r\n                  if( tags[i].toUpperCase() == lstTags[j].toUpperCase() ) {\r\n                    tfound = true;\r\n                  }\r\n                }\r\n                if( tfound == false) {\r\n                  this.album().albumTagList.push(tags[i])\r\n                  this.album().albumTagListSel.push(tags[i])\r\n                }\r\n              }\r\n            }\r\n          };\r\n          \r\n          //--- check if 1 of current item's tags is selected (tag filter)\r\n          NGY2Item.prototype.checkTagFilter = function() {\r\n            if( this.G.galleryFilterTags.Get() != false && this.album().albumTagList.length > 0 ) {\r\n              if( this.G.O.thumbnailLevelUp && this.kind=='albumUp' ) {\r\n                return true;\r\n              }\r\n              var found = false;\r\n              var lstTags = this.album().albumTagListSel;\r\n              for( var i = 0; i < this.tags.length; i++ ) {\r\n                for( var j = 0; j < lstTags.length; j++ ) {\r\n                  if( this.tags[i].toUpperCase() == lstTags[j].toUpperCase() ) {\r\n                    found = true;\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n              return found;\r\n            }\r\n            else\r\n              return true;\r\n          };\r\n          \r\n          //--- check if 1 of current item's tags is found using API search\r\n          NGY2Item.prototype.isSearchTagFound = function() {\r\n            if( this.G.GOM.albumSearchTags == '' ) { return true; }\r\n            if( this.G.O.thumbnailLevelUp && this.kind == 'albumUp' ) { return true; }\r\n\r\n            //var lstTags=this.album().albumTagListSel;\r\n            for( var i = 0; i < this.tags.length; i++ ) {\r\n              if( this.tags[i].toUpperCase().indexOf( this.G.GOM.albumSearchTags ) >= 0 ) {\r\n                return true;\r\n              }\r\n            }\r\n            return false;\r\n          };\r\n          \r\n          //--- set the URL of the media to display in the viewer\r\n          //--- markup is defined for images\r\n          NGY2Item.prototype.setMediaURL = function( url, mediaKind ) {\r\n            this.src = url;\r\n            this.mediaKind = mediaKind;\r\n            if( mediaKind == 'img' ) {\r\n              this.mediaMarkup = '<img class=\"nGY2ViewerMedia\" src=\"' + url + '\" alt=\" \" itemprop=\"contentURL\" draggable=\"false\">';\r\n            }\r\n          };\r\n          \r\n          \r\n          //--- check if current item should be displayed\r\n          NGY2Item.prototype.isToDisplay = function( albumID ) {\r\n            return this.albumID == albumID && this.checkTagFilter() && this.isSearchFound() && this.isSearchTagFound() && this.deleted == false;\r\n          };\r\n          \r\n          \r\n          \r\n          //--- returns the number of items of the current album\r\n          //--- count using tags filter\r\n          NGY2Item.prototype.getContentLength = function( filterTags ) {\r\n            if( filterTags == false || this.albumTagList.length == 0 || this.G.galleryFilterTags.Get() == false ) {\r\n              return this.contentLength;\r\n            }\r\n            else {\r\n              var l = this.G.I.length;\r\n              var cnt = 0;\r\n              var albumID = this.GetID();\r\n              for( var idx = 0; idx < l; idx++ ) {\r\n                var item = this.G.I[idx];\r\n                if( item.isToDisplay(albumID) ) {\r\n                  cnt++;\r\n                }\r\n              }\r\n              return cnt;\r\n            }\r\n          };\r\n          \r\n          NGY2Item.prototype.isSearchFound = function() {\r\n            if( this.G.GOM.albumSearch != '' ) {\r\n              if( this.title.toUpperCase().indexOf( this.G.GOM.albumSearch ) == -1 ) {\r\n                return false;\r\n              }\r\n            }\r\n            return true;\r\n          }\r\n          \r\n          \r\n          //--- for future use...\r\n          NGY2Item.prototype.responsiveURL = function () {\r\n            var url = '';\r\n            switch(this.G.O.kind) {\r\n              case '':\r\n                url = this.src;\r\n                break;\r\n              case 'flickr':\r\n                url = this.src;\r\n                break;\r\n              case 'picasa':\r\n              case 'google':\r\n              case 'google2':\r\n              default:\r\n                url = this.src;\r\n                break;\r\n            }\r\n            return url;\r\n          };\r\n          \r\n          \r\n          //--- Reveal the thumbnail image with animation on opacity\r\n          NGY2Item.prototype.ThumbnailImageReveal = function () {\r\n\r\n            if( this.thumbnailImgRevealed == false ) {\r\n              this.thumbnailImgRevealed = true;\r\n              new NGTweenable().tween({\r\n                from:         { opacity: 0 },\r\n                to:           { opacity: 1 },\r\n                attachment:   { item: this },\r\n                delay:        30,\r\n                duration:     400,\r\n                easing:       'easeOutQuart',\r\n                step:         function (state, att) {\r\n                  var $e=att.item.$getElt('.nGY2TnImg');\r\n                  if( $e != null ) {\r\n                    $e.css( state );\r\n                  }\r\n                }\r\n              });\r\n            }\r\n          };\r\n          \r\n          \r\n          // In case of thumbnails with stacks - apply a percent to a value which include a unit\r\n          function ValueApplyPercent( str, percent ) {\r\n            str=String(str);\r\n            if( str === '0' || percent == 1 ) { return str; }\r\n            var n = Number(str.replace(/[a-zA-Z]/g, ''));\r\n            var ar = str.match(/([^\\-0-9\\.]+)/g);\r\n            var a = '';\r\n            if( ar != null && ar.length > 0 ) {\r\n              a = ar.join();\r\n            }\r\n             \r\n            if( isNaN(n) || n == 0 ) {\r\n              return str;\r\n            }\r\n\r\n            n = n * percent;\r\n            return n + a;\r\n          } \r\n          \r\n          //--- 2D/3D CSS transform - apply the cached value to element\r\n          NGY2Item.prototype.CSSTransformApply = function ( eltClass ) {\r\n            var obj = this.eltTransform[eltClass];\r\n\r\n            if( eltClass == '.nGY2GThumbnail' ) {\r\n              // thumbnail\r\n              var nbStacks = obj.$elt.length-1;\r\n              var pTranslateX = 1;\r\n              var pTranslateY = 1;\r\n              var pTranslateZ = 1;\r\n              var pTranslate = 1;\r\n              var pRotateX = 1;\r\n              var pRotateY = 1;\r\n              var pRotateZ = 1;\r\n              var pRotate = 1;\r\n              var pScale = 1;\r\n              for( var n = nbStacks; n >= 0; n-- ) {\r\n                // units must be given with\r\n                var v = 'translateX(' + ValueApplyPercent(obj.translateX,pTranslateX) + ') translateY(' + ValueApplyPercent(obj.translateY,pTranslateY) + ') translateZ(' + ValueApplyPercent(obj.translateZ,pTranslateZ) + ') scale(' + ValueApplyPercent(obj.scale,pScale) + ') translate(' + ValueApplyPercent(obj.translate,pTranslate) + ')';\r\n                if( !(this.G.IE <= 9) && !this.G.isGingerbread ) {\r\n                  v += ' rotateX(' + ValueApplyPercent(obj.rotateX,pRotateX) + ') rotateY(' + ValueApplyPercent(obj.rotateY,pRotateY) + ') rotateZ(' + ValueApplyPercent(obj.rotateZ,pRotateZ) + ') rotate(' + ValueApplyPercent(obj.rotate,pRotate) + ')';\r\n                }\r\n                else {\r\n                  v += ' rotate(' + ValueApplyPercent(obj.rotateZ,pRotateZ) + ')';\r\n                }\r\n                obj.$elt[n].style[this.G.CSStransformName] = v;\r\n                \r\n                if( nbStacks > 0 ) {\r\n                  // apply a percent to the stack elements\r\n                  pTranslateX -= this.G.tn.opt.Get('stacksTranslateX');\r\n                  pTranslateY -= this.G.tn.opt.Get('stacksTranslateY');\r\n                  pTranslateZ -= this.G.tn.opt.Get('stacksTranslateZ');\r\n                  pRotateX    -= this.G.tn.opt.Get('stacksRotateX');\r\n                  pRotateY    -= this.G.tn.opt.Get('stacksRotateY');\r\n                  pRotateZ    -= this.G.tn.opt.Get('stacksRotateZ');\r\n                  pScale      -= this.G.tn.opt.Get('stacksScale');\r\n                }\r\n              }\r\n            }\r\n            else {\r\n              // thumbnail sub element\r\n              if( obj.$elt != null ) {\r\n                for( var n = 0; n < obj.$elt.length; n++ ) {\r\n                  if( obj.$elt[n] != undefined ) {\r\n                    // units must be given with\r\n                    var v = 'translateX(' + obj.translateX + ') translateY(' + obj.translateY + ') translateZ(' + obj.translateZ + ') scale(' + obj.scale + ') translate(' + obj.translate + ')';\r\n                    if( !(this.G.IE <= 9) && !this.G.isGingerbread ) {\r\n                      v += ' rotateX(' + obj.rotateX + ') rotateY(' + obj.rotateY + ') rotateZ(' + obj.rotateZ + ') rotate(' + obj.rotate + ')';\r\n                    }\r\n                    else {\r\n                      v += ' rotate(' + obj.rotateZ + ')';\r\n                    }\r\n                    obj.$elt[n].style[this.G.CSStransformName] = v;\r\n                    }\r\n                }\r\n              }\r\n            }\r\n          };\r\n\r\n          //--- 2D/3D CSS transform - set a value in cache\r\n          NGY2Item.prototype.CSSTransformSet = function ( eltClass, transform, value, forceRefresh ) {\r\n            if( this.eltTransform[eltClass] == undefined ) {\r\n              this.eltTransform[eltClass] = { translateX: 0, translateY: 0, translateZ: 0, rotateX: 0, rotateY: 0, rotateZ: 0, scale: 1, translate: '0px,0px', rotate: 0 };\r\n              this.eltTransform[eltClass].$elt = this.$getElt(eltClass);\r\n            }\r\n            this.eltTransform[eltClass][transform] = value;\r\n            if( forceRefresh === true ) {\r\n              this.eltTransform[eltClass].$elt = this.$getElt(eltClass, true);\r\n            }\r\n          };\r\n\r\n          //--- CSS Filters - apply the cached value to element\r\n          NGY2Item.prototype.CSSFilterApply = function ( eltClass ) {\r\n            var obj = this.eltFilter[eltClass];\r\n            var v = 'blur(' + obj.blur + ') brightness(' + obj.brightness + ') grayscale(' + obj.grayscale + ') sepia(' + obj.sepia + ') contrast(' + obj.contrast + ') opacity(' + obj.opacity + ') saturate(' + obj.saturate + ')';\r\n            if( obj.$elt != null ) {\r\n              for( var n = 0; n < obj.$elt.length; n++ ) {\r\n                if( obj.$elt[n] != undefined ) {\r\n                  obj.$elt[n].style.WebkitFilter = v;\r\n                  obj.$elt[n].style.filter = v;\r\n                }\r\n              }\r\n            }\r\n          };\r\n\r\n          //--- CSS Filters - set a value in cache\r\n          NGY2Item.prototype.CSSFilterSet = function ( eltClass, filter, value, forceRefresh ) {\r\n            if( this.eltFilter[eltClass] == undefined ) {\r\n              this.eltFilter[eltClass] = { blur: 0, brightness: '100%', grayscale: '0%', sepia: '0%', contrast: '100%', opacity: '100%', saturate: '100%' };\r\n              this.eltFilter[eltClass].$elt = this.$getElt(eltClass);\r\n            }\r\n            this.eltFilter[eltClass][filter] = value;\r\n            if( forceRefresh === true ) {\r\n              this.eltTransform[eltClass].$elt = this.$getElt(eltClass, true);\r\n            }\r\n          };\r\n\r\n          //--- thumbnail hover animation\r\n          NGY2Item.prototype.animate = function ( effect, delay, hoverIn ) {\r\n            if( this.$getElt() == null  ) { return; }\r\n\r\n            var context = {};\r\n            context.G = this.G;\r\n            context.item = this;\r\n            context.effect = effect;\r\n            context.hoverIn = hoverIn;\r\n            context.cssKind = '';\r\n            if( hoverIn ) {\r\n              // HOVER IN\r\n              \r\n              if( this.eltEffect[effect.element] == undefined ) {\r\n                this.eltEffect[effect.element] = [];\r\n              }\r\n              if( this.eltEffect[effect.element][effect.type] == undefined ) {\r\n                this.eltEffect[effect.element][effect.type] = { initialValue: 0, lastValue: 0 };\r\n              }\r\n              if( effect.firstKeyframe ) {\r\n                // store initial and current value -> for use in the back animation\r\n                this.eltEffect[effect.element][effect.type] = { initialValue: effect.from, lastValue: effect.from};\r\n              }\r\n              \r\n              context.animeFrom = effect.from;\r\n              context.animeTo = effect.to;\r\n              context.animeDuration = parseInt(effect.duration);\r\n              context.animeDelay = 30 + parseInt(effect.delay + delay);  // 30ms is a default delay to avoid conflict with other initializations\r\n              context.animeEasing = effect.easing;\r\n            }\r\n            else {\r\n              // HOVER OUT\r\n              if( effect.firstKeyframe ) {\r\n                context.animeFrom = this.eltEffect[effect.element][effect.type].lastValue;\r\n                context.animeTo = this.eltEffect[effect.element][effect.type].initialValue;\r\n                // context.animeTo=effect.from;\r\n              }\r\n              else {\r\n                // context.animeFrom=effect.from;\r\n                context.animeFrom = this.eltEffect[effect.element][effect.type].lastValue;\r\n                context.animeTo = this.eltEffect[effect.element][effect.type].initialValue;\r\n                // context.animeTo=effect.to;\r\n                \r\n              }\r\n              \r\n              context.animeDuration = parseInt(effect.durationBack);\r\n              context.animeDelay = 30 + parseInt(effect.delayBack + delay);   // 30ms is a default delay to avoid conflict with other initializations\r\n              context.animeEasing = effect.easingBack;\r\n            }\r\n            \r\n\r\n            // detect if animation on CSS transform\r\n            var transform=['translateX', 'translateY', 'translateZ', 'scale', 'rotateX', 'rotateY', 'rotateZ'];\r\n            for( var i = 0; i < transform.length; i++ ) {\r\n              if( effect.type == transform[i] ) {\r\n                context.cssKind = 'transform';\r\n                break;\r\n              }\r\n            }\r\n\r\n            // detect if animation on CSS filter\r\n            var filter=['blur', 'brightness', 'grayscale', 'sepia', 'contrast', 'opacity', 'saturate'];\r\n            for( var i = 0; i < filter.length; i++ ) {\r\n              if( effect.type == filter[i] ) {\r\n                context.cssKind = 'filter';\r\n                break;\r\n              }\r\n            }\r\n            // handle some special cases\r\n            if( hoverIn && effect.element == '.nGY2GThumbnail' && ( effect.type == 'scale' || effect.type == 'rotateX') ) {\r\n              this.G.GOM.lastZIndex++;\r\n              this.$getElt(effect.element).css('z-index', this.G.GOM.lastZIndex);\r\n              // setElementOnTop(this.G.$E.base, this.$getElt(effect.element) );\r\n            }\r\n            \r\n            // animation\r\n            var tweenable = new NGTweenable();\r\n            context.tweenable=tweenable;\r\n            tweenable.tween({\r\n              attachment:   context,\r\n              from:         { 'v': context.animeFrom },\r\n              to:           { 'v': context.animeTo },\r\n              duration:     context.animeDuration,    //parseInt(effect.duration),\r\n              delay:        context.animeDelay,       //parseInt(effect.delay),\r\n              easing:       context.animeEasing,      //'easeOutQuart',\r\n              \r\n              step: function (state, att) {\r\n                if( att.item.$getElt() == null ) {\r\n                  // the thumbnail may be destroyed since the start of the animation\r\n                  att.tweenable.stop(false);\r\n                  // att.tweenable.dispose();\r\n                  return;\r\n                }\r\n                if( att.hoverIn && !att.item.hovered ) {\r\n                  // thumbnail no more hovered\r\n                  att.tweenable.stop(false);\r\n                  // att.tweenable.dispose();\r\n                  return;\r\n                }\r\n\r\n                if( att.G.VOM.viewerDisplayed ) {\r\n                  att.tweenable.stop(false);\r\n                  // att.tweenable.dispose();\r\n                  return;\r\n                }\r\n                \r\n                // test if in delay phase\r\n                if( state.v == att.animeFrom ) { return; }\r\n                \r\n                switch( att.cssKind ) {\r\n                  case 'transform':\r\n                    // window.ng_draf( function() {\r\n                      att.item.CSSTransformSet(att.effect.element, att.effect.type, state.v);\r\n                      att.item.CSSTransformApply( att.effect.element );\r\n                    // });\r\n                    break;\r\n                  case 'filter':\r\n                    // window.ng_draf( function() {\r\n                      att.item.CSSFilterSet(att.effect.element, att.effect.type, state.v);\r\n                      att.item.CSSFilterApply( att.effect.element );\r\n                    // });\r\n                    break;\r\n                  default:\r\n                    var v=state.v;\r\n                    if( state.v.substring(0,4) == 'rgb(' || state.v.substring(0,5) == 'rgba(' ) {\r\n                      // to remove values after the dot (not supported by RGB/RGBA)\r\n                      // v=ngtinycolor(state.v).toRgbString();\r\n                      v = ShadeBlendConvert(0, v);\r\n                    }\r\n                    // window.ng_draf( function() {\r\n                      att.item.$getElt( att.effect.element ).css( att.effect.type, v );\r\n                    // });\r\n                    break;\r\n                }\r\n                if( hoverIn ) {\r\n                  // store value for back animation\r\n                  att.item.eltEffect[att.effect.element][att.effect.type].lastValue = state.v;\r\n                }\r\n              },\r\n              \r\n              finish: function (state, att) {\r\n                if( hoverIn ) {\r\n                  // store value for back animation\r\n                  att.item.eltEffect[att.effect.element][att.effect.type].lastValue = state.v;\r\n                }\r\n\r\n                if( att.item.$getElt() == null ) {\r\n                  // the thumbnail may be destroyed since the start of the animation\r\n                  return;\r\n                }\r\n                if( att.hoverIn && !att.item.hovered ) {\r\n                  // thumbnail no more hovered\r\n                  return;\r\n                }\r\n\r\n                if( att.G.VOM.viewerDisplayed ) {\r\n                  return;\r\n                }\r\n\r\n                // window.ng_draf( function() {\r\n                  switch( att.cssKind ) {\r\n                    case 'transform':\r\n                      att.item.CSSTransformSet(att.effect.element, att.effect.type, att.animeTo);\r\n                      att.item.CSSTransformApply(att.effect.element);\r\n                      break;\r\n                    case 'filter':\r\n                      att.item.CSSFilterSet(att.effect.element, att.effect.type, att.animeTo);\r\n                      att.item.CSSFilterApply(att.effect.element);\r\n                      break;\r\n                    default:\r\n                      att.item.$getElt(att.effect.element).css(att.effect.type, att.animeTo);\r\n                      break;\r\n                  }\r\n                // });\r\n              }\r\n            });\r\n          };\r\n\r\n          return NGY2Item;\r\n        })();    \r\n          \r\n      }\r\n\r\n      _this.options = jQuery.extend(true, {}, jQuery.nanogallery2.defaultOptions, options);\r\n      // Initialization code\r\n      _this.nG2 = null;\r\n      _this.nG2 = new nanoGALLERY2();\r\n      _this.nG2.initiateGallery2(_this.e, _this.options );\r\n\r\n    };\r\n      \r\n    // PUBLIC EXPOSED METHODS\r\n    _this.test = function() {\r\n      //alert('test');\r\n      // console.dir(_this.nG.G.I.length);\r\n      // console.dir(_this.nG);\r\n      //privateTest();\r\n    }\r\n\r\n    \r\n    // Run initializer\r\n    _this.init();\r\n  };\r\n \r\n  jQuery.nanogallery2.defaultOptions = {\r\n    kind :                        '',\r\n    userID :                      '',\r\n    photoset :                    '',\r\n    album:                        '',\r\n    blackList :                   'scrapbook|profil|auto backup',\n    whiteList :                   '',\n    albumList :                   '',\r\n    albumList2 :                  null,\r\n    RTL :                         false,\r\n    poogleplusUseUrlCrossDomain : true,\r\n    flickrSkipOriginal :          true,\r\n    breadcrumbAutoHideTopLevel :  true,\r\n    displayBreadcrumb :           true,\r\n    breadcrumbOnlyCurrentLevel :  true,\r\n    breadcrumbHideIcons :         true,\r\n    theme :                       'nGY2',\r\n    galleryTheme :                'dark',\n    viewerTheme :                 'dark',\r\n    items :                       null,\r\n    itemsBaseURL :                '',\r\n    thumbnailSelectable :         false,\r\n    dataProvider:                 '',\r\n    dataCharset:                  'Latin',\r\n    allowHTMLinData:              false,\n    locationHash :                true,\n    slideshowDelay :              3000,\n    slideshowAutoStart :          false,\n\n    debugMode:                    false,\n\r\n    galleryDisplayMoreStep :      2,\r\n    galleryDisplayMode :          'fullContent',\r\n    galleryL1DisplayMode :        null,\r\n    galleryPaginationMode :       'rectangles',   // 'dots', 'rectangles', 'numbers'\r\n    // galleryThumbnailsDisplayDelay : 2000,\r\n    galleryMaxRows :              2,\r\n    galleryL1MaxRows :            null,\r\n    galleryLastRowFull:           false,\r\n    galleryLayoutEngine :         'default',\r\n    paginationSwipe:              true,\r\n    paginationVisiblePages :      10,\r\n    // paginationSwipeSensibilityVert : 10,\r\n    galleryFilterTags :           false,    // possible values: false, true, 'title', 'description'\r\n    galleryL1FilterTags :         null,     // possible values: false, true, 'title', 'description'\r\n    galleryMaxItems :             0,        // maximum number of items per album  --> only flickr, google2, nano_photos_provider2\r\n    galleryL1MaxItems :           null,     // maximum number of items per gallery page --> only flickr, google2, nano_photos_provider2\r\n    gallerySorting :              '',\r\n    galleryL1Sorting :            null,\r\n    galleryDisplayTransition :    'none',\r\n    galleryL1DisplayTransition :  null,\r\n    galleryDisplayTransitionDuration :    1000,\r\n    galleryL1DisplayTransitionDuration :  null,\r\n    galleryResizeAnimation :      true,\n    galleryRenderDelay :          60,\n\n    thumbnailCrop :               true,\r\n    thumbnailL1Crop :             null,\n    thumbnailCropScaleFactor :    1.5,\n    thumbnailLevelUp :            false,\n    thumbnailAlignment :          'fillWidth',\n    thumbnailWidth :              300,\r\n    thumbnailL1Width :            null,\n    thumbnailHeight :             200,\r\n    thumbnailL1Height :           null,\r\n    thumbnailBaseGridHeight :     0,\r\n    thumbnailL1BaseGridHeight :   null,\n    thumbnailGutterWidth :        2,\r\n    thumbnailL1GutterWidth :      null,\n    thumbnailGutterHeight :       2,\r\n    thumbnailL1GutterHeight :     null,\n    thumbnailBorderVertical :     2,\n    thumbnailBorderHorizontal :   2,\n    thumbnailFeaturedKeyword :    '*featured',\n    thumbnailAlbumDisplayImage :  false,\n    thumbnailHoverEffect2 :       'toolsAppear',\n    thumbnailBuildInit2 :         '',\r\n    thumbnailStacks :             0,\r\n    thumbnailL1Stacks :           null,\r\n    thumbnailStacksTranslateX :   0,\r\n    thumbnailL1StacksTranslateX : null,\r\n    thumbnailStacksTranslateY :   0,\r\n    thumbnailL1StacksTranslateY : null,\r\n    thumbnailStacksTranslateZ :   0,\r\n    thumbnailL1StacksTranslateZ : null,\r\n    thumbnailStacksRotateX :      0,\r\n    thumbnailL1StacksRotateX :    null,\r\n    thumbnailStacksRotateY :      0,\r\n    thumbnailL1StacksRotateY :    null,\r\n    thumbnailStacksRotateZ :      0,\r\n    thumbnailL1StacksRotateZ :    null,\r\n    thumbnailStacksScale :        0,\r\n    thumbnailL1StacksScale :      null,\r\n    thumbnailDisplayOutsideScreen: true,\r\n    thumbnailWaitImageLoaded:     true,\r\n    thumbnailSliderDelay:         2000,\r\n    galleryBuildInit2 :           '',\r\n    portable :                    false,\r\n    eventsDebounceDelay:          30,\n    \n    touchAnimation :              true,\r\n    touchAnimationL1 :            undefined,\n    touchAutoOpenDelay :          0,\n\n    thumbnailLabel : {\n      position :                  'overImageOnBottom',\n      align:                      'center',\n      display :                   true,\n      displayDescription :        false,\n      titleMaxLength :            0,\r\n      titleMultiLine :            false,\n      descriptionMaxLength :      0,\r\n      descriptionMultiLine :      false,\n      hideIcons :                 true,\n      title :                     ''\n    },\n\n    thumbnailToolbarImage :       { topLeft: 'select', topRight : 'featured' },\n    thumbnailToolbarAlbum :       { topLeft: 'select', topRight : 'counter'  },\n    thumbnailDisplayInterval :    15,\r\n    thumbnailL1DisplayInterval :  null,\n    thumbnailDisplayTransition :  'fadeIn',\r\n    thumbnailL1DisplayTransition : null,\n    thumbnailDisplayTransitionDuration:   240,\r\n    thumbnailL1DisplayTransitionDuration: null,\n    thumbnailOpenImage :          true,\r\n    thumbnailOpenOriginal :       false,\n    thumbnailGlobalImageTitle :   '',\n    thumbnailGlobalAlbumTitle :   '',\n    \n    viewer :                      'internal',\r\n    viewerFullscreen:             false,\r\n    viewerDisplayLogo :           false,\r\n    imageTransition :             'swipe2',\r\n    viewerTransitionMediaKind :   'img',\r\n    viewerZoom :                  true,\r\n    viewerImageDisplay :          '',\r\n    openOnStart :                 '',\r\n    viewerHideToolsDelay :        3000,\r\n    viewerToolbar : {\r\n      display :                   true,\r\n      position :                  'bottomOverImage',\r\n      fullWidth :                 true,\r\n      align :                     'center',\r\n      autoMinimize :              0,\r\n      standard :                  'minimizeButton,label',\r\n      minimized :                 'minimizeButton,label,infoButton,shareButton,downloadButton,linkOriginalButton,fullscreenButton'\r\n    },\r\n    viewerTools : {\r\n      topLeft :                   'pageCounter,playPauseButton',\r\n      topRight :                  'rotateLeft,rotateRight,fullscreenButton,closeButton' \r\n    },\r\n    \r\n    breakpointSizeSM :            480,\n    breakpointSizeME :            992,\n    breakpointSizeLA :            1200,\n    breakpointSizeXL :            1800,\r\n    \n    fnThumbnailInit :             null,\n    fnThumbnailHoverInit :        null,\n    fnThumbnailHover :            null,\n    fnThumbnailHoverOut :         null,\n    fnThumbnailDisplayEffect :    null,\r\n    fnViewerInfo :                null,\r\n    fnImgToolbarCustInit :        null,\n    fnImgToolbarCustDisplay :     null,\n    fnImgToolbarCustClick :       null,\r\n    fnProcessData :               null,\r\n    fnThumbnailSelection :        null,\r\n    fnGalleryRenderStart :        null,\r\n    fnGalleryRenderEnd :          null,\r\n    fnGalleryObjectModelBuilt :   null,\r\n    fnGalleryLayoutApplied :      null,\r\n    fnThumbnailClicked :          null,\n    fnShoppingCartUpdated :       null,\n    fnThumbnailToolCustAction :   null,\n    fnThumbnailOpen :             null,\n    fnImgDisplayed :              null,\n\n    i18n : {\r\n      'breadcrumbHome' : 'Galleries', 'breadcrumbHome_FR' : 'Galeries',\r\n      'thumbnailImageTitle' : '', 'thumbnailAlbumTitle' : '',\r\n      'thumbnailImageDescription' : '', 'thumbnailAlbumDescription' : '',\r\n      'infoBoxPhoto' : 'Photo', 'infoBoxDate' : 'Date', 'infoBoxAlbum' : 'Album', 'infoBoxDimensions' : 'Dimensions', 'infoBoxFilename' : 'Filename', 'infoBoxFileSize' : 'File size', 'infoBoxCamera' : 'Camera', 'infoBoxFocalLength' : 'Focal length', 'infoBoxExposure' : 'Exposure', 'infoBoxFNumber' : 'F Number', 'infoBoxISO' : 'ISO', 'infoBoxMake' : 'Make', 'infoBoxFlash' : 'Flash', 'infoBoxViews' : 'Views', 'infoBoxComments' : 'Comments'\r\n    },\r\n    icons : {\r\n      // sample for font awesome: <i style=\"color:#eee;\" class=\"fa fa-search-plus\"></i>\r\n      thumbnailAlbum:               '<i class=\"nGY2Icon-folder-empty\"></i>',\r\n      thumbnailImage:               '<i class=\"nGY2Icon-picture\"></i>',\r\n      breadcrumbAlbum:              '<i class=\"nGY2Icon-folder-empty\"></i>',\r\n      breadcrumbHome:               '<i class=\"nGY2Icon-home\"></i>',\r\n      breadcrumbSeparator:          '<i class=\"nGY2Icon-left-open\"></i>',\r\n      breadcrumbSeparatorRtl:       '<i class=\"nGY2Icon-right-open\"></i>',\r\n      navigationFilterSelected:     '<i style=\"color:#fff;\" class=\"nGY2Icon-toggle-on\"></i>',\r\n      navigationFilterUnselected:   '<i style=\"color:#ddd;\" class=\"nGY2Icon-toggle-off\"></i>',\r\n      navigationFilterSelectedAll:  '<i class=\"nGY2Icon-toggle-on\"></i><i class=\"nGY2Icon-ok\"></i>',\r\n      thumbnailSelected:            '<i style=\"color:#bff;\" class=\"nGY2Icon-ok-circled\"></i>',\r\n      thumbnailUnselected:          '<i style=\"color:#bff;\" class=\"nGY2Icon-circle-empty\"></i>',\r\n      thumbnailFeatured:            '<i style=\"color:#dd5;\" class=\"nGY2Icon-star\"></i>',\r\n      thumbnailCounter:             '<i class=\"nGY2Icon-picture\"></i>',\r\n      thumbnailShare:               '<i class=\"nGY2Icon-ngy2_share2\"></i>',\r\n      thumbnailDownload:            '<i class=\"nGY2Icon-ngy2_download2\"></i>',\r\n      thumbnailInfo:                '<i class=\"nGY2Icon-ngy2_info2\"></i>',\r\n      thumbnailCart:                '<i class=\"nGY2Icon-basket\"></i>',\r\n      thumbnailDisplay:             '<i class=\"nGY2Icon-ngy2_zoom_in2\"></i>',\r\n      thumbnailCustomTool1:         'T1',\r\n      thumbnailCustomTool2:         'T2',\r\n      thumbnailCustomTool3:         'T3',\r\n      thumbnailCustomTool4:         'T4',\r\n      thumbnailCustomTool5:         'T5',\r\n      thumbnailCustomTool6:         'T6',\r\n      thumbnailCustomTool7:         'T7',\r\n      thumbnailCustomTool8:         'T8',\r\n      thumbnailCustomTool9:         'T9',\r\n      thumbnailCustomTool10:        'T10',\r\n      thumbnailAlbumUp:             '<i style=\"font-size: 3em;\" class=\"nGY2Icon-ngy2_chevron_up2\"></i>',\r\n      paginationNext:               '<i class=\"nGY2Icon-right-open\"></i>',\r\n      paginationPrevious:           '<i class=\"nGY2Icon-left-open\"></i>',\n      galleryMoreButton:            '<i class=\"nGY2Icon-picture\"></i> &nbsp; <i class=\"nGY2Icon-right-open\"></i>',\r\n      buttonClose:                  '<i class=\"nGY2Icon-ngy2_close2\"></i>',\r\n      viewerPrevious:               '<i class=\"nGY2Icon-ngy2_chevron-left\"></i>',\r\n      viewerNext:                   '<i class=\"nGY2Icon-ngy2_chevron-right\"></i>',\r\n      viewerImgPrevious:            '<i class=\"nGY2Icon-ngy2_chevron_left3\"></i>',\r\n      viewerImgNext:                '<i class=\"nGY2Icon-ngy2_chevron_right3\"></i>',\r\n      viewerDownload:               '<i class=\"nGY2Icon-ngy2_download2\"></i>',\r\n      viewerToolbarMin:             '<i class=\"nGY2Icon-ellipsis-vert\"></i>',\r\n      viewerToolbarStd:             '<i class=\"nGY2Icon-menu\"></i>',\r\n      viewerPlay:                   '<i class=\"nGY2Icon-play\"></i>',\r\n      viewerPause:                  '<i class=\"nGY2Icon-pause\"></i>',\r\n      viewerFullscreenOn:           '<i class=\"nGY2Icon-resize-full\"></i>',\r\n      viewerFullscreenOff:          '<i class=\"nGY2Icon-resize-small\"></i>',\r\n      viewerZoomIn:                 '<i class=\"nGY2Icon-ngy2_zoom_in2\"></i>',\r\n      viewerZoomOut:                '<i class=\"nGY2Icon-ngy2_zoom_out2\"></i>',\r\n      viewerLinkOriginal:           '<i class=\"nGY2Icon-ngy2_external2\"></i>',\r\n      viewerInfo:                   '<i class=\"nGY2Icon-ngy2_info2\"></i>',\r\n      viewerShare:                  '<i class=\"nGY2Icon-ngy2_share2\"></i>',\n      viewerRotateLeft:             '<i class=\"nGY2Icon-ccw\"></i>',\n      viewerRotateRight:            '<i class=\"nGY2Icon-cw\"></i>',\r\n      user:                         '<i class=\"nGY2Icon-user\"></i>',\r\n      location:                     '<i class=\"nGY2Icon-location\"></i>',\r\n      config:                       '<i class=\"nGY2Icon-wrench\"></i>',\r\n      shareFacebook:                '<i style=\"color:#3b5998;\" class=\"nGY2Icon-facebook-squared\"></i>',\r\n      shareTwitter:                 '<i style=\"color:#00aced;\" class=\"nGY2Icon-twitter-squared\"></i>',\r\n      // shareGooglePlus:              '<i style=\"color:#dd4b39;\" class=\"nGY2Icon-gplus-squared\"></i>',\r\n      shareTumblr:                  '<i style=\"color:#32506d;\" class=\"nGY2Icon-tumblr-squared\"></i>',\r\n      sharePinterest:               '<i style=\"color:#cb2027;\" class=\"nGY2Icon-pinterest-squared\"></i>',\r\n      shareVK:                      '<i style=\"color:#3b5998;\" class=\"nGY2Icon-vkontakte\"></i>',\r\n      shareMail:                    '<i style=\"color:#555;\" class=\"nGY2Icon-mail-alt\"></i>',\r\n      viewerCustomTool1:            'T1',\r\n      viewerCustomTool2:            'T2',\r\n      viewerCustomTool3:            'T3',\r\n      viewerCustomTool4:            'T4',\r\n      viewerCustomTool5:            'T5',\r\n      viewerCustomTool6:            'T6',\r\n      viewerCustomTool7:            'T7',\r\n      viewerCustomTool8:            'T8',\r\n      viewerCustomTool9:            'T9',\r\n      viewerCustomTool10:           'T10'\r\n    }\r\n  };\r\n\r\n  jQuery.fn.nanogallery2 = function (args, option, value) {\r\n    \r\n    if( typeof jQuery(this).data('nanogallery2data') === 'undefined'){\r\n      if( args == 'destroy' ) {\r\n        // command to destroy but no instance yet --> exit\r\n        return;\r\n      }\r\n      \r\n      return this.each( function(){\r\n        (new jQuery.nanogallery2(this, args));\r\n      });\r\n    }\r\n    else {\r\n      // no options -->\r\n      // This function breaks the chain, but provides some API methods\r\n\r\n      var nG2=$(this).data('nanogallery2data').nG2;\r\n      switch(args){\r\n        case 'displayItem':\r\n          nG2.DisplayItem(option);\r\n          break;\r\n          \r\n        case 'search':\r\n          return( nG2.Search(option));\r\n          break;\r\n          \r\n        case 'search2':\r\n          return nG2.Search2(option, value);\r\n          break;\r\n          \r\n        case 'search2Execute':\r\n          return nG2.Search2Execute();\r\n          break;\r\n          \r\n        case 'refresh':\r\n          nG2.Refresh();\r\n          break;\r\n\r\n        case 'resize':\r\n          nG2.Resize();\r\n          break;\r\n          \r\n        case 'instance':\r\n          return nG2;\r\n          break;\r\n          \r\n        case 'data':\r\n          nG2.data= {\r\n            items: nG2.I,\r\n            gallery: nG2.GOM,\r\n            lightbox: nG2.VOM\r\n          };\r\n          return nG2.data;\r\n          break;\r\n          \r\n        case 'reload':\r\n          nG2.ReloadAlbum();\r\n          return $(this);\r\n          break;\r\n          \r\n        case 'itemsSelectedGet':\r\n          return nG2.ItemsSelectedGet();\r\n          break;\r\n          \r\n        case 'itemsSetSelectedValue':\r\n          nG2.ItemsSetSelectedValue(option, value);\r\n          break;\r\n          \r\n        case 'option':\r\n          if(typeof value === 'undefined'){\r\n            return nG2.Get(option);\r\n          }else{\r\n            nG2.Set(option,value);\r\n            if( option == 'demoViewportWidth' ) {\r\n              // force resize event -> for demo purposes\r\n              $(window).trigger('resize');\r\n            }\r\n          }\r\n          break;\r\n          \r\n        case 'destroy':\r\n          nG2.Destroy();\r\n          $(this).removeData('nanogallery2data');\r\n          break;\r\n          \r\n        case 'shoppingCartGet':\r\n          return nG2.shoppingCart;\r\n          break;\r\n          \r\n        case 'shoppingCartUpdate':\r\n          if( typeof value === 'undefined' || typeof option === 'undefined' ){\r\n            return false;\r\n          }\r\n          var ID = option;\r\n          var cnt = value;\r\n          for( var i = 0; i < nG2.shoppingCart.length; i++) {\r\n            if( nG2.shoppingCart[i].ID = ID ) {\r\n              nG2.shoppingCart[i].cnt = cnt;\r\n            }\r\n          }\r\n          var fu = G.O.fnShoppingCartUpdated;\r\n          if( fu !== null ) {\r\n            typeof  fu == 'function' ? fu(nG2.shoppingCart, NGY2Item.Get(G, ID)) : window[fu](nG2.shoppingCart, NGY2Item.Get(G, ID));\r\n          }\r\n          return nG2.shoppingCart;\r\n          break;\r\n          \r\n        case 'shoppingCartRemove':\r\n          if( typeof option === 'undefined' ){\r\n            return false;\r\n          }\r\n          var ID=option;\r\n          for( var i=0; i<nG2.shoppingCart.length; i++) {\r\n            if( nG2.shoppingCart[i].ID=ID ) {\r\n              nG2.shoppingCart.splice(i,1);\r\n              break;\r\n            }\r\n          }\r\n          var fu = G.O.fnShoppingCartUpdated;\r\n          if( fu !== null ) {\r\n            typeof fu == 'function' ? fu(nG2.shoppingCart, NGY2Item.Get(G, ID)) : window[fu](nG2.shoppingCart, NGY2Item.Get(G, ID));\r\n          }\r\n          return nG2.shoppingCart;\r\n          break;\r\n         \r\n        case 'closeViewer':\r\n          nG2.CloseViewer();\r\n          break;\r\n        case 'minimizeToolbar':\r\n          nG2.MinimizeToolbar();\r\n          break;\r\n        case 'maximizeToolbar':\r\n          nG2.MaximizeToolbar();\r\n          break;\r\n        case 'paginationPreviousPage':\r\n          nG2.PaginationPreviousPage();\r\n          break;\r\n        case 'paginationNextPage':\r\n          nG2.paginationNextPage();\r\n          break;\r\n        case 'paginationGotoPage':\r\n          nG2.PaginationGotoPage( option );\r\n          break;\r\n        case 'paginationCountPages':\r\n          nG2.PaginationCountPages();\r\n          break;\r\n         \r\n      }\r\n      return $(this);\r\n\r\n    }\r\n  };\r\n  \r\n\r\n  // ###############################\r\n  // ##### nanogallery2 script #####\r\n  // ###############################\r\n\r\n  /** @function nanoGALLERY2 */\r\n  function nanoGALLERY2() {\r\n    \"use strict\";\r\n\r\n    /**\r\n    * Force reload the current album, if provided by Json\r\n    */\r\n    this.ReloadAlbum = function(){\r\n      if( G.O.kind === '' ) {\r\n        throw 'Not supported for this content source:' + G.O.kind;\r\n      }\r\n\r\n      var albumIdx = G.GOM.albumIdx;\r\n      if( albumIdx == -1 ) {\r\n        throw ('Current album not found.');\r\n      }\r\n      \r\n      var albumID = G.I[albumIdx].GetID();\r\n\r\n      // unselect everything & remove link to album (=logical delete)\r\n      var l = G.I.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        var item = G.I[i];\r\n        if( item.albumID == albumID ) {\r\n          item.selected = false;\r\n        }\r\n      }\r\n      \r\n      G.I[albumIdx].contentIsLoaded = false;\r\n      \r\n      DisplayAlbum('-1', albumID);\r\n    };\r\n    \r\n    /**\r\n     * Set one or several items selected/unselected\r\n     * @param {array} items\r\n     */\r\n    this.ItemsSetSelectedValue = function(items, value){\r\n      var l = items.length;\r\n      for( var j = 0; j < l ; j++) {\r\n        ThumbnailSelectionSet(items[j], value);\r\n      }\r\n    };\r\n    \r\n    /**\r\n     * Returns an array of selected items\r\n     * @returns {Array}\r\n     */\r\n    this.ItemsSelectedGet = function(){\r\n      var selectedItems = [];\r\n      var l = G.I.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        if( G.I[i].selected == true ) {\r\n          selectedItems.push(G.I[i]);\r\n        }\r\n      }\r\n      return selectedItems;\r\n    };    \r\n    \r\n    /**\r\n     * Returns the value of an option\r\n     * @param {string} option\r\n     * @returns {nanoGALLERY.G.O}\r\n     */\r\n    this.Get = function(option){\r\n        return G.O[option];\r\n    };\r\n\r\n    /**\r\n     * Set a new value for a defined option\r\n     * @param {string} option\r\n     */\r\n    this.Set = function(option, value){\r\n        G.O[option] = value;\r\n        switch( option ) {\r\n          case 'thumbnailSelectable':\r\n            ThumbnailSelectionClear();\r\n            // refresh the displayed gallery\r\n            GalleryRender( G.GOM.albumIdx );\r\n            break;\r\n        }\r\n    };\r\n    \r\n    /**\r\n     * refresh the current gallery\r\n     */\r\n    this.Refresh = function() {\r\n      // refresh the displayed gallery\r\n      GalleryRender( G.GOM.albumIdx );\r\n    };\r\n    /**\r\n     * resize the current gallery\r\n     */\r\n    this.Resize = function() {\r\n      // resize the displayed gallery\r\n      GalleryResize();\r\n    };\r\n\r\n    /**\r\n     * display one item (image or gallery)\r\n     *   itemID syntax:\r\n     *    - albumID --> display one album\r\n     *    - albumID/imageID --> display one image\r\n    */\r\n    this.DisplayItem = function( itemID ) {\r\n      var IDs=parseIDs( itemID );\r\n      if( IDs.imageID != '0' ) {\r\n        DisplayPhoto( IDs.imageID, IDs.albumID );\r\n      }\r\n      else {\r\n        DisplayAlbum( '-1', IDs.albumID );\r\n      }\r\n    };\r\n    \r\n      \r\n      \r\n    var CountItemsToDisplay = function( gIdx ) {\r\n      if( G.I[gIdx] == undefined ) { return 0; }\r\n      var albumID = G.I[gIdx].GetID();\r\n      var l = G.I.length;\r\n      var cnt = 0;\r\n      for( var idx = 0; idx < l; idx++ ) {\r\n        var item = G.I[idx];\r\n        if( item.isToDisplay(albumID) ) {\r\n          cnt++;\r\n        }\r\n      }\r\n      return cnt;\r\n    } \r\n    /**\r\n     * Search in the displayed gallery (in thumbnails title)\r\n     */\r\n    this.Search = function( search ) {\r\n      G.GOM.albumSearch = search.toUpperCase();\r\n      var gIdx = G.GOM.albumIdx;\r\n      GalleryRender( G.GOM.albumIdx );\r\n      return CountItemsToDisplay( gIdx );\r\n    };\r\n\r\n    /**\r\n     * Search2 in title and tags - set search values\r\n     */\r\n    this.Search2 = function( searchTitle, searchTags ) {\r\n      if( searchTitle != null && searchTitle != undefined ) {\r\n        G.GOM.albumSearch = searchTitle.toUpperCase();\r\n      }\r\n      else {\r\n        G.GOM.albumSearch = '';\r\n      }\r\n      \r\n      if( searchTags != null && searchTags != undefined ) {\r\n        G.GOM.albumSearchTags = searchTags.toUpperCase();\r\n      }\r\n      else {\r\n        G.GOM.albumSearchTags = '';\r\n      }\r\n      return CountItemsToDisplay( G.GOM.albumIdx );\r\n    };\r\n    \r\n    /**\r\n     * Search2 - execute the search on title and tags\r\n     */\r\n    this.Search2Execute = function() {\r\n      var gIdx = G.GOM.albumIdx;\r\n      GalleryRender( G.GOM.albumIdx );\r\n      return CountItemsToDisplay( gIdx );\r\n    };\r\n    \r\n    \r\n    /**\r\n     * Destroy the current gallery\r\n     */\r\n    this.Destroy = function(){\r\n      // alert('destroy');\r\n      // var event = new Event('build');\r\n      if( G.GOM.hammertime != null ) {\r\n        G.GOM.hammertime.destroy();\r\n        G.GOM.hammertime = null;\r\n      }\r\n      // G.GOM.userEvents.RemoveEvtListener();\r\n      // G.GOM.userEvents=null;\r\n      // G.VOM.userEvents.RemoveEvtListener();\r\n      // G.VOM.userEvents=null;\r\n      if( G.VOM.hammertime != null ) {\r\n        G.VOM.hammertime.destroy();\r\n        G.VOM.hammertime = null;\r\n      }\r\n      //ThumbnailHoverReInitAll();  \r\n      \r\n      // color scheme\r\n      $('#ngycs_' + G.baseEltID).remove()\r\n      \r\n      G.GOM.items = [];\r\n      NGY2Item.New( G, G.i18nTranslations.breadcrumbHome, '', '0', '-1', 'album' );\r\n      G.GOM.navigationBar.$newContent = null;\r\n      G.$E.base.empty();\r\n      G.$E.base.removeData();\r\n      if( G.O.locationHash ) {\r\n        jQuery(window).off('hashchange.nanogallery2.' + G.baseEltID);\r\n      }\r\n      jQuery(window).off('resize.nanogallery2.' + G.baseEltID);\r\n      jQuery(window).off('orientationChange.nanogallery2.' + G.baseEltID);\r\n      jQuery(window).off('scroll.nanogallery2.' + G.baseEltID);\r\n      G.GOM.firstDisplay = false;\n    };\r\n    \r\n    /**\r\n     * CloseViewer - close the media viewer\r\n     */\r\n    this.CloseViewer = function() {\r\n      CloseInternalViewer(null);\r\n      return false;\r\n    };\r\n    \r\n    /**\r\n     * MinimizeToolbar - display the minimized lightbox main toolbar\r\n     */\r\n    this.MinimizeToolbar = function() {\r\n      ViewerToolbarForVisibilityMin();\r\n      return false;\r\n    };\r\n    \r\n    /**\r\n     * MaximizeToolbar - display the maximized/standard lightbox main toolbar\r\n     */\r\n    this.MaximizeToolbar = function() {\r\n      ViewerToolbarForVisibilityStd();\r\n      return false;\r\n    };\r\n    \r\n    /**\r\n     * PaginationPreviousPage - gallery paginate to previous page\r\n     */\r\n    this.PaginationPreviousPage = function() {\r\n      paginationPreviousPage();\r\n      return false;\r\n    };\r\n    \r\n    \r\n    /**\r\n     * PaginationNextPage - gallery paginate to next page\r\n     */\r\n    this.PaginationNextPage = function() {\r\n      paginationNextPage();\r\n      return false;\r\n    };\r\n    \r\n    \r\n    /**\r\n     * PaginationGotoPage - gallery paginate to specific page\r\n     */\r\n    this.PaginationGotoPage = function( page ) {\r\n      var aIdx = G.$E.conPagin.data('galleryIdx');\r\n      if( page > 1 ) { page--; }\r\n      G.GOM.pagination.currentPage = page;\r\n\r\n      // scroll to top of gallery if not displayed\r\n      if( !inViewportVert(G.$E.base, 0) ) {\r\n        $('html, body').animate({scrollTop: G.$E.base.offset().top}, 200);\r\n      }\r\n      GalleryDisplayPart1( true );\r\n      GalleryDisplayPart2( true );\r\n      return false;\r\n    };\r\n\r\n    /**\r\n     * PaginationCountPages - gallery pagination - returns the number of pages\r\n     */\r\n    this.PaginationCountPages = function() {\r\n      if( G.GOM.items.length == 0 ) { return 0; }   // no thumbnail to display\r\n\r\n      var nbPages = Math.ceil((G.GOM.items[G.GOM.items.length - 1].row + 1) / G.galleryMaxRows.Get());\r\n      return nbPages;\r\n    };\r\n    \r\n    \r\n    \r\n    \r\n    // throttle()\r\n    // author: underscore.js - http://underscorejs.org/docs/underscore.html\r\n    // Returns a function, that, when invoked, will only be triggered at most once during a given window of time.\r\n    // Normally, the throttled function will run as much as it can, without ever going more than once per wait duration;\r\n    // but if you�d like to disable the execution on the leading edge, pass {leading: false}.\r\n    // To disable execution on the trailing edge, ditto.\r\n    var throttle = function(func, wait, options) {\r\n      var context, args, result;\r\n      var timeout = null;\r\n      var previous = 0;\r\n      if (!options) options = {};\r\n      var later = function() {\r\n        previous = options.leading === false ? 0 : new Date().getTime();\r\n        timeout = null;\r\n        result = func.apply(context, args);\r\n        if (!timeout) context = args = null;\r\n      };\r\n      return function() {\r\n        var now = new Date().getTime();\r\n        if (!previous && options.leading === false) previous = now;\r\n        var remaining = wait - (now - previous);\r\n        context = this;\r\n        args = arguments;\r\n        if (remaining <= 0 || remaining > wait) {\r\n          if (timeout) {\r\n            clearTimeout(timeout);\r\n            timeout = null;\r\n          }\r\n          previous = now;\r\n          result = func.apply(context, args);\r\n          if (!timeout) context = args = null;\r\n        } else if (!timeout && options.trailing !== false) {\r\n          timeout = setTimeout(later, remaining);\r\n        }\r\n        return result;\r\n      };\r\n    };\r\n    \r\n    \r\n    // DEBOUNCE\r\n    // author: John Hann - http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\r\n    // execAsap - false means executing at the end of the detection period\r\n    var debounce = function (func, threshold, execAsap) {\r\n      var timeout;\r\n      return function debounced () {\r\n          var obj = this, args = arguments;\r\n          function delayed () {\r\n              if (!execAsap)\r\n                  func.apply(obj, args);\r\n              timeout = null; \r\n          };\r\n   \r\n          if (timeout)\r\n              clearTimeout(timeout);\r\n              // clearRequestTimeout(timeout);\r\n          else if (execAsap)\r\n              func.apply(obj, args);\r\n          timeout = setTimeout(delayed, threshold || 100); \r\n          // timeout = requestTimeout(delayed, threshold || 100); \r\n      };\r\n    }\r\n    \r\n\r\n    // Double requestAnimationFrame\r\n    window.ng_draf = function (cb) {\r\n      return requestAnimationFrame(function() {\r\n        window.requestAnimationFrame(cb)\r\n      })\r\n    }    \r\n    \r\n    // REQUESTTIMEOUT - replace SETTIMEOUT - https://gist.github.com/joelambert/1002116\r\n    /**\r\n     * Behaves the same as setTimeout except uses requestAnimationFrame() where possible for better performance\r\n     * @param {function} fn The callback function\r\n     * @param {int} delay The delay in milliseconds\r\n     */\r\n\r\n    window.requestTimeout = function(fn, delay) {\r\n      // if( !window.requestAnimationFrame      \t&& \r\n        // !window.webkitRequestAnimationFrame && \r\n        // !(window.mozRequestAnimationFrame && window.mozCancelRequestAnimationFrame) && // Firefox 5 ships without cancel support\r\n        // !window.oRequestAnimationFrame      && \r\n        // !window.msRequestAnimationFrame)\r\n          return window.setTimeout(fn, delay);\r\n          \r\n      var start = new Date().getTime(),\r\n        handle = new Object();\r\n        \r\n      function loop(){\r\n        var current = new Date().getTime(),\r\n          delta = current - start;\r\n  delta = delay;\r\n  \r\n        delta >= delay ? fn.call() : handle.value = requestAnimFrame(loop);\r\n      };\r\n      \r\n      handle.value = requestAnimFrame(loop);\r\n      return handle;\r\n    };\r\n\r\n    \r\n    // requestAnimationFrame() shim by Paul Irish\r\n    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n    window.requestAnimFrame = (function() {\r\n      return  window.requestAnimationFrame       || \r\n          window.webkitRequestAnimationFrame || \r\n          window.mozRequestAnimationFrame    || \r\n          window.oRequestAnimationFrame      || \r\n          window.msRequestAnimationFrame     || \r\n          function(/* function */ callback, /* DOMElement */ element){\r\n            window.setTimeout(callback, 1000 / 60);\r\n          };\r\n    })();    \r\n    \r\n    \r\n    // CLEARREQUESTTIMEOUT - to replace CLEARTIMEOUT - https://gist.github.com/joelambert/1002116\r\n    /**\r\n     * Behaves the same as clearTimeout except uses cancelRequestAnimationFrame() where possible for better performance\r\n     * @param {int|object} fn The callback function\r\n     */\r\n    window.clearRequestTimeout = function(handle) {\r\n        window.cancelAnimationFrame ? window.cancelAnimationFrame(handle.value) :\r\n        window.webkitCancelAnimationFrame ? window.webkitCancelAnimationFrame(handle.value) :\r\n        window.webkitCancelRequestAnimationFrame ? window.webkitCancelRequestAnimationFrame(handle.value) : /* Support for legacy API */\r\n        window.mozCancelRequestAnimationFrame ? window.mozCancelRequestAnimationFrame(handle.value) :\r\n        window.oCancelRequestAnimationFrame\t? window.oCancelRequestAnimationFrame(handle.value) :\r\n        window.msCancelRequestAnimationFrame ? window.msCancelRequestAnimationFrame(handle.value) :\r\n        clearTimeout(handle);\r\n    };    \r\n    \r\n    \r\n    \r\n    /*\r\n    ** Global data for this nanogallery2 instance\r\n    **/\r\n    var G=this;\r\n    G.I =                       [];           // gallery items\r\n    G.Id =                      [];           // gallery items\r\n    G.O =                       null;         // user options\r\n    G.baseEltID =               null;         // ID of the base element\r\n    G.$E = { \r\n      base:                     null,         // base element\r\n      conTnParent:              null,         // $g_containerThumbnailsParent\r\n      conLoadingB:              null,         // loading bar - nanoGalleryLBarOff\r\n      conConsole:               null,         // console for error messages\r\n      conNavigationBar:         null,         // gallery navigation bar\r\n      conTnBottom:              null         // container on the bottom of the gallery\r\n    };\r\n    G.shoppingCart =            [];\r\n    G.layout = {                              // Layout informations\r\n      internal :                true,\r\n      engine :                  '',\r\n      support :                 { rows: false },\r\n      prerequisite :            { imageSize: false },\r\n      SetEngine: function() {\r\n\r\n      if( G.layout.internal ) {\r\n          if( G.tn.settings.width[G.GOM.curNavLevel][G.GOM.curWidth] == 'auto' || G.tn.settings.width[G.GOM.curNavLevel][G.GOM.curWidth] == '' ) {\r\n            // do not use getH() / getW() here!\r\n            G.layout.engine = 'JUSTIFIED';\r\n            G.layout.support.rows = true;\r\n            G.layout.prerequisite.imageSize = true;\r\n            return;\r\n          }\r\n          if( G.tn.settings.height[G.GOM.curNavLevel][G.GOM.curWidth] == 'auto' || G.tn.settings.height[G.GOM.curNavLevel][G.GOM.curWidth] == '' ) {\r\n            // do not use getH() / getW() here!\r\n            G.layout.engine = 'CASCADING';\r\n            G.layout.support.rows = false;\r\n            G.layout.prerequisite.imageSize = true;\r\n            return;\r\n          }\r\n\r\n          if( G.tn.settings.getMosaic() != null ) {\r\n            G.layout.engine = 'MOSAIC';\r\n            G.layout.support.rows = true;\r\n            G.layout.prerequisite.imageSize = false;\r\n            return;\r\n          }\r\n          \r\n          G.layout.engine='GRID';\r\n          G.layout.support.rows=true;\r\n          // if( G.tn.opt.Get('crop') === true ) {\r\n            // G.layout.prerequisite.imageSize = true;\r\n          // }\r\n          // else {\r\n            G.layout.prerequisite.imageSize = false;\r\n          // }\r\n        }\r\n      }\r\n    };\r\n    G.galleryResizeEventEnabled = false;\r\n    G.galleryMaxRows = { l1: 0, lN: 0,\r\n      Get: function() {\r\n        return G.galleryMaxRows[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryMaxItems = { l1: 0, lN: 0,\r\n      Get: function() {\r\n        return G.galleryMaxItems[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryFilterTags = { l1: 0, lN: 0,\r\n      Get: function() {\r\n        return G.galleryFilterTags[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryDisplayMode = { l1: 'FULLCONTENT', lN: 'FULLCONTENT',\r\n      Get: function() {\r\n        return G.galleryDisplayMode[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryLastRowFull = { l1: false, lN: false,\r\n      Get: function() {\r\n        return G.galleryLastRowFull[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.gallerySorting = { l1: '', lN: '',\r\n      Get: function() {\r\n        return G.gallerySorting[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryDisplayTransition = { l1: 'none', lN: 'none',\r\n      Get: function() {\r\n        return G.galleryDisplayTransition[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.galleryDisplayTransitionDuration = { l1: 500, lN: 500,\r\n      Get: function() {\r\n        return G.galleryDisplayTransitionDuration[G.GOM.curNavLevel];\r\n      }\r\n    };\r\n    G.$currentTouchedThumbnail = null;    \r\n    \r\n    // ##### GENERAL THUMBNAILS PROPERTIES -->\r\n    G.tn = {\r\n      // levell specific options\r\n      opt:  {\r\n        l1: { crop: true, stacks: 0, stacksTranslateX: 0, stacksTranslateY: 0, stacksTranslateZ: 0, stacksRotateX: 0, stacksRotateY: 0, stacksRotateZ: 0, stacksScale: 0, gutterHeight: 0, gutterWidth: 0, baseGridHeight: 0, displayTransition: 'FADEIN', displayTransitionStartVal: 0, displayTransitionEasing: 'easeOutQuart', displayTransitionDuration: 240, displayInterval: 15 },\r\n        lN: { crop: true, stacks: 0, stacksTranslateX: 0, stacksTranslateY: 0, stacksTranslateZ: 0, stacksRotateX: 0, stacksRotateY: 0, stacksRotateZ: 0, stacksScale: 0, gutterHeight: 0, gutterWidth: 0, baseGridHeight: 0, displayTransition: 'FADEIN', displayTransitionStartVal: 0, displayTransitionEasing: 'easeOutQuart', displayTransitionDuration: 240, displayInterval: 15 },\r\n        Get: function(opt) {\r\n          return G.tn.opt[G.GOM.curNavLevel][opt];\r\n        }\r\n      },\r\n      scale:                          1,         // image scale depending of the hover effect\r\n      borderWidth:                    0,         // thumbnail container border width\r\n      borderHeight:                   0,         // thumbnail container border height\r\n      labelHeight: {                  // in case label on bottom, otherwise always=0\r\n        l1: 0, lN: 0,\r\n        get: function() {\r\n          return G.tn.labelHeight[G.GOM.curNavLevel];\r\n        }\r\n      },\r\n      defaultSize: {                  // default thumbnail size\r\n                                      // label height is not included\r\n        width: {  l1 : { xs:0, sm:0, me:0, la:0, xl:0 }, lN : { xs:0, sm:0, me:0, la:0, xl:0 } },\r\n        height: { l1 : { xs:0, sm:0, me:0, la:0, xl:0 }, lN : { xs:0, sm:0, me:0, la:0, xl:0 } },\r\n        getWidth: function() {\r\n          return G.tn.defaultSize.width[G.GOM.curNavLevel][G.GOM.curWidth];\r\n        },\r\n        getOuterWidth: function() {     // width border included\r\n          return G.tn.defaultSize.width[G.GOM.curNavLevel][G.GOM.curWidth]+G.tn.borderWidth*2;\r\n        },\r\n        getHeight: function() {\r\n          return G.tn.defaultSize.height[G.GOM.curNavLevel][G.GOM.curWidth];\r\n        },\r\n        getOuterHeight: function() {     // height, border included\r\n          return G.tn.defaultSize.height[G.GOM.curNavLevel][G.GOM.curWidth]+G.tn.borderHeight*2;\r\n        }\r\n      },\r\n      settings: {                     // user defined width/height of the image to display depending on the screen size\r\n        width: {  l1 : { xs:0, sm:0, me:0, la:0, xl:0, xsc:'u', smc:'u', mec:'u', lac:'u', xlc:'u' },\r\n                  lN : { xs:0, sm:0, me:0, la:0, xl:0, xsc:'u', smc:'u', mec:'u', lac:'u', xlc:'u' } },\r\n        height: { l1 : { xs:0, sm:0, me:0, la:0, xl:0, xsc:'u', smc:'u', mec:'u', lac:'u', xlc:'u' }, \r\n                  lN : { xs:0, sm:0, me:0, la:0, xl:0, xsc:'u', smc:'u', mec:'u', lac:'u', xlc:'u' } },\r\n        getH: function(l, w) {\r\n          var cl = (l == undefined ? G.GOM.curNavLevel : l);\r\n          var cw = (w == undefined ? G.GOM.curWidth : w);\r\n          if( G.layout.engine == 'MOSAIC' ) {\r\n          return G.tn.settings.height[cl][cw] * G.tn.settings.mosaic[cl+'Factor']['h'][cw];\r\n          }\r\n          else {\r\n            return G.tn.settings.height[cl][cw];\r\n          }\r\n        },\r\n        getW: function(l, w) {\r\n          var cl = (l == undefined ? G.GOM.curNavLevel : l);\r\n          var cw = (w == undefined ? G.GOM.curWidth : w);\r\n          if( G.layout.engine == 'MOSAIC' ) {\r\n            return G.tn.settings.width[cl][cw] * G.tn.settings.mosaic[cl+'Factor']['w'][cw];\r\n          }\r\n          else {\r\n            return G.tn.settings.width[cl][cw];\r\n            // return G.tn.settings.width[G.GOM.curNavLevel][G.GOM.curWidth];\r\n          }\r\n        },\r\n        mosaic: { l1 : { xs: null, sm: null, me: null, la: null, xl: null },\r\n                  lN : { xs: null, sm: null, me: null, la: null, xl: null },\r\n                  l1Factor : { h :{ xs: 1, sm: 1, me: 1, la: 1, xl: 1 }, w :{ xs: 1, sm: 1, me: 1, la: 1, xl: 1 }},\r\n                  lNFactor : { h :{ xs: 1, sm: 1, me: 1, la: 1, xl: 1 }, w :{ xs: 1, sm: 1, me: 1, la: 1, xl: 1 }}\r\n                  },\r\n        getMosaic: function() {\r\n          return G.tn.settings.mosaic[G.GOM.curNavLevel][G.GOM.curWidth];\r\n        },\r\n        mosaicCalcFactor: function(l, w) {\r\n            // retrieve max size multiplicator\r\n            var maxW = 1;\r\n            var maxH = 1;\r\n            for( var n = 0; n < G.tn.settings.mosaic[l][w].length; n++ ) {\r\n              maxW = Math.max(maxW, G.tn.settings.mosaic[l][w][n]['w']);\r\n              maxH = Math.max(maxH, G.tn.settings.mosaic[l][w][n]['h']);\r\n            }\r\n            G.tn.settings.mosaic[l + 'Factor']['h'][w] = maxH;\r\n            G.tn.settings.mosaic[l + 'Factor']['w'][w] = maxW;\r\n        }\r\n      },\r\n      // thumbnail hover effects\r\n      hoverEffects : {\r\n        std :   [],\r\n        level1: [],\r\n        get: function() {\r\n          if( G.GOM.curNavLevel == 'l1' && G.tn.hoverEffects.level1.length !== 0 ) {\r\n            return G.tn.hoverEffects.level1;\r\n          }\r\n          else {\r\n            return G.tn.hoverEffects.std;\r\n          }\r\n        }\r\n      },\r\n      // thumbnail init\r\n      buildInit : {\r\n        std :   [],\r\n        level1: [],\r\n        get: function() {\r\n          if( G.GOM.curNavLevel == 'l1' && G.tn.buildInit.level1.length !== 0 ) {\r\n            return G.tn.buildInit.level1;\r\n          }\r\n          else {\r\n            return G.tn.buildInit.std;\r\n          }\r\n        }\r\n      },\r\n      // thumbnail toolbars\r\n      toolbar: {\r\n        album :   { topLeft : '', topRight: '', bottomLeft: '', bottomRight: '' },\r\n        image :   { topLeft : '', topRight: '', bottomLeft: '', bottomRight: '' },\r\n        albumUp : { topLeft : '', topRight: '', bottomLeft: '', bottomRight: '' },\r\n        get: function( item ) {\r\n          return G.tn.toolbar[item.kind];\r\n        },\r\n      },\r\n      style: {\r\n        // inline CSS\r\n        l1 : { label: '', title: '', desc: '' },\r\n        lN : { label: '', title: '', desc: '' },\r\n        getTitle : function() {\r\n          return ('style=\"' + G.tn.style[G.GOM.curNavLevel].title + '\"');\r\n        },\r\n        getDesc : function() {\r\n          return ('style=\"' + G.tn.style[G.GOM.curNavLevel].desc + '\"');\r\n        },\r\n        getLabel: function() {\r\n          var s='style=\"'+ G.tn.style[G.GOM.curNavLevel].label;\r\n          s+= (G.O.RTL ? '\"direction:RTL;\"' :'');\r\n          s+='\"';\r\n          return s;\r\n        }\r\n      }\r\n    };\r\n    G.scrollTimeOut =             0;\r\n    G.i18nTranslations =          {'paginationPrevious':'Previous', 'paginationNext':'Next', 'breadcrumbHome':'List of Albums', 'thumbnailImageTitle':'', 'thumbnailAlbumTitle':'', 'thumbnailImageDescription':'', 'thumbnailAlbumDescription':'' };\r\n    G.emptyGif =                  'data:image/gif;base64,R0lGODlhEAAQAIAAAP///////yH5BAEKAAEALAAAAAAQABAAAAIOjI+py+0Po5y02ouzPgUAOw==';\r\n    G.CSStransformName =          FirstSupportedPropertyName([\"transform\", \"msTransform\", \"MozTransform\", \"WebkitTransform\", \"OTransform\"]);\r\n    // G.CSSfilterName =          FirstSupportedPropertyName([\"filter\", \"WebkitFilter\"]);\r\n    G.CSStransformStyle =         FirstSupportedPropertyName([\"transformStyle\", \"msTransformStyle\", \"MozTransformStyle\", \"WebkitTransformStyle\", \"OTransformStyle\"]);\r\n    G.CSSperspective =            FirstSupportedPropertyName([\"perspective\", \"msPerspective\", \"MozPerspective\", \"WebkitPerspective\", \"OPerspective\"]);\r\n    G.CSSbackfaceVisibilityName = FirstSupportedPropertyName([\"backfaceVisibility\", \"msBackfaceVisibility\", \"MozBackfaceVisibility\", \"WebkitBackfaceVisibility\", \"OBackfaceVisibility\"]);\r\n    G.CSStransitionName =         FirstSupportedPropertyName([\"transition\", \"msTransition\", \"MozTransition\", \"WebkitTransition\", \"OTransition\"]);\r\n    G.CSSanimationName =          FirstSupportedPropertyName([\"animation\", \"msAnimation\", \"MozAnimation\", \"WebkitAnimation\", \"OAnimation\"]);\r\n    G.GalleryResizeThrottled =    throttle(GalleryResize, 30, {leading: false});\r\n    \r\n    G.blackList =                 null;     // album white list\r\n    G.whiteList =                 null;     // album black list\r\n    G.albumList =                 [];       // album list\r\n    G.locationHashLastUsed =      '';\r\n    G.custGlobals =               {};\r\n    G.touchAutoOpenDelayTimerID = 0;\r\n    G.i18nLang =                  '';\r\n    G.timeLastTouchStart =        0;\r\n    G.custGlobals =               {};\r\n    G.markupOrApiProcessed =      false;\r\n    \r\n    //------------------------\r\n    //--- Gallery Object Model\r\n    G.GOM = {\r\n      albumIdx :                  -1, // index (in G.I) of the currently displayed album\r\n      clipArea :                  { top: 0, height: 0 }, // area of the GOM to display on screen\r\n      displayArea :               { width: 0 , height: 0 }, // size of the GOM area (=used area, not available area)\r\n      displayAreaLast :           { width: 0 , height: 0 }, // previous size of the GOM area\r\n      displayedMoreSteps :        0,  // current number of displayed steps (moreButton mode)\r\n      items:                      [], // current items of the GOMS\r\n      $imgPreloader:              [],\r\n      thumbnails2Display:         [],\r\n      itemsDisplayed :            0, // number of currently displayed thumbnails\r\n      firstDisplay :              true,\r\n      firstDisplayTime :          0,      // in conjunction with galleryRenderDelay\r\n      navigationBar : {           // content of the navigation bar (for breadcrumb and filter tags)\r\n        displayed:                false,\n        $newContent:              ''\r\n      },\r\n      cache : {                   // cached data\r\n        viewport:                 null,\n        containerOffset:          null,\r\n        areaWidth:                100         // available area width\r\n      },\r\n      nbSelected :                0,        // number of selected items\r\n      pagination :                { currentPage: 0 }, // pagination data\r\n      panThreshold:               60,       // threshold value (in pixels) to block horizontal pan/swipe\n      panYOnly:                   false,    // threshold value reach -> definitively block horizontal pan until end of pan\n      lastFullRow :               -1,       // number of the last row without holes\r\n      lastDisplayedIdx:           -1,       // used to display the counter of not displayed items\r\n      displayInterval :           { from: 0, len: 0 },\r\n      userEvents:                 null,\r\n      hammertime:                 null,\r\n      curNavLevel:                'l1',   // current navigation level (l1 or LN)\r\n      curWidth:                   'me',\r\n      albumSearch:                '',     // current search string -> title (used to filter the thumbnails on screen)\r\n      albumSearchTags:            '',     // current search string -> tags\r\n      lastZIndex:                 0,      // used to put a thumbnail on top of all others (for exemple for scale hover effect)\r\n      lastRandomValue:            0,\r\n      slider : {                          // slider on last thumbnail\r\n        hostIdx:                  -1,       // idx of the thumbnail hosting the slider\r\n        hostItem:                 null,     // item hosting the slider\r\n        currentIdx:               0,        // idx of the current displayed item\r\n        nextIdx:                  0,        // idx of the next item to display in the slider\r\n        timerID:                  0,\r\n        tween:                    null      // tranistion tween instance\r\n      },\r\n      NGY2Item: function( idx ) {   // returns a NGY2Item or null if it does not exist\r\n        if( G.GOM.items[idx] == undefined || G.GOM.items[idx] == null ) { return null; }\r\n        var i = G.GOM.items[idx].thumbnailIdx;\r\n        return G.I[i];\r\n      },\r\n      // One GOM item (thumbnail)\r\n      // function GTn(index, width, height) {\r\n      GTn: function(index, width, height) {\r\n        this.thumbnailIdx = index;\r\n        this.width =                0;      // thumbnail width\r\n        this.height =               0;      // thumbnail height\r\n        this.top =                  0;      // position: top\r\n        this.left =                 0;      // position: left\r\n        this.row =                  0;      // position: row number\r\n        this.imageWidth =           width;  // image width\r\n        this.imageHeight =          height; // image height\r\n        this.resizedContentWidth =  0;\r\n        this.resizedContentHeight = 0;\r\n        this.displayed =            false;\r\n        this.neverDisplayed =       true;\r\n        this.inDisplayArea =        false;\r\n      }\r\n    };\r\n    \r\n    \r\n    //------------------------\r\n    //--- Viewer Object Model\r\n    \r\n    G.VOM = {\r\n      viewerDisplayed:            false,  // is the viewer currently displayed\r\n      viewerIsFullscreen:         false,  // viewer in fullscreen mode\r\n      infoDisplayed:              false,  // is the info box displayed\r\n      toolbarsDisplayed:          true,   // the toolbars are displayed\r\n      toolsHide:                  null,\r\n      saveOverflowX:              'visible',    // store the value to restore it back after viewer is closed\r\n      saveOverflowY:              'visible',\r\n      zoom : {\r\n        posX:                     0,      // position to center zoom in/out\r\n        posY:                     0,\r\n        userFactor:               1,      // user zoom factor (applied to the baseZoom factor)\r\n        isZooming:                false\r\n      },\n      padding:                    { H: 0, V: 0 }, // padding for the image\r\n      window:                     { lastWidth: 0, lastHeight: 0 },\r\n      $cont:                      null,   // viewer container\r\n      $viewer:                    null,\r\n      $toolbar:                   null,   // viewerToolbar\r\n      $toolbarTL:                 null,   // viewer toolbar on top left\r\n      $toolbarTR:                 null,   // viewer toolbar on top right\r\n      $content:                   null,   // viewer content\r\n      \r\n      $mediaPrevious:             null,   // previous image\r\n      $mediaCurrent:              null,   // current image\r\n      $mediaNext:                 null,   // next image\r\n      toolbarMode:                'std',  // current toolbar mode (standard, minimized)\r\n      playSlideshow :             false,  // slide show mode status\r\n      playSlideshowTimerID:       0,      // slideshow mode time\r\n      slideshowDelay:             3000,   // slideshow mode - delay before next image\r\n      albumID:                    -1,\r\n      currItemIdx:                -1,\r\n      viewerMediaIsChanged:       false,  // media display is currently modified\r\n      items:                      [],     // current list of images to be managed by the viewer\r\n      NGY2Item: function( n ) {   // returns a NGY2Item\r\n        switch( n ) {\r\n          case -1:   // previous\r\n            var idx=this.IdxPrevious();\r\n            return G.I[this.items[idx].ngy2ItemIdx];\r\n            break;\r\n          case 1:   // next\r\n            var idx=this.IdxNext();\r\n            return G.I[this.items[idx].ngy2ItemIdx];\r\n            break;\r\n          case 0:   // current\r\n          default:\r\n            return G.I[this.items[G.VOM.currItemIdx].ngy2ItemIdx];\r\n            break;\r\n        }\r\n      },\r\n      IdxNext: function() {\r\n        var n = 0;\r\n        if( G.VOM.currItemIdx != (G.VOM.items.length-1) ) {\r\n          n = G.VOM.currItemIdx + 1;\r\n        }\r\n        return n;\r\n      },\r\n      IdxPrevious: function() {\r\n        var n = G.VOM.currItemIdx - 1;\r\n        if( G.VOM.currItemIdx == 0 ) {\r\n          n = G.VOM.items.length - 1;\r\n        }\r\n        return n;\r\n      },\r\n      userEvents:         null,   // user events management\r\n      hammertime:         null,   // hammer.js manager\r\n      swipePosX:          0,      // current horizontal swip position\r\n      panPosX:            0,      // position for manual pan\r\n      panPosY:            0,\n      panThreshold:       60,     // threshold value (in pixels) to block vertical pan\n      panXOnly:           false,  // threshold value reach -> definitively block vertical pan until end of pan\n      viewerTheme:        '',\r\n      timeImgChanged:     0,\r\n      ImageLoader: {\r\n        // fires a callback when image size is know (during download)\r\n        // inspired by ROB - http://stackoverflow.com/users/226507/rob\r\n        maxChecks:        1000,\r\n        list:             [],\r\n        intervalHandle :  null,\r\n\r\n        loadImage : function (callback, ngitem) {\r\n          if( ngitem.mediaKind != 'img' ) { return; }     // ignore - only for images\r\n          var img = new Image ();\r\n          img.src = ngitem.responsiveURL();\r\n          if (img.width && img.height) {\r\n            callback (img.width, img.height, ngitem, 0);\r\n            }\r\n          else {\r\n            var obj = {image: img, url: ngitem.responsiveURL(), ngitem: ngitem, callback: callback, checks: 1};\r\n            var i;\r\n            for (i=0; i < this.list.length; i++)    {\r\n              if (this.list[i] == null)\r\n                break;\r\n              }\r\n            this.list[i] = obj;\r\n            if (!this.intervalHandle)\r\n              this.intervalHandle = setInterval(this.interval, 50);\r\n            }\r\n          },\r\n\r\n        // called by setInterval  \r\n        interval : function () {\r\n          var count = 0;\r\n          var list = G.VOM.ImageLoader.list, item;\r\n          for (var i=0; i<list.length; i++) {\r\n            item = list[i];\r\n            if (item != null) {\r\n              if (item.image.width && item.image.height) {\r\n                G.VOM.ImageLoader.list[i] = null;\r\n                item.callback (item.image.width, item.image.height, item.ngitem, item.checks);\r\n                }\r\n              else if (item.checks > G.VOM.ImageLoader.maxChecks) {\r\n                G.VOM.ImageLoader.list[i] = null;\r\n                item.callback (0, 0, item.ngitem, item.checks);\r\n                }\r\n              else {\r\n                count++;\r\n                item.checks++;\r\n                }\r\n              }\r\n            }\r\n          if (count == 0) {\r\n            G.VOM.ImageLoader.list = [];\r\n            clearInterval (G.VOM.ImageLoader.intervalHandle);\r\n            delete G.VOM.ImageLoader.intervalHandle;\r\n            }\r\n          }\r\n        }\r\n    }\r\n    // One VOM item (image)\r\n    function VImg(index) {\r\n      this.$e = null;\r\n      this.ngy2ItemIdx = index;\r\n      this.mediaNumber = 0;     \r\n      this.posX = 0;    // to center the element\r\n      this.posY = 0;\r\n    }\r\n    \r\n    \r\n    //------------------------\r\n    //--- popup\r\n    G.popup = {\r\n      isDisplayed:      false,\r\n      $elt:             null,\r\n      close: function() {\r\n        if( this.$elt != null ) {\r\n          var tweenable = new NGTweenable();\r\n          tweenable.tween({\r\n            from:       { opacity:1  },\r\n            to:         { opacity:0 },\r\n            attachment: { t: this },\r\n            easing:     'easeInOutSine',\r\n            duration:   100,\r\n            step: function (state, att) {\r\n              if( att.t.$elt != null ) {\r\n                att.t.$elt.css('opacity',state.opacity);\r\n              }\r\n            },\r\n            finish: function (state, att) {\r\n              if( att.t.$elt != null ) {\r\n                att.t.$elt.remove();\r\n                att.t.$elt=null;\r\n              }\r\n              att.t.isDisplayed=false;\r\n            }\r\n          });\r\n        }\r\n      }\r\n    }\r\n    \r\n    \r\n    // Color schemes - Gallery\r\n    // gadrient generator: https://www.grabient.com/\r\n    G.galleryTheme_dark = {\r\n      navigationBar :         { background: 'none', borderTop: '', borderBottom: '', borderRight: '', borderLeft: '' },\r\n      navigationBreadcrumb :  { background: '#111', color: '#fff', colorHover: '#ccc', borderRadius: '4px' },\r\n      navigationFilter :      { color: '#ddd', background: '#111', colorSelected: '#fff', backgroundSelected: '#111', borderRadius: '4px' },\r\n      thumbnail :             { background: '#444', backgroundImage: 'linear-gradient(315deg, #111 0%, #445 90%)', borderColor: '#000', labelOpacity : 1, labelBackground: 'rgba(34, 34, 34, 0)', titleColor: '#fff', titleBgColor: 'transparent', titleShadow: '', descriptionColor: '#ccc', descriptionBgColor: 'transparent', descriptionShadow: '', stackBackground: '#aaa' },\r\n      thumbnailIcon :         { padding: '5px', color: '#fff' },\r\n      pagination :            { background: '#181818', backgroundSelected: '#666', color: '#fff', borderRadius: '2px', shapeBorder: '3px solid #666', shapeColor: '#444', shapeSelectedColor: '#aaa'}\r\n    };\r\n\r\n    G.galleryTheme_light = {\r\n      navigationBar :         { background: 'none', borderTop: '', borderBottom: '', borderRight: '', borderLeft: '' },\r\n      navigationBreadcrumb :  { background: '#eee', color: '#000', colorHover: '#333', borderRadius: '4px' },\r\n      navigationFilter :      { background: '#eee', color: '#222', colorSelected: '#000', backgroundSelected: '#eee', borderRadius: '4px' },\r\n      thumbnail :             { background: '#444', backgroundImage: 'linear-gradient(315deg, #111 0%, #445 90%)', borderColor: '#000', labelOpacity : 1, labelBackground: 'rgba(34, 34, 34, 0)', titleColor: '#fff', titleBgColor: 'transparent', titleShadow: '', descriptionColor: '#ccc', descriptionBgColor: 'transparent', descriptionShadow: '', stackBackground: '#888' },\r\n      thumbnailIcon :         { padding: '5px', color: '#fff' },\r\n      pagination :            { background: '#eee', backgroundSelected: '#aaa', color: '#000', borderRadius: '2px', shapeBorder: '3px solid #666', shapeColor: '#444', shapeSelectedColor: '#aaa'}\r\n    };\r\n\r\n    // Color schemes - lightbox\r\n    G.viewerTheme_dark = {\r\n      background:             '#000',\n      imageBorder:            'none',\n      imageBoxShadow:         'none',\r\n      barBackground:          'rgba(4, 4, 4, 0.2)',\n      barBorder:              '0px solid #111',\n      barColor:               '#eee',\n      barDescriptionColor:    '#aaa'\r\n    };\r\n    G.viewerTheme_border = {\r\n      background:             'rgba(1, 1, 1, 0.75)',\n      imageBorder:            '4px solid #f8f8f8',\n      imageBoxShadow:         '#888 0px 0px 20px',\r\n      barBackground:          'rgba(4, 4, 4, 0.2)',\n      barBorder:              '0px solid #111',\n      barColor:               '#eee',\n      barDescriptionColor:    '#aaa'\r\n    };\r\n    G.viewerTheme_light = {\r\n      background:             '#f8f8f8',\n      imageBorder:            'none',\n      imageBoxShadow:         'none',\r\n      barBackground:          'rgba(4, 4, 4, 0.7)',\n      barBorder:              '0px solid #111',\n      barColor:               '#eee',\n      barDescriptionColor:    '#aaa'\r\n    };\r\n\r\n      \r\n    \r\n    // shortcut with G context to NGY2TOOLS\r\n    // var NanoAlert =           NGY2Tools.NanoAlert.bind(G);\r\n    // var NanoConsoleLog =      NGY2Tools.NanoConsoleLog.bind(G);\r\n    var NanoAlert =           NGY2Tools.NanoAlert;\r\n    var NanoConsoleLog =      NGY2Tools.NanoConsoleLog;\r\n\r\n    \r\n    /** @function initiateGallery2 */\r\n    this.initiateGallery2 = function( element, params ) {\r\n\r\n      // GLOBAL OPTIONS\r\n      G.O =               params;\r\n      // Base element\r\n      G.$E.base =         jQuery(element);\r\n      G.baseEltID =       G.$E.base.attr('id');\r\n      if( G.baseEltID == undefined ) {\r\n        // set a default ID to the root container\r\n        G.baseEltID='my_nanogallery';\r\n        G.$E.base.attr('id', G.baseEltID)\r\n      }\r\n      G.O.$markup =       [];\r\n      DefineVariables();\r\n      SetPolyFills();\r\n      BuildSkeleton();\r\n      G.GOM.firstDisplayTime=Date.now();\r\n      \r\n      SetGlobalEvents();\r\n\r\n      // check if only one specific album will be used\r\n      var albumToDisplay = G.O.album;\r\n      if( albumToDisplay == '' && G.O.photoset != '' ) {\r\n        albumToDisplay = G.O.photoset;\r\n        G.O.album = G.O.photoset;\r\n      }\r\n      if( albumToDisplay != '' ) {\r\n        G.O.displayBreadcrumb = false;    // no breadcrumb since only 1 album\r\n        if( albumToDisplay.toUpperCase() != 'NONE' ) {\r\n          // open specific album\r\n        \r\n          var p=albumToDisplay.indexOf('&authkey=');\r\n          if( p == -1 ) {\r\n            p=albumToDisplay.indexOf('?authkey=');\r\n          }\r\n          if( p > 0 ) {\r\n            // privat album with authkey\r\n            G.O.locationHash=false;   // disable hash location for hidden/privat albums --> impossible to handle\r\n            var albumID=albumToDisplay.substring(0,p);\r\n            var opt=albumToDisplay.substring(p);\r\n            if( opt.indexOf('Gv1sRg') == -1 ) {\r\n              opt = '&authkey=Gv1sRg'+opt.substring(9);\r\n            }\r\n            var newItem = NGY2Item.New( G, '', '', albumID, '-1', 'album' );\r\n            newItem.authkey = opt;\r\n            DisplayAlbum('-1', albumID);\r\n          }\r\n          else {\r\n            // open a public album\r\n            if( G.O.kind == \"nano_photos_provider2\") {\r\n              if( albumToDisplay == decodeURIComponent(albumToDisplay)) {\r\n                // album ID must be encoded\r\n                albumToDisplay = encodeURIComponent(albumToDisplay);\r\n                G.O.album = albumToDisplay;\r\n              }\r\n            }\r\n            NGY2Item.New( G, '', '', albumToDisplay, '-1', 'album' );\r\n            if( !ProcessLocationHash() ) {\r\n              DisplayAlbum('-1', albumToDisplay);\r\n            }\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // use full content\r\n      // add base album\r\n      NGY2Item.New( G, G.i18nTranslations.breadcrumbHome, '', '0', '-1', 'album' );\r\n\r\n      processStartOptions();\r\n\r\n    }\r\n\r\n\r\n    /** @function processStartOptions */\r\n    function processStartOptions() {\r\n      // open image or album\r\n      // 1. load hidden albums\r\n      // 2. check if location hash set (deep linking)\r\n      // 3. check openOnStart parameter\r\n      // 4. open root album (ID=-1)\r\n\r\n      // hidden/private albums are loaded on plugin start (Picasa) --> no more available in Google Photos\r\n      // if( G.albumListHidden.length > 0 ) {\r\n      //  jQuery.nanogallery2['data_'+G.O.kind](G, 'GetHiddenAlbums', G.albumListHidden, processStartOptionsPart2);\r\n      //  return;\r\n      //}\r\n      \r\n      if( !ProcessLocationHash() ) {\r\n        processStartOptionsPart2();\r\n      }\r\n    }\r\n\r\n    /** @function processStartOptionsPart2 */\r\n    function processStartOptionsPart2() {\r\n  \r\n      // Check location hash + start parameters -> determine what to do on start\r\n      // openOnStart parameter\r\n      if( G.O.openOnStart != '' ) {\r\n        var IDs = parseIDs(G.O.openOnStart);\r\n        if( IDs.imageID != '0' ) {\r\n          DisplayPhoto(IDs.imageID, IDs.albumID);\r\n        }\r\n        else {\r\n          DisplayAlbum('-1', IDs.albumID);\r\n        }\r\n      }\r\n      else {\r\n        // open root album (ID = -1)\r\n        DisplayAlbum('-1', 0);\r\n      }\r\n    }\r\n    \r\n    // Parse string to extract albumID and imageID (format albumID/imageID)\r\n    function parseIDs( IDs ) {\r\n      var r={ albumID: '0', imageID: '0' };\r\n      \r\n      var t=IDs.split('/');\r\n      if( t.length > 0 ) {\r\n        r.albumID = t[0];\r\n        if( t.length > 1 ) {\r\n          r.imageID = t[1];\r\n        }\r\n      }\r\n      return r;\r\n    }\r\n    \r\n\r\n    /** @function DisplayAlbum */\r\n    function DisplayAlbum( imageID, albumID ) {\r\n      // close viewer if already displayed\r\n      if( G.VOM.viewerDisplayed ) {\r\n        CloseInternalViewer(null);\r\n      }\r\n    \r\n      // set current navigation level (l1 or lN)\r\n      var albumIdx = NGY2Item.GetIdx(G, albumID);\r\n      G.GOM.curNavLevel = 'lN';\r\n      if( albumIdx == 0 ) {\r\n        G.GOM.curNavLevel = 'l1';\r\n      }\r\n      G.layout.SetEngine();\r\n      G.galleryResizeEventEnabled = false;\r\n\r\n      if( albumIdx == -1 ) {\r\n        NGY2Item.New( G, '', '', albumID, '0', 'album' );    // create empty album\r\n        albumIdx = G.I.length - 1;\r\n      }\r\n    \r\n      if( !G.I[albumIdx].contentIsLoaded ) {\r\n        // get content of the album if not already loaded\r\n        AlbumGetContent( albumID, DisplayAlbum, imageID, albumID );\r\n        return;\r\n      }\r\n    \r\n      ThumbnailSelectionClear();\r\n    \r\n      G.GOM.pagination.currentPage = 0;\r\n      SetLocationHash( albumID, '' );\r\n      GalleryRender( albumIdx );\r\n    \r\n    }\r\n\r\n\r\n    //----- manage the bottom area of the gallery -> \"pagination\" or \"more button\"\r\n    function GalleryBottomManage() {\r\n\r\n      switch( G.galleryDisplayMode.Get() ) {\r\n        case 'PAGINATION':\r\n          if( G.layout.support.rows && G.galleryMaxRows.Get() > 0 ) {\r\n            ManagePagination( G.GOM.albumIdx );\r\n          }\r\n          break;\r\n        case 'MOREBUTTON':\r\n          G.$E.conTnBottom.off('click');\r\n          var nb = G.GOM.items.length-G.GOM.itemsDisplayed;\r\n          if( nb == 0 ) {\r\n            G.$E.conTnBottom.empty();\r\n          }\r\n          else {\r\n            G.$E.conTnBottom.html('<div class=\"nGY2GalleryMoreButton\"><div class=\"nGY2GalleryMoreButtonAnnotation\">+'+nb+' ' + G.O.icons.galleryMoreButton +'</div></div>');\r\n            G.$E.conTnBottom.on('click', function(e) {\r\n              G.GOM.displayedMoreSteps++;\r\n              GalleryResize();\r\n            });\r\n          }\r\n          break;\r\n        case 'FULLCONTENT':\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n    \r\n    \r\n    // add one album/folder to the breadcrumb\r\n    function breadcrumbAdd( albumIdx ) {\r\n\r\n      var ic='';\r\n      if( !G.O.breadcrumbHideIcons ) {\r\n        ic=G.O.icons.breadcrumbAlbum;\r\n        if( albumIdx == 0 ) {\r\n          ic=G.O.icons.breadcrumbHome;\r\n        }\r\n      }\r\n      var $newDiv =jQuery('<div class=\"oneItem\">'+ic + G.I[albumIdx].title+'</div>').appendTo(G.GOM.navigationBar.$newContent.find('.nGY2Breadcrumb'));\r\n      if( G.O.breadcrumbOnlyCurrentLevel ) {\r\n        // link to parent folder (only 1 level is displayed in the breadcrumb)\r\n        if( albumIdx == 0 ) {\r\n          // no parent level -> stay on current one\r\n          jQuery($newDiv).data('albumID','0');\r\n        }\r\n        else {\r\n          jQuery($newDiv).data('albumID',G.I[albumIdx].albumID);\r\n        }\r\n      }\r\n      else {\r\n        // link to current folder\r\n        jQuery($newDiv).data('albumID',G.I[albumIdx].GetID());\r\n      }\r\n      $newDiv.click(function() {\r\n        var cAlbumID=jQuery(this).data('albumID');\r\n        DisplayAlbum('-1', cAlbumID);\r\n        return;\r\n      });\r\n    }\r\n\r\n    // add one separator to breadcrumb\r\n    function breadcrumbAddSeparator( lastAlbumID ) {\r\n      var $newSep=jQuery('<div class=\"oneItem\">'+(G.O.RTL ? G.O.icons.breadcrumbSeparatorRtl : G.O.icons.breadcrumbSeparator)+'</div>').appendTo(G.GOM.navigationBar.$newContent.find('.nGY2Breadcrumb'));\r\n      jQuery($newSep).data('albumIdx',lastAlbumID);\r\n      $newSep.click(function() {\r\n        var sepAlbumIdx=jQuery(this).data('albumIdx');\r\n        DisplayAlbum('-1', G.I[sepAlbumIdx].GetID());\r\n        return;\r\n      });\r\n    }\r\n\r\n    \r\n    \r\n    // Manage the gallery toolbar (breadcrumb + tag filter)\r\n    function GalleryNavigationBar( albumIdx ) {\r\n\r\n      // Title + background image\r\n      // var bgImage='';\r\n      // var l=G.I.length;\r\n      // var albumID = G.I[albumIdx].GetID();\r\n      // for( var idx=0; idx<l ; idx++) {\r\n        // var item=G.I[idx];\r\n        // if( item.kind == 'image' && item.isToDisplay(albumID) ) {\r\n          // bgImage='<div id=\"pipo\" class=\"pipo\" style=\"height: 150px; width:100%; background-image: url(\"' + item.responsiveURL() + '\"); background-size: cover; background-position: center center; filter:blur(2px)\">pipo</div>';\r\n          // break;\r\n        // }\r\n      // }\r\n\r\n      //console.log(bgImage);\r\n    \r\n      // new navigation bar items are not build in the DOM, but in memory\r\n      G.GOM.navigationBar.$newContent=jQuery('<div class=\"nGY2Navigationbar\"></div>');\r\n      //G.GOM.navigationBar.$newContent = jQuery(bgImage );\r\n      //console.log(G.GOM.navigationBar.$newContent);\r\n\r\n      //-- manage breadcrumb\r\n      if( G.O.displayBreadcrumb == true && !G.O.thumbnailAlbumDisplayImage) {\r\n        // retrieve new folder level\r\n        var newLevel = 0,\r\n        lstItems=[];\r\n        if( albumIdx != 0 ) {\r\n          var l=G.I.length,\r\n          parentID=0;\r\n          \r\n          lstItems.push(albumIdx);\r\n          var curIdx=albumIdx;\r\n          newLevel++;\r\n          \r\n          while( G.I[curIdx].albumID != 0 && G.I[curIdx].albumID != -1) {\r\n            for(var i=1; i < l; i++ ) {\r\n              if( G.I[i].GetID() == G.I[curIdx].albumID ) {\r\n                curIdx=i;\r\n                lstItems.push(curIdx);\r\n                newLevel++;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n        \r\n        // build breadcrumb\r\n        if( !(G.O.breadcrumbAutoHideTopLevel && newLevel == 0) ) {\r\n          BreadcrumbBuild( lstItems );\r\n        }\r\n      }\r\n\r\n      \r\n      //-- manage and build tag filters\r\n      if( G.galleryFilterTags.Get() != false ) {\r\n        var nTags=G.I[albumIdx].albumTagList.length;\r\n        if( nTags > 0 ) {\r\n          for(var i=0; i < nTags; i++ ) {\r\n            var s=G.I[albumIdx].albumTagList[i];\r\n            var ic=G.O.icons.navigationFilterUnselected;\r\n            var tagClass='Unselected';\r\n            if( jQuery.inArray(s, G.I[albumIdx].albumTagListSel) >= 0 ) {\r\n              tagClass='Selected';\r\n              ic=G.O.icons.navigationFilterSelected;\r\n            }\r\n            var $newTag=jQuery('<div class=\"nGY2NavigationbarItem nGY2NavFilter'+tagClass+'\">'+ic+' '+s+'</div>').appendTo(G.GOM.navigationBar.$newContent);\r\n            $newTag.click(function() {\r\n              var $this=jQuery(this);\r\n              var tag=$this.text().replace(/^\\s*|\\s*$/, '');  //trim trailing/leading whitespace\r\n              // if( $this.hasClass('oneTagUnselected') ){\r\n              if( $this.hasClass('nGY2NavFilterUnselected') ){\r\n                G.I[albumIdx].albumTagListSel.push(tag);\r\n              }\r\n              else {\r\n                var tidx=jQuery.inArray(tag,G.I[albumIdx].albumTagListSel);\r\n                if( tidx != -1 ) {\r\n                  G.I[albumIdx].albumTagListSel.splice(tidx,1);\r\n                }\r\n              }\r\n              $this.toggleClass('nGY2NavFilters-oneTagUnselected nGY2NavFilters-oneTagSelected');\r\n              DisplayAlbum('-1', G.I[albumIdx].GetID());\r\n            });\r\n          }\r\n          var $newClearFilter=jQuery('<div class=\"nGY2NavigationbarItem nGY2NavFilterSelectAll\">'+G.O.icons.navigationFilterSelectedAll+'</div>').appendTo(G.GOM.navigationBar.$newContent);\r\n          $newClearFilter.click(function() {\r\n            var nTags=G.I[albumIdx].albumTagList.length;\r\n            G.I[albumIdx].albumTagListSel=[];\r\n            for(var i=0; i <nTags; i++ ) {\r\n              var s=G.I[albumIdx].albumTagList[i];\r\n              G.I[albumIdx].albumTagListSel.push(s);\r\n            }\r\n            DisplayAlbum('-1', G.I[albumIdx].GetID());\r\n          });\r\n        }\r\n      }\r\n\r\n    }\r\n    \r\n    function BreadcrumbBuild(lstItems) {\r\n\r\n    // console.log(G.GOM.navigationBar.$newContent);\r\n    jQuery('<div class=\"nGY2NavigationbarItem nGY2Breadcrumb\"></div>').appendTo(G.GOM.navigationBar.$newContent);\r\n    // console.log(G.GOM.navigationBar.$newContent);\r\n      \r\n      if( G.O.breadcrumbOnlyCurrentLevel ) {\r\n        // display only 1 separator and the current folder level\r\n        if( lstItems.length == 0 ) {\r\n          breadcrumbAdd(0);\r\n        }\r\n        else {\r\n          var last=lstItems.length-1;\r\n          if( lstItems.length == 1 ) {\r\n            breadcrumbAddSeparator(0);    // root level\r\n          }\r\n          else {\r\n            breadcrumbAddSeparator(lstItems[0]);\r\n          }\r\n          breadcrumbAdd(lstItems[0]);\r\n        }\r\n      }\r\n      else {\r\n        // display the full breadcrum (full folder levels including root level)\r\n        breadcrumbAdd(0);\r\n        if( lstItems.length > 0 ) {\r\n          breadcrumbAddSeparator(0);\r\n          for(var i=lstItems.length-1; i>=0 ; i-- ) {\r\n            breadcrumbAdd(lstItems[i]);\r\n            if( i > 0 ) {\r\n              breadcrumbAddSeparator(lstItems[i-1]);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    \r\n    }\r\n    \r\n\r\n    // Display gallery pagination\r\n    function ManagePagination( albumIdx ) {\r\n\r\n      G.$E.conTnBottom.css('opacity', 0);\r\n      G.$E.conTnBottom.children().remove();\r\n\r\n      if( G.GOM.items.length == 0 ) { return; }   // no thumbnail to display\r\n\r\n      // calculate the number of pages\r\n      var nbPages=Math.ceil((G.GOM.items[G.GOM.items.length - 1].row + 1)/G.galleryMaxRows.Get());\r\n\r\n      // only one page -> do not display pagination\r\n      if( nbPages == 1 ) { return; }\r\n\r\n      // check if current page still exists (for example after a resize)\r\n      if( G.GOM.pagination.currentPage > (nbPages-1) ) {\r\n        G.GOM.pagination.currentPage = nbPages-1;\r\n      }\r\n      \r\n      GalleryRenderGetInterval();\r\n      // nothing to display --> exit\r\n      if( G.GOM.displayInterval.len == 0 ) { return; }\r\n      \r\n      // display \"previous\"\r\n      if( G.O.galleryPaginationMode == 'NUMBERS' && G.GOM.pagination.currentPage > 0 ) {\r\n        var $eltPrev = jQuery('<div class=\"nGY2PaginationPrev\">'+G.O.icons.paginationPrevious+'</div>').appendTo(G.$E.conTnBottom);\r\n        $eltPrev.click(function(e) {\r\n          paginationPreviousPage();\r\n        });\r\n      }\r\n\r\n      var firstPage = 0;\r\n      var lastPage = nbPages;\r\n      if( G.O.galleryPaginationMode != 'NUMBERS' ) {\r\n        // no 'previous'/'next' and no max number of pagination items\r\n        firstPage = 0;\r\n      }\r\n      else {\r\n        // display pagination numbers and previous/next\r\n        var vp = G.O.paginationVisiblePages;\r\n        var numberOfPagesToDisplay = G.O.paginationVisiblePages;\r\n        if( numberOfPagesToDisplay >= nbPages ) {\r\n          firstPage = 0;\r\n        }\r\n        else {\r\n          // we have more pages than we want to display\r\n          var nbBeforeAfter = 0;\r\n          if( isOdd(numberOfPagesToDisplay) ) {\r\n            nbBeforeAfter = (numberOfPagesToDisplay + 1) / 2;\r\n          }\r\n          else {\r\n            nbBeforeAfter = numberOfPagesToDisplay / 2;\r\n          }\r\n          \r\n          if( G.GOM.pagination.currentPage < nbBeforeAfter ) {\r\n            firstPage = 0;\r\n            lastPage = numberOfPagesToDisplay - 1;\r\n            if( lastPage > nbPages ) {\r\n              lastPage = nbPages - 1;\r\n            }\r\n          }\r\n          else {\r\n            firstPage = G.GOM.pagination.currentPage - nbBeforeAfter;\r\n            lastPage = firstPage + numberOfPagesToDisplay;\r\n            if( lastPage > nbPages ) {\r\n              lastPage = nbPages - 1;\r\n            }\r\n          }\r\n          \r\n          if( (lastPage - firstPage) < numberOfPagesToDisplay ) {\r\n            firstPage = lastPage - numberOfPagesToDisplay;\r\n            if( firstPage < 0 ) {\r\n              firstPage = 0;\r\n            }\r\n          }\r\n\r\n        }\r\n      }\r\n\r\n      // render pagination items\r\n      for(var i = firstPage; i < lastPage; i++ ) {\r\n        var c = '';\r\n        var p = '';\r\n\r\n        switch( G.O.galleryPaginationMode ) {\r\n          case 'NUMBERS':\r\n            c = 'nGY2paginationItem';\r\n            p = i + 1;\r\n            break;\r\n          case 'DOTS':\r\n            c = 'nGY2paginationDot';\r\n            break;\r\n          case 'RECTANGLES':\r\n            c = 'nGY2paginationRectangle';\r\n            break;\r\n        }\r\n        if( i == G.GOM.pagination.currentPage ) {\r\n          c += 'CurrentPage';\r\n        }\r\n\r\n        var elt$ = jQuery('<div class=\"' + c + '\">' + p + '</div>').appendTo(G.$E.conTnBottom);\r\n        elt$.data('pageNumber', i );\r\n        elt$.click( function(e) {\r\n          G.GOM.pagination.currentPage = jQuery(this).data('pageNumber');\r\n          TriggerCustomEvent('pageChanged');\r\n\r\n          // scroll to top of gallery if not displayed\r\n          if( !inViewportVert(G.$E.base, 0) ) {\r\n            $('html, body').animate({scrollTop: G.$E.base.offset().top}, 200);\r\n          }\r\n          GalleryDisplayPart1( true );\r\n          GalleryDisplayPart2( true );\r\n        });\r\n\r\n      }\r\n\r\n      // display \"next\"\r\n      if( G.O.galleryPaginationMode == 'NUMBERS' && (G.GOM.pagination.currentPage + 1) < nbPages ) {\r\n        var $eltNext = jQuery('<div class=\"nGY2PaginationNext\">' + G.O.icons.paginationNext + '</div>').appendTo(G.$E.conTnBottom);\r\n        $eltNext.click( function(e) {\r\n          paginationNextPage();\r\n        });\r\n      }\r\n\r\n      G.$E.conTnBottom.css('opacity', 1);\r\n\r\n    }\r\n    function isOdd(num) { return (num % 2) == 1;}\r\n    \r\n    // pagination - next page\r\n    function paginationNextPage() {\r\n      var aIdx = G.GOM.albumIdx,\r\n      n1 = 0;\r\n      ThumbnailHoverOutAll();\n      \r\n      // pagination - max lines per page mode\r\n      if( G.galleryMaxRows.Get() > 0 ) {\r\n        // number of pages\r\n        n1 = (G.GOM.items[G.GOM.items.length - 1].row + 1) / G.galleryMaxRows.Get();\r\n      }\r\n      var n2 = Math.ceil(n1);\r\n      var pn = G.GOM.pagination.currentPage;\r\n      if( pn < (n2-1) ) {\r\n        pn++;\r\n      }\r\n      else {\r\n        pn = 0;\r\n      }\r\n      \r\n      G.GOM.pagination.currentPage = pn;\r\n      TriggerCustomEvent('pageChanged');\r\n\r\n      // scroll to top of gallery if not displayed\r\n      if( !inViewportVert(G.$E.base, 0) ) {\r\n        $('html, body').animate({scrollTop: G.$E.base.offset().top}, 200);\r\n      }\r\n      GalleryDisplayPart1( true );\r\n      GalleryDisplayPart2( true );\r\n    }\r\n    \r\n    // pagination - previous page\r\n    function paginationPreviousPage() {\r\n      // var aIdx=G.$E.conTnBottom.data('galleryIdx'),\r\n      var aIdx = G.GOM.albumIdx,\r\n      n1 = 0;\r\n\n      ThumbnailHoverOutAll();\n      \r\n      // pagination - max lines per page mode\r\n      if( G.galleryMaxRows.Get() > 0 ) {\r\n        // number of pages\r\n        n1 = (G.GOM.items[G.GOM.items.length - 1].row + 1) / G.galleryMaxRows.Get();\r\n      }\r\n      var n2 = Math.ceil(n1);\r\n      \r\n      // var pn=G.$E.conTnBottom.data('currentPageNumber');\r\n      var pn = G.GOM.pagination.currentPage;\r\n      if( pn > 0 ) {\r\n        pn--;\r\n      }\r\n      else {\r\n        pn = n2 - 1;\r\n      }\r\n\r\n      G.GOM.pagination.currentPage = pn;\r\n      TriggerCustomEvent('pageChanged');\r\n\r\n      // scroll to top of gallery if not displayed\r\n      if( !inViewportVert(G.$E.base, 0) ) {\r\n        $('html, body').animate({scrollTop: G.$E.base.offset().top}, 200);\r\n      }\r\n      GalleryDisplayPart1( true );\r\n      GalleryDisplayPart2( true );\r\n    }\r\n\r\n    // retrieve the from/to intervall for gallery thumbnail render\r\n    function GalleryRenderGetInterval() {\r\n      G.GOM.displayInterval.from = 0;\r\n      G.GOM.displayInterval.len = G.I.length;\r\n      \r\n      switch( G.galleryDisplayMode.Get() ) {\r\n        case 'PAGINATION':\r\n          if( G.layout.support.rows ) {\r\n            var nbTn = G.GOM.items.length;\r\n            var firstRow = G.GOM.pagination.currentPage * G.galleryMaxRows.Get();\r\n            var lastRow = firstRow + G.galleryMaxRows.Get();\r\n            var firstTn = -1;\r\n            G.GOM.displayInterval.len = 0;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.row >= firstRow && curTn.row < lastRow ) {\r\n                if( firstTn == -1 ) {\r\n                  G.GOM.displayInterval.from = i;\r\n                  firstTn = i;\r\n                }\r\n                G.GOM.displayInterval.len++;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        case 'MOREBUTTON':\r\n          if( G.layout.support.rows ) {\r\n            var nbTn = G.GOM.items.length;\r\n            var lastRow = G.O.galleryDisplayMoreStep * (G.GOM.displayedMoreSteps+1);\r\n            G.GOM.displayInterval.len = 0;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.row < lastRow ) {\r\n                G.GOM.displayInterval.len++;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        case 'ROWS':\r\n          if( G.layout.support.rows ) {\r\n            var nbTn = G.GOM.items.length;\r\n            var lastRow = G.galleryMaxRows.Get();\r\n            if( G.galleryLastRowFull.Get() && G.GOM.lastFullRow != -1 ) {\r\n              if( lastRow > (G.GOM.lastFullRow + 1) ) {\r\n                lastRow = G.GOM.lastFullRow + 1;\r\n              }\r\n            }\r\n            G.GOM.displayInterval.len = 0;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.row < lastRow ) {\r\n                G.GOM.displayInterval.len++;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n        default:\r\n        case 'FULLCONTENT':\r\n        if( G.layout.support.rows && G.galleryLastRowFull.Get() && G.GOM.lastFullRow != -1 ) {\r\n            var nbTn = G.GOM.items.length;\r\n            var lastRow = G.GOM.lastFullRow + 1;\r\n            G.GOM.displayInterval.len = 0;\r\n            for( var i = 0; i < nbTn ; i++ ) {\r\n              var curTn = G.GOM.items[i];\r\n              if( curTn.row < lastRow ) {\r\n                G.GOM.displayInterval.len++;\r\n              }\r\n            }\r\n          }\r\n          break;\r\n      }\r\n    }\r\n    \r\n    \r\n    // RENDER THE GALLERY\r\n    function GalleryRender( albumIdx ) {\r\n      TriggerCustomEvent('galleryRenderStart');\r\n      \r\n      clearTimeout(G.GOM.slider.timerID);\r\n      G.GOM.slider.hostIdx = -1;      // disabled slider on thumbnail\r\n      \r\n      var fu=G.O.fnGalleryRenderStart;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(albumIdx) : window[fu](albumIdx);\r\n      }\r\n\r\n      G.layout.SetEngine();\r\n      G.galleryResizeEventEnabled = false;\r\n      G.GOM.albumIdx = -1;\r\n      G.GOM.lastDisplayedIdx = -1;\r\n\r\n      // pagination\r\n      if( G.$E.conTnBottom !== undefined ) {\r\n        // G.$E.conTnBottom.children().remove();\r\n        G.$E.conTnBottom.empty();\r\n      }\r\n\r\n      // navigation toolbar (breadcrumb + tag filters)\r\n      GalleryNavigationBar(albumIdx);\r\n      \r\n      if( G.GOM.firstDisplay ) {\r\n        G.GOM.firstDisplay = false;\r\n        var d = Date.now()-G.GOM.firstDisplayTime;\r\n        if( d < G.O.galleryRenderDelay ) {\r\n          // setTimeout( function() { GalleryRenderPart1( albumIdx )}, G.O.galleryRenderDelay-d );\r\n          requestTimeout( function() { GalleryRenderPart1( albumIdx )}, G.O.galleryRenderDelay-d );\r\n        }\r\n        else {\r\n          GalleryRenderPart1( albumIdx );\r\n        }\r\n        G.O.galleryRenderDelay = 0;\r\n        \n      }\r\n      else {\r\n        var hideNavigationBar = false;\r\n        if( G.GOM.navigationBar.$newContent.children().length == 0 ) {\r\n          hideNavigationBar = true;\r\n        }\r\n\r\n        // hide everything\r\n        var tweenable = new NGTweenable();\r\n        tweenable.tween({\r\n          from:         { 'opacity': 1 },\r\n          to:           { 'opacity': 0 },\r\n          duration:     300,\r\n          easing:       'easeInQuart',\r\n          attachment:   { h: hideNavigationBar },\r\n          step:         function (state, att) {\r\n            // window.ng_draf( function() {\r\n              G.$E.conTnParent.css({'opacity': state.opacity });\r\n              if( att.h ) {\r\n                G.$E.conNavigationBar.css({ 'opacity': state.opacity });\r\n              }\r\n            // });\r\n          },\r\n          finish:       function (state, att) {\r\n            // window.ng_draf( function() {\r\n              if( att.h ) {\r\n                G.$E.conNavigationBar.css({ 'opacity': 0, 'display': 'none' });\r\n              }\r\n              // scroll to top of the gallery if needed\r\n              var galleryOTop = G.$E.base.offset().top;\r\n              if( galleryOTop < G.GOM.cache.viewport.t ) {\r\n                // jQuery('html, body').animate({scrollTop: galleryOTop}, 200);\r\n                jQuery('html, body').animate({scrollTop: galleryOTop}, 500, \"linear\", function() {\r\n                  GalleryRenderPart1( albumIdx );\r\n                });\r\n              }\r\n              else {\r\n                GalleryRenderPart1( albumIdx );\r\n              }\r\n            // });\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n\r\n    function GalleryRenderPart1( albumIdx ) {\r\n      // display new navigation bar\r\n      var oldN = G.$E.conNavigationBar.children().length;\r\n      G.$E.conNavigationBar.empty();\r\n      G.GOM.navigationBar.$newContent.children().clone(true,true).appendTo(G.$E.conNavigationBar);\r\n      // G.GOM.navigationBar.$newContent.appendTo(G.$E.conNavigationBar);\r\n      if( G.$E.conNavigationBar.children().length > 0 && oldN == 0 ) {\r\n        G.$E.conNavigationBar.css({ 'opacity': 0, 'display': 'block' });\r\n        var tweenable = new NGTweenable();\r\n        tweenable.tween({\r\n          from:     { opacity: 0 },\r\n          to:       { opacity: 1 },\r\n          duration: 200,\r\n          easing:   'easeInQuart',\r\n          step:     function (state) {\r\n            // window.ng_draf( function() {\r\n              G.$E.conNavigationBar.css( state );\r\n            // });\r\n          },\r\n          finish:   function (state) {\r\n            // window.ng_draf( function() {\r\n              G.$E.conNavigationBar.css({ 'opacity': 1 });\r\n              // display gallery\r\n              // GalleryRenderPart2( albumIdx );\r\n              // setTimeout(function(){ GalleryRenderPart2(albumIdx) }, 60);\r\n              requestTimeout(function(){ GalleryRenderPart2(albumIdx) }, 60);\r\n            // });\r\n          }\r\n        });\r\n      }\r\n      else {\r\n        // display gallery\r\n        // GalleryRenderPart2( albumIdx );\r\n            // setTimeout(function(){ GalleryRenderPart2(albumIdx) }, 60);\r\n            requestTimeout(function(){ GalleryRenderPart2(albumIdx) }, 60);\r\n      }\r\n\r\n    }\r\n    \r\n    // Gallery render part 2 -> remove all thumbnails\r\n    function GalleryRenderPart2(albumIdx) {\r\n      G.GOM.lastZIndex = parseInt(G.$E.base.css('z-index'));\r\n      if( isNaN(G.GOM.lastZIndex) ) {\r\n        G.GOM.lastZIndex=0;\r\n      }\r\n      G.$E.conTnParent.css({ 'opacity': 0 });\r\n      G.$E.conTn.off().empty();\r\n      var l = G.I.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        // reset each item\r\n        var item = G.I[i];\r\n        item.hovered = false;\r\n        item.$elt = null;\r\n        item.$Elts = [];\r\n        item.eltTransform = [];\r\n        item.eltFilter = [];\r\n        item.width = 0;\r\n        item.height = 0;\r\n        item.left = 0;\r\n        item.top = 0;\r\n        item.resizedContentWidth = 0;\r\n        item.resizedContentHeight = 0;\r\n        item.thumbnailImgRevealed = false;\r\n      }\r\n\r\n      if( G.CSStransformName == null ) {\r\n        G.$E.conTn.css('left', '0px');\r\n      }\r\n      else {\r\n        // G.$E.conTn.css( G.CSStransformName, 'translateX(0px)');\r\n        G.$E.conTn.css( G.CSStransformName, 'none');\r\n      }\r\n      \r\n      // setTimeout(function(){ GalleryRenderPart3(albumIdx) }, 60);\r\n      requestTimeout(function(){ GalleryRenderPart3(albumIdx) }, 60);\r\n      // GalleryRenderPart3(albumIdx);\r\n\r\n    }\r\n    \r\n    // Gallery render part 2 -> start building the new gallery\r\n    function GalleryRenderPart3(albumIdx) {\r\n      var d = new Date();      \r\n      \r\n      G.$E.conTnParent.css( 'opacity', 1);\r\n\r\n      G.GOM.items = [];\r\n      G.GOM.displayedMoreSteps = 0;\r\n      // retrieve label height      \r\n      if( G.O.thumbnailLabel.get('position') == 'onBottom' ) {\r\n        // retrieve height each time because size can change depending on thumbnail's settings\r\n        G.tn.labelHeight[G.GOM.curNavLevel]=ThumbnailGetLabelHeight();\r\n      }\r\n      else {\r\n        G.tn.labelHeight[G.GOM.curNavLevel]=0;\r\n      }\r\n      G.GOM.albumIdx=albumIdx;\r\n\r\n      TriggerCustomEvent('galleryRenderEnd');\r\n      var fu=G.O.fnGalleryRenderEnd;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(albumIdx) : window[fu](albumIdx);\r\n      }\r\n\r\n      // Step 1: populate GOM\r\n      if( GalleryPopulateGOM() ) {\r\n\r\n        // step 2: calculate layout\r\n        GallerySetLayout();\r\n\r\n        // step 3: display gallery\r\n        GalleryAppear();\r\n        // GalleryDisplay( false );\r\n        GalleryDisplayPart1( false );\r\n        // setTimeout(function(){ GalleryDisplayPart2( false ) }, 120);\r\n        requestTimeout(function(){ GalleryDisplayPart2( false ) }, 120);\r\n      }\r\n      else {\r\n        G.galleryResizeEventEnabled = true;\r\n      }\r\n      \r\n      if( G.O.debugMode ) { console.log('GalleryRenderPart3: '+ (new Date()-d)); }\r\n\r\n    }\r\n    \r\n    \r\n    // Resize the gallery\r\n    function GalleryResize() {\r\n      var d = new Date();\r\n      G.galleryResizeEventEnabled = false;\r\n      // G.GOM.cache.areaWidth=G.$E.conTnParent.width();\r\n      if( GallerySetLayout() == false ) {\r\n        G.galleryResizeEventEnabled = true;\r\n        if( G.O.debugMode ) { console.log('GalleryResize1: '+ (new Date()-d)); }\r\n        return;\r\n      }\r\n      if( G.O.debugMode ) { console.log('GalleryResizeSetLayout: '+ (new Date()-d)); }\r\n\r\n      GalleryDisplayPart1( false );\r\n      GalleryDisplayPart2( false );\r\n\r\n      if( G.O.debugMode ) { console.log('GalleryResizeFull: '+ (new Date()-d)); }\r\n    }\r\n    \r\n    \r\n    \r\n    // copy items (album content) to GOM\r\n    function GalleryPopulateGOM() {\r\n      \r\n      var preloadImages = '';\r\n      var imageSizeRequested = false;\r\n      var albumID = G.I[G.GOM.albumIdx].GetID();\r\n      var l = G.I.length;\r\n      var cnt = 0;\r\n\r\n      for( var idx = 0; idx < l; idx++ ) {\r\n        var item = G.I[idx];\r\n        // check album\r\n        if( item.isToDisplay(albumID) ) {\r\n          var w = item.thumbImg().width;\r\n          var h = item.thumbImg().height;\r\n          // if unknown image size and layout is not grid --> we need to retrieve the size of the images\r\n          if( G.layout.prerequisite.imageSize && ( w == 0 || h == 0) ) {\r\n          // if( true ) {\r\n            imageSizeRequested = true;\r\n            preloadImages += '<img src=\"'+item.thumbImg().src+'\" data-idx=\"'+cnt+'\" data-albumidx=\"'+G.GOM.albumIdx+'\">';\r\n          }\r\n          \r\n          // set default size if required\r\n          if( h == 0 ) {\r\n            h = G.tn.defaultSize.getHeight();\r\n          }\r\n          if( w == 0 ) {\r\n            w = G.tn.defaultSize.getWidth();\r\n          }\r\n          var tn = new G.GOM.GTn(idx, w, h);\r\n          G.GOM.items.push(tn);\r\n          cnt++;\r\n        }\r\n      }\r\n\r\n      TriggerCustomEvent('galleryObjectModelBuilt');\r\n      var fu = G.O.fnGalleryObjectModelBuilt;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu() : window[fu]();\r\n      }\r\n      \r\n      if( imageSizeRequested ) {\r\n        // preload images to retrieve their size and then resize the gallery (=GallerySetLayout()+ GalleryDisplay())\r\n        var $newImg = jQuery(preloadImages);\r\n        var gi_imgLoad = ngimagesLoaded( $newImg );\r\n        $newImg = null;\r\n        gi_imgLoad.on( 'progress', function( instance, image ) {\r\n        \r\n          if( image.isLoaded ) {\r\n            var idx = image.img.getAttribute('data-idx');\r\n            var albumIdx = image.img.getAttribute('data-albumidx');\r\n            if( albumIdx == G.GOM.albumIdx ) {\r\n              // ignore event if not on current album\r\n              var curTn = G.GOM.items[idx];\r\n              curTn.imageWidth = image.img.naturalWidth;\r\n              curTn.imageHeight = image.img.naturalHeight;\r\n              var item = G.I[curTn.thumbnailIdx];\r\n              item.thumbs.width[G.GOM.curNavLevel][G.GOM.curWidth] = curTn.imageWidth;\r\n              item.thumbs.height[G.GOM.curNavLevel][G.GOM.curWidth] = curTn.imageHeight;\r\n \r\n              // resize the gallery\r\n              G.GalleryResizeThrottled();\r\n              \r\n              // set the retrieved size to all levels with same configuration  \r\n              var object = item.thumbs.width.l1;\r\n              for (var property in object) {\r\n                if (object.hasOwnProperty(property)) {\r\n                  if( property != G.GOM.curWidth ) {\r\n                    if( G.tn.settings.width.l1[property] == G.tn.settings.getW() && G.tn.settings.height.l1[property] == G.tn.settings.getH() ) {\r\n                      item.thumbs.width.l1[property] = curTn.imageWidth;\r\n                      item.thumbs.height.l1[property] = curTn.imageHeight;\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n              object = item.thumbs.width.lN;\r\n              for (var property in object) {\r\n                if (object.hasOwnProperty(property)) {\r\n                  if( property != G.GOM.curWidth ) {\r\n                    if( G.tn.settings.width.lN[property] == G.tn.settings.getW() && G.tn.settings.height.lN[property] == G.tn.settings.getH() ) {\r\n                      item.thumbs.width.lN[property] = curTn.imageWidth;\r\n                      item.thumbs.height.lN[property] = curTn.imageHeight;\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        });\r\n        G.galleryResizeEventEnabled = true;\r\n        return false;\r\n      }\r\n      else {\r\n        return true;\r\n      }\r\n      \r\n    }\r\n    \r\n    //----- Calculate the layout of the thumbnails\r\n    function GallerySetLayout() {\r\n      var r = true;\r\n      // width of the available area\r\n      G.GOM.cache.areaWidth = G.$E.conTnParent.width();\r\n      G.GOM.displayArea = { width:0, height:0 };\r\n\r\n      switch( G.layout.engine ) {\r\n        case 'JUSTIFIED':\r\n          r = GallerySetLayoutWidthtAuto();\r\n          break;\r\n        case 'CASCADING':\r\n          r = GallerySetLayoutHeightAuto();\r\n          break;\r\n        case 'MOSAIC':\r\n          r = GallerySetLayoutMosaic();\r\n          break;\r\n        case 'GRID':\r\n        default:\r\n          r = GallerySetLayoutGrid();\r\n          break;\r\n      }\r\n      \r\n      TriggerCustomEvent('galleryLayoutApplied');\r\n      var fu = G.O.fnGalleryLayoutApplied;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu() : window[fu]();\r\n      }\r\n      return r;\r\n\r\n    }\r\n    \r\n    \r\n    //----- CASCADING LAYOUT\r\n    function GallerySetLayoutHeightAuto() {\r\n      var curCol =      0,\r\n      areaWidth =       G.GOM.cache.areaWidth,\r\n      curRow =          0,\r\n      colHeight =       [],\r\n      maxCol =          NbThumbnailsPerRow(areaWidth),\r\n      gutterWidth =     0,\r\n      gutterHeight =    G.tn.opt.Get('gutterHeight');\r\n      var w =           0;\r\n      var scaleFactor = 1;\r\n      var tnWidth =     G.tn.defaultSize.getOuterWidth();\r\n      var nbTn =        G.GOM.items.length;\r\n      var curPosY = 0;\r\n\r\n      if( G.O.thumbnailAlignment == 'justified' ) {\r\n        maxCol = Math.min(maxCol, nbTn);\r\n        gutterWidth = ( maxCol == 1 ? 0 : (areaWidth - (maxCol * tnWidth) ) / (maxCol - 1) );\r\n      }\r\n      else {\r\n        gutterWidth=G.tn.opt.Get('gutterWidth');\r\n      }\r\n\r\n\r\n      var borderWidth = G.tn.borderWidth * 2;\r\n      var borderHeight = G.tn.borderHeight * 2;\r\n\r\n      G.GOM.lastFullRow=-1;   // feature disabled\r\n\r\n      // Retrieve the real used width of the area (the evaluation is based on the content of the first line)\r\n      if( G.O.thumbnailAlignment == 'fillWidth' ) {\r\n        // fillWidth --> evaluate scale factor and number of columns\r\n        var totalGutterWidth = (maxCol - 1) * gutterWidth;\r\n        scaleFactor = (areaWidth - totalGutterWidth) / (maxCol * tnWidth);\r\n        if( scaleFactor > 1 ) {\r\n          maxCol++; // add one column and re-evaluate the scale factor\r\n        }\r\n        totalGutterWidth = (maxCol - 1) * gutterWidth;\r\n        scaleFactor = Math.min( (areaWidth - totalGutterWidth) / (maxCol*tnWidth), 1);   // no upscale\r\n      }\r\n\r\n      \r\n      tnWidth = tnWidth * scaleFactor;\r\n      var contentWidth = tnWidth - borderWidth;\r\n\r\n      // loop to position the thumbnails, and set their size\r\n      var baseHeight = G.tn.opt.Get('baseGridHeight') * scaleFactor;\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( curTn.deleted == true ) { break; }    // item is logically deleted\r\n        if( curTn.imageHeight > 0 && curTn.imageWidth > 0 ) {\r\n          var curPosX = 0,\r\n          curPosY = 0;\r\n          var imageRatio = curTn.imageHeight / curTn.imageWidth;\r\n          // curTn.resizedContentWidth = tnWidth - borderWidth;\r\n          curTn.resizedContentWidth = contentWidth;\r\n          curTn.resizedContentHeight = curTn.resizedContentWidth * imageRatio;\r\n          if( baseHeight > 0 ) {\r\n            // grid based vertical position\r\n            var t= Math.max( Math.trunc(curTn.resizedContentHeight/baseHeight), 1) ;\r\n            curTn.resizedContentHeight = baseHeight * t + ((t-1)*(borderHeight+gutterHeight));\r\n          }\r\n          \r\n          curTn.height = curTn.resizedContentHeight + borderHeight + G.tn.labelHeight.get();\r\n          curTn.width = tnWidth;\r\n          curTn.row = 0;\r\n          \r\n          if( curRow == 0 ) {\r\n            // first row\r\n            curPosX = curCol * (tnWidth + gutterWidth);\r\n            colHeight[curCol] = curTn.height + gutterHeight;\r\n            \r\n            curCol++;\r\n            if( curCol >= maxCol ) {\r\n              curCol = 0;\r\n              curRow++;\r\n            }\r\n          }\r\n          else {\r\n            var c=0,\r\n            minColHeight=colHeight[0];\r\n            for( var j = 1; j < maxCol; j++) {\r\n              if( (colHeight[j] + 5) < minColHeight ) {     // +5 --> threshold\r\n                minColHeight = colHeight[j];\r\n                c = j;\r\n                //break;\r\n              }\r\n            }\r\n            curPosY = colHeight[c];\r\n            curPosX = c * (tnWidth + gutterWidth);\r\n            colHeight[c] = curPosY + curTn.height + gutterHeight;\r\n          }\r\n\r\n          var x = curPosX;\r\n          if( G.O.RTL) {\r\n            x= w - curPosX - tnWidth;\r\n          }\r\n\r\n          curTn.left = x;\r\n          curTn.top = curPosY;\r\n        }\r\n      }\r\n\r\n      G.GOM.displayArea.width= maxCol * (tnWidth + gutterWidth) - gutterWidth;\r\n      return true;\r\n    }\r\n    \r\n    \r\n    //----- JUSTIFIED LAYOUT\r\n    function GallerySetLayoutWidthtAuto() {\r\n      var curWidth =               0,\r\n      areaWidth =                  G.GOM.cache.areaWidth,\r\n      lastPosX =                   0,\r\n      curPosY =                    0,\r\n      rowLastItem =                [],\r\n      rowNum =                     0,\r\n      rowHeight =                  [],\r\n      bNewRow =                    false,\r\n      cnt =                        0,\r\n      gutterWidth =                G.tn.opt.Get('gutterWidth'),\r\n      gutterHeight =               G.tn.opt.Get('gutterHeight');\r\n      // by grief-of-these-days\r\n      var maxRowHeightVertical =   0; // max height of a row with vertical thumbs\r\n      var maxRowHeightHorizontal = 0; // max height of a row with horizontal thumbs\r\n      var rowHasVertical =         false; // current row has vertical thumbs\r\n      var rowHasHorizontal =       false; // current row has horizontal thumbs\r\n\r\n      var tnHeight = G.tn.defaultSize.getOuterHeight();\r\n      var borderWidth = G.tn.borderWidth * 2;\r\n      var borderHeight = G.tn.borderHeight * 2;\r\n      var nbTnInCurrRow = 1;\r\n      var nbTn = G.GOM.items.length;\r\n\r\n      // first loop --> retrieve each row image height\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( curTn.deleted == true ) { break; }    // item is logically deleted\r\n        if( curTn.imageWidth > 0 ) {\r\n          var imageRatio = curTn.imageWidth / curTn.imageHeight;\r\n          var imageWidth = Math.floor( tnHeight * imageRatio );\r\n\r\n          if( bNewRow ) {\r\n            bNewRow = false;\r\n            rowNum++;\r\n            curWidth = 0;\r\n            rowHasVertical = false;\r\n            rowHasHorizontal = false;\r\n            nbTnInCurrRow = 1;\r\n          }\r\n          // by grief-of-these-days\r\n          if( curTn.imageHeight > curTn.imageWidth ) {\r\n            rowHasVertical = true;\r\n          }\r\n          else {\r\n            rowHasHorizontal = true;\r\n          }\r\n          \r\n          if( (curWidth + gutterWidth + imageWidth) < (areaWidth - (nbTnInCurrRow * borderWidth)) ) {\r\n            // enough place left in the current row\r\n            curWidth += imageWidth + gutterWidth;\r\n            rowHeight[rowNum] = tnHeight;\r\n            \r\n            // prevent incomplete row from being heigher than the previous ones.\r\n            // by grief-of-these-days\r\n            var rowHeightLimit = Math.max(rowHasVertical ? maxRowHeightVertical : 0, rowHasHorizontal ? maxRowHeightHorizontal : 0);\r\n            if( rowHeightLimit > 0 ) {\r\n              rowHeight[rowNum] = Math.min(rowHeight[rowNum], rowHeightLimit);\r\n            }\r\n            \r\n            rowLastItem[rowNum] = i;\r\n          }\r\n          else {\r\n            // new row after current item --> we need to adujet the row height to have enough space for the current thumbnail\r\n            curWidth += gutterWidth+imageWidth;\r\n            var ratio = (areaWidth - nbTnInCurrRow * borderWidth) / curWidth;\r\n            var rH = Math.floor(tnHeight * ratio);\r\n            rowHeight[rowNum] = rH;\r\n            \r\n            // save the max row height for each thumb orientation.\r\n            // by grief-of-these-days\r\n            if( rowHasVertical ) {\r\n              maxRowHeightVertical = Math.max( maxRowHeightVertical, rH );\r\n            }\r\n            if( rowHasHorizontal ) {\r\n              maxRowHeightHorizontal = Math.max( maxRowHeightHorizontal, rH );\r\n            }\r\n            \r\n            rowLastItem[rowNum] = i;\r\n            bNewRow = true;\r\n          }\r\n          cnt++;\r\n          nbTnInCurrRow++;\r\n        }\r\n      }\r\n\r\n      rowNum = 0;\r\n      curPosY = 0;\r\n      lastPosX = 0;\r\n      cnt = 0;\r\n      \r\n      G.GOM.lastFullRow = 0;    // display at leat 1 row (even if not full)\r\n      \r\n      // second loop --> calculate each thumbnail size\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( curTn.imageWidth > 0 ) {\r\n          var imageRatio = curTn.imageWidth / curTn.imageHeight;\r\n          var imageWidth = Math.floor( imageRatio * rowHeight[rowNum] ); // border is already NOT included\r\n\r\n          if( i == rowLastItem[rowNum] ) {\r\n            // row last item --> adjust image width because of rounding problems\r\n            if( rowLastItem.length != (rowNum+1) ) {\r\n              // last item in current row -> use the full remaining width\r\n              imageWidth = areaWidth - lastPosX - borderWidth;\r\n            }\r\n            else {\r\n              // very last item (on the last row)\r\n              if( (lastPosX + gutterWidth + imageWidth + borderWidth ) > areaWidth ) {\r\n                // reduce size if image is wider as the remaining space\r\n                imageWidth = areaWidth - lastPosX - borderWidth;\r\n              }\r\n            }\r\n          }\r\n          \r\n          var rh = parseInt( rowHeight[rowNum] );\r\n          imageWidth = parseInt( imageWidth );\r\n\r\n          // thumbnail image size\r\n          curTn.resizedContentWidth = imageWidth;\r\n          curTn.resizedContentHeight = rh;\r\n          // thumbnail position and size\r\n          curTn.width = imageWidth + borderWidth;\r\n          curTn.height= rh + G.tn.labelHeight.get() + borderHeight;\r\n          curTn.row = rowNum;\r\n\r\n          curTn.top = curPosY;\r\n          var x = lastPosX;\r\n          if( G.O.RTL) {\r\n            x = areaWidth - lastPosX - curTn.width ;\r\n          }\r\n          curTn.left = x;\r\n\r\n          lastPosX += curTn.width + gutterWidth;\r\n\r\n          if( i == rowLastItem[rowNum] ) {\r\n            // start a new row\r\n            curPosY += curTn.height + gutterHeight;\r\n            G.GOM.lastFullRow = rowNum - 1;\r\n            rowNum++;\r\n            lastPosX = 0;\r\n          }\r\n          cnt++;\r\n        }\r\n        else {\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      if( false ) { var curTn, i, item, hoveredTn, newTop; }\r\n      \r\n      G.GOM.displayArea.width = areaWidth;\r\n      return true;\r\n    }    \r\n    \r\n\r\n    //----- MOSAIC LAYOUT\r\n    // Grid using a user defined pattern layout\r\n    // With this layout, a pattern definition is handeld a row\r\n    function GallerySetLayoutMosaic() {\r\n      var areaWidth =     G.GOM.cache.areaWidth;\r\n      var gutterHeight =  G.tn.opt.Get('gutterHeight');\r\n      var gutterWidth =   G.tn.opt.Get('gutterWidth');\r\n      var borderWidth =   G.tn.borderWidth * 2;\r\n      var borderHeight =  G.tn.borderHeight * 2;\r\n\r\n      var nbTn = G.GOM.items.length;\r\n      var row = 0;\r\n      var h = 0;\r\n      var n = 0;\r\n      \r\n      \r\n      // first loop: evaluate the gallery width based on the first row\r\n      var nbCols = 0;\r\n      var maxW = 0;\r\n      var mosaicPattern = G.tn.settings.getMosaic();\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curPatternElt = mosaicPattern[n];\r\n\r\n        var cLeft = (curPatternElt.c - 1) * G.tn.defaultSize.getOuterWidth() + (curPatternElt.c - 1) * gutterWidth;\r\n        var cWidth = curPatternElt.w * G.tn.defaultSize.getOuterWidth() + (curPatternElt.w - 1) * gutterWidth;\r\n        \r\n        maxW=Math.max(maxW, cLeft + cWidth );\r\n        \r\n        nbCols=Math.max(nbCols, (curPatternElt.c - 1) + curPatternElt.w );\r\n\r\n        n++;\r\n        if( n >= mosaicPattern.length ) {\r\n          // end of pattern\r\n          break;\r\n        }\r\n      }\r\n      var totalGutterWidth = (nbCols - 1) * gutterWidth;\r\n      var scaleFactor = Math.min( (areaWidth - totalGutterWidth ) / ( maxW - totalGutterWidth ), 1);\r\n      \r\n      // second loop: position all the thumbnails based on the layout pattern\r\n      row = 0;\r\n      n = 0;\r\n      var mosaicPattern = G.tn.settings.getMosaic();\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        var curPatternElt = mosaicPattern[n];\r\n        \r\n        curTn.top = (curPatternElt.r - 1) * G.tn.defaultSize.getOuterHeight()*scaleFactor + (curPatternElt.r - 1) * gutterHeight + row * h + (G.tn.labelHeight.get()*(curPatternElt.r-1)) ;\r\n        if( row > 0 ) {\r\n          curTn.top += gutterHeight;\r\n        }\r\n\r\n        curTn.left = (curPatternElt.c - 1) * G.tn.defaultSize.getOuterWidth()*scaleFactor + (curPatternElt.c - 1) * gutterWidth;\r\n\r\n        curTn.height = curPatternElt.h * G.tn.defaultSize.getOuterHeight() * scaleFactor + (curPatternElt.h - 1) * gutterHeight + (G.tn.labelHeight.get() * curPatternElt.h);\r\n        curTn.resizedContentHeight = curTn.height - G.tn.labelHeight.get() - borderHeight;\r\n\r\n        curTn.width = curPatternElt.w * G.tn.defaultSize.getOuterWidth()*scaleFactor + (curPatternElt.w - 1) * gutterWidth;\r\n        curTn.resizedContentWidth = curTn.width - borderWidth ;\r\n\r\n        curTn.row = row;\r\n        if( row == 0 ) {\r\n          h=Math.max(h, curTn.top + curTn.height);\r\n        }\r\n\r\n        n++;\r\n        if( n >= mosaicPattern.length ) {\r\n          // end pattern -> new line\r\n          n = 0;\r\n          row++;\r\n        }\r\n      }\r\n      \r\n      G.GOM.displayArea.width = (maxW - totalGutterWidth) * scaleFactor + totalGutterWidth;\r\n      return true;\r\n    }\r\n    \r\n    \r\n    \r\n    // --- GRID LAYOUT\r\n    function GallerySetLayoutGrid() {\r\n      var curPosX=      0,\r\n      curPosY=          0,   \r\n      areaWidth=        G.GOM.cache.areaWidth,\r\n      gutterWidth=      0,\r\n      gutterHeight=     G.tn.opt.Get('gutterHeight'),\r\n      maxCol=           NbThumbnailsPerRow(areaWidth),\r\n      w=                0,\r\n      cols=             [],\r\n      curCol=           0,\r\n      newAreaWidth =    areaWidth,\r\n      tnWidth=          G.tn.defaultSize.getOuterWidth();\r\n      var scaleFactor = 1;\r\n      var nbTn=         G.GOM.items.length;\r\n      var borderWidth = G.tn.borderWidth * 2;\r\n      var borderHeight =G.tn.borderHeight * 2;\r\n      \r\n      // retrieve gutter width\r\n      if( G.O.thumbnailAlignment == 'justified' ) {\r\n        maxCol = Math.min( maxCol, nbTn);\r\n        gutterWidth = (maxCol==1 ? 0 : (areaWidth-(maxCol*tnWidth))/(maxCol-1));\r\n      }\r\n      else {\r\n        gutterWidth = G.tn.opt.Get('gutterWidth');\r\n      }\r\n\r\n      // first loop to retrieve the real used width of the area (the evaluation is based on the content of the first line)\r\n      // Retrieve the real used width of the area (the evaluation is based on the content of the first line)\r\n      if( G.O.RTL || G.O.thumbnailAlignment == 'fillWidth' ) {\r\n        // scaled --> evaluate scale factor and number of columns\r\n        var totalGutterWidth = (maxCol-1) * gutterWidth;\r\n        scaleFactor = (areaWidth - totalGutterWidth) / (maxCol*tnWidth);\r\n        if( scaleFactor > 1 ) {\r\n          maxCol++; // add one column and re-evaluate the scale factor\r\n        }\r\n        totalGutterWidth = (maxCol-1) * gutterWidth;\r\n        scaleFactor = Math.min( (areaWidth - totalGutterWidth) / (maxCol*tnWidth), 1);   // no upscale\r\n        newAreaWidth = (maxCol*tnWidth) + totalGutterWidth;\r\n      }\r\n\r\n      \r\n      G.GOM.lastFullRow = 0 ;    // display at leat 1 row (even if not full)\r\n      var lastPosY = 0;\r\n      var row = 0;\r\n      \r\n      tnWidth = tnWidth * scaleFactor;\r\n      var contentWidth = tnWidth - borderWidth;\r\n      var tnHeight = G.tn.defaultSize.getOuterHeight() * scaleFactor + G.tn.labelHeight.get();\r\n      var contentHeight = G.tn.defaultSize.getOuterHeight() * scaleFactor - borderHeight;\r\n      \r\n      // loop to position and to set size of all thumbnails\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        if( curPosY == 0 ) {\r\n          curPosX = curCol * (tnWidth + gutterWidth)\r\n          cols[curCol] = curPosX;\r\n          w = curPosX + tnWidth;\r\n        }\r\n        else {\r\n          curPosX = cols[curCol];\r\n        }\r\n\r\n        var x = curPosX;\r\n        if( G.O.RTL ) {\r\n          x = parseInt(newAreaWidth) - curPosX - tnWidth;\r\n        }\r\n        \r\n        // MANDATORY : set thumbnail position AND size\r\n        var curTn=G.GOM.items[i];\r\n        curTn.top = curPosY;\r\n        curTn.left = x;\r\n        curTn.height = tnHeight;\r\n        curTn.width = tnWidth;\r\n        // image size\r\n        if( G.O.thumbnailAlignment == 'fillWidth' ) {\r\n          curTn.resizedContentWidth = contentWidth;\r\n          curTn.resizedContentHeight = contentHeight;\r\n        }\r\n        curTn.row = row;\r\n        lastPosY = curPosY;\r\n\r\n        curCol++;\r\n        if( curCol >= maxCol ){\r\n          // new line\r\n          curCol = 0;\r\n          curPosY += tnHeight + gutterHeight;\r\n          G.GOM.lastFullRow = row;\r\n          row++;\r\n        }\r\n      }\r\n      G.GOM.displayArea.width = w;\r\n      return true;\r\n    }\r\n\r\n\r\n    //----- Display the thumbnails according to the calculated layout\r\n    function GalleryDisplayPart1( forceTransition ) {\r\n      if( G.CSStransformName == null ) {\r\n        G.$E.conTn.css( 'left' , '0px');\r\n      }\r\n      else {\r\n        G.$E.conTn.css( G.CSStransformName , 'none');\r\n      }\r\n      CacheViewport();\r\n    }\r\n    \r\n    function CacheViewport() {\r\n      G.GOM.cache.viewport = getViewport();\r\n      G.GOM.cache.areaWidth = G.$E.conTnParent.width();\r\n      G.GOM.cache.containerOffset = G.$E.conTnParent.offset();\r\n    }\r\n\r\n\r\n    \r\n    function GalleryDisplayPart2( forceTransition ) {\r\n\r\n      var nbTn = G.GOM.items.length;\r\n      G.GOM.itemsDisplayed = 0;\r\n      var threshold = 50;\r\n      var cnt = 0;    // counter for delay between each thumbnail display\r\n      \r\n\r\n      GalleryRenderGetInterval();\r\n      \r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( i >= G.GOM.displayInterval.from && cnt < G.GOM.displayInterval.len ) {\r\n          curTn.inDisplayArea = true;\r\n          if( forceTransition ) {\r\n            curTn.neverDisplayed = true;\r\n          }\r\n          G.GOM.itemsDisplayed++;\r\n          cnt++;\r\n        }\r\n        else{\r\n          curTn.inDisplayArea = false;\r\n        }\r\n      }\r\n\r\n      // bottom of the gallery (pagination, more button...)\r\n      GalleryBottomManage();\r\n\r\n      var tnToDisplay = [];\r\n      var tnToReDisplay = [];\r\n      \r\n      G.GOM.clipArea.top = -1;\r\n      cnt = 0 ;\r\n      var lastTnIdx = -1;\r\n      G.GOM.clipArea.height = 0;\r\n      // NOTE: loop always the whole GOM.items --> in case an already displayed thumbnail needs to be removed\r\n      for( var i = 0; i < nbTn ; i++ ) {\r\n        var curTn = G.GOM.items[i];\r\n        if( curTn.inDisplayArea ) {\r\n          if( G.GOM.clipArea.top == -1 ) {\r\n            G.GOM.clipArea.top = curTn.top;\r\n          }\r\n          if( (curTn.top - G.GOM.clipArea.top) <= -1 ) {\r\n            // with mosaic layout, the first thumbnail may not give the top position\r\n            G.GOM.clipArea.top = curTn.top;\r\n          }\r\n\r\n          G.GOM.clipArea.height = Math.max( G.GOM.clipArea.height, curTn.top-G.GOM.clipArea.top + curTn.height);\r\n        \r\n          if( curTn.neverDisplayed ) {\r\n            // thumbnail is not displayed -> check if in viewport to display or not\r\n            var top = G.GOM.cache.containerOffset.top + (curTn.top - G.GOM.clipArea.top);\r\n            // var left=containerOffset.left+curTn.left;\r\n            if( (top + curTn.height) >= (G.GOM.cache.viewport.t - threshold) && top <= (G.GOM.cache.viewport.t + G.GOM.cache.viewport.h + threshold) ) {\r\n              // build thumbnail\r\n              var item = G.I[curTn.thumbnailIdx];\r\n              if( item.$elt == null ) {\r\n                ThumbnailBuild( item, curTn.thumbnailIdx, i, (i+1) == nbTn );\r\n              }\r\n              tnToDisplay.push({idx:i, delay:cnt});\r\n              cnt++;\r\n            }\r\n          }\r\n          else {\r\n            tnToReDisplay.push({idx: i, delay: 0});\r\n          }\r\n          // G.GOM.itemsDisplayed++;\r\n          lastTnIdx = i;\r\n        }\r\n        else {\r\n          curTn.displayed = false;\r\n          var item = G.I[curTn.thumbnailIdx];\r\n          if( item.$elt != null ){\r\n            item.$elt.css({ opacity: 0, display: 'none' });\r\n          }\r\n        }\r\n      }\r\n\r\n      var areaWidth = G.$E.conTnParent.width();\r\n\r\n      // set gallery area really used size\r\n      // if( G.GOM.displayArea.width != G.GOM.displayAreaLast.width || G.GOM.displayArea.height != G.GOM.displayAreaLast.height ) {\r\n      if( G.GOM.displayArea.width != G.GOM.displayAreaLast.width || G.GOM.clipArea.height != G.GOM.displayAreaLast.height ) {\r\n        G.$E.conTn.width( G.GOM.displayArea.width ).height( G.GOM.clipArea.height );\r\n        G.GOM.displayAreaLast.width = G.GOM.displayArea.width;\r\n        G.GOM.displayAreaLast.height = G.GOM.clipArea.height;\r\n        // G.GOM.displayAreaLast.height=G.GOM.displayArea.height-G.GOM.clipArea.top;\r\n      }\r\n\r\n      if( areaWidth != G.$E.conTnParent.width() ) {\r\n        // gallery area width changed since layout calculation (for example when a scrollbar appeared)\r\n        // so we need re-calculate the layout before displaying the thumbnails\r\n        G.GOM.cache.areaWidth = G.$E.conTnParent.width();\r\n        GallerySetLayout();\r\n        GalleryDisplayPart1( forceTransition );\r\n        GalleryDisplayPart2( forceTransition );\r\n        return;\r\n      }\r\n\r\n      // counter of not displayed images (is displayed on the last thumbnail)\r\n      if( G.layout.support.rows ) {\r\n        if( G.galleryDisplayMode.Get() == 'ROWS' || (G.galleryDisplayMode.Get() == 'FULLCONTENT' && G.galleryLastRowFull.Get() && G.GOM.lastFullRow != -1) ){\r\n          if( lastTnIdx < (nbTn - 1) ) {\r\n            G.GOM.lastDisplayedIdxNew = lastTnIdx;\r\n          }\r\n          else {\r\n            G.GOM.lastDisplayedIdxNew =- 1;\r\n          }\r\n          // remove last displayed counter\r\n          if( G.GOM.lastDisplayedIdx != -1 ) {\r\n            var item = G.I[G.GOM.items[G.GOM.lastDisplayedIdx].thumbnailIdx];\r\n            item.$getElt('.nGY2GThumbnailIconsFullThumbnail').html('');\r\n          }\r\n        }\r\n      }\r\n\r\n      \r\n      // batch set position (and display animation) to all thumbnails\r\n      // first display newly built thumbnails\r\n      var nbBuild = tnToDisplay.length;\r\n      G.GOM.thumbnails2Display=[];\r\n      for( var i = 0; i < nbBuild ; i++ ) {\r\n        // ThumbnailSetPosition(tnToDisplay[i].idx, tnToDisplay[i].delay+10);\r\n        ThumbnailSetPosition(tnToDisplay[i].idx, i);\r\n      }\r\n      \r\n      // then re-position already displayed thumbnails\r\n      var n = tnToReDisplay.length;\r\n      for( var i = 0; i < n ; i++ ) {\r\n        // ThumbnailSetPosition(tnToReDisplay[i].idx, nbBuild+1);\r\n        ThumbnailSetPosition(tnToReDisplay[i].idx, i);\r\n      }\r\n      \r\n      ThumbnailDisplayAnimBatch();\r\n\r\n      if( G.tn.opt.Get('displayTransition') == 'NONE' ) {\r\n        G.galleryResizeEventEnabled = true;\r\n        // GalleryThumbnailSliderBuildAndStart();  // image slider on last displayed thumbnail\r\n        TriggerCustomEvent('galleryDisplayed');\r\n      }\r\n      else {\r\n        // setTimeout(function() {\r\n        requestTimeout( function() {\r\n          // change value after the end of the display transistion of the newly built thumbnails\r\n          G.galleryResizeEventEnabled = true;\r\n          // GalleryThumbnailSliderBuildAndStart();  // image slider on last displayed thumbnail\r\n          TriggerCustomEvent('galleryDisplayed');\r\n        }, nbBuild * G.tn.opt.Get('displayInterval'));\r\n      }\r\n      \r\n    }\r\n    \r\n    \r\n    // Thumbnail: set the new position\r\n    function ThumbnailSetPosition( GOMidx, cnt ) {\r\n      var newTop=   0;\r\n      var curTn=    G.GOM.items[GOMidx];\r\n      var idx=      G.GOM.items[GOMidx].thumbnailIdx;\r\n      var item=     G.I[idx];\r\n    \r\n      if( curTn.neverDisplayed ) {\r\n        // thumbnail is built but has never been displayed (=first display)\r\n        var top = curTn.top - G.GOM.clipArea.top;\r\n        if( G.tn.opt.Get('stacks') > 0 ) {\r\n          // we have stacks -> do not display them here. They will be displayed at the end of the display animation\r\n          item.$elt.last().css({ display: 'block'});\r\n          item.$elt.css({ top: top , left: curTn.left });\r\n        }\r\n        else {\r\n          item.$elt.css({ display: 'block', top: top , left: curTn.left });\r\n        }\r\n        newTop=top;\r\n        \r\n        // display the image of the thumbnail when fully loaded\r\n        if( G.O.thumbnailWaitImageLoaded === true ) {\r\n          var gi_imgLoad = ngimagesLoaded( item.$getElt('.nGY2TnImg2') );\r\n          gi_imgLoad.on( 'progress', function( instance, image ) {\r\n            if( image.isLoaded ) {\r\n              var albumIdx = image.img.getAttribute('data-albumidx');\r\n              if( albumIdx == G.GOM.albumIdx ) {\r\n                // ignore event if not on current album\r\n                var idx = image.img.getAttribute('data-idx');\r\n                G.I[idx].ThumbnailImageReveal();\r\n              }\r\n            }\r\n          });\r\n        }\r\n        // display the thumbnail\r\n        ThumbnailAppear(GOMidx, cnt);\r\n\r\n        curTn.displayed = true;\r\n        curTn.neverDisplayed = false;\r\n      }\r\n      else {\r\n        var topOld = G.GOM.cache.containerOffset.top + item.top;\r\n        var top = G.GOM.cache.containerOffset.top + (curTn.top - G.GOM.clipArea.top);\r\n        newTop = curTn.top - G.GOM.clipArea.top;\r\n        var vp = G.GOM.cache.viewport;\r\n        if( G.O.thumbnailDisplayOutsideScreen || ( ( (topOld + curTn.height) >= (vp.t - vp.h) && topOld <= (vp.t + vp.h * 4) ) ||\r\n              ( (top + curTn.height) >= (vp.t - vp.h) && top <= (vp.t + vp.h * 4) ) )  ) {\r\n          // thumbnail positioned in enlarged viewport (viewport + 4 x viewport height) (v1.5: changed from 2 to 4)\r\n          if( curTn.displayed ) {\r\n            // thumbnail is displayed\r\n            if( item.top != curTn.top || item.left != curTn.left ) {\r\n              // set position\r\n              if( G.O.galleryResizeAnimation == true ) {\r\n                // with transition\r\n                var tweenable = new NGTweenable();\r\n                tweenable.tween({\r\n                  from:       { top: item.top, left: item.left,  height: item.height,  width: item.width },\r\n                  to:         { top: newTop,   left: curTn.left, height: curTn.height, width: curTn.width },\r\n                  attachment: { $e: item.$elt },\r\n                  duration:   100,\r\n                  delay:      cnt * G.tn.opt.Get('displayInterval') / 5,\r\n                  // easing:     'easeInOutQuad',\r\n                  easing:     'easeOutQuart',\r\n                  step:       function (state, att) {\r\n                    // window.ng_draf( function() {\r\n                      att.$e.css(state);\r\n                    // });\r\n                  },\r\n                  finish:     function (state, att) {\r\n                    var _this=this;\r\n                    // window.ng_draf( function() {\r\n                      _this.dispose();\r\n                    // });\r\n                  }\r\n                });\r\n              }\r\n              else {\r\n                // set position without transition\r\n                // item.$elt.css({ top: curTn.top , left: curTn.left });\r\n                item.$elt.css({ top: newTop , left: curTn.left });\r\n              }\r\n            }\r\n          }\r\n          else {\r\n            // re-display thumbnail\r\n            curTn.displayed = true;\r\n            // item.$elt.css({ display: 'block', top: curTn.top , left: curTn.left, opacity:1 });\r\n            item.$elt.css({ display: 'block', top: newTop, left: curTn.left, opacity: 1 });\r\n            ThumbnailAppearFinish(item);\r\n          }\r\n        }\r\n        else {\r\n          // undisplay thumbnail if not in viewport+margin --> performance gain\r\n          curTn.displayed = false;\r\n          item.$elt.css({ display: 'none'});\r\n        }\r\n      }\r\n      item.left = curTn.left;\r\n      item.top = newTop;\r\n      \r\n      // set new size if changed\r\n      if( item.width != curTn.width || item.height != curTn.height ) {\r\n        item.$elt.css({ width: curTn.width , height: curTn.height });\r\n        item.width = curTn.width;\r\n        item.height = curTn.height;\r\n        \r\n        // if( curTn.resizedContentWidth > 0 ) {\r\n        // resize also the content (=image)\r\n        if( item.resizedContentWidth != curTn.resizedContentWidth || item.resizedContentHeight != curTn.resizedContentHeight ) {\r\n          if( item.kind == 'albumUp' ) {\r\n            // item.$getElt('.nGY2GThumbnailAlbumUp').css({'height': curTn.resizedContentHeight, 'width': curTn.resizedContentWidth});\r\n          }\r\n          else {\r\n            item.$getElt('.nGY2GThumbnailImage').css({'height': curTn.resizedContentHeight, 'width': curTn.resizedContentWidth});\r\n\r\n            if( G.layout.engine == 'JUSTIFIED'  ) {\r\n              item.$getElt('.nGY2GThumbnailImg').css({'height': curTn.resizedContentHeight, 'width': curTn.resizedContentWidth});\r\n            }\r\n          }\r\n          item.resizedContentWidth = curTn.resizedContentWidth;\r\n          item.resizedContentHeight = curTn.resizedContentHeight;\r\n        }\r\n      }\r\n      \r\n      \r\n      // add counter of remaining (not displayed) images \r\n      if( G.GOM.lastDisplayedIdxNew == GOMidx &&  G.layout.support.rows ) {\r\n        if( (G.galleryDisplayMode.Get() == 'ROWS' && G.galleryMaxRows.Get() > 0) || (G.galleryDisplayMode.Get() == 'FULLCONTENT' && G.galleryLastRowFull.Get() && G.GOM.lastFullRow != -1) ){\r\n          // number of items\r\n          var nb = G.GOM.items.length - GOMidx - 1;\r\n          if( item.albumID != '0' && G.O.thumbnailLevelUp ) {\r\n            nb--;\r\n          }\r\n\r\n          if( nb > 0 ) {\r\n            // display counter\r\n            if( G.O.thumbnailOpenImage || G.O.thumbnailSliderDelay > 0  ) {\r\n              item.$getElt('.nGY2GThumbnailIconsFullThumbnail').html( '+' + nb);\r\n            }\r\n\r\n            // if( G.layout.engine == 'GRID' && G.GOM.slider.hostItem != G.GOM.NGY2Item(GOMidx) ) {\r\n            // image slider on last displayed thumbnail\r\n            if( G.GOM.slider.hostItem != G.GOM.NGY2Item(GOMidx) ) {\r\n\r\n              // set current slider back to initial content\r\n              GalleryThumbnailSliderSetContent( G.GOM.slider.hostItem );\r\n              // new slider\r\n              G.GOM.slider.hostIdx = GOMidx;\r\n              G.GOM.slider.hostItem = G.GOM.NGY2Item(GOMidx);\r\n              G.GOM.slider.nextIdx = GOMidx;\r\n              G.GOM.slider.currentIdx = GOMidx;\r\n              GalleryThumbnailSliderBuildAndStart();  // image slider on last displayed thumbnail\r\n              // GalleryThumbnailSliderSetNextContent();\r\n            }\r\n          }\r\n          else {\r\n            // reset slider content to initial content because all thumbnails are displayed\r\n            GalleryThumbnailSliderSetContent( G.GOM.slider.hostItem );\r\n            G.GOM.slider.hostIdx = -1;\r\n          }\r\n          \r\n          G.GOM.lastDisplayedIdx = GOMidx;\r\n        }\r\n      }\r\n\r\n    }\r\n    \r\n    // ---------------------\r\n    // replace image on last thumbnails with not displayed ones (mode ROWS or FULLCONTENT with galleryLastRowFull enabled)\r\n    // function GalleryLastThumbnailSlideImage() {\r\n    function GalleryThumbnailSliderBuildAndStart() {\r\n\r\n      if( G.O.thumbnailSliderDelay == 0 || G.GOM.slider.hostIdx == -1 ) {\r\n        return;\r\n      }\r\n      clearTimeout(G.GOM.slider.timerID);\r\n      \r\n      var item = G.GOM.slider.hostItem;\r\n\r\n      // dupplicate image layer -> for the next image\r\n      if( item.$getElt('.nGY2TnImgNext').length == 0 ) {\r\n        item.$getElt('.nGY2TnImg').clone().removeClass('nGY2TnImg').addClass('nGY2TnImgNext').insertAfter(item.$getElt('.nGY2TnImg'));\r\n        item.$getElt('.nGY2TnImgBack').clone().removeClass('nGY2TnImgBack').addClass('nGY2TnImgBackNext').insertAfter(item.$getElt('.nGY2TnImg', true));\r\n        item.$getElt('.nGY2GThumbnailImage', true); // important -> refresh the cache\r\n        item.$getElt('.nGY2GThumbnailImg', true);   // important -> refresh the cache\r\n      }\r\n\r\n      item.CSSTransformSet('.nGY2TnImgNext', 'translateX', '100%', true);\r\n      item.CSSTransformApply( '.nGY2TnImgNext' );\r\n      item.CSSTransformSet('.nGY2TnImgBackNext', 'translateX', '100%', true);\r\n      item.CSSTransformApply( '.nGY2TnImgBackNext' );\r\n\r\n      GalleryThumbnailSliderSetNextContent();\r\n      \r\n      // clearTimeout(G.GOM.slider.timerID);\r\n      // G.GOM.slider.timerID = setTimeout(function(){ GalleryThumbnailSliderStartTransition() }, G.O.thumbnailSliderDelay);\r\n      G.GOM.slider.timerID = requestTimeout(function(){ GalleryThumbnailSliderStartTransition() }, G.O.thumbnailSliderDelay);\r\n    }\r\n\r\n    \r\n    function GalleryThumbnailSliderSetNextContent() {\r\n\r\n      G.GOM.slider.nextIdx++;\r\n      if( G.GOM.slider.nextIdx >= G.GOM.items.length ) {\r\n        G.GOM.slider.nextIdx = G.GOM.slider.hostIdx;\r\n      }\r\n      \r\n      // new image\r\n      var newItem = G.GOM.NGY2Item(G.GOM.slider.nextIdx);\r\n      var imgBlurred = G.emptyGif;\r\n      var bgImg = \"url('\" + G.emptyGif + \"')\";\r\n      if( newItem.imageDominantColors != null ) {\r\n        imgBlurred = newItem.imageDominantColors;\r\n        bgImg = \"url('\" + newItem.imageDominantColors + \"')\";\r\n      }\r\n      G.GOM.slider.hostItem.$getElt('.nGY2TnImgBackNext', true).css({'background-image': bgImg, opacity: 1 });\r\n      G.GOM.slider.hostItem.$getElt('.nGY2TnImgNext', true).css({ 'background-image': \"url('\" + newItem.thumbImg().src + \"')\", opacity: 1 });\r\n      G.GOM.slider.hostItem.$getElt('.nGY2TnImgNext .nGY2GThumbnailImg', true).attr('src', newItem.thumbImg().src );\r\n      \r\n\r\n    }\r\n    \r\n    // thumbnail slider - transition from one image to the next one\r\n    function GalleryThumbnailSliderStartTransition() {\r\n      \r\n      if( G.GOM.slider.hostItem.$getElt() != null ) {\r\n\r\n        // slider transition\r\n        var tweenable = new NGTweenable();\r\n        G.GOM.slider.tween = tweenable;\r\n        tweenable.tween({\r\n          from:         { 'left': 100 },\r\n          to:           { 'left': 0 },\r\n          duration:     800,\r\n          delay:        0,\r\n          // easing:       'easeInOutQuad',\r\n          easing:       'easeOutQuart',\r\n          \r\n          step: function (state) {\r\n            if( G.GOM.slider.hostItem.$getElt() == null ) {\r\n              // the thumbnail may have been destroyed since the start of the animation\r\n              G.GOM.slider.tween.stop(false);\r\n              return;\r\n            }\r\n\r\n            // window.ng_draf( function() {\r\n              // slide current content\r\n              G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgBack', 'translateX', -(100 - state.left) + '%');\r\n              G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgBack' );\r\n              G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImg', 'translateX', -(100 - state.left) + '%');\r\n              G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImg' );\r\n\r\n              // slide new content\r\n              G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgBackNext', 'translateX', state.left + '%');\r\n              G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgBackNext' );\r\n              G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgNext', 'translateX', state.left + '%');\r\n              G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgNext' );\r\n            // });\r\n\r\n            \r\n          },\r\n          finish: function (state) {\r\n            if( G.GOM.slider.hostItem.$getElt() == null ) {\r\n              // the thumbnail may be destroyed since the start of the animation\r\n              return;\r\n            }\r\n           \r\n            if( G.GOM.NGY2Item(G.GOM.slider.nextIdx) == null ) { return; } // item does not exist anymore\r\n            \r\n            // window.ng_draf( function() {\r\n              // set new content as current content\r\n              GalleryThumbnailSliderSetContent( G.GOM.NGY2Item(G.GOM.slider.nextIdx) );\r\n              G.GOM.slider.currentIdx = G.GOM.slider.nextIdx;\r\n              GalleryThumbnailSliderSetNextContent();\r\n              \r\n              clearTimeout(G.GOM.slider.timerID);\r\n              // G.GOM.slider.timerID=setTimeout(function(){ GalleryThumbnailSliderStartTransition() }, G.O.thumbnailSliderDelay);\r\n              G.GOM.slider.timerID = requestTimeout(function(){ GalleryThumbnailSliderStartTransition() }, G.O.thumbnailSliderDelay);\r\n            // });\r\n          }\r\n        });\r\n      }\r\n    }\r\n    \r\n    // set main content of the thumbnail hosting the slider\r\n    // hide the elements for the next content of the slider\r\n    function GalleryThumbnailSliderSetContent( ngy2itemContent ) {\r\n        if( G.GOM.slider.hostIdx == -1 ) { return; }\r\n        \r\n        if( G.GOM.slider.tween != null ) {\r\n          if( G.GOM.slider.tween._isTweening  == true ) {\r\n            G.GOM.slider.tween.stop(false);\r\n          }\r\n        }\r\n\r\n        var bgImg = \"url('\" + G.emptyGif + \"')\";\r\n        if( ngy2itemContent.imageDominantColors != null ) {\r\n          bgImg = \"url('\" + ngy2itemContent.imageDominantColors + \"')\";\r\n        }\r\n        G.GOM.slider.hostItem.$getElt('.nGY2TnImgBack').css('background-image', bgImg);\r\n        G.GOM.slider.hostItem.$getElt('.nGY2TnImg').css('background-image', \"url('\" + ngy2itemContent.thumbImg().src + \"')\" );\r\n        G.GOM.slider.hostItem.$getElt('.nGY2TnImg .nGY2GThumbnailImg').attr('src', ngy2itemContent.thumbImg().src );\r\n        \r\n        G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgBack', 'translateX', '0');\r\n        G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgBack' );\r\n        G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImg', 'translateX', '0');\r\n        G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImg' );\r\n\r\n        // place the containers for the next image slider outside of the thumbnail (=hidden)\r\n        G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgBackNext', 'translateX', '100%', true);\r\n        G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgBackNext' );\r\n        G.GOM.slider.hostItem.CSSTransformSet('.nGY2TnImgNext', 'translateX', '100%', true);\r\n        G.GOM.slider.hostItem.CSSTransformApply( '.nGY2TnImgNext' );\r\n\r\n        // set new title and description\r\n        if( G.O.thumbnailLabel.get('display') == true ) {\r\n          var icons = G.O.icons.thumbnailAlbum;\r\n          if( ngy2itemContent.kind != 'album' ) {\r\n            icons = G.O.icons.thumbnailImage;\r\n          }\r\n          G.GOM.slider.hostItem.$getElt('.nGY2GThumbnailTitle').html(icons + getThumbnailTitle(ngy2itemContent));\r\n          G.GOM.slider.hostItem.$getElt('.nGY2GThumbnailDescription').html(icons + getTumbnailDescription(ngy2itemContent));\r\n        }\r\n      }\r\n    \r\n   \r\n    \r\n    // Compute the height of the label part of a thumbnail (title+description, both single line)\r\n    function ThumbnailGetLabelHeight() {\r\n      var newElt = [],\r\n      newEltIdx =  0;\r\n\r\n      // if( G.O.thumbnailLabel.get('display') == false && G.tn.toolbar.getWidth(item) <= 0 ) {\r\n      if( G.O.thumbnailLabel.get('display') == false  ) {\r\n        return 0;\r\n      }\r\n      \r\n      var desc='';\r\n      if( G.O.thumbnailLabel.get('displayDescription') == true ) {\r\n        desc = 'aAzZjJ';\r\n      }\r\n\r\n      // visibility set to hidden\r\n      newElt[newEltIdx++] = '<div class=\"nGY2GThumbnail ' + G.O.theme + '\" style=\"display:block;visibility:hidden;position:absolute;top:-9999px;left:-9999px;\" ><div class=\"nGY2GThumbnailSub\">';\r\n      if( G.O.thumbnailLabel.get('display') == true ) {\r\n        // Labels: title and description\r\n        newElt[newEltIdx++] = '  <div class=\"nGY2GThumbnailLabel\" '+ G.tn.style.getLabel() +'>';\r\n        newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailAlbumTitle\" '+G.tn.style.getTitle()+'>aAzZjJ</div>';\r\n        if( G.O.thumbnailLabel.get('displayDescription') == true ) {\r\n          newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailDescription\" '+G.tn.style.getDesc()+'>'+'aAzZjJ'+'</div>';\r\n        }\r\n        newElt[newEltIdx++] = '  </div>';\r\n      }\r\n      \r\n      newElt[newEltIdx++] = '</div></div>';\r\n    \r\n      var $newDiv = jQuery(newElt.join('')).appendTo(G.$E.conTn);\r\n      var h = $newDiv.find('.nGY2GThumbnailLabel').outerHeight(true);\r\n      $newDiv.remove();\r\n\r\n      return h;\r\n    }\r\n    \r\n    function ThumbnailBuildStacks( bgColor ) {\r\n      var ns=G.tn.opt.Get('stacks');\r\n      if( ns == 0 ) { return ''; }\r\n     \r\n      var s='';\r\n      for( var i=0; i<ns; i++ ) {\r\n        s='<div class=\"nGY2GThumbnailStack \" style=\"display:none;'+bgColor+'\"></div>'+s;\r\n      }\r\n      return s;\r\n    }\r\n    \r\n    //----- Build one UP thumbnail (=navigation thumbnail)\r\n    function ThumbnailBuildAlbumpUp( item, idx, GOMidx ) {\r\n      var newElt = [],\r\n      newEltIdx = 0;\r\n      \r\n      var mp = '';\r\n      if( G.O.thumbnailOpenImage === false ) {\r\n        mp = 'cursor:default;'\r\n      }\r\n      \r\n      newElt[newEltIdx++] = ThumbnailBuildStacks('') + '<div class=\"nGY2GThumbnail\" style=\"display:none;opacity:0;' + mp + '\" >';\r\n      newElt[newEltIdx++] = '  <div class=\"nGY2GThumbnailSub\">';\r\n\r\n      var h=G.tn.defaultSize.getHeight(),\r\n      w=G.tn.defaultSize.getWidth();\r\n\r\n      newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailImage\" style=\"width:'+w+'px;height:'+h+'px;\"><img class=\"nGY2GThumbnailImg\" src=\"'+G.emptyGif+'\" alt=\"\" style=\"max-width:'+w+'px;max-height:'+h+'px;\" ></div>';\r\n      // newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailAlbumUp\" style=\"width:'+w+'px;height:'+h+'px;\">'+G.O.icons.thumbnailAlbumUp+'</div>';\r\n      newElt[newEltIdx++] = '    <div class=\"nGY2GThumbnailAlbumUp\" >'+G.O.icons.thumbnailAlbumUp+'</div>';\r\n      newElt[newEltIdx++] = '  </div>';\r\n      newElt[newEltIdx++] = '</div>';\r\n      \r\n      var $newDiv = jQuery(newElt.join('')).appendTo(G.$E.conTn); //.animate({ opacity: 1},1000, 'swing');  //.show('slow'); //.fadeIn('slow').slideDown('slow');\r\n      \r\n      item.$elt = $newDiv;\r\n      $newDiv.data('index', GOMidx);\r\n      item.$getElt('.nGY2GThumbnailImg').data('index', GOMidx);\r\n      \r\n      return;\r\n    }\r\n\r\n    \r\n    //----- Build one thumbnail\r\n    function ThumbnailBuild( item, idx, GOMidx, lastOne ) {\r\n      item.eltTransform =  [];\r\n      item.eltFilter =     [];\r\n      item.hoverInitDone = false;\r\n      item.$Elts =         [];\r\n\r\n      if( item.kind == 'albumUp' ) {\r\n        ThumbnailBuildAlbumpUp( item, idx, GOMidx);\r\n        return;\r\n      }\r\n\r\n      var newElt = [],\r\n      newEltIdx = 0;\r\n\r\n      var mp = '';\r\n      if( G.O.thumbnailOpenImage === false ) {\r\n        mp = 'cursor:default;'\r\n      }\r\n\r\n      // var src = encodeURI(item.thumbImg().src),\r\n      var src = (item.thumbImg().src).replace(/'/g, \"%27\"),   // replace single quote with %27\r\n      sTitle = getThumbnailTitle(item);\r\n\r\n      // image background -> visible during image download\r\n      var bg = '';\r\n      var bgImg = \"background-image: url('\" + G.emptyGif + \"');\";\r\n      if( item.imageDominantColors != null ) {\r\n        // dominant colorS (blurred preview image)\r\n        bgImg = \"background-image: url('\" + item.imageDominantColors + \"');\";\r\n      }\r\n      else {\r\n        // dominant color -> background color\r\n        if( item.imageDominantColor != null ) {\r\n          bg = 'background-color:' + item.imageDominantColor + ';';\r\n        }\r\n        else {\r\n          bgImg = '';\r\n        }\r\n      }\r\n\r\n      var op = 'opacity:1;';\r\n      if( G.O.thumbnailWaitImageLoaded == true ) {\r\n        op = 'opacity:0;';\r\n      }\r\n\r\n      // ##### thumbnail containers  (with stacks)\r\n      newElt[newEltIdx++] = ThumbnailBuildStacks(bg) + '<div class=\"nGY2GThumbnail\" style=\"display:none;opacity:0;' + mp + '\"><div class=\"nGY2GThumbnailSub ' + ( G.O.thumbnailSelectable && item.selected ? \"nGY2GThumbnailSubSelected\" : \"\" ) + '\">';\r\n\r\n      \r\n      // image size\r\n      var w = G.tn.settings.getW();\r\n      var h = G.tn.settings.getH();\r\n      if( G.tn.settings.getMosaic() !== null ) {\r\n        // mosaic layout -> \r\n        w = G.GOM.items[GOMidx].width;\r\n        h = G.GOM.items[GOMidx].height;\r\n      }\r\n\r\n      var bgSize = 'contain';\r\n      if( G.tn.opt.Get('crop') ) {\r\n        bgSize = 'cover';\r\n      }\r\n      \r\n      // ##### layer for image background (color, dominant color, blurred preview)\r\n      var s1 = \"position: absolute; top: 0px; left: 0px; width:\" + w + \"px; height:\" + h + \"px;\"+ bg + bgImg + \" background-position: center center;  background-repeat: no-repeat; background-size:\" + bgSize + \"; overflow: hidden;\";\r\n      newElt[newEltIdx++]='<div class=\"nGY2GThumbnailImage nGY2TnImgBack\" style=\"' + s1 + '\"></div>';\r\n      \r\n      // #### layer for image \r\n      var s2 = op + \"position: absolute; top: 0px; left: 0px; width:\" + w + \"px; height:\" + h + \"px; background-image: url('\" + src + \"'); background-position: center center; background-repeat: no-repeat; background-size:\" + bgSize + \"; overflow: hidden;\";\r\n      newElt[newEltIdx++]='<div class=\"nGY2GThumbnailImage nGY2TnImg\" style=\"' + s2 + '\">';\r\n      newElt[newEltIdx++]='  <img class=\"nGY2GThumbnailImg nGY2TnImg2\" src=\"' + src + '\" alt=\"' + sTitle + '\" style=\"opacity:0;\" data-idx=\"' + idx + '\" data-albumidx=\"' + G.GOM.albumIdx + '\" >';\r\n      newElt[newEltIdx++]='</div>';\r\n      \r\n      // ##### layer for user customization purposes\r\n      newElt[newEltIdx++]='<div class=\"nGY2GThumbnailCustomLayer\"></div>';\r\n\r\n      // ##### layer for labels (title + description and their icons)\r\n      if( G.O.thumbnailLabel.get('display') == true ) {\r\n        // Labels: title and description\r\n        newElt[newEltIdx++]= '  <div class=\"nGY2GThumbnailLabel\" '+ G.tn.style.getLabel(item) + '>';\r\n        if( item.kind == 'album' ) {\r\n          // album kind\r\n          newElt[newEltIdx++]= '    <div class=\"nGY2GThumbnailTitle nGY2GThumbnailAlbumTitle\" ' + G.tn.style.getTitle() + '>' + G.O.icons.thumbnailAlbum + sTitle + '</div>';\r\n        }\r\n        else {\r\n          // image/media kind\r\n          newElt[newEltIdx++]= '    <div class=\"nGY2GThumbnailTitle nGY2GThumbnailImageTitle\" ' + G.tn.style.getTitle() + '>' + G.O.icons.thumbnailImage + sTitle + '</div>';\r\n        }\r\n        newElt[newEltIdx++]= '    <div class=\"nGY2GThumbnailDescription\" ' + G.tn.style.getDesc() + '>' + getTumbnailDescription(item) + '</div>';\r\n        newElt[newEltIdx++]= '  </div>';\r\n      }\r\n\r\n      // ##### layer for tools\r\n      newElt[newEltIdx++] = ThumbnailBuildTools(item, lastOne);\r\n      \r\n      // close containers\r\n      newElt[newEltIdx++]='</div></div>';\r\n      \r\n      var $newDiv =jQuery(newElt.join('')).appendTo(G.$E.conTn);\r\n\r\n      item.$elt=$newDiv;\r\n      $newDiv.data('index',GOMidx);\r\n      item.$getElt('.nGY2GThumbnailImg').data('index',GOMidx);\r\n      \r\n      // Custom init function\r\n      var fu=G.O.fnThumbnailInit;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu($newDiv, item, GOMidx) : window[fu]($newDiv, item, GOMidx);\r\n      }\r\n\r\n      if( item.title != 'image gallery by nanogallery2 [build]' ) {\r\n        ThumbnailOverInit(GOMidx);\r\n      }\r\n      \r\n      return ;\r\n    }\r\n\r\n    \r\n    // Thumbnail layer for tools (toolbars and counter)\r\n    function ThumbnailBuildTools( item, lastThumbnail ) {\r\n    \r\n      // toolbars\r\n      var tb = ThumbnailBuildToolbarOne(item, 'topLeft') + ThumbnailBuildToolbarOne(item, 'topRight') + ThumbnailBuildToolbarOne(item, 'bottomLeft') + ThumbnailBuildToolbarOne(item, 'bottomRight');\r\n      \r\n      // counter of not displayed images\r\n      tb += '<div class=\"nGY2GThumbnailIconsFullThumbnail\"></div>';\r\n\r\n      return tb;\r\n    }\r\n    \r\n    function ThumbnailBuildToolbarOne( item, position ) {\r\n      var toolbar = '';\r\n      var tb =      G.tn.toolbar.get(item);\r\n      var width =   { xs:0, sm:1, me:2, la:3, xl:4 };\r\n      var cnt =     0;\r\n      \r\n      if( tb[position] != '' ) {\r\n        var pos='top: 0; right: 0; text-align: right;';     // 'topRight' and default\r\n        switch( position ) {\r\n          case 'topLeft':\r\n            pos = 'top: 0; left: 0; text-align: left;';\r\n            break;\r\n          case 'bottomRight':\r\n            pos = 'bottom: 0; right: 0; text-align: right;';\r\n            break;\r\n          case 'bottomLeft':\r\n            pos = 'bottom: 0; left: 0; text-align: left;';\r\n            break;\r\n        }\r\n        \r\n        toolbar += '  <ul class=\"nGY2GThumbnailIcons\" style=\"' + pos + '\">';\r\n        \r\n        var icons = tb[position].split(',');\r\n        var nb = icons.length;\r\n        for( var i = 0; i < nb; i++ ) {\r\n          var icon = icons[i].replace(/^\\s*|\\s*$/, '');   //trim trailing/leading whitespace\r\n\r\n          var minWidth = icon.substring(0,2).toLowerCase();\r\n          var tIcon = icon;\r\n          var display = true;\r\n          if( /xs|sm|me|la|xl/i.test(minWidth) ) {\r\n            // check visbility (depending on screen width)\r\n            if( width[minWidth] > width[G.GOM.curWidth] ) {\r\n              display = false;\r\n            }\r\n            tIcon = icon.substring(2);\r\n          }\r\n          \r\n          if( display ) {\r\n            var sp=(i+1<nb ? '&nbsp;' :'');\r\n            switch( tIcon ) {\r\n              case 'COUNTER':\r\n                if( item.kind == 'album' ) {\r\n                  toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"\">';\r\n                  toolbar += '      <div class=\"nGY2GThumbnailIconImageCounter\"></div>';\r\n                  toolbar += '      <div class=\"nGY2GThumbnailIconText\">' + G.O.icons.thumbnailCounter+Math.max((item.getContentLength(false)),item.numberItems) + sp + '</div>';\r\n                  toolbar += '    </li>';\r\n                  cnt++;\r\n                }\r\n                break;\r\n              case 'COUNTER2':\r\n                if( item.kind == 'album' ) {\r\n                  toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"\">';\r\n                  toolbar += '      <div class=\"nGY2GThumbnailIconTextBadge\">' + G.O.icons.thumbnailCounter+Math.max((item.getContentLength(false)),item.numberItems) + sp + '</div>';\r\n                  toolbar += '    </li>';\r\n                  cnt++;\r\n                }\r\n                break;\r\n              case 'SHARE':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon + '\">';\r\n                toolbar += '      <div>' + G.O.icons.thumbnailShare + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'DOWNLOAD':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon + '\">';\r\n                toolbar += '      <div>' + G.O.icons.thumbnailDownload + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'INFO':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon + '\">';\r\n                toolbar += '      <div>' + G.O.icons.thumbnailInfo + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'CART':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon + '\">';\r\n                toolbar += '      <div>' + G.O.icons.thumbnailCart + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'DISPLAY':\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"DISPLAY\">';\r\n                toolbar += '      <div class=\"nGY2GThumbnailIconImageShare\">' + G.O.icons.thumbnailDisplay + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'CUSTOM1':\r\n              case 'CUSTOM2':\r\n              case 'CUSTOM3':\r\n              case 'CUSTOM4':\r\n              case 'CUSTOM5':\r\n              case 'CUSTOM6':\r\n              case 'CUSTOM7':\r\n              case 'CUSTOM8':\r\n              case 'CUSTOM9':\r\n              case 'CUSTOM10':\r\n                var cust = tIcon.replace('CUSTOM', '');\r\n                toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"' + tIcon.toLowerCase() + '\">';\r\n                toolbar += '      <div class=\"nGY2GThumbnailIconImageShare\">' + G.O.icons['thumbnailCustomTool' + cust] + '</div>';\r\n                toolbar += '    </li>';\r\n                cnt++;\r\n                break;\r\n              case 'FEATURED':\r\n                if( item.featured === true ) {\r\n                  toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"\">';\r\n                  toolbar += '      <div class=\"nGY2GThumbnailIconImageFeatured\">' + G.O.icons.thumbnailFeatured + '</div>';\r\n                  toolbar += '    </li>';\r\n                  cnt++;\r\n                }\r\n                break;\r\n              case 'SELECT':\r\n                if( G.O.thumbnailSelectable == true ) {\r\n                  toolbar += '    <li class=\"nGY2GThumbnailIcon\" data-ngy2action=\"TOGGLESELECT\">';\r\n                  if( item.selected === true ) {\r\n                    toolbar += '      <div class=\"nGY2GThumbnailIconImageSelect nGY2ThumbnailSelected\">' + G.O.icons.thumbnailSelected + '</div>';\r\n                  }\r\n                  else {\r\n                    toolbar += '      <div class=\"nGY2GThumbnailIconImageSelect nGY2ThumbnailUnselected\">' + G.O.icons.thumbnailUnselected + '</div>';\r\n                  }\r\n                  toolbar += '    </li>';\r\n                  cnt++;\r\n                }\r\n                break;\r\n            }\r\n          }\r\n        }\r\n        toolbar += '  </ul>';\r\n      }\r\n      \r\n      if( cnt > 0 ) {\r\n        return toolbar;\r\n      }\r\n      else {\r\n        return '';\r\n      }\r\n    }\r\n    \r\n    function getThumbnailTitle( item ) {\r\n    \r\n      var sTitle = item.title;\r\n      if( G.O.thumbnailLabel.get('display') == true ) {\r\n        if( sTitle === undefined || sTitle.length == 0 ) { sTitle = '&nbsp;'; }\r\n\r\n        if( G.i18nTranslations.thumbnailImageTitle != '' ) {\r\n          sTitle = G.i18nTranslations.thumbnailImageTitle;\r\n        }\r\n        var ml = G.O.thumbnailLabel.get('titleMaxLength');\r\n        if( ml > 3 && sTitle.length > ml ){\r\n          sTitle = sTitle.substring(0, ml) + '...';\r\n        }\r\n      }\r\n      \r\n      return sTitle;\r\n    }\r\n\r\n    function getTumbnailDescription( item ) {\r\n      var sDesc = '';\r\n      if( G.O.thumbnailLabel.get('displayDescription') == true ) { \r\n        if( item.kind == 'album' ) {\r\n          if( G.i18nTranslations.thumbnailImageDescription != '' ) {\r\n            sDesc = G.i18nTranslations.thumbnailAlbumDescription;\r\n          }\r\n          else {\r\n            sDesc = item.description;\r\n          }\r\n        }\r\n        else {\r\n          if( G.i18nTranslations.thumbnailImageDescription != '' ) {\r\n            sDesc = G.i18nTranslations.thumbnailImageDescription;\r\n          }\r\n          else {\r\n            sDesc = item.description;\r\n          }\r\n        }\r\n        var ml = G.O.thumbnailLabel.get('descriptionMaxLength');\r\n        if( ml > 3 && sDesc.length > ml ){\r\n          sDesc = sDesc.substring(0, ml) + '...';\r\n        }\r\n        if( sDesc.length == 0 ) {\r\n          sDesc = '&nbsp;';\r\n        }\r\n      }\r\n      \r\n      return sDesc;\r\n    }\r\n\r\n    \r\n    \r\n    // Retrieve the maximum number of thumbnails that fits in one row\r\n    function NbThumbnailsPerRow( areaWidth ) {\r\n      var tnW = G.tn.defaultSize.getOuterWidth();\r\n      \r\n      var nbMaxTn = 0;\r\n      if( G.O.thumbnailAlignment == 'justified' ) {\r\n        nbMaxTn = Math.floor((areaWidth)/(tnW));\r\n      }\r\n      else {\r\n        nbMaxTn = Math.floor((areaWidth + G.tn.opt.Get('gutterWidth'))/(tnW + G.tn.opt.Get('gutterWidth')));\r\n      }\r\n      \r\n      if(  G.O.maxItemsPerLine >0 && nbMaxTn >  G.O.maxItemsPerLine ) {\r\n        nbMaxTn = G.O.maxItemsPerLine;\r\n      }\r\n      \r\n      if( nbMaxTn < 1 ) { nbMaxTn = 1; }\r\n      \r\n      return nbMaxTn\r\n    }\r\n  \r\n    // Thumbnail display animation\r\n    function ThumbnailAppear( n, cnt ) {\r\n      var curTn = G.GOM.items[n];\r\n      var item = G.I[curTn.thumbnailIdx];\r\n\r\n    \r\n      if( G.tn.opt.Get('displayTransition') == 'NONE' ) {\r\n        item.$elt.css({ opacity: 1 });\r\n        ThumbnailAppearFinish( item );\r\n      }\r\n      else {\r\n        if( item.$elt == null ) { return; }\r\n        var top = G.GOM.cache.containerOffset.top + ( curTn.top - G.GOM.clipArea.top );\r\n        var vp = G.GOM.cache.viewport;\r\n        if( (top + (curTn.top - G.GOM.clipArea.top)) >= (vp.t - 50) && top <= (vp.t + vp.h + 50) ) {\r\n          // display animation only if in the current viewport\r\n          var delay = cnt * G.tn.opt.Get('displayInterval');\r\n          if( G.tn.opt.Get('displayTransition') == 'CUSTOM' ) {\r\n            if( G.GOM.curNavLevel == 'lN' ) {\r\n              G.O.fnThumbnailDisplayEffect(item.$elt, item, n, delay);\r\n            }\r\n            else {\r\n              G.O.fnThumbnailL1DisplayEffect(item.$elt, item, n, delay);\r\n            }\r\n          }\r\n          else {\r\n            G.GOM.thumbnails2Display.push({itm: item, d: delay});\r\n            // ThumbnailDisplayAnim2(item, delay);\r\n          }\r\n          return;\r\n        }\r\n        else {\r\n          item.$elt.css({ opacity: 1 });\r\n          ThumbnailAppearFinish(item);\r\n        }\r\n      }\r\n    }\r\n    \r\n    \r\n    // displays thumbnail stacks at the end of the display animation\r\n    function ThumbnailAppearFinish( item ) {\r\n    \r\n      // add stacks\r\n      var ns = G.tn.opt.Get('stacks');\r\n      if( ns > 0 ) {\r\n        // display stacks\r\n        item.$elt.css({ display: 'block'});\r\n        var o = 0.9;\r\n        // set stack opacity\r\n        for( var i = ns-1; i>=0; i-- ) {\r\n          item.$elt.eq(i).css('opacity', o);\r\n          o = o - 0.2;\r\n        }\r\n\r\n      }\r\n    }\r\n    \r\n\r\n    function ThumbnailDisplayAnim2( item, delay ) {\r\n      function randomIntFromInterval(min,max) {\r\n        return Math.floor(Math.random()*(max-min+1)+min);\r\n      }\r\n      var oFrom = {};\r\n      var oTo = {};\r\n    \r\n      switch (G.tn.opt.Get('displayTransition')) {\r\n        case 'RANDOMSCALE':\r\n          var scales = [0.95, 1, 1.05, 1.1];\r\n          var zi = [1, 2, 3, 4];\r\n          \r\n          var r = randomIntFromInterval(0,3);\r\n          while( r == G.GOM.lastRandomValue ) {\r\n            r = randomIntFromInterval(0,3);\r\n          }\r\n          G.GOM.lastRandomValue = r;\r\n          var f = scales[r];\r\n          // item.$elt.css({ 'z-index': G.GOM.lastZIndex+zi[r], 'box-shadow': '-1px 2px 5px 1px rgba(0, 0, 0, 0.7)' });\r\n          item.$elt.css({ 'z-index': G.GOM.lastZIndex+zi[r], 'box-shadow': '0px 0px 5px 3px rgba(0,0,0,0.74)' });\r\n          \r\n          oFrom = { scale: 0.5, opacity:0 };\r\n          oTo =   { scale: f,   opacity:1 };\r\n          break;\r\n\r\n        case 'SCALEUP':\r\n          var f = G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f = 0.6; }   // default value\r\n          oFrom = { scale: f, opacity: 0 };\r\n          oTo =   { scale: 1, opacity: 1 };\r\n          break;\r\n\r\n        case 'SCALEDOWN':\r\n          var f = G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=1.3; }   // default value\r\n          oFrom = { scale: f, opacity: 0 };\r\n          oTo =   { scale: 1, opacity: 1 };\r\n          break;\r\n        case 'SLIDEUP':\r\n          var f = G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=50; }   // default value\r\n          oFrom = { opacity: 0, translateY: f };\r\n          oTo =   { opacity: 1, translateY: 0 };\r\n          break;\r\n        case 'SLIDEDOWN':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=-50; }   // default value\r\n          oFrom = { opacity: 0, translateY: f };\r\n          oTo =   { opacity: 1, translateY: 0 };\r\n          break;\r\n        case 'FLIPUP':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=100; }   // default value\r\n          oFrom = { opacity: 0, translateY: f, rotateX: 45 };\r\n          oTo =   { opacity: 1, translateY: 0, rotateX: 0  };\r\n          break;\r\n          \r\n        case 'FLIPDOWN':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=-100; }   // default value\r\n          oFrom = { opacity: 0, translateY: f, rotateX: -45 };\r\n          oTo =   { opacity: 1, translateY: 0, rotateX: 0 };\r\n          break;\r\n        case 'SLIDEUP2':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=100; }   // default value\r\n          oFrom = { opacity: 0, translateY: f, rotateY: 40 };\r\n          oTo =   { opacity: 1, translateY: 0, rotateY: 0  };\r\n          break;\r\n        case 'SLIDEDOWN2':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=-100; }   // default value\r\n          oFrom = { opacity: 0, translateY: f, rotateY: 40 };\r\n          oTo =   { opacity: 1, translateY: 0, rotateY: 0  };\r\n          break;\r\n        case 'SLIDERIGHT':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=-150; }   // default value\r\n          oFrom = { opacity: 0, translateX: f };\r\n          oTo =   { opacity: 1, translateX: 0 };\r\n          break;\r\n\r\n        case 'SLIDELEFT':\r\n          var f=G.tn.opt.Get('displayTransitionStartVal');\r\n          if( f == 0 ) { f=150; }   // default value\r\n          oFrom = { opacity: 0, translateX: f };\r\n          oTo =   { opacity: 1, translateX: 0 };\r\n          break;\r\n          \r\n        case 'FADEIN':\r\n          oFrom = { opacity: 0 };\r\n          oTo =   { opacity: 1 };\r\n          break;\r\n          \r\n          \r\n      }\r\n    \r\n      var tweenable = new NGTweenable();\r\n      tweenable.tween({\r\n        from:         oFrom,\r\n        to:           oTo,\r\n        attachment:   { $e:item.$elt, item: item, tw: tweenable },\r\n        delay:        delay,\r\n        duration:     G.tn.opt.Get('displayTransitionDuration'),\r\n        easing:       G.tn.opt.Get('displayTransitionEasing'),\r\n        step:         function (state, att) {\r\n          window.requestAnimationFrame( function() {\r\n            if( att.item.$elt === null ) {  // the thumbnail may have been destroyed since the start of the animation\r\n              att.tw.stop(false);\r\n              return;\r\n            }\r\n            switch (G.tn.opt.Get('displayTransition')) {\r\n              case 'RANDOMSCALE':\r\n                att.$e.css( G.CSStransformName , 'scale(' + state.scale + ')').css('opacity', state.opacity);\r\n                break;\r\n              case 'SCALEUP':\r\n                att.$e.css( G.CSStransformName , 'scale('+state.scale+')').css('opacity',state.opacity);\r\n                break;\r\n              case 'SCALEDOWN':\r\n                att.item.$elt.last().css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'scale', state.scale);\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEUP':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px, '+state.translateY + 'px');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEDOWN':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px,'+state.translateY+'px');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'FLIPUP':\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px,'+state.translateY+'px');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'rotateX', state.rotateX+'deg');\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'FLIPDOWN':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px,' + state.translateY + 'px');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'rotateX', state.rotateX + 'deg');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEUP2':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px,' + state.translateY + 'px');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'rotateY', state.rotateY + 'deg');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEDOWN2':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', '0px, ' + state.translateY + 'px');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'rotateY', state.rotateY + 'deg');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDERIGHT':\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', state.translateX + 'px, 0px');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDELEFT':\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'translate', state.translateX + 'px, 0px');\r\n                att.item.$elt.css('opacity', state.opacity);\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'FADEIN':\r\n                att.$e.css(state);\r\n                break;\r\n            }\r\n          });\r\n          // att.$e.css( G.CSStransformName , 'scale('+state.scale+')').css('opacity',state.opacity);\r\n        },\r\n        finish:       function (state, att) {\r\n          window.requestAnimationFrame( function() {\r\n            if( att.item.$elt === null ) { return; }\r\n            \r\n            switch (G.tn.opt.Get('displayTransition')) {\r\n              case 'RANDOMSCALE':\r\n                att.$e.css( G.CSStransformName , 'scale('+state.scale+')').css('opacity', '');\r\n                break;\r\n              case 'SCALEUP':\r\n                att.$e.css( G.CSStransformName , '').css('opacity', '');\r\n                break;\r\n              case 'SCALEDOWN':\r\n                att.item.$elt.last().css('opacity', '');\r\n                att.item.CSSTransformSet('.nGY2GThumbnail', 'scale', state.scale);\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDEUP':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'SLIDEDOWN':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'FLIPUP':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'FLIPDOWN':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'SLIDEUP2':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'SLIDEDOWN2':\r\n                att.item.$elt.css('opacity', '');\r\n                att.item.CSSTransformApply('.nGY2GThumbnail');\r\n                break;\r\n              case 'SLIDERIGHT':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'SLIDELEFT':\r\n                att.item.$elt.css('opacity', '');\r\n                break;\r\n              case 'FADEIN':\r\n                att.$e.css('opacity', '');\r\n                break;\r\n            }\r\n            ThumbnailAppearFinish(att.item);\r\n          });\r\n\r\n        }\r\n      });\r\n    \r\n    }\r\n    \r\n    // batch display thumbnails with animation\r\n    function ThumbnailDisplayAnimBatch() {\r\n      \r\n      G.GOM.thumbnails2Display.forEach( function(one) {\r\n        ThumbnailDisplayAnim2(one.itm, one.d);\r\n      });\r\n      G.GOM.thumbnails2Display=[];\r\n    }\r\n    \r\n    \r\n\r\n    // ######################################\r\n    // Gallery display animation\r\n    function GalleryAppear() {\r\n      \r\n      var d=G.galleryDisplayTransitionDuration.Get();\r\n      switch( G.galleryDisplayTransition.Get() ){\r\n        case 'ROTATEX':\r\n          G.$E.base.css({ perspective: '1000px', 'perspective-origin': '50% 0%' });\r\n          var tweenable = new NGTweenable();\r\n          tweenable.tween({\r\n            from:         { r: 50 },\r\n            to:           { r: 0  },\r\n            attachment:   { orgIdx: G.GOM.albumIdx },\r\n            duration:     d,\r\n            easing:       'easeOutCirc',\r\n            step:         function (state, att) {\r\n              if( att.orgIdx == G.GOM.albumIdx ) {\r\n                // window.ng_draf( function() {\r\n                  G.$E.conTnParent.css( G.CSStransformName , 'rotateX(' + state.r + 'deg)');\r\n                // });\r\n              }\r\n            }\r\n          });\r\n          break;\r\n        case 'SLIDEUP':\r\n          G.$E.conTnParent.css({ opacity: 0 });\r\n          var tweenable = new NGTweenable();\r\n          tweenable.tween({\r\n            from:         { y: 200, o: 0 },\r\n            to:           { y: 0,   o: 1 },\r\n            attachment:   { orgIdx: G.GOM.albumIdx },\r\n            duration:     d,\r\n            easing:       'easeOutCirc',\r\n            step:         function (state, att) {\r\n              if( att.orgIdx == G.GOM.albumIdx ) {\r\n                // window.ng_draf( function() {\r\n                  G.$E.conTnParent.css( G.CSStransformName , 'translate( 0px, '+state.y + 'px)').css('opacity', state.o);\r\n                // });\r\n              }\r\n            }\r\n          });\r\n          break;\r\n        case 'NONE':\r\n        default:\r\n          break;\r\n      }\r\n\r\n\r\n    }\r\n    \r\n    // ######################################\r\n    // ##### THUMBNAIL HOVER MANAGEMENT #####\r\n    // ######################################\r\n\r\n    function ThumbnailOverInit( GOMidx ) {\r\n      // Over init in 2 step:\r\n      // 1) init with thumbnailBuildInit2 parameter\r\n      // 2) init with the hover effect parameter\r\n      \r\n      \r\n      var curTn = G.GOM.items[GOMidx];\r\n      var item = G.I[curTn.thumbnailIdx];\r\n\r\n      if( item.$elt == null ) { return; } // zombie\r\n      \r\n      var fu = G.O.fnThumbnailHoverInit;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu($e, item, GOMidx) : window[fu]($e, item, GOMidx);\r\n      }\r\n\r\n      // build initialization\r\n      var inits = G.tn.buildInit.get();\n      for( var j = 0; j < inits.length; j++) {\r\n        switch( inits[j].property ) {\r\n          // CSS Transform\r\n          case 'scale':\r\n          case 'rotateX':\r\n          case 'rotateY':\r\n          case 'rotateZ':\r\n          case 'translateX':\r\n          case 'translateY':\r\n          case 'translateZ':\r\n            item.CSSTransformSet(inits[j].element, inits[j].property, inits[j].value);\r\n            item.CSSTransformApply(inits[j].element);\r\n            break;\r\n          // CSS filter\r\n          case 'blur':\r\n          case 'brightness':\r\n          case 'grayscale':\r\n          case 'sepia':\n          case 'contrast':\n          case 'opacity':\n          case 'saturate':\r\n            item.CSSFilterSet(inits[j].element, inits[j].property, inits[j].value);\r\n            item.CSSFilterApply(inits[j].element);\r\n            break;\r\n          default:\r\n            var $t=item.$getElt(inits[j].element);\r\n            $t.css( inits[j].property, inits[j].value );\r\n            break;\r\n        }\r\n      }\r\n      \r\n      // hover\r\n      var effects = G.tn.hoverEffects.get();\n      for( var j = 0; j < effects.length; j++) {\r\n        if( effects[j].firstKeyframe === true ) {\r\n          switch( effects[j].type ) {\r\n            case 'scale':\r\n            case 'rotateX':\r\n            case 'rotateY':\r\n            case 'rotateZ':\r\n            case 'translateX':\r\n            case 'translateY':\r\n            case 'translateZ':\r\n              item.CSSTransformSet(effects[j].element, effects[j].type, effects[j].from);\r\n              item.CSSTransformApply(effects[j].element);\r\n              break;\r\n            case 'blur':\r\n            case 'brightness':\r\n            case 'grayscale':\r\n            case 'sepia':\r\n            case 'contrast':\n            case 'opacity':\n            case 'saturate':\n              item.CSSFilterSet(effects[j].element, effects[j].type, effects[j].from);\r\n              item.CSSFilterApply(effects[j].element);\r\n              break;\r\n            default:\r\n              var $t = item.$getElt(effects[j].element);\r\n              $t.css( effects[j].type, effects[j].from );\r\n              break;\r\n              \r\n          }\r\n        }\r\n      }\r\n      item.hoverInitDone=true;\r\n    }\r\n\r\n    function ThumbnailHoverReInitAll() {\r\n      if( G.GOM.albumIdx == -1 ) { return; };\r\n      var l = G.GOM.items.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        ThumbnailOverInit(i);\r\n        // G.GOM.items[i].hovered=false;\r\n        G.I[G.GOM.items[i].thumbnailIdx].hovered = false;\r\n      }\r\n    }\r\n\r\n\r\n    function ThumbnailHover( GOMidx ) {\r\n      if( G.GOM.albumIdx == -1 || !G.galleryResizeEventEnabled ) { return; };\r\n      if( G.GOM.slider.hostIdx == GOMidx ) {\r\n        // slider hosted on thumbnail -> no hover effect\r\n        return;\r\n      }\r\n      var curTn = G.GOM.items[GOMidx];\r\n      var item = G.I[curTn.thumbnailIdx];\r\n      if( item.kind == 'albumUp' || item.$elt == null ) { return; }\r\n\r\n      item.hovered = true;\r\n\r\n      var fu = G.O.fnThumbnailHover;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(item.$elt, item, GOMidx) : window[fu](item.$elt, item, GOMidx);\r\n      }\r\n      var effects = G.tn.hoverEffects.get();\r\n\r\n      try {\r\n        for( var j = 0; j < effects.length; j++) {\r\n          if( effects[j].hoverin === true ) {\r\n            //item.animate( effects[j], j*10,  true );\r\n            item.animate( effects[j], 0,  true );\r\n          }\r\n        }\r\n        // effects on whole layout\r\n        // GalleryResize( GOMidx );\r\n      }\r\n      catch (e) { \r\n        NanoAlert(G, 'error on hover: ' + e.message );\r\n      }\r\n\r\n    }\r\n\r\n    function ThumbnailHoverOutAll() {\r\n      if( G.GOM.albumIdx == -1 ) { return; };\r\n      var l = G.GOM.items.length;\r\n      for( var i = 0; i < l ; i++ ) {\r\n        if( G.GOM.items[i].inDisplayArea ) {\r\n          ThumbnailHoverOut(i);\r\n        }\r\n        else {\r\n          G.I[G.GOM.items[i].thumbnailIdx].hovered = false;\r\n        }\r\n      }\r\n    }\r\n\r\n    \r\n    function ThumbnailHoverOut( GOMidx ) {\r\n      if( G.GOM.albumIdx == -1 || !G.galleryResizeEventEnabled ) { return; }\r\n\r\n      if( G.GOM.slider.hostIdx == GOMidx ) {\r\n        // slider on thumbnail -> no hover effect\r\n        return;\r\n      }\r\n\r\n      var curTn = G.GOM.items[GOMidx];\r\n      var item = G.I[curTn.thumbnailIdx];\r\n      if( item.kind == 'albumUp' || !item.hovered ) { return; }\r\n      item.hovered = false;\r\n      if( item.$elt == null ) { return; }\r\n\r\n      var fu = G.O.fnThumbnailHoverOut;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(item.$elt, item, GOMidx) : window[fu](item.$elt, item, GOMidx);\r\n      }\r\n\r\n      var effects = G.tn.hoverEffects.get();\r\n      try {\r\n        for( var j = 0; j < effects.length; j++) {\r\n          if( effects[j].hoverout === true ) {\r\n            // item.animate( effects[j], j*10, false );\r\n            item.animate( effects[j], 0, false );\r\n          }\r\n        }\r\n        // effects on whole layout\r\n        // GalleryResize( );\r\n      }\r\n      catch (e) { \r\n        NanoAlert(G, 'error on hoverOut: ' + e.message );\r\n      }\r\n      \r\n    }\r\n    \r\n\r\n    /** @function DisplayPhoto */\r\n    function DisplayPhoto( imageID, albumID ) {\r\n\r\n      if( G.O.debugMode ) { console.log('#DisplayPhoto : '+  albumID +'-'+ imageID); }\r\n      var albumIdx = NGY2Item.GetIdx(G, albumID);\r\n      if( albumIdx == 0 ) {\r\n        G.GOM.curNavLevel = 'l1';\r\n      }\r\n      else {\r\n        G.GOM.curNavLevel = 'lN';\r\n      }\r\n\r\n      if( albumIdx == -1 ) {\r\n        // get content of album on root level\r\n        if( G.O.kind != '' ) {\r\n          // do not add album if Markup or Javascript data\r\n          NGY2Item.New( G, '', '', albumID, '0', 'album' );    // create empty album\r\n          albumIdx = G.I.length - 1;\r\n        }\r\n      }\r\n\r\n      var ngy2ItemIdx = NGY2Item.GetIdx(G, imageID);\r\n      if( ngy2ItemIdx == -1 ) {\r\n        // get content of the album\r\n        AlbumGetContent( albumID, DisplayPhoto, imageID, albumID );\r\n        return;\r\n      }\r\n      \r\n      if( G.O.debugMode ) { console.log('#DisplayPhoto : '+  ngy2ItemIdx); }\r\n     \r\n      DisplayPhotoIdx(ngy2ItemIdx);\r\n    \r\n    }\r\n\r\n\r\n    // BETA -> NOT finished and not used at this time\r\n    // Retrieve the title+description of ONE album\r\n    function albumGetInfo( albumIdx, fnToCall ) {\r\n      var url =   '';\r\n      var kind =  'image';\r\n      \r\n      switch( G.O.kind ) {\r\n        case 'json':\r\n          // TODO\r\n        case 'flickr':\r\n          // TODO\r\n        case 'picasa':\r\n        case 'google':\r\n        case 'google2':\r\n        default:\r\n          url = G.Google.url() + 'user/'+G.O.userID+'/albumid/'+G.I[albumIdx].GetID()+'?alt=json&&max-results=1&fields=title';\r\n          break;\r\n      }\r\n\r\n      jQuery.ajaxSetup({ cache: false });\r\n      jQuery.support.cors = true;\r\n      \r\n      var tId = setTimeout( function() {\r\n        // workaround to handle JSONP (cross-domain) errors\r\n        //PreloaderHide();\r\n        NanoAlert(G, 'Could not retrieve AJAX data...');\r\n      }, 60000 );\r\n      jQuery.getJSON(url, function(data, status, xhr) {\r\n        clearTimeout(tId);\r\n        //PreloaderHide();\r\n        \r\n        fnToCall( G.I[albumIdx].GetID() );\r\n\r\n      })\r\n      .fail( function(jqxhr, textStatus, error) {\r\n        clearTimeout(tId);\r\n        //PreloaderHide();\r\n        var err = textStatus + ', ' + error;\r\n        NanoAlert('Could not retrieve ajax data: ' + err);\r\n      });      \r\n    \r\n    }\r\n\r\n    \r\n    // function AlbumGetContent( albumIdx, fnToCall ) {\r\n    function AlbumGetContent( albumID, fnToCall, fnParam1, fnParam2 ) {\r\n      // var url='';\r\n      // var kind='image';\r\n      // var albumIdx=NGY2Item.GetIdx(G, albumID);\r\n      // var photoIdx=NGY2Item.GetIdx(G, photoID);\r\n      \r\n      switch( G.O.kind ) {\r\n        // MARKUP / API\r\n        case '':\r\n          AlbumGetMarkupOrApi(fnToCall, fnParam1, fnParam2);\r\n          break;\r\n        // JSON, Flickr, Picasa, ...\r\n        default:\r\n          jQuery.nanogallery2['data_'+G.O.kind](G, 'AlbumGetContent', albumID, fnToCall, fnParam1, fnParam2 );\r\n      }\r\n      \r\n    }\r\n    \r\n    var mediaList = {\r\n      youtube : {\r\n        getID: function( url ) {\r\n          // https://stackoverflow.com/questions/10591547/how-to-get-youtube-video-id-from-url\r\n          var s = url.match( /(?:https?:\\/{2})?(?:w{3}\\.)?youtu(?:be)?\\.(?:com|be)(?:\\/watch\\?v=|\\/)([^\\s&]+)/ );\r\n          return s != null ? s[1] : null;\r\n        },\r\n        thumbUrl: function( id ) {\r\n          return 'https://img.youtube.com/vi/' + id + '/hqdefault.jpg';\r\n        },\r\n        url: function( id ) {\r\n          return 'https://www.youtube.com/embed/' + id;\r\n        },\r\n        markup: function( id ) {\r\n          // return '<iframe class=\"nGY2ViewerMedia\" src=\"https://www.youtube.com/embed/' + id + '?rel=0\" frameborder=\"0\" gesture=\"media\" allowfullscreen></iframe>';\r\n          return '<iframe class=\"nGY2ViewerMedia\" src=\"https://www.youtube.com/embed/' + id + '?rel=0\" frameborder=\"0\" allow=\"autoplay\" allowfullscreen></iframe>';\r\n        },\r\n        kind: 'iframe'\r\n      },\r\n      vimeo : {\r\n        getID: function( url ) {\r\n          // https://stackoverflow.com/questions/2916544/parsing-a-vimeo-id-using-javascript\r\n          var s = url.match( /^.*(vimeo\\.com\\/)((channels\\/[A-z]+\\/)|(groups\\/[A-z]+\\/videos\\/))?([0-9]+)/ );\r\n          return s != null ? s[5] : null;\r\n        },\r\n        url: function( id ) {\r\n          return 'https://player.vimeo.com/video/' + id;\r\n        },\r\n        markup: function( id ) {\r\n          // return '<iframe class=\"nGY2ViewerMedia\" src=\"https://player.vimeo.com/video/' + id + '?rel=0\" frameborder=\"0\" gesture=\"media\" allowfullscreen></iframe>';\r\n          return '<iframe class=\"nGY2ViewerMedia\" src=\"https://player.vimeo.com/video/' + id + '?rel=0\" frameborder=\"0\" allow=\"autoplay\" allowfullscreen></iframe>';\r\n        },\r\n        kind: 'iframe'\r\n      },\r\n      dailymotion : {\r\n        getID: function( url ) {\r\n          // https://stackoverflow.com/questions/12387389/how-to-parse-dailymotion-video-url-in-javascript\r\n          var m = url.match(/^.+dailymotion.com\\/(video|hub)\\/([^_]+)[^#]*(#video=([^_&]+))?/);\r\n          if (m !== null) {\r\n              if(m[4] !== undefined) {\r\n                  return m[4];\r\n              }\r\n              return m[2];\r\n          }\r\n          return null;\r\n        },\r\n        thumbUrl: function( id ) {\r\n          return 'https://www.dailymotion.com/thumbnail/video/' + id;\r\n        },\r\n        url: function( id ) {\r\n          return 'https://www.dailymotion.com/embed/video/' + id;\r\n        },\r\n        markup: function( id ) {\r\n          // return '<iframe class=\"nGY2ViewerMedia\" src=\"https://www.dailymotion.com/embed/video/' + id + '?rel=0\" frameborder=\"0\" gesture=\"media\" allowfullscreen></iframe>';\r\n          return '<iframe class=\"nGY2ViewerMedia\" src=\"https://www.dailymotion.com/embed/video/' + id + '?rel=0\" frameborder=\"0\" allow=\"autoplay\" allowfullscreen></iframe>';\r\n        },\r\n        kind: 'iframe'\r\n      },\r\n      selfhosted : {\r\n\t\t\t\t// SELF-HOSTED VIDEOS\r\n        getID: function( url ) {\r\n          // In order to leave things as is, I used ID to identify the extension\r\n          // https://stackoverflow.com/questions/6997262/how-to-pull-url-file-extension-out-of-url-string-using-javascript\r\n          // Make sure the method used for verifying the extension matches the kind of url your selfhosted video has\r\n          var extension = url.split('.').pop();\r\n\r\n          // supported extensions\r\n          var s = ( extension === 'mp4' || extension === 'webm' || extension === 'ogv' || extension === '3gp' ) ? extension : null ;\r\n          return s;\r\n        },\r\n        markup: function( url ) {\r\n          // return '<video controls class=\"nGY2ViewerMedia\"><source src=\"${id.src}\" type=\"video/${id.type}\" preload=\"auto\">Your browser does not support the video tag (HTML 5).</video>';\r\n          var extension = url.split('.').pop();\r\n          return '<video controls class=\"nGY2ViewerMedia\"><source src=\"'+ url +'\" type=\"video/'+ extension +'\" preload=\"auto\">Your browser does not support the video tag (HTML 5).</video>';\r\n        },\r\n        kind: 'video',\r\n        selfhosted : true\r\n      }\r\n    };\r\n        \r\n    function AlbumGetMarkupOrApi ( fnToCall, fnParam1, fnParam2 ) {\r\n    \r\n      if( G.markupOrApiProcessed === true ) {\r\n        // already processed (maybe location hash to unknow reference) -> display root album\r\n        DisplayAlbum('-1', 0);\r\n        return;\r\n      }\r\n      \r\n      if( G.O.items !== undefined && G.O.items !== null ) {\r\n        // data defined as an object in an option parameter\r\n        GetContentApiObject();\r\n      }\r\n      else {\r\n      if( G.O.$markup.length > 0 ) {\r\n          // data defined as markup (href elements)\r\n          GetContentMarkup( G.O.$markup );\r\n          G.O.$markup=[]  ;\r\n        }\r\n        else {\r\n          NanoConsoleLog(G, 'error: no media to process.');\r\n          return;\r\n        }\r\n      }\r\n      \r\n      G.markupOrApiProcessed = true;\r\n      if( fnToCall !== null &&  fnToCall !== undefined) {\r\n        fnToCall( fnParam1, fnParam2, null );\r\n      }\r\n    }\r\n    \r\n    function StartsWithProtocol ( path ) {\r\n      if( path == null || path == undefined ) { return false; }\r\n      \r\n      var pattern = /^((http|https|ftp|ftps|file):\\/\\/)/;\r\n      if( !pattern.test(path) ) {\r\n        // not a full URL\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n    \r\n    function GetContentApiObject() {\r\n      var foundAlbumID=false;\r\n      var nbTitles = 0;\r\n      var AlbumPostProcess = NGY2Tools.AlbumPostProcess.bind(G);\r\n\r\n      G.I[0].contentIsLoaded=true;\r\n\r\n      jQuery.each(G.O.items, function(i,item){\r\n        \r\n        var title = '';\r\n        title=GetI18nItem(item, 'title');\r\n        if( title === undefined ) { title=''; }\r\n        \r\n        var src='';\r\n        if( item['src'+RetrieveCurWidth().toUpperCase()] !== undefined ) {\r\n          src = item['src'+RetrieveCurWidth().toUpperCase()];\r\n        }\r\n        else {\r\n          src = item.src;\r\n        }\r\n        if( !StartsWithProtocol(src) ) {\r\n          src = G.O.itemsBaseURL + src;\r\n        }\r\n\r\n        var thumbsrc = '';\r\n        if( item.srct !== undefined && item.srct.length > 0 ) {\r\n          thumbsrc = item.srct;\r\n          if( !StartsWithProtocol(thumbsrc) ) {\r\n            thumbsrc = G.O.itemsBaseURL + thumbsrc;\r\n          }\r\n        }\r\n        else {\r\n          thumbsrc = src;\r\n        }\r\n        \r\n        var thumbsrcX2 = '';\r\n        if( item.srct2x !== undefined && item.srct2x.length > 0 ) {\r\n          thumbsrcX2 = item.srct2x;\r\n          if( !StartsWithProtocol(thumbsrcX2) ) {\r\n            thumbsrcX2 = G.O.itemsBaseURL + thumbsrcX2;\r\n          }\r\n        }\r\n        else {\r\n          if( thumbsrc != '' ) {\r\n            thumbsrcX2 = thumbsrc;\r\n          }\r\n          else {\r\n            thumbsrcX2 = src;\r\n          }\r\n        }\r\n\r\n        if( G.O.thumbnailLabel.get('title') != '' ) {\r\n          title = GetImageTitle(src);\r\n        }\r\n\r\n        var description='';     //'&nbsp;';\r\n        description=GetI18nItem(item,'description');\r\n        if( description === undefined ) { description=''; }\r\n        //if( toType(item.description) == 'string' ) {\r\n        //  description=item.description;\r\n        //}\r\n\r\n        var tags = GetI18nItem(item, 'tags');\r\n        if( tags === undefined ) { tags=''; }\r\n\r\n        var albumID = 0;\r\n        if( item.albumID !== undefined  ) {\r\n          albumID=item.albumID;\r\n          foundAlbumID = true;\r\n        }\r\n        var ID = null;\r\n        if( item.ID !== undefined ) {\r\n          ID = item.ID;\r\n        }\r\n        var kind = 'image';\r\n        if( item.kind !== undefined && item.kind.length > 0 ) {\r\n          kind = item.kind;\r\n        }\r\n        \r\n        var newItem=NGY2Item.New( G, title, description, ID, albumID, kind, tags );\r\n        if( title != '' ) {\r\n          nbTitles++;\r\n        }\r\n        \r\n        // media source url - img is the default media kind\r\n        newItem.setMediaURL( src, 'img');\r\n\r\n        // manage media kinds other than IMG\r\n        jQuery.each(mediaList, function ( n, media ) {\r\n          var id = media.getID(src);\r\n          if( id != null ) {\r\n            if( typeof media.url == 'function' ) { src = media.url(id);  }\r\n            if( typeof media.thumbUrl == 'function' ) { thumbsrc = media.thumbUrl(id);  }\r\n            newItem.mediaKind = media.kind;\r\n            newItem.mediaMarkup = ( media.selfhosted ) ? media.markup( src ) : media.markup(id);\r\n            return false;\r\n          }\r\n        });\r\n\r\n        // image size\r\n        if( item.imageWidth !== undefined ) { newItem.imageWidth = item.width; }\r\n        if( item.imageHeight !== undefined ) { newItem.imageHeight = item.height; }\r\n\r\n        // THUMBNAILS\r\n        \r\n        // thumbnail image size\r\n        var tw = item.imgtWidth !== undefined ? item.imgtWidth : 0;\r\n        var th = item.imgtHeight !== undefined ? item.imgtHeight : 0;\r\n\r\n        // default thumbnail URL and size\r\n        newItem.thumbs = {\r\n          url:    { l1 : { xs: thumbsrc, sm: thumbsrc, me: thumbsrc, la: thumbsrc, xl: thumbsrc }, lN : { xs: thumbsrc, sm: thumbsrc, me: thumbsrc, la: thumbsrc, xl: thumbsrc } },\r\n          width:  { l1 : { xs: tw, sm: tw, me: tw, la: tw, xl: tw }, lN : { xs: tw, sm: tw, me: tw, la: tw, xl: tw } },\r\n          height: { l1 : { xs: th, sm: th, me: th, la: th, xl: th }, lN : { xs: th, sm: th, me: th, la: th, xl: th } }\r\n        };\r\n        \r\n        // default media type -> IMG\r\n        if( newItem.mediaKind == 'img' ) {\r\n        \r\n          // responsive thumbnails URL and size\r\n          var lst=['xs', 'sm', 'me', 'la', 'xl'];\r\n          for( var i=0; i< lst.length; i++ ) {\r\n            // url\r\n            var turl = item['srct' + lst[i].toUpperCase()];\r\n            if( turl !== undefined ) {\r\n              if( !StartsWithProtocol(turl) ) {\r\n                turl = G.O.itemsBaseURL + turl;\r\n              }\r\n              newItem.url.l1[lst[i]] = turl;\r\n              newItem.url.lN[lst[i]] = turl;\r\n            }\r\n            // width\r\n            var tw = item['imgt' + lst[i].toUpperCase() + 'Width'];\r\n            if( tw != undefined ) {\r\n              newItem.width.l1[lst[i]] = parseInt(tw);\r\n              newItem.width.lN[lst[i]] = parseInt(tw);\r\n            }\r\n            // height\r\n            var th = item['imgt' + lst[i].toUpperCase() + 'Height'];\r\n            if( th != undefined ) {\r\n              newItem.height.l1[lst[i]] = parseInt(th);\r\n              newItem.height.lN[lst[i]] = parseInt(th);\r\n            }\r\n          }\r\n        }\r\n        \r\n        // dominant colors (needs to be a base64 gif)\r\n        if( item.imageDominantColors !== undefined ) {\r\n          newItem.imageDominantColors = item.imageDominantColors;\r\n        }\r\n        // dominant color (rgb hex)\r\n        if( item.imageDominantColor !== undefined ) {\r\n          newItem.imageDominantColor = item.imageDominantColor;\r\n        }\r\n        \r\n        // dest url\r\n        if( item.destURL !== undefined && item.destURL.length>0 ) {\r\n          newItem.destinationURL = item.destURL;\r\n        }\r\n        \r\n        // download image url\r\n        if( item.downloadURL !== undefined && item.downloadURL.length>0 ) {\r\n          newItem.downloadURL = item.downloadURL;\r\n        }\r\n        \r\n        // EXIF DATA\r\n        // Exif - model\r\n        if( item.exifModel !== undefined ) { newItem.exif.model = item.exifModel; }\r\n        // Exif - flash\r\n        if( item.exifFlash !== undefined ) { newItem.exif.flash = item.exifFlash; }\r\n        // Exif - focallength\r\n        if( item.exifFocalLength !== undefined ) { newItem.exif.focallength = item.exifFocalLength; }\r\n        // Exif - fstop\r\n        if( item.exifFStop !== undefined ) { newItem.exif.fstop = item.exifFStop; }\r\n        // Exif - exposure\r\n        if( item.exifExposure !== undefined ) { newItem.exif.exposure = item.exifExposure; }\r\n        // Exif - time\r\n        if( item.exifIso !== undefined ) { newItem.exif.iso = item.exifIso; }\r\n        // Exif - iso\r\n        if( item.exifTime !== undefined ) { newItem.exif.time = item.exifTime; }\r\n        // Exif - location\r\n        if( item.exifLocation !== undefined ) { newItem.exif.location  = item.exifLocation; }\r\n        \r\n        \r\n        // custom data\r\n        if( item.customData !== null ) {\r\n          newItem.customData = cloneJSObject( item.customData );\r\n        }\r\n\r\n        newItem.contentIsLoaded = true;\r\n        \r\n        var fu = G.O.fnProcessData;\r\n        if( fu !== null ) {\r\n          typeof fu == 'function' ? fu(newItem, 'api', item) : window[fu](newItem, 'api', item);\r\n        }\r\n        \n        AlbumPostProcess(albumID);\r\n      });\r\n      \r\n      // if( foundAlbumID ) { G.O.displayBreadcrumb=true; }\r\n      if( nbTitles == 0 ) { G.O.thumbnailLabel.display=false; }\r\n\r\n    }\r\n    \r\n    \r\n    function GetContentMarkup( $elements ) {\r\n      var foundAlbumID = false;\r\n      var nbTitles = 0;\r\n      var AlbumPostProcess = NGY2Tools.AlbumPostProcess.bind(G);\r\n\r\n      G.I[0].contentIsLoaded = true;\r\n\r\n      jQuery.each($elements, function(i, item){\r\n\r\n        // create dictionnary with all data attribute name in lowercase (to be case unsensitive)\r\n        var data = {\r\n          // some default values\r\n          'data-ngdesc':                  '',         // item description\r\n          'data-ngid':                    null,       // ID\r\n          'data-ngkind':                  'image',    // kind (image, album, albumup)\r\n          'data-ngtags':                  null,       // tags\r\n          'data-ngdest':                  '',         // destination URL\r\n          'data-ngthumbimgwidth':         0,          // thumbnail width\r\n          'data-ngthumbimgheight':        0,          // thumbnail height\r\n          'data-ngimagewidth':            0,          // image width\r\n          'data-ngimageheight':           0,          // image height\r\n          'data-ngimagedominantcolors':   null,       // image dominant colors\r\n          'data-ngimagedominantcolor':    null,       // image dominant colors\r\n          'data-ngexifmodel':             '',         // EXIF data\r\n          'data-ngexifflash':             '',\r\n          'data-ngexiffocallength':       '',\r\n          'data-ngexiffstop':             '',\r\n          'data-ngexifexposure':          '',\r\n          'data-ngexifiso':               '',\r\n          'data-ngexiftime':              '',\r\n          'data-ngexiflocation':          ''\r\n        };\r\n        [].forEach.call( item.attributes, function(attr) {\r\n          data[attr.name.toLowerCase()] = attr.value;\r\n        });\r\n\r\n        // responsive image source\r\n        var src = '',\r\n        st = RetrieveCurWidth().toUpperCase();\r\n        if( data.hasOwnProperty('data-ngsrc'+st) ) {\r\n          src = data['data-ngsrc'+st];\r\n        }\r\n        if( src == '' ) {\r\n          src = data['href'];\r\n        }\r\n        if( !StartsWithProtocol(src) ) {\r\n          src = G.O.itemsBaseURL + src;\r\n        }\r\n\r\n        // thumbnail\r\n        var thumbsrc = '';\r\n        if( data.hasOwnProperty('data-ngthumb') ) {\r\n          thumbsrc = data['data-ngthumb'];\r\n          if( !StartsWithProtocol(thumbsrc) ) {\r\n            thumbsrc = G.O.itemsBaseURL + thumbsrc;\r\n          }\r\n        }\r\n        else {\r\n          thumbsrc = src;\r\n        }\r\n        var thumbsrcX2 = '';\r\n        if( data.hasOwnProperty('data-ngthumb2x') ) {\r\n          thumbsrcX2 = data['data-ngthumb2x'];\r\n          if( !StartsWithProtocol(thumbsrcX2) ) {\r\n            thumbsrcX2 = G.O.itemsBaseURL + thumbsrcX2;\r\n          }\r\n        }\r\n        \r\n        //newObj.description=jQuery(item).attr('data-ngdesc');\r\n        var description = data['data-ngdesc'];\r\n        var ID = data['id'];\r\n        if( ID == undefined ) {\r\n          ID = data['data-ngid'];\r\n        }\r\n        var kind = data['data-ngkind'];\r\n        var tags = data['data-ngtags'];\r\n\r\n        var albumID = '0';\r\n        if( data.hasOwnProperty('data-ngalbumid') ) {\r\n          albumID = data['data-ngalbumid'];\r\n          foundAlbumID = true;\r\n        }\r\n        \r\n        var title = jQuery(item).text();\r\n        if( !(G.O.thumbnailLabel.get('title') == '' || G.O.thumbnailLabel.get('title') == undefined) ) {\r\n          title = GetImageTitle(src);\r\n        }\r\n\r\n\r\n        var newItem = NGY2Item.New( G, title, description, ID, albumID, kind, tags );\r\n        if( title != '' ) {\r\n          nbTitles++;\r\n        }\r\n\r\n        // media source url - img is the default media kind\r\n        newItem.setMediaURL( src, 'img');\r\n\r\n        // manage media kinds other than IMG\r\n        newItem.mediaKind = 'img';\r\n        jQuery.each(mediaList, function ( n, media ) {\r\n          var id = media.getID(src);\r\n          if( id != null ) {\r\n            if( typeof media.url == 'function' ) { src = media.url(id);  }\r\n            if( typeof media.thumbUrl == 'function' ) { thumbsrc = media.thumbUrl(id);  }\r\n            newItem.mediaKind = media.kind;\r\n            newItem.mediaMarkup = ( media.selfhosted ) ? media.markup( src ) : media.markup(id);\r\n            return false;\r\n          }\r\n        });\r\n        \r\n        \r\n        // image size\r\n        newItem.imageWidth = parseInt( data['data-ngimagewidth'] );\r\n        newItem.imageHeight = parseInt( data['data-ngimageheight'] );\r\n        \r\n        // default thumbnail image URL and size\r\n        var tw = parseInt(data['data-ngthumbimgwidth']);\r\n        var th = parseInt(data['data-ngthumbimgheight']);\r\n        newItem.thumbs = {\r\n          url:    { l1 : { xs: thumbsrc, sm: thumbsrc, me: thumbsrc, la: thumbsrc, xl: thumbsrc }, lN : { xs: thumbsrc, sm: thumbsrc, me: thumbsrc, la: thumbsrc, xl: thumbsrc } },\r\n          width:  { l1 : { xs: tw, sm: tw, me: tw, la: tw, xl: tw }, lN : { xs: tw, sm: tw, me: tw, la: tw, xl: tw } },\r\n          height: { l1 : { xs: th, sm: th, me: th, la: th, xl: th }, lN : { xs: th, sm: th, me: th, la: th, xl: th } }\r\n        };\r\n\r\n        // default media type -> IMG\r\n        if( newItem.mediaKind == 'img' ) {\r\n        \r\n          // responsive thumbnails URL and size\r\n          var lst = ['xs', 'sm', 'me', 'la', 'xl'];\r\n          for( var i = 0; i < lst.length; i++ ) {\r\n            // url\r\n            if( data.hasOwnProperty('data-ngthumb' + lst[i]) ) {\r\n              var turl=data['data-ngthumb' + lst[i]];\r\n              if( !StartsWithProtocol(turl) ) {\r\n                turl = G.O.itemsBaseURL + turl;\r\n              }\r\n              newItem.url.l1[lst[i]] = turl;\r\n              newItem.url.lN[lst[i]] = turl;\r\n            }\r\n\r\n            // width\r\n            if( data.hasOwnProperty('data-ngthumb' + lst[i] + 'width') ) {\r\n              var tw=parseInt(data['data-ngthumb' + lst[i] + 'width']);\r\n              newItem.width.l1[lst[i]] = tw;\r\n              newItem.width.lN[lst[i]] = tw;\r\n            }\r\n            // height\r\n            if( data.hasOwnProperty('data-ngthumb' + lst[i] + 'height') ) {\r\n              var th=parseInt('data-ngthumb' + lst[i] + 'height');\r\n              newItem.height.l1[lst[i]] = th;\r\n              newItem.height.lN[lst[i]] = th;\r\n            }\r\n          }\r\n        }\r\n        \r\n        \r\n        // dominant colorS (needs to be a base64 gif)\r\n        newItem.imageDominantColors = data['data-ngimagedominantcolors'];\r\n        // dominant color (rgb hex)\r\n        newItem.imageDominantColor = data['data-ngimagedominantcolors'];\r\n\r\n        newItem.destinationURL = data['data-ngdest'];\r\n        newItem.downloadURL = data['data-ngdownloadurl'];\r\n\r\n        // Exif - model\r\n        newItem.exif.model=data['data-ngexifmodel'];\r\n        // Exif - flash\r\n        newItem.exif.flash=data['data-ngexifflash'];\r\n        // Exif - focallength\r\n        newItem.exif.focallength=data['data-ngexiffocallength'];\r\n        // Exif - fstop\r\n        newItem.exif.fstop=data['data-ngexiffstop'];\r\n        // Exif - exposure\r\n        newItem.exif.exposure=data['data-ngexifexposure'];\r\n        // Exif - iso\r\n        newItem.exif.iso=data['data-ngexifiso'];\r\n        // Exif - time\r\n        newItem.exif.time=data['data-ngexiftime'];\r\n        // Exif - location\r\n        newItem.exif.location=data['data-ngexiflocation'];\r\n        \r\n        newItem.contentIsLoaded=true;\r\n\r\n        // custom data\r\n        if( jQuery(item).data('customdata') !== undefined ) {\r\n          newItem.customData=cloneJSObject(jQuery(item).data('customdata'));\r\n        }\r\n        // custom data\r\n        if( jQuery(item).data('ngcustomdata') !== undefined ) {\r\n          newItem.customData=cloneJSObject(jQuery(item).data('ngcustomdata'));\r\n        }\r\n\r\n        var fu=G.O.fnProcessData;\r\n        if( fu !== null ) {\r\n          typeof fu == 'function' ? fu(newItem, 'markup', item) : window[fu](newItem, 'markup', item);\r\n        }\r\n        \r\n        AlbumPostProcess(albumID);\r\n\r\n      });\r\n      \r\n      // if( foundAlbumID ) { G.O.displayBreadcrumb=true; }\r\n      if( nbTitles == 0 ) { G.O.thumbnailLabel.display = false; }\r\n\r\n    }\r\n\r\n    \r\n    // ################################\r\n    // ##### DEFINE VARIABLES     #####\r\n    // ################################\r\n\r\n    \r\n    /** @function DefineVariables */\r\n    function DefineVariables() {\r\n    \r\n      // change 'picasa' to 'google' for compatibility reason\r\n      if( G.O.kind.toUpperCase() == 'PICASA'  || G.O.kind.toUpperCase() == 'GOOGLE') {\r\n        G.O.kind='google2';\r\n      }\r\n    \r\n      // management of screen width\r\n      G.GOM.cache.viewport = getViewport();\r\n      G.GOM.curWidth = RetrieveCurWidth();\r\n      \r\n      // tumbnail toolbar\r\n      jQuery.extend(true, G.tn.toolbar.image, G.O.thumbnailToolbarImage );\r\n      jQuery.extend(true, G.tn.toolbar.album, G.O.thumbnailToolbarAlbum );\r\n      var t = ['image', 'album'];\r\n      var pos= ['topLeft', 'topRight', 'bottomLeft', 'bottomRight']\r\n      for( var i=0; i < t.length ; i++ ) {\r\n        for( var j=0; j < pos.length ; j++ ) {\r\n          G.tn.toolbar[t[i]][pos[j]] = G.tn.toolbar[t[i]][pos[j]].toUpperCase();\r\n        }\r\n      }\r\n\r\n      // thumbnails label - level dependant settings\r\n      G.O.thumbnailLabel.get = function( opt ) {\r\n        if( G.GOM.curNavLevel == 'l1' && G.O.thumbnailL1Label !== undefined && G.O.thumbnailL1Label[opt] !== undefined ) {\r\n          return G.O.thumbnailL1Label[opt];\r\n        }\r\n        else {\r\n          return G.O.thumbnailLabel[opt];\r\n        }\r\n      };\r\n      G.O.thumbnailLabel.set = function( opt, value ) {\r\n        if( G.GOM.curNavLevel == 'l1' && G.O.thumbnailL1Label !== undefined && G.O.thumbnailL1Label[opt] !== undefined ) {\r\n          G.O.thumbnailL1Label[opt]=value;\r\n        }\r\n        else {\r\n          G.O.thumbnailLabel[opt]=value;\r\n        }\r\n      };\r\n\r\n      if( G.O.blackList != '' ) { G.blackList=G.O.blackList.toUpperCase().split('|'); }\r\n      if( G.O.whiteList != '' ) { G.whiteList=G.O.whiteList.toUpperCase().split('|'); }\r\n\r\n      if( G.O.albumList2 !== undefined && G.O.albumList2 !== null && G.O.albumList2.constructor === Array  ) {\r\n        var l=G.O.albumList2.length;\r\n        for(var i=0; i< l; i++ ) {\r\n          G.albumList.push(G.O.albumList2[i]);\r\n        }\r\n        // G.albumList=G.O.albumList.toUpperCase().split('|');\r\n      }\r\n      if( G.O.albumList2 !== undefined && typeof G.O.albumList2 == 'string'   ) {\r\n        G.albumList.push(G.O.albumList2);\r\n      }\r\n      \r\n      \r\n      // thumbnail image crop\r\n      G.tn.opt.lN.crop = G.O.thumbnailCrop;\r\n      G.tn.opt.l1.crop = G.O.thumbnailL1Crop != null ? G.O.thumbnailL1Crop : G.O.thumbnailCrop;\r\n\r\n\r\n      function ThumbnailOpt( lN, l1, opt) {\r\n        G.tn.opt.lN[opt]=G.O[lN];\r\n        G.tn.opt.l1[opt]=G.O[lN];\r\n        if( toType(G.O[l1]) == 'number' ) {\r\n          G.tn.opt.l1[opt]=G.O[l1];\r\n        }\r\n      }\r\n      // thumbnail stacks\r\n      ThumbnailOpt('thumbnailStacks', 'thumbnailL1Stacks', 'stacks');\r\n      // thumbnail stacks translate X\r\n      ThumbnailOpt('thumbnailStacksTranslateX', 'thumbnailL1StacksTranslateX', 'stacksTranslateX');\r\n      // thumbnail stacks translate Y\r\n      ThumbnailOpt('thumbnailStacksTranslateY', 'thumbnailL1StacksTranslateY', 'stacksTranslateY');\r\n      // thumbnail stacks translate Z\r\n      ThumbnailOpt('thumbnailStacksTranslateZ', 'thumbnailL1StacksTranslateZ', 'stacksTranslateZ');\r\n      // thumbnail stacks rotate X\r\n      ThumbnailOpt('thumbnailStacksRotateX', 'thumbnailL1StacksRotateX', 'stacksRotateX');\r\n      // thumbnail stacks rotate Y\r\n      ThumbnailOpt('thumbnailStacksRotateY', 'thumbnailL1StacksRotateY', 'stacksRotateY');\r\n      // thumbnail stacks rotate Z\r\n      ThumbnailOpt('thumbnailStacksRotateZ', 'thumbnailL1StacksRotateZ', 'stacksRotateZ');\r\n      // thumbnail stacks scale\r\n      ThumbnailOpt('thumbnailStacksScale', 'thumbnailL1StacksScale', 'stacksScale');\r\n      // thumbnail gutter width\r\n      ThumbnailOpt('thumbnailGutterWidth', 'thumbnailL1GutterWidth', 'gutterWidth');\r\n      // thumbnail gutter height\r\n      ThumbnailOpt('thumbnailGutterHeight', 'thumbnailL1GutterHeight', 'gutterHeight');\r\n      // thumbnail grid base height (for cascading layout)\r\n      ThumbnailOpt('thumbnailBaseGridHeight', 'thumbnailL1BaseGridHeight', 'baseGridHeight');\r\n      \r\n      // gallery display mode\r\n      G.galleryDisplayMode.lN = G.O.galleryDisplayMode.toUpperCase();\r\n      G.galleryDisplayMode.l1 = G.O.galleryL1DisplayMode != null ? G.O.galleryL1DisplayMode.toUpperCase() : G.O.galleryDisplayMode.toUpperCase();\r\n      \r\n      // gallery maximum number of lines of thumbnails\r\n      G.galleryMaxRows.lN = G.O.galleryMaxRows;\r\n      G.galleryMaxRows.l1 = toType(G.O.galleryL1MaxRows) == 'number' ? G.O.galleryL1MaxRows : G.O.galleryMaxRows;\r\n\r\n      // gallery last row full\r\n      G.galleryLastRowFull.lN = G.O.galleryLastRowFull;\r\n      G.galleryLastRowFull.l1 = G.O.galleryL1LastRowFull != null ? G.O.galleryL1LastRowFull : G.O.galleryLastRowFull;\r\n      \r\n      // gallery sorting\r\n      G.gallerySorting.lN = G.O.gallerySorting.toUpperCase();\r\n      G.gallerySorting.l1 = G.O.galleryL1Sorting != null ? G.O.galleryL1Sorting.toUpperCase() : G.gallerySorting.lN;\r\n      \r\n      // gallery display transition\r\n      G.galleryDisplayTransition.lN = G.O.galleryDisplayTransition.toUpperCase();\r\n      G.galleryDisplayTransition.l1 = G.O.galleryL1DisplayTransition != null ? G.O.galleryL1DisplayTransition.toUpperCase() : G.galleryDisplayTransition.lN;\r\n\r\n      // gallery display transition duration\r\n      G.galleryDisplayTransitionDuration.lN = G.O.galleryDisplayTransitionDuration;\r\n      G.galleryDisplayTransitionDuration.l1 = G.O.galleryL1DisplayTransitionDuration != null ? G.O.galleryL1DisplayTransitionDuration : G.galleryDisplayTransitionDuration.lN;\r\n      \r\n      // gallery max items per album (not for inline/api defined items)\r\n      G.galleryMaxItems.lN = G.O.galleryMaxItems;\r\n      G.galleryMaxItems.l1 = toType(G.O.galleryL1MaxItems) == 'number' ? G.O.galleryL1MaxItems : G.O.galleryMaxItems;\r\n\r\n      // gallery filter tags\r\n      G.galleryFilterTags.lN = G.O.galleryFilterTags;\r\n      G.galleryFilterTags.l1 = G.O.galleryL1FilterTags != null ? G.O.galleryL1FilterTags : G.O.galleryFilterTags;\r\n      \r\n      // gallery pagination\r\n      G.O.galleryPaginationMode = G.O.galleryPaginationMode.toUpperCase();\r\n\r\n      if( toType(G.O.slideshowDelay) == 'number' && G.O.slideshowDelay >= 2000 ) {\r\n        G.VOM.slideshowDelay = G.O.slideshowDelay;\r\n      }\r\n      else {\r\n        NanoConsoleLog(G, 'Parameter \"slideshowDelay\" must be an integer >= 2000 ms.');\r\n      }\r\n\r\n      // gallery display transition\r\n      if( typeof G.O.thumbnailDisplayTransition == 'boolean' ) {\r\n        if( G.O.thumbnailDisplayTransition === true ) {\r\n          G.tn.opt.lN.displayTransition = 'FADEIN';\r\n          G.tn.opt.l1.displayTransition = 'FADEIN';\r\n        }\r\n        else {\r\n          G.tn.opt.lN.displayTransition = 'NONE';\r\n          G.tn.opt.l1.displayTransition = 'NONE';\r\n        }\r\n      }\r\n\r\n      if( G.O.fnThumbnailDisplayEffect !== '' ) {\n        G.tn.opt.lN.displayTransition = 'CUSTOM';\n        G.tn.opt.l1.displayTransition = 'CUSTOM';\n      }\n      if( G.O.fnThumbnailL1DisplayEffect !== '' ) {\n        G.tn.opt.l1.displayTransition = 'CUSTOM';\r\n      }\r\n      \r\n      // parse thumbnail display transition\r\n      function thumbnailDisplayTransitionParse( cfg, level ) {\r\n        if( typeof cfg == 'string' ) {\r\n          var st=cfg.split('_');\r\n          if( st.length == 1 ) {\r\n            G.tn.opt[level]['displayTransition'] = cfg.toUpperCase();\r\n          }\r\n          if( st.length == 2 ) {\r\n            G.tn.opt[level]['displayTransition'] = st[0].toUpperCase();\r\n            G.tn.opt[level]['displayTransitionStartVal'] = Number(st[1]);\r\n          }\r\n          if( st.length == 3 ) {\r\n            G.tn.opt[level]['displayTransition'] = st[0].toUpperCase();\r\n            G.tn.opt[level]['displayTransitionStartVal'] = Number(st[1]);\r\n            G.tn.opt[level]['displayTransitionEasing'] = st[2];\r\n          }\r\n        }\r\n      }\r\n      thumbnailDisplayTransitionParse( G.O.thumbnailDisplayTransition, 'lN');\r\n      thumbnailDisplayTransitionParse( G.O.thumbnailDisplayTransition, 'l1');\r\n      thumbnailDisplayTransitionParse( G.O.thumbnailL1DisplayTransition, 'l1');\r\n\r\n      \r\n      // thumbnail display transition duration\r\n      ThumbnailOpt('thumbnailDisplayTransitionDuration', 'thumbnailL1DisplayTransitionDuration', 'displayTransitionDuration');\r\n      // thumbnail display transition interval duration\r\n      ThumbnailOpt('thumbnailDisplayInterval', 'thumbnailL1DisplayInterval', 'displayInterval');\r\n\r\n      \r\n      // resolution breakpoints --> convert old syntax to new one\r\n      if( G.O.thumbnailSizeSM !== undefined ) { G.O.breakpointSizeSM = G.O.thumbnailSizeSM; }\r\n      if( G.O.thumbnailSizeME !== undefined ) { G.O.breakpointSizeME = G.O.thumbnailSizeME; }\r\n      if( G.O.thumbnailSizeLA !== undefined ) { G.O.breakpointSizeLA = G.O.thumbnailSizeLA; }\r\n      if( G.O.thumbnailSizeXL !== undefined ) { G.O.breakpointSizeXL = G.O.thumbnailSizeXL; }\r\n\r\n      // THUMBNAIL BUILD INIT\r\n      //level 1\r\n      if( G.O.thumbnailL1BuildInit2 !== undefined ) {\r\n      var t1 = G.O.thumbnailL1BuildInit2.split('|');\r\n        for( var i = 0; i < t1.length; i++ ) {\r\n          var o1 = t1[i].trim().split('_');\r\n          if( o1.length == 3 ) {\r\n            var i1 = NewTBuildInit();\r\n            i1.element = ThumbnailOverEffectsGetCSSElement(o1[0], '');\r\n            i1.property = o1[1];\r\n            i1.value = o1[2];\r\n            G.tn.buildInit.level1.push(i1);\r\n          }\r\n        }\r\n      }\r\n      //level N\r\n      if( G.O.thumbnailBuildInit2 !== undefined ) {\r\n        var t1 = G.O.thumbnailBuildInit2.split('|');\r\n        for( var i = 0; i < t1.length; i++ ) {\r\n          var o1 = t1[i].trim().split('_');\r\n          if( o1.length == 3 ) {\r\n            var i1 = NewTBuildInit();\r\n            i1.element = ThumbnailOverEffectsGetCSSElement(o1[0], '');\r\n            i1.property = o1[1];\r\n            i1.value = o1[2];\r\n            G.tn.buildInit.std.push(i1);\r\n          }\r\n        }\r\n      }\r\n\r\n      \r\n      // THUMBNAIL HOVER EFFETCS\r\n      \r\n      // thumbnails hover effects - Level1\r\n      var tL1HE = G.O.thumbnailL1HoverEffect2;\r\n      if( tL1HE !== undefined ) {\r\n        switch( toType(tL1HE) ) {\r\n          case 'string':\r\n            var tmp = tL1HE.split('|');\r\n            for(var i = 0; i < tmp.length; i++) {\r\n              var oDef = NewTHoverEffect();\r\n              oDef = ThumbnailHoverEffectExtract( tmp[i].trim(), oDef );\r\n              if(  oDef != null ) {\r\n                G.tn.hoverEffects.level1.push(oDef);\r\n              }\r\n            }\r\n            break;\r\n          case 'object':\r\n            var oDef = NewTHoverEffect();\r\n            oDef = jQuery.extend(oDef,tL1HE);\r\n            oDef = ThumbnailHoverEffectExtract( oDef.name, oDef );\r\n            if(  oDef != null ) {\r\n              G.tn.hoverEffects.level1.push(oDef);\r\n            }\r\n            break;\r\n          case 'array':\r\n            for(var i = 0; i < tL1HE.length; i++) {\r\n              var oDef = NewTHoverEffect();\r\n              oDef = jQuery.extend(oDef,tL1HE[i]);\r\n              oDef = ThumbnailHoverEffectExtract( oDef.name, oDef );\r\n              if(  oDef != null ) {\r\n                G.tn.hoverEffects.level1.push(oDef);\r\n              }\r\n            }\r\n            break;\r\n          case 'null':\r\n            break;\r\n          default:\r\n            NanoAlert(G, 'incorrect parameter for \"thumbnailL1HoverEffect2\".');\r\n        }\r\n      }\r\n      G.tn.hoverEffects.level1 = ThumbnailOverEffectsPreset(G.tn.hoverEffects.level1);\r\n  \r\n      // thumbnails hover effects - other levels\r\n      var tHE = G.O.thumbnailHoverEffect2;\r\n      switch( toType(tHE) ) {\r\n        case 'string':\r\n          var tmp = tHE.split('|');\r\n          for(var i = 0; i < tmp.length; i++) {\r\n            var oDef = NewTHoverEffect();\r\n            oDef = ThumbnailHoverEffectExtract( tmp[i].trim(), oDef );\r\n            if(  oDef != null ) {\r\n              G.tn.hoverEffects.std.push(oDef);\r\n            }\r\n          }\r\n          break;\r\n        case 'object':\r\n          var oDef = NewTHoverEffect();\r\n          oDef = jQuery.extend(oDef, tHE);\r\n          oDef = ThumbnailHoverEffectExtract( oDef.name, oDef );\r\n          if(  oDef != null ) {\r\n            G.tn.hoverEffects.std.push(oDef);\r\n          }\r\n          break;\r\n        case 'array':\r\n          for(var i = 0; i < tHE.length; i++) {\r\n            var oDef = NewTHoverEffect();\r\n            oDef = jQuery.extend(oDef,tHE[i]);\r\n            oDef = ThumbnailHoverEffectExtract( oDef.name, oDef );\r\n            if(  oDef!= null ) {\r\n              G.tn.hoverEffects.std.push(oDef);\r\n            }\r\n          }\r\n          break;\r\n        case 'null':\r\n          break;\r\n        default:\r\n          NanoAlert(G, 'incorrect parameter for \"thumbnailHoverEffect2\".');\r\n      }\r\n      G.tn.hoverEffects.std = ThumbnailOverEffectsPreset(G.tn.hoverEffects.std);\r\n\r\n      \r\n      if( G.O.touchAnimationL1 == undefined ) {\r\n        G.O.touchAnimationL1 = G.O.touchAnimation;\r\n      }\r\n      \r\n      // disable thumbnail touch animation when no hover effect defined\r\n      if( G.tn.hoverEffects.std.length == 0 ) {\r\n        if( G.tn.hoverEffects.level1.length == 0 ) {\r\n          G.O.touchAnimationL1 = false;\r\n        }\r\n        G.O.touchAnimation = false;\r\n      }      \r\n      \r\n      \r\n      // thumbnail sizes\r\n      if( G.O.thumbnailHeight == 0 || G.O.thumbnailHeight == ''  ) { G.O.thumbnailHeight = 'auto'; }\r\n      if( G.O.thumbnailWidth == 0 || G.O.thumbnailWidth == '' ) { G.O.thumbnailWidth = 'auto'; }\r\n      if( G.O.thumbnailL1Height == 0 || G.O.thumbnailL1Height == '' ) { G.O.thumbnailL1Height = 'auto'; }\r\n      if( G.O.thumbnailL1Width == 0 || G.O.thumbnailL1Width == '' ) { G.O.thumbnailL1Width = 'auto'; }\r\n\r\n      // RETRIEVE ALL THUMBNAIL SIZES\r\n      function ThumbnailSizes( srcOpt, onlyl1, opt) {\r\n        if( G.O[srcOpt] == null ) { return; }\r\n        \r\n        if( toType(G.O[srcOpt]) == 'number' ) {\r\n          ThumbnailsSetSize( opt, 'l1', G.O[srcOpt], 'u');\r\n          if( !onlyl1 ) {\r\n            ThumbnailsSetSize( opt, 'lN', G.O[srcOpt], 'u');\r\n          }\r\n        }\r\n        else {\r\n          var ws=G.O[srcOpt].split(' ');\r\n          var v = 'auto';\r\n          if( ws[0].substring(0,4) != 'auto' ) { v=parseInt(ws[0]); }\r\n          var c = 'u';\r\n          if( ws[0].charAt(ws[0].length - 1) == 'C' ) { c='c'; }\r\n          ThumbnailsSetSize( opt, 'l1', v, c );   // default value for all resolutions and navigation levels\r\n          if( !onlyl1 ) {\r\n            ThumbnailsSetSize( opt, 'lN', v, c );\r\n          }\r\n          for( var i = 1; i < ws.length; i++ ) {\r\n            var r = ws[i].substring(0,2).toLowerCase();\r\n            if( /xs|sm|me|la|xl/i.test(r) ) {\r\n              var w = ws[i].substring(2);\r\n              var v = 'auto';\r\n              if( w.substring(0,4) != 'auto' ) { v = parseInt(w); }\r\n              var c = 'u';\r\n              if( w.charAt(w.length - 1) == 'C' ) { c = 'c'; }\r\n              G.tn.settings[opt]['l1'][r] = v;\r\n              G.tn.settings[opt]['l1'][r + 'c'] = c;\r\n              if( !onlyl1 ) {\r\n                G.tn.settings[opt]['lN'][r] = v;\r\n                G.tn.settings[opt]['lN'][r + 'c'] = c;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      ThumbnailSizes( 'thumbnailWidth', false, 'width');\r\n      ThumbnailSizes( 'thumbnailL1Width', true, 'width');\r\n      \r\n      ThumbnailSizes( 'thumbnailHeight', false, 'height');\r\n      ThumbnailSizes( 'thumbnailL1Height', true, 'height');\r\n\r\n      \r\n      G.O.thumbnailBorderHorizontal = parseInt(G.O.thumbnailBorderHorizontal);\r\n      G.O.thumbnailBorderVertical = parseInt(G.O.thumbnailBorderVertical);\r\n      G.O.thumbnailLabelHeight = parseInt(G.O.thumbnailLabelHeight);\r\n\r\n      \r\n      // retrieve all mosaic layout patterns\r\n      // default pattern\r\n      if( G.O.galleryMosaic != undefined ) {\r\n        // clone object\r\n        G.tn.settings.mosaic.l1.xs = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.l1.sm = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.l1.me = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.l1.la = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.l1.xl = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.xs = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.sm = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.me = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.la = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaic.lN.xl = JSON.parse(JSON.stringify(G.O.galleryMosaic));\r\n        G.tn.settings.mosaicCalcFactor('l1', 'xs');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'sm');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'me');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'la');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'xl');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'xs');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'sm');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'me');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'la');\r\n        G.tn.settings.mosaicCalcFactor('lN', 'xl');\r\n      }\r\n      if( G.O.galleryL1Mosaic != undefined ) {\r\n        // default L1 pattern\r\n        G.tn.settings.mosaic.l1.xs = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaic.l1.sm = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaic.l1.me = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaic.l1.la = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaic.l1.xl = JSON.parse(JSON.stringify(G.O.galleryL1Mosaic));\r\n        G.tn.settings.mosaicCalcFactor('l1', 'xs');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'sm');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'me');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'la');\r\n        G.tn.settings.mosaicCalcFactor('l1', 'xl');\r\n      }\r\n      for( var w = 0; w < G.tn.settings.mosaic.l1; w++ ) {\r\n        if( G.O['galleryMosaic' + G.tn.settings.mosaic.l1[w].toUpperCase()] != undefined ) {\r\n          G.tn.settings.mosaic.lN[tn.settings.mosaic.l1[w]] = JSON.parse(JSON.stringify( G.O['galleryMosaic' + G.tn.settings.mosaic.l1[w].toUpperCase()] ));\r\n          G.tn.settings.mosaic.l1[tn.settings.mosaic.l1[w]] = JSON.parse(JSON.stringify( G.O['galleryMosaic' + G.tn.settings.mosaic.l1[w].toUpperCase()] ));\r\n          G.tn.settings.mosaicCalcFactor('l1', G.tn.settings.mosaic.l1[w]);\r\n          G.tn.settings.mosaicCalcFactor('lN', G.tn.settings.mosaic.l1[w]);\r\n        }\r\n      }\r\n      for( var w = 0; w < G.tn.settings.mosaic.l1; w++ ) {\r\n        if( G.O['galleryL1Mosaic'+G.tn.settings.mosaic.l1[w].toUpperCase()] != undefined ) {\r\n          G.tn.settings.mosaic.l1[tn.settings.mosaic.l1[w]] = JSON.parse(JSON.stringify( G.O['galleryL1Mosaic'+G.tn.settings.mosaic.l1[w].toUpperCase()] ));\r\n          G.tn.settings.mosaicCalcFactor('l1', G.tn.settings.mosaic.l1[w]);\r\n        }\r\n      }\r\n      \r\n      G.O.imageTransition = G.O.imageTransition.toUpperCase();\r\n\r\n      G.layout.SetEngine();\r\n      \r\n      // init plugins\r\n      switch( G.O.kind ) {\r\n        // MARKUP / API\r\n        case '':\r\n          break;\r\n        // JSON, Flickr, Picasa, ...\r\n        default:\r\n        jQuery.nanogallery2['data_' + G.O.kind](G, 'Init' );\r\n      }\r\n\r\n    }\r\n\r\n    // HOVER EFFECTS\r\n    function ThumbnailHoverEffectExtract( name, effect) {\r\n      var easings = [ 'easeInQuad', 'easeOutQuad', 'easeInOutQuad', 'easeInCubic', 'easeOutCubic', 'easeInOutCubic', 'easeInQuart', 'easeOutQuart', 'easeInOutQuart', 'easeInQuint', 'easeOutQuint', 'easeInOutQuint', 'easeInSine', 'easeOutSine', 'easeInOutSine', 'easeInExpo', 'easeOutExpo', 'easeInOutExpo', 'easeInCirc', 'easeOutCirc', 'easeInOutCirc', 'easeOutBounce', 'easeInBack', 'easeOutBack', 'easeInOutBack', 'elastic', 'bounce'];\r\n    \r\n      var sp = name.split('_');\r\n      if( sp.length >= 4 ) {\r\n        // var oDef=NewTHoverEffect();\r\n        effect.name = '';\r\n        effect.type = sp[1];\r\n        effect.from = sp[2];\r\n        effect.to = sp[3];\r\n        if( sp.length >= 5 ) {\r\n          // effect.duration=sp[4];\r\n\r\n          for( var n = 4; n < sp.length; n++ ) {\r\n            var v = sp[n];\r\n            \r\n            // check if an easing name\r\n            var foundEasing = false;\r\n            for( var e = 0; e < easings.length; e++) {\r\n              if( v == easings[e] ) {\r\n                foundEasing = true;\r\n                effect.easing = v;\r\n                break;\r\n              }\r\n            }\r\n            if( foundEasing === true ) {\r\n              continue;\r\n            }\r\n            \r\n            v = v.toUpperCase();\r\n            \r\n            if( v == 'HOVERIN' ) {\r\n              effect.hoverout = false;\r\n              continue;\r\n            }\r\n            if( v == 'HOVEROUT' ) {\r\n              effect.hoverin = false;\r\n              continue;\r\n            }\r\n            \r\n            if( v == 'KEYFRAME' ) {\r\n              effect.firstKeyframe = false;\r\n              continue;\r\n            }\r\n            \r\n            var num = parseInt(v.replace(/[^0-9\\.]/g, ''), 10);   // extract a number if one exists\r\n\r\n            if( num > 0 ) {\r\n              // the string contains a numbers > 0\r\n              if( v.indexOf('DURATION') >= 0 ) {\r\n                effect.duration = num;\r\n                continue;\r\n              }\r\n              if( v.indexOf('DURATIONBACK') >= 0 ) {\r\n                effect.durationBack = num;\r\n                continue;\r\n              }\r\n              if( v.indexOf('DELAY') >= 0 ) {\r\n                effect.delay = num;\r\n                continue;\r\n              }\r\n              if( v.indexOf('DELAYBACK') >= 0 ) {\r\n                effect.delayBack = num;\r\n                continue;\r\n              }\r\n              \r\n              // no parameter name found -> default is duration\r\n              effect.duration = num;\r\n            }\r\n          }\r\n        }        \r\n        effect.element=ThumbnailOverEffectsGetCSSElement(sp[0], effect.type);\r\n        \r\n      }\r\n      else {\r\n        effect.name = name;\r\n        // NanoAlert(G, 'incorrect parameter for \"thumbnailHoverEffect\": ' + name);\r\n        // return null;\r\n      }\r\n      return effect;\r\n    }\r\n    \r\n    \r\n    function ThumbnailOverEffectsGetCSSElement( element, property ) {\r\n        var r = element;\r\n        \r\n        switch ( element ) {\r\n          case 'image':\r\n            if( property == 'blur' || property == 'brightness' || property == 'grayscale' || property == 'sepia' || property == 'contrast' || property == 'opacity'|| property == 'saturate' ) {\r\n              // r='.nGY2GThumbnailImg';\r\n              r = '.nGY2GThumbnailImage';\r\n            }\r\n            else {\r\n              r = '.nGY2GThumbnailImage';\r\n            }\r\n            break;\r\n          case 'thumbnail':\r\n            r = '.nGY2GThumbnail';\r\n            break;\r\n          case 'label':\r\n            r = '.nGY2GThumbnailLabel';\r\n            break;\r\n          case 'title':\r\n            r = '.nGY2GThumbnailTitle';\r\n            break;\r\n          case 'description':\r\n            r = '.nGY2GThumbnailDescription';\r\n            break;\r\n          case 'tools':\r\n            r = '.nGY2GThumbnailIcons';\r\n            break;\r\n          case 'customlayer':\r\n            r = '.nGY2GThumbnailCustomLayer';\r\n            break;\r\n        }\r\n        return r;\r\n    }\r\n    \r\n    // convert preset hover effects to new ones (nanogallery2)\r\n    function ThumbnailOverEffectsPreset( effects ) {\r\n\r\n      // COMPATIBILITY WITH nanoGALLERY\r\n      // OK:\r\n      //  'borderLighter', 'borderDarker', 'scale120', 'labelAppear', 'labelAppear75', 'labelOpacity50', 'scaleLabelOverImage'\r\n      //  'overScale', 'overScaleOutside', 'descriptionAppear'\r\n      //  'slideUp', 'slideDown', 'slideRight', 'slideLeft'\r\n      //  'imageScale150', 'imageScaleIn80', 'imageScale150Outside', 'imageSlideUp', 'imageSlideDown', 'imageSlideRight', 'imageSlideLeft'\r\n      //  'labelSlideUpTop', 'labelSlideUp', 'labelSlideDown', 'descriptionSlideUp'\r\n      // KO:\r\n      //  'labelSplit4', 'labelSplitVert', 'labelAppearSplit4', 'labelAppearSplitVert' \r\n      // TODO:\r\n      //  'rotateCornerBL', 'rotateCornerBR', 'imageSplit4', 'imageSplitVert', 'imageRotateCornerBL', 'imageRotateCornerBR', 'imageFlipHorizontal', 'imageFlipVertical'\r\n\r\n    \r\n   \r\n      var newEffects=[];\r\n      for( var i=0; i< effects.length; i++ ) {\r\n        switch( effects[i].name.toUpperCase() ) {\r\n          case 'BORDERLIGHTER':\r\n            // var color=ngtinycolor(GalleryThemeGetCurrent().thumbnail.borderColor);\r\n            // name='thumbnail_borderColor_'+color.toRgbString()+'_'+color.lighten(50).toRgbString();\r\n            \r\n            var rgb = ColorHelperToRGB(GalleryThemeGetCurrent().thumbnail.borderColor);\r\n            name = 'thumbnail_borderColor_'+rgb+'_'+ShadeBlendConvert(0.5, rgb );\r\n            newEffects.push(ThumbnailHoverEffectExtract(name, effects[i]));\r\n            break;\r\n          case 'BORDERDARKER':\r\n            // var color=ngtinycolor(GalleryThemeGetCurrent().thumbnail.borderColor);\r\n            // name='thumbnail_borderColor_'+color.toRgbString()+'_'+color.darken(50).toRgbString();\r\n            var rgb = ColorHelperToRGB(GalleryThemeGetCurrent().thumbnail.borderColor);\r\n            name = 'thumbnail_borderColor_'+rgb+'_'+ShadeBlendConvert(-0.5, rgb );\r\n            newEffects.push(ThumbnailHoverEffectExtract(name, effects[i]));\r\n            break;\r\n          case 'SCALE120':\r\n            newEffects.push(ThumbnailHoverEffectExtract('thumbnail_scale_1.00_1.20', effects[i]));\r\n            break;\r\n          case 'LABELAPPEAR':\r\n          case 'LABELAPPEAR75':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_opacity_0.00_1.00', effects[i]));\r\n            break;\r\n          case 'TOOLSAPPEAR':\r\n            newEffects.push(ThumbnailHoverEffectExtract('tools_opacity_0_1', effects[i]));\r\n            break;\r\n          case 'TOOLSSLIDEDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('tools_translateY_-100%_0%', effects[i]));\r\n            break;\r\n          case 'TOOLSSLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('tools_translateY_100%_0%', effects[i]));\r\n            break;\r\n          case 'LABELOPACITY50':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_opacity_1.00_0.50', effects[i]));\r\n            break;\r\n          case 'LABELSLIDEUPTOP':\r\n          case 'LABELSLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_100%_0%', effects[i]));\r\n            break;\r\n          case 'LABELSLIDEDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_-100%_0%', effects[i]));\r\n            break;\r\n          case 'SCALELABELOVERIMAGE':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_scale_0.00_1.00', effects[i]));\r\n            var n = cloneJSObject(effects[i]);\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_scale_1.00_0.00', n));\r\n            break;\r\n          case 'OVERSCALE':\r\n          case 'OVERSCALEOUTSIDE':\r\n            name = 'label_scale_0_100';\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_scale_2.00_1.00', effects[i]));\r\n            var n = cloneJSObject(effects[i]);\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_opacity_0.00_1.00', n));\r\n            n = cloneJSObject(effects[i]);\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_scale_1.00_0.00', n));\r\n            n = cloneJSObject(effects[i]);\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_opacity_1.00_0.00', n));\r\n            break;\r\n          case 'DESCRIPTIONAPPEAR':\r\n            newEffects.push(ThumbnailHoverEffectExtract('description_opacity_0_1', effects[i]));\r\n            break;\r\n          case 'SLIDERIGHT':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateX_0%_100%', effects[i]));\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateX_-100%_0%', cloneJSObject(effects[i])));\r\n            break;\r\n          case 'SLIDELEFT':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateX_0%_-100%', effects[i]));\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateX_100%_0%', cloneJSObject(effects[i])));\r\n            break;\r\n          case 'SLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateY_0%_-100%', effects[i]));\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_100%_0%', cloneJSObject(effects[i])));\r\n            break;\r\n          case 'SLIDEDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateY_0%_100%', effects[i]));\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_-100%_0%', cloneJSObject(effects[i])));\r\n            break;\r\n          case 'IMAGESCALE150':\r\n          case 'IMAGESCALE150OUTSIDE':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_scale_1.00_1.50', effects[i]));\r\n            break;\r\n          case 'IMAGESCALEIN80':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_scale_1.20_1.00', effects[i]));\r\n            break;\r\n          case 'IMAGESLIDERIGHT':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateX_0%_100%', effects[i]));\r\n            break;\r\n          case 'IMAGESLIDELEFT':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateX_0%_-100%', effects[i]));\r\n            break;\r\n          case 'IMAGESLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateY_0%_-100%', effects[i]));\r\n            break;\r\n          case 'IMAGESLIDEDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_translateY_0%_100%', effects[i]));\r\n            break;\r\n          case 'LABELSLIDEUP':\r\n          case 'LABELSLIDEUPTOP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_100%_0%', effects[i]));\r\n            break;\r\n          case 'LABELSLIDEUPDOWN':\r\n            newEffects.push(ThumbnailHoverEffectExtract('label_translateY_0%_100%', effects[i]));\r\n            break;\r\n          case 'DESCRIPTIONSLIDEUP':\r\n            newEffects.push(ThumbnailHoverEffectExtract('description_translateY_110%_0%', effects[i]));\r\n            break;\r\n\r\n          case 'IMAGEBLURON':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_blur_2.00px_0.00px', effects[i]));\r\n            break;\r\n          case 'IMAGEBLUROFF':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_blur_0.00px_2.00px', effects[i]));\r\n            break;\r\n          case 'IMAGEGRAYON':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_grayscale_0%_100%', effects[i]));\r\n            break;\r\n          case 'IMAGEGRAYOFF':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_grayscale_100%_0%', effects[i]));\r\n            break;\r\n          case 'IMAGESEPIAON':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_sepia_100%_1%', effects[i]));\r\n            break;\r\n          case 'IMAGESEPIAOFF':\r\n            newEffects.push(ThumbnailHoverEffectExtract('image_sepia_1%_100%', effects[i]));\r\n            break;\r\n            \r\n          default:\r\n            newEffects.push(effects[i]);\r\n            break;\r\n        }\r\n      }\r\n      \r\n      return newEffects;\r\n    }\r\n\r\n\r\n    // Thumbnail hover effect definition\r\n    function NewTHoverEffect() {\r\n      var oDef={ \r\n          name:           '',\r\n          element:        '',               // element class\r\n          type:           '',               \r\n          from:           '',               // start value\r\n          to:             '',               // end value\r\n          hoverin:        true,\r\n          hoverout:       true,\r\n          firstKeyframe:  true,\r\n          delay:          0,\r\n          delayBack:      0,\r\n          duration:       400,\r\n          durationBack:   300,\r\n          easing:         'easeOutQuart',\r\n          easingBack:     'easeOutQuart',\r\n          animParam:      null\r\n        };\r\n      return oDef;\r\n    }\r\n\r\n    function NewTBuildInit() {\r\n      // to set CSS properties\r\n      var oDef={ element: '', property: '', value: '' };\r\n      return oDef;\r\n    }\r\n\r\n    \r\n    function ThumbnailStyle( cfg, level) {\r\n    \r\n      switch( cfg.position ){\r\n        case 'onBottom' :\r\n          G.tn.style[level]['label'] = 'bottom:0; ';\r\n          break;\r\n        case 'overImageOnTop' :\r\n          G.tn.style[level]['label'] = 'top:0; position:absolute;';\r\n          break;\r\n        case 'overImageOnMiddle' :\r\n          G.tn.style[level]['label'] = 'top:0; bottom:0;';\r\n          G.tn.style[level]['title'] = 'position:absolute; bottom:50%;';\r\n          G.tn.style[level]['desc'] = 'position:absolute; top:50%;';\r\n          break;\r\n        case 'custom' :\r\n          break;\r\n        case 'overImageOnBottom' :\r\n        default :\r\n          G.O.thumbnailLabel.position = 'overImageOnBottom';\r\n          G.tn.style[level].label = 'bottom:0; position:absolute;';\r\n          break;\r\n      }\r\n      // if( G.layout.engine != 'CASCADING' ) {\r\n      if( cfg.position != 'onBottom' ) {\r\n        // multi-line\r\n        if( cfg.titleMultiLine ) {\r\n          G.tn.style[level]['title'] = 'white-space:normal;';\r\n        }\r\n        if( cfg.descriptionMultiLine ) {\r\n          G.tn.style[level]['desc'] = 'white-space:normal;';\r\n        }\r\n      }\r\n      \r\n      \r\n      switch( cfg.align ) {\r\n        case 'right':\r\n            G.tn.style[level].label += 'text-align:right;';\r\n          break;\r\n        case 'left':\r\n            G.tn.style[level].label += 'text-align:left;';\r\n          break;\r\n        default:\r\n            G.tn.style[level].label += 'text-align:center;';\r\n          break;\r\n      }\r\n      if( cfg.titleFontSize != undefined && cfg.titleFontSize != '' ) {\r\n        G.tn.style[level].title += 'font-size:' + cfg.titleFontSize + ';';\r\n      }\r\n      if( cfg.descriptionFontSize != undefined && cfg.descriptionFontSize != '' ) {\r\n        G.tn.style[level].desc += 'font-size:' + cfg.descriptionFontSize + ';';\r\n      }\r\n      \r\n      if( cfg.displayDescription == false ) {\r\n        G.tn.style[level].desc += 'display:none;';\r\n      }\r\n    }\r\n\r\n    \r\n    // cache some thumbnail settings\r\n    function ThumbnailDefCaches() {\r\n      // thumbnail content CSS styles\r\n\r\n      // settings for level L1 and LN\r\n      ThumbnailStyle( G.O.thumbnailLabel, 'lN');\r\n      ThumbnailStyle( G.O.thumbnailLabel, 'l1');\r\n\r\n      if( G.O.thumbnailL1Label && G.O.thumbnailL1Label.display ) {\r\n        // settings for level L1\r\n        ThumbnailStyle( G.O.thumbnailL1Label, 'l1');\r\n      }\r\n      \r\n      G.tn.borderWidth = G.O.thumbnailBorderHorizontal;\r\n      G.tn.borderHeight = G.O.thumbnailBorderVertical;\r\n      \r\n\r\n      // default thumbnail sizes levels l1 and lN\r\n      var lst=['xs','sm','me','la','xl'];\r\n      for( var i = 0; i < lst.length; i++ ) {\r\n        var w = G.tn.settings.width.lN[lst[i]];\r\n        if( w != 'auto' ) {\r\n          G.tn.defaultSize.width.lN[lst[i]] = w;\r\n          G.tn.defaultSize.width.l1[lst[i]] = w;\r\n        }\r\n        else {\r\n          var h = G.tn.settings.height.lN[lst[i]];\r\n          G.tn.defaultSize.width.lN[lst[i]] = h;      // dynamic width --> set height value as default for the width\r\n          G.tn.defaultSize.width.l1[lst[i]] = h;      // dynamic width --> set height value as default\r\n        }\r\n      }\r\n      for( var i = 0; i < lst.length; i++ ) {\r\n        var h = G.tn.settings.height.lN[lst[i]];\r\n        if( h != 'auto' ) {\r\n          // grid or justified layout\r\n          G.tn.defaultSize.height.lN[lst[i]] = h;  //+G.tn.labelHeight.get();\r\n          G.tn.defaultSize.height.l1[lst[i]] = h;  //+G.tn.labelHeight.get();\r\n        }\r\n        else {\r\n          var w = G.tn.settings.width.lN[lst[i]];\r\n          G.tn.defaultSize.height.lN[lst[i]] = w;      // dynamic height --> set width value as default for the height\r\n          G.tn.defaultSize.height.l1[lst[i]] = w;      // dynamic height --> set width value as default\r\n        }\r\n      }\r\n\r\n      // default thumbnail sizes levels l1\r\n      for( var i = 0; i < lst.length; i++ ) {\r\n        var w = G.tn.settings.width.l1[lst[i]];\r\n        if( w != 'auto' ) {\r\n          G.tn.defaultSize.width.l1[lst[i]] = w;\r\n        }\r\n        else {\r\n          var h = G.tn.settings.height.l1[lst[i]];\r\n          G.tn.defaultSize.width.l1[lst[i]] = h;      // dynamic width --> set height value as default\r\n        }\r\n      }\r\n      for( var i = 0; i < lst.length; i++ ) {\r\n        var h = G.tn.settings.height.l1[lst[i]];\r\n        if( h != 'auto' ) {\r\n          // grid or justified layout\r\n          G.tn.defaultSize.height.l1[lst[i]] = h;  //+G.tn.labelHeight.get();\r\n        }\r\n        else {\r\n          var w = G.tn.settings.width.l1[lst[i]];\r\n          G.tn.defaultSize.height.l1[lst[i]]= w ;      // dynamic height --> set width value as default\r\n        }\r\n      }\r\n      \r\n    }\r\n    \r\n\r\n    // ##### THUMBNAIL SIZE MANAGEMENT\r\n    function ThumbnailsSetSize( dir, level, v, crop ) {\r\n      G.tn.settings[dir][level]['xs'] = v;\r\n      G.tn.settings[dir][level]['sm'] = v;\r\n      G.tn.settings[dir][level]['me'] = v;\r\n      G.tn.settings[dir][level]['la'] = v;\r\n      G.tn.settings[dir][level]['xl'] = v;\r\n      G.tn.settings[dir][level]['xsc'] = crop;\r\n      G.tn.settings[dir][level]['smc'] = crop;\r\n      G.tn.settings[dir][level]['mec'] = crop;\r\n      G.tn.settings[dir][level]['lac'] = crop;\r\n      G.tn.settings[dir][level]['xlc'] = crop;\r\n    }\r\n\r\n\r\n    //\r\n    function GalleryThemeGetCurrent() {\r\n\r\n      var cs=null;\r\n      switch(toType(G.O.galleryTheme)) {\r\n        case 'object':    // user custom color scheme object \r\n          cs = G.galleryTheme_dark;  // default color scheme\r\n          jQuery.extend(true,cs,G.O.galleryTheme);\r\n          break;\r\n        case 'string':    // name of an internal defined color scheme\r\n          switch( G.O.galleryTheme ) {\r\n            case 'light':\r\n              cs = G.galleryTheme_light;\r\n              break;\r\n            case 'default':\r\n            case 'dark':\r\n            case 'none':\r\n            default:\r\n              cs = G.galleryTheme_dark;\r\n          }\r\n          break;\r\n        default:\r\n          cs = G.galleryTheme_dark;\r\n      }\r\n      return cs;\r\n    }\r\n    \r\n    // ##### BREADCRUMB/THUMBNAIL COLOR SCHEME #####\r\n    function SetGalleryTheme() {\r\n    \r\n      if( typeof G.O.colorScheme  !== 'undefined' ) {\r\n        G.O.galleryTheme = G.O.colorScheme;\r\n      }\r\n\r\n      var cs = null;\r\n      var galleryTheme = '';\r\n      switch(toType(G.O.galleryTheme)) {\r\n        case 'object':    // user custom color scheme object \r\n          cs = G.galleryTheme_dark;  // default color scheme\r\n          jQuery.extend(true,cs,G.O.galleryTheme);\r\n          galleryTheme='nanogallery_gallerytheme_custom_' + G.baseEltID;\r\n          break;\r\n        case 'string':    // name of an internal defined color scheme\r\n          switch( G.O.galleryTheme ) {\r\n            case 'light':\r\n              cs = G.galleryTheme_light;\r\n              galleryTheme='nanogallery_gallerytheme_light_' + G.baseEltID;\r\n              break;\r\n            case 'default':\r\n            case 'dark':\r\n            case 'none':\r\n            default:\r\n              cs = G.galleryTheme_dark;\r\n              galleryTheme='nanogallery_gallerytheme_dark_' + G.baseEltID;\r\n          }\r\n          break;\r\n        default:\r\n          NanoAlert(G, 'Error in galleryTheme parameter.');\r\n          return;\r\n      }\r\n\r\n      //var s1='.nanogallery_theme_'+G.O.theme+' ';\r\n      var s1='.' + galleryTheme + ' ';\r\n    \r\n      // navigation bar\r\n      var s=s1+'.nGY2Navigationbar { background:'+cs.navigationBar.background+'; }'+'\\n';\r\n      if( cs.navigationBar.border !== undefined && cs.navigationBar.border !== '' ) { s+=s1+'.nGY2Navigationbar { border:'+cs.navigationBar.border+'; }'+'\\n'; }\r\n      if( cs.navigationBar.borderTop !== undefined && cs.navigationBar.borderTop !== '' ) { s+=s1+'.nGY2Navigationbar { border-top:'+cs.navigationBar.borderTop+'; }'+'\\n'; }\r\n      if( cs.navigationBar.borderBottom !== undefined && cs.navigationBar.borderBottom !== '' ) { s+=s1+'.nGY2Navigationbar { border-bottom:'+cs.navigationBar.borderBottom+'; }'+'\\n'; }\r\n      if( cs.navigationBar.borderRight !== undefined && cs.navigationBar.borderRight !== '' ) { s+=s1+'.nGY2Navigationbar { border-right:'+cs.navigationBar.borderRight+'; }'+'\\n'; }\r\n      if( cs.navigationBar.borderLeft !== undefined && cs.navigationBar.borderLeft !== '' ) { s+=s1+'.nGY2Navigationbar { border-left:'+cs.navigationBar.borderLeft+'; }'+'\\n'; }\r\n      \r\n      // navigation bar - breadcrumb\r\n      s+=s1+'.nGY2Breadcrumb { background:'+cs.navigationBreadcrumb.background+'; border-radius:'+cs.navigationBreadcrumb.borderRadius+'; }'+'\\n';\r\n      s+=s1+'.nGY2Breadcrumb .oneItem  { color:'+cs.navigationBreadcrumb.color+'; }'+'\\n';\r\n      s+=s1+'.nGY2Breadcrumb .oneItem:hover { color:'+cs.navigationBreadcrumb.colorHover+'; }'+'\\n';\r\n\r\n      // navigation bar - tag filter\r\n      s+=s1+'.nGY2NavFilterUnselected { color:'+cs.navigationFilter.color+'; background:'+cs.navigationFilter.background+'; border-radius:'+cs.navigationFilter.borderRadius+'; }'+'\\n';\r\n      s+=s1+'.nGY2NavFilterSelected { color:'+cs.navigationFilter.colorSelected+'; background:'+cs.navigationFilter.backgroundSelected+'; border-radius:'+cs.navigationFilter.borderRadius+'; }'+'\\n';\r\n      s+=s1+'.nGY2NavFilterSelectAll { color:'+cs.navigationFilter.colorSelected+'; background:'+cs.navigationFilter.background+'; border-radius:'+cs.navigationFilter.borderRadius+'; }'+'\\n';\r\n      \r\n      // thumbnails\r\n      s+=s1+'.nGY2GThumbnail { background:'+cs.thumbnail.background+'; border-color:'+cs.thumbnail.borderColor+'; border-top-width:'+G.O.thumbnailBorderVertical+'px; border-right-width:'+G.O.thumbnailBorderHorizontal+'px; border-bottom-width:'+G.O.thumbnailBorderVertical+'px; border-left-width:'+G.O.thumbnailBorderHorizontal+'px;}'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailStack { background:'+cs.thumbnail.stackBackground+'; }'+'\\n';\r\n      // s+=s1+'.nGY2GThumbnailImage { background:'+cs.thumbnail.background+'; background-image:'+cs.thumbnail.backgroundImage+'; }'+'\\n';\r\n      s+=s1+'.nGY2TnImgBack { background:'+cs.thumbnail.background+'; background-image:'+cs.thumbnail.backgroundImage+'; }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailAlbumUp { background:'+cs.thumbnail.background+'; background-image:'+cs.thumbnail.backgroundImage+'; color:'+cs.thumbnail.titleColor+'; }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailIconsFullThumbnail { color:'+cs.thumbnail.titleColor+'; }\\n';\r\n      s+=s1+'.nGY2GThumbnailLabel { background:'+cs.thumbnail.labelBackground+'; opacity:'+cs.thumbnail.labelOpacity+'; }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailImageTitle  { color:'+cs.thumbnail.titleColor+'; background-color:'+cs.thumbnail.titleBgColor+'; '+(cs.thumbnail.titleShadow =='' ? '': 'Text-Shadow:'+cs.thumbnail.titleShadow+';')+' }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailAlbumTitle { color:'+cs.thumbnail.titleColor+'; background-color:'+cs.thumbnail.titleBgColor+'; '+(cs.thumbnail.titleShadow =='' ? '': 'Text-Shadow:'+cs.thumbnail.titleShadow+';')+' }'+'\\n';\r\n      s+=s1+'.nGY2GThumbnailDescription { color:'+cs.thumbnail.descriptionColor+'; background-color:'+cs.thumbnail.descriptionBgColor+'; '+(cs.thumbnail.descriptionShadow =='' ? '': 'Text-Shadow:'+cs.thumbnail.descriptionShadow+';')+' }'+'\\n';\r\n\r\n      // thumbnails - icons\r\n      s+=s1+'.nGY2GThumbnailIcons { padding:'+cs.thumbnailIcon.padding+'; }\\n';\r\n      s+=s1+'.nGY2GThumbnailIcon { color:'+cs.thumbnailIcon.color+'; }\\n';\r\n      s+=s1+'.nGY2GThumbnailIconTextBadge { background-color:'+cs.thumbnailIcon.color+'; }\\n';\r\n      \r\n      // gallery pagination -> dot/rectangle based\r\n      if( G.O.galleryPaginationMode != 'NUMBERS' ) {\r\n        s+=s1+'.nGY2paginationDot { border:'+cs.pagination.shapeBorder+'; background:'+cs.pagination.shapeColor+';}\\n';\r\n        s+=s1+'.nGY2paginationDotCurrentPage { border:'+cs.pagination.shapeBorder+'; background:'+cs.pagination.shapeSelectedColor+';}\\n';\r\n        s+=s1+'.nGY2paginationRectangle { border:'+cs.pagination.shapeBorder+'; background:'+cs.pagination.shapeColor+';}\\n';\r\n        s+=s1+'.nGY2paginationRectangleCurrentPage { border:'+cs.pagination.shapeBorder+'; background:'+cs.pagination.shapeSelectedColor+';}\\n';\r\n      } else {\r\n        s+=s1+'.nGY2paginationItem { background:'+cs.pagination.background+'; color:'+cs.pagination.color+'; border-radius:'+cs.pagination.borderRadius+'; }\\n';\r\n        s+=s1+'.nGY2paginationItemCurrentPage { background:'+cs.pagination.background+'; color:'+cs.pagination.color+'; border-radius:'+cs.pagination.borderRadius+'; }\\n';\r\n        s+=s1+'.nGY2PaginationPrev { background:'+cs.pagination.background+'; color:'+cs.pagination.color+'; border-radius:'+cs.pagination.borderRadius+'; }\\n';\r\n        s+=s1+'.nGY2PaginationNext { background:'+cs.pagination.background+'; color:'+cs.pagination.color+'; border-radius:'+cs.pagination.borderRadius+'; }\\n';\r\n        s+=s1+'.nGY2paginationItemCurrentPage { background:'+cs.pagination.backgroundSelected+'; }\\n';\r\n      }\r\n      \r\n      // gallery more button\r\n      s+=s1+'.nGY2GalleryMoreButtonAnnotation { background:'+cs.thumbnail.background+'; border-color:'+cs.thumbnail.borderColor+'; border-top-width:'+G.O.thumbnailBorderVertical+'px; border-right-width:'+G.O.thumbnailBorderHorizontal+'px; border-bottom-width:'+G.O.thumbnailBorderVertical+'px; border-left-width:'+G.O.thumbnailBorderHorizontal+'px;}\\n';\r\n      s+=s1+'.nGY2GalleryMoreButtonAnnotation  { color:'+cs.thumbnail.titleColor+'; '+(cs.thumbnail.titleShadow =='' ? '': 'Text-Shadow:'+cs.thumbnail.titleShadow)+'; }\\n';\r\n      \r\n      jQuery('head').append('<style id=\"ngycs_'+G.baseEltID+'\">'+s+'</style>');\r\n      G.$E.base.addClass(galleryTheme);\r\n\r\n    };\r\n    \r\n    // ##### VIEWER COLOR SCHEME #####\r\n    function SetViewerTheme( ) {\r\n\r\n      if( G.VOM.viewerTheme != '' ) {\r\n        G.VOM.$cont.addClass(G.VOM.viewerTheme);\r\n        return;\r\n      }\r\n\r\n      if( typeof G.O.colorSchemeViewer  !== 'undefined' ) {\r\n        G.O.viewerTheme = G.O.colorSchemeViewer;\r\n      }\r\n\r\n      var cs=null;\r\n      switch(toType(G.O.viewerTheme)) {\r\n        case 'object':    // user custom color scheme object \r\n          cs = G.viewerTheme_dark;\r\n          jQuery.extend(true, cs, G.O.viewerTheme);\r\n          G.VOM.viewerTheme = 'nanogallery_viewertheme_custom_' + G.baseEltID;\r\n          break;\r\n        case 'string':    // name of an internal defined color scheme\r\n          switch( G.O.viewerTheme ) {\r\n            case 'none':\r\n              return;\r\n              break;\r\n            case 'light':\r\n              cs = G.viewerTheme_light;\r\n              G.VOM.viewerTheme = 'nanogallery_viewertheme_light_' + G.baseEltID;\r\n              break;\r\n            case 'border':\r\n              cs = G.viewerTheme_border;\r\n              G.VOM.viewerTheme = 'nanogallery_viewertheme_border_' + G.baseEltID;\r\n              break;\r\n            case 'dark':\r\n            case 'default':\r\n              cs = G.viewerTheme_dark;\r\n              G.VOM.viewerTheme = 'nanogallery_viewertheme_dark_' + G.baseEltID;\r\n              break;\r\n          }\r\n          break;\r\n        default:\r\n          NanoAlert(G, 'Error in viewerTheme parameter.');\r\n          return;\r\n      }\r\n\r\n      var s1 = '.' + G.VOM.viewerTheme + ' ';\r\n      var s = s1 + '.nGY2Viewer { background:' + cs.background + '; }'+'\\n';\r\n      s += s1 + '.nGY2ViewerMedia { border:' + cs.imageBorder + '; box-shadow:' + cs.imageBoxShadow + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbarBackground { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .nGY2ViewerToolsTopLeft { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .nGY2ViewerToolsTopRight { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .nGY2ViewerAreaNext { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .nGY2ViewerAreaPrevious { background:' + cs.barBackground + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar { border:' + cs.barBorder + '; color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .previousButton:after { color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .nextButton:after { color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .closeButton:after { color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .label .title { color:' + cs.barColor + '; }'+'\\n';\r\n      s += s1 + '.nGY2Viewer .toolbar .label .description { color:' + cs.barDescriptionColor + '; }'+'\\n';\r\n      jQuery('head').append('<style>' + s + '</style>');\r\n      G.VOM.$cont.addClass(G.VOM.viewerTheme);\r\n    };\r\n\r\n    \r\n    \r\n    /** @function SetPolyFills */\r\n    function SetPolyFills() {\r\n\r\n      // POLYFILL FOR BIND function --> for older Safari mobile\r\n      // found on MDN: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind#Compatibility\r\n      if (!Function.prototype.bind) {\r\n        Function.prototype.bind = function (oThis) {\r\n          if (typeof this !== \"function\") {\r\n            // closest thing possible to the ECMAScript 5\r\n            // internal IsCallable function\r\n            throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\r\n          }\r\n\r\n          var aArgs = Array.prototype.slice.call(arguments, 1), \r\n              fToBind = this, \r\n              fNOP = function () {},\r\n              fBound = function () {\r\n                return fToBind.apply(this instanceof fNOP && oThis\r\n                       ? this\r\n                       : oThis,\r\n                       aArgs.concat(Array.prototype.slice.call(arguments)));\r\n              };\r\n\r\n          fNOP.prototype = this.prototype;\r\n          fBound.prototype = new fNOP();\r\n\r\n          return fBound;\r\n        };\r\n      }\r\n\r\n      // requestAnimationFrame polyfill by Erik M�ller. fixes from Paul Irish and Tino Zijdel\r\n      // http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n      // http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\r\n      // MIT license\r\n      (function() {\r\n        var lastTime = 0;\r\n        var vendors = ['ms', 'moz', 'webkit', 'o'];\r\n        for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n          window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];\r\n          window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame'] || window[vendors[x]+'CancelRequestAnimationFrame'];\r\n        }\r\n        if (!window.requestAnimationFrame)\r\n          window.requestAnimationFrame = function(callback, element) {\r\n            var currTime = new Date().getTime();\r\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n            var id = window.setTimeout(function() { callback(currTime + timeToCall); }, timeToCall);\r\n            lastTime = currTime + timeToCall;\r\n            return id;\r\n          };\r\n       \r\n        if (!window.cancelAnimationFrame)\r\n          window.cancelAnimationFrame = function(id) {\r\n            clearTimeout(id);\r\n          };\r\n      }());\r\n      \r\n      // array.removeIf -> removes items from array base on a function's result\r\n      Array.prototype.removeIf = function(callback) {\r\n        var i = this.length;\r\n        while (i--) {\r\n          if (callback(this[i], i)) {\r\n            this.splice(i, 1);\r\n          }\r\n        }\r\n      };  \n\n      // IE11 for startsWith \n      // thanks to @lichtamberg - https://github.com/lichtamberg\n      if (!String.prototype.startsWith) {\n        String.prototype.startsWith = function(searchString, position) {\n          position = position || 0;\n          return this.indexOf(searchString, position) === position;\n        };\n      }\r\n      \r\n    }\r\n    \r\n    \r\n    // Gallery clicked/touched -> retrieve & execute action\r\n    function GalleryClicked(e) {\r\n    \r\n      var r = GalleryEventRetrieveElementl(e, false);\r\n\r\n      if( r.GOMidx == -1 ) { return 'exit'; }\r\n      \r\n      var idx = G.GOM.items[r.GOMidx].thumbnailIdx;\r\n      if( G.GOM.slider.hostIdx == r.GOMidx ) {\r\n        // slider on thumbnail -> open the displayed image\r\n        idx = G.GOM.items[G.GOM.slider.currentIdx].thumbnailIdx;\r\n      }\r\n      switch( r.action ) {\r\n        case 'OPEN':\r\n          ThumbnailOpen(idx, false);\r\n          return 'exit';\r\n          break;\r\n        case 'DISPLAY':\r\n          // used the display icon (ignore if selection mode)\r\n          ThumbnailOpen(idx, true);\r\n          return 'exit';\r\n          break;\r\n        case 'TOGGLESELECT':\r\n          ThumbnailSelectionToggle(idx);\r\n          return 'exit';\r\n          break;\r\n        case 'SHARE':\r\n          PopupShare(idx);\r\n          return 'exit';\r\n          break;\r\n        case 'DOWNLOAD':\r\n          DownloadImage(idx);\r\n          return 'exit';\r\n          break;\r\n        case 'INFO':\r\n          ItemDisplayInfo(G.I[idx]);\r\n          return 'exit';\r\n          break;\r\n        case 'CART':\r\n          AddToCart(idx);\r\n          return 'exit';\r\n          break;\r\n        default:\r\n          // all other actions (custom1..10, or anything else)\r\n          var fu = G.O.fnThumbnailToolCustAction;\r\n          if( fu !== null ) {\r\n            typeof fu == 'function' ? fu(r.action, G.I[idx]) : window[fu](r.action, G.I[idx]);\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    // Download an image\r\n    function DownloadImage(idx) {\r\n      if( G.I[idx].mediaKind != 'img' ) { return; }\r\n\r\n      \r\n      var url = G.I[idx].src;\r\n\r\n      if( G.I[idx].downloadURL != undefined && G.I[idx].downloadURL != '' ) {\r\n        url = G.I[idx].downloadURL;\r\n      }\r\n      \n      var a = document.createElement('a');\n      a.href = url;\n      // a.download = url.split('.').pop();\r\n      a.download = url.split('/').pop();\r\n      a.target = '_blank';\r\n      a.style.display = 'none';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);      \n      \r\n    }\r\n    \r\n    // add one image to the shopping cart\r\n    function AddToCart( idx ) {\r\n      // increment counter if already in shopping cart\r\n      var found=false;\r\n      for( var i=0; i<G.shoppingCart.length; i++ ) {\r\n        if( G.shoppingCart[i].idx == idx ) {\r\n          G.shoppingCart[i].cnt++;\r\n          var fu = G.O.fnShoppingCartUpdated;\r\n          if( fu !== null ) {\r\n            typeof fu == 'function' ? fu(G.shoppingCart, G.I[idx]) : window[fu](G.shoppingCart, G.I[idx]);\r\n          }\r\n          TriggerCustomEvent('shoppingCartUpdated');\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // add to shopping cart\r\n      if( !found) {\r\n        G.shoppingCart.push( { idx:idx, ID:G.I[idx].GetID(), cnt:1} );\r\n        var fu=G.O.fnShoppingCartUpdated;\r\n        if( fu !== null ) {\r\n          typeof fu == 'function' ? fu(G.shoppingCart, G.I[idx]) : window[fu](G.shoppingCart, G.I[idx]);\n        }\n        TriggerCustomEvent('shoppingCartUpdated');\r\n      }\r\n    }\r\n    \r\n\r\n    // All thumbnails are set to unselected\r\n    function ThumbnailSelectionClear() {\r\n      G.GOM.nbSelected = 0;\r\n      for( var i = 0, nbTn = G.GOM.items.length; i < nbTn ; i++ ) {\r\n        var item = G .I[G.GOM.items[i].thumbnailIdx];\r\n        if( item.selected ) {\r\n          item.selected = false;\r\n          var fu = G.O.fnThumbnailSelection;\r\n          if( fu !== null ) {\r\n            typeof fu == 'function' ? fu(item.$elt, item, G.I) : window[fu](item.$elt, item, G.I);\r\n          }\r\n        }\r\n        item.selected = false;\r\n      }\r\n    }\r\n    \r\n    function ThumbnailSelectionToggle( idx ){\r\n      var item = G.I[idx];\r\n      if( item.selected === true ) {\r\n        ThumbnailSelectionSet(item, false);\r\n        G.GOM.nbSelected--;\r\n        TriggerCustomEvent('itemUnSelected');\r\n      }\r\n      else {\r\n        ThumbnailSelectionSet(item, true);\r\n        G.GOM.nbSelected++;\r\n        TriggerCustomEvent('itemSelected');\r\n      }\r\n    }\r\n    \r\n    \r\n    // this replaces ThumbnailSelection()\r\n    function ThumbnailSelectionSet(item, selected ){\r\n      \r\n      item.selected = selected;\r\n      \r\n      ThumbnailSelectionSetIcon( item );\r\n      \r\n      // called when the selection status of an item changed\n      var fu=G.O.fnThumbnailSelection;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(item.$elt, item, G.I) : window[fu](item.$elt, item, G.I);\r\n      }\r\n    \r\n    }\r\n    \r\n    function ThumbnailSelectionSetIcon( item ) {\r\n      if( item.$elt == null ) {\r\n        // thumbnail is not built\r\n        return;\r\n      }\r\n      // var $sub = item.$getElt('.nGY2GThumbnailSub');\r\n      var $sub = item.$getElt('.nGY2GThumbnail');\r\n      var $icon = item.$getElt('.nGY2GThumbnailIconImageSelect');\r\n      if( item.selected === true) {\r\n        $sub.addClass('nGY2GThumbnailSubSelected');\r\n        $icon.addClass('nGY2ThumbnailSelected');\r\n        $icon.removeClass('nGY2ThumbnailUnselected');\r\n        $icon.html(G.O.icons.thumbnailSelected);\r\n      }\r\n      else {\r\n        $sub.removeClass('nGY2GThumbnailSubSelected');\r\n        $icon.removeClass('nGY2ThumbnailSelected');\r\n        $icon.addClass('nGY2ThumbnailUnselected');\r\n        $icon.html(G.O.icons.thumbnailUnselected);\r\n      }\r\n    }\r\n    \r\n    \r\n    // display a modal popup for sharing image/album\r\n    function PopupShare(idx) {\r\n    \r\n      // SEE SAMPLES: https://gist.github.com/chrisjlee/5196139\r\n      // https://github.com/Julienh/Sharrre\r\n    \r\n      var item=G.I[idx];\r\n\r\n      var currentURL=document.location.protocol + '//' + document.location.hostname + document.location.pathname;\r\n      var newLocationHash = '#nanogallery/' + G.baseEltID + '/';\r\n      if( item.kind == 'image' ) {\r\n        newLocationHash += item.albumID + '/' + item.GetID();\r\n      }\r\n      else {\r\n        newLocationHash += item.GetID();\r\n      }\r\n    \r\n      var content = '';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"facebook\">'   + G.O.icons.shareFacebook +   '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"pinterest\">'  + G.O.icons.sharePinterest +  '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"tumblr\">'     + G.O.icons.shareTumblr +     '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"twitter\">'    + G.O.icons.shareTwitter +    '</div>';\r\n      // content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"googleplus\">' + G.O.icons.shareGooglePlus + '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"vk\">'         + G.O.icons.shareVK +         '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\" data-share=\"mail\">'       + G.O.icons.shareMail +       '</div>';\r\n      content += '<div class=\"nGY2PopupOneItem\" style=\"text-align:center;\"></div>';\r\n      content += '<input class=\"nGY2PopupOneItemText\" readonly type=\"text\" value=\"' + currentURL+newLocationHash + '\" style=\"width:100%;text-align:center;\">';\r\n      content += '<br>';\r\n\r\n      currentURL = encodeURIComponent(document.location.protocol + '//' + document.location.hostname + document.location.pathname + newLocationHash);\r\n\r\n      var currentTitle = item.title;\r\n      var currentTn = item.thumbImg().src;\r\n      \r\n      \r\n      Popup('Share to:', content, 'Center');\r\n      \r\n      G.popup.$elt.find('.nGY2PopupOneItem').on('click', function(e) {\r\n        e.stopPropagation();\r\n        \r\n        var shareURL = '';\r\n        var found = true;\r\n        switch(jQuery(this).attr('data-share').toUpperCase()) {\r\n          case 'FACEBOOK':\r\n            // <a name=\"fb_share\" type=\"button\" href=\"http://www.facebook.com/sharer.php?u={$url}&media={$imgPath}&description={$desc}\" class=\"joinFB\">Share Your Advertise</a>\r\n            //window.open(\"https://www.facebook.com/sharer.php?u=\"+currentURL,\"\",\"height=368,width=600,left=100,top=100,menubar=0\");\r\n            shareURL = 'https://www.facebook.com/sharer.php?u=' + currentURL;\r\n            break;\r\n          case 'VK':\r\n            shareURL = 'http://vk.com/share.php?url=' + currentURL;\r\n            break;\r\n          case 'GOOGLEPLUS':\r\n            shareURL = \"https://plus.google.com/share?url=\" + currentURL;\r\n            break;\r\n          case 'TWITTER':\r\n            // shareURL=\"https://twitter.com/share?url=\"+currentURL+\"&text=\"+currentTitle;\r\n            shareURL = 'https://twitter.com/intent/tweet?text=' + currentTitle + 'url=' + currentURL;\r\n            break;\r\n          case 'PINTEREST':\r\n            // shareURL='https://pinterest.com/pin/create/bookmarklet/?media='+currentTn+'&url='+currentURL+'&description='+currentTitle;\r\n            shareURL = 'https://pinterest.com/pin/create/button/?media=' + currentTn + '&url=' + currentURL + '&description=' + currentTitle;\r\n            break;\r\n          case 'TUMBLR':\r\n            //shareURL='https://www.tumblr.com/widgets/share/tool/preview?caption=<strong>'+currentTitle+'</strong>&tags=nanogallery2&url='+currentURL+'&shareSource=legacy&posttype=photo&content='+currentTn+'&clickthroughUrl='+currentURL;\r\n            shareURL = 'http://www.tumblr.com/share/link?url=' + currentURL + '&name=' + currentTitle;\r\n            break;\r\n          case 'MAIL':\r\n            shareURL = 'mailto:?subject=' + currentTitle + '&body=' + currentURL;\r\n            break;\r\n          default:\r\n            found = false;\r\n            break;\r\n        }\r\n        \r\n        if( found ) {\r\n          window.open(shareURL, \"\" , \"height=550,width=500,left=100,top=100,menubar=0\" );\r\n          G.popup.close();\r\n          // $popup.remove();\r\n        }\r\n        \r\n      });\r\n    }\r\n    \r\n    // build a modal popup\r\n    function Popup(title, content, align) {\r\n      var pp =  '<div class=\"nGY2Popup\" style=\"opacity:0;\"><div class=\"nGY2PopupContent' + align + '\">';\r\n      pp    +=  '<div class=\"nGY2PopupCloseButton\">' + G.O.icons.buttonClose + '</div>';\r\n      pp    +=  '<div class=\"nGY2PopupTitle\">' + title + '</div>';\r\n      pp    +=  content;\r\n      pp    +=  '</div></div>';\r\n      \r\n      G.popup.$elt = jQuery(pp).appendTo('body');\r\n      setElementOnTop( G.VOM.$viewer, G.popup.$elt);\r\n      \r\n      G.popup.isDisplayed = true;\r\n      \r\n      var tweenable = new NGTweenable();\r\n      tweenable.tween({\r\n        from:       { opacity: 0 },\r\n        to:         { opacity: 1 },\r\n        easing:     'easeInOutSine',\r\n        duration:   250,\r\n        step:       function (state, att) {\r\n          G.popup.$elt.css( state );\r\n        }\r\n      });\r\n      \r\n      G.popup.$elt.find('.nGY2PopupCloseButton').on('click', function(e) {\r\n        e.stopPropagation();\r\n        G.popup.close();\r\n      });\r\n      \r\n    }\r\n\r\n\r\n    function GalleryMouseEnter(e) {\r\n      if( !G.VOM.viewerDisplayed && G.GOM.albumIdx != -1 ) {\r\n        var r = GalleryEventRetrieveElementl(e, true);\r\n        // if( r.action == 'OPEN' && r.GOMidx != -1 ) {\r\n        if( r.GOMidx != -1 ) {\r\n          var target = e.target || e.srcElement;\r\n          // if( target.getAttribute('class') != 'nGY2GThumbnail' ) { return; }\r\n          ThumbnailHover(r.GOMidx);\r\n        }\r\n      }\r\n    }\r\n    \r\n    function GalleryMouseLeave(e) {\r\n      if( !G.VOM.viewerDisplayed && G.GOM.albumIdx != -1 ) {\r\n        var r = GalleryEventRetrieveElementl(e, true);\r\n        if( r.GOMidx != -1 ) {\r\n          var target = e.target || e.srcElement;\r\n          // if( target.getAttribute('class') != 'nGY2GThumbnail' ) { return; }\r\n          ThumbnailHoverOut(r.GOMidx);\r\n        }\r\n      }\r\n    }\r\n    \r\n    function GalleryEventRetrieveElementl( e, ignoreSubItems ) {\r\n      var r = { action: 'NONE', GOMidx: -1 };\r\n      \r\n      if( e == undefined ) {\r\n        return r;\r\n      }\r\n      var target = e.target || e.srcElement;\r\n      while( target != G.$E.conTnParent[0] ) {       // loop element parent up to find the thumbnail element\r\n        if( jQuery(target).hasClass('nGY2GThumbnail') ) {\r\n          if( r.action == 'NONE' ) {\r\n            r.action = 'OPEN';\r\n          }\r\n          r.GOMidx = jQuery(target).data('index');\r\n          return r;\r\n        }\r\n        // if( !ignoreSubItems && jQuery(target).hasClass('nGY2GThumbnailIcon') ) {\r\n        if( !ignoreSubItems ) {\r\n          var a = jQuery(target).data('ngy2action');\r\n          if( a != '' && a != undefined ) {\r\n            r.action = a;\r\n          }\r\n        }\r\n        if( target.parentNode == null ) {\r\n          return r;\r\n        }\r\n        target = target.parentNode;\r\n      }\r\n      return r;\r\n    }\r\n    \r\n\r\n    // Open one thumbnail\r\n    function ThumbnailOpen( idx, ignoreSelected ) {\r\n      var item = G.I[idx];\r\n\r\n      var fu = G.O.fnThumbnailClicked;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(item.$elt, item) : window[fu](item.$elt, item);\r\n      }\r\n      \r\n      // open URL\r\n      if( item.destinationURL !== undefined && item.destinationURL.length > 0 ) {\r\n        window.location = item.destinationURL;\r\n        return;\r\n      }\r\n\r\n      switch( item.kind ) {\r\n        case 'image':\r\n          if( ignoreSelected === false && G.GOM.nbSelected > 0 ) {\r\n            ThumbnailSelectionToggle(idx);\r\n          }\r\n          else {\r\n            // display image\r\n            DisplayPhotoIdx(idx);\r\n          }\r\n          break;\r\n        case 'album':\r\n          if( ignoreSelected === false && G.GOM.nbSelected > 0 ) {\r\n            ThumbnailSelectionToggle(idx);\r\n          }\r\n          else {\r\n            if( G.O.thumbnailAlbumDisplayImage && idx != 0 ) {\r\n              // display album content in lightbox\r\n              DisplayFirstMediaInAlbum(idx);\r\n              return;\r\n            }\r\n            else {\r\n              // display album content in gallery\r\n              DisplayAlbum('-1', item.GetID());\r\n            }\r\n          }\r\n          break;\r\n        case 'albumUp':\r\n          var parent = NGY2Item.Get(G, item.albumID);\r\n          DisplayAlbum('-1', parent.albumID);\r\n          break;\r\n      }\r\n    }\r\n    \r\n    function DisplayFirstMediaInAlbum( albumIdx ) {\r\n      if( G.O.debugMode ) { console.log('#DisplayFirstPhotoInAlbum : '+  albumIdx); }\r\n\r\n      var item = G.I[albumIdx];\r\n      \r\n      var l = G.I.length;\r\n      for( var i = 0; i < l; i++ ) {\r\n        if( G.I[i].albumID == item.GetID() ) {\r\n          DisplayPhotoIdx( i );\r\n          return;\r\n        }\r\n      }\r\n      \r\n      // load album content\r\n      AlbumGetContent( item.GetID(), DisplayFirstMediaInAlbum, albumIdx, null );\r\n      \r\n    }\r\n    \r\n\r\n    // Open link to original image (new window)\r\n    function OpenOriginal( item ) {\r\n      switch( G.O.kind ) {\r\n        case 'flickr':\r\n          var sU = 'https://www.flickr.com/photos/' + G.O.userID + '/' + item.GetID();\r\n          if( item.albumID != '0' ) {\r\n            sU += '/in/album-' + item.albumID + '/';\r\n          }\r\n          window.open(sU, '_blank');\r\n          break;\r\n        case 'picasa':\r\n        case 'google':\r\n        case 'google2':\r\n          // no more working since Google changed the access to Google Photos in 2017\r\n          // var sU='https://plus.google.com/photos/'+G.O.userID+'/albums/'+item.albumID+'/'+item.GetID();\r\n          // window.open(sU,'_blank');\r\n          // break;\r\n        default:\r\n          var sU = item.responsiveURL();\r\n          window.open(sU, '_blank');\r\n          break;\r\n      }\r\n    }\r\n    \r\n    // Display one photo (with internal or external viewer)\r\n    function DisplayPhotoIdx( ngy2ItemIdx ) {\r\n\r\n      if( !G.O.thumbnailOpenImage ) { return; }\r\n\r\n      if( G.O.thumbnailOpenOriginal ) {\r\n        // Open link to original image\r\n        OpenOriginal( G.I[ngy2ItemIdx] );\r\n        return;\r\n      }\r\n        \r\n      var items = [];\r\n      G.VOM.currItemIdx = 0;\r\n      G.VOM.items = [];\r\n      G.VOM.albumID = G.I[ngy2ItemIdx].albumID;\r\n      \r\n      var vimg = new VImg(ngy2ItemIdx);\r\n      G.VOM.items.push(vimg);\r\n      items.push(G.I[ngy2ItemIdx]);\r\n      //TODO -> danger? -> pourquoi reconstruire la liste si d�j� ouvert (back/forward)     \r\n      var l = G.I.length;\r\n      for( var idx = ngy2ItemIdx+1; idx < l ; idx++) {\r\n        var item = G.I[idx];\r\n        if( item.kind == 'image' && item.isToDisplay(G.VOM.albumID) && item.destinationURL == '' ) {\r\n          var vimg = new VImg(idx);\r\n          G.VOM.items.push(vimg);\r\n          items.push(item);\r\n        }\r\n      }\r\n      var last = G.VOM.items.length;\r\n      var cnt = 1;\r\n      for( var idx = 0; idx < ngy2ItemIdx ; idx++) {\r\n        var item = G.I[idx];\r\n        if( item.kind == 'image' && item.isToDisplay(G.VOM.albumID) && item.destinationURL == '' ) {\r\n          var vimg = new VImg(idx);\r\n          vimg.mediaNumber = cnt;\r\n          G.VOM.items.push(vimg);\r\n          items.push(item);\r\n          cnt++;\r\n        }\r\n      }\r\n      for( var i = 0; i < last; i++ ) {\r\n        G.VOM.items[i].mediaNumber = cnt;\r\n        cnt++;\r\n      }\r\n    \r\n      // opens media with external viewer\n      var fu = G.O.fnThumbnailOpen;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(items) : window[fu](items);\r\n        return;\r\n      }\r\n    \r\n      // use internal viewer\r\n      if( !G.VOM.viewerDisplayed ) {\r\n        // build viewer and display\r\n        OpenInternalViewer();\r\n      }\r\n      else {\r\n        // viewer already displayed -> display new media in current viewer\r\n        G.VOM.$mediaCurrent.empty();\r\n        var item = G.VOM.NGY2Item(0);\r\n        var spreloader = '<div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>';\r\n        if( item.mediaKind == 'img' && item.imageWidth != 0 && item.imageHeight != 0 ) {\r\n          spreloader = '<div class=\"nGY2ViewerMediaLoaderHidden\"></div>';\r\n        }\r\n        G.VOM.$mediaCurrent.append( spreloader + item.mediaMarkup);\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(1), G.VOM.$mediaNext, 0);\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(-1), G.VOM.$mediaPrevious, 0);\r\n        if( item.mediaKind == 'img' ) {\r\n          G.VOM.ImageLoader.loadImage(VieweImgSizeRetrieved, item);\r\n        }\r\n        // G.VOM.$mediaCurrent.css({ opacity:0 }).attr('src','');\r\n        // G.VOM.ImageLoader.loadImage(VieweImgSizeRetrieved, G.VOM.NGY2Item(0));\r\n        // G.VOM.$mediaCurrent.children().eq(0).attr('src',G.emptyGif).attr('src', G.VOM.NGY2Item(0).responsiveURL());\r\n        DisplayInternalViewer(0, '');\r\n      }\r\n    }\r\n    \r\n    function ViewerZoomStart() {\r\n      if( G.O.viewerZoom && !G.VOM.viewerMediaIsChanged ) {\r\n        var item=G.VOM.NGY2Item(0);\r\n        if( item.imageHeight > 0 && item.imageWidth > 0 ) {\r\n          if( G.VOM.zoom.isZooming === false ) {\r\n            // default zoom\r\n            G.VOM.zoom.userFactor = 1;\r\n            G.VOM.zoom.isZooming = true;\r\n          }\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n          \r\n    function ViewerZoomIn( zoomIn ) {\r\n    if( zoomIn ) {\r\n        // zoom in\r\n        G.VOM.zoom.userFactor+=0.1;\r\n        ViewerZoomMax();\r\n      }\r\n      else {\r\n        // zoom out\r\n        G.VOM.zoom.userFactor-=0.1;\r\n        ViewerZoomMin();\r\n      }\r\n      ViewerMediaSetPosAndZoom();\r\n    }\r\n    \r\n    function ViewerZoomMax() {\r\n      if( G.VOM.zoom.userFactor > 3 ) {\r\n        G.VOM.zoom.userFactor = 3;\r\n      }\r\n    }\r\n    function ViewerZoomMin() {\n    \r\n      if( G.VOM.zoom.userFactor < 0.2 ) {\r\n        G.VOM.zoom.userFactor = 0.2;\r\n      }\r\n    }\r\n    \r\n    \r\n    \r\n    // Set position and size of all 3 media containers\r\n    function ViewerMediaSetPosAndZoom() {\r\n    \r\n      if( !G.VOM.zoom.isZooming ) {\r\n        G.VOM.zoom.userFactor = 1;\r\n      }\r\n      // window.ng_draf( function() {\r\n        ViewerMediaSetPosAndZoomOne( G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, true );\r\n        ViewerMediaSetPosAndZoomOne( G.VOM.NGY2Item(-1), G.VOM.$mediaPrevious, false );\r\n        ViewerMediaSetPosAndZoomOne( G.VOM.NGY2Item(1), G.VOM.$mediaNext, false );\r\n      // });\r\n    }\r\n    \r\n\r\n    \r\n    // Media which is not IMG -> center and set size\r\n    function ViewerMediaCenterNotImg( $mediaContainer ) {\r\n      var $media = $mediaContainer.children().eq(1);\r\n      $media.css( {'height': '80%' });\r\n      $media.css( {'width':  '90%' });\r\n      $media[0].style[G.CSStransformName] = 'translate(0px, \"50%\") ';\r\n    }\r\n    \r\n    // Set position and size of ONE media container\r\n    function ViewerMediaSetPosAndZoomOne(item, $img, isCurrent ) {\r\n\r\n      if( item.mediaKind != 'img' ) {\r\n        ViewerMediaCenterNotImg($img);\r\n        return;\r\n      }\r\n      \r\n      if( item.imageHeight == 0 || item.imageWidth == 0 ) { \r\n        ViewerSetMediaVisibility( item, $img, 0 );\r\n        return;\r\n      }\r\n\r\n      // part 1: set the image size\r\n      var zoomUserFactor = isCurrent == true ? G.VOM.zoom.userFactor : 1;\r\n      \r\n      var dpr = 1;\r\n      if( G.O.viewerImageDisplay == 'bestImageQuality' ) {\r\n        dpr = window.devicePixelRatio;\r\n      }\r\n      \r\n      // retrieve the base zoom factor (image fill screen)\r\n      var zoomBaseFactorW = (G.VOM.window.lastWidth  - G.VOM.padding.V) / (item.imageWidth  / dpr);\r\n      var zoomBaseFactorH = (G.VOM.window.lastHeight - G.VOM.padding.H) / (item.imageHeight / dpr);\r\n      var zoomBaseFactor = Math.min(zoomBaseFactorW, zoomBaseFactorH);\r\n      if( zoomBaseFactor > 1 && G.O.viewerImageDisplay != 'upscale' ) {\r\n        // no upscale\r\n        zoomBaseFactor = 1;\r\n      }\r\n\r\n      var imageCurrentHeight = (item.imageHeight / dpr) * zoomUserFactor * zoomBaseFactor;\r\n      var imageCurrentWidth  = (item.imageWidth / dpr)  * zoomUserFactor * zoomBaseFactor;\r\n      $img.children().eq(1).css( {'height': imageCurrentHeight });\r\n      $img.children().eq(1).css( {'width':  imageCurrentWidth  });\r\n\r\n      // retrieve posX/Y to center image\r\n      var posX = 0;\r\n      if( imageCurrentWidth > G.VOM.window.lastWidth ) {\r\n        posX = -(imageCurrentWidth - G.VOM.window.lastWidth)/2;\r\n      }\r\n      var posY = 0;\r\n      if( imageCurrentHeight > G.VOM.window.lastHeight ) {\r\n        posY = ( imageCurrentHeight - G.VOM.window.lastHeight ) / 2;\r\n      }\r\n      posY = 0;   // actually, it seems that the image is always centered vertically -> so no need to to anything\r\n      \r\n      // Part 2: set the X/Y position (for zoom/pan)\r\n      if( isCurrent ) {\r\n        if( !G.VOM.zoom.isZooming ) {\r\n          G.VOM.panPosX = 0;\r\n          G.VOM.panPosY = 0;\r\n        }\r\n        G.VOM.zoom.posX = posX;\r\n        G.VOM.zoom.posY = posY;\r\n        ViewerImagePanSetPosition(G.VOM.panPosX, G.VOM.panPosY, $img, false);\r\n      }\r\n      // else {\r\n        //$img[0].style[G.CSStransformName]= 'translate3D('+ posX+'px, '+ posY+'px, 0) ';\r\n      // }\r\n      else {\r\n        // set the pan position of each media container\r\n        ViewerMediaPanX( G.VOM.swipePosX );\r\n        $img.children().eq(1)[0].style[G.CSStransformName]= 'translate(0px, 0px) rotate('+ item.rotationAngle +'deg)';\n      }\r\n      \r\n    }\r\n\r\n    // position the image depending on the zoom factor and the pan X/Y position\r\n    // IMG is the only media supporting zoom/pan\r\n    function ViewerImagePanSetPosition(posX, posY, imageContainer, savePosition ) {\r\n      if( savePosition ) {\r\n        G.VOM.panPosX = posX;\r\n        G.VOM.panPosY = posY;\r\n      }\r\n\r\n      posX += G.VOM.zoom.posX;\r\n      posY += G.VOM.zoom.posY;\n      \n      // imageContainer.children().eq(1)[0].style[G.CSStransformName]= 'translate('+ posX + 'px, '+ posY + 'px)';\n      imageContainer.children().eq(1)[0].style[G.CSStransformName]= 'translate('+ posX + 'px, '+ posY + 'px) rotate('+ G.VOM.NGY2Item(0).rotationAngle +'deg)';\r\n\r\n\r\n    }\r\n    \r\n\r\n    // display media with internal viewer\r\n    function OpenInternalViewer(  ) {\r\n\r\n      G.VOM.viewerDisplayed = true;\r\n      G.GOM.firstDisplay = false;\r\n      \r\n      G.VOM.saveOverflowX = window.getComputedStyle(document.body)['overflow-x'];\r\n      G.VOM.saveOverflowY = window.getComputedStyle(document.body)['overflow-y'];\r\n      jQuery('body').css({ overflow: 'hidden' });  //avoid scrollbars\r\n\r\n      G.VOM.$cont = jQuery('<div  class=\"nGY2 nGY2ViewerContainer\" style=\"opacity:1\"></div>').appendTo('body');\r\n      \r\n      SetViewerTheme();\r\n\r\n      G.VOM.$viewer = jQuery('<div class=\"nGY2Viewer\" style=\"opacity:0\" itemscope itemtype=\"http://schema.org/ImageObject\"></div>').appendTo( G.VOM.$cont );\r\n      G.VOM.$viewer.css({ msTouchAction: 'none', touchAction: 'none' });            // avoid pinch zoom\r\n\r\n      G.VOM.currItemIdx = 0;\r\n      var sMedia = '<div class=\"nGY2ViewerMediaPan\"><div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>' + G.VOM.NGY2Item(-1).mediaMarkup + '</div>';    // previous media\r\n      sMedia    += '<div class=\"nGY2ViewerMediaPan\"><div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>' + G.VOM.NGY2Item(0).mediaMarkup  + '</div>';    // current media\r\n      sMedia    += '<div class=\"nGY2ViewerMediaPan\"><div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>' + G.VOM.NGY2Item(1).mediaMarkup  + '</div>';    // next media\r\n\r\n      var sNav = '';\r\n      var iconP = G.O.icons.viewerImgPrevious;\r\n      if( iconP != undefined && iconP != '') {\r\n        sNav += '<div class=\"nGY2ViewerAreaPrevious ngy2viewerToolAction\" data-ngy2action=\"previous\">' + iconP + '</div>';\r\n      }\r\n      var iconN = G.O.icons.viewerImgNext;\r\n      if( iconN != undefined && iconN != '') {\r\n        sNav += '<div class=\"nGY2ViewerAreaNext ngy2viewerToolAction\" data-ngy2action=\"next\">' + iconN + '</div>';\r\n      }\r\n\r\n      G.VOM.$content = jQuery('<div class=\"nGY2ViewerContent\">' + sMedia + sNav + '</div>').appendTo( G.VOM.$viewer );\r\n\r\n      var $mediaPan = G.VOM.$content.find('.nGY2ViewerMediaPan');\r\n      G.VOM.$mediaPrevious = $mediaPan.eq(0);    // pointer to previous media container\r\n      G.VOM.$mediaCurrent = $mediaPan.eq(1);     // pointer to current media container\r\n      G.VOM.$mediaNext = $mediaPan.eq(2);        // pointer to next media container\r\n\r\n      G.VOM.ImageLoader.loadImage( VieweImgSizeRetrieved, G.VOM.NGY2Item(0)  );\r\n      G.VOM.ImageLoader.loadImage( VieweImgSizeRetrieved, G.VOM.NGY2Item(-1) );\r\n      G.VOM.ImageLoader.loadImage( VieweImgSizeRetrieved, G.VOM.NGY2Item(1)  );\r\n      \r\n      G.VOM.padding.H = parseInt(G.VOM.$content.css(\"padding-left\")) + parseInt(G.VOM.$content.css(\"padding-right\"));\r\n      G.VOM.padding.V = parseInt(G.VOM.$content.css(\"padding-top\")) + parseInt(G.VOM.$content.css(\"padding-bottom\"));\r\n      \r\n      // build media toolbar container\r\n      var vtbBg1 = '';\r\n      var vtbBg2 = ' toolbarBackground';\r\n      if( G.O.viewerToolbar.fullWidth ) {\r\n        vtbBg1 = ' toolbarBackground';\r\n        vtbBg2 = '';\r\n      }\r\n      var vtbAlign = 'text-align:center;';\r\n      switch ( G.O.viewerToolbar.align ) {\r\n        case 'left':\r\n          vtbAlign = 'text-align:left;';\r\n          break;\r\n        case 'right':\r\n          vtbAlign = 'text-align:right;';\r\n          break;\r\n      }\r\n      var sTB = '<div class=\"toolbarContainer nGEvent' + vtbBg1 + '\" style=\"visibility:' +(G.O.viewerToolbar.display ? \"visible\" : \"hidden\")+';'+vtbAlign+'\"><div class=\"toolbar nGEvent' + vtbBg2 + '\"></div></div>';\r\n      G.VOM.$toolbar = jQuery(sTB).appendTo(G.VOM.$viewer);\r\n\r\n      if( G.VOM.toolbarMode == 'min' || (G.O.viewerToolbar.autoMinimize > 0 && G.O.viewerToolbar.autoMinimize >= G.GOM.cache.viewport.w) ) {\r\n        ViewerToolbarForVisibilityMin();\r\n      }\r\n      else {\r\n        ViewerToolbarForVisibilityStd();\r\n      }\r\n      \r\n      // top-left toolbar\r\n      if( G.O.viewerTools.topLeft != '' ) {\r\n        var sTopLeft = '<div class=\"nGY2ViewerToolsTopLeft nGEvent\"><div class=\"toolbar nGEvent\">';\r\n        var sTL = G.O.viewerTools.topLeft.split(',');\r\n        for( var i = 0, sTLL = sTL.length; i < sTLL; i++) {\r\n          sTopLeft += ToolbarAddElt( sTL[i] );\r\n        }\r\n        sTopLeft += '</div></div>';\r\n        G.VOM.$toolbarTL = jQuery(sTopLeft).appendTo(G.VOM.$viewer);\r\n      }\r\n      // top-right toolbar\r\n      if( G.O.viewerTools.topRight != '' ) {\r\n        var sTopRight = '<div class=\"nGY2ViewerToolsTopRight nGEvent\"><div class=\"toolbar nGEvent\">';\r\n        var sTR = G.O.viewerTools.topRight.split(',');\r\n        for( var i = 0, sTRL = sTR.length; i < sTRL; i++) {\r\n          sTopRight += ToolbarAddElt( sTR[i] );\r\n        }\r\n        sTopRight += '</div></div>';\r\n        G.VOM.$toolbarTR = jQuery(sTopRight).appendTo(G.VOM.$viewer);\r\n      }\r\n\r\n      // set the events handler for toolbars\r\n      ViewerToolsOn();\r\n\r\n      // display logo\r\n      if( G.O.viewerDisplayLogo ) { G.$E.vwLogo=jQuery('<div class=\"nGY2 nGY2ViewerLogo\"></div>').appendTo(G.VOM.$viewer); }\r\n\r\n      // Go to fullscreen mode\r\n      if( ngscreenfull.enabled && G.O.viewerFullscreen ) { ngscreenfull.request(); }\r\n\r\n      setElementOnTop('', G.VOM.$viewer);\r\n      ResizeInternalViewer(true);\r\n      G.VOM.timeImgChanged = new Date().getTime();\r\n      \r\n      // viewer display transition\r\n      var tweenable = new NGTweenable();\r\n      tweenable.tween({\r\n        from:         { opacity: 0, posY: G.VOM.window.lastHeight*.5 },\r\n        to:           { opacity: 1, posY: 0 },\r\n        delay:        30,\r\n        duration:     500,\r\n        easing:       'easeOutQuart',\r\n        step:         function (state) {\r\n          G.VOM.$viewer.css('opacity', state.opacity);\r\n          G.VOM.$viewer[0].style[G.CSStransformName] = 'translateY(' + (state.posY) + 'px) ';\r\n        }\r\n      });\r\n\r\n      // stop click propagation on media ==> if the user clicks outside of an media, the viewer is closed\r\n      // --> no more supported since v2.0.0\r\n      // G.VOM.$viewer.find('img').on('click', function (e) { e.stopPropagation(); });\r\n      \r\n      \r\n      ViewerMediaPanX(0);\r\n      ViewerSetEvents();\r\n\r\n      DisplayInternalViewer(0, '');\r\n      \r\n      if( G.O.slideshowAutoStart ) {\r\n        G.VOM.playSlideshow = false;\r\n        SlideshowToggle();\r\n      }\r\n    }\r\n    \r\n    function ViewerEvents() {\r\n      if( !G.VOM.viewerDisplayed || G.VOM.viewerMediaIsChanged || G.VOM.NGY2Item(0).mediaKind != 'img') {\r\n        // ignore fired event if viewer not displayed or if currently changed or if current media not an image\r\n        return false;\r\n      }\r\n      return true;\r\n    }\r\n    \r\n    \r\n    // viewer gesture handling\r\n    function ViewerSetEvents() {\r\n\r\n      if( G.VOM.hammertime == null ) {\r\n      \r\n        G.VOM.hammertime =  new NGHammer.Manager(G.VOM.$cont[0], {\r\n          recognizers: [\r\n            [NGHammer.Pinch, { enable: true }],\r\n            [NGHammer.Pan, { direction: NGHammer.DIRECTION_ALL }]\r\n          ]\r\n        });\r\n     \r\n        // PAN\r\n        G.VOM.hammertime.on('pan', function(ev) {\r\n          if( !ViewerEvents() ) { return; }\r\n\r\n          if( G.VOM.zoom.isZooming ) {\r\n            // pan zoomed image\r\n            ViewerImagePanSetPosition(G.VOM.panPosX + ev.deltaX, G.VOM.panPosY + ev.deltaY, G.VOM.$mediaCurrent, false);\r\n            if( G.VOM.toolbarsDisplayed == true ) {\r\n              G.VOM.toolsHide();\r\n            }\r\n          }\r\n          else {\r\n            if( ev.deltaY > G.VOM.panThreshold && Math.abs(ev.deltaX) < G.VOM.panThreshold && !G.VOM.panXOnly ) {\r\n              // pan viewer down\r\n              ViewerMediaPanX( 0 );\r\n              var dist = Math.min(ev.deltaY, 200);\r\n              G.VOM.$viewer[0].style[G.CSStransformName] = 'translateY(' + dist + 'px) ';\r\n              G.VOM.$viewer.css('opacity', 1-dist/200/2);\r\n            }\r\n            else {\r\n              // pan media left/right\n              if( Math.abs(ev.deltaX) > G.VOM.panThreshold ) {\n                G.VOM.panXOnly = true;\n              }\r\n              ViewerMediaPanX( ev.deltaX );\r\n              G.VOM.$viewer[0].style[G.CSStransformName] = 'translateY(0px)';\r\n              G.VOM.$viewer.css('opacity', 1);\r\n            }\r\n          }\r\n        });\r\n\r\n        // PAN END\r\n        G.VOM.hammertime.on('panend', function(ev) {\r\n          if( !ViewerEvents() ) { return; }\n          if( G.VOM.zoom.isZooming ) {\r\n            G.VOM.timeImgChanged = new Date().getTime();\r\n            ViewerImagePanSetPosition(G.VOM.panPosX+ev.deltaX, G.VOM.panPosY+ev.deltaY, G.VOM.$mediaCurrent, true);\r\n          }\r\n          else {\n            var panY = false;\n            if( !G.VOM.panXOnly ) {\r\n              if( ev.deltaY > 50 && Math.abs(ev.deltaX) < 50 ) {\r\n                // close viewer\r\n                CloseInternalViewer(G.VOM.currItemIdx);\n                panY = true;\r\n              }\n            }\r\n            if( !panY ) {\r\n              if( Math.abs( ev.deltaX ) < 50 ) {\r\n                ViewerMediaPanX(0);\r\n              }\r\n              else {\r\n                ev.deltaX > 50 ? DisplayPreviousMedia() : DisplayNextMedia();\r\n              }\r\n            }\r\n          }\r\n          G.VOM.panXOnly = false;\n        });\r\n        \r\n        if( G.O.viewerZoom ) {\r\n        \r\n          G.VOM.hammertime.add( new NGHammer.Tap({ event: 'doubletap', taps: 2 }) );\r\n          G.VOM.hammertime.add( new NGHammer.Tap({ event: 'singletap' }) );\r\n          G.VOM.hammertime.get('doubletap').recognizeWith('singletap');\r\n          G.VOM.hammertime.get('singletap').requireFailure('doubletap');\r\n\r\n          // single tap -> next/previous media\r\n          G.VOM.hammertime.on('singletap', function(ev) {\r\n            if( !ViewerEvents() ) { return; }\r\n            StopPropagationPreventDefault(ev.srcEvent);\r\n            if( G.VOM.toolbarsDisplayed == false ) {\r\n              debounce( ViewerToolsUnHide, 100, false)();\r\n            }\r\n            else {\r\n              if( ev.target.className.indexOf('nGY2ViewerMedia') !== -1 ) {\r\n                if( ev.srcEvent.pageX < (G.GOM.cache.viewport.w/2) ) {\r\n                  DisplayPreviousMedia();\r\n                }\r\n                else {\r\n                  DisplayNextMedia();\r\n                }\r\n              }\r\n            }\r\n          });\r\n          \r\n          // double tap -> zoom\r\n          G.VOM.hammertime.on('doubletap', function(ev) {\r\n            if( !ViewerEvents() ) { return; }\r\n            StopPropagationPreventDefault(ev.srcEvent);\r\n            \r\n            if( ev.target.className.indexOf('nGY2ViewerMedia') !== -1 ) {\r\n              // double tap only on image\r\n              if( G.VOM.zoom.isZooming ) {\r\n                G.VOM.zoom.isZooming = false;\r\n                // G.VOM.zoom.userFactor = 1;\r\n                ResizeInternalViewer(true);\r\n              }\r\n              else {\r\n                if( ViewerZoomStart() ) {\r\n                  G.VOM.zoom.userFactor = 1.5;\r\n                  ViewerMediaSetPosAndZoom();\r\n                }\r\n              }\r\n            }\r\n          });\r\n        \r\n          // pinch end\r\n          G.VOM.hammertime.on('pinchend', function(ev) {\r\n            ev.srcEvent.stopPropagation();\r\n            ev.srcEvent.preventDefault();  // cancel  mouseenter event\r\n            G.VOM.timeImgChanged = new Date().getTime();\r\n          });\r\n          G.VOM.hammertime.on('pinch', function(ev) {\r\n            ev.srcEvent.stopPropagation();\r\n            ev.srcEvent.preventDefault();  // cancel  mouseenter event\r\n            \r\n            if( ViewerZoomStart() ) {\r\n              G.VOM.zoom.userFactor = ev.scale;\r\n              ViewerZoomMax();\r\n              ViewerZoomMin();\r\n              ViewerMediaSetPosAndZoom();   // center media\r\n            }\r\n          });\r\n        }\r\n        else {\r\n          // no zoom -> click/tap on image to go to next/previous one\r\n          G.VOM.hammertime.on('tap', function(ev) {\r\n            if( !ViewerEvents() ) { return; }\r\n            StopPropagationPreventDefault(ev.srcEvent);\r\n            if( G.VOM.toolbarsDisplayed == false  ){\r\n              // display tools on tap if hidden\r\n              debounce( ViewerToolsUnHide, 100, false)();\r\n            }\r\n            else {\r\n              // display next/previous image if tools not hidden\r\n              if( ev.target.className.indexOf('nGY2ViewerMedia') !== -1 ) {\r\n                if( ev.srcEvent.pageX < (G.GOM.cache.viewport.w/2) ) {\r\n                  DisplayPreviousMedia();\r\n                }\r\n                else {\r\n                  DisplayNextMedia();\r\n                }\r\n              }\r\n            }\r\n            \r\n          });\r\n        }\r\n      }\r\n    }\r\n    \r\n    function StopPropagationPreventDefault(e) {\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }\r\n\r\n    // Hide toolbars on user inactivity\r\n    function ViewerToolsHide() {\r\n      if( G.VOM.viewerDisplayed ) {\r\n        G.VOM.toolbarsDisplayed = false;\r\n        ViewerToolsOpacity(0);\r\n      }\r\n    }\r\n    \r\n    function ViewerToolsUnHide() {\r\n    if( G.VOM.viewerDisplayed ) {\r\n        G.VOM.toolbarsDisplayed = true;\r\n        ViewerToolsOpacity(1);\r\n        G.VOM.toolsHide();\r\n      }\r\n    }\r\n    \r\n    function ViewerToolsOpacity( op ) {\r\n      if( G.VOM.$toolbar != null ) {\n        G.VOM.$toolbar.css('opacity', op);\n      }\n      if( G.VOM.$toolbarTL != null ) {\r\n        G.VOM.$toolbarTL.css('opacity', op);\r\n      }\r\n      if( G.VOM.$toolbarTR != null ) { \r\n        G.VOM.$toolbarTR.css('opacity', op);\r\n      }\r\n      G.VOM.$content.find('.nGY2ViewerAreaNext').css('opacity', op);\r\n      G.VOM.$content.find('.nGY2ViewerAreaPrevious').css('opacity', op);\r\n    }\r\n    \r\n    \r\n    \r\n    function ViewerToolsOn() {\r\n      // removes all events\r\n      G.VOM.$viewer.off('touchstart click', '.ngy2viewerToolAction', ViewerToolsAction); \r\n      \r\n      // action button\r\n      G.VOM.$viewer.on('touchstart click', '.ngy2viewerToolAction', ViewerToolsAction); \r\n    }\r\n\r\n    \r\n    // Actions of the buttton/elements\r\n    function ViewerToolsAction(e) {\r\n      // delay to avoid twice handling on smartphone/tablet (both touchstart click events are fired)\r\n      if( (new Date().getTime()) - G.timeLastTouchStart < 300 ) { return; }\r\n      G.timeLastTouchStart = new Date().getTime();\r\n      \r\n      var $this = $(this);\r\n      var ngy2action = $this.data('ngy2action');\r\n      if( ngy2action == undefined ) { return; }\r\n      switch( ngy2action ) {\r\n        case 'next':\r\n          StopPropagationPreventDefault(e);\r\n          DisplayNextMedia();\r\n          break;\r\n        case 'previous':\r\n          StopPropagationPreventDefault(e);\r\n          DisplayPreviousMedia();\r\n          break;\r\n        case 'playPause':\r\n          e.stopPropagation();\r\n          SlideshowToggle();\r\n          break;\r\n        case 'zoomIn':\r\n          StopPropagationPreventDefault(e);\r\n          if( ViewerZoomStart() ) { ViewerZoomIn( true ); }\r\n          break;\r\n        case 'zoomOut':\r\n          StopPropagationPreventDefault(e);\r\n          if( ViewerZoomStart() ) { ViewerZoomIn( false ); }\r\n          break;\r\n        case 'minimize':\r\n          // toggle toolbar visibility\r\n          StopPropagationPreventDefault(e);\r\n          if( G.VOM.toolbarMode == 'std' ) {\r\n            ViewerToolbarForVisibilityMin();\r\n          }\r\n          else {\r\n            ViewerToolbarForVisibilityStd();\r\n          }\r\n          break;\r\n        case 'fullScreen':\r\n          // Toggle viewer fullscreen mode on/off\r\n          e.stopPropagation();\r\n          if( ngscreenfull.enabled ) {\r\n            ngscreenfull.toggle();\r\n          }\r\n          break;\r\n        case 'info':\r\n          e.stopPropagation();\r\n          ItemDisplayInfo(G.VOM.NGY2Item(0));\r\n          break;\r\n        case 'close':\r\n          StopPropagationPreventDefault(e);\r\n          if( (new Date().getTime()) - G.VOM.timeImgChanged < 400 ) { return; }\r\n          CloseInternalViewer(G.VOM.currItemIdx);\r\n          break;\r\n        case 'download':\r\n          StopPropagationPreventDefault(e);\r\n          DownloadImage(G.VOM.items[G.VOM.currItemIdx].ngy2ItemIdx);\r\n          break;\r\n        case 'share':\r\n          StopPropagationPreventDefault(e);\r\n          PopupShare(G.VOM.items[G.VOM.currItemIdx].ngy2ItemIdx);\r\n          break;\r\n        case 'linkOriginal':\r\n          StopPropagationPreventDefault(e);\r\n          OpenOriginal( G.VOM.NGY2Item(0) );\r\n          break;\n        case 'rotateLeft':\n          StopPropagationPreventDefault(e);\n          ViewerImageRotate(-90);\n          break;\n        case 'rotateRight':\n          StopPropagationPreventDefault(e);\n          ViewerImageRotate(90);\n          break;\r\n      }\r\n      \r\n      // custom button\r\n      var fu = G.O.fnImgToolbarCustClick;\r\n      if( ngy2action.indexOf('custom') == 0  && fu !== null ) {\n        typeof fu == 'function' ? fu(ngy2action, $this, G.VOM.NGY2Item(0)) : window[fu](ngy2action, $this, G.VOM.NGY2Item(0));\r\n      }\n    }\n\n    // rotate displayed image\n    function ViewerImageRotate( angle ) {\n      var item = G.VOM.NGY2Item(0);\n      if( item.mediaKind == 'img' ) {\n        item.rotationAngle += angle;\n        item.rotationAngle = item.rotationAngle % 360;\n        if( item.rotationAngle < 0 ) {\n          item.rotationAngle += 360;\n        }\n        ViewerMediaPanX( 0 );\n        ViewerMediaSetPosAndZoomOne( G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, true );\n      }\n    }\r\n     \r\n\r\n    // Display photo infos\r\n    function ItemDisplayInfo( item ) {\r\n\r\n      var content = '<div class=\"nGY2PopupOneItemText\">' + item.title + '</div>';\r\n      content    += '<div class=\"nGY2PopupOneItemText\">' + item.description + '</div>';\r\n      if( item.author != '' ) {\n        content  += '<div class=\"nGY2PopupOneItemText\">' + G.O.icons.user + ' ' + item.author + '</div>';\r\n      }\n      if( item.exif.model != '' ) {\r\n        content  += '<div class=\"nGY2PopupOneItemText\">' + G.O.icons.config + ' ' + item.exif.model + '</div>';\r\n      }\r\n      var sexif = '';\r\n      sexif += item.exif.flash == '' ? '' : ' &nbsp; ' + item.exif.flash;\r\n      sexif += item.exif.focallength == '' ? '' : ' &nbsp; ' + item.exif.focallength+'mm';\r\n      sexif += item.exif.fstop == '' ? '' : ' &nbsp; f' + item.exif.fstop;\r\n      sexif += item.exif.exposure == '' ? '' : ' &nbsp; ' + item.exif.exposure+'s';\r\n      sexif += item.exif.iso == '' ? '' : ' &nbsp; ' + item.exif.iso+' ISO';\r\n      if( item.exif.time != '' ) {\r\n        // var date = new Date(parseInt(item.exif.time));\r\n        // sexif += ' &nbsp; '+date.toLocaleDateString();\r\n        sexif += ' &nbsp; ' + item.exif.time;\r\n      }\r\n      content += '<div class=\"nGY2PopupOneItemText\">' + sexif + '</div>';\r\n\r\n      if( item.exif.location != '' ) {\r\n        content += '<div class=\"nGY2PopupOneItemText\">'+G.O.icons.location+' <a href=\"http://maps.google.com/maps?z=12&t=m&q='+encodeURIComponent(item.exif.location)+'\" target=\"_blank\">'+item.exif.location+'</a></div>';\r\n        // embed google map in iframe (no api key required)\r\n        content += '<iframe width=\"300\" height=\"150\" frameborder=\"0\" scrolling=\"no\" marginheight=\"0\" marginwidth=\"0\" src=\"https://maps.google.com/maps?&amp;t=m&amp;q='+encodeURIComponent( item.exif.location ) +'&amp;output=embed\"></iframe>';  \r\n      }\r\n\r\n      Popup(G.O.icons.viewerInfo, content, 'Left');\r\n   \r\n    }\r\n    \r\n\r\n    \r\n    function ToolbarAddElt( elt ) {\r\n      var r = '<div class=\"ngbt ngy2viewerToolAction ',\r\n      e=elt.replace(/^\\s+|\\s+$/g, '');    // remove trailing/leading whitespace\r\n      switch( e ) {\r\n        case 'minimizeButton':\r\n          var ic = G.O.icons.viewerToolbarMin;\r\n          if( G.VOM.toolbarMode == 'min' ) {\r\n            ic = G.O.icons.viewerToolbarStd;\r\n          }\r\n          r += 'minimizeButton nGEvent\" data-ngy2action=\"minimize\">'+ic+'</div>';\r\n          break;\r\n        case 'previousButton':\r\n          r += 'previousButton nGEvent\" data-ngy2action=\"previous\">'+G.O.icons.viewerPrevious+'</div>';\r\n          break;\r\n        case 'pageCounter':\r\n          r += 'pageCounter nGEvent\"></div>';\r\n          break;\r\n        case 'nextButton':\r\n          r += 'nextButton nGEvent\" data-ngy2action=\"next\">'+G.O.icons.viewerNext+'</div>';\r\n          break;\r\n        case 'playPauseButton':\r\n          r += 'playButton playPauseButton nGEvent\" data-ngy2action=\"playPause\">'+G.O.icons.viewerPlay+'</div>';\r\n          break;\r\n        case 'rotateLeft':\r\n          r += 'rotateLeftButton nGEvent\" data-ngy2action=\"rotateLeft\">'+G.O.icons.viewerRotateLeft+'</div>';\r\n          break;\r\n        case 'rotateRight':\r\n          r += 'rotateRightButton nGEvent\" data-ngy2action=\"rotateRight\">'+G.O.icons.viewerRotateRight+'</div>';\r\n          break;\r\n        case 'downloadButton':\r\n          r += 'downloadButton nGEvent\" data-ngy2action=\"download\">'+G.O.icons.viewerDownload+'</div>';\r\n          break;\r\n        case 'zoomButton':\r\n          r += 'nGEvent\" data-ngy2action=\"zoomIn\">'+G.O.icons.viewerZoomIn+'</div><div class=\"ngbt ngy2viewerToolAction nGEvent\" data-ngy2action=\"zoomOut\">'+G.O.icons.viewerZoomOut+'</div>';\r\n          break;\r\n        case 'fullscreenButton':\r\n          var s = G.O.icons.viewerFullscreenOn;\r\n          if( ngscreenfull.enabled && G.VOM.viewerIsFullscreen ) {\r\n            s = G.O.icons.viewerFullscreenOff;\r\n          }\r\n          r += 'setFullscreenButton fullscreenButton nGEvent\" data-ngy2action=\"fullScreen\">'+s+'</div>';\r\n          break;\r\n        case 'infoButton':\r\n          r += 'infoButton nGEvent\" data-ngy2action=\"info\">'+G.O.icons.viewerInfo+'</div>';\r\n          break;\r\n        case 'linkOriginalButton':\r\n          r += 'linkOriginalButton nGEvent\" data-ngy2action=\"linkOriginal\">' + G.O.icons.viewerLinkOriginal + '</div>';\r\n          break;\r\n        case 'closeButton':\r\n          r += 'closeButton nGEvent\" data-ngy2action=\"close\">'+G.O.icons.buttonClose+'</div>';\r\n          break;\r\n        case 'shareButton':\r\n          r += 'nGEvent\" data-ngy2action=\"share\">'+G.O.icons.viewerShare+'</div>';\r\n          break;\r\n        case 'label':\r\n          r += '\"><div class=\"title nGEvent\" itemprop=\"name\"></div><div class=\"description nGEvent\" itemprop=\"description\"></div></div>';\r\n          break;\r\n        default:\r\n          // custom button\r\n          if( e.indexOf('custom') == 0 ) {\r\n            var t = '';\r\n            // content to display from custom script\n            var fu = G.O.fnImgToolbarCustInit;\r\n            if( fu !== null ) {\r\n              typeof fu == 'function' ? fu(e) : window[fu](e);\r\n            }\r\n            if( t == undefined || t == '' ) {\r\n              // content from icons\r\n              var n = e.substring(6);\r\n              t = G.O.icons['viewerCustomTool'+n];\r\n            }\r\n            r += 'ngy2CustomBtn ' + e + ' nGEvent\" data-ngy2action=\"' + e + '\">' + t + '</div>';\r\n          }\r\n          else {\r\n            r = '';\r\n          }\r\n          break;\r\n      }\r\n      return r;\r\n    }\r\n    \r\n    \r\n    // toggle slideshow mode on/off\r\n    function SlideshowToggle(){\r\n      if( G.VOM.playSlideshow ) {\r\n        window.clearTimeout(G.VOM.playSlideshowTimerID);\r\n        G.VOM.playSlideshow = false;\r\n        G.VOM.$viewer.find('.playPauseButton').html(G.O.icons.viewerPlay);\r\n      }\r\n      else {\r\n        G.VOM.playSlideshow = true;\r\n        DisplayNextMedia();\r\n        G.VOM.$viewer.find('.playPauseButton').html(G.O.icons.viewerPause);\r\n      }\r\n    }\r\n\r\n    function ViewerToolbarForVisibilityStd() {\r\n      G.VOM.toolbarMode = 'std';\r\n      \r\n      var sTB = '';\r\n      var t = G.O.viewerToolbar.standard.split(',');\r\n      for( var i = 0, lt = t.length; i < lt; i++) {\r\n        sTB += ToolbarAddElt( t[i] );\r\n      }\r\n      G.VOM.$toolbar.find('.toolbar').html(sTB);\r\n      ViewerToolbarElementContent();\r\n    }\r\n    \r\n    function ViewerToolbarForVisibilityMin() {\r\n      if( G.O.viewerToolbar.minimized == undefined || G.O.viewerToolbar.minimized == '' ) {\r\n        ViewerToolbarForVisibilityStd();\r\n      }\r\n      else {\r\n        G.VOM.toolbarMode = 'min';\r\n        var sTB = '';\r\n        var t = G.O.viewerToolbar.minimized.split(',');\r\n        for( var i = 0, lt = t.length; i < lt; i++) {\r\n          sTB += ToolbarAddElt( t[i] );\r\n        }\r\n        G.VOM.$toolbar.find('.toolbar').html(sTB);\r\n        ViewerToolbarElementContent();\r\n      }\r\n    }\r\n    \r\n    function ViewerToolbarElementContent() {\r\n    \r\n      var vomIdx=G.VOM.currItemIdx;\r\n      if( vomIdx == null ) { return; }\r\n      \r\n      var item=G.VOM.NGY2Item(0);\r\n    \r\n      // LABEL\r\n      var setTxt = false;\r\n      // set title\r\n      if( item.title !== undefined && item.title != '' ) {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.title').html(item.title);\r\n        setTxt = true;\r\n      }\r\n      else {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.title').html('');\r\n      }\r\n      // set description\r\n      if( item.description !== undefined && item.description != '' ) {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.description').html(item.description);\r\n        setTxt = true;\r\n      }\r\n      else {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.description').html('');\r\n      }\r\n      \r\n      if( setTxt ) {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.label').show();\r\n      }\r\n      else {\r\n        G.VOM.$viewer.find('.ngy2viewerToolAction').find('.label').hide();\r\n      }\r\n      \r\n      // set page number\r\n      var viewerMaxImages = G.VOM.items.length;\r\n      if( viewerMaxImages > 0 ) {\r\n        G.VOM.$viewer.find('.pageCounter').html((G.VOM.items[vomIdx].mediaNumber)+'/'+viewerMaxImages);\r\n      }\r\n      \r\n      // custom elements\r\n      var $cu = G.VOM.$viewer.find('.ngy2CustomBtn');\r\n      var fu = G.O.fnImgToolbarCustDisplay;\r\n      if( $cu.length > 0 && fu !== null ) {\n        typeof fu == 'function' ? fu($cu, item) : window[fu]($cu, item);\r\n      }\n      \r\n      // set event handlers again\r\n      ViewerToolsOn();\r\n    }\r\n    \r\n    // Pan the media container in the lightbox (left/right)\r\n    function ViewerMediaPanX( posX ) {\r\n      G.VOM.swipePosX = posX;\r\n      if( G.CSStransformName == null ) {\r\n        // no pan if CSS transform not supported\r\n        // G.VOM.$mediaCurrent.css({ left: posX }); \r\n      }\r\n      else {\r\n      \r\n        // pan left/right the current media\r\n        // window.ng_draf( function() {\r\n          G.VOM.$mediaCurrent[0].style[G.CSStransformName] = 'translate(' + posX + 'px, 0px)';\r\n        // });\r\n\r\n        var itemPrevious = G.VOM.NGY2Item(-1);\n        var itemNext = G.VOM.NGY2Item(1);\n        \r\n        // next/previous media\r\n        if(  G.O.imageTransition.startsWith('SWIPE') ) {\r\n          if( itemPrevious.mediaTransition() ) {\r\n            ViewerSetMediaVisibility(G.VOM.NGY2Item(-1), G.VOM.$mediaPrevious, 1);\r\n          }\r\n          if( itemNext.mediaTransition() ) {\r\n            ViewerSetMediaVisibility(G.VOM.NGY2Item(1), G.VOM.$mediaNext, 1);\r\n          }\r\n\r\n          var sc = Math.min( Math.max( Math.abs(posX) / G.VOM.window.lastWidth, .8), 1);\r\n          if( G.O.imageTransition == 'SWIPE' ) { sc = 1; }\r\n\r\n          if( posX > 0 ) {\r\n            var dir = G.VOM.window.lastWidth;\n            if( itemPrevious.mediaTransition() ) {\r\n              // window.ng_draf( function() {\r\n                G.VOM.$mediaPrevious[0].style[G.CSStransformName] = 'translate(' + (-dir + posX) + 'px, 0px) scale(' + sc + ')';\r\n              // });\r\n            }\r\n            if( itemNext.mediaTransition() ) {\r\n              // window.ng_draf( function() {\r\n                G.VOM.$mediaNext[0].style[G.CSStransformName] = 'translate(' + (dir) + 'px, 0px) scale(' + sc + ')';\r\n              // });\r\n            }\r\n          }\r\n          else {\r\n            var dir = -G.VOM.window.lastWidth;\r\n            if( itemNext.mediaTransition() ) {\r\n              // window.ng_draf( function() {\r\n                G.VOM.$mediaNext[0].style[G.CSStransformName] = 'translate(' + (-dir + posX) + 'px, 0px) scale(' + sc + ')';\r\n              // });\r\n            }\r\n            if( itemPrevious.mediaTransition() ) {\r\n              // window.ng_draf( function() {\r\n                G.VOM.$mediaPrevious[0].style[G.CSStransformName] = 'translate(' + (dir) + 'px, 0px) scale(' + sc + ')';\r\n              // });\r\n            }\r\n          }\r\n        }\r\n        \r\n        \r\n        if(  G.O.imageTransition == 'SLIDEAPPEAR' ) {\r\n          G.VOM.$mediaPrevious[0].style[G.CSStransformName] = '';\r\n          G.VOM.$mediaNext[0].style[G.CSStransformName] = '';\r\n          if( posX < 0 ) {\r\n            var o = (-posX) / G.VOM.window.lastWidth;\r\n            if( itemNext.mediaTransition() ) {\r\n              ViewerSetMediaVisibility(itemNext, G.VOM.$mediaNext, o);\r\n            }\r\n            if( itemPrevious.mediaTransition() ) {\r\n              ViewerSetMediaVisibility(itemPrevious, G.VOM.$mediaPrevious, 0);\r\n            }\r\n          }\r\n          else {\r\n            var o = posX / G.VOM.window.lastWidth;\r\n            if( itemPrevious.mediaTransition() ) {\r\n              ViewerSetMediaVisibility(itemPrevious, G.VOM.$mediaPrevious, o);\r\n            }\r\n            if( itemNext.mediaTransition() ) {\r\n              ViewerSetMediaVisibility(itemNext, G.VOM.$mediaNext, 0);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Display next image\r\n    function DisplayNextMedia() {\r\n      if( G.VOM.viewerMediaIsChanged || ((new Date().getTime()) - G.VOM.timeImgChanged < 300) ) { return; }\r\n      \r\n      TriggerCustomEvent('lightboxNextImage');\r\n      DisplayInternalViewer(G.VOM.IdxNext(), 'nextImage');\r\n    };\r\n    \r\n    // Display previous image\r\n    function DisplayPreviousMedia() {\r\n      if( G.VOM.viewerMediaIsChanged || ((new Date().getTime()) - G.VOM.timeImgChanged < 300) ) { return; }\r\n      if( G.VOM.playSlideshow ) {\r\n        SlideshowToggle();\r\n      }\r\n      \r\n      TriggerCustomEvent('lightboxPreviousImage');\r\n      DisplayInternalViewer(G.VOM.IdxPrevious(), 'previousImage');\r\n    };\r\n    \r\n    // Display image (and run animation)\r\n    function DisplayInternalViewer( newVomIdx, displayType ) {\r\n\r\n      if( G.VOM.playSlideshow ) { window.clearTimeout(G.VOM.playSlideshowTimerID); }\r\n      \r\n      var itemOld = G.VOM.NGY2Item(0);\n      var itemNew = G.I[G.VOM.items[newVomIdx].ngy2ItemIdx];\r\n      var $new = (displayType == 'nextImage' ? G.VOM.$mediaNext : G.VOM.$mediaPrevious);\r\n      if( displayType == 'nextImage' ) {\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(-1), G.VOM.$mediaPrevious, 0);\r\n      }\r\n      else {\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(1), G.VOM.$mediaNext, 0);\r\n      }\r\n\r\n      G.VOM.timeImgChanged = new Date().getTime();\r\n      G.VOM.viewerMediaIsChanged = true;\r\n      G.VOM.zoom.isZooming = false;\r\n      ResizeInternalViewer(true);\r\n \r\n      if( G.O.debugMode && console.timeline ) { console.timeline('nanogallery2_viewer'); }\r\n\r\n      SetLocationHash( itemNew.albumID, itemNew.GetID() );\r\n      \r\n      // animation duration is proportional of the remaining distance\r\n      var vP = G.GOM.cache.viewport;\r\n      var dur = 400 * (vP.w - Math.abs(G.VOM.swipePosX)) / vP.w;\r\n      \r\n      if( displayType == '' ) {\r\n        // first image --> just appear / no slide animation\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n        if( G.CSStransformName == null ) {\r\n          // no CSS transform support -> no animation\r\n          ViewerSetMediaVisibility(itemNew, $new, 1);\r\n          DisplayInternalViewerComplete(displayType, newVomIdx);\r\n        }\r\n        else {\r\n          ViewerSetMediaVisibility(itemNew, $new, 0);\r\n          new NGTweenable().tween({\r\n            from:         { opacity: 0 },\r\n            to:           { opacity: 1 },\r\n            attachment:   { dT: displayType, item: itemOld },\r\n            easing:       'easeInOutSine',\r\n            delay:        30,\r\n            duration:     400,\r\n            step:         function (state, att) {\r\n              // using scale is not a good idea on Chrome -> image will be blurred\r\n              G.VOM.$content.css('opacity', state.opacity);\r\n            },\r\n            finish:       function (state, att) {\r\n              ViewerToolsUnHide();\r\n              DisplayInternalViewerComplete(att.dT, newVomIdx);\r\n            }\r\n          });\r\n        }\r\n      }\r\n      else {\r\n        // animate the image transition between 2 images\r\n        if( G.CSStransformName == null  ) {\r\n          // no CSS transform support -> no animation\r\n          ViewerSetMediaVisibility(itemNew, $new, 1);\r\n          ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n          DisplayInternalViewerComplete(displayType, newVomIdx);\r\n        }\r\n        else {\r\n          switch( G.O.imageTransition ) {\r\n            case 'SWIPE':\r\n            case 'SWIPE2':\r\n              var dir = ( displayType == 'nextImage' ? - vP.w : vP.w );\r\n              $new[0].style[G.CSStransformName] = 'translate('+(-dir)+'px, 0px) '\r\n\r\n              new NGTweenable().tween({\r\n                from:         { t: G.VOM.swipePosX  },\r\n                to:           { t: (displayType == 'nextImage' ? - vP.w : vP.w) },\r\n                attachment:   { dT: displayType, $e: $new, itemNew: itemNew, itemOld: itemOld, dir: dir },\r\n                delay:        30,\r\n                duration:     dur,\r\n                easing:       (G.O.imageTransition == 'swipe' ? 'easeInOutSine' : 'easeInOutCubic'),\r\n                step:         function (state, att) {\r\n                  // current media\r\n                  ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n                  // G.VOM.$mediaCurrent[0].style[G.CSStransformName] = 'translate(' + state.t + 'px, 0px) rotate(' + att.itemOld.rotationAngle + 'deg)';\n                  G.VOM.$mediaCurrent[0].style[G.CSStransformName] = 'translate(' + state.t + 'px, 0px)';\r\n                  // new media\r\n                  if( att.itemNew.mediaTransition() ) {\r\n                    ViewerSetMediaVisibility(att.itemNew, att.$e, 1);\r\n\r\n                    var sc = Math.min( Math.max( (Math.abs(state.t)) / G.VOM.window.lastWidth, .8), 1);\r\n                    if( G.O.imageTransition == 'SWIPE' ) { sc = 1; }\r\n                    // att.$e[0].style[G.CSStransformName] = 'translate(' + (-att.dir+state.t) + 'px, 0px) scale(' + sc + ') rotate(' + att.itemNew.rotationAngle + 'deg)';\n                    att.$e[0].style[G.CSStransformName] = 'translate(' + (-att.dir+state.t) + 'px, 0px) scale(' + sc + ')';\r\n                  }\r\n                },\r\n                finish:       function (state, att) {\r\n                  G.VOM.$mediaCurrent[0].style[G.CSStransformName] = '';\r\n                  att.$e[0].style[G.CSStransformName] = '';\r\n                  DisplayInternalViewerComplete(att.dT, newVomIdx);\r\n                }\r\n              });\r\n              break;\r\n              \r\n            case 'SLIDEAPPEAR':\r\n            default:\r\n              var dir=(displayType == 'nextImage' ? - vP.w : vP.w);\r\n              var op = (Math.abs(G.VOM.swipePosX)) / G.VOM.window.lastWidth;\r\n              $new[0].style[G.CSStransformName] = '';\r\n              new NGTweenable().tween({\r\n                from:         { o: op, t: G.VOM.swipePosX },\r\n                to:           { o: 1, t: (displayType == 'nextImage' ? - vP.w : vP.w) },\r\n                attachment:   { dT:displayType, $e:$new, itemNew: itemNew, itemOld: itemOld, dir: dir },\r\n                delay:        30,\r\n                duration:     dur,\r\n                easing:       'easeInOutSine',\r\n                step:         function (state, att) {\r\n                  // current media - translate\r\n                  // G.VOM.$mediaCurrent[0].style[G.CSStransformName]= 'translate('+state.t+'px, 0px) rotate(' + att.itemOld.rotationAngle + 'deg)';\n                  G.VOM.$mediaCurrent[0].style[G.CSStransformName]= 'translate('+state.t+'px, 0px)';\r\n                  // new media - opacity\r\n                  if( att.itemNew.mediaTransition() ) {\r\n                    ViewerSetMediaVisibility(att.itemNew, att.$e, state.o);\r\n                  }\r\n                },\r\n                finish:       function (state, att) {\r\n                  G.VOM.$mediaCurrent[0].style[G.CSStransformName]= '';\r\n                  DisplayInternalViewerComplete(att.dT, newVomIdx);\r\n                }\r\n              });\r\n              break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  \r\n\r\n    function DisplayInternalViewerComplete( displayType, newVomIdx ) {\r\n      G.VOM.currItemIdx = newVomIdx;\r\n      \r\n      var ngy2item = G.VOM.NGY2Item(0);\r\n\r\n      ViewerToolbarElementContent();\r\n      if( G.O.debugMode && console.timeline ) { console.timelineEnd('nanogallery2_viewer'); }\r\n\r\n      var fu=G.O.fnImgDisplayed;\r\n      if( fu !== null ) {\r\n        typeof fu == 'function' ? fu(ngy2item) : window[fu](ngy2item);\r\n      }\r\n      \r\n      G.VOM.swipePosX = 0;\r\n      if( displayType != '' ) {\r\n        // not on first media display\r\n        // G.VOM.$mediaCurrent.off(\"click\");\r\n        G.VOM.$mediaCurrent.removeClass('imgCurrent');\r\n\r\n        var $tmp = G.VOM.$mediaCurrent;\r\n        switch( displayType ) {\r\n          case 'nextImage':\r\n            G.VOM.$mediaCurrent = G.VOM.$mediaNext;\r\n            G.VOM.$mediaNext = $tmp;\r\n            break;\r\n          case 'previousImage':\r\n            G.VOM.$mediaCurrent = G.VOM.$mediaPrevious;\r\n            G.VOM.$mediaPrevious = $tmp;\r\n            break;\r\n        }\r\n      }\r\n      \r\n      G.VOM.$mediaCurrent.addClass('imgCurrent');\r\n      \r\n      // re-sort the media containers --> current on top\r\n      var $pans = G.VOM.$content.find('.nGY2ViewerMediaPan');\r\n      G.VOM.$mediaCurrent.insertAfter($pans.last());\r\n      \r\n      if( ngy2item.mediaKind == 'img' && ngy2item.imageWidth == 0 ) {\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 0);\r\n      }\r\n      else {\r\n        G.VOM.$mediaCurrent.children().eq(0).attr('class', 'nGY2ViewerMediaLoaderHidden');    // hide preloader\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n      }\r\n\r\n      \r\n      // set the new NEXT media\r\n      G.VOM.$mediaNext.empty();\r\n      var nextItem = G.VOM.NGY2Item(1);\r\n      var spreloader = '<div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>';\r\n      if( nextItem.mediaKind == 'img' && nextItem.imageWidth != 0 && nextItem.imageHeight != 0 ) {\r\n        spreloader = '<div class=\"nGY2ViewerMediaLoaderHidden\"></div>';\r\n      }\r\n      G.VOM.$mediaNext.append( spreloader + nextItem.mediaMarkup );\r\n      ViewerSetMediaVisibility(nextItem, G.VOM.$mediaNext, 0);\r\n      if( nextItem.mediaKind == 'img' ) {\r\n        G.VOM.ImageLoader.loadImage(VieweImgSizeRetrieved, nextItem);\r\n      }\n      else {\r\n        ViewerMediaCenterNotImg( G.VOM.$mediaNext );\r\n      }\r\n\r\n      // set the new PREVIOUS media\r\n      G.VOM.$mediaPrevious.empty();\r\n      var previousItem = G.VOM.NGY2Item(-1);\r\n      spreloader = '<div class=\"nGY2ViewerMediaLoaderDisplayed\"></div>';\r\n      if( previousItem.mediaKind == 'img' && previousItem.imageWidth != 0 && previousItem.imageHeight != 0 ) {\r\n        spreloader = '<div class=\"nGY2ViewerMediaLoaderHidden\"></div>';\r\n      }\r\n      G.VOM.$mediaPrevious.append( spreloader + previousItem.mediaMarkup );\r\n      ViewerSetMediaVisibility(previousItem, G.VOM.$mediaPrevious, 0);\r\n      if( previousItem.mediaKind == 'img' ) {\r\n        G.VOM.ImageLoader.loadImage( VieweImgSizeRetrieved, previousItem );\r\n      }\r\n      else {\r\n        ViewerMediaCenterNotImg( G.VOM.$mediaPrevious );\r\n      }\r\n\r\n        \r\n      // slideshow mode - wait until image is loaded to start the delay for next image\r\n      if( G.VOM.playSlideshow ) {\r\n        G.VOM.$mediaCurrent.children().eq(1).ngimagesLoaded().always( function( instance ) {\r\n          if( G.VOM.playSlideshow ) {\r\n            // in the meantime the user could have stopped the slideshow\r\n            G.VOM.playSlideshowTimerID = window.setTimeout( function(){ DisplayNextMedia(); }, G.VOM.slideshowDelay );\r\n          }\r\n        });\r\n      }\r\n      \r\n      // close viewer when user clicks outside of the image\r\n      // G.VOM.$mediaCurrent.on(\"click\",function(e){\r\n      //  e.stopPropagation();\r\n      //  if( (new Date().getTime()) - G.VOM.timeImgChanged < 400 ) { return; }\r\n      //  StopPropagationPreventDefault(e);\r\n      //  CloseInternalViewer(G.VOM.currItemIdx);\r\n      //  return false;\r\n      // });\r\n\r\n      ResizeInternalViewer();\r\n\r\n      G.VOM.viewerMediaIsChanged = false;\r\n      TriggerCustomEvent('lightboxImageDisplayed');\r\n      \r\n    }\r\n\r\n    \r\n    // Is fired as soon as the size of an image has been retrieved (the download may not be finished)\r\n    function VieweImgSizeRetrieved(w, h, item, n) {\r\n      item.imageWidth = w;\r\n      item.imageHeight = h;\r\n  \r\n      // image sized retrieved for currently displayed media\r\n      // if( G.VOM.$mediaCurrent !== null && G.VOM.$mediaCurrent.children().attr('src') == item.responsiveURL() ) {\r\n      if( G.VOM.NGY2Item(0) == item ) {\r\n        // it is the current displayed media\r\n        G.VOM.$mediaCurrent.children().eq(0).attr('class', 'nGY2ViewerMediaLoaderHidden');    // hide preloader\r\n        ViewerSetMediaVisibility(G.VOM.NGY2Item(0), G.VOM.$mediaCurrent, 1);\r\n        G.VOM.zoom.userFactor = 1;\r\n      }\r\n      \n      if( G.VOM.NGY2Item(1) == item ) {   // next media\n        G.VOM.$mediaNext.children().eq(0).attr('class', 'nGY2ViewerMediaLoaderHidden');    // hide preloader\n      }\n      if( G.VOM.NGY2Item(-1) == item ) {   // previous media\n        G.VOM.$mediaPrevious.children().eq(0).attr('class', 'nGY2ViewerMediaLoaderHidden');    // hide preloader\n      }\n      \r\n      ViewerMediaSetPosAndZoom();\r\n\r\n    }\r\n\r\n    // Viewer - Set the visibility of the media and it's container\r\n    function ViewerSetMediaVisibility(item, $media, opacity ) {\r\n      \r\n      if( item.mediaKind == 'img' && item.imageWidth == 0 ) {\r\n        // do not display image if width is unknown (--> callback will set the width when know)\r\n        // setting opacity to 0 is not enough -> it is mandatory to change also the visibility to hidden to avoid responds to events (click/touch)\r\n        // $media.children().css({ opacity: 0, visibility: 'hidden' });\n        $media.children().eq(1).css({ opacity: 0, visibility: 'hidden' });    // hide media\r\n        // $media.css({ opacity: 0, visibility: 'hidden' });\r\n        return;\r\n      }\r\n      \r\n      if( opacity == 0 ) {\r\n        // setting opacity to 0 is not enough -> it is mandatory to change also the visibility to hidden to avoid responds to events (click/touch)\r\n        // $media.css({ opacity: 0, visibility: 'hidden' });\r\n        $media.children().css({ opacity: 0, visibility: 'hidden' });    // hide media\r\n      }\r\n      else {\r\n        // $media.css({ opacity: opacity, visibility: 'visible' });\r\n        $media.children().css({ opacity: opacity, visibility: 'visible' });      // display media\n      }\r\n    }\r\n    \r\n    \r\n    // Close the internal lightbox\r\n    function CloseInternalViewer( vomIdx ) {\r\n\r\n      G.VOM.viewerMediaIsChanged = false;\r\n\r\n      if( G.VOM.viewerDisplayed ) {\r\n\r\n        // set scrollbar visible again\r\n      jQuery('body').css({ overflowX: G.VOM.saveOverflowX, overflowY: G.VOM.saveOverflowY});\r\n      // jQuery('body').css({overflow: 'visible'});\r\n        \r\n        \r\n        if( G.VOM.playSlideshow ) {\r\n          window.clearTimeout(G.VOM.playSlideshowTimerID);\r\n          G.VOM.playSlideshow = false;\r\n        }\r\n\r\n        // G.VOM.userEvents.removeEventListeners();\r\n        // G.VOM.userEvents=null;\r\n        G.VOM.hammertime.destroy();\r\n        G.VOM.hammertime = null;\r\n\r\n        if( ngscreenfull.enabled && G.VOM.viewerIsFullscreen ) {\r\n          G.VOM.viewerIsFullscreen = false;\r\n          ngscreenfull.exit();\r\n        }\r\n        \r\n        G.VOM.$cont.hide(0).off().show(0).html('').remove();\r\n        G.VOM.viewerDisplayed = false;\r\n\r\n        if( G.O.thumbnailAlbumDisplayImage ) {\r\n          // content of album displayed directly in lightbox (no gallery display for album content)\r\n          if( vomIdx == null ) {\r\n            // lightbox closed with browser back-button\r\n            // the gallery is already displayed\r\n          }\r\n          else {\r\n            var item = G.I[G.VOM.items[vomIdx].ngy2ItemIdx];\r\n            var parent = NGY2Item.Get(G, item.albumID);\r\n            if( G.GOM.albumIdx != parent.albumID ) {\r\n              // display album only if not already displayed\r\n              DisplayAlbum('-1', parent.albumID);\r\n            }\r\n            else {\r\n              GalleryResize();        \r\n              SetLocationHash( '', '' );\r\n              ThumbnailHoverReInitAll();\r\n            }\r\n          }\r\n            // DisplayAlbum( '-', G.I[G.VOM.items[vomIdx].ngy2ItemIdx].albumID );\r\n        }\r\n        else {\r\n          if( vomIdx != null ) {\r\n            if( G.GOM.albumIdx == -1 ) {\r\n              // album not displayed --> display gallery\r\n              DisplayAlbum( '', G.I[G.VOM.items[vomIdx].ngy2ItemIdx].albumID );\r\n            }\r\n            else {\r\n              GalleryResize();        \r\n              SetLocationHash( G.I[G.VOM.items[vomIdx].ngy2ItemIdx].albumID, '' );\r\n              ThumbnailHoverReInitAll();\r\n            }\r\n          }\r\n        }\r\n        G.VOM.timeImgChanged = new Date().getTime();\r\n      }\r\n    }\r\n\r\n    \r\n    // Internal viewer resized -> reposition elements\r\n    function ResizeInternalViewer( forceUpdate ) {\r\n      forceUpdate = typeof forceUpdate !== 'undefined' ? forceUpdate : false;\r\n      \r\n      if( G.VOM.$toolbar === null ) { return; }   // viewer build not finished\r\n      \r\n      \r\n      // window.requestAnimationFrame( function() {    // synchronize with screen\r\n      var windowsW = G.VOM.$viewer.width();\r\n      var windowsH = G.VOM.$viewer.height();\r\n      var $elt = G.VOM.$mediaCurrent.children().eq(1);\r\n      if( $elt == null || G.VOM.currItemIdx == -1 ) { return; }\r\n      \r\n      if( !forceUpdate && G.VOM.window.lastWidth == windowsW  && G.VOM.window.lastHeight == windowsH ) { return; }\r\n      \r\n      G.VOM.window.lastWidth = windowsW;\r\n      G.VOM.window.lastHeight = windowsH;\r\n\r\n      // var vwImgC_H=$elt.height(),\r\n      // vwImgC_W=$elt.width(),\r\n      // vwImgC_OHt=$elt.outerHeight(true),\r\n      // vwImgC_OHf=$elt.outerHeight(false);\r\n\r\n      var $tb = G.VOM.$toolbar.find('.toolbar');\r\n      var tb_OHt = $tb.outerHeight(true);\r\n\r\n      switch( G.O.viewerToolbar.position ) {\r\n        case 'topOverImage':\r\n          G.VOM.$content.css({height: windowsH, width: windowsW, top: 0  });\r\n          G.VOM.$toolbar.css({top: 0, bottom: ''});\r\n          break;\r\n        case 'top':\r\n          windowsH -= tb_OHt;\r\n          G.VOM.$content.css({height: windowsH, width: windowsW, top: tb_OHt  });\r\n          G.VOM.$toolbar.css({top: 0});\r\n          break;\r\n        case 'bottomOverImage':\r\n          G.VOM.$content.css({height:windowsH, width: windowsW, bottom: 0, top: 0  });\r\n          G.VOM.$toolbar.css({bottom: 0});\r\n          break;\r\n        case 'bottom':\r\n        default:\r\n          windowsH -= tb_OHt;\r\n          G.VOM.$content.css({ width: windowsW, top: 0, bottom: tb_OHt });\r\n          G.VOM.$toolbar.css({bottom: 0});\r\n          break;\r\n      }\r\n\r\n      if( !G.VOM.viewerMediaIsChanged && G.VOM.zoom.isZooming ) {\r\n        ViewerMediaSetPosAndZoom();\r\n      }\r\n      else {\r\n\t\t\t\tif( !G.VOM.zoom.isZooming && ( G.VOM.zoom.userFactor != 0 || G.VOM.panPosX != 0 || G.VOM.panPosY != 0 || G.VOM.zoom.posX != 0 || G.VOM.zoom.posY != 0 )) {\r\n\t\t\t\t\t// animate image zoom factor and position back to initial values\r\n\t\t\t\t\tG.VOM.zoom.isZooming= true;\t\t// activate zooming temporarily\r\n          new NGTweenable().tween({\r\n            from:           { userFactor: G.VOM.zoom.userFactor, panPosX: G.VOM.panPosX, panPosY: G.VOM.panPosY, zoomPosX: G.VOM.zoom.posX, zoomPosY: G.VOM.zoom.posY },\r\n            to:           { userFactor: 1, panPosX: 0, panPosY: 0, zoomPosX: 0, zoomPosY: 0 },\r\n            easing:       'easeInOutSine',\r\n            delay:        0,\r\n            duration:     150,\r\n            step:         function (state) {\r\n\t\t\t\t\t\t\tG.VOM.zoom.userFactor=state.userFactor;\r\n\t\t\t\t\t\t\tG.VOM.panPosX=state.panPosX;\r\n\t\t\t\t\t\t\tG.VOM.panPosY=state.panPosY;\r\n\t\t\t\t\t\t\tG.VOM.zoom.posX=state.zoomPosX;\r\n\t\t\t\t\t\t\tG.VOM.zoom.posY=state.zoomPosY;\r\n\t\t\t\t\t\t\tViewerMediaSetPosAndZoom();\r\n            },\r\n            finish:       function (state) {\r\n\t\t\t\t\t\t\tG.VOM.zoom.isZooming=false;\r\n            }\r\n          });\r\n\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tG.VOM.zoom.userFactor = 1;\r\n\t\t\t\t\tG.VOM.zoom.isZooming = false;\r\n\t\t\t\t\tG.VOM.panPosX = 0;\r\n\t\t\t\t\tG.VOM.panPosY = 0;\r\n\t\t\t\t\tG.VOM.zoom.posX = 0;\r\n\t\t\t\t\tG.VOM.zoom.posY = 0;\r\n\t\t\t\t\tViewerMediaSetPosAndZoom();\r\n\t\t\t\t}\r\n      }\r\n    }\r\n\r\n\r\n\r\n    /** @function BuildSkeleton */\r\n    /** Build the gallery structure **/\r\n    function BuildSkeleton() {\r\n    \r\n      // store markup if defined\r\n      var $elements = G.$E.base.children('a');\r\n      if( $elements.length > 0 ) {\r\n        G.O.$markup = $elements;\r\n      }\r\n      G.$E.base.text('');\r\n      G.$E.base.addClass('ngy2_container');\r\n      \r\n      // RTL or LTR\r\n      var sRTL='';\r\n      if( G.O.RTL ) {\r\n        sRTL = 'style=\"text-align:right;direction:rtl;\"';\r\n      }\r\n    \r\n      // theme\r\n      G.$E.base.addClass(G.O.theme)\r\n      // gallery color scheme\r\n      SetGalleryTheme();\r\n\r\n      // Hide icons (thumbnails and breadcrumb)\r\n      if( G.O.thumbnailLabel.get('hideIcons') ) {\r\n        G.O.icons.thumbnailAlbum = '';\r\n        G.O.icons.thumbnailImage = '';\r\n      }\r\n\r\n      // Navigation bar\r\n      var styleNavigation=\"\";\r\n      if( G.O.navigationFontSize != undefined && G.O.navigationFontSize != '' ) {\r\n        styleNavigation=' style=\"font-size:'+G.O.navigationFontSize+';\"';\r\n      }      \r\n      G.$E.conNavigationBar = jQuery('<div class=\"nGY2Navigationbar\" '+styleNavigation+'></div>').appendTo(G.$E.base);\r\n\r\n      // pre-loader\r\n      G.$E.conLoadingB = jQuery('<div class=\"nanoGalleryLBarOff\"><div></div><div></div><div></div><div></div><div></div></div>').appendTo(G.$E.base);\r\n\r\n      // gallery\r\n      G.$E.conTnParent = jQuery('<div class=\"nGY2Gallery\"></div>').appendTo( G.$E.base );\r\n      G.$E.conTn = jQuery('<div class=\"nGY2GallerySub\"></div>').appendTo( G.$E.conTnParent );\r\n\r\n      // configure gallery\r\n      switch( G.O.thumbnailAlignment ) {\r\n        case 'left':\r\n          G.$E.conTnParent.css({'text-align':'left'});\r\n          // G.$E.conNavBCon.css({'margin-left':0 });\r\n          break;\r\n        case 'right':\r\n          G.$E.conTnParent.css({'text-align':'right'});\r\n          // G.$E.conNavBCon.css({ 'margin-right':0});\r\n          break;\r\n      }\r\n      \r\n      // apply galleryBuildInit2 css settings to the gallery\r\n      if( G.O.galleryBuildInit2 !== undefined ) {\r\n      var t1=G.O.galleryBuildInit2.split('|');\r\n        for( var i=0; i<t1.length; i++ ) {\r\n          var o1=t1[i].split('_');\r\n          if( o1.length == 2 ) {\r\n            G.$E.conTn.css(o1[0], o1[1]);\r\n          }\r\n        }\r\n      }\r\n      \r\n      // configure gallery depending on some thumbnail hover effects\r\n      var effects=G.tn.hoverEffects.std.concat(G.tn.hoverEffects.level1);\r\n      for( var j=0; j<effects.length; j++) {\r\n        switch( effects[j].type ) {\r\n          case 'scale':\r\n          case 'rotateZ':\r\n          case 'rotateX':\r\n          case 'rotateY':\r\n          case 'translateX':\r\n          case 'translateY':\r\n            // handle some special cases\r\n            if( effects[j].element == '.nGY2GThumbnail' ) {\r\n              // allow thumbnail upscale over the gallery's aera\r\n              G.$E.base.css('overflow', 'visible');\r\n              G.$E.base.find('.nGY2GallerySub').css('overflow', 'visible');\r\n              G.$E.conTnParent.css('overflow', 'visible');\r\n            }\r\n            break;\r\n        }\r\n      }\r\n      \r\n      // Gallery bottom container\r\n      G.$E.conTnBottom = jQuery('<div class=\"nGY2GalleryBottom\" '+styleNavigation+'></div>').appendTo( G.$E.conTnParent );\r\n      \r\n      // portable edition\r\n      if( G.O.portable ) {\r\n        // http://www.picresize.com/\r\n        // http://base64encode.net/base64-image-encoder\r\n        // var logo='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB8AAAAWCAYAAAA4oUfxAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH4QMPBwY6mxZgsAAABTFJREFUSMe1ll9oVGcaxn/fd86ZSWbSkEBMiWNdTTfRxiVbXFiU1bjKGqNexlURKys0tHqXpQZ64Sq4FxKqFy4qFSm9kA1FHNhFISgJqFCd6lL/YC7M3jhrJv5JmGSSMzPnzDnfuxdpZtP4b1vaF154P3gPD+/zPC/nVSKiAQOsBj7O5XK/nZiYeEtELH6iUEqFNTU1U9XV1d8AnwNfA1qJCMCfHz169NcjR45UXL16VWWzWQnD0PxU4JZl6draWtXW1iYHDx4sLlmy5C/AZwRB0JVOpyWRSHhACMjPmOHChQuL6XRagiDoUiIyumvXrpq+vr6obduqs7OTjRvbsbSFUgqUgKjyFG5+mlKpVH6LCMYYRAQRQSmF1hqtNd+xijGGVCpFMpkkCALZuXOn19fXN6Gmp6dNc3NzMDo66nR2dnL+/Hm+Ov933PwUAPHKagqei4gBFNs7dxGPx38U/du2bSOZTNLQ0FB6+PChbWez2WI+n3dEhI3tf+Det0N8de0Imz9YQWHa48u/3afjgxbqEpUM/es/uF8W+fijffi+TywWQ0S4fv06t2/fJpfLsXjxYtauXUtTUxNBECAihGFIJBJh1apVXLhwgXw+r7LZbNGeYU7MLD1BEPCLxkWs+HUT+SmPJY0TvPerd6l/J05YcLCGHWzbxrZtHjx4wP79+7l27dr3Jqyurqarq4ujR49i2zYAWmvCMJyVygCiZ7dh9kOtNb5XopD3KBQ8fL9EseBRyHsUCz6zS3Dnzh3WrVtXBq6oqGDBggUA5HI5jh07xo4dOzDmf0ujVBlGAWjmhTGC41hEow6RiI3j2DgRh0jUxonYWJaFGGHPnj2Mj49jWRYHDhzg7t27DA0NMTAwwOrVqwFIJpOcOHECx3Fe6oEXwG3bYux5ltHHz3mSGePpk+c8yczUI+knVFVVcePmDe7fvw9AT08Pvb29NDc3U1dXx4YNG7h8+TItLS1orTl58iT5fL68Ga8En55yWb6iifff/iPD/0iQGfglG3/zJ6a+beHf/3yH6Mjv+P269Vy5cgWlFDU1NXR3dxOGYdlcnudRVVXFvn37MMaQTqcZHh5+Kbg99zHjSodPuj997cqMjY0hItTW1hKPx9FalzW1LIswDFm0aBEAQRDguu6bJ581hOd5GBNiTEgYhuXa8z1EhIaGBgAymQzpdBqlFKVSiTCc6bcsi5s3bwJQWVlJfX39fMO9XHMAy7LQeibn1o7toJSio6MDAN/36e7uxvd9IpEIlmURjUZJpVKcOXMGpRStra0sXbr0peDfo30+LS+4U2uMMaxcuZLdu3dz7tw5+vv7aWtrY+/evdTX13Pr1i1OnTrF5OQkAIcPH8ayrNeCvx51njTGGE6fPk0mk2FwcJBUKkUqlXqh9/jx42zatKnMzJzhBEArpZT+zjGWZSEiBEHwypzVtbKykosXL3Lo0CEaGxvLpovFYqxZs4ZLly6VJQnDEBEpM6C11kopheu6JpFI+Fpr2bJli/zYGBkZkeHhYZmcnHxlz9atW0VrLYlEwndd19ixWOzx5s2b3z579qzp7+/X7e3ttLa2Yox5QaP5MfenEY1G0VoTBAHFYhFjTJlJrTX37t1jYGAAY4zp6OiQWCz2mCAItj979kyWL1/uAwE/7zERLFu2zH/69KkEQbB99ozaOz4+fqy3t7d2cHAwdF1XKaXe6P7/16AiQjwel/Xr1+uenp6Jurq6T4Av1JwD8j3gQ2BVsVh8S72J8x8QIiIVFRVTQAo4CwwB+r93qCLI9wKZ8AAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxNy0wMy0xNVQwNzowNjo1OC0wNDowMBNQsyUAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTctMDMtMTVUMDc6MDY6NTgtMDQ6MDBiDQuZAAAAAElFTkSuQmCC';\r\n        var logo = 'data:image/png;base64,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';\r\n        var st = \"font-weight:bold !important;color: #FF0075 !important;font-size: 14px !important;text-transform: lowercase !important;cursor:pointer !important;text-align: center !important;Text-Shadow: #000000 1px 0px 0px, #000000 1px 1px 0px, #000000 1px -1px 0px, #000000 -1px 1px 0px, #000000 -1px 0px 0px, #000000 -1px -1px 0px, #000000 0px 1px 0px, #000000 0px -1px 0px !important;\";\r\n        G.$E.ngy2i=jQuery('<div class=\"nGY2PortInfo\"><a href=\"http://nano.gallery\" target=\"_blank\" title=\"nanogallery2 | easy photo gallery for your website\" style=\"' + st + '\"><img src=\"' + logo + '\" style=\"height:32px !important;width:initial !important;box-shadow: none !important;vertical-align: middle !important;\"/> &nbsp; nanogallery2</a></div>').appendTo(G.$E.base);\r\n        \r\n        G.$E.ngy2i.find('a').on({\r\n          mouseenter: function () {\r\n            jQuery(this).attr('style', st);\r\n          },\r\n          mouseleave: function () {\r\n            jQuery(this).attr('style', st);\r\n          }\r\n        });\r\n      }\r\n      \r\n      // Error console\r\n      G.$E.conConsole = jQuery('<div class=\"nGY2ConsoleParent\"></div>').appendTo(G.$E.base);\r\n\r\n      // i18n translations\r\n      i18n();\r\n\r\n      // cache some thumbnails data (sizes, styles...)\r\n      ThumbnailDefCaches();\r\n\r\n      // do special settings depending for some options\r\n      // thumbnail display transition\r\n      switch( G.tn.opt.Get('displayTransition') ) {\r\n        case 'SCALEDOWN':\r\n        case 'RANDOMSCALE':\r\n        default:\r\n          G.$E.base.css('overflow', 'visible');\r\n          G.$E.conTnParent.css('overflow', 'visible');\r\n          G.$E.conTn.css('overflow', 'visible');\r\n          break;\r\n      }\r\n      \r\n    }\r\n    \r\n    function TriggerCustomEvent ( eventName ) {\r\n      // G.$E.base.trigger('pageChanged.nanogallery2', new Event('pageChanged.nanogallery2'));\r\n      var eN = eventName + '.nanogallery2';\r\n      var event=null;\r\n      try {\r\n          event = new Event( eN );\r\n        } catch(e) {\r\n          event = document.createEvent('Event');\r\n          event.initEvent(eN, false, false);\r\n        }\r\n        G.$E.base.trigger(eN, event);\r\n    }\r\n    \r\n    \r\n    /** @function SetGlobalEvents */\r\n    function SetGlobalEvents() {\r\n      // GLOBAL EVENT MANAGEMENT\r\n      \r\n      G.$E.conTnParent.on({\r\n        mouseenter: GalleryMouseEnter,\r\n        mouseleave: GalleryMouseLeave\r\n      }, \".nGY2GThumbnail\");    //pass the element as an argument to .on\r\n      \r\n      // G.GOM.hammertime = new NGHammer(G.$E.conTn[0], { touchAction: 'none' });\r\n      G.GOM.hammertime = new NGHammer( G.$E.conTn[0] );\r\n      // G.GOM.hammertime.domEvents = true;\r\n      \r\n      G.GOM.hammertime.on('pan', function(ev) {\r\n        if( !G.VOM.viewerDisplayed ) {\r\n          if( G.O.paginationSwipe && G.layout.support.rows && G.galleryDisplayMode.Get() == 'PAGINATION' ) {\n            if( Math.abs(ev.deltaY) > G.GOM.panThreshold ) {\n              G.GOM.panYOnly = true;\n            }\n            if( !G.GOM.panYOnly ) {\r\n              G.$E.conTn.css( G.CSStransformName , 'translate('+(ev.deltaX)+'px,0px)');\n            }\n          }\r\n        }\r\n      });\r\n      G.GOM.hammertime.on('panend', function(ev) {\r\n        if( !G.VOM.viewerDisplayed ) {\r\n          if( G.O.paginationSwipe && G.layout.support.rows && G.galleryDisplayMode.Get() == 'PAGINATION' ) {\r\n            if( !G.GOM.panYOnly ) {\r\n              if( ev.deltaX > 50 ) {\r\n                paginationPreviousPage();\r\n                return;\r\n              }\r\n              if(  ev.deltaX < -50 ) {\r\n                paginationNextPage();\r\n                return;\r\n              }\n            }\n            G.GOM.panYOnly = false;\r\n            G.$E.conTn.css( G.CSStransformName , 'translate(0px,0px)');\r\n            // pX=0;\r\n          }\r\n        }\r\n      });\r\n      G.GOM.hammertime.on('tap', function(ev) {\r\n        if( !G.VOM.viewerDisplayed ) {\r\n          ev.srcEvent.stopPropagation();\r\n          ev.srcEvent.preventDefault();  // cancel  mouseenter event\r\n\r\n          if( ev.pointerType == 'mouse') {\r\n            if( GalleryClicked(ev.srcEvent) == 'exit' ) { return; }\r\n          }\r\n          else {\r\n            var r = GalleryEventRetrieveElementl(ev.srcEvent, false);\r\n            if( r.GOMidx == -1 ) { return; }\r\n            if( r.action != 'NONE' && r.action != 'OPEN' ) {\r\n              // toolbar touched --> execute action\r\n              GalleryClicked(ev.srcEvent);\r\n              return;\r\n            }\r\n            \r\n            if( G.GOM.slider.hostIdx == r.GOMidx ) {\r\n              // touch on thumbnail slider -> open immediately\r\n              ThumbnailHoverOutAll();\r\n              ThumbnailOpen(G.GOM.items[G.GOM.slider.currentIdx].thumbnailIdx, true);\r\n              return;\r\n            }\r\n\r\n            if( (G.GOM.curNavLevel == 'l1' && G.O.touchAnimationL1 == false) ||  (G.GOM.curNavLevel == 'lN' && G.O.touchAnimation == false) ) {\r\n              // open on single touch (no hover animation)\r\n              ThumbnailOpen(G.GOM.items[r.GOMidx].thumbnailIdx, true);\r\n              return;\r\n            }\r\n            \r\n            if( G.O.touchAutoOpenDelay > 0 ) {\r\n              // open on single touch after end of hover animation (=defined delay)\r\n              ThumbnailHoverOutAll();\r\n              ThumbnailHover( r.GOMidx );\r\n              window.clearInterval( G.touchAutoOpenDelayTimerID );\r\n              G.touchAutoOpenDelayTimerID = window.setInterval(function(){\r\n                window.clearInterval( G.touchAutoOpenDelayTimerID );\r\n                ThumbnailOpen( G.GOM.items[r.GOMidx].thumbnailIdx, true );\r\n              }, G.O.touchAutoOpenDelay );\r\n            }\r\n            else {\r\n              // two touch scenario\r\n              if( !G.I[G.GOM.items[r.GOMidx].thumbnailIdx].hovered ) {\r\n                ThumbnailHoverOutAll();\r\n                ThumbnailHover(r.GOMidx);\r\n              }\r\n              else {\r\n                // second touch\r\n                ThumbnailOpen(G.GOM.items[r.GOMidx].thumbnailIdx, true);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      \r\n      // browser location hash management\r\n      if( G.O.locationHash ) {\r\n        // jQuery(window).bind( 'hashchange', function() {\r\n          // ProcessLocationHash();\r\n        // });\r\n        jQuery(window).on('hashchange.nanogallery2.' + G.baseEltID, function() {ProcessLocationHash();} );\r\n      }\r\n      \r\n      // Page resize / orientation change\r\n      jQuery(window).on('resize.nanogallery2.' + G.baseEltID + ' orientationChange.nanogallery2.' + G.baseEltID, debounce( ResizeWindowEvent, G.O.eventsDebounceDelay, false) );\r\n      \r\n      // Event page scrolled\r\n      jQuery(window).on('scroll.nanogallery2.' + G.baseEltID, debounce( OnScrollEvent, G.O.eventsDebounceDelay, false) );\r\n\r\n      // Debounced function to hide the toolbars on the viewer\r\n      G.VOM.toolsHide = debounce( ViewerToolsHide, G.O.viewerHideToolsDelay, false );\r\n      \r\n      // Keyboard management\r\n      jQuery(document).keyup(function(e) {\r\n        if( G.popup.isDisplayed ) {\r\n          switch( e.keyCode) {\r\n            case 27:    // Esc key\r\n              G.popup.close();\r\n              break;\r\n          }\r\n        }\r\n        else {\r\n          if( G.VOM.viewerDisplayed ) {\r\n            ViewerToolsUnHide();\r\n            switch( e.keyCode) {\r\n              case 27:    // Escape key\r\n              case 40:    // DOWN\r\n                CloseInternalViewer(G.VOM.currItemIdx);\r\n                break;\r\n              case 32:    // SPACE\r\n              case 13:    // ENTER\r\n                SlideshowToggle();\r\n                break;\r\n              case 38:    // UP\r\n              case 39:    // RIGHT\r\n              case 33:    // PAGE UP\r\n                DisplayNextMedia();\r\n                break;\r\n              case 37:    // LEFT\r\n              case 34:    // PAGE DOWN\r\n                DisplayPreviousMedia();\r\n                break;\r\n              case 35:    // END\r\n              case 36:    // BEGIN\r\n            }\r\n          }\r\n        }\r\n      });\r\n      \r\n      // mouse wheel to zoom in/out the image displayed in the internal lightbox\r\n      jQuery(window).bind('mousewheel wheel', function(e){\r\n        if( G.VOM.viewerDisplayed ) {\r\n          var deltaY = 0;\r\n          e.preventDefault();\r\n\r\n          if( ViewerZoomStart() ) {\r\n            if (e.originalEvent.deltaY) { // FireFox 17+ (IE9+, Chrome 31+?)\r\n              deltaY = e.originalEvent.deltaY;\r\n            } else if (e.originalEvent.wheelDelta) {\r\n              deltaY = -e.originalEvent.wheelDelta;\r\n            }\r\n            ViewerZoomIn( deltaY <= 0 ? true : false );\r\n          }\r\n        }\r\n      });\r\n      \r\n      // mouse mouse -> unhide lightbox toolbars\r\n      jQuery(window).bind('mousemove', function(e){\r\n        if( G.VOM.viewerDisplayed ) {\r\n          debounce( ViewerToolsUnHide, 100, false )();\r\n        }\r\n      });\r\n      \r\n      // fullscreen mode on/off --> internal lightbox\r\n      if( ngscreenfull.enabled ) {\r\n        // ngscreenfull.onchange(() => {\r\n        ngscreenfull.onchange( function() {\r\n          if( G.VOM.viewerDisplayed ) {\r\n            if( ngscreenfull.isFullscreen ) {\r\n              G.VOM.viewerIsFullscreen=true;\r\n              G.VOM.$viewer.find('.fullscreenButton').html(G.O.icons.viewerFullscreenOff);\r\n            }\r\n            else {\r\n              G.VOM.viewerIsFullscreen=false;\r\n              G.VOM.$viewer.find('.fullscreenButton').html(G.O.icons.viewerFullscreenOn);\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n    }\r\n    \r\n    //----- Manage browser location hash (deep linking and browser back/forward)\r\n    function ProcessLocationHash() {\r\n\r\n      // standard use case -> location hash processing\r\n      if( !G.O.locationHash ) { return false; }\r\n\r\n      var curGal = '#nanogallery/' + G.baseEltID + '/',\r\n      newLocationHash = location.hash;\r\n      if( G.O.debugMode ) {\r\n        console.log('------------------------ PROCESS LOCATION HASH');\r\n        console.log('newLocationHash1: ' +newLocationHash);\r\n        console.log('G.locationHashLastUsed: ' +G.locationHashLastUsed);\r\n      }\r\n      \r\n      if( newLocationHash == '' ) {\r\n        // if( G.GOM.lastDisplayedIdx != -1 ) {\r\n        if( G.locationHashLastUsed !== '' ) {\r\n          // back button and no hash --> display first album\r\n          if( G.O.debugMode ) { console.log('display root album'  ); }\r\n          G.locationHashLastUsed = '';\r\n          if( G.O.debugMode ) { console.log('new3 G.locationHashLastUsed: ' + G.locationHashLastUsed); }\r\n          DisplayAlbum('', '0');\r\n          return true;\r\n        }\r\n      }\r\n\r\n      if( newLocationHash == G.locationHashLastUsed ) { return; }\r\n      \r\n      if( newLocationHash.indexOf(curGal) == 0 ) {\r\n        // item IDs detected\r\n        var IDs=parseIDs( newLocationHash.substring(curGal.length) );\r\n        if( IDs.imageID != '0' ) {\r\n          if( G.O.debugMode ) { console.log('display image: ' + IDs.albumID +'-'+ IDs.imageID ); }\r\n          DisplayPhoto( IDs.imageID, IDs.albumID );\r\n          return true;\r\n        }\r\n        else {\r\n          if( G.O.debugMode ) { console.log('display album: ' + IDs.albumID  ); }\r\n          DisplayAlbum( '-1', IDs.albumID );\r\n          return true;\r\n        }\r\n      }    \r\n      \r\n      return false;\r\n    }\r\n\r\n    //---- Set a new browser location hash\r\n    function SetLocationHash(albumID, imageID ) {\r\n      if( !G.O.locationHash ) { return false; }\r\n\r\n      if( G.O.debugMode ) {\r\n        console.log('------------------------ SET LOCATION HASH');\r\n      }\r\n      \r\n      if( imageID == '' && (albumID == '-1' || albumID == '0' || G.O.album == albumID ) ) {\r\n        // root album level --> do not set top.location.hash if not already set\r\n        if( location.hash != '' ) {\r\n          // try to clear the hash if set\r\n          if (\"pushState\" in history) {\r\n            history.pushState(\"\", document.title, window.location.pathname + window.location.search);\r\n          }\r\n          else {\r\n            location.hash='';\r\n          }\r\n        }\r\n        G.locationHashLastUsed='';\r\n        if( G.O.debugMode ) { console.log('new2 G.locationHashLastUsed: '+G.locationHashLastUsed); }\r\n        return;\r\n      }\r\n      \r\n      var newLocationHash='#'+'nanogallery/'+G.baseEltID+'/'+ albumID;\r\n      if( imageID != '' ) {\r\n        newLocationHash+='/'+imageID;\r\n      }\r\n\r\n      var lH=location.hash;\r\n      if( G.O.debugMode ) {\r\n        console.log('newLocationHash2: '+newLocationHash);\r\n        console.log('location.hash: '+lH);\r\n      }\r\n\r\n      G.locationHashLastUsed=newLocationHash;\r\n      if( G.O.debugMode ) { console.log('new G.locationHashLastUsed: '+G.locationHashLastUsed); }\r\n      \r\n      if(  lH == '' || lH != newLocationHash ) {\r\n        // G.locationHashLastUsed='#'+newLocationHash;\r\n        try {\r\n          top.location.hash=newLocationHash;\r\n        }\r\n        catch(e) {\r\n          // location hash is not supported by current browser --> disable the option\r\n          G.O.locationHash=false;\r\n        }\r\n      }\r\n    }\r\n    \r\n    \r\n    function ResizeWindowEvent() {\r\n      CacheViewport();\r\n\r\n      if( G.VOM.viewerDisplayed ) {\r\n        ResizeInternalViewer();\r\n      }\r\n      else {\r\n        if( G.galleryResizeEventEnabled ) {\r\n          var nw = RetrieveCurWidth();\r\n          if( G.GOM.albumIdx != -1 && \r\n                ( G.tn.settings.height[G.GOM.curNavLevel][G.GOM.curWidth] != G.tn.settings.height[G.GOM.curNavLevel][nw] || \r\n                G.tn.settings.width[G.GOM.curNavLevel][G.GOM.curWidth] != G.tn.settings.width[G.GOM.curNavLevel][nw] ) ) {\r\n                  // do not use settings.getH() / settings.getW()\r\n            // thumbnail size changed --> render the gallery with the new sizes\r\n            G.GOM.curWidth = nw;\r\n            //G.layout.SetEngine();\r\n            G.GOM.pagination.currentPage = 0;\r\n            GalleryRender( G.GOM.albumIdx );\r\n          }\r\n          else {\r\n            GalleryResize();\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n     \r\n    // Depreciated - if gallery currently refreshed (G.galleryResizeEventEnabled=false), page may be scrolled but it will not be refreshed again\r\n    function OnScrollEvent_OLD() {\r\n      if( !G.VOM.viewerDisplayed ) {\r\n        if( G.galleryResizeEventEnabled ) {\r\n          GalleryResize();\r\n        }\r\n        return;\r\n      }\r\n    }\r\n\r\n\r\n    function OnScrollEvent() {\r\n      if( !G.VOM.viewerDisplayed ) {\r\n        GalleryResizeOnScrollEvent();\r\n      }\r\n    }\r\n    // the gallery may currently be refreshed, so ensure that at the end of the refresh, the gallery is refreshed again because the page may have been scrolled in the meantime\r\n    function GalleryResizeOnScrollEvent() {\r\n      if( G.galleryResizeEventEnabled == false) {\r\n        window.setTimeout(GalleryResizeOnScrollEvent, 10);  // check again in 10ms\r\n      } else {\r\n        GalleryResize();\r\n      }\r\n    }\r\n\r\n\r\n    \r\n    // I18N : define text translations\r\n    function i18n() {\r\n\r\n      // browser language\r\n      G.i18nLang = (navigator.language || navigator.userLanguage).toUpperCase();\r\n      if( G.i18nLang === 'UNDEFINED') { G.i18nLang=''; }\r\n\r\n      var llang=-('_'+G.i18nLang).length;\r\n      \r\n      if( toType(G.O.i18n) == 'object' ){\r\n      \r\n        for( var key in G.O.i18n ) {\r\n          //var value = G.O.i18n[key];\r\n          var s=key.substr(llang);\r\n          if( s == ('_'+G.i18nLang) ) {\r\n            G.i18nTranslations[key.substr(0,key.length-s.length)]=G.O.i18n[key];\r\n          } \r\n          else {\r\n            G.i18nTranslations[key]=G.O.i18n[key];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    function GetI18nItem( item, property ) {\r\n      var s='';\r\n      if( G.i18nLang != '' ) {\r\n        if( item[property+'_'+G.i18nLang] !== undefined && item[property+'_'+G.i18nLang].length>0 ) {\r\n          s=item[property+'_'+G.i18nLang];\r\n          return s;\r\n        }\r\n      }\r\n      s=item[property];\r\n      return s;\r\n    }\r\n\r\n    \r\n    function RetrieveCurWidth() {\r\n      var vpW = G.GOM.cache.viewport.w;\r\n      \r\n      if( G.O.breakpointSizeSM > 0 && vpW < G.O.breakpointSizeSM) { return 'xs'; }\r\n      if( G.O.breakpointSizeME > 0 && vpW < G.O.breakpointSizeME) { return 'sm'; }\r\n      if( G.O.breakpointSizeLA > 0 && vpW < G.O.breakpointSizeLA) { return 'me'; }\r\n      if( G.O.breakpointSizeXL > 0 && vpW < G.O.breakpointSizeXL) { return 'la'; }\r\n      \r\n      return 'xl';\r\n    }\r\n\r\n    \r\n    /** @function browserNotification */\r\n    function browserNotification() {\r\n      var m = 'Your browser version is not supported anymore. The image gallery cannot be displayed. <br><br>Please update to a more recent one. Download:<br>';\r\n      m    += '&nbsp;&nbsp;&nbsp; <a href=\"http://www.google.com/chrome/?hl=en-US)\">Chrome</a><br>';\r\n      m    += '&nbsp;&nbsp;&nbsp; <a href=\"http://www.mozilla.com/firefox/)\">Firefox</a><br>';\r\n      m    += '&nbsp;&nbsp;&nbsp; <a href=\"http://www.microsoft.com/windows/internet-explorer/default.aspx\">Internet Explorer</a><br>';\r\n      m    += '&nbsp;&nbsp;&nbsp; <a href=\"http://www.apple.com/safari/download/\">Safari</a>';\r\n      NanoAlert(G,  m, false);\r\n    }\r\n\r\n    // Original author : John Hrvatin, Lead Program Manager, Internet Explorer - http://blogs.msdn.com/b/ie/archive/2011/10/28/a-best-practice-for-programming-with-vendor-prefixes.aspx\r\n    function FirstSupportedPropertyName(prefixedPropertyNames) {\r\n      var tempDiv = document.createElement(\"div\");\r\n      for (var i = 0; i < prefixedPropertyNames.length; ++i) {\r\n        if (typeof tempDiv.style[prefixedPropertyNames[i]] != 'undefined')\r\n          return prefixedPropertyNames[i];\r\n      }\r\n      return null;\r\n    }\r\n\r\n    \r\n    \r\n    \r\n  }\r\n  \r\n\r\n\r\n//##########################################################################################################################\r\n//## imagesLoaded ##########################################################################################################\r\n//##########################################################################################################################\r\n\r\n// external module EMBEDED in nanogallery\r\n// NGY BUILD:\r\n// replace \"imagesLoaded\" with \"ngimagesLoaded\"\r\n// replace \"ImagesLoaded\" with \"ngImagesLoaded\"\r\n// replace \"EvEmitter\" with \"ngEvEmitter\"\r\n// replace \"var $ = window.jQuery\" with \"var $ = jQuery;\"\r\n// 2x (global.ngEvEmitter and window.ngimagesLoaded = f...)ignore package manager and set browser global\r\n\r\n\r\n\r\n/*!\r\n * imagesLoaded PACKAGED v4.1.1\r\n * JavaScript is all like \"You images are done yet or what?\"\r\n * MIT License\r\n */\r\n\r\n/**\r\n * EvEmitter v1.0.3\r\n * Lil' event emitter\r\n * MIT License\r\n */\r\n\r\n \r\n/* jshint unused: true, undef: true, strict: true */\r\n\r\n( function( global, factory ) {\r\n  // universal module definition\r\n  /* jshint strict: false */ /* globals define, module, window */\r\n//  if ( typeof define == 'function' && define.amd ) {\r\n    // AMD - RequireJS\r\n//    define( 'ev-emitter/ev-emitter',factory );\r\n//  } else if ( typeof module == 'object' && module.exports ) {\r\n    // CommonJS - Browserify, Webpack\r\n//    module.exports = factory();\r\n//  } else {\r\n    // Browser globals\r\n    global.ngEvEmitter = factory();\r\n//  }\r\n\r\n}( typeof window != 'undefined' ? window : this, function() {\r\n\r\n\r\n\r\nfunction ngEvEmitter() {}\r\n\r\nvar proto = ngEvEmitter.prototype;\r\n\r\nproto.on = function( eventName, listener ) {\r\n  if ( !eventName || !listener ) {\r\n    return;\r\n  }\r\n  // set events hash\r\n  var events = this._events = this._events || {};\r\n  // set listeners array\r\n  var listeners = events[ eventName ] = events[ eventName ] || [];\r\n  // only add once\r\n  if ( listeners.indexOf( listener ) == -1 ) {\r\n    listeners.push( listener );\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\nproto.once = function( eventName, listener ) {\r\n  if ( !eventName || !listener ) {\r\n    return;\r\n  }\r\n  // add event\r\n  this.on( eventName, listener );\r\n  // set once flag\r\n  // set onceEvents hash\r\n  var onceEvents = this._onceEvents = this._onceEvents || {};\r\n  // set onceListeners object\r\n  var onceListeners = onceEvents[ eventName ] = onceEvents[ eventName ] || {};\r\n  // set flag\r\n  onceListeners[ listener ] = true;\r\n\r\n  return this;\r\n};\r\n\r\nproto.off = function( eventName, listener ) {\r\n  var listeners = this._events && this._events[ eventName ];\r\n  if ( !listeners || !listeners.length ) {\r\n    return;\r\n  }\r\n  var index = listeners.indexOf( listener );\r\n  if ( index != -1 ) {\r\n    listeners.splice( index, 1 );\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\nproto.emitEvent = function( eventName, args ) {\r\n  var listeners = this._events && this._events[ eventName ];\r\n  if ( !listeners || !listeners.length ) {\r\n    return;\r\n  }\r\n  var i = 0;\r\n  var listener = listeners[i];\r\n  args = args || [];\r\n  // once stuff\r\n  var onceListeners = this._onceEvents && this._onceEvents[ eventName ];\r\n\r\n  while ( listener ) {\r\n    var isOnce = onceListeners && onceListeners[ listener ];\r\n    if ( isOnce ) {\r\n      // remove listener\r\n      // remove before trigger to prevent recursion\r\n      this.off( eventName, listener );\r\n      // unset once flag\r\n      delete onceListeners[ listener ];\r\n    }\r\n    // trigger listener\r\n    listener.apply( this, args );\r\n    // get next listener\r\n    i += isOnce ? 0 : 1;\r\n    listener = listeners[i];\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\nreturn ngEvEmitter;\r\n\r\n}));\r\n\r\n/*!\r\n * ngimagesLoaded v4.1.1\r\n * JavaScript is all like \"You images are done yet or what?\"\r\n * MIT License\r\n */\r\n\r\n( function( window, factory ) { 'use strict';\r\n  // universal module definition\r\n\r\n  /*global define: false, module: false, require: false */\r\n\r\n//  if ( typeof define == 'function' && define.amd ) {\r\n    // AMD\r\n//    define( [\r\n//      'ev-emitter/ev-emitter'\r\n//    ], function( ngEvEmitter ) {\r\n//      return factory( window, ngEvEmitter );\r\n//    });\r\n//  } else if ( typeof module == 'object' && module.exports ) {\r\n    // CommonJS\r\n//    module.exports = factory(\r\n//      window,\r\n//      require('ev-emitter')\r\n//    );\r\n//  } else {\r\n    // browser global\r\n    window.ngimagesLoaded = factory(\r\n      window,\r\n      window.ngEvEmitter\r\n    );\r\n  //}\r\n\r\n})( window,\r\n\r\n// --------------------------  factory -------------------------- //\r\n\r\nfunction factory( window, ngEvEmitter ) {\r\n\r\n\r\n\r\n// var $ = window.jQuery;\r\nvar $ = jQuery;\r\nvar console = window.console;\r\n\r\n// -------------------------- helpers -------------------------- //\r\n\r\n// extend objects\r\nfunction extend( a, b ) {\r\n  for ( var prop in b ) {\r\n    a[ prop ] = b[ prop ];\r\n  }\r\n  return a;\r\n}\r\n\r\n// turn element or nodeList into an array\r\nfunction makeArray( obj ) {\r\n  var ary = [];\r\n  if ( Array.isArray( obj ) ) {\r\n    // use object if already an array\r\n    ary = obj;\r\n  } else if ( typeof obj.length == 'number' ) {\r\n    // convert nodeList to array\r\n    for ( var i=0; i < obj.length; i++ ) {\r\n      ary.push( obj[i] );\r\n    }\r\n  } else {\r\n    // array of single index\r\n    ary.push( obj );\r\n  }\r\n  return ary;\r\n}\r\n\r\n// -------------------------- ngimagesLoaded -------------------------- //\r\n\r\n/**\r\n * @param {Array, Element, NodeList, String} elem\r\n * @param {Object or Function} options - if function, use as callback\r\n * @param {Function} onAlways - callback function\r\n */\r\nfunction ngImagesLoaded( elem, options, onAlways ) {\r\n  // coerce ngImagesLoaded() without new, to be new ngImagesLoaded()\r\n  if ( !( this instanceof ngImagesLoaded ) ) {\r\n    return new ngImagesLoaded( elem, options, onAlways );\r\n  }\r\n  // use elem as selector string\r\n  if ( typeof elem == 'string' ) {\r\n    elem = document.querySelectorAll( elem );\r\n  }\r\n\r\n  this.elements = makeArray( elem );\r\n  this.options = extend( {}, this.options );\r\n\r\n  if ( typeof options == 'function' ) {\r\n    onAlways = options;\r\n  } else {\r\n    extend( this.options, options );\r\n  }\r\n\r\n  if ( onAlways ) {\r\n    this.on( 'always', onAlways );\r\n  }\r\n\r\n  this.getImages();\r\n\r\n  if ( $ ) {\r\n    // add jQuery Deferred object\r\n    this.jqDeferred = new $.Deferred();\r\n  }\r\n\r\n  // HACK check async to allow time to bind listeners\r\n  setTimeout( function() {\r\n    this.check();\r\n  }.bind( this ));\r\n}\r\n\r\nngImagesLoaded.prototype = Object.create( ngEvEmitter.prototype );\r\n\r\nngImagesLoaded.prototype.options = {};\r\n\r\nngImagesLoaded.prototype.getImages = function() {\r\n  this.images = [];\r\n\r\n  // filter & find items if we have an item selector\r\n  this.elements.forEach( this.addElementImages, this );\r\n};\r\n\r\n/**\r\n * @param {Node} element\r\n */\r\nngImagesLoaded.prototype.addElementImages = function( elem ) {\r\n  // filter siblings\r\n  if ( elem.nodeName == 'IMG' ) {\r\n    this.addImage( elem );\r\n  }\r\n  // get background image on element\r\n  if ( this.options.background === true ) {\r\n    this.addElementBackgroundImages( elem );\r\n  }\r\n\r\n  // find children\r\n  // no non-element nodes, #143\r\n  var nodeType = elem.nodeType;\r\n  if ( !nodeType || !elementNodeTypes[ nodeType ] ) {\r\n    return;\r\n  }\r\n  var childImgs = elem.querySelectorAll('img');\r\n  // concat childElems to filterFound array\r\n  for ( var i=0; i < childImgs.length; i++ ) {\r\n    var img = childImgs[i];\r\n    this.addImage( img );\r\n  }\r\n\r\n  // get child background images\r\n  if ( typeof this.options.background == 'string' ) {\r\n    var children = elem.querySelectorAll( this.options.background );\r\n    for ( i=0; i < children.length; i++ ) {\r\n      var child = children[i];\r\n      this.addElementBackgroundImages( child );\r\n    }\r\n  }\r\n};\r\n\r\nvar elementNodeTypes = {\r\n  1: true,\r\n  9: true,\r\n  11: true\r\n};\r\n\r\nngImagesLoaded.prototype.addElementBackgroundImages = function( elem ) {\r\n  var style = getComputedStyle( elem );\r\n  if ( !style ) {\r\n    // Firefox returns null if in a hidden iframe https://bugzil.la/548397\r\n    return;\r\n  }\r\n  // get url inside url(\"...\")\r\n  var reURL = /url\\((['\"])?(.*?)\\1\\)/gi;\r\n  var matches = reURL.exec( style.backgroundImage );\r\n  while ( matches !== null ) {\r\n    var url = matches && matches[2];\r\n    if ( url ) {\r\n      this.addBackground( url, elem );\r\n    }\r\n    matches = reURL.exec( style.backgroundImage );\r\n  }\r\n};\r\n\r\n/**\r\n * @param {Image} img\r\n */\r\nngImagesLoaded.prototype.addImage = function( img ) {\r\n  var loadingImage = new LoadingImage( img );\r\n  this.images.push( loadingImage );\r\n};\r\n\r\nngImagesLoaded.prototype.addBackground = function( url, elem ) {\r\n  var background = new Background( url, elem );\r\n  this.images.push( background );\r\n};\r\n\r\nngImagesLoaded.prototype.check = function() {\r\n  var _this = this;\r\n  this.progressedCount = 0;\r\n  this.hasAnyBroken = false;\r\n  // complete if no images\r\n  if ( !this.images.length ) {\r\n    this.complete();\r\n    return;\r\n  }\r\n\r\n  function onProgress( image, elem, message ) {\r\n    // HACK - Chrome triggers event before object properties have changed. #83\r\n    setTimeout( function() {\r\n      _this.progress( image, elem, message );\r\n    });\r\n  }\r\n\r\n  this.images.forEach( function( loadingImage ) {\r\n    loadingImage.once( 'progress', onProgress );\r\n    loadingImage.check();\r\n  });\r\n};\r\n\r\nngImagesLoaded.prototype.progress = function( image, elem, message ) {\r\n  this.progressedCount++;\r\n  this.hasAnyBroken = this.hasAnyBroken || !image.isLoaded;\r\n  // progress event\r\n  this.emitEvent( 'progress', [ this, image, elem ] );\r\n  if ( this.jqDeferred && this.jqDeferred.notify ) {\r\n    this.jqDeferred.notify( this, image );\r\n  }\r\n  // check if completed\r\n  if ( this.progressedCount == this.images.length ) {\r\n    this.complete();\r\n  }\r\n\r\n  if ( this.options.debug && console ) {\r\n    console.log( 'progress: ' + message, image, elem );\r\n  }\r\n};\r\n\r\nngImagesLoaded.prototype.complete = function() {\r\n  var eventName = this.hasAnyBroken ? 'fail' : 'done';\r\n  this.isComplete = true;\r\n  this.emitEvent( eventName, [ this ] );\r\n  this.emitEvent( 'always', [ this ] );\r\n  if ( this.jqDeferred ) {\r\n    var jqMethod = this.hasAnyBroken ? 'reject' : 'resolve';\r\n    this.jqDeferred[ jqMethod ]( this );\r\n  }\r\n};\r\n\r\n// --------------------------  -------------------------- //\r\n\r\nfunction LoadingImage( img ) {\r\n  this.img = img;\r\n}\r\n\r\nLoadingImage.prototype = Object.create( ngEvEmitter.prototype );\r\n\r\nLoadingImage.prototype.check = function() {\r\n  // If complete is true and browser supports natural sizes,\r\n  // try to check for image status manually.\r\n  var isComplete = this.getIsImageComplete();\r\n  if ( isComplete ) {\r\n    // report based on naturalWidth\r\n    this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );\r\n    return;\r\n  }\r\n\r\n  // If none of the checks above matched, simulate loading on detached element.\r\n  this.proxyImage = new Image();\r\n  this.proxyImage.addEventListener( 'load', this );\r\n  this.proxyImage.addEventListener( 'error', this );\r\n  // bind to image as well for Firefox. #191\r\n  this.img.addEventListener( 'load', this );\r\n  this.img.addEventListener( 'error', this );\r\n  this.proxyImage.src = this.img.src;\r\n};\r\n\r\nLoadingImage.prototype.getIsImageComplete = function() {\r\n  return this.img.complete && this.img.naturalWidth !== undefined;\r\n};\r\n\r\nLoadingImage.prototype.confirm = function( isLoaded, message ) {\r\n  this.isLoaded = isLoaded;\r\n  this.emitEvent( 'progress', [ this, this.img, message ] );\r\n};\r\n\r\n// ----- events ----- //\r\n\r\n// trigger specified handler for event type\r\nLoadingImage.prototype.handleEvent = function( event ) {\r\n  var method = 'on' + event.type;\r\n  if ( this[ method ] ) {\r\n    this[ method ]( event );\r\n  }\r\n};\r\n\r\nLoadingImage.prototype.onload = function() {\r\n  this.confirm( true, 'onload' );\r\n  this.unbindEvents();\r\n};\r\n\r\nLoadingImage.prototype.onerror = function() {\r\n  this.confirm( false, 'onerror' );\r\n  this.unbindEvents();\r\n};\r\n\r\nLoadingImage.prototype.unbindEvents = function() {\r\n  this.proxyImage.removeEventListener( 'load', this );\r\n  this.proxyImage.removeEventListener( 'error', this );\r\n  this.img.removeEventListener( 'load', this );\r\n  this.img.removeEventListener( 'error', this );\r\n};\r\n\r\n// -------------------------- Background -------------------------- //\r\n\r\nfunction Background( url, element ) {\r\n  this.url = url;\r\n  this.element = element;\r\n  this.img = new Image();\r\n}\r\n\r\n// inherit LoadingImage prototype\r\nBackground.prototype = Object.create( LoadingImage.prototype );\r\n\r\nBackground.prototype.check = function() {\r\n  this.img.addEventListener( 'load', this );\r\n  this.img.addEventListener( 'error', this );\r\n  this.img.src = this.url;\r\n  // check if image is already complete\r\n  var isComplete = this.getIsImageComplete();\r\n  if ( isComplete ) {\r\n    this.confirm( this.img.naturalWidth !== 0, 'naturalWidth' );\r\n    this.unbindEvents();\r\n  }\r\n};\r\n\r\nBackground.prototype.unbindEvents = function() {\r\n  this.img.removeEventListener( 'load', this );\r\n  this.img.removeEventListener( 'error', this );\r\n};\r\n\r\nBackground.prototype.confirm = function( isLoaded, message ) {\r\n  this.isLoaded = isLoaded;\r\n  this.emitEvent( 'progress', [ this, this.element, message ] );\r\n};\r\n\r\n// -------------------------- jQuery -------------------------- //\r\n\r\nngImagesLoaded.makeJQueryPlugin = function( jQuery ) {\r\n  jQuery = jQuery || window.jQuery;\r\n  if ( !jQuery ) {\r\n    return;\r\n  }\r\n  // set local variable\r\n  $ = jQuery;\r\n  // $().ngimagesLoaded()\r\n  $.fn.ngimagesLoaded = function( options, callback ) {\r\n    var instance = new ngImagesLoaded( this, options, callback );\r\n    return instance.jqDeferred.promise( $(this) );\r\n  };\r\n};\r\n// try making plugin\r\nngImagesLoaded.makeJQueryPlugin();\r\n\r\n// --------------------------  -------------------------- //\r\n\r\nreturn ngImagesLoaded;\r\n\r\n});\r\n\r\n\r\n\r\n//##########################################################################################################################\r\n//## screenfull.js #########################################################################################################\r\n//##########################################################################################################################\r\n\r\n// screenfull.js\r\n// v4.0.1\r\n// by sindresorhus - https://github.com/sindresorhus\r\n// from: https://github.com/sindresorhus/screenfull.js\r\n\r\n// external module embeded in nanogallery\r\n// NGY BUILD:\r\n// replace \"screenfull\" with \"ngscreenfull\"\r\n// \r\n\r\n(function () {\r\n\t'use strict';\r\n\r\n\tvar document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\r\n\tvar isCommonjs = typeof module !== 'undefined' && module.exports;\r\n\tvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\r\n\r\n\tvar fn = (function () {\r\n\t\tvar val;\r\n\r\n\t\tvar fnMap = [\r\n\t\t\t[\r\n\t\t\t\t'requestFullscreen',\r\n\t\t\t\t'exitFullscreen',\r\n\t\t\t\t'fullscreenElement',\r\n\t\t\t\t'fullscreenEnabled',\r\n\t\t\t\t'fullscreenchange',\r\n\t\t\t\t'fullscreenerror'\r\n\t\t\t],\r\n\t\t\t// New WebKit\r\n\t\t\t[\r\n\t\t\t\t'webkitRequestFullscreen',\r\n\t\t\t\t'webkitExitFullscreen',\r\n\t\t\t\t'webkitFullscreenElement',\r\n\t\t\t\t'webkitFullscreenEnabled',\r\n\t\t\t\t'webkitfullscreenchange',\r\n\t\t\t\t'webkitfullscreenerror'\r\n\r\n\t\t\t],\r\n\t\t\t// Old WebKit (Safari 5.1)\r\n\t\t\t[\r\n\t\t\t\t'webkitRequestFullScreen',\r\n\t\t\t\t'webkitCancelFullScreen',\r\n\t\t\t\t'webkitCurrentFullScreenElement',\r\n\t\t\t\t'webkitCancelFullScreen',\r\n\t\t\t\t'webkitfullscreenchange',\r\n\t\t\t\t'webkitfullscreenerror'\r\n\r\n\t\t\t],\r\n\t\t\t[\r\n\t\t\t\t'mozRequestFullScreen',\r\n\t\t\t\t'mozCancelFullScreen',\r\n\t\t\t\t'mozFullScreenElement',\r\n\t\t\t\t'mozFullScreenEnabled',\r\n\t\t\t\t'mozfullscreenchange',\r\n\t\t\t\t'mozfullscreenerror'\r\n\t\t\t],\r\n\t\t\t[\r\n\t\t\t\t'msRequestFullscreen',\r\n\t\t\t\t'msExitFullscreen',\r\n\t\t\t\t'msFullscreenElement',\r\n\t\t\t\t'msFullscreenEnabled',\r\n\t\t\t\t'MSFullscreenChange',\r\n\t\t\t\t'MSFullscreenError'\r\n\t\t\t]\r\n\t\t];\r\n\r\n\t\tvar i = 0;\r\n\t\tvar l = fnMap.length;\r\n\t\tvar ret = {};\r\n\r\n\t\tfor (; i < l; i++) {\r\n\t\t\tval = fnMap[i];\r\n\t\t\tif (val && val[1] in document) {\r\n\t\t\t\tfor (i = 0; i < val.length; i++) {\r\n\t\t\t\t\tret[fnMap[0][i]] = val[i];\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t})();\r\n\r\n\tvar eventNameMap = {\r\n\t\tchange: fn.fullscreenchange,\r\n\t\terror: fn.fullscreenerror\r\n\t};\r\n\r\n\tvar ngscreenfull = {\r\n\t\trequest: function (elem) {\r\n\t\t\treturn new Promise(function (resolve) {\r\n\t\t\t\tvar request = fn.requestFullscreen;\r\n\r\n\t\t\t\tvar onFullScreenEntered = function () {\r\n\t\t\t\t\tthis.off('change', onFullScreenEntered);\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}.bind(this);\r\n\r\n\t\t\t\telem = elem || document.documentElement;\r\n\r\n\t\t\t\t// Work around Safari 5.1 bug: reports support for\r\n\t\t\t\t// keyboard in fullscreen even though it doesn't.\r\n\t\t\t\t// Browser sniffing, since the alternative with\r\n\t\t\t\t// setTimeout is even worse.\r\n\t\t\t\tif (/ Version\\/5\\.1(?:\\.\\d+)? Safari\\//.test(navigator.userAgent)) {\r\n\t\t\t\t\telem[request]();\r\n\t\t\t\t} else {\r\n\t\t\t\t\telem[request](keyboardAllowed ? Element.ALLOW_KEYBOARD_INPUT : {});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.on('change', onFullScreenEntered);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\texit: function () {\r\n\t\t\treturn new Promise(function (resolve) {\r\n\t\t\t\tif (!this.isFullscreen) {\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar onFullScreenExit = function () {\r\n\t\t\t\t\tthis.off('change', onFullScreenExit);\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}.bind(this);\r\n\r\n\t\t\t\tdocument[fn.exitFullscreen]();\r\n\r\n\t\t\t\tthis.on('change', onFullScreenExit);\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\t\ttoggle: function (elem) {\r\n\t\t\treturn this.isFullscreen ? this.exit() : this.request(elem);\r\n\t\t},\r\n\t\tonchange: function (callback) {\r\n\t\t\tthis.on('change', callback);\r\n\t\t},\r\n\t\tonerror: function (callback) {\r\n\t\t\tthis.on('error', callback);\r\n\t\t},\r\n\t\ton: function (event, callback) {\r\n\t\t\tvar eventName = eventNameMap[event];\r\n\t\t\tif (eventName) {\r\n\t\t\t\tdocument.addEventListener(eventName, callback, false);\r\n\t\t\t}\r\n\t\t},\r\n\t\toff: function (event, callback) {\r\n\t\t\tvar eventName = eventNameMap[event];\r\n\t\t\tif (eventName) {\r\n\t\t\t\tdocument.removeEventListener(eventName, callback, false);\r\n\t\t\t}\r\n\t\t},\r\n\t\traw: fn\r\n\t};\r\n\r\n\tif (!fn) {\r\n\t\tif (isCommonjs) {\r\n\t\t\tmodule.exports = false;\r\n\t\t} else {\r\n\t\t\twindow.ngscreenfull = false;\r\n\t\t}\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\tObject.defineProperties(ngscreenfull, {\r\n\t\tisFullscreen: {\r\n\t\t\tget: function () {\r\n\t\t\t\treturn Boolean(document[fn.fullscreenElement]);\r\n\t\t\t}\r\n\t\t},\r\n\t\telement: {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function () {\r\n\t\t\t\treturn document[fn.fullscreenElement];\r\n\t\t\t}\r\n\t\t},\r\n\t\tenabled: {\r\n\t\t\tenumerable: true,\r\n\t\t\tget: function () {\r\n\t\t\t\t// Coerce to boolean in case of old WebKit\r\n\t\t\t\treturn Boolean(document[fn.fullscreenEnabled]);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tif (isCommonjs) {\r\n\t\tmodule.exports = ngscreenfull;\r\n\t} else {\r\n\t\twindow.ngscreenfull = ngscreenfull;\r\n\t}\r\n})();\r\n\r\n\r\n  \r\n//##########################################################################################################################\r\n//## Shifty ################################################################################################################\r\n//##########################################################################################################################\r\n  \r\n /*!\r\n * Shifty\r\n * By Jeremy Kahn - jeremyckahn@gmail.com\r\n */\r\n\r\n// external module EMBEDED in nanogallery\r\n// NGY BUILD:\r\n// \r\n// replace \"Tweenable\" with \"NGTweenable\"\r\n// replace \"define.amd\" with \"define.amdDISABLED\"\r\n/* shifty - v1.5.3 - 2016-11-29 - http://jeremyckahn.github.io/shifty */\r\n;(function () {\r\n  var root = this || Function('return this')();\r\n\r\n/**\r\n * Shifty Core\r\n * By Jeremy Kahn - jeremyckahn@gmail.com\r\n */\r\n\r\nvar NGTweenable = (function () {\r\n\r\n  'use strict';\r\n\r\n  // Aliases that get defined later in this function\r\n  var formula;\r\n\r\n  // CONSTANTS\r\n  var DEFAULT_SCHEDULE_FUNCTION;\r\n  var DEFAULT_EASING = 'linear';\r\n  var DEFAULT_DURATION = 500;\r\n  var UPDATE_TIME = 1000 / 60;\r\n\r\n  var _now = Date.now\r\n       ? Date.now\r\n       : function () {return +new Date();};\r\n\r\n  var now = typeof SHIFTY_DEBUG_NOW !== 'undefined' ? SHIFTY_DEBUG_NOW : _now;\r\n\r\n  if (typeof window !== 'undefined') {\r\n    // requestAnimationFrame() shim by Paul Irish (modified for Shifty)\r\n    // http://paulirish.com/2011/requestanimationframe-for-smart-animating/\r\n    DEFAULT_SCHEDULE_FUNCTION = window.requestAnimationFrame\r\n       || window.webkitRequestAnimationFrame\r\n       || window.oRequestAnimationFrame\r\n       || window.msRequestAnimationFrame\r\n       || (window.mozCancelRequestAnimationFrame\r\n       && window.mozRequestAnimationFrame)\r\n       || setTimeout;\r\n  } else {\r\n    DEFAULT_SCHEDULE_FUNCTION = setTimeout;\r\n  }\r\n\r\n  function noop () {\r\n    // NOOP!\r\n  }\r\n\r\n  /**\r\n   * Handy shortcut for doing a for-in loop. This is not a \"normal\" each\r\n   * function, it is optimized for Shifty.  The iterator function only receives\r\n   * the property name, not the value.\r\n   * @param {Object} obj\r\n   * @param {Function(string)} fn\r\n   * @private\r\n   */\r\n  function each (obj, fn) {\r\n    var key;\r\n    for (key in obj) {\r\n      if (Object.hasOwnProperty.call(obj, key)) {\r\n        fn(key);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Perform a shallow copy of Object properties.\r\n   * @param {Object} targetObject The object to copy into\r\n   * @param {Object} srcObject The object to copy from\r\n   * @return {Object} A reference to the augmented `targetObj` Object\r\n   * @private\r\n   */\r\n  function shallowCopy (targetObj, srcObj) {\r\n    each(srcObj, function (prop) {\r\n      targetObj[prop] = srcObj[prop];\r\n    });\r\n\r\n    return targetObj;\r\n  }\r\n\r\n  /**\r\n   * Copies each property from src onto target, but only if the property to\r\n   * copy to target is undefined.\r\n   * @param {Object} target Missing properties in this Object are filled in\r\n   * @param {Object} src\r\n   * @private\r\n   */\r\n  function defaults (target, src) {\r\n    each(src, function (prop) {\r\n      if (typeof target[prop] === 'undefined') {\r\n        target[prop] = src[prop];\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Calculates the interpolated tween values of an Object for a given\r\n   * timestamp.\r\n   * @param {Number} forPosition The position to compute the state for.\r\n   * @param {Object} currentState Current state properties.\r\n   * @param {Object} originalState: The original state properties the Object is\r\n   * tweening from.\r\n   * @param {Object} targetState: The destination state properties the Object\r\n   * is tweening to.\r\n   * @param {number} duration: The length of the tween in milliseconds.\r\n   * @param {number} timestamp: The UNIX epoch time at which the tween began.\r\n   * @param {Object} easing: This Object's keys must correspond to the keys in\r\n   * targetState.\r\n   * @private\r\n   */\r\n  function tweenProps (forPosition, currentState, originalState, targetState,\r\n    duration, timestamp, easing) {\r\n    var normalizedPosition =\r\n        forPosition < timestamp ? 0 : (forPosition - timestamp) / duration;\r\n\r\n\r\n    var prop;\r\n    var easingObjectProp;\r\n    var easingFn;\r\n    for (prop in currentState) {\r\n      if (currentState.hasOwnProperty(prop)) {\r\n        easingObjectProp = easing[prop];\r\n        easingFn = typeof easingObjectProp === 'function'\r\n          ? easingObjectProp\r\n          : formula[easingObjectProp];\r\n\r\n        currentState[prop] = tweenProp(\r\n          originalState[prop],\r\n          targetState[prop],\r\n          easingFn,\r\n          normalizedPosition\r\n        );\r\n      }\r\n    }\r\n\r\n    return currentState;\r\n  }\r\n\r\n  /**\r\n   * Tweens a single property.\r\n   * @param {number} start The value that the tween started from.\r\n   * @param {number} end The value that the tween should end at.\r\n   * @param {Function} easingFunc The easing curve to apply to the tween.\r\n   * @param {number} position The normalized position (between 0.0 and 1.0) to\r\n   * calculate the midpoint of 'start' and 'end' against.\r\n   * @return {number} The tweened value.\r\n   * @private\r\n   */\r\n  function tweenProp (start, end, easingFunc, position) {\r\n    return start + (end - start) * easingFunc(position);\r\n  }\r\n\r\n  /**\r\n   * Applies a filter to NGTweenable instance.\r\n   * @param {NGTweenable} tweenable The `NGTweenable` instance to call the filter\r\n   * upon.\r\n   * @param {String} filterName The name of the filter to apply.\r\n   * @private\r\n   */\r\n  function applyFilter (tweenable, filterName) {\r\n    var filters = NGTweenable.prototype.filter;\r\n    var args = tweenable._filterArgs;\r\n\r\n    each(filters, function (name) {\r\n      if (typeof filters[name][filterName] !== 'undefined') {\r\n        filters[name][filterName].apply(tweenable, args);\r\n      }\r\n    });\r\n  }\r\n\r\n  var timeoutHandler_endTime;\r\n  var timeoutHandler_currentTime;\r\n  var timeoutHandler_isEnded;\r\n  var timeoutHandler_offset;\r\n  /**\r\n   * Handles the update logic for one step of a tween.\r\n   * @param {NGTweenable} tweenable\r\n   * @param {number} timestamp\r\n   * @param {number} delay\r\n   * @param {number} duration\r\n   * @param {Object} currentState\r\n   * @param {Object} originalState\r\n   * @param {Object} targetState\r\n   * @param {Object} easing\r\n   * @param {Function(Object, *, number)} step\r\n   * @param {Function(Function,number)}} schedule\r\n   * @param {number=} opt_currentTimeOverride Needed for accurate timestamp in\r\n   * NGTweenable#seek.\r\n   * @private\r\n   */\r\n  function timeoutHandler (tweenable, timestamp, delay, duration, currentState,\r\n    originalState, targetState, easing, step, schedule,\r\n    opt_currentTimeOverride) {\r\n\r\n    timeoutHandler_endTime = timestamp + delay + duration;\r\n\r\n    timeoutHandler_currentTime =\r\n    Math.min(opt_currentTimeOverride || now(), timeoutHandler_endTime);\r\n\r\n    timeoutHandler_isEnded =\r\n      timeoutHandler_currentTime >= timeoutHandler_endTime;\r\n\r\n    timeoutHandler_offset = duration - (\r\n      timeoutHandler_endTime - timeoutHandler_currentTime);\r\n\r\n    if (tweenable.isPlaying()) {\r\n      if (timeoutHandler_isEnded) {\r\n        step(targetState, tweenable._attachment, timeoutHandler_offset);\r\n        tweenable.stop(true);\r\n      } else {\r\n        tweenable._scheduleId =\r\n          schedule(tweenable._timeoutHandler, UPDATE_TIME);\r\n\r\n        applyFilter(tweenable, 'beforeTween');\r\n\r\n        // If the animation has not yet reached the start point (e.g., there was\r\n        // delay that has not yet completed), just interpolate the starting\r\n        // position of the tween.\r\n        if (timeoutHandler_currentTime < (timestamp + delay)) {\r\n          tweenProps(1, currentState, originalState, targetState, 1, 1, easing);\r\n        } else {\r\n          tweenProps(timeoutHandler_currentTime, currentState, originalState,\r\n            targetState, duration, timestamp + delay, easing);\r\n        }\r\n\r\n        applyFilter(tweenable, 'afterTween');\r\n\r\n        step(currentState, tweenable._attachment, timeoutHandler_offset);\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  /**\r\n   * Creates a usable easing Object from a string, a function or another easing\r\n   * Object.  If `easing` is an Object, then this function clones it and fills\r\n   * in the missing properties with `\"linear\"`.\r\n   * @param {Object.<string|Function>} fromTweenParams\r\n   * @param {Object|string|Function} easing\r\n   * @return {Object.<string|Function>}\r\n   * @private\r\n   */\r\n  function composeEasingObject (fromTweenParams, easing) {\r\n    var composedEasing = {};\r\n    var typeofEasing = typeof easing;\r\n\r\n    if (typeofEasing === 'string' || typeofEasing === 'function') {\r\n      each(fromTweenParams, function (prop) {\r\n        composedEasing[prop] = easing;\r\n      });\r\n    } else {\r\n      each(fromTweenParams, function (prop) {\r\n        if (!composedEasing[prop]) {\r\n          composedEasing[prop] = easing[prop] || DEFAULT_EASING;\r\n        }\r\n      });\r\n    }\r\n\r\n    return composedEasing;\r\n  }\r\n\r\n  /**\r\n   * NGTweenable constructor.\r\n   * @class NGTweenable\r\n   * @param {Object=} opt_initialState The values that the initial tween should\r\n   * start at if a `from` object is not provided to `{{#crossLink\r\n   * \"NGTweenable/tween:method\"}}{{/crossLink}}` or `{{#crossLink\r\n   * \"NGTweenable/setConfig:method\"}}{{/crossLink}}`.\r\n   * @param {Object=} opt_config Configuration object to be passed to\r\n   * `{{#crossLink \"NGTweenable/setConfig:method\"}}{{/crossLink}}`.\r\n   * @module NGTweenable\r\n   * @constructor\r\n   */\r\n  function NGTweenable (opt_initialState, opt_config) {\r\n    this._currentState = opt_initialState || {};\r\n    this._configured = false;\r\n    this._scheduleFunction = DEFAULT_SCHEDULE_FUNCTION;\r\n\r\n    // To prevent unnecessary calls to setConfig do not set default\r\n    // configuration here.  Only set default configuration immediately before\r\n    // tweening if none has been set.\r\n    if (typeof opt_config !== 'undefined') {\r\n      this.setConfig(opt_config);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Configure and start a tween.\r\n   * @method tween\r\n   * @param {Object=} opt_config Configuration object to be passed to\r\n   * `{{#crossLink \"NGTweenable/setConfig:method\"}}{{/crossLink}}`.\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.tween = function (opt_config) {\r\n    if (this._isTweening) {\r\n      return this;\r\n    }\r\n\r\n    // Only set default config if no configuration has been set previously and\r\n    // none is provided now.\r\n    if (opt_config !== undefined || !this._configured) {\r\n      this.setConfig(opt_config);\r\n    }\r\n\r\n    this._timestamp = now();\r\n    this._start(this.get(), this._attachment);\r\n    return this.resume();\r\n  };\r\n\r\n  /**\r\n   * Configure a tween that will start at some point in the future.\r\n   *\r\n   * @method setConfig\r\n   * @param {Object} config The following values are valid:\r\n   * - __from__ (_Object=_): Starting position.  If omitted, `{{#crossLink\r\n   *   \"NGTweenable/get:method\"}}get(){{/crossLink}}` is used.\r\n   * - __to__ (_Object=_): Ending position.\r\n   * - __duration__ (_number=_): How many milliseconds to animate for.\r\n   * - __delay__ (_delay=_): How many milliseconds to wait before starting the\r\n   *   tween.\r\n   * - __start__ (_Function(Object, *)_): Function to execute when the tween\r\n   *   begins.  Receives the state of the tween as the first parameter and\r\n   *   `attachment` as the second parameter.\r\n   * - __step__ (_Function(Object, *, number)_): Function to execute on every\r\n   *   tick.  Receives `{{#crossLink\r\n   *   \"NGTweenable/get:method\"}}get(){{/crossLink}}` as the first parameter,\r\n   *   `attachment` as the second parameter, and the time elapsed since the\r\n   *   start of the tween as the third. This function is not called on the\r\n   *   final step of the animation, but `finish` is.\r\n   * - __finish__ (_Function(Object, *)_): Function to execute upon tween\r\n   *   completion.  Receives the state of the tween as the first parameter and\r\n   *   `attachment` as the second parameter.\r\n   * - __easing__ (_Object.<string|Function>|string|Function=_): Easing curve\r\n   *   name(s) or function(s) to use for the tween.\r\n   * - __attachment__ (_*_): Cached value that is passed to the\r\n   *   `step`/`start`/`finish` methods.\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.setConfig = function (config) {\r\n    config = config || {};\r\n    this._configured = true;\r\n\r\n    // Attach something to this NGTweenable instance (e.g.: a DOM element, an\r\n    // object, a string, etc.);\r\n    this._attachment = config.attachment;\r\n\r\n    // Init the internal state\r\n    this._pausedAtTime = null;\r\n    this._scheduleId = null;\r\n    this._delay = config.delay || 0;\r\n    this._start = config.start || noop;\r\n    this._step = config.step || noop;\r\n    this._finish = config.finish || noop;\r\n    this._duration = config.duration || DEFAULT_DURATION;\r\n    this._currentState = shallowCopy({}, config.from || this.get());\r\n    this._originalState = this.get();\r\n    this._targetState = shallowCopy({}, config.to || this.get());\r\n\r\n    var self = this;\r\n    this._timeoutHandler = function () {\r\n      timeoutHandler(self,\r\n        self._timestamp,\r\n        self._delay,\r\n        self._duration,\r\n        self._currentState,\r\n        self._originalState,\r\n        self._targetState,\r\n        self._easing,\r\n        self._step,\r\n        self._scheduleFunction\r\n      );\r\n    };\r\n\r\n    // Aliases used below\r\n    var currentState = this._currentState;\r\n    var targetState = this._targetState;\r\n\r\n    // Ensure that there is always something to tween to.\r\n    defaults(targetState, currentState);\r\n\r\n    this._easing = composeEasingObject(\r\n      currentState, config.easing || DEFAULT_EASING);\r\n\r\n    this._filterArgs =\r\n      [currentState, this._originalState, targetState, this._easing];\r\n\r\n    applyFilter(this, 'tweenCreated');\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * @method get\r\n   * @return {Object} The current state.\r\n   */\r\n  NGTweenable.prototype.get = function () {\r\n    return shallowCopy({}, this._currentState);\r\n  };\r\n\r\n  /**\r\n   * @method set\r\n   * @param {Object} state The current state.\r\n   */\r\n  NGTweenable.prototype.set = function (state) {\r\n    this._currentState = state;\r\n  };\r\n\r\n  /**\r\n   * Pause a tween.  Paused tweens can be resumed from the point at which they\r\n   * were paused.  This is different from `{{#crossLink\r\n   * \"NGTweenable/stop:method\"}}{{/crossLink}}`, as that method\r\n   * causes a tween to start over when it is resumed.\r\n   * @method pause\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.pause = function () {\r\n    this._pausedAtTime = now();\r\n    this._isPaused = true;\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Resume a paused tween.\r\n   * @method resume\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.resume = function () {\r\n    if (this._isPaused) {\r\n      this._timestamp += now() - this._pausedAtTime;\r\n    }\r\n\r\n    this._isPaused = false;\r\n    this._isTweening = true;\r\n\r\n    this._timeoutHandler();\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Move the state of the animation to a specific point in the tween's\r\n   * timeline.  If the animation is not running, this will cause the `step`\r\n   * handlers to be called.\r\n   * @method seek\r\n   * @param {millisecond} millisecond The millisecond of the animation to seek\r\n   * to.  This must not be less than `0`.\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.seek = function (millisecond) {\r\n    millisecond = Math.max(millisecond, 0);\r\n    var currentTime = now();\r\n\r\n    if ((this._timestamp + millisecond) === 0) {\r\n      return this;\r\n    }\r\n\r\n    this._timestamp = currentTime - millisecond;\r\n\r\n    if (!this.isPlaying()) {\r\n      this._isTweening = true;\r\n      this._isPaused = false;\r\n\r\n      // If the animation is not running, call timeoutHandler to make sure that\r\n      // any step handlers are run.\r\n      timeoutHandler(this,\r\n        this._timestamp,\r\n        this._delay,\r\n        this._duration,\r\n        this._currentState,\r\n        this._originalState,\r\n        this._targetState,\r\n        this._easing,\r\n        this._step,\r\n        this._scheduleFunction,\r\n        currentTime\r\n      );\r\n\r\n      this.pause();\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * Stops and cancels a tween.\r\n   * @param {boolean=} gotoEnd If `false` or omitted, the tween just stops at\r\n   * its current state, and the `finish` handler is not invoked.  If `true`,\r\n   * the tweened object's values are instantly set to the target values, and\r\n   * `finish` is invoked.\r\n   * @method stop\r\n   * @chainable\r\n   */\r\n  NGTweenable.prototype.stop = function (gotoEnd) {\r\n    this._isTweening = false;\r\n    this._isPaused = false;\r\n    this._timeoutHandler = noop;\r\n\r\n    (root.cancelAnimationFrame            ||\r\n    root.webkitCancelAnimationFrame     ||\r\n    root.oCancelAnimationFrame          ||\r\n    root.msCancelAnimationFrame         ||\r\n    root.mozCancelRequestAnimationFrame ||\r\n    root.clearTimeout)(this._scheduleId);\r\n\r\n    if (gotoEnd) {\r\n      applyFilter(this, 'beforeTween');\r\n      tweenProps(\r\n        1,\r\n        this._currentState,\r\n        this._originalState,\r\n        this._targetState,\r\n        1,\r\n        0,\r\n        this._easing\r\n      );\r\n      applyFilter(this, 'afterTween');\r\n      applyFilter(this, 'afterTweenEnd');\r\n      this._finish.call(this, this._currentState, this._attachment);\r\n    }\r\n\r\n    return this;\r\n  };\r\n\r\n  /**\r\n   * @method isPlaying\r\n   * @return {boolean} Whether or not a tween is running.\r\n   */\r\n  NGTweenable.prototype.isPlaying = function () {\r\n    return this._isTweening && !this._isPaused;\r\n  };\r\n\r\n  /**\r\n   * Set a custom schedule function.\r\n   *\r\n   * If a custom function is not set,\r\n   * [`requestAnimationFrame`](https://developer.mozilla.org/en-US/docs/Web/API/window.requestAnimationFrame)\r\n   * is used if available, otherwise\r\n   * [`setTimeout`](https://developer.mozilla.org/en-US/docs/Web/API/Window.setTimeout)\r\n   * is used.\r\n   * @method setScheduleFunction\r\n   * @param {Function(Function,number)} scheduleFunction The function to be\r\n   * used to schedule the next frame to be rendered.\r\n   */\r\n  NGTweenable.prototype.setScheduleFunction = function (scheduleFunction) {\r\n    this._scheduleFunction = scheduleFunction;\r\n  };\r\n\r\n  /**\r\n   * `delete` all \"own\" properties.  Call this when the `NGTweenable` instance\r\n   * is no longer needed to free memory.\r\n   * @method dispose\r\n   */\r\n  NGTweenable.prototype.dispose = function () {\r\n    var prop;\r\n    for (prop in this) {\r\n      if (this.hasOwnProperty(prop)) {\r\n        delete this[prop];\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Filters are used for transforming the properties of a tween at various\r\n   * points in a NGTweenable's life cycle.  See the README for more info on this.\r\n   * @private\r\n   */\r\n  NGTweenable.prototype.filter = {};\r\n\r\n  /**\r\n   * This object contains all of the tweens available to Shifty.  It is\r\n   * extensible - simply attach properties to the `NGTweenable.prototype.formula`\r\n   * Object following the same format as `linear`.\r\n   *\r\n   * `pos` should be a normalized `number` (between 0 and 1).\r\n   * @property formula\r\n   * @type {Object(function)}\r\n   */\r\n  NGTweenable.prototype.formula = {\r\n    linear: function (pos) {\r\n      return pos;\r\n    }\r\n  };\r\n\r\n  formula = NGTweenable.prototype.formula;\r\n\r\n  shallowCopy(NGTweenable, {\r\n    'now': now\r\n    ,'each': each\r\n    ,'tweenProps': tweenProps\r\n    ,'tweenProp': tweenProp\r\n    ,'applyFilter': applyFilter\r\n    ,'shallowCopy': shallowCopy\r\n    ,'defaults': defaults\r\n    ,'composeEasingObject': composeEasingObject\r\n  });\r\n\r\n  // `root` is provided in the intro/outro files.\r\n\r\n  // A hook used for unit testing.\r\n  if (typeof SHIFTY_DEBUG_NOW === 'function') {\r\n    root.timeoutHandler = timeoutHandler;\r\n  }\r\n\r\n  // Bootstrap NGTweenable appropriately for the environment.\r\n  if (typeof exports === 'object') {\r\n    // CommonJS\r\n    module.exports = NGTweenable;\r\n  } else if ( true && __webpack_require__.amdD.amdDISABLED) {\r\n    // AMD\r\n    !(__WEBPACK_AMD_DEFINE_RESULT__ = (function () {return NGTweenable;}).call(exports, __webpack_require__, exports, module),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n  } else if (typeof root.NGTweenable === 'undefined') {\r\n    // Browser: Make `NGTweenable` globally accessible.\r\n    root.NGTweenable = NGTweenable;\r\n  }\r\n\r\n  return NGTweenable;\r\n\r\n} ());\r\n\r\n/*!\r\n * All equations are adapted from Thomas Fuchs'\r\n * [Scripty2](https://github.com/madrobby/scripty2/blob/master/src/effects/transitions/penner.js).\r\n *\r\n * Based on Easing Equations (c) 2003 [Robert\r\n * Penner](http://www.robertpenner.com/), all rights reserved. This work is\r\n * [subject to terms](http://www.robertpenner.com/easing_terms_of_use.html).\r\n */\r\n\r\n/*!\r\n *  TERMS OF USE - EASING EQUATIONS\r\n *  Open source under the BSD License.\r\n *  Easing Equations (c) 2003 Robert Penner, all rights reserved.\r\n */\r\n\r\n;(function () {\r\n\r\n  NGTweenable.shallowCopy(NGTweenable.prototype.formula, {\r\n    easeInQuad: function (pos) {\r\n      return Math.pow(pos, 2);\r\n    },\r\n\r\n    easeOutQuad: function (pos) {\r\n      return -(Math.pow((pos - 1), 2) - 1);\r\n    },\r\n\r\n    easeInOutQuad: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,2);}\r\n      return -0.5 * ((pos -= 2) * pos - 2);\r\n    },\r\n\r\n    easeInCubic: function (pos) {\r\n      return Math.pow(pos, 3);\r\n    },\r\n\r\n    easeOutCubic: function (pos) {\r\n      return (Math.pow((pos - 1), 3) + 1);\r\n    },\r\n\r\n    easeInOutCubic: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,3);}\r\n      return 0.5 * (Math.pow((pos - 2),3) + 2);\r\n    },\r\n\r\n    easeInQuart: function (pos) {\r\n      return Math.pow(pos, 4);\r\n    },\r\n\r\n    easeOutQuart: function (pos) {\r\n      return -(Math.pow((pos - 1), 4) - 1);\r\n    },\r\n\r\n    easeInOutQuart: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,4);}\r\n      return -0.5 * ((pos -= 2) * Math.pow(pos,3) - 2);\r\n    },\r\n\r\n    easeInQuint: function (pos) {\r\n      return Math.pow(pos, 5);\r\n    },\r\n\r\n    easeOutQuint: function (pos) {\r\n      return (Math.pow((pos - 1), 5) + 1);\r\n    },\r\n\r\n    easeInOutQuint: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,5);}\r\n      return 0.5 * (Math.pow((pos - 2),5) + 2);\r\n    },\r\n\r\n    easeInSine: function (pos) {\r\n      return -Math.cos(pos * (Math.PI / 2)) + 1;\r\n    },\r\n\r\n    easeOutSine: function (pos) {\r\n      return Math.sin(pos * (Math.PI / 2));\r\n    },\r\n\r\n    easeInOutSine: function (pos) {\r\n      return (-0.5 * (Math.cos(Math.PI * pos) - 1));\r\n    },\r\n\r\n    easeInExpo: function (pos) {\r\n      return (pos === 0) ? 0 : Math.pow(2, 10 * (pos - 1));\r\n    },\r\n\r\n    easeOutExpo: function (pos) {\r\n      return (pos === 1) ? 1 : -Math.pow(2, -10 * pos) + 1;\r\n    },\r\n\r\n    easeInOutExpo: function (pos) {\r\n      if (pos === 0) {return 0;}\r\n      if (pos === 1) {return 1;}\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(2,10 * (pos - 1));}\r\n      return 0.5 * (-Math.pow(2, -10 * --pos) + 2);\r\n    },\r\n\r\n    easeInCirc: function (pos) {\r\n      return -(Math.sqrt(1 - (pos * pos)) - 1);\r\n    },\r\n\r\n    easeOutCirc: function (pos) {\r\n      return Math.sqrt(1 - Math.pow((pos - 1), 2));\r\n    },\r\n\r\n    easeInOutCirc: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return -0.5 * (Math.sqrt(1 - pos * pos) - 1);}\r\n      return 0.5 * (Math.sqrt(1 - (pos -= 2) * pos) + 1);\r\n    },\r\n\r\n    easeOutBounce: function (pos) {\r\n      if ((pos) < (1 / 2.75)) {\r\n        return (7.5625 * pos * pos);\r\n      } else if (pos < (2 / 2.75)) {\r\n        return (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);\r\n      } else if (pos < (2.5 / 2.75)) {\r\n        return (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);\r\n      } else {\r\n        return (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);\r\n      }\r\n    },\r\n\r\n    easeInBack: function (pos) {\r\n      var s = 1.70158;\r\n      return (pos) * pos * ((s + 1) * pos - s);\r\n    },\r\n\r\n    easeOutBack: function (pos) {\r\n      var s = 1.70158;\r\n      return (pos = pos - 1) * pos * ((s + 1) * pos + s) + 1;\r\n    },\r\n\r\n    easeInOutBack: function (pos) {\r\n      var s = 1.70158;\r\n      if ((pos /= 0.5) < 1) {\r\n        return 0.5 * (pos * pos * (((s *= (1.525)) + 1) * pos - s));\r\n      }\r\n      return 0.5 * ((pos -= 2) * pos * (((s *= (1.525)) + 1) * pos + s) + 2);\r\n    },\r\n\r\n    elastic: function (pos) {\r\n      // jshint maxlen:90\r\n      return -1 * Math.pow(4,-8 * pos) * Math.sin((pos * 6 - 1) * (2 * Math.PI) / 2) + 1;\r\n    },\r\n\r\n    swingFromTo: function (pos) {\r\n      var s = 1.70158;\r\n      return ((pos /= 0.5) < 1) ?\r\n          0.5 * (pos * pos * (((s *= (1.525)) + 1) * pos - s)) :\r\n          0.5 * ((pos -= 2) * pos * (((s *= (1.525)) + 1) * pos + s) + 2);\r\n    },\r\n\r\n    swingFrom: function (pos) {\r\n      var s = 1.70158;\r\n      return pos * pos * ((s + 1) * pos - s);\r\n    },\r\n\r\n    swingTo: function (pos) {\r\n      var s = 1.70158;\r\n      return (pos -= 1) * pos * ((s + 1) * pos + s) + 1;\r\n    },\r\n\r\n    bounce: function (pos) {\r\n      if (pos < (1 / 2.75)) {\r\n        return (7.5625 * pos * pos);\r\n      } else if (pos < (2 / 2.75)) {\r\n        return (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);\r\n      } else if (pos < (2.5 / 2.75)) {\r\n        return (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);\r\n      } else {\r\n        return (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);\r\n      }\r\n    },\r\n\r\n    bouncePast: function (pos) {\r\n      if (pos < (1 / 2.75)) {\r\n        return (7.5625 * pos * pos);\r\n      } else if (pos < (2 / 2.75)) {\r\n        return 2 - (7.5625 * (pos -= (1.5 / 2.75)) * pos + 0.75);\r\n      } else if (pos < (2.5 / 2.75)) {\r\n        return 2 - (7.5625 * (pos -= (2.25 / 2.75)) * pos + 0.9375);\r\n      } else {\r\n        return 2 - (7.5625 * (pos -= (2.625 / 2.75)) * pos + 0.984375);\r\n      }\r\n    },\r\n\r\n    easeFromTo: function (pos) {\r\n      if ((pos /= 0.5) < 1) {return 0.5 * Math.pow(pos,4);}\r\n      return -0.5 * ((pos -= 2) * Math.pow(pos,3) - 2);\r\n    },\r\n\r\n    easeFrom: function (pos) {\r\n      return Math.pow(pos,4);\r\n    },\r\n\r\n    easeTo: function (pos) {\r\n      return Math.pow(pos,0.25);\r\n    }\r\n  });\r\n\r\n}());\r\n\r\n// jshint maxlen:100\r\n/**\r\n * The Bezier magic in this file is adapted/copied almost wholesale from\r\n * [Scripty2](https://github.com/madrobby/scripty2/blob/master/src/effects/transitions/cubic-bezier.js),\r\n * which was adapted from Apple code (which probably came from\r\n * [here](http://opensource.apple.com/source/WebCore/WebCore-955.66/platform/graphics/UnitBezier.h)).\r\n * Special thanks to Apple and Thomas Fuchs for much of this code.\r\n */\r\n\r\n/**\r\n *  Copyright (c) 2006 Apple Computer, Inc. All rights reserved.\r\n *\r\n *  Redistribution and use in source and binary forms, with or without\r\n *  modification, are permitted provided that the following conditions are met:\r\n *\r\n *  1. Redistributions of source code must retain the above copyright notice,\r\n *  this list of conditions and the following disclaimer.\r\n *\r\n *  2. Redistributions in binary form must reproduce the above copyright notice,\r\n *  this list of conditions and the following disclaimer in the documentation\r\n *  and/or other materials provided with the distribution.\r\n *\r\n *  3. Neither the name of the copyright holder(s) nor the names of any\r\n *  contributors may be used to endorse or promote products derived from\r\n *  this software without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\r\n *  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\r\n *  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\r\n *  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\r\n *  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\r\n *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\r\n *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\r\n *  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\r\n *  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\r\n *  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\r\n *  POSSIBILITY OF SUCH DAMAGE.\r\n */\r\n;(function () {\r\n  // port of webkit cubic bezier handling by http://www.netzgesta.de/dev/\r\n  function cubicBezierAtTime(t,p1x,p1y,p2x,p2y,duration) {\r\n    var ax = 0,bx = 0,cx = 0,ay = 0,by = 0,cy = 0;\r\n    function sampleCurveX(t) {\r\n      return ((ax * t + bx) * t + cx) * t;\r\n    }\r\n    function sampleCurveY(t) {\r\n      return ((ay * t + by) * t + cy) * t;\r\n    }\r\n    function sampleCurveDerivativeX(t) {\r\n      return (3.0 * ax * t + 2.0 * bx) * t + cx;\r\n    }\r\n    function solveEpsilon(duration) {\r\n      return 1.0 / (200.0 * duration);\r\n    }\r\n    function solve(x,epsilon) {\r\n      return sampleCurveY(solveCurveX(x, epsilon));\r\n    }\r\n    function fabs(n) {\r\n      if (n >= 0) {\r\n        return n;\r\n      } else {\r\n        return 0 - n;\r\n      }\r\n    }\r\n    function solveCurveX(x, epsilon) {\r\n      var t0,t1,t2,x2,d2,i;\r\n      for (t2 = x, i = 0; i < 8; i++) {\r\n        x2 = sampleCurveX(t2) - x;\r\n        if (fabs(x2) < epsilon) {\r\n          return t2;\r\n        }\r\n        d2 = sampleCurveDerivativeX(t2);\r\n        if (fabs(d2) < 1e-6) {\r\n          break;\r\n        }\r\n        t2 = t2 - x2 / d2;\r\n      }\r\n      t0 = 0.0;\r\n      t1 = 1.0;\r\n      t2 = x;\r\n      if (t2 < t0) {\r\n        return t0;\r\n      }\r\n      if (t2 > t1) {\r\n        return t1;\r\n      }\r\n      while (t0 < t1) {\r\n        x2 = sampleCurveX(t2);\r\n        if (fabs(x2 - x) < epsilon) {\r\n          return t2;\r\n        }\r\n        if (x > x2) {\r\n          t0 = t2;\r\n        }else {\r\n          t1 = t2;\r\n        }\r\n        t2 = (t1 - t0) * 0.5 + t0;\r\n      }\r\n      return t2; // Failure.\r\n    }\r\n    cx = 3.0 * p1x;\r\n    bx = 3.0 * (p2x - p1x) - cx;\r\n    ax = 1.0 - cx - bx;\r\n    cy = 3.0 * p1y;\r\n    by = 3.0 * (p2y - p1y) - cy;\r\n    ay = 1.0 - cy - by;\r\n    return solve(t, solveEpsilon(duration));\r\n  }\r\n  /**\r\n   *  getCubicBezierTransition(x1, y1, x2, y2) -> Function\r\n   *\r\n   *  Generates a transition easing function that is compatible\r\n   *  with WebKit's CSS transitions `-webkit-transition-timing-function`\r\n   *  CSS property.\r\n   *\r\n   *  The W3C has more information about CSS3 transition timing functions:\r\n   *  http://www.w3.org/TR/css3-transitions/#transition-timing-function_tag\r\n   *\r\n   *  @param {number} x1\r\n   *  @param {number} y1\r\n   *  @param {number} x2\r\n   *  @param {number} y2\r\n   *  @return {function}\r\n   *  @private\r\n   */\r\n  function getCubicBezierTransition (x1, y1, x2, y2) {\r\n    return function (pos) {\r\n      return cubicBezierAtTime(pos,x1,y1,x2,y2,1);\r\n    };\r\n  }\r\n  // End ported code\r\n\r\n  /**\r\n   * Create a Bezier easing function and attach it to `{{#crossLink\r\n   * \"NGTweenable/formula:property\"}}NGTweenable#formula{{/crossLink}}`.  This\r\n   * function gives you total control over the easing curve.  Matthew Lein's\r\n   * [Ceaser](http://matthewlein.com/ceaser/) is a useful tool for visualizing\r\n   * the curves you can make with this function.\r\n   * @method setBezierFunction\r\n   * @param {string} name The name of the easing curve.  Overwrites the old\r\n   * easing function on `{{#crossLink\r\n   * \"NGTweenable/formula:property\"}}NGTweenable#formula{{/crossLink}}` if it\r\n   * exists.\r\n   * @param {number} x1\r\n   * @param {number} y1\r\n   * @param {number} x2\r\n   * @param {number} y2\r\n   * @return {function} The easing function that was attached to\r\n   * NGTweenable.prototype.formula.\r\n   */\r\n  NGTweenable.setBezierFunction = function (name, x1, y1, x2, y2) {\r\n    var cubicBezierTransition = getCubicBezierTransition(x1, y1, x2, y2);\r\n    cubicBezierTransition.displayName = name;\r\n    cubicBezierTransition.x1 = x1;\r\n    cubicBezierTransition.y1 = y1;\r\n    cubicBezierTransition.x2 = x2;\r\n    cubicBezierTransition.y2 = y2;\r\n\r\n    return NGTweenable.prototype.formula[name] = cubicBezierTransition;\r\n  };\r\n\r\n\r\n  /**\r\n   * `delete` an easing function from `{{#crossLink\r\n   * \"NGTweenable/formula:property\"}}NGTweenable#formula{{/crossLink}}`.  Be\r\n   * careful with this method, as it `delete`s whatever easing formula matches\r\n   * `name` (which means you can delete standard Shifty easing functions).\r\n   * @method unsetBezierFunction\r\n   * @param {string} name The name of the easing function to delete.\r\n   * @return {function}\r\n   */\r\n  NGTweenable.unsetBezierFunction = function (name) {\r\n    delete NGTweenable.prototype.formula[name];\r\n  };\r\n\r\n})();\r\n\r\n;(function () {\r\n\r\n  function getInterpolatedValues (\r\n    from, current, targetState, position, easing, delay) {\r\n    return NGTweenable.tweenProps(\r\n      position, current, from, targetState, 1, delay, easing);\r\n  }\r\n\r\n  // Fake a NGTweenable and patch some internals.  This approach allows us to\r\n  // skip uneccessary processing and object recreation, cutting down on garbage\r\n  // collection pauses.\r\n  var mockNGTweenable = new NGTweenable();\r\n  mockNGTweenable._filterArgs = [];\r\n\r\n  /**\r\n   * Compute the midpoint of two Objects.  This method effectively calculates a\r\n   * specific frame of animation that `{{#crossLink\r\n   * \"NGTweenable/tween:method\"}}{{/crossLink}}` does many times over the course\r\n   * of a full tween.\r\n   *\r\n   *     var interpolatedValues = NGTweenable.interpolate({\r\n   *       width: '100px',\r\n   *       opacity: 0,\r\n   *       color: '#fff'\r\n   *     }, {\r\n   *       width: '200px',\r\n   *       opacity: 1,\r\n   *       color: '#000'\r\n   *     }, 0.5);\r\n   *\r\n   *     console.log(interpolatedValues);\r\n   *     // {opacity: 0.5, width: \"150px\", color: \"rgb(127,127,127)\"}\r\n   *\r\n   * @static\r\n   * @method interpolate\r\n   * @param {Object} from The starting values to tween from.\r\n   * @param {Object} targetState The ending values to tween to.\r\n   * @param {number} position The normalized position value (between `0.0` and\r\n   * `1.0`) to interpolate the values between `from` and `to` for.  `from`\r\n   * represents `0` and `to` represents `1`.\r\n   * @param {Object.<string|Function>|string|Function} easing The easing\r\n   * curve(s) to calculate the midpoint against.  You can reference any easing\r\n   * function attached to `NGTweenable.prototype.formula`, or provide the easing\r\n   * function(s) directly.  If omitted, this defaults to \"linear\".\r\n   * @param {number=} opt_delay Optional delay to pad the beginning of the\r\n   * interpolated tween with.  This increases the range of `position` from (`0`\r\n   * through `1`) to (`0` through `1 + opt_delay`).  So, a delay of `0.5` would\r\n   * increase all valid values of `position` to numbers between `0` and `1.5`.\r\n   * @return {Object}\r\n   */\r\n  NGTweenable.interpolate = function (\r\n    from, targetState, position, easing, opt_delay) {\r\n\r\n    var current = NGTweenable.shallowCopy({}, from);\r\n    var delay = opt_delay || 0;\r\n    var easingObject = NGTweenable.composeEasingObject(\r\n      from, easing || 'linear');\r\n\r\n    mockNGTweenable.set({});\r\n\r\n    // Alias and reuse the _filterArgs array instead of recreating it.\r\n    var filterArgs = mockNGTweenable._filterArgs;\r\n    filterArgs.length = 0;\r\n    filterArgs[0] = current;\r\n    filterArgs[1] = from;\r\n    filterArgs[2] = targetState;\r\n    filterArgs[3] = easingObject;\r\n\r\n    // Any defined value transformation must be applied\r\n    NGTweenable.applyFilter(mockNGTweenable, 'tweenCreated');\r\n    NGTweenable.applyFilter(mockNGTweenable, 'beforeTween');\r\n\r\n    var interpolatedValues = getInterpolatedValues(\r\n      from, current, targetState, position, easingObject, delay);\r\n\r\n    // Transform values back into their original format\r\n    NGTweenable.applyFilter(mockNGTweenable, 'afterTween');\r\n\r\n    return interpolatedValues;\r\n  };\r\n\r\n}());\r\n\r\n/**\r\n * This module adds string interpolation support to Shifty.\r\n *\r\n * The Token extension allows Shifty to tween numbers inside of strings.  Among\r\n * other things, this allows you to animate CSS properties.  For example, you\r\n * can do this:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { transform: 'translateX(45px)' },\r\n *       to: { transform: 'translateX(90xp)' }\r\n *     });\r\n *\r\n * `translateX(45)` will be tweened to `translateX(90)`.  To demonstrate:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { transform: 'translateX(45px)' },\r\n *       to: { transform: 'translateX(90px)' },\r\n *       step: function (state) {\r\n *         console.log(state.transform);\r\n *       }\r\n *     });\r\n *\r\n * The above snippet will log something like this in the console:\r\n *\r\n *     translateX(60.3px)\r\n *     ...\r\n *     translateX(76.05px)\r\n *     ...\r\n *     translateX(90px)\r\n *\r\n * Another use for this is animating colors:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { color: 'rgb(0,255,0)' },\r\n *       to: { color: 'rgb(255,0,255)' },\r\n *       step: function (state) {\r\n *         console.log(state.color);\r\n *       }\r\n *     });\r\n *\r\n * The above snippet will log something like this:\r\n *\r\n *     rgb(84,170,84)\r\n *     ...\r\n *     rgb(170,84,170)\r\n *     ...\r\n *     rgb(255,0,255)\r\n *\r\n * This extension also supports hexadecimal colors, in both long (`#ff00ff`)\r\n * and short (`#f0f`) forms.  Be aware that hexadecimal input values will be\r\n * converted into the equivalent RGB output values.  This is done to optimize\r\n * for performance.\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { color: '#0f0' },\r\n *       to: { color: '#f0f' },\r\n *       step: function (state) {\r\n *         console.log(state.color);\r\n *       }\r\n *     });\r\n *\r\n * This snippet will generate the same output as the one before it because\r\n * equivalent values were supplied (just in hexadecimal form rather than RGB):\r\n *\r\n *     rgb(84,170,84)\r\n *     ...\r\n *     rgb(170,84,170)\r\n *     ...\r\n *     rgb(255,0,255)\r\n *\r\n * ## Easing support\r\n *\r\n * Easing works somewhat differently in the Token extension.  This is because\r\n * some CSS properties have multiple values in them, and you might need to\r\n * tween each value along its own easing curve.  A basic example:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { transform: 'translateX(0px) translateY(0px)' },\r\n *       to: { transform:   'translateX(100px) translateY(100px)' },\r\n *       easing: { transform: 'easeInQuad' },\r\n *       step: function (state) {\r\n *         console.log(state.transform);\r\n *       }\r\n *     });\r\n *\r\n * The above snippet will create values like this:\r\n *\r\n *     translateX(11.56px) translateY(11.56px)\r\n *     ...\r\n *     translateX(46.24px) translateY(46.24px)\r\n *     ...\r\n *     translateX(100px) translateY(100px)\r\n *\r\n * In this case, the values for `translateX` and `translateY` are always the\r\n * same for each step of the tween, because they have the same start and end\r\n * points and both use the same easing curve.  We can also tween `translateX`\r\n * and `translateY` along independent curves:\r\n *\r\n *     var tweenable = new NGTweenable();\r\n *     tweenable.tween({\r\n *       from: { transform: 'translateX(0px) translateY(0px)' },\r\n *       to: { transform:   'translateX(100px) translateY(100px)' },\r\n *       easing: { transform: 'easeInQuad bounce' },\r\n *       step: function (state) {\r\n *         console.log(state.transform);\r\n *       }\r\n *     });\r\n *\r\n * The above snippet will create values like this:\r\n *\r\n *     translateX(10.89px) translateY(82.35px)\r\n *     ...\r\n *     translateX(44.89px) translateY(86.73px)\r\n *     ...\r\n *     translateX(100px) translateY(100px)\r\n *\r\n * `translateX` and `translateY` are not in sync anymore, because `easeInQuad`\r\n * was specified for `translateX` and `bounce` for `translateY`.  Mixing and\r\n * matching easing curves can make for some interesting motion in your\r\n * animations.\r\n *\r\n * The order of the space-separated easing curves correspond the token values\r\n * they apply to.  If there are more token values than easing curves listed,\r\n * the last easing curve listed is used.\r\n * @submodule NGTweenable.token\r\n */\r\n\r\n// token function is defined above only so that dox-foundation sees it as\r\n// documentation and renders it.  It is never used, and is optimized away at\r\n// build time.\r\n\r\n;(function (NGTweenable) {\r\n\r\n  /**\r\n   * @typedef {{\r\n   *   formatString: string\r\n   *   chunkNames: Array.<string>\r\n   * }}\r\n   * @private\r\n   */\r\n  var formatManifest;\r\n\r\n  // CONSTANTS\r\n\r\n  var R_NUMBER_COMPONENT = /(\\d|\\-|\\.)/;\r\n  var R_FORMAT_CHUNKS = /([^\\-0-9\\.]+)/g;\r\n  var R_UNFORMATTED_VALUES = /[0-9.\\-]+/g;\r\n  var R_RGB = new RegExp(\r\n    'rgb\\\\(' + R_UNFORMATTED_VALUES.source +\r\n    (/,\\s*/.source) + R_UNFORMATTED_VALUES.source +\r\n    (/,\\s*/.source) + R_UNFORMATTED_VALUES.source + '\\\\)', 'g');\r\n  var R_RGB_PREFIX = /^.*\\(/;\r\n  var R_HEX = /#([0-9]|[a-f]){3,6}/gi;\r\n  var VALUE_PLACEHOLDER = 'VAL';\r\n\r\n  // HELPERS\r\n\r\n  /**\r\n   * @param {Array.number} rawValues\r\n   * @param {string} prefix\r\n   *\r\n   * @return {Array.<string>}\r\n   * @private\r\n   */\r\n  function getFormatChunksFrom (rawValues, prefix) {\r\n    var accumulator = [];\r\n\r\n    var rawValuesLength = rawValues.length;\r\n    var i;\r\n\r\n    for (i = 0; i < rawValuesLength; i++) {\r\n      accumulator.push('_' + prefix + '_' + i);\r\n    }\r\n\r\n    return accumulator;\r\n  }\r\n\r\n  /**\r\n   * @param {string} formattedString\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function getFormatStringFrom (formattedString) {\r\n    var chunks = formattedString.match(R_FORMAT_CHUNKS);\r\n\r\n    if (!chunks) {\r\n      // chunks will be null if there were no tokens to parse in\r\n      // formattedString (for example, if formattedString is '2').  Coerce\r\n      // chunks to be useful here.\r\n      chunks = ['', ''];\r\n\r\n      // If there is only one chunk, assume that the string is a number\r\n      // followed by a token...\r\n      // NOTE: This may be an unwise assumption.\r\n    } else if (chunks.length === 1 ||\r\n      // ...or if the string starts with a number component (\".\", \"-\", or a\r\n      // digit)...\r\n    formattedString.charAt(0).match(R_NUMBER_COMPONENT)) {\r\n      // ...prepend an empty string here to make sure that the formatted number\r\n      // is properly replaced by VALUE_PLACEHOLDER\r\n      chunks.unshift('');\r\n    }\r\n\r\n    return chunks.join(VALUE_PLACEHOLDER);\r\n  }\r\n\r\n  /**\r\n   * Convert all hex color values within a string to an rgb string.\r\n   *\r\n   * @param {Object} stateObject\r\n   *\r\n   * @return {Object} The modified obj\r\n   * @private\r\n   */\r\n  function sanitizeObjectForHexProps (stateObject) {\r\n    NGTweenable.each(stateObject, function (prop) {\r\n      var currentProp = stateObject[prop];\r\n\r\n      if (typeof currentProp === 'string' && currentProp.match(R_HEX)) {\r\n        stateObject[prop] = sanitizeHexChunksToRGB(currentProp);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {string} str\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function  sanitizeHexChunksToRGB (str) {\r\n    return filterStringChunks(R_HEX, str, convertHexToRGB);\r\n  }\r\n\r\n  /**\r\n   * @param {string} hexString\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function convertHexToRGB (hexString) {\r\n    var rgbArr = hexToRGBArray(hexString);\r\n    return 'rgb(' + rgbArr[0] + ',' + rgbArr[1] + ',' + rgbArr[2] + ')';\r\n  }\r\n\r\n  var hexToRGBArray_returnArray = [];\r\n  /**\r\n   * Convert a hexadecimal string to an array with three items, one each for\r\n   * the red, blue, and green decimal values.\r\n   *\r\n   * @param {string} hex A hexadecimal string.\r\n   *\r\n   * @returns {Array.<number>} The converted Array of RGB values if `hex` is a\r\n   * valid string, or an Array of three 0's.\r\n   * @private\r\n   */\r\n  function hexToRGBArray (hex) {\r\n\r\n    hex = hex.replace(/#/, '');\r\n\r\n    // If the string is a shorthand three digit hex notation, normalize it to\r\n    // the standard six digit notation\r\n    if (hex.length === 3) {\r\n      hex = hex.split('');\r\n      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\r\n    }\r\n\r\n    hexToRGBArray_returnArray[0] = hexToDec(hex.substr(0, 2));\r\n    hexToRGBArray_returnArray[1] = hexToDec(hex.substr(2, 2));\r\n    hexToRGBArray_returnArray[2] = hexToDec(hex.substr(4, 2));\r\n\r\n    return hexToRGBArray_returnArray;\r\n  }\r\n\r\n  /**\r\n   * Convert a base-16 number to base-10.\r\n   *\r\n   * @param {Number|String} hex The value to convert\r\n   *\r\n   * @returns {Number} The base-10 equivalent of `hex`.\r\n   * @private\r\n   */\r\n  function hexToDec (hex) {\r\n    return parseInt(hex, 16);\r\n  }\r\n\r\n  /**\r\n   * Runs a filter operation on all chunks of a string that match a RegExp\r\n   *\r\n   * @param {RegExp} pattern\r\n   * @param {string} unfilteredString\r\n   * @param {function(string)} filter\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function filterStringChunks (pattern, unfilteredString, filter) {\r\n    var pattenMatches = unfilteredString.match(pattern);\r\n    var filteredString = unfilteredString.replace(pattern, VALUE_PLACEHOLDER);\r\n\r\n    if (pattenMatches) {\r\n      var pattenMatchesLength = pattenMatches.length;\r\n      var currentChunk;\r\n\r\n      for (var i = 0; i < pattenMatchesLength; i++) {\r\n        currentChunk = pattenMatches.shift();\r\n        filteredString = filteredString.replace(\r\n          VALUE_PLACEHOLDER, filter(currentChunk));\r\n      }\r\n    }\r\n\r\n    return filteredString;\r\n  }\r\n\r\n  /**\r\n   * Check for floating point values within rgb strings and rounds them.\r\n   *\r\n   * @param {string} formattedString\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function sanitizeRGBChunks (formattedString) {\r\n    return filterStringChunks(R_RGB, formattedString, sanitizeRGBChunk);\r\n  }\r\n\r\n  /**\r\n   * @param {string} rgbChunk\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function sanitizeRGBChunk (rgbChunk) {\r\n    var numbers = rgbChunk.match(R_UNFORMATTED_VALUES);\r\n    var numbersLength = numbers.length;\r\n    var sanitizedString = rgbChunk.match(R_RGB_PREFIX)[0];\r\n\r\n    for (var i = 0; i < numbersLength; i++) {\r\n      sanitizedString += parseInt(numbers[i], 10) + ',';\r\n    }\r\n\r\n    sanitizedString = sanitizedString.slice(0, -1) + ')';\r\n\r\n    return sanitizedString;\r\n  }\r\n\r\n  /**\r\n   * @param {Object} stateObject\r\n   *\r\n   * @return {Object} An Object of formatManifests that correspond to\r\n   * the string properties of stateObject\r\n   * @private\r\n   */\r\n  function getFormatManifests (stateObject) {\r\n    var manifestAccumulator = {};\r\n\r\n    NGTweenable.each(stateObject, function (prop) {\r\n      var currentProp = stateObject[prop];\r\n\r\n      if (typeof currentProp === 'string') {\r\n        var rawValues = getValuesFrom(currentProp);\r\n\r\n        manifestAccumulator[prop] = {\r\n          'formatString': getFormatStringFrom(currentProp)\r\n          ,'chunkNames': getFormatChunksFrom(rawValues, prop)\r\n        };\r\n      }\r\n    });\r\n\r\n    return manifestAccumulator;\r\n  }\r\n\r\n  /**\r\n   * @param {Object} stateObject\r\n   * @param {Object} formatManifests\r\n   * @private\r\n   */\r\n  function expandFormattedProperties (stateObject, formatManifests) {\r\n    NGTweenable.each(formatManifests, function (prop) {\r\n      var currentProp = stateObject[prop];\r\n      var rawValues = getValuesFrom(currentProp);\r\n      var rawValuesLength = rawValues.length;\r\n\r\n      for (var i = 0; i < rawValuesLength; i++) {\r\n        stateObject[formatManifests[prop].chunkNames[i]] = +rawValues[i];\r\n      }\r\n\r\n      delete stateObject[prop];\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Object} stateObject\r\n   * @param {Object} formatManifests\r\n   * @private\r\n   */\r\n  function collapseFormattedProperties (stateObject, formatManifests) {\r\n    NGTweenable.each(formatManifests, function (prop) {\r\n      var currentProp = stateObject[prop];\r\n      var formatChunks = extractPropertyChunks(\r\n        stateObject, formatManifests[prop].chunkNames);\r\n      var valuesList = getValuesList(\r\n        formatChunks, formatManifests[prop].chunkNames);\r\n      currentProp = getFormattedValues(\r\n        formatManifests[prop].formatString, valuesList);\r\n      stateObject[prop] = sanitizeRGBChunks(currentProp);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Object} stateObject\r\n   * @param {Array.<string>} chunkNames\r\n   *\r\n   * @return {Object} The extracted value chunks.\r\n   * @private\r\n   */\r\n  function extractPropertyChunks (stateObject, chunkNames) {\r\n    var extractedValues = {};\r\n    var currentChunkName, chunkNamesLength = chunkNames.length;\r\n\r\n    for (var i = 0; i < chunkNamesLength; i++) {\r\n      currentChunkName = chunkNames[i];\r\n      extractedValues[currentChunkName] = stateObject[currentChunkName];\r\n      delete stateObject[currentChunkName];\r\n    }\r\n\r\n    return extractedValues;\r\n  }\r\n\r\n  var getValuesList_accumulator = [];\r\n  /**\r\n   * @param {Object} stateObject\r\n   * @param {Array.<string>} chunkNames\r\n   *\r\n   * @return {Array.<number>}\r\n   * @private\r\n   */\r\n  function getValuesList (stateObject, chunkNames) {\r\n    getValuesList_accumulator.length = 0;\r\n    var chunkNamesLength = chunkNames.length;\r\n\r\n    for (var i = 0; i < chunkNamesLength; i++) {\r\n      getValuesList_accumulator.push(stateObject[chunkNames[i]]);\r\n    }\r\n\r\n    return getValuesList_accumulator;\r\n  }\r\n\r\n  /**\r\n   * @param {string} formatString\r\n   * @param {Array.<number>} rawValues\r\n   *\r\n   * @return {string}\r\n   * @private\r\n   */\r\n  function getFormattedValues (formatString, rawValues) {\r\n    var formattedValueString = formatString;\r\n    var rawValuesLength = rawValues.length;\r\n\r\n    for (var i = 0; i < rawValuesLength; i++) {\r\n      formattedValueString = formattedValueString.replace(\r\n        VALUE_PLACEHOLDER, +rawValues[i].toFixed(4));\r\n    }\r\n\r\n    return formattedValueString;\r\n  }\r\n\r\n  /**\r\n   * Note: It's the duty of the caller to convert the Array elements of the\r\n   * return value into numbers.  This is a performance optimization.\r\n   *\r\n   * @param {string} formattedString\r\n   *\r\n   * @return {Array.<string>|null}\r\n   * @private\r\n   */\r\n  function getValuesFrom (formattedString) {\r\n    return formattedString.match(R_UNFORMATTED_VALUES);\r\n  }\r\n\r\n  /**\r\n   * @param {Object} easingObject\r\n   * @param {Object} tokenData\r\n   * @private\r\n   */\r\n  function expandEasingObject (easingObject, tokenData) {\r\n    NGTweenable.each(tokenData, function (prop) {\r\n      var currentProp = tokenData[prop];\r\n      var chunkNames = currentProp.chunkNames;\r\n      var chunkLength = chunkNames.length;\r\n\r\n      var easing = easingObject[prop];\r\n      var i;\r\n\r\n      if (typeof easing === 'string') {\r\n        var easingChunks = easing.split(' ');\r\n        var lastEasingChunk = easingChunks[easingChunks.length - 1];\r\n\r\n        for (i = 0; i < chunkLength; i++) {\r\n          easingObject[chunkNames[i]] = easingChunks[i] || lastEasingChunk;\r\n        }\r\n\r\n      } else {\r\n        for (i = 0; i < chunkLength; i++) {\r\n          easingObject[chunkNames[i]] = easing;\r\n        }\r\n      }\r\n\r\n      delete easingObject[prop];\r\n    });\r\n  }\r\n\r\n  /**\r\n   * @param {Object} easingObject\r\n   * @param {Object} tokenData\r\n   * @private\r\n   */\r\n  function collapseEasingObject (easingObject, tokenData) {\r\n    NGTweenable.each(tokenData, function (prop) {\r\n      var currentProp = tokenData[prop];\r\n      var chunkNames = currentProp.chunkNames;\r\n      var chunkLength = chunkNames.length;\r\n\r\n      var firstEasing = easingObject[chunkNames[0]];\r\n      var typeofEasings = typeof firstEasing;\r\n\r\n      if (typeofEasings === 'string') {\r\n        var composedEasingString = '';\r\n\r\n        for (var i = 0; i < chunkLength; i++) {\r\n          composedEasingString += ' ' + easingObject[chunkNames[i]];\r\n          delete easingObject[chunkNames[i]];\r\n        }\r\n\r\n        easingObject[prop] = composedEasingString.substr(1);\r\n      } else {\r\n        easingObject[prop] = firstEasing;\r\n      }\r\n    });\r\n  }\r\n\r\n  NGTweenable.prototype.filter.token = {\r\n    'tweenCreated': function (currentState, fromState, toState, easingObject) {\r\n      sanitizeObjectForHexProps(currentState);\r\n      sanitizeObjectForHexProps(fromState);\r\n      sanitizeObjectForHexProps(toState);\r\n      this._tokenData = getFormatManifests(currentState);\r\n    },\r\n\r\n    'beforeTween': function (currentState, fromState, toState, easingObject) {\r\n      expandEasingObject(easingObject, this._tokenData);\r\n      expandFormattedProperties(currentState, this._tokenData);\r\n      expandFormattedProperties(fromState, this._tokenData);\r\n      expandFormattedProperties(toState, this._tokenData);\r\n    },\r\n\r\n    'afterTween': function (currentState, fromState, toState, easingObject) {\r\n      collapseFormattedProperties(currentState, this._tokenData);\r\n      collapseFormattedProperties(fromState, this._tokenData);\r\n      collapseFormattedProperties(toState, this._tokenData);\r\n      collapseEasingObject(easingObject, this._tokenData);\r\n    }\r\n  };\r\n\r\n} (NGTweenable));\r\n\r\n}).call(null);\r\n\r\n\r\n\r\n\r\n//##########################################################################################################################\r\n//## HAMMER.JS #############################################################################################################\r\n//##########################################################################################################################\r\n\r\n// HAMMER.JS\r\n\r\n// external module EMBEDED in nanogallery\r\n// NGY BUILD:\r\n// replace \"Hammer\" with \"NGHammer\" (case sensitive)\r\n// replace \"var SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\" with \"var SUPPORT_POINTER_EVENTS = false;\"\r\n// replace \"define.amd\" with \"define.amdDISABLED\"\r\n\r\n\r\n\r\n/*! NGHammer.JS - v2.0.7 - 2016-04-22\r\n * http://hammerjs.github.io/\r\n *\r\n * Copyright (c) 2016 Jorik Tangelder;\r\n * Licensed under the MIT license */\r\n(function(window, document, exportName, undefined) {\r\n  'use strict';\r\n\r\nvar VENDOR_PREFIXES = ['', 'webkit', 'Moz', 'MS', 'ms', 'o'];\r\nvar TEST_ELEMENT = document.createElement('div');\r\n\r\nvar TYPE_FUNCTION = 'function';\r\n\r\nvar round = Math.round;\r\nvar abs = Math.abs;\r\nvar now = Date.now;\r\n\r\n/**\r\n * set a timeout with a given scope\r\n * @param {Function} fn\r\n * @param {Number} timeout\r\n * @param {Object} context\r\n * @returns {number}\r\n */\r\nfunction setTimeoutContext(fn, timeout, context) {\r\n    return setTimeout(bindFn(fn, context), timeout);\r\n}\r\n\r\n/**\r\n * if the argument is an array, we want to execute the fn on each entry\r\n * if it aint an array we don't want to do a thing.\r\n * this is used by all the methods that accept a single and array argument.\r\n * @param {*|Array} arg\r\n * @param {String} fn\r\n * @param {Object} [context]\r\n * @returns {Boolean}\r\n */\r\nfunction invokeArrayArg(arg, fn, context) {\r\n    if (Array.isArray(arg)) {\r\n        each(arg, context[fn], context);\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * walk objects and arrays\r\n * @param {Object} obj\r\n * @param {Function} iterator\r\n * @param {Object} context\r\n */\r\nfunction each(obj, iterator, context) {\r\n    var i;\r\n\r\n    if (!obj) {\r\n        return;\r\n    }\r\n\r\n    if (obj.forEach) {\r\n        obj.forEach(iterator, context);\r\n    } else if (obj.length !== undefined) {\r\n        i = 0;\r\n        while (i < obj.length) {\r\n            iterator.call(context, obj[i], i, obj);\r\n            i++;\r\n        }\r\n    } else {\r\n        for (i in obj) {\r\n            obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * wrap a method with a deprecation warning and stack trace\r\n * @param {Function} method\r\n * @param {String} name\r\n * @param {String} message\r\n * @returns {Function} A new function wrapping the supplied method.\r\n */\r\nfunction deprecate(method, name, message) {\r\n    var deprecationMessage = 'DEPRECATED METHOD: ' + name + '\\n' + message + ' AT \\n';\r\n    return function() {\r\n        var e = new Error('get-stack-trace');\r\n        var stack = e && e.stack ? e.stack.replace(/^[^\\(]+?[\\n$]/gm, '')\r\n            .replace(/^\\s+at\\s+/gm, '')\r\n            .replace(/^Object.<anonymous>\\s*\\(/gm, '{anonymous}()@') : 'Unknown Stack Trace';\r\n\r\n        var log = window.console && (window.console.warn || window.console.log);\r\n        if (log) {\r\n            log.call(window.console, deprecationMessage, stack);\r\n        }\r\n        return method.apply(this, arguments);\r\n    };\r\n}\r\n\r\n/**\r\n * extend object.\r\n * means that properties in dest will be overwritten by the ones in src.\r\n * @param {Object} target\r\n * @param {...Object} objects_to_assign\r\n * @returns {Object} target\r\n */\r\nvar assign;\r\nif (typeof Object.assign !== 'function') {\r\n    assign = function assign(target) {\r\n        if (target === undefined || target === null) {\r\n            throw new TypeError('Cannot convert undefined or null to object');\r\n        }\r\n\r\n        var output = Object(target);\r\n        for (var index = 1; index < arguments.length; index++) {\r\n            var source = arguments[index];\r\n            if (source !== undefined && source !== null) {\r\n                for (var nextKey in source) {\r\n                    if (source.hasOwnProperty(nextKey)) {\r\n                        output[nextKey] = source[nextKey];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return output;\r\n    };\r\n} else {\r\n    assign = Object.assign;\r\n}\r\n\r\n/**\r\n * extend object.\r\n * means that properties in dest will be overwritten by the ones in src.\r\n * @param {Object} dest\r\n * @param {Object} src\r\n * @param {Boolean} [merge=false]\r\n * @returns {Object} dest\r\n */\r\nvar extend = deprecate(function extend(dest, src, merge) {\r\n    var keys = Object.keys(src);\r\n    var i = 0;\r\n    while (i < keys.length) {\r\n        if (!merge || (merge && dest[keys[i]] === undefined)) {\r\n            dest[keys[i]] = src[keys[i]];\r\n        }\r\n        i++;\r\n    }\r\n    return dest;\r\n}, 'extend', 'Use `assign`.');\r\n\r\n/**\r\n * merge the values from src in the dest.\r\n * means that properties that exist in dest will not be overwritten by src\r\n * @param {Object} dest\r\n * @param {Object} src\r\n * @returns {Object} dest\r\n */\r\nvar merge = deprecate(function merge(dest, src) {\r\n    return extend(dest, src, true);\r\n}, 'merge', 'Use `assign`.');\r\n\r\n/**\r\n * simple class inheritance\r\n * @param {Function} child\r\n * @param {Function} base\r\n * @param {Object} [properties]\r\n */\r\nfunction inherit(child, base, properties) {\r\n    var baseP = base.prototype,\r\n        childP;\r\n\r\n    childP = child.prototype = Object.create(baseP);\r\n    childP.constructor = child;\r\n    childP._super = baseP;\r\n\r\n    if (properties) {\r\n        assign(childP, properties);\r\n    }\r\n}\r\n\r\n/**\r\n * simple function bind\r\n * @param {Function} fn\r\n * @param {Object} context\r\n * @returns {Function}\r\n */\r\nfunction bindFn(fn, context) {\r\n    return function boundFn() {\r\n        return fn.apply(context, arguments);\r\n    };\r\n}\r\n\r\n/**\r\n * let a boolean value also be a function that must return a boolean\r\n * this first item in args will be used as the context\r\n * @param {Boolean|Function} val\r\n * @param {Array} [args]\r\n * @returns {Boolean}\r\n */\r\nfunction boolOrFn(val, args) {\r\n    if (typeof val == TYPE_FUNCTION) {\r\n        return val.apply(args ? args[0] || undefined : undefined, args);\r\n    }\r\n    return val;\r\n}\r\n\r\n/**\r\n * use the val2 when val1 is undefined\r\n * @param {*} val1\r\n * @param {*} val2\r\n * @returns {*}\r\n */\r\nfunction ifUndefined(val1, val2) {\r\n    return (val1 === undefined) ? val2 : val1;\r\n}\r\n\r\n/**\r\n * addEventListener with multiple events at once\r\n * @param {EventTarget} target\r\n * @param {String} types\r\n * @param {Function} handler\r\n */\r\nfunction addEventListeners(target, types, handler) {\r\n    each(splitStr(types), function(type) {\r\n        target.addEventListener(type, handler, false);\r\n    });\r\n}\r\n\r\n/**\r\n * removeEventListener with multiple events at once\r\n * @param {EventTarget} target\r\n * @param {String} types\r\n * @param {Function} handler\r\n */\r\nfunction removeEventListeners(target, types, handler) {\r\n    each(splitStr(types), function(type) {\r\n        target.removeEventListener(type, handler, false);\r\n    });\r\n}\r\n\r\n/**\r\n * find if a node is in the given parent\r\n * @method hasParent\r\n * @param {HTMLElement} node\r\n * @param {HTMLElement} parent\r\n * @return {Boolean} found\r\n */\r\nfunction hasParent(node, parent) {\r\n    while (node) {\r\n        if (node == parent) {\r\n            return true;\r\n        }\r\n        node = node.parentNode;\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * small indexOf wrapper\r\n * @param {String} str\r\n * @param {String} find\r\n * @returns {Boolean} found\r\n */\r\nfunction inStr(str, find) {\r\n    return str.indexOf(find) > -1;\r\n}\r\n\r\n/**\r\n * split string on whitespace\r\n * @param {String} str\r\n * @returns {Array} words\r\n */\r\nfunction splitStr(str) {\r\n    return str.trim().split(/\\s+/g);\r\n}\r\n\r\n/**\r\n * find if a array contains the object using indexOf or a simple polyFill\r\n * @param {Array} src\r\n * @param {String} find\r\n * @param {String} [findByKey]\r\n * @return {Boolean|Number} false when not found, or the index\r\n */\r\nfunction inArray(src, find, findByKey) {\r\n    if (src.indexOf && !findByKey) {\r\n        return src.indexOf(find);\r\n    } else {\r\n        var i = 0;\r\n        while (i < src.length) {\r\n            if ((findByKey && src[i][findByKey] == find) || (!findByKey && src[i] === find)) {\r\n                return i;\r\n            }\r\n            i++;\r\n        }\r\n        return -1;\r\n    }\r\n}\r\n\r\n/**\r\n * convert array-like objects to real arrays\r\n * @param {Object} obj\r\n * @returns {Array}\r\n */\r\nfunction toArray(obj) {\r\n    return Array.prototype.slice.call(obj, 0);\r\n}\r\n\r\n/**\r\n * unique array with objects based on a key (like 'id') or just by the array's value\r\n * @param {Array} src [{id:1},{id:2},{id:1}]\r\n * @param {String} [key]\r\n * @param {Boolean} [sort=False]\r\n * @returns {Array} [{id:1},{id:2}]\r\n */\r\nfunction uniqueArray(src, key, sort) {\r\n    var results = [];\r\n    var values = [];\r\n    var i = 0;\r\n\r\n    while (i < src.length) {\r\n        var val = key ? src[i][key] : src[i];\r\n        if (inArray(values, val) < 0) {\r\n            results.push(src[i]);\r\n        }\r\n        values[i] = val;\r\n        i++;\r\n    }\r\n\r\n    if (sort) {\r\n        if (!key) {\r\n            results = results.sort();\r\n        } else {\r\n            results = results.sort(function sortUniqueArray(a, b) {\r\n                return a[key] > b[key];\r\n            });\r\n        }\r\n    }\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * get the prefixed property\r\n * @param {Object} obj\r\n * @param {String} property\r\n * @returns {String|Undefined} prefixed\r\n */\r\nfunction prefixed(obj, property) {\r\n    var prefix, prop;\r\n    var camelProp = property[0].toUpperCase() + property.slice(1);\r\n\r\n    var i = 0;\r\n    while (i < VENDOR_PREFIXES.length) {\r\n        prefix = VENDOR_PREFIXES[i];\r\n        prop = (prefix) ? prefix + camelProp : property;\r\n\r\n        if (prop in obj) {\r\n            return prop;\r\n        }\r\n        i++;\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * get a unique id\r\n * @returns {number} uniqueId\r\n */\r\nvar _uniqueId = 1;\r\nfunction uniqueId() {\r\n    return _uniqueId++;\r\n}\r\n\r\n/**\r\n * get the window object of an element\r\n * @param {HTMLElement} element\r\n * @returns {DocumentView|Window}\r\n */\r\nfunction getWindowForElement(element) {\r\n    var doc = element.ownerDocument || element;\r\n    return (doc.defaultView || doc.parentWindow || window);\r\n}\r\n\r\nvar MOBILE_REGEX = /mobile|tablet|ip(ad|hone|od)|android/i;\r\n\r\nvar SUPPORT_TOUCH = ('ontouchstart' in window);\r\n// var SUPPORT_POINTER_EVENTS = prefixed(window, 'PointerEvent') !== undefined;\r\nvar SUPPORT_POINTER_EVENTS = false;\r\nvar SUPPORT_ONLY_TOUCH = SUPPORT_TOUCH && MOBILE_REGEX.test(navigator.userAgent);\r\n\r\nvar INPUT_TYPE_TOUCH = 'touch';\r\nvar INPUT_TYPE_PEN = 'pen';\r\nvar INPUT_TYPE_MOUSE = 'mouse';\r\nvar INPUT_TYPE_KINECT = 'kinect';\r\n\r\nvar COMPUTE_INTERVAL = 25;\r\n\r\nvar INPUT_START = 1;\r\nvar INPUT_MOVE = 2;\r\nvar INPUT_END = 4;\r\nvar INPUT_CANCEL = 8;\r\n\r\nvar DIRECTION_NONE = 1;\r\nvar DIRECTION_LEFT = 2;\r\nvar DIRECTION_RIGHT = 4;\r\nvar DIRECTION_UP = 8;\r\nvar DIRECTION_DOWN = 16;\r\n\r\nvar DIRECTION_HORIZONTAL = DIRECTION_LEFT | DIRECTION_RIGHT;\r\nvar DIRECTION_VERTICAL = DIRECTION_UP | DIRECTION_DOWN;\r\nvar DIRECTION_ALL = DIRECTION_HORIZONTAL | DIRECTION_VERTICAL;\r\n\r\nvar PROPS_XY = ['x', 'y'];\r\nvar PROPS_CLIENT_XY = ['clientX', 'clientY'];\r\n\r\n/**\r\n * create new input type manager\r\n * @param {Manager} manager\r\n * @param {Function} callback\r\n * @returns {Input}\r\n * @constructor\r\n */\r\nfunction Input(manager, callback) {\r\n    var self = this;\r\n    this.manager = manager;\r\n    this.callback = callback;\r\n    this.element = manager.element;\r\n    this.target = manager.options.inputTarget;\r\n\r\n    // smaller wrapper around the handler, for the scope and the enabled state of the manager,\r\n    // so when disabled the input events are completely bypassed.\r\n    this.domHandler = function(ev) {\r\n        if (boolOrFn(manager.options.enable, [manager])) {\r\n            self.handler(ev);\r\n        }\r\n    };\r\n\r\n    this.init();\r\n\r\n}\r\n\r\nInput.prototype = {\r\n    /**\r\n     * should handle the inputEvent data and trigger the callback\r\n     * @virtual\r\n     */\r\n    handler: function() { },\r\n\r\n    /**\r\n     * bind the events\r\n     */\r\n    init: function() {\r\n        this.evEl && addEventListeners(this.element, this.evEl, this.domHandler);\r\n        this.evTarget && addEventListeners(this.target, this.evTarget, this.domHandler);\r\n        this.evWin && addEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\r\n    },\r\n\r\n    /**\r\n     * unbind the events\r\n     */\r\n    destroy: function() {\r\n        this.evEl && removeEventListeners(this.element, this.evEl, this.domHandler);\r\n        this.evTarget && removeEventListeners(this.target, this.evTarget, this.domHandler);\r\n        this.evWin && removeEventListeners(getWindowForElement(this.element), this.evWin, this.domHandler);\r\n    }\r\n};\r\n\r\n/**\r\n * create new input type manager\r\n * called by the Manager constructor\r\n * @param {NGHammer} manager\r\n * @returns {Input}\r\n */\r\nfunction createInputInstance(manager) {\r\n    var Type;\r\n    var inputClass = manager.options.inputClass;\r\n\r\n    if (inputClass) {\r\n        Type = inputClass;\r\n    } else if (SUPPORT_POINTER_EVENTS) {\r\n        Type = PointerEventInput;\r\n    } else if (SUPPORT_ONLY_TOUCH) {\r\n        Type = TouchInput;\r\n    } else if (!SUPPORT_TOUCH) {\r\n        Type = MouseInput;\r\n    } else {\r\n        Type = TouchMouseInput;\r\n    }\r\n    return new (Type)(manager, inputHandler);\r\n}\r\n\r\n/**\r\n * handle input events\r\n * @param {Manager} manager\r\n * @param {String} eventType\r\n * @param {Object} input\r\n */\r\nfunction inputHandler(manager, eventType, input) {\r\n    var pointersLen = input.pointers.length;\r\n    var changedPointersLen = input.changedPointers.length;\r\n    var isFirst = (eventType & INPUT_START && (pointersLen - changedPointersLen === 0));\r\n    var isFinal = (eventType & (INPUT_END | INPUT_CANCEL) && (pointersLen - changedPointersLen === 0));\r\n\r\n    input.isFirst = !!isFirst;\r\n    input.isFinal = !!isFinal;\r\n\r\n    if (isFirst) {\r\n        manager.session = {};\r\n    }\r\n\r\n    // source event is the normalized value of the domEvents\r\n    // like 'touchstart, mouseup, pointerdown'\r\n    input.eventType = eventType;\r\n\r\n    // compute scale, rotation etc\r\n    computeInputData(manager, input);\r\n\r\n    // emit secret event\r\n    manager.emit('hammer.input', input);\r\n\r\n    manager.recognize(input);\r\n    manager.session.prevInput = input;\r\n}\r\n\r\n/**\r\n * extend the data with some usable properties like scale, rotate, velocity etc\r\n * @param {Object} manager\r\n * @param {Object} input\r\n */\r\nfunction computeInputData(manager, input) {\r\n    var session = manager.session;\r\n    var pointers = input.pointers;\r\n    var pointersLength = pointers.length;\r\n\r\n    // store the first input to calculate the distance and direction\r\n    if (!session.firstInput) {\r\n        session.firstInput = simpleCloneInputData(input);\r\n    }\r\n\r\n    // to compute scale and rotation we need to store the multiple touches\r\n    if (pointersLength > 1 && !session.firstMultiple) {\r\n        session.firstMultiple = simpleCloneInputData(input);\r\n    } else if (pointersLength === 1) {\r\n        session.firstMultiple = false;\r\n    }\r\n\r\n    var firstInput = session.firstInput;\r\n    var firstMultiple = session.firstMultiple;\r\n    var offsetCenter = firstMultiple ? firstMultiple.center : firstInput.center;\r\n\r\n    var center = input.center = getCenter(pointers);\r\n    input.timeStamp = now();\r\n    input.deltaTime = input.timeStamp - firstInput.timeStamp;\r\n\r\n    input.angle = getAngle(offsetCenter, center);\r\n    input.distance = getDistance(offsetCenter, center);\r\n\r\n    computeDeltaXY(session, input);\r\n    input.offsetDirection = getDirection(input.deltaX, input.deltaY);\r\n\r\n    var overallVelocity = getVelocity(input.deltaTime, input.deltaX, input.deltaY);\r\n    input.overallVelocityX = overallVelocity.x;\r\n    input.overallVelocityY = overallVelocity.y;\r\n    input.overallVelocity = (abs(overallVelocity.x) > abs(overallVelocity.y)) ? overallVelocity.x : overallVelocity.y;\r\n\r\n    input.scale = firstMultiple ? getScale(firstMultiple.pointers, pointers) : 1;\r\n    input.rotation = firstMultiple ? getRotation(firstMultiple.pointers, pointers) : 0;\r\n\r\n    input.maxPointers = !session.prevInput ? input.pointers.length : ((input.pointers.length >\r\n        session.prevInput.maxPointers) ? input.pointers.length : session.prevInput.maxPointers);\r\n\r\n    computeIntervalInputData(session, input);\r\n\r\n    // find the correct target\r\n    var target = manager.element;\r\n    if (hasParent(input.srcEvent.target, target)) {\r\n        target = input.srcEvent.target;\r\n    }\r\n    input.target = target;\r\n}\r\n\r\nfunction computeDeltaXY(session, input) {\r\n    var center = input.center;\r\n    var offset = session.offsetDelta || {};\r\n    var prevDelta = session.prevDelta || {};\r\n    var prevInput = session.prevInput || {};\r\n\r\n    if (input.eventType === INPUT_START || prevInput.eventType === INPUT_END) {\r\n        prevDelta = session.prevDelta = {\r\n            x: prevInput.deltaX || 0,\r\n            y: prevInput.deltaY || 0\r\n        };\r\n\r\n        offset = session.offsetDelta = {\r\n            x: center.x,\r\n            y: center.y\r\n        };\r\n    }\r\n\r\n    input.deltaX = prevDelta.x + (center.x - offset.x);\r\n    input.deltaY = prevDelta.y + (center.y - offset.y);\r\n}\r\n\r\n/**\r\n * velocity is calculated every x ms\r\n * @param {Object} session\r\n * @param {Object} input\r\n */\r\nfunction computeIntervalInputData(session, input) {\r\n    var last = session.lastInterval || input,\r\n        deltaTime = input.timeStamp - last.timeStamp,\r\n        velocity, velocityX, velocityY, direction;\r\n\r\n    if (input.eventType != INPUT_CANCEL && (deltaTime > COMPUTE_INTERVAL || last.velocity === undefined)) {\r\n        var deltaX = input.deltaX - last.deltaX;\r\n        var deltaY = input.deltaY - last.deltaY;\r\n\r\n        var v = getVelocity(deltaTime, deltaX, deltaY);\r\n        velocityX = v.x;\r\n        velocityY = v.y;\r\n        velocity = (abs(v.x) > abs(v.y)) ? v.x : v.y;\r\n        direction = getDirection(deltaX, deltaY);\r\n\r\n        session.lastInterval = input;\r\n    } else {\r\n        // use latest velocity info if it doesn't overtake a minimum period\r\n        velocity = last.velocity;\r\n        velocityX = last.velocityX;\r\n        velocityY = last.velocityY;\r\n        direction = last.direction;\r\n    }\r\n\r\n    input.velocity = velocity;\r\n    input.velocityX = velocityX;\r\n    input.velocityY = velocityY;\r\n    input.direction = direction;\r\n}\r\n\r\n/**\r\n * create a simple clone from the input used for storage of firstInput and firstMultiple\r\n * @param {Object} input\r\n * @returns {Object} clonedInputData\r\n */\r\nfunction simpleCloneInputData(input) {\r\n    // make a simple copy of the pointers because we will get a reference if we don't\r\n    // we only need clientXY for the calculations\r\n    var pointers = [];\r\n    var i = 0;\r\n    while (i < input.pointers.length) {\r\n        pointers[i] = {\r\n            clientX: round(input.pointers[i].clientX),\r\n            clientY: round(input.pointers[i].clientY)\r\n        };\r\n        i++;\r\n    }\r\n\r\n    return {\r\n        timeStamp: now(),\r\n        pointers: pointers,\r\n        center: getCenter(pointers),\r\n        deltaX: input.deltaX,\r\n        deltaY: input.deltaY\r\n    };\r\n}\r\n\r\n/**\r\n * get the center of all the pointers\r\n * @param {Array} pointers\r\n * @return {Object} center contains `x` and `y` properties\r\n */\r\nfunction getCenter(pointers) {\r\n    var pointersLength = pointers.length;\r\n\r\n    // no need to loop when only one touch\r\n    if (pointersLength === 1) {\r\n        return {\r\n            x: round(pointers[0].clientX),\r\n            y: round(pointers[0].clientY)\r\n        };\r\n    }\r\n\r\n    var x = 0, y = 0, i = 0;\r\n    while (i < pointersLength) {\r\n        x += pointers[i].clientX;\r\n        y += pointers[i].clientY;\r\n        i++;\r\n    }\r\n\r\n    return {\r\n        x: round(x / pointersLength),\r\n        y: round(y / pointersLength)\r\n    };\r\n}\r\n\r\n/**\r\n * calculate the velocity between two points. unit is in px per ms.\r\n * @param {Number} deltaTime\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @return {Object} velocity `x` and `y`\r\n */\r\nfunction getVelocity(deltaTime, x, y) {\r\n    return {\r\n        x: x / deltaTime || 0,\r\n        y: y / deltaTime || 0\r\n    };\r\n}\r\n\r\n/**\r\n * get the direction between two points\r\n * @param {Number} x\r\n * @param {Number} y\r\n * @return {Number} direction\r\n */\r\nfunction getDirection(x, y) {\r\n    if (x === y) {\r\n        return DIRECTION_NONE;\r\n    }\r\n\r\n    if (abs(x) >= abs(y)) {\r\n        return x < 0 ? DIRECTION_LEFT : DIRECTION_RIGHT;\r\n    }\r\n    return y < 0 ? DIRECTION_UP : DIRECTION_DOWN;\r\n}\r\n\r\n/**\r\n * calculate the absolute distance between two points\r\n * @param {Object} p1 {x, y}\r\n * @param {Object} p2 {x, y}\r\n * @param {Array} [props] containing x and y keys\r\n * @return {Number} distance\r\n */\r\nfunction getDistance(p1, p2, props) {\r\n    if (!props) {\r\n        props = PROPS_XY;\r\n    }\r\n    var x = p2[props[0]] - p1[props[0]],\r\n        y = p2[props[1]] - p1[props[1]];\r\n\r\n    return Math.sqrt((x * x) + (y * y));\r\n}\r\n\r\n/**\r\n * calculate the angle between two coordinates\r\n * @param {Object} p1\r\n * @param {Object} p2\r\n * @param {Array} [props] containing x and y keys\r\n * @return {Number} angle\r\n */\r\nfunction getAngle(p1, p2, props) {\r\n    if (!props) {\r\n        props = PROPS_XY;\r\n    }\r\n    var x = p2[props[0]] - p1[props[0]],\r\n        y = p2[props[1]] - p1[props[1]];\r\n    return Math.atan2(y, x) * 180 / Math.PI;\r\n}\r\n\r\n/**\r\n * calculate the rotation degrees between two pointersets\r\n * @param {Array} start array of pointers\r\n * @param {Array} end array of pointers\r\n * @return {Number} rotation\r\n */\r\nfunction getRotation(start, end) {\r\n    return getAngle(end[1], end[0], PROPS_CLIENT_XY) + getAngle(start[1], start[0], PROPS_CLIENT_XY);\r\n}\r\n\r\n/**\r\n * calculate the scale factor between two pointersets\r\n * no scale is 1, and goes down to 0 when pinched together, and bigger when pinched out\r\n * @param {Array} start array of pointers\r\n * @param {Array} end array of pointers\r\n * @return {Number} scale\r\n */\r\nfunction getScale(start, end) {\r\n    return getDistance(end[0], end[1], PROPS_CLIENT_XY) / getDistance(start[0], start[1], PROPS_CLIENT_XY);\r\n}\r\n\r\nvar MOUSE_INPUT_MAP = {\r\n    mousedown: INPUT_START,\r\n    mousemove: INPUT_MOVE,\r\n    mouseup: INPUT_END\r\n};\r\n\r\nvar MOUSE_ELEMENT_EVENTS = 'mousedown';\r\nvar MOUSE_WINDOW_EVENTS = 'mousemove mouseup';\r\n\r\n/**\r\n * Mouse events input\r\n * @constructor\r\n * @extends Input\r\n */\r\nfunction MouseInput() {\r\n    this.evEl = MOUSE_ELEMENT_EVENTS;\r\n    this.evWin = MOUSE_WINDOW_EVENTS;\r\n\r\n    this.pressed = false; // mousedown state\r\n\r\n    Input.apply(this, arguments);\r\n}\r\n\r\ninherit(MouseInput, Input, {\r\n    /**\r\n     * handle mouse events\r\n     * @param {Object} ev\r\n     */\r\n    handler: function MEhandler(ev) {\r\n        var eventType = MOUSE_INPUT_MAP[ev.type];\r\n\r\n        // on start we want to have the left mouse button down\r\n        if (eventType & INPUT_START && ev.button === 0) {\r\n            this.pressed = true;\r\n        }\r\n\r\n        if (eventType & INPUT_MOVE && ev.which !== 1) {\r\n            eventType = INPUT_END;\r\n        }\r\n\r\n        // mouse must be down\r\n        if (!this.pressed) {\r\n            return;\r\n        }\r\n\r\n        if (eventType & INPUT_END) {\r\n            this.pressed = false;\r\n        }\r\n\r\n        this.callback(this.manager, eventType, {\r\n            pointers: [ev],\r\n            changedPointers: [ev],\r\n            pointerType: INPUT_TYPE_MOUSE,\r\n            srcEvent: ev\r\n        });\r\n    }\r\n});\r\n\r\nvar POINTER_INPUT_MAP = {\r\n    pointerdown: INPUT_START,\r\n    pointermove: INPUT_MOVE,\r\n    pointerup: INPUT_END,\r\n    pointercancel: INPUT_CANCEL,\r\n    pointerout: INPUT_CANCEL\r\n};\r\n\r\n// in IE10 the pointer types is defined as an enum\r\nvar IE10_POINTER_TYPE_ENUM = {\r\n    2: INPUT_TYPE_TOUCH,\r\n    3: INPUT_TYPE_PEN,\r\n    4: INPUT_TYPE_MOUSE,\r\n    5: INPUT_TYPE_KINECT // see https://twitter.com/jacobrossi/status/480596438489890816\r\n};\r\n\r\nvar POINTER_ELEMENT_EVENTS = 'pointerdown';\r\nvar POINTER_WINDOW_EVENTS = 'pointermove pointerup pointercancel';\r\n\r\n// IE10 has prefixed support, and case-sensitive\r\nif (window.MSPointerEvent && !window.PointerEvent) {\r\n    POINTER_ELEMENT_EVENTS = 'MSPointerDown';\r\n    POINTER_WINDOW_EVENTS = 'MSPointerMove MSPointerUp MSPointerCancel';\r\n}\r\n\r\n/**\r\n * Pointer events input\r\n * @constructor\r\n * @extends Input\r\n */\r\nfunction PointerEventInput() {\r\n    this.evEl = POINTER_ELEMENT_EVENTS;\r\n    this.evWin = POINTER_WINDOW_EVENTS;\r\n\r\n    Input.apply(this, arguments);\r\n\r\n    this.store = (this.manager.session.pointerEvents = []);\r\n}\r\n\r\ninherit(PointerEventInput, Input, {\r\n    /**\r\n     * handle mouse events\r\n     * @param {Object} ev\r\n     */\r\n    handler: function PEhandler(ev) {\r\n        var store = this.store;\r\n        var removePointer = false;\r\n\r\n        var eventTypeNormalized = ev.type.toLowerCase().replace('ms', '');\r\n        var eventType = POINTER_INPUT_MAP[eventTypeNormalized];\r\n        var pointerType = IE10_POINTER_TYPE_ENUM[ev.pointerType] || ev.pointerType;\r\n\r\n        var isTouch = (pointerType == INPUT_TYPE_TOUCH);\r\n\r\n        // get index of the event in the store\r\n        var storeIndex = inArray(store, ev.pointerId, 'pointerId');\r\n\r\n        // start and mouse must be down\r\n        if (eventType & INPUT_START && (ev.button === 0 || isTouch)) {\r\n            if (storeIndex < 0) {\r\n                store.push(ev);\r\n                storeIndex = store.length - 1;\r\n            }\r\n        } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\r\n            removePointer = true;\r\n        }\r\n\r\n        // it not found, so the pointer hasn't been down (so it's probably a hover)\r\n        if (storeIndex < 0) {\r\n            return;\r\n        }\r\n\r\n        // update the event in the store\r\n        store[storeIndex] = ev;\r\n\r\n        this.callback(this.manager, eventType, {\r\n            pointers: store,\r\n            changedPointers: [ev],\r\n            pointerType: pointerType,\r\n            srcEvent: ev\r\n        });\r\n\r\n        if (removePointer) {\r\n            // remove from the store\r\n            store.splice(storeIndex, 1);\r\n        }\r\n    }\r\n});\r\n\r\nvar SINGLE_TOUCH_INPUT_MAP = {\r\n    touchstart: INPUT_START,\r\n    touchmove: INPUT_MOVE,\r\n    touchend: INPUT_END,\r\n    touchcancel: INPUT_CANCEL\r\n};\r\n\r\nvar SINGLE_TOUCH_TARGET_EVENTS = 'touchstart';\r\nvar SINGLE_TOUCH_WINDOW_EVENTS = 'touchstart touchmove touchend touchcancel';\r\n\r\n/**\r\n * Touch events input\r\n * @constructor\r\n * @extends Input\r\n */\r\nfunction SingleTouchInput() {\r\n    this.evTarget = SINGLE_TOUCH_TARGET_EVENTS;\r\n    this.evWin = SINGLE_TOUCH_WINDOW_EVENTS;\r\n    this.started = false;\r\n\r\n    Input.apply(this, arguments);\r\n}\r\n\r\ninherit(SingleTouchInput, Input, {\r\n    handler: function TEhandler(ev) {\r\n        var type = SINGLE_TOUCH_INPUT_MAP[ev.type];\r\n\r\n        // should we handle the touch events?\r\n        if (type === INPUT_START) {\r\n            this.started = true;\r\n        }\r\n\r\n        if (!this.started) {\r\n            return;\r\n        }\r\n\r\n        var touches = normalizeSingleTouches.call(this, ev, type);\r\n\r\n        // when done, reset the started state\r\n        if (type & (INPUT_END | INPUT_CANCEL) && touches[0].length - touches[1].length === 0) {\r\n            this.started = false;\r\n        }\r\n\r\n        this.callback(this.manager, type, {\r\n            pointers: touches[0],\r\n            changedPointers: touches[1],\r\n            pointerType: INPUT_TYPE_TOUCH,\r\n            srcEvent: ev\r\n        });\r\n    }\r\n});\r\n\r\n/**\r\n * @this {TouchInput}\r\n * @param {Object} ev\r\n * @param {Number} type flag\r\n * @returns {undefined|Array} [all, changed]\r\n */\r\nfunction normalizeSingleTouches(ev, type) {\r\n    var all = toArray(ev.touches);\r\n    var changed = toArray(ev.changedTouches);\r\n\r\n    if (type & (INPUT_END | INPUT_CANCEL)) {\r\n        all = uniqueArray(all.concat(changed), 'identifier', true);\r\n    }\r\n\r\n    return [all, changed];\r\n}\r\n\r\nvar TOUCH_INPUT_MAP = {\r\n    touchstart: INPUT_START,\r\n    touchmove: INPUT_MOVE,\r\n    touchend: INPUT_END,\r\n    touchcancel: INPUT_CANCEL\r\n};\r\n\r\nvar TOUCH_TARGET_EVENTS = 'touchstart touchmove touchend touchcancel';\r\n\r\n/**\r\n * Multi-user touch events input\r\n * @constructor\r\n * @extends Input\r\n */\r\nfunction TouchInput() {\r\n    this.evTarget = TOUCH_TARGET_EVENTS;\r\n    this.targetIds = {};\r\n\r\n    Input.apply(this, arguments);\r\n}\r\n\r\ninherit(TouchInput, Input, {\r\n    handler: function MTEhandler(ev) {\r\n        var type = TOUCH_INPUT_MAP[ev.type];\r\n        var touches = getTouches.call(this, ev, type);\r\n        if (!touches) {\r\n            return;\r\n        }\r\n\r\n        this.callback(this.manager, type, {\r\n            pointers: touches[0],\r\n            changedPointers: touches[1],\r\n            pointerType: INPUT_TYPE_TOUCH,\r\n            srcEvent: ev\r\n        });\r\n    }\r\n});\r\n\r\n/**\r\n * @this {TouchInput}\r\n * @param {Object} ev\r\n * @param {Number} type flag\r\n * @returns {undefined|Array} [all, changed]\r\n */\r\nfunction getTouches(ev, type) {\r\n    var allTouches = toArray(ev.touches);\r\n    var targetIds = this.targetIds;\r\n\r\n    // when there is only one touch, the process can be simplified\r\n    if (type & (INPUT_START | INPUT_MOVE) && allTouches.length === 1) {\r\n        targetIds[allTouches[0].identifier] = true;\r\n        return [allTouches, allTouches];\r\n    }\r\n\r\n    var i,\r\n        targetTouches,\r\n        changedTouches = toArray(ev.changedTouches),\r\n        changedTargetTouches = [],\r\n        target = this.target;\r\n\r\n    // get target touches from touches\r\n    targetTouches = allTouches.filter(function(touch) {\r\n        return hasParent(touch.target, target);\r\n    });\r\n\r\n    // collect touches\r\n    if (type === INPUT_START) {\r\n        i = 0;\r\n        while (i < targetTouches.length) {\r\n            targetIds[targetTouches[i].identifier] = true;\r\n            i++;\r\n        }\r\n    }\r\n\r\n    // filter changed touches to only contain touches that exist in the collected target ids\r\n    i = 0;\r\n    while (i < changedTouches.length) {\r\n        if (targetIds[changedTouches[i].identifier]) {\r\n            changedTargetTouches.push(changedTouches[i]);\r\n        }\r\n\r\n        // cleanup removed touches\r\n        if (type & (INPUT_END | INPUT_CANCEL)) {\r\n            delete targetIds[changedTouches[i].identifier];\r\n        }\r\n        i++;\r\n    }\r\n\r\n    if (!changedTargetTouches.length) {\r\n        return;\r\n    }\r\n\r\n    return [\r\n        // merge targetTouches with changedTargetTouches so it contains ALL touches, including 'end' and 'cancel'\r\n        uniqueArray(targetTouches.concat(changedTargetTouches), 'identifier', true),\r\n        changedTargetTouches\r\n    ];\r\n}\r\n\r\n/**\r\n * Combined touch and mouse input\r\n *\r\n * Touch has a higher priority then mouse, and while touching no mouse events are allowed.\r\n * This because touch devices also emit mouse events while doing a touch.\r\n *\r\n * @constructor\r\n * @extends Input\r\n */\r\n\r\nvar DEDUP_TIMEOUT = 2500;\r\nvar DEDUP_DISTANCE = 25;\r\n\r\nfunction TouchMouseInput() {\r\n    Input.apply(this, arguments);\r\n\r\n    var handler = bindFn(this.handler, this);\r\n    this.touch = new TouchInput(this.manager, handler);\r\n    this.mouse = new MouseInput(this.manager, handler);\r\n\r\n    this.primaryTouch = null;\r\n    this.lastTouches = [];\r\n}\r\n\r\ninherit(TouchMouseInput, Input, {\r\n    /**\r\n     * handle mouse and touch events\r\n     * @param {NGHammer} manager\r\n     * @param {String} inputEvent\r\n     * @param {Object} inputData\r\n     */\r\n    handler: function TMEhandler(manager, inputEvent, inputData) {\r\n        var isTouch = (inputData.pointerType == INPUT_TYPE_TOUCH),\r\n            isMouse = (inputData.pointerType == INPUT_TYPE_MOUSE);\r\n\r\n        if (isMouse && inputData.sourceCapabilities && inputData.sourceCapabilities.firesTouchEvents) {\r\n            return;\r\n        }\r\n\r\n        // when we're in a touch event, record touches to  de-dupe synthetic mouse event\r\n        if (isTouch) {\r\n            recordTouches.call(this, inputEvent, inputData);\r\n        } else if (isMouse && isSyntheticEvent.call(this, inputData)) {\r\n            return;\r\n        }\r\n\r\n        this.callback(manager, inputEvent, inputData);\r\n    },\r\n\r\n    /**\r\n     * remove the event listeners\r\n     */\r\n    destroy: function destroy() {\r\n        this.touch.destroy();\r\n        this.mouse.destroy();\r\n    }\r\n});\r\n\r\nfunction recordTouches(eventType, eventData) {\r\n    if (eventType & INPUT_START) {\r\n        this.primaryTouch = eventData.changedPointers[0].identifier;\r\n        setLastTouch.call(this, eventData);\r\n    } else if (eventType & (INPUT_END | INPUT_CANCEL)) {\r\n        setLastTouch.call(this, eventData);\r\n    }\r\n}\r\n\r\nfunction setLastTouch(eventData) {\r\n    var touch = eventData.changedPointers[0];\r\n\r\n    if (touch.identifier === this.primaryTouch) {\r\n        var lastTouch = {x: touch.clientX, y: touch.clientY};\r\n        this.lastTouches.push(lastTouch);\r\n        var lts = this.lastTouches;\r\n        var removeLastTouch = function() {\r\n            var i = lts.indexOf(lastTouch);\r\n            if (i > -1) {\r\n                lts.splice(i, 1);\r\n            }\r\n        };\r\n        setTimeout(removeLastTouch, DEDUP_TIMEOUT);\r\n    }\r\n}\r\n\r\nfunction isSyntheticEvent(eventData) {\r\n    var x = eventData.srcEvent.clientX, y = eventData.srcEvent.clientY;\r\n    for (var i = 0; i < this.lastTouches.length; i++) {\r\n        var t = this.lastTouches[i];\r\n        var dx = Math.abs(x - t.x), dy = Math.abs(y - t.y);\r\n        if (dx <= DEDUP_DISTANCE && dy <= DEDUP_DISTANCE) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\nvar PREFIXED_TOUCH_ACTION = prefixed(TEST_ELEMENT.style, 'touchAction');\r\nvar NATIVE_TOUCH_ACTION = PREFIXED_TOUCH_ACTION !== undefined;\r\n\r\n// magical touchAction value\r\nvar TOUCH_ACTION_COMPUTE = 'compute';\r\nvar TOUCH_ACTION_AUTO = 'auto';\r\nvar TOUCH_ACTION_MANIPULATION = 'manipulation'; // not implemented\r\nvar TOUCH_ACTION_NONE = 'none';\r\nvar TOUCH_ACTION_PAN_X = 'pan-x';\r\nvar TOUCH_ACTION_PAN_Y = 'pan-y';\r\nvar TOUCH_ACTION_MAP = getTouchActionProps();\r\n\r\n/**\r\n * Touch Action\r\n * sets the touchAction property or uses the js alternative\r\n * @param {Manager} manager\r\n * @param {String} value\r\n * @constructor\r\n */\r\nfunction TouchAction(manager, value) {\r\n    this.manager = manager;\r\n    this.set(value);\r\n}\r\n\r\nTouchAction.prototype = {\r\n    /**\r\n     * set the touchAction value on the element or enable the polyfill\r\n     * @param {String} value\r\n     */\r\n    set: function(value) {\r\n        // find out the touch-action by the event handlers\r\n        if (value == TOUCH_ACTION_COMPUTE) {\r\n            value = this.compute();\r\n        }\r\n\r\n        if (NATIVE_TOUCH_ACTION && this.manager.element.style && TOUCH_ACTION_MAP[value]) {\r\n            this.manager.element.style[PREFIXED_TOUCH_ACTION] = value;\r\n        }\r\n        this.actions = value.toLowerCase().trim();\r\n    },\r\n\r\n    /**\r\n     * just re-set the touchAction value\r\n     */\r\n    update: function() {\r\n        this.set(this.manager.options.touchAction);\r\n    },\r\n\r\n    /**\r\n     * compute the value for the touchAction property based on the recognizer's settings\r\n     * @returns {String} value\r\n     */\r\n    compute: function() {\r\n        var actions = [];\r\n        each(this.manager.recognizers, function(recognizer) {\r\n            if (boolOrFn(recognizer.options.enable, [recognizer])) {\r\n                actions = actions.concat(recognizer.getTouchAction());\r\n            }\r\n        });\r\n        return cleanTouchActions(actions.join(' '));\r\n    },\r\n\r\n    /**\r\n     * this method is called on each input cycle and provides the preventing of the browser behavior\r\n     * @param {Object} input\r\n     */\r\n    preventDefaults: function(input) {\r\n        var srcEvent = input.srcEvent;\r\n        var direction = input.offsetDirection;\r\n\r\n        // if the touch action did prevented once this session\r\n        if (this.manager.session.prevented) {\r\n            srcEvent.preventDefault();\r\n            return;\r\n        }\r\n\r\n        var actions = this.actions;\r\n        var hasNone = inStr(actions, TOUCH_ACTION_NONE) && !TOUCH_ACTION_MAP[TOUCH_ACTION_NONE];\r\n        var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_Y];\r\n        var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X) && !TOUCH_ACTION_MAP[TOUCH_ACTION_PAN_X];\r\n\r\n        if (hasNone) {\r\n            //do not prevent defaults if this is a tap gesture\r\n\r\n            var isTapPointer = input.pointers.length === 1;\r\n            var isTapMovement = input.distance < 2;\r\n            var isTapTouchTime = input.deltaTime < 250;\r\n\r\n            if (isTapPointer && isTapMovement && isTapTouchTime) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (hasPanX && hasPanY) {\r\n            // `pan-x pan-y` means browser handles all scrolling/panning, do not prevent\r\n            return;\r\n        }\r\n\r\n        if (hasNone ||\r\n            (hasPanY && direction & DIRECTION_HORIZONTAL) ||\r\n            (hasPanX && direction & DIRECTION_VERTICAL)) {\r\n            return this.preventSrc(srcEvent);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * call preventDefault to prevent the browser's default behavior (scrolling in most cases)\r\n     * @param {Object} srcEvent\r\n     */\r\n    preventSrc: function(srcEvent) {\r\n        this.manager.session.prevented = true;\r\n        srcEvent.preventDefault();\r\n    }\r\n};\r\n\r\n/**\r\n * when the touchActions are collected they are not a valid value, so we need to clean things up. *\r\n * @param {String} actions\r\n * @returns {*}\r\n */\r\nfunction cleanTouchActions(actions) {\r\n    // none\r\n    if (inStr(actions, TOUCH_ACTION_NONE)) {\r\n        return TOUCH_ACTION_NONE;\r\n    }\r\n\r\n    var hasPanX = inStr(actions, TOUCH_ACTION_PAN_X);\r\n    var hasPanY = inStr(actions, TOUCH_ACTION_PAN_Y);\r\n\r\n    // if both pan-x and pan-y are set (different recognizers\r\n    // for different directions, e.g. horizontal pan but vertical swipe?)\r\n    // we need none (as otherwise with pan-x pan-y combined none of these\r\n    // recognizers will work, since the browser would handle all panning\r\n    if (hasPanX && hasPanY) {\r\n        return TOUCH_ACTION_NONE;\r\n    }\r\n\r\n    // pan-x OR pan-y\r\n    if (hasPanX || hasPanY) {\r\n        return hasPanX ? TOUCH_ACTION_PAN_X : TOUCH_ACTION_PAN_Y;\r\n    }\r\n\r\n    // manipulation\r\n    if (inStr(actions, TOUCH_ACTION_MANIPULATION)) {\r\n        return TOUCH_ACTION_MANIPULATION;\r\n    }\r\n\r\n    return TOUCH_ACTION_AUTO;\r\n}\r\n\r\nfunction getTouchActionProps() {\r\n    if (!NATIVE_TOUCH_ACTION) {\r\n        return false;\r\n    }\r\n    var touchMap = {};\r\n    var cssSupports = window.CSS && window.CSS.supports;\r\n    ['auto', 'manipulation', 'pan-y', 'pan-x', 'pan-x pan-y', 'none'].forEach(function(val) {\r\n\r\n        // If css.supports is not supported but there is native touch-action assume it supports\r\n        // all values. This is the case for IE 10 and 11.\r\n        touchMap[val] = cssSupports ? window.CSS.supports('touch-action', val) : true;\r\n    });\r\n    return touchMap;\r\n}\r\n\r\n/**\r\n * Recognizer flow explained; *\r\n * All recognizers have the initial state of POSSIBLE when a input session starts.\r\n * The definition of a input session is from the first input until the last input, with all it's movement in it. *\r\n * Example session for mouse-input: mousedown -> mousemove -> mouseup\r\n *\r\n * On each recognizing cycle (see Manager.recognize) the .recognize() method is executed\r\n * which determines with state it should be.\r\n *\r\n * If the recognizer has the state FAILED, CANCELLED or RECOGNIZED (equals ENDED), it is reset to\r\n * POSSIBLE to give it another change on the next cycle.\r\n *\r\n *               Possible\r\n *                  |\r\n *            +-----+---------------+\r\n *            |                     |\r\n *      +-----+-----+               |\r\n *      |           |               |\r\n *   Failed      Cancelled          |\r\n *                          +-------+------+\r\n *                          |              |\r\n *                      Recognized       Began\r\n *                                         |\r\n *                                      Changed\r\n *                                         |\r\n *                                  Ended/Recognized\r\n */\r\nvar STATE_POSSIBLE = 1;\r\nvar STATE_BEGAN = 2;\r\nvar STATE_CHANGED = 4;\r\nvar STATE_ENDED = 8;\r\nvar STATE_RECOGNIZED = STATE_ENDED;\r\nvar STATE_CANCELLED = 16;\r\nvar STATE_FAILED = 32;\r\n\r\n/**\r\n * Recognizer\r\n * Every recognizer needs to extend from this class.\r\n * @constructor\r\n * @param {Object} options\r\n */\r\nfunction Recognizer(options) {\r\n    this.options = assign({}, this.defaults, options || {});\r\n\r\n    this.id = uniqueId();\r\n\r\n    this.manager = null;\r\n\r\n    // default is enable true\r\n    this.options.enable = ifUndefined(this.options.enable, true);\r\n\r\n    this.state = STATE_POSSIBLE;\r\n\r\n    this.simultaneous = {};\r\n    this.requireFail = [];\r\n}\r\n\r\nRecognizer.prototype = {\r\n    /**\r\n     * @virtual\r\n     * @type {Object}\r\n     */\r\n    defaults: {},\r\n\r\n    /**\r\n     * set options\r\n     * @param {Object} options\r\n     * @return {Recognizer}\r\n     */\r\n    set: function(options) {\r\n        assign(this.options, options);\r\n\r\n        // also update the touchAction, in case something changed about the directions/enabled state\r\n        this.manager && this.manager.touchAction.update();\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * recognize simultaneous with an other recognizer.\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Recognizer} this\r\n     */\r\n    recognizeWith: function(otherRecognizer) {\r\n        if (invokeArrayArg(otherRecognizer, 'recognizeWith', this)) {\r\n            return this;\r\n        }\r\n\r\n        var simultaneous = this.simultaneous;\r\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\r\n        if (!simultaneous[otherRecognizer.id]) {\r\n            simultaneous[otherRecognizer.id] = otherRecognizer;\r\n            otherRecognizer.recognizeWith(this);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * drop the simultaneous link. it doesnt remove the link on the other recognizer.\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Recognizer} this\r\n     */\r\n    dropRecognizeWith: function(otherRecognizer) {\r\n        if (invokeArrayArg(otherRecognizer, 'dropRecognizeWith', this)) {\r\n            return this;\r\n        }\r\n\r\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\r\n        delete this.simultaneous[otherRecognizer.id];\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * recognizer can only run when an other is failing\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Recognizer} this\r\n     */\r\n    requireFailure: function(otherRecognizer) {\r\n        if (invokeArrayArg(otherRecognizer, 'requireFailure', this)) {\r\n            return this;\r\n        }\r\n\r\n        var requireFail = this.requireFail;\r\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\r\n        if (inArray(requireFail, otherRecognizer) === -1) {\r\n            requireFail.push(otherRecognizer);\r\n            otherRecognizer.requireFailure(this);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * drop the requireFailure link. it does not remove the link on the other recognizer.\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Recognizer} this\r\n     */\r\n    dropRequireFailure: function(otherRecognizer) {\r\n        if (invokeArrayArg(otherRecognizer, 'dropRequireFailure', this)) {\r\n            return this;\r\n        }\r\n\r\n        otherRecognizer = getRecognizerByNameIfManager(otherRecognizer, this);\r\n        var index = inArray(this.requireFail, otherRecognizer);\r\n        if (index > -1) {\r\n            this.requireFail.splice(index, 1);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * has require failures boolean\r\n     * @returns {boolean}\r\n     */\r\n    hasRequireFailures: function() {\r\n        return this.requireFail.length > 0;\r\n    },\r\n\r\n    /**\r\n     * if the recognizer can recognize simultaneous with an other recognizer\r\n     * @param {Recognizer} otherRecognizer\r\n     * @returns {Boolean}\r\n     */\r\n    canRecognizeWith: function(otherRecognizer) {\r\n        return !!this.simultaneous[otherRecognizer.id];\r\n    },\r\n\r\n    /**\r\n     * You should use `tryEmit` instead of `emit` directly to check\r\n     * that all the needed recognizers has failed before emitting.\r\n     * @param {Object} input\r\n     */\r\n    emit: function(input) {\r\n        var self = this;\r\n        var state = this.state;\r\n\r\n        function emit(event) {\r\n            self.manager.emit(event, input);\r\n        }\r\n\r\n        // 'panstart' and 'panmove'\r\n        if (state < STATE_ENDED) {\r\n            emit(self.options.event + stateStr(state));\r\n        }\r\n\r\n        emit(self.options.event); // simple 'eventName' events\r\n\r\n        if (input.additionalEvent) { // additional event(panleft, panright, pinchin, pinchout...)\r\n            emit(input.additionalEvent);\r\n        }\r\n\r\n        // panend and pancancel\r\n        if (state >= STATE_ENDED) {\r\n            emit(self.options.event + stateStr(state));\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Check that all the require failure recognizers has failed,\r\n     * if true, it emits a gesture event,\r\n     * otherwise, setup the state to FAILED.\r\n     * @param {Object} input\r\n     */\r\n    tryEmit: function(input) {\r\n        if (this.canEmit()) {\r\n            return this.emit(input);\r\n        }\r\n        // it's failing anyway\r\n        this.state = STATE_FAILED;\r\n    },\r\n\r\n    /**\r\n     * can we emit?\r\n     * @returns {boolean}\r\n     */\r\n    canEmit: function() {\r\n        var i = 0;\r\n        while (i < this.requireFail.length) {\r\n            if (!(this.requireFail[i].state & (STATE_FAILED | STATE_POSSIBLE))) {\r\n                return false;\r\n            }\r\n            i++;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    /**\r\n     * update the recognizer\r\n     * @param {Object} inputData\r\n     */\r\n    recognize: function(inputData) {\r\n        // make a new copy of the inputData\r\n        // so we can change the inputData without messing up the other recognizers\r\n        var inputDataClone = assign({}, inputData);\r\n\r\n        // is is enabled and allow recognizing?\r\n        if (!boolOrFn(this.options.enable, [this, inputDataClone])) {\r\n            this.reset();\r\n            this.state = STATE_FAILED;\r\n            return;\r\n        }\r\n\r\n        // reset when we've reached the end\r\n        if (this.state & (STATE_RECOGNIZED | STATE_CANCELLED | STATE_FAILED)) {\r\n            this.state = STATE_POSSIBLE;\r\n        }\r\n\r\n        this.state = this.process(inputDataClone);\r\n\r\n        // the recognizer has recognized a gesture\r\n        // so trigger an event\r\n        if (this.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED | STATE_CANCELLED)) {\r\n            this.tryEmit(inputDataClone);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * return the state of the recognizer\r\n     * the actual recognizing happens in this method\r\n     * @virtual\r\n     * @param {Object} inputData\r\n     * @returns {Const} STATE\r\n     */\r\n    process: function(inputData) { }, // jshint ignore:line\r\n\r\n    /**\r\n     * return the preferred touch-action\r\n     * @virtual\r\n     * @returns {Array}\r\n     */\r\n    getTouchAction: function() { },\r\n\r\n    /**\r\n     * called when the gesture isn't allowed to recognize\r\n     * like when another is being recognized or it is disabled\r\n     * @virtual\r\n     */\r\n    reset: function() { }\r\n};\r\n\r\n/**\r\n * get a usable string, used as event postfix\r\n * @param {Const} state\r\n * @returns {String} state\r\n */\r\nfunction stateStr(state) {\r\n    if (state & STATE_CANCELLED) {\r\n        return 'cancel';\r\n    } else if (state & STATE_ENDED) {\r\n        return 'end';\r\n    } else if (state & STATE_CHANGED) {\r\n        return 'move';\r\n    } else if (state & STATE_BEGAN) {\r\n        return 'start';\r\n    }\r\n    return '';\r\n}\r\n\r\n/**\r\n * direction cons to string\r\n * @param {Const} direction\r\n * @returns {String}\r\n */\r\nfunction directionStr(direction) {\r\n    if (direction == DIRECTION_DOWN) {\r\n        return 'down';\r\n    } else if (direction == DIRECTION_UP) {\r\n        return 'up';\r\n    } else if (direction == DIRECTION_LEFT) {\r\n        return 'left';\r\n    } else if (direction == DIRECTION_RIGHT) {\r\n        return 'right';\r\n    }\r\n    return '';\r\n}\r\n\r\n/**\r\n * get a recognizer by name if it is bound to a manager\r\n * @param {Recognizer|String} otherRecognizer\r\n * @param {Recognizer} recognizer\r\n * @returns {Recognizer}\r\n */\r\nfunction getRecognizerByNameIfManager(otherRecognizer, recognizer) {\r\n    var manager = recognizer.manager;\r\n    if (manager) {\r\n        return manager.get(otherRecognizer);\r\n    }\r\n    return otherRecognizer;\r\n}\r\n\r\n/**\r\n * This recognizer is just used as a base for the simple attribute recognizers.\r\n * @constructor\r\n * @extends Recognizer\r\n */\r\nfunction AttrRecognizer() {\r\n    Recognizer.apply(this, arguments);\r\n}\r\n\r\ninherit(AttrRecognizer, Recognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof AttrRecognizer\r\n     */\r\n    defaults: {\r\n        /**\r\n         * @type {Number}\r\n         * @default 1\r\n         */\r\n        pointers: 1\r\n    },\r\n\r\n    /**\r\n     * Used to check if it the recognizer receives valid input, like input.distance > 10.\r\n     * @memberof AttrRecognizer\r\n     * @param {Object} input\r\n     * @returns {Boolean} recognized\r\n     */\r\n    attrTest: function(input) {\r\n        var optionPointers = this.options.pointers;\r\n        return optionPointers === 0 || input.pointers.length === optionPointers;\r\n    },\r\n\r\n    /**\r\n     * Process the input and return the state for the recognizer\r\n     * @memberof AttrRecognizer\r\n     * @param {Object} input\r\n     * @returns {*} State\r\n     */\r\n    process: function(input) {\r\n        var state = this.state;\r\n        var eventType = input.eventType;\r\n\r\n        var isRecognized = state & (STATE_BEGAN | STATE_CHANGED);\r\n        var isValid = this.attrTest(input);\r\n\r\n        // on cancel input and we've recognized before, return STATE_CANCELLED\r\n        if (isRecognized && (eventType & INPUT_CANCEL || !isValid)) {\r\n            return state | STATE_CANCELLED;\r\n        } else if (isRecognized || isValid) {\r\n            if (eventType & INPUT_END) {\r\n                return state | STATE_ENDED;\r\n            } else if (!(state & STATE_BEGAN)) {\r\n                return STATE_BEGAN;\r\n            }\r\n            return state | STATE_CHANGED;\r\n        }\r\n        return STATE_FAILED;\r\n    }\r\n});\r\n\r\n/**\r\n * Pan\r\n * Recognized when the pointer is down and moved in the allowed direction.\r\n * @constructor\r\n * @extends AttrRecognizer\r\n */\r\nfunction PanRecognizer() {\r\n    AttrRecognizer.apply(this, arguments);\r\n\r\n    this.pX = null;\r\n    this.pY = null;\r\n}\r\n\r\ninherit(PanRecognizer, AttrRecognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof PanRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'pan',\r\n        threshold: 10,\r\n        pointers: 1,\r\n        direction: DIRECTION_ALL\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        var direction = this.options.direction;\r\n        var actions = [];\r\n        if (direction & DIRECTION_HORIZONTAL) {\r\n            actions.push(TOUCH_ACTION_PAN_Y);\r\n        }\r\n        if (direction & DIRECTION_VERTICAL) {\r\n            actions.push(TOUCH_ACTION_PAN_X);\r\n        }\r\n        return actions;\r\n    },\r\n\r\n    directionTest: function(input) {\r\n        var options = this.options;\r\n        var hasMoved = true;\r\n        var distance = input.distance;\r\n        var direction = input.direction;\r\n        var x = input.deltaX;\r\n        var y = input.deltaY;\r\n\r\n        // lock to axis?\r\n        if (!(direction & options.direction)) {\r\n            if (options.direction & DIRECTION_HORIZONTAL) {\r\n                direction = (x === 0) ? DIRECTION_NONE : (x < 0) ? DIRECTION_LEFT : DIRECTION_RIGHT;\r\n                hasMoved = x != this.pX;\r\n                distance = Math.abs(input.deltaX);\r\n            } else {\r\n                direction = (y === 0) ? DIRECTION_NONE : (y < 0) ? DIRECTION_UP : DIRECTION_DOWN;\r\n                hasMoved = y != this.pY;\r\n                distance = Math.abs(input.deltaY);\r\n            }\r\n        }\r\n        input.direction = direction;\r\n        return hasMoved && distance > options.threshold && direction & options.direction;\r\n    },\r\n\r\n    attrTest: function(input) {\r\n        return AttrRecognizer.prototype.attrTest.call(this, input) &&\r\n            (this.state & STATE_BEGAN || (!(this.state & STATE_BEGAN) && this.directionTest(input)));\r\n    },\r\n\r\n    emit: function(input) {\r\n\r\n        this.pX = input.deltaX;\r\n        this.pY = input.deltaY;\r\n\r\n        var direction = directionStr(input.direction);\r\n\r\n        if (direction) {\r\n            input.additionalEvent = this.options.event + direction;\r\n        }\r\n        this._super.emit.call(this, input);\r\n    }\r\n});\r\n\r\n/**\r\n * Pinch\r\n * Recognized when two or more pointers are moving toward (zoom-in) or away from each other (zoom-out).\r\n * @constructor\r\n * @extends AttrRecognizer\r\n */\r\nfunction PinchRecognizer() {\r\n    AttrRecognizer.apply(this, arguments);\r\n}\r\n\r\ninherit(PinchRecognizer, AttrRecognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof PinchRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'pinch',\r\n        threshold: 0,\r\n        pointers: 2\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return [TOUCH_ACTION_NONE];\r\n    },\r\n\r\n    attrTest: function(input) {\r\n        return this._super.attrTest.call(this, input) &&\r\n            (Math.abs(input.scale - 1) > this.options.threshold || this.state & STATE_BEGAN);\r\n    },\r\n\r\n    emit: function(input) {\r\n        if (input.scale !== 1) {\r\n            var inOut = input.scale < 1 ? 'in' : 'out';\r\n            input.additionalEvent = this.options.event + inOut;\r\n        }\r\n        this._super.emit.call(this, input);\r\n    }\r\n});\r\n\r\n/**\r\n * Press\r\n * Recognized when the pointer is down for x ms without any movement.\r\n * @constructor\r\n * @extends Recognizer\r\n */\r\nfunction PressRecognizer() {\r\n    Recognizer.apply(this, arguments);\r\n\r\n    this._timer = null;\r\n    this._input = null;\r\n}\r\n\r\ninherit(PressRecognizer, Recognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof PressRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'press',\r\n        pointers: 1,\r\n        time: 251, // minimal time of the pointer to be pressed\r\n        threshold: 9 // a minimal movement is ok, but keep it low\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return [TOUCH_ACTION_AUTO];\r\n    },\r\n\r\n    process: function(input) {\r\n        var options = this.options;\r\n        var validPointers = input.pointers.length === options.pointers;\r\n        var validMovement = input.distance < options.threshold;\r\n        var validTime = input.deltaTime > options.time;\r\n\r\n        this._input = input;\r\n\r\n        // we only allow little movement\r\n        // and we've reached an end event, so a tap is possible\r\n        if (!validMovement || !validPointers || (input.eventType & (INPUT_END | INPUT_CANCEL) && !validTime)) {\r\n            this.reset();\r\n        } else if (input.eventType & INPUT_START) {\r\n            this.reset();\r\n            this._timer = setTimeoutContext(function() {\r\n                this.state = STATE_RECOGNIZED;\r\n                this.tryEmit();\r\n            }, options.time, this);\r\n        } else if (input.eventType & INPUT_END) {\r\n            return STATE_RECOGNIZED;\r\n        }\r\n        return STATE_FAILED;\r\n    },\r\n\r\n    reset: function() {\r\n        clearTimeout(this._timer);\r\n    },\r\n\r\n    emit: function(input) {\r\n        if (this.state !== STATE_RECOGNIZED) {\r\n            return;\r\n        }\r\n\r\n        if (input && (input.eventType & INPUT_END)) {\r\n            this.manager.emit(this.options.event + 'up', input);\r\n        } else {\r\n            this._input.timeStamp = now();\r\n            this.manager.emit(this.options.event, this._input);\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * Rotate\r\n * Recognized when two or more pointer are moving in a circular motion.\r\n * @constructor\r\n * @extends AttrRecognizer\r\n */\r\nfunction RotateRecognizer() {\r\n    AttrRecognizer.apply(this, arguments);\r\n}\r\n\r\ninherit(RotateRecognizer, AttrRecognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof RotateRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'rotate',\r\n        threshold: 0,\r\n        pointers: 2\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return [TOUCH_ACTION_NONE];\r\n    },\r\n\r\n    attrTest: function(input) {\r\n        return this._super.attrTest.call(this, input) &&\r\n            (Math.abs(input.rotation) > this.options.threshold || this.state & STATE_BEGAN);\r\n    }\r\n});\r\n\r\n/**\r\n * Swipe\r\n * Recognized when the pointer is moving fast (velocity), with enough distance in the allowed direction.\r\n * @constructor\r\n * @extends AttrRecognizer\r\n */\r\nfunction SwipeRecognizer() {\r\n    AttrRecognizer.apply(this, arguments);\r\n}\r\n\r\ninherit(SwipeRecognizer, AttrRecognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof SwipeRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'swipe',\r\n        threshold: 10,\r\n        velocity: 0.3,\r\n        direction: DIRECTION_HORIZONTAL | DIRECTION_VERTICAL,\r\n        pointers: 1\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return PanRecognizer.prototype.getTouchAction.call(this);\r\n    },\r\n\r\n    attrTest: function(input) {\r\n        var direction = this.options.direction;\r\n        var velocity;\r\n\r\n        if (direction & (DIRECTION_HORIZONTAL | DIRECTION_VERTICAL)) {\r\n            velocity = input.overallVelocity;\r\n        } else if (direction & DIRECTION_HORIZONTAL) {\r\n            velocity = input.overallVelocityX;\r\n        } else if (direction & DIRECTION_VERTICAL) {\r\n            velocity = input.overallVelocityY;\r\n        }\r\n\r\n        return this._super.attrTest.call(this, input) &&\r\n            direction & input.offsetDirection &&\r\n            input.distance > this.options.threshold &&\r\n            input.maxPointers == this.options.pointers &&\r\n            abs(velocity) > this.options.velocity && input.eventType & INPUT_END;\r\n    },\r\n\r\n    emit: function(input) {\r\n        var direction = directionStr(input.offsetDirection);\r\n        if (direction) {\r\n            this.manager.emit(this.options.event + direction, input);\r\n        }\r\n\r\n        this.manager.emit(this.options.event, input);\r\n    }\r\n});\r\n\r\n/**\r\n * A tap is ecognized when the pointer is doing a small tap/click. Multiple taps are recognized if they occur\r\n * between the given interval and position. The delay option can be used to recognize multi-taps without firing\r\n * a single tap.\r\n *\r\n * The eventData from the emitted event contains the property `tapCount`, which contains the amount of\r\n * multi-taps being recognized.\r\n * @constructor\r\n * @extends Recognizer\r\n */\r\nfunction TapRecognizer() {\r\n    Recognizer.apply(this, arguments);\r\n\r\n    // previous time and center,\r\n    // used for tap counting\r\n    this.pTime = false;\r\n    this.pCenter = false;\r\n\r\n    this._timer = null;\r\n    this._input = null;\r\n    this.count = 0;\r\n}\r\n\r\ninherit(TapRecognizer, Recognizer, {\r\n    /**\r\n     * @namespace\r\n     * @memberof PinchRecognizer\r\n     */\r\n    defaults: {\r\n        event: 'tap',\r\n        pointers: 1,\r\n        taps: 1,\r\n        interval: 300, // max time between the multi-tap taps\r\n        time: 250, // max time of the pointer to be down (like finger on the screen)\r\n        threshold: 9, // a minimal movement is ok, but keep it low\r\n        posThreshold: 10 // a multi-tap can be a bit off the initial position\r\n    },\r\n\r\n    getTouchAction: function() {\r\n        return [TOUCH_ACTION_MANIPULATION];\r\n    },\r\n\r\n    process: function(input) {\r\n        var options = this.options;\r\n\r\n        var validPointers = input.pointers.length === options.pointers;\r\n        var validMovement = input.distance < options.threshold;\r\n        var validTouchTime = input.deltaTime < options.time;\r\n\r\n        this.reset();\r\n\r\n        if ((input.eventType & INPUT_START) && (this.count === 0)) {\r\n            return this.failTimeout();\r\n        }\r\n\r\n        // we only allow little movement\r\n        // and we've reached an end event, so a tap is possible\r\n        if (validMovement && validTouchTime && validPointers) {\r\n            if (input.eventType != INPUT_END) {\r\n                return this.failTimeout();\r\n            }\r\n\r\n            var validInterval = this.pTime ? (input.timeStamp - this.pTime < options.interval) : true;\r\n            var validMultiTap = !this.pCenter || getDistance(this.pCenter, input.center) < options.posThreshold;\r\n\r\n            this.pTime = input.timeStamp;\r\n            this.pCenter = input.center;\r\n\r\n            if (!validMultiTap || !validInterval) {\r\n                this.count = 1;\r\n            } else {\r\n                this.count += 1;\r\n            }\r\n\r\n            this._input = input;\r\n\r\n            // if tap count matches we have recognized it,\r\n            // else it has began recognizing...\r\n            var tapCount = this.count % options.taps;\r\n            if (tapCount === 0) {\r\n                // no failing requirements, immediately trigger the tap event\r\n                // or wait as long as the multitap interval to trigger\r\n                if (!this.hasRequireFailures()) {\r\n                    return STATE_RECOGNIZED;\r\n                } else {\r\n                    this._timer = setTimeoutContext(function() {\r\n                        this.state = STATE_RECOGNIZED;\r\n                        this.tryEmit();\r\n                    }, options.interval, this);\r\n                    return STATE_BEGAN;\r\n                }\r\n            }\r\n        }\r\n        return STATE_FAILED;\r\n    },\r\n\r\n    failTimeout: function() {\r\n        this._timer = setTimeoutContext(function() {\r\n            this.state = STATE_FAILED;\r\n        }, this.options.interval, this);\r\n        return STATE_FAILED;\r\n    },\r\n\r\n    reset: function() {\r\n        clearTimeout(this._timer);\r\n    },\r\n\r\n    emit: function() {\r\n        if (this.state == STATE_RECOGNIZED) {\r\n            this._input.tapCount = this.count;\r\n            this.manager.emit(this.options.event, this._input);\r\n        }\r\n    }\r\n});\r\n\r\n/**\r\n * Simple way to create a manager with a default set of recognizers.\r\n * @param {HTMLElement} element\r\n * @param {Object} [options]\r\n * @constructor\r\n */\r\nfunction NGHammer(element, options) {\r\n    options = options || {};\r\n    options.recognizers = ifUndefined(options.recognizers, NGHammer.defaults.preset);\r\n    return new Manager(element, options);\r\n}\r\n\r\n/**\r\n * @const {string}\r\n */\r\nNGHammer.VERSION = '2.0.7';\r\n\r\n/**\r\n * default settings\r\n * @namespace\r\n */\r\nNGHammer.defaults = {\r\n    /**\r\n     * set if DOM events are being triggered.\r\n     * But this is slower and unused by simple implementations, so disabled by default.\r\n     * @type {Boolean}\r\n     * @default false\r\n     */\r\n    domEvents: false,\r\n\r\n    /**\r\n     * The value for the touchAction property/fallback.\r\n     * When set to `compute` it will magically set the correct value based on the added recognizers.\r\n     * @type {String}\r\n     * @default compute\r\n     */\r\n    touchAction: TOUCH_ACTION_COMPUTE,\r\n\r\n    /**\r\n     * @type {Boolean}\r\n     * @default true\r\n     */\r\n    enable: true,\r\n\r\n    /**\r\n     * EXPERIMENTAL FEATURE -- can be removed/changed\r\n     * Change the parent input target element.\r\n     * If Null, then it is being set the to main element.\r\n     * @type {Null|EventTarget}\r\n     * @default null\r\n     */\r\n    inputTarget: null,\r\n\r\n    /**\r\n     * force an input class\r\n     * @type {Null|Function}\r\n     * @default null\r\n     */\r\n    inputClass: null,\r\n\r\n    /**\r\n     * Default recognizer setup when calling `NGHammer()`\r\n     * When creating a new Manager these will be skipped.\r\n     * @type {Array}\r\n     */\r\n    preset: [\r\n        // RecognizerClass, options, [recognizeWith, ...], [requireFailure, ...]\r\n        [RotateRecognizer, {enable: false}],\r\n        [PinchRecognizer, {enable: false}, ['rotate']],\r\n        [SwipeRecognizer, {direction: DIRECTION_HORIZONTAL}],\r\n        [PanRecognizer, {direction: DIRECTION_HORIZONTAL}, ['swipe']],\r\n        [TapRecognizer],\r\n        [TapRecognizer, {event: 'doubletap', taps: 2}, ['tap']],\r\n        [PressRecognizer]\r\n    ],\r\n\r\n    /**\r\n     * Some CSS properties can be used to improve the working of NGHammer.\r\n     * Add them to this method and they will be set when creating a new Manager.\r\n     * @namespace\r\n     */\r\n    cssProps: {\r\n        /**\r\n         * Disables text selection to improve the dragging gesture. Mainly for desktop browsers.\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        userSelect: 'none',\r\n\r\n        /**\r\n         * Disable the Windows Phone grippers when pressing an element.\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        touchSelect: 'none',\r\n\r\n        /**\r\n         * Disables the default callout shown when you touch and hold a touch target.\r\n         * On iOS, when you touch and hold a touch target such as a link, Safari displays\r\n         * a callout containing information about the link. This property allows you to disable that callout.\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        touchCallout: 'none',\r\n\r\n        /**\r\n         * Specifies whether zooming is enabled. Used by IE10>\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        contentZooming: 'none',\r\n\r\n        /**\r\n         * Specifies that an entire element should be draggable instead of its contents. Mainly for desktop browsers.\r\n         * @type {String}\r\n         * @default 'none'\r\n         */\r\n        userDrag: 'none',\r\n\r\n        /**\r\n         * Overrides the highlight color shown when the user taps a link or a JavaScript\r\n         * clickable element in iOS. This property obeys the alpha value, if specified.\r\n         * @type {String}\r\n         * @default 'rgba(0,0,0,0)'\r\n         */\r\n        tapHighlightColor: 'rgba(0,0,0,0)'\r\n    }\r\n};\r\n\r\nvar STOP = 1;\r\nvar FORCED_STOP = 2;\r\n\r\n/**\r\n * Manager\r\n * @param {HTMLElement} element\r\n * @param {Object} [options]\r\n * @constructor\r\n */\r\nfunction Manager(element, options) {\r\n    this.options = assign({}, NGHammer.defaults, options || {});\r\n\r\n    this.options.inputTarget = this.options.inputTarget || element;\r\n\r\n    this.handlers = {};\r\n    this.session = {};\r\n    this.recognizers = [];\r\n    this.oldCssProps = {};\r\n\r\n    this.element = element;\r\n    this.input = createInputInstance(this);\r\n    this.touchAction = new TouchAction(this, this.options.touchAction);\r\n\r\n    toggleCssProps(this, true);\r\n\r\n    each(this.options.recognizers, function(item) {\r\n        var recognizer = this.add(new (item[0])(item[1]));\r\n        item[2] && recognizer.recognizeWith(item[2]);\r\n        item[3] && recognizer.requireFailure(item[3]);\r\n    }, this);\r\n}\r\n\r\nManager.prototype = {\r\n    /**\r\n     * set options\r\n     * @param {Object} options\r\n     * @returns {Manager}\r\n     */\r\n    set: function(options) {\r\n        assign(this.options, options);\r\n\r\n        // Options that need a little more setup\r\n        if (options.touchAction) {\r\n            this.touchAction.update();\r\n        }\r\n        if (options.inputTarget) {\r\n            // Clean up existing event listeners and reinitialize\r\n            this.input.destroy();\r\n            this.input.target = options.inputTarget;\r\n            this.input.init();\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * stop recognizing for this session.\r\n     * This session will be discarded, when a new [input]start event is fired.\r\n     * When forced, the recognizer cycle is stopped immediately.\r\n     * @param {Boolean} [force]\r\n     */\r\n    stop: function(force) {\r\n        this.session.stopped = force ? FORCED_STOP : STOP;\r\n    },\r\n\r\n    /**\r\n     * run the recognizers!\r\n     * called by the inputHandler function on every movement of the pointers (touches)\r\n     * it walks through all the recognizers and tries to detect the gesture that is being made\r\n     * @param {Object} inputData\r\n     */\r\n    recognize: function(inputData) {\r\n        var session = this.session;\r\n        if (session.stopped) {\r\n            return;\r\n        }\r\n\r\n        // run the touch-action polyfill\r\n        this.touchAction.preventDefaults(inputData);\r\n\r\n        var recognizer;\r\n        var recognizers = this.recognizers;\r\n\r\n        // this holds the recognizer that is being recognized.\r\n        // so the recognizer's state needs to be BEGAN, CHANGED, ENDED or RECOGNIZED\r\n        // if no recognizer is detecting a thing, it is set to `null`\r\n        var curRecognizer = session.curRecognizer;\r\n\r\n        // reset when the last recognizer is recognized\r\n        // or when we're in a new session\r\n        if (!curRecognizer || (curRecognizer && curRecognizer.state & STATE_RECOGNIZED)) {\r\n            curRecognizer = session.curRecognizer = null;\r\n        }\r\n\r\n        var i = 0;\r\n        while (i < recognizers.length) {\r\n            recognizer = recognizers[i];\r\n\r\n            // find out if we are allowed try to recognize the input for this one.\r\n            // 1.   allow if the session is NOT forced stopped (see the .stop() method)\r\n            // 2.   allow if we still haven't recognized a gesture in this session, or the this recognizer is the one\r\n            //      that is being recognized.\r\n            // 3.   allow if the recognizer is allowed to run simultaneous with the current recognized recognizer.\r\n            //      this can be setup with the `recognizeWith()` method on the recognizer.\r\n            if (session.stopped !== FORCED_STOP && ( // 1\r\n                    !curRecognizer || recognizer == curRecognizer || // 2\r\n                    recognizer.canRecognizeWith(curRecognizer))) { // 3\r\n                recognizer.recognize(inputData);\r\n            } else {\r\n                recognizer.reset();\r\n            }\r\n\r\n            // if the recognizer has been recognizing the input as a valid gesture, we want to store this one as the\r\n            // current active recognizer. but only if we don't already have an active recognizer\r\n            if (!curRecognizer && recognizer.state & (STATE_BEGAN | STATE_CHANGED | STATE_ENDED)) {\r\n                curRecognizer = session.curRecognizer = recognizer;\r\n            }\r\n            i++;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * get a recognizer by its event name.\r\n     * @param {Recognizer|String} recognizer\r\n     * @returns {Recognizer|Null}\r\n     */\r\n    get: function(recognizer) {\r\n        if (recognizer instanceof Recognizer) {\r\n            return recognizer;\r\n        }\r\n\r\n        var recognizers = this.recognizers;\r\n        for (var i = 0; i < recognizers.length; i++) {\r\n            if (recognizers[i].options.event == recognizer) {\r\n                return recognizers[i];\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n\r\n    /**\r\n     * add a recognizer to the manager\r\n     * existing recognizers with the same event name will be removed\r\n     * @param {Recognizer} recognizer\r\n     * @returns {Recognizer|Manager}\r\n     */\r\n    add: function(recognizer) {\r\n        if (invokeArrayArg(recognizer, 'add', this)) {\r\n            return this;\r\n        }\r\n\r\n        // remove existing\r\n        var existing = this.get(recognizer.options.event);\r\n        if (existing) {\r\n            this.remove(existing);\r\n        }\r\n\r\n        this.recognizers.push(recognizer);\r\n        recognizer.manager = this;\r\n\r\n        this.touchAction.update();\r\n        return recognizer;\r\n    },\r\n\r\n    /**\r\n     * remove a recognizer by name or instance\r\n     * @param {Recognizer|String} recognizer\r\n     * @returns {Manager}\r\n     */\r\n    remove: function(recognizer) {\r\n        if (invokeArrayArg(recognizer, 'remove', this)) {\r\n            return this;\r\n        }\r\n\r\n        recognizer = this.get(recognizer);\r\n\r\n        // let's make sure this recognizer exists\r\n        if (recognizer) {\r\n            var recognizers = this.recognizers;\r\n            var index = inArray(recognizers, recognizer);\r\n\r\n            if (index !== -1) {\r\n                recognizers.splice(index, 1);\r\n                this.touchAction.update();\r\n            }\r\n        }\r\n\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * bind event\r\n     * @param {String} events\r\n     * @param {Function} handler\r\n     * @returns {EventEmitter} this\r\n     */\r\n    on: function(events, handler) {\r\n        if (events === undefined) {\r\n            return;\r\n        }\r\n        if (handler === undefined) {\r\n            return;\r\n        }\r\n\r\n        var handlers = this.handlers;\r\n        each(splitStr(events), function(event) {\r\n            handlers[event] = handlers[event] || [];\r\n            handlers[event].push(handler);\r\n        });\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * unbind event, leave emit blank to remove all handlers\r\n     * @param {String} events\r\n     * @param {Function} [handler]\r\n     * @returns {EventEmitter} this\r\n     */\r\n    off: function(events, handler) {\r\n        if (events === undefined) {\r\n            return;\r\n        }\r\n\r\n        var handlers = this.handlers;\r\n        each(splitStr(events), function(event) {\r\n            if (!handler) {\r\n                delete handlers[event];\r\n            } else {\r\n                handlers[event] && handlers[event].splice(inArray(handlers[event], handler), 1);\r\n            }\r\n        });\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * emit event to the listeners\r\n     * @param {String} event\r\n     * @param {Object} data\r\n     */\r\n    emit: function(event, data) {\r\n        // we also want to trigger dom events\r\n        if (this.options.domEvents) {\r\n            triggerDomEvent(event, data);\r\n        }\r\n\r\n        // no handlers, so skip it all\r\n        var handlers = this.handlers[event] && this.handlers[event].slice();\r\n        if (!handlers || !handlers.length) {\r\n            return;\r\n        }\r\n\r\n        data.type = event;\r\n        data.preventDefault = function() {\r\n            data.srcEvent.preventDefault();\r\n        };\r\n\r\n        var i = 0;\r\n        while (i < handlers.length) {\r\n            handlers[i](data);\r\n            i++;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * destroy the manager and unbinds all events\r\n     * it doesn't unbind dom events, that is the user own responsibility\r\n     */\r\n    destroy: function() {\r\n        this.element && toggleCssProps(this, false);\r\n\r\n        this.handlers = {};\r\n        this.session = {};\r\n        this.input.destroy();\r\n        this.element = null;\r\n    }\r\n};\r\n\r\n/**\r\n * add/remove the css properties as defined in manager.options.cssProps\r\n * @param {Manager} manager\r\n * @param {Boolean} add\r\n */\r\nfunction toggleCssProps(manager, add) {\r\n    var element = manager.element;\r\n    if (!element.style) {\r\n        return;\r\n    }\r\n    var prop;\r\n    each(manager.options.cssProps, function(value, name) {\r\n        prop = prefixed(element.style, name);\r\n        if (add) {\r\n            manager.oldCssProps[prop] = element.style[prop];\r\n            element.style[prop] = value;\r\n        } else {\r\n            element.style[prop] = manager.oldCssProps[prop] || '';\r\n        }\r\n    });\r\n    if (!add) {\r\n        manager.oldCssProps = {};\r\n    }\r\n}\r\n\r\n/**\r\n * trigger dom event\r\n * @param {String} event\r\n * @param {Object} data\r\n */\r\nfunction triggerDomEvent(event, data) {\r\n    var gestureEvent = document.createEvent('Event');\r\n    gestureEvent.initEvent(event, true, true);\r\n    gestureEvent.gesture = data;\r\n    data.target.dispatchEvent(gestureEvent);\r\n}\r\n\r\nassign(NGHammer, {\r\n    INPUT_START: INPUT_START,\r\n    INPUT_MOVE: INPUT_MOVE,\r\n    INPUT_END: INPUT_END,\r\n    INPUT_CANCEL: INPUT_CANCEL,\r\n\r\n    STATE_POSSIBLE: STATE_POSSIBLE,\r\n    STATE_BEGAN: STATE_BEGAN,\r\n    STATE_CHANGED: STATE_CHANGED,\r\n    STATE_ENDED: STATE_ENDED,\r\n    STATE_RECOGNIZED: STATE_RECOGNIZED,\r\n    STATE_CANCELLED: STATE_CANCELLED,\r\n    STATE_FAILED: STATE_FAILED,\r\n\r\n    DIRECTION_NONE: DIRECTION_NONE,\r\n    DIRECTION_LEFT: DIRECTION_LEFT,\r\n    DIRECTION_RIGHT: DIRECTION_RIGHT,\r\n    DIRECTION_UP: DIRECTION_UP,\r\n    DIRECTION_DOWN: DIRECTION_DOWN,\r\n    DIRECTION_HORIZONTAL: DIRECTION_HORIZONTAL,\r\n    DIRECTION_VERTICAL: DIRECTION_VERTICAL,\r\n    DIRECTION_ALL: DIRECTION_ALL,\r\n\r\n    Manager: Manager,\r\n    Input: Input,\r\n    TouchAction: TouchAction,\r\n\r\n    TouchInput: TouchInput,\r\n    MouseInput: MouseInput,\r\n    PointerEventInput: PointerEventInput,\r\n    TouchMouseInput: TouchMouseInput,\r\n    SingleTouchInput: SingleTouchInput,\r\n\r\n    Recognizer: Recognizer,\r\n    AttrRecognizer: AttrRecognizer,\r\n    Tap: TapRecognizer,\r\n    Pan: PanRecognizer,\r\n    Swipe: SwipeRecognizer,\r\n    Pinch: PinchRecognizer,\r\n    Rotate: RotateRecognizer,\r\n    Press: PressRecognizer,\r\n\r\n    on: addEventListeners,\r\n    off: removeEventListeners,\r\n    each: each,\r\n    merge: merge,\r\n    extend: extend,\r\n    assign: assign,\r\n    inherit: inherit,\r\n    bindFn: bindFn,\r\n    prefixed: prefixed\r\n});\r\n\r\n// this prevents errors when NGHammer is loaded in the presence of an AMD\r\n//  style loader but by script tag, not by the loader.\r\nvar freeGlobal = (typeof window !== 'undefined' ? window : (typeof self !== 'undefined' ? self : {})); // jshint ignore:line\r\nfreeGlobal.NGHammer = NGHammer;\r\n\r\nif ( true && __webpack_require__.amdD.amdDISABLED) {\r\n    !(__WEBPACK_AMD_DEFINE_RESULT__ = (function() {\r\n        return NGHammer;\r\n    }).call(exports, __webpack_require__, exports, module),\n\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\r\n} else if (typeof module != 'undefined' && module.exports) {\r\n    module.exports = NGHammer;\r\n} else {\r\n    window[exportName] = NGHammer;\r\n}\r\n\r\n})(window, document, 'NGHammer');\r\n\r\n\r\n\r\n\r\n\r\n\r\n// END NANOGALLERY2\r\n// }( jQuery )));\r\n}));\r\n\r\n\r\n//##########################################################################################################################\r\n//##########################################################################################################################\r\n//##########################################################################################################################\r\n//##########################################################################################################################\r\n//##########################################################################################################################\r\n\r\n// nanogallery2 auto start whithout javascript call\r\n(function(){\r\n  'use strict';\r\n  jQuery(document).ready(function () {\r\n  \r\n    // var t=document.querySelectorAll('[data-nanogallery2-portable]');\r\n    // if( t.length > 0 ) {\r\n      // portable mode\r\n      // var link = document.createElement('link');\r\n      // link.setAttribute(\"rel\", \"stylesheet\");\r\n      // link.setAttribute(\"type\", \"text/css\");\r\n      // link.onload = function(){\r\n        // for( var i=0; i < t.length; i++ ) {\r\n          // jQuery(t[i]).nanogallery2(jQuery(t[i]).data('nanogallery2-portable'));\r\n        // }\r\n      // }\r\n      // link.setAttribute(\"href\", '//nano.gallery/css/nanogallery2.css');\r\n      // document.getElementsByTagName(\"head\")[0].appendChild(link);\r\n    // }\r\n    // else {\r\n      // standard mode\r\n      var t=document.querySelectorAll('[data-nanogallery2]');\r\n      for( var i=0; i < t.length; i++ ) {\r\n        jQuery( t[i] ).nanogallery2( jQuery(t[i]).data('nanogallery2') );\r\n      }\r\n    // }\r\n    \r\n  });\r\n}).call(null);\r\n\r\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvbmFub2dhbGxlcnkyL3NyYy9qcXVlcnkubmFub2dhbGxlcnkyLmNvcmUuanMuanMiLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxJQUEwQztBQUNsRDtBQUNBO0FBQ0EsUUFBUSxpQ0FBTyxDQUFDLHlFQUFRLENBQUMsb0NBQUUsT0FBTztBQUFBO0FBQUE7QUFBQSxrR0FBQztBQUNuQyxNQUFNLEtBQUssRUFNTjtBQUNMLENBQUM7QUFDRCxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsb0JBQW9CO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLE1BQU07QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdURBQXVEO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEIsSUFBSSxNQUFNO0FBQ1YseUJBQXlCLE1BQU07QUFDL0I7QUFDQSxLQUFLO0FBQ0w7QUFDQSxJQUFJLE1BQU07QUFDVixJQUFJLE1BQU07QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCO0FBQ3hCLElBQUksTUFBTTtBQUNWLHlCQUF5QixNQUFNO0FBQy9CO0FBQ0EsS0FBSztBQUNMO0FBQ0EsSUFBSSxNQUFNO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsTUFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QztBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsMkJBQTJCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQywyQkFBMkI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQywyQkFBMkI7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLDBDQUEwQztBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLEdBQUc7QUFDNUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQUFtQjtBQUNuQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QztBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQSxrREFBa0Q7QUFDbEQsa0RBQWtEO0FBQ2xEO0FBQ0Esa0RBQWtEO0FBQ2xELGtEQUFrRDtBQUNsRCxrREFBa0Q7QUFDbEQsa0RBQWtEO0FBQ2xELGtEQUFrRDtBQUNsRCxrREFBa0Q7QUFDbEQsa0RBQWtEO0FBQ2xELGtEQUFrRDtBQUNsRCxrREFBa0Q7QUFDbEQsa0RBQWtEO0FBQ2xELGtEQUFrRDtBQUNsRDtBQUNBLGtEQUFrRDtBQUNsRDtBQUNBLGtEQUFrRDtBQUNsRDtBQUNBLGtEQUFrRDtBQUNsRCx3QkFB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSzs7QUFFTCxvQ0FBb0MsMENBQTBDO0FBQzlFLG9DQUFvQywwQ0FBMEM7QUFDOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHVEQUF1RDtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQ7QUFDMUQsMERBQTBEO0FBQzFEO0FBQ0EsMERBQTBEO0FBQzFELDBEQUEwRDtBQUMxRCwwREFBMEQ7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4REFBOEQ7QUFDOUQ7QUFDQTtBQUNBLDZFQUE2RTtBQUM3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RDtBQUM3RCw2REFBNkQ7QUFDN0QsZ0VBQWdFO0FBQ2hFLDZEQUE2RDtBQUM3RCw2REFBNkQ7QUFDN0QsNkRBQTZEO0FBQzdELDBEQUEwRDtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUsTUFBTTtBQUNSO0FBQ0EsZUFBZSxNQUFNO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsTUFBTTtBQUNuQixPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsNkJBQTZCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLDJCQUEyQjtBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsUUFBUTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsT0FBTztBQUN0QjtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsUUFBUTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsUUFBUTtBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkIsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixTQUFTO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxNQUFNO0FBQ2Q7QUFDQSxNQUFNLE1BQU07QUFDWixNQUFNLE1BQU07QUFDWixNQUFNLE1BQU07QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixXQUFXO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLFdBQVc7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQSx5RkFBeUY7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLFdBQVc7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsNEVBQTRFLE9BQU8sZ0JBQWdCLFFBQVE7QUFDM0c7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLE1BQU07QUFDWjtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsU0FB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Q7QUFDaEQsZ0RBQWdEO0FBQ2hELGdEQUFnRDtBQUNoRCxnREFBZ0Q7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixlQUFlO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGVBQWU7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixnQkFBZ0I7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLG1CQUFtQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHlCQUF5QjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixxQ0FBcUM7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELFdBQVc7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlFQUF5RTtBQUN6RSx5RUFBeUU7QUFDekUseUVBQXlFO0FBQ3pFLHlFQUF5RTtBQUN6RSw0RUFBNEU7QUFDNUUseUVBQXlFO0FBQ3pFLHlFQUF5RTtBQUN6RSx5RUFBeUU7QUFDekUsd0lBQXdJLGtCQUFrQjtBQUMxSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLE1BQU07QUFDckI7QUFDQSw0RkFBNEYsS0FBSyxRQUFRLFNBQVMsY0FBYyxNQUFNO0FBQ3RJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5REFBeUQ7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixNQUFNO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixZQUFZO0FBQ2xDLHNCQUFzQixZQUFZO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0U7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzRUFBc0U7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQ7QUFDckQsWUFBWSxNQUFNO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixNQUFNO0FBQzNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLE1BQU07QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixPQUFPO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLFVBQVU7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQztBQUMzQztBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0EsMkNBQTJDO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEM7QUFDNUM7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVc7QUFDWDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQztBQUNwQztBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0VBQXNFO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQ7QUFDckQsMkRBQTJEO0FBQzNELHFEQUFxRDtBQUNyRCx3REFBd0Q7QUFDeEQsbURBQW1EO0FBQ25EO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRKQUE0SixRQUFRLG9EQUFvRDtBQUN4TjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQztBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUNBQXFDLFFBQVE7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QyxRQUFRO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxZQUFZO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFD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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RDtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEI7QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RCxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE1BQU07QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsc0JBQXNCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxxQkFBcUI7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE9BQU87QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxPQUFPO0FBQ2hCO0FBQ0E7QUFDQSxnQkFBZ0IsZ0JBQWdCO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLHNFQUFzRTtBQUN0RTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKLEdBQUc7QUFDSDtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsUUFBUTtBQUNyQixhQUFhLGtCQUFrQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsUUFBUTtBQUNyQixhQUFhLFFBQVE7QUFDckIsY0FBYyxRQUFRO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLFFBQVE7QUFDckIsYUFBYSxRQUFRO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLFFBQVE7QUFDckIsYUFBYSxRQUFRO0FBQ3JCLGFBQWEsUUFBUTtBQUNyQjtBQUNBLGFBQWEsUUFBUTtBQUNyQjtBQUNBLGFBQWEsUUFBUTtBQUNyQixhQUFhLFFBQVE7QUFDckIsYUFBYSxRQUFRO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsUUFBUTtBQUNyQixhQUFhLFFBQVE7QUFDckIsYUFBYSxVQUFVO0FBQ3ZCLGFBQWEsUUFBUTtBQUNyQjtBQUNBLGNBQWMsUUFBUTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSxhQUFhO0FBQzFCO0FBQ0EsYUFBYSxRQUFRO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsYUFBYTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsVUFBVTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjLFNBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsMkJBQTJCO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLFNBQVMsS0FBNEIsSUFBSSx3QkFBTTtBQUNuRDtBQUNBLElBQUksbUNBQU8sYUFBYSxvQkFBb0I7QUFBQSxrR0FBQztBQUM3QyxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsNkJBQTZCO0FBQzdCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QixzQkFBc0I7QUFDdEIsNkJBQTZCO0FBQzdCO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLCtCQUErQjtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBC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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixXQUFXLFFBQVE7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsYUFBYSxRQUFRO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxPQUFPO0FBQ2xCLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsV0FBVyxRQUFRO0FBQ25CLFdBQVcsUUFBUTtBQUNuQixZQUFZLFFBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLFFBQVE7QUFDbkIsV0FBVyxRQUFRO0FBQ25CLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxRQUFRLElBQUk7QUFDdkIsV0FBVyxRQUFRLElBQUk7QUFDdkIsV0FBVyxPQUFPO0FBQ2xCLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixXQUFXLFFBQVE7QUFDbkIsV0FBVyxPQUFPO0FBQ2xCLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQUFXLE9BQU87QUFDbEIsV0FBVyxPQUFPO0FBQ2xCLFlBQVksUUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxPQUFPO0FBQ2xCLFdBQVcsT0FBTztBQUNsQixZQUFZLFFBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLFVBQVU7QUFDVixXQUFXLFFBQVE7QUFDbkIsV0FBVyxRQUFRO0FBQ25CLGFBQWEsaUJBQWlCO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFdBQVcsYUFBYTtBQUN4QixXQUFXLFFBQVE7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsY0FBYztBQUMxQywyQkFBMkIsY0FBYztBQUN6QywyQkFBMkIsZ0NBQWdDO0FBQzNELHlCQUF5QixnQ0FBZ0M7QUFDekQ7QUFDQSx5QkFBeUIsNEJBQTRCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxhQUFhO0FBQ3hCLFdBQVcsUUFBUTtBQUNuQjtBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsa0NBQWtDO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsU0FBUztBQUN4QjtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUU7QUFDbkU7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsZUFBZSxtQkFBbUI7QUFDbEMsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHdCQUF3QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSxZQUFZO0FBQzNCLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGVBQWUsbUJBQW1CO0FBQ2xDLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFVBQVU7QUFDekIsaUJBQWlCLGNBQWM7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsZUFBZSxRQUFRO0FBQ3ZCLGVBQWUsVUFBVTtBQUN6QixpQkFBaUIsY0FBYztBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLGVBQWUsUUFBUTtBQUN2QixlQUFlLFFBQVE7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FBVyxTQUFTO0FBQ3BCLFdBQVcsU0FBUztBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsUUFBUTtBQUNuQixXQUFXLFFBQVE7QUFDbkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxtR0FBbUcsSUFBSTtBQUN2RztBQUNBO0FBQ0EsSUFBSSxLQUE0QixJQUFJLHdCQUFNO0FBQzFDLElBQUksbUNBQU87QUFDWDtBQUNBLEtBQUs7QUFBQSxrR0FBQztBQUNOLEVBQUU7QUFDRjtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFLE1BQU07QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLGNBQWM7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLGNBQWM7QUFDbEMsUUFBUSxNQUFNLHVCQUF1QixNQUFNO0FBQzNDO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxDQUFDO0FBQ0QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vY3ctaHVnby10aGVtZXMvLi9ub2RlX21vZHVsZXMvbmFub2dhbGxlcnkyL3NyYy9qcXVlcnkubmFub2dhbGxlcnkyLmNvcmUuanM/Nzc5ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKioqIElNUE9SVFMgRlJPTSBpbXBvcnRzLWxvYWRlciAqKiovXG52YXIgbW9kdWxlID0gKG1vZHVsZSB8fCB7fSk7XG5tb2R1bGUuZXhwb3J0cyA9IHVuZGVmaW5lZDtcbnZhciBleHBvcnRzID0gdW5kZWZpbmVkO1xuXG4vKiohXHJcbiAqIEBwcmVzZXJ2ZSBuYW5vZ2FsbGVyeTIgLSBqYXZhc2NyaXB0IHBob3RvIC8gdmlkZW8gZ2FsbGVyeSBhbmQgbGlnaHRib3hcclxuICogSG9tZXBhZ2U6IGh0dHA6Ly9uYW5vZ2FsbGVyeTIubmFub3N0dWRpby5vcmdcclxuICogU291cmNlczogIGh0dHBzOi8vZ2l0aHViLmNvbS9uYW5vc3R1ZGlvLW9yZy9uYW5vZ2FsbGVyeTJcclxuICpcclxuICogTGljZW5zZTogIEdQTHYzIGFuZCBjb21tZXJjaWFsIGxpY2VuY2VcclxuICogXHJcbiAqIFJlcXVpcmVtZW50czpcclxuICogIC0galF1ZXJ5IChodHRwOi8vd3d3LmpxdWVyeS5jb20pIC0gdmVyc2lvbiA+PSAxLjcuMVxyXG4gKlxyXG4gKiBFbWJlZGVkIGNvbXBvbmVudHM6XHJcbiAqICAtIHNoaWZ0eSAoaHR0cHM6Ly9naXRodWIuY29tL2plcmVteWNrYWhuL3NoaWZ0eSlcclxuICogIC0gaW1hZ2VzbG9hZGVkIChodHRwczovL2dpdGh1Yi5jb20vZGVzYW5kcm8vaW1hZ2VzbG9hZGVkKVxyXG4gKiAgLSBoYW1tZXIuanMgKGh0dHA6Ly9oYW1tZXJqcy5naXRodWIuaW8vKVxyXG4gKiAgLSBzY3JlZW5mdWxsLmpzIChodHRwczovL2dpdGh1Yi5jb20vc2luZHJlc29yaHVzL3NjcmVlbmZ1bGwuanMpXHJcbiAqIFRvb2xzOlxyXG4gKiAgLSB3ZWJmb250IGdlbmVyYXRlZCB3aXRoIGh0dHA6Ly9mb250ZWxsby5jb20gLSBtYWlubHkgYmFzZWQgb24gRm9udCBBd2Vzb21lIENvcHlyaWdodCAoQykgMjAxMiBieSBEYXZlIEdhbmR5IChodHRwOi8vZm9udGF3ZXNvbWUuaW8vKVxyXG4gKiAgLSBJQ08gb25saW5lIGNvbnZlcnRlcjogaHR0cHM6Ly9pY29udmVydGljb25zLmNvbS9vbmxpbmUvXHJcbiAqL1xyXG5cclxuIFxyXG4gXHJcbi8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuLy8gIyMjIyMgbmFub2dhbGxlcnkyIGFzIGEgSlFVRVJZIFBMVUdJTiAjIyMjI1xyXG4vLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG5cclxuLy8gRXhwb3NlIHBsdWdpbiBhcyBhbiBBTUQgbW9kdWxlIGlmIEFNRCBsb2FkZXIgaXMgcHJlc2VudDpcclxuKGZ1bmN0aW9uIChmYWN0b3J5KSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcclxuICAgICAgICAvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuXHJcbiAgICAgICAgLy8gZGVmaW5lKCduYW5vZ2FsbGVyeTInLCBbJ2pxdWVyeSddLCBmYWN0b3J5KTtcclxuICAgICAgICBkZWZpbmUoWydqcXVlcnknXSwgZmFjdG9yeSk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgcmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIC8vIEJyb3dzZXJpZnlcclxuICAgICAgICBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gQnJvd3NlciBnbG9iYWxzXHJcbiAgICAgICAgZmFjdG9yeShqUXVlcnkpO1xyXG4gICAgfVxyXG59KGZ1bmN0aW9uICgkKSB7XHJcbi8vIDsoZnVuY3Rpb24gKCQpIHtcclxuICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgLy8jIyMjIyBUT09MUy9IRUxQRVJTICMjIyNcclxuXHJcbiAgLy8gQ29udmVydCBjb2xvciB0byBSR0IvUkdCQVxyXG4gIGZ1bmN0aW9uIENvbG9ySGVscGVyVG9SR0IoIGNvbG9yICkge1xyXG4gICAgdmFyIG9iaiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZ3lDb2xvckhlbHBlclRvUkdCJyk7XHJcbiAgICBpZiAob2JqID09PSBudWxsKSB7XHJcbiAgICAgIG9iaiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICBvYmouaWQgPSBcIm5neUNvbG9ySGVscGVyVG9SR0JcIjtcclxuICAgICAgb2JqLnN0eWxlLmNzc1RleHQgPSAnZGlzcGxheTogbm9uZTsgY29sb3I6JyArIGNvbG9yICsgJzsnO1xyXG4gICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG9iaik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHZhciByZ2IgPSBnZXRDb21wdXRlZFN0eWxlKG9iaikuY29sb3I7XHJcblxyXG4gICAgLy8gdG8gZ2V0IEhFWCB2YWx1ZTpcclxuICAgIC8vIHZhciByZ2IgPSBnZXRDb21wdXRlZFN0eWxlKG9iaikuY29sb3IubWF0Y2goL1xcZCsvZyk7XHJcbiAgICAvLyB2YXIgciA9IHBhcnNlSW50KHJnYlswXSkudG9TdHJpbmcoMTYpO1xyXG4gICAgLy8gdmFyIGcgPSBwYXJzZUludChyZ2JbMV0pLnRvU3RyaW5nKDE2KTtcclxuICAgIC8vIHZhciBiID0gcGFyc2VJbnQocmdiWzJdKS50b1N0cmluZygxNik7XHJcbiAgICAvLyB2YXIgaGV4ID0gJyMnICsgciArIGcgKyBiO1xyXG5cclxuICAgIHJldHVybiByZ2I7XHJcbiAgfVxyXG5cclxuICBcclxuICAvLyAjIyMjIyBoZWxwZXIgZm9yIGNvbG9yIGhhbmRsaW5nXHJcbiAgLy8gLSBub3JtYWxpc2UgUkdCL1JHQkEvSEVYIGZvcm1hdFxyXG4gIC8vIC0gbGlnaHRlbi9kYXJrZW4gY29sb3JcclxuICAvLyBJbnNwaXJlZCBieTogICAgICAgICAgXHJcbiAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNTU2MDI0OC9wcm9ncmFtbWF0aWNhbGx5LWxpZ2h0ZW4tb3ItZGFya2VuLWEtaGV4LWNvbG9yLW9yLXJnYi1hbmQtYmxlbmQtY29sb3JzXHJcbiAgLy8gaHR0cDovL3d3dy5waW1wdHJpemtpdC5jb20vP3Q9MjAlMjBTaGFkZXNcclxuICBmdW5jdGlvbiBTaGFkZUJsZW5kQ29udmVydCAocCwgZnJvbSwgdG8pIHtcclxuICAgIHZhciByZ2JhPScnO1xyXG4gICAgaWYoIGZyb20udG9VcHBlckNhc2UoKS5zdWJzdHJpbmcoMCw1KSA9PSAnUkdCQSgnICkge1xyXG4gICAgICByZ2JhPSdhJztcclxuICAgICAgZnJvbT0ncmdiKCcrZnJvbS5zdWJzdHJpbmcoNSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYodHlwZW9mKHApIT1cIm51bWJlclwifHxwPC0xfHxwPjF8fHR5cGVvZihmcm9tKSE9XCJzdHJpbmdcInx8KGZyb21bMF0hPSdyJyYmZnJvbVswXSE9JyMnKXx8KHR5cGVvZih0bykhPVwic3RyaW5nXCImJnR5cGVvZih0bykhPVwidW5kZWZpbmVkXCIpKXJldHVybiBudWxsO1xyXG4gICAgLy9pZighdGhpcy5zYmNSaXApdGhpcy5zYmNSaXA9ZnVuY3Rpb24oZCl7XHJcbiAgICBmdW5jdGlvbiBzYmNSaXAoZCl7XHJcbiAgICAgIHZhciBsPWQubGVuZ3RoLFJHQj1uZXcgT2JqZWN0KCk7XHJcbiAgICAgIGlmKGw+OSl7XHJcbiAgICAgICAgZD1kLnNwbGl0KFwiLFwiKTtcclxuICAgICAgICBpZihkLmxlbmd0aDwzfHxkLmxlbmd0aD40KXJldHVybiBudWxsO1xyXG4gICAgICAgIFJHQlswXT1pKGRbMF0uc2xpY2UoNCkpLFJHQlsxXT1pKGRbMV0pLFJHQlsyXT1pKGRbMl0pLFJHQlszXT1kWzNdP3BhcnNlRmxvYXQoZFszXSk6LTE7XHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIGlmKGw9PTh8fGw9PTZ8fGw8NClyZXR1cm4gbnVsbDtcclxuICAgICAgICBpZihsPDYpZD1cIiNcIitkWzFdK2RbMV0rZFsyXStkWzJdK2RbM10rZFszXSsobD40P2RbNF0rXCJcIitkWzRdOlwiXCIpO1xyXG4gICAgICAgIGQ9aShkLnNsaWNlKDEpLDE2KSxSR0JbMF09ZD4+MTYmMjU1LFJHQlsxXT1kPj44JjI1NSxSR0JbMl09ZCYyNTUsUkdCWzNdPWw9PTl8fGw9PTU/cigoKGQ+PjI0JjI1NSkvMjU1KSoxMDAwMCkvMTAwMDA6LTE7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIFJHQjtcclxuICAgIH1cclxuICAgIHZhciBpPXBhcnNlSW50LHI9TWF0aC5yb3VuZCxoPWZyb20ubGVuZ3RoPjksaD10eXBlb2YodG8pPT1cInN0cmluZ1wiP3RvLmxlbmd0aD45P3RydWU6dG89PVwiY1wiPyFoOmZhbHNlOmgsYj1wPDAscD1iP3AqLTE6cCx0bz10byYmdG8hPVwiY1wiP3RvOmI/XCIjMDAwMDAwXCI6XCIjRkZGRkZGXCIsZj1zYmNSaXAoZnJvbSksdD1zYmNSaXAodG8pO1xyXG4gICAgaWYoIWZ8fCF0KXJldHVybiBudWxsO1xyXG4gICAgaWYoaClyZXR1cm4gXCJyZ2JcIityZ2JhK1wiKFwiK3IoKHRbMF0tZlswXSkqcCtmWzBdKStcIixcIityKCh0WzFdLWZbMV0pKnArZlsxXSkrXCIsXCIrcigodFsyXS1mWzJdKSpwK2ZbMl0pKyhmWzNdPDAmJnRbM108MD9cIilcIjpcIixcIisoZlszXT4tMSYmdFszXT4tMT9yKCgodFszXS1mWzNdKSpwK2ZbM10pKjEwMDAwKS8xMDAwMDp0WzNdPDA/ZlszXTp0WzNdKStcIilcIik7XHJcbiAgICBlbHNlIHJldHVybiBcIiNcIisoMHgxMDAwMDAwMDArKGZbM10+LTEmJnRbM10+LTE/cigoKHRbM10tZlszXSkqcCtmWzNdKSoyNTUpOnRbM10+LTE/cih0WzNdKjI1NSk6ZlszXT4tMT9yKGZbM10qMjU1KToyNTUpKjB4MTAwMDAwMCtyKCh0WzBdLWZbMF0pKnArZlswXSkqMHgxMDAwMCtyKCh0WzFdLWZbMV0pKnArZlsxXSkqMHgxMDArcigodFsyXS1mWzJdKSpwK2ZbMl0pKS50b1N0cmluZygxNikuc2xpY2UoZlszXT4tMXx8dFszXT4tMT8xOjMpO1xyXG4gIH1cclxuICBcclxuICBcclxuICAvLyAjIyMjIyBjbG9uZSBhIGphdmFzY3JpcHQgb2JqZWN0XHJcbiAgZnVuY3Rpb24gY2xvbmVKU09iamVjdCggb2JqICkge1xyXG4gICAgaWYgKG9iaiA9PT0gbnVsbCB8fCB0eXBlb2Ygb2JqICE9PSAnb2JqZWN0Jykge1xyXG4gICAgICByZXR1cm4gb2JqO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciB0ZW1wID0gb2JqLmNvbnN0cnVjdG9yKCk7IC8vIGdpdmUgdGVtcCB0aGUgb3JpZ2luYWwgb2JqJ3MgY29uc3RydWN0b3JcclxuICAgIGZvciAodmFyIGtleSBpbiBvYmopIHtcclxuICAgICAgICB0ZW1wW2tleV0gPSBjbG9uZUpTT2JqZWN0KG9ialtrZXldKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0ZW1wO1xyXG4gIH1cclxuICBcclxuICAvLyBnZXQgdmlld3BvcnQgY29vcmRpbmF0ZXMgYW5kIHNpemVcclxuICBmdW5jdGlvbiBnZXRWaWV3cG9ydCgpIHtcclxuICAgIHZhciAkd2luID0galF1ZXJ5KHdpbmRvdyk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsOiAkd2luLnNjcm9sbExlZnQoKSxcclxuICAgICAgdDogJHdpbi5zY3JvbGxUb3AoKSxcclxuICAgICAgdzogJHdpbi53aWR0aCgpLFxyXG4gICAgICBoOiAkd2luLmhlaWdodCgpXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLy8gYXZvaWQgaWYgcG9zc2libGUgKHBlcmZvcm1hbmNlIGlzc3VlKVxyXG4gIGZ1bmN0aW9uIGluVmlld3BvcnQoICRlbHQsIHRocmVzaG9sZCApIHtcclxuICAgIHZhciB3cCA9IGdldFZpZXdwb3J0KCksXHJcbiAgICBlbHRPUyA9ICRlbHQub2Zmc2V0KCksXHJcbiAgICB0aCA9ICRlbHQub3V0ZXJIZWlnaHQodHJ1ZSksXHJcbiAgICB0dyA9ICRlbHQub3V0ZXJXaWR0aCh0cnVlKTtcclxuICAgIGlmKCBlbHRPUy50b3AgPj0gKHdwLnQgLSB0aHJlc2hvbGQpIFxyXG4gICAgICAmJiAoZWx0T1MudG9wICsgdGgpIDw9ICh3cC50ICsgd3AuaCArIHRocmVzaG9sZClcclxuICAgICAgJiYgZWx0T1MubGVmdCA+PSAod3AubCAtIHRocmVzaG9sZCkgXHJcbiAgICAgICYmIChlbHRPUy5sZWZ0ICsgdHcpIDw9ICh3cC5sICsgd3AudyArIHRocmVzaG9sZCkgKSB7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIGF2b2lkIGlmIHBvc3NpYmxlIChwZXJmb3JtYW5jZSBpc3N1ZSlcclxuICBmdW5jdGlvbiBpblZpZXdwb3J0VmVydCggJGVsdCwgdGhyZXNob2xkICkge1xyXG4gICAgdmFyIHdwID0gZ2V0Vmlld3BvcnQoKSxcclxuICAgIGVsdE9TID0gJGVsdC5vZmZzZXQoKSxcclxuICAgIHRoID0gJGVsdC5vdXRlckhlaWdodCh0cnVlKTtcclxuICAgIC8vdmFyIHR3PSRlbHQub3V0ZXJXaWR0aCh0cnVlKTtcclxuXHJcbiAgICBpZiggd3AudCA9PSAwICYmIChlbHRPUy50b3ApIDw9ICh3cC50ICsgd3AuaCApICkgeyByZXR1cm4gdHJ1ZTsgfVxyXG5cclxuICAgIGlmKCBlbHRPUy50b3AgPj0gKHdwLnQpIFxyXG4gICAgICAmJiAoZWx0T1MudG9wICsgdGgpIDw9ICh3cC50ICsgd3AuaCAtIHRocmVzaG9sZCkgKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIC8vIHNldCB6LWluZGV4IHRvIGRpc3BsYXkgMiBlbGVtZW50cyBvbiB0b3Agb2YgYWxsIG90aGVyc1xyXG4gIGZ1bmN0aW9uIHNldDJFbGVtZW50c09uVG9wKCBzdGFydCwgZWx0MSwgZWx0MiApIHtcclxuICAgIHZhciBoaWdoZXN0X2luZGV4ID0gMDtcclxuICAgIGlmKCBzdGFydD09JycgKSB7IHN0YXJ0PSAnKic7IH1cclxuICAgIGpRdWVyeShzdGFydCkuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgdmFyIGN1ciA9IHBhcnNlSW50KGpRdWVyeSh0aGlzKS5jc3MoJ3otaW5kZXgnKSk7XHJcbiAgICAgIGhpZ2hlc3RfaW5kZXggPSBjdXIgPiBoaWdoZXN0X2luZGV4ID8gY3VyIDogaGlnaGVzdF9pbmRleDtcclxuICAgIH0pO1xyXG4gICAgaGlnaGVzdF9pbmRleCsrO1xyXG4gICAgalF1ZXJ5KGVsdDIpLmNzcygnei1pbmRleCcsaGlnaGVzdF9pbmRleCsxKTtcclxuICAgIGpRdWVyeShlbHQxKS5jc3MoJ3otaW5kZXgnLGhpZ2hlc3RfaW5kZXgpO1xyXG4gIH1cclxuXHJcbiAgLy8gc2V0IHotaW5kZXggdG8gZGlzcGxheSBlbGVtZW50IG9uIHRvcCBvZiBhbGwgb3RoZXJzXHJcbiAgZnVuY3Rpb24gc2V0RWxlbWVudE9uVG9wKCBzdGFydCwgZWx0ICkge1xyXG4gICAgdmFyIGhpZ2hlc3RfaW5kZXggPSAwO1xyXG4gICAgaWYoIHN0YXJ0ID09ICcnICkgeyBzdGFydCA9ICcqJzsgfVxyXG4gICAgalF1ZXJ5KHN0YXJ0KS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgY3VyID0gcGFyc2VJbnQoalF1ZXJ5KHRoaXMpLmNzcygnei1pbmRleCcpKTtcclxuICAgICAgaGlnaGVzdF9pbmRleCA9IGN1ciA+IGhpZ2hlc3RfaW5kZXggPyBjdXIgOiBoaWdoZXN0X2luZGV4O1xyXG4gICAgfSk7XHJcbiAgICBoaWdoZXN0X2luZGV4Kys7XHJcbiAgICBqUXVlcnkoZWx0KS5jc3MoJ3otaW5kZXgnLGhpZ2hlc3RfaW5kZXgpO1xyXG4gIH1cclxuICBcclxuICAvLyByZXR1cm4gdGhlIHJlYWwgdHlwZSBvZiB0aGUgb2JqZWN0XHJcbiAgdmFyIHRvVHlwZSA9IGZ1bmN0aW9uKCBvYmogKSB7XHJcbiAgICAvLyBieSBBbmd1cyBDcm9sbCAtIGh0dHA6Ly9qYXZhc2NyaXB0d2VibG9nLndvcmRwcmVzcy5jb20vMjAxMS8wOC8wOC9maXhpbmctdGhlLWphdmFzY3JpcHQtdHlwZW9mLW9wZXJhdG9yL1xyXG4gICAgcmV0dXJuICh7fSkudG9TdHJpbmcuY2FsbChvYmopLm1hdGNoKC9cXHMoW2EtekEtWl0rKS8pWzFdLnRvTG93ZXJDYXNlKClcclxuICB9OyAgICBcclxuICAgIFxyXG5cclxuICAkLm5hbm9nYWxsZXJ5MiA9IGZ1bmN0aW9uIChlbHQsIG9wdGlvbnMpIHtcclxuICAgIC8vIFRvIGF2b2lkIHNjb3BlIGlzc3VlcywgdXNlICdfdGhpcycgaW5zdGVhZCBvZiAndGhpcydcclxuICAgIC8vIHRvIHJlZmVyZW5jZSB0aGlzIGNsYXNzIGZyb20gaW50ZXJuYWwgZXZlbnRzIGFuZCBmdW5jdGlvbnMuXHJcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG5cclxuICAgIC8vIEFjY2VzcyB0byBqUXVlcnkgYW5kIERPTSB2ZXJzaW9ucyBvZiBlbGVtZW50XHJcbiAgICBfdGhpcy4kZSAgPSBqUXVlcnkoZWx0KTtcclxuICAgIF90aGlzLmUgICA9IGVsdDtcclxuXHJcbiAgICAvLyBBZGQgYSByZXZlcnNlIHJlZmVyZW5jZSB0byB0aGUgRE9NIG9iamVjdFxyXG4gICAgX3RoaXMuJGUuZGF0YSgnbmFub2dhbGxlcnkyZGF0YScsIF90aGlzKTtcclxuXHJcbiAgICBfdGhpcy5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gIFxyXG4gICAgICAvLyBkZWZpbmUgdGhlc2UgZ2xvYmFsIG9iamVjdHMgb25seSBvbmNlIHBlciBIVE1MIHBhZ2VcclxuICAgICAgaWYgKHR5cGVvZiB3aW5kb3cuTkdZMkl0ZW0gPT09ICd1bmRlZmluZWQnKSB7XHJcbiAgXHJcbiAgICAgICAgd2luZG93Lk5HWTJUb29scyA9IChmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgZnVuY3Rpb24gTkdZMlRvb2xzKCkge1xyXG4gICAgICAgICAgICB2YXIgbmV4dElkID0gMTsgICAgICAgICAgICAgICAgICAgLy8gcHJpdmF0ZSBzdGF0aWMgLS0+IGFsbCBpbnN0YW5jZXNcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBjaGVjayBhbGJ1bSBuYW1lIC0gYWxidW1MaXN0L2JsYWNrTGlzdC93aGl0ZUxpc3RcclxuICAgICAgICAgIE5HWTJUb29scy5GaWx0ZXJBbGJ1bU5hbWUgPSBmdW5jdGlvbiggdGl0bGUsIElEICkge1xyXG4gICAgICAgICAgICB2YXIgcyA9IHRpdGxlLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIGlmKCB0aGlzLmFsYnVtTGlzdC5sZW5ndGggPiAwICkge1xyXG4gICAgICAgICAgICAgIGZvciggdmFyIGo9MDsgaiA8IHRoaXMuYWxidW1MaXN0Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiggcyA9PT0gdGhpcy5hbGJ1bUxpc3Rbal0udG9VcHBlckNhc2UoKSB8fCBJRCA9PT0gdGhpcy5hbGJ1bUxpc3Rbal0gKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICBpZiggdGhpcy53aGl0ZUxpc3QgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgICAvL3doaXRlTGlzdCA6IGF1dGhvcml6ZSBvbmx5IGFsYnVtIGNvaW50YWluaW5nIG9uZSBvZiB0aGUgc3BlY2lmaWVkIGtleXdvcmQgaW4gdGhlIHRpdGxlXHJcbiAgICAgICAgICAgICAgICBmb3IoIHZhciBqID0gMDsgaiA8IHRoaXMud2hpdGVMaXN0Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmKCBzLmluZGV4T2YodGhpcy53aGl0ZUxpc3Rbal0pICE9PSAtMSApIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKCAhZm91bmQgKSB7IHJldHVybiBmYWxzZTsgfVxyXG4gICAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAgIGlmKCB0aGlzLmJsYWNrTGlzdCAhPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgICAgIC8vYmxhY2tMaXN0IDogaWdub3JlIGFsYnVtIGNvaW50YWluaW5nIG9uZSBvZiB0aGUgc3BlY2lmaWVkIGtleXdvcmQgaW4gdGhlIHRpdGxlXHJcbiAgICAgICAgICAgICAgICBmb3IoIHZhciBqID0gMDsgaiA8IHRoaXMuYmxhY2tMaXN0Lmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmKCBzLmluZGV4T2YodGhpcy5ibGFja0xpc3Rbal0pICE9PSAtMSApIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG5cclxuXHJcbiAgICAgICAgICAvKiogQGZ1bmN0aW9uIG5hbm9BbGVydCAqL1xyXG4gICAgICAgICAgLyogRGlzcGxheSBhbiBhbGVydCBtZXNzYWdlIGluIGEgc3BlY2lmaWMgZWxlbWVudCAqL1xyXG4gICAgICAgICAgTkdZMlRvb2xzLk5hbm9BbGVydCA9IGZ1bmN0aW9uKGNvbnRleHQsIG1zZywgdmVyYm9zZSkge1xyXG4gICAgICAgICAgICBOR1kyVG9vbHMuTmFub0NvbnNvbGVMb2cuY2FsbChjb250ZXh0LCBtc2cpO1xyXG4gICAgICAgICAgICBpZiggY29udGV4dC4kRS5jb25Db25zb2xlICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgY29udGV4dC4kRS5jb25Db25zb2xlLmNzcyh7dmlzaWJpbGl0eTogJ3Zpc2libGUnLCBtaW5IZWlnaHQ6ICcxMDBweCd9KTtcclxuICAgICAgICAgICAgICBpZiggdmVyYm9zZSA9PSBmYWxzZSApIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuJEUuY29uQ29uc29sZS5hcHBlbmQoJzxwPicgKyBtc2cgKyAnPC9wPicpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuJEUuY29uQ29uc29sZS5hcHBlbmQoJzxwPm5hbm9nYWxsZXJ5MjogJysgbXNnICsgJyBbJyArIGNvbnRleHQuYmFzZUVsdElEICsgJ108L3A+Jyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgXHJcbiAgICAgICAgICAvKiogQGZ1bmN0aW9uIE5hbm9Db25zb2xlTG9nICovXHJcbiAgICAgICAgICAvKiB3cml0ZSBtZXNzYWdlIHRvIHRoZSBicm93c2VyIGNvbnNvbGUgKi9cclxuICAgICAgICAgIE5HWTJUb29scy5OYW5vQ29uc29sZUxvZyA9IGZ1bmN0aW9uKGNvbnRleHQsIG1zZykge1xyXG4gICAgICAgICAgICBpZiAod2luZG93LmNvbnNvbGUpIHsgY29uc29sZS5sb2coJ25hbm9nYWxsZXJ5MjogJyArIG1zZyArICcgWycgKyBjb250ZXh0LmJhc2VFbHRJRCArICddJyk7IH1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBcclxuXHJcbiAgICAgICAgICAvKiogQGZ1bmN0aW9uIFByZWxvYWRlckRpc3BsYXkoKSAqL1xyXG4gICAgICAgICAgLyogRGlzcGxheS9oaWRlIHByZWxvYWRlciAqL1xyXG4gICAgICAgICAgTkdZMlRvb2xzLlByZWxvYWRlckRpc3BsYXkgPSBmdW5jdGlvbihkaXNwbGF5KSB7XHJcbiAgICAgICAgICAgIGlmKCBkaXNwbGF5ID09PSB0cnVlICkge1xyXG4gICAgICAgICAgICAgIHRoaXMuJEUuY29uTG9hZGluZ0IucmVtb3ZlQ2xhc3MoJ25hbm9HYWxsZXJ5TEJhck9mZicpLmFkZENsYXNzKCduYW5vR2FsbGVyeUxCYXInKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICB0aGlzLiRFLmNvbkxvYWRpbmdCLnJlbW92ZUNsYXNzKCduYW5vR2FsbGVyeUxCYXInKS5hZGRDbGFzcygnbmFub0dhbGxlcnlMQmFyT2ZmJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgLy8rIEpvbmFzIFJhb25pIFNvYXJlcyBTaWx2YVxyXG4gICAgICAgICAgLy9AIGh0dHA6Ly9qc2Zyb21oZWxsLmNvbS9hcnJheS9zaHVmZmxlIFt2MS4wXVxyXG4gICAgICAgICAgTkdZMlRvb2xzLkFyZWFTaHVmZmxlID0gZnVuY3Rpb24gKG8pIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaiwgeCwgaSA9IG8ubGVuZ3RoOyBpOyBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogaSksIHggPSBvWy0taV0sIG9baV0gPSBvW2pdLCBvW2pdID0geCk7XHJcbiAgICAgICAgICAgIHJldHVybiBvO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLyoqIEBmdW5jdGlvbiBHZXRJbWFnZVRpdGxlRnJvbVVSTCgpICovXHJcbiAgICAgICAgICAvKiByZXRyaWV2ZSBmaWxlbWFuZSAqL1xyXG4gICAgICAgICAgTkdZMlRvb2xzLkdldEltYWdlVGl0bGVGcm9tVVJMID0gZnVuY3Rpb24oIGltYWdlVVJMICkge1xyXG4gICAgICAgICAgICBpZiggdGhpcy5PLnRodW1ibmFpbExhYmVsLmdldCgndGl0bGUnKSA9PSAnJWZpbGVuYW1lJyApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gKGltYWdlVVJMLnNwbGl0KCcvJykucG9wKCkpLnJlcGxhY2UoJ18nLCcgJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCB0aGlzLk8udGh1bWJuYWlsTGFiZWwuZ2V0KCd0aXRsZScpID09ICclZmlsZW5hbWVOb0V4dCcgKSB7XHJcbiAgICAgICAgICAgICAgdmFyIHM9aW1hZ2VVUkwuc3BsaXQoJy8nKS5wb3AoKTtcclxuICAgICAgICAgICAgICByZXR1cm4gKHMuc3BsaXQoJy4nKS5zaGlmdCgpKS5yZXBsYWNlKCdfJywnICcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIHJldHVybiBpbWFnZVVSTDtcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIFxyXG5cclxuICAgICAgICAgIC8qKiBAZnVuY3Rpb24gQWxidW1Qb3N0UHJvY2VzcygpICovXHJcbiAgICAgICAgICAvKiBwb3N0IHByb2Nlc3Mgb25lIGFsYnVtIGJhc2VkIG9uIHBsdWdpbiBnZW5lcmFsIHBhcmFtZXRlcnMgIC0tPiBzb3J0aW5nL21heEl0ZW1zKi9cclxuICAgICAgICAgIE5HWTJUb29scy5BbGJ1bVBvc3RQcm9jZXNzID0gZnVuY3Rpb24oYWxidW1JRCkge1xyXG5cclxuICAgICAgICAgICAgLy8gdGhpcyBmdW5jdGlvbiBjYW4gcHJvYmFibHkgYmUgb3B0aW1pemVkLi4uLlxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBzb3J0T3JkZXIgPSB0aGlzLmdhbGxlcnlTb3J0aW5nW3RoaXMuR09NLmN1ck5hdkxldmVsXTtcclxuICAgICAgICAgICAgdmFyIG1heEl0ZW1zID0gdGhpcy5nYWxsZXJ5TWF4SXRlbXNbdGhpcy5HT00uY3VyTmF2TGV2ZWxdO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCBzb3J0T3JkZXIgIT0gJycgfHwgbWF4SXRlbXMgPiAwICkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgICAvLyBjb3B5IGFsYnVtJ3MgaXRlbXMgdG8gYSBuZXcgYXJyYXlcclxuICAgICAgICAgICAgICB2YXIgY3VycmVudEFsYnVtID0gdGhpcy5JLmZpbHRlciggZnVuY3Rpb24oIG9iaiApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiggb2JqLmFsYnVtSUQgPT0gYWxidW1JRCAmJiBvYmoua2luZCAhPSAnYWxidW1VcCcgKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgICAvLyBzb3J0aW5nIG9wdGlvbnNcclxuICAgICAgICAgICAgICBzd2l0Y2goIHNvcnRPcmRlciApIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1JBTkRPTSc6XHJcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRBbGJ1bSA9IE5HWTJUb29scy5BcmVhU2h1ZmZsZShjdXJyZW50QWxidW0pO1xyXG4gICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1JFVkVSU0VEJzpcclxuICAgICAgICAgICAgICAgICAgY3VycmVudEFsYnVtID0gY3VycmVudEFsYnVtLnJldmVyc2UoKTtcclxuICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdUSVRMRUFTQyc6XHJcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRBbGJ1bS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuKCAoYS50aXRsZS50b1VwcGVyQ2FzZSgpIDwgYi50aXRsZS50b1VwcGVyQ2FzZSgpKSA/IC0xIDogKChhLnRpdGxlLnRvVXBwZXJDYXNlKCkgPiBiLnRpdGxlLnRvVXBwZXJDYXNlKCkpID8gMSA6IDApICk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ1RJVExFREVTQyc6XHJcbiAgICAgICAgICAgICAgICAgIGN1cnJlbnRBbGJ1bS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuKCAoYS50aXRsZS50b1VwcGVyQ2FzZSgpID4gYi50aXRsZS50b1VwcGVyQ2FzZSgpKSA/IC0xIDogKChhLnRpdGxlLnRvVXBwZXJDYXNlKCkgPCBiLnRpdGxlLnRvVXBwZXJDYXNlKCkpID8gMSA6IDApICk7XHJcbiAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICB9ICAgICBcclxuXHJcbiAgICAgICAgICAgICAgLy8gbWF4IEl0ZW1zXHJcbiAgICAgICAgICAgICAgaWYoIG1heEl0ZW1zID4gMCAmJiBjdXJyZW50QWxidW0ubGVuZ3RoID4gbWF4SXRlbXMgKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50QWxidW0uc3BsaWNlKG1heEl0ZW1zIC0gMSwgY3VycmVudEFsYnVtLmxlbmd0aC1tYXhJdGVtcyApO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAvLyByZW1vdmUgdGhlIGFsYnVtcydzIGl0ZW1zIGZyb20gdGhlIGdsb2JhbCBpdGVtcyBhcnJheVxyXG4gICAgICAgICAgICAgIHRoaXMuSS5yZW1vdmVJZiggZnVuY3Rpb24oIG9iaiApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiggb2JqLmFsYnVtSUQgPT0gYWxidW1JRCAmJiBvYmoua2luZCAhPSAnYWxidW1VcCcgKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAvLyBhZGQgdGhlIHNvcnRlZCBpdGVtcyBiYWNrIHRvIHRoZSBhbGJ1bVxyXG4gICAgICAgICAgICAgIHRoaXMuSS5wdXNoLmFwcGx5KHRoaXMuSSwgY3VycmVudEFsYnVtKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIHJldHVybiBOR1kyVG9vbHM7XHJcbiAgICAgICAgfSkoKTsgXHJcblxyXG4gICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09XHJcbiAgICAgICAgLy8gPT09PT0gTkdZMkl0ZW0gPT09PT1cclxuICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PVxyXG4gICAgICAgIHdpbmRvdy5OR1kySXRlbSA9IChmdW5jdGlvbigpIHtcclxuICAgICAgICAgIHZhciBuZXh0SWQgPSAxOyAgICAgICAgICAgICAgICAgICAvLyBwcml2YXRlIHN0YXRpYyAtLT4gYWxsIGluc3RhbmNlc1xyXG5cclxuICAgICAgICAgIC8vIGNvbnN0cnVjdG9yXHJcbiAgICAgICAgICBmdW5jdGlvbiBOR1kySXRlbSggaXRlbUlEICkge1xyXG4gICAgICAgICAgLy93aW5kb3cuTkdZMkl0ZW0gPSBmdW5jdGlvbiggaXRlbUlEICkge1xyXG4gICAgICAgICAgICB2YXIgSUQgPSAwOyAgICAgICAgICAgICAgICAgICAgIC8vIHByaXZhdGVcclxuXHJcbiAgICAgICAgICAgIC8vIHB1YmxpYyAodGhpcyBpbnN0YW5jZSBvbmx5KVxyXG4gICAgICAgICAgICBpZiggaXRlbUlEID09PSB1bmRlZmluZWQgfHwgaXRlbUlEID09PSBudWxsICkge1xyXG4gICAgICAgICAgICAgIElEID0gbmV4dElkKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgSUQgPSBpdGVtSUQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5HZXRJRCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIElEOyB9O1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gcHVibGljXHJcbiAgICAgICAgICAgIHRoaXMua2luZCA9ICAgICAgICAgICAgICAgICAnJzsgICAgICAgLy8gJ2ltYWdlJywgJ2FsYnVtJyBvciAnYWxidW1VcCdcclxuICAgICAgICAgICAgdGhpcy5tZWRpYUtpbmQgPSAgICAgICAgICAgICdpbWcnOyAgICAvLyAnaW1nJywgJ2lmcmFtZSdcclxuICAgICAgICAgICAgdGhpcy5tZWRpYU1hcmt1cCA9ICAgICAgICAgICcnO1xyXG4gICAgICAgICAgICB0aGlzLkcgPSAgICAgICAgICAgICAgICAgICAgbnVsbDsgICAgIC8vIHBvaW50ZXIgdG8gZ2xvYmFsIGluc3RhbmNlXHJcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSAgICAgICAgICAgICAgICAnJzsgICAgICAgLy8gaW1hZ2UgdGl0bGVcclxuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9ICAgICAgICAgICcnOyAgICAgICAvLyBpbWFnZSBkZXNjcmlwdGlvblxyXG4gICAgICAgICAgICB0aGlzLmFsYnVtSUQgPSAgICAgICAgICAgICAgMDsgICAgICAgIC8vIElEIG9mIHRoZSBwYXJlbnQgYWxidW1cclxuICAgICAgICAgICAgdGhpcy5zcmMgPSAgICAgICAgICAgICAgICAgICcnOyAgICAgICAvLyBmdWxsIHNpemVkIGltYWdlIFVSTFxyXG4gICAgICAgICAgICB0aGlzLndpZHRoID0gICAgICAgICAgICAgICAgMDsgICAgICAgIC8vIGltYWdlIHdpZHRoXHJcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gICAgICAgICAgICAgICAwOyAgICAgICAgLy8gaW1hZ2UgaGVpZ2h0XHJcbiAgICAgICAgICAgIHRoaXMuZGVzdGluYXRpb25VUkwgPSAgICAgICAnJzsgICAgICAgLy8gdGh1bWJuYWlsIGRlc3RpbmF0aW9uIFVSTCAtLT4gb3BlbiBVUkwgaW5zdGVhZCBvZiBkaXNwbGF5aW5nIGltYWdlXHJcbiAgICAgICAgICAgIHRoaXMuZG93bmxvYWRVUkwgPSAgICAgICAgICAnJzsgICAgICAgLy8gdGh1bWJuYWlsIGRvd25sb2FkIFVSTCAtLT4gc3BlY2lmeSB0aGUgaW1hZ2UgZm9yIGRvd25sb2FkIGJ1dHRvblxyXG4gICAgICAgICAgICB0aGlzLmF1dGhvciA9ICAgICAgICAgICAgICAgJyc7ICAgICAgIC8vIGltYWdlL2FsYnVtIGF1dGhvclxyXG4gICAgICAgICAgICB0aGlzLmxlZnQ9ICAgICAgICAgICAgICAgICAgMDsgICAgICAgIC8vIHN0b3JlIHBvc2l0aW9uIHRvIGFuaW1hdGUgZnJvbSBvbGQgdG8gbmV3XHJcbiAgICAgICAgICAgIHRoaXMudG9wPSAgICAgICAgICAgICAgICAgICAwO1xyXG4gICAgICAgICAgICB0aGlzLndpZHRoPSAgICAgICAgICAgICAgICAgMDsgICAgICAgIC8vIHN0b3JlIHNpemUgdG8gYXZvaWQgc2V0dGluZyB3aWR0aC9oZWlnaHQgaWYgbm90IHJlcXVpcmVkXHJcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0PSAgICAgICAgICAgICAgICAwO1xyXG4gICAgICAgICAgICB0aGlzLnJlc2l6ZWRDb250ZW50V2lkdGg9ICAgMDsgICAgICAgIC8vIHN0b3JlIHNpemUgb2YgY29udGVudCAoaW1hZ2UpIHRvIGF2b2lkIHNldHRpbmcgd2lkdGgvaGVpZ2h0IGlmIG5vdCByZXF1aXJlZFxyXG4gICAgICAgICAgICB0aGlzLnJlc2l6ZWRDb250ZW50SGVpZ2h0PSAgMDtcclxuICAgICAgICAgICAgdGhpcy50aHVtYnMgPSB7ICAgICAgICAgICAgICAgICAgICAgICAvLyBVUkxzIGFuZCBzaXplcyBmb3IgdXNlciBkZWZpbmVkXHJcbiAgICAgICAgICAgICAgdXJsOiAgICB7IGwxOiB7IHhzOiAnJywgc206JycsIG1lOiAnJywgbGE6ICcnLCB4bDogJycgfSwgbE46IHsgeHM6ICcnLCBzbTogJycsIG1lOiAnJywgbGE6JycsIHhsOiAnJyB9IH0sXHJcbiAgICAgICAgICAgICAgd2lkdGg6ICB7IGwxOiB7IHhzOiAwLCAgc206IDAsIG1lOiAwLCAgbGE6IDAgLCB4bDogMCAgfSwgbE46IHsgeHM6IDAgLCBzbTogMCwgIG1lOiAwLCAgbGE6IDAsIHhsOiAwICB9IH0sXHJcbiAgICAgICAgICAgICAgaGVpZ2h0OiB7IGwxOiB7IHhzOiAwLCAgc206IDAsIG1lOiAwLCAgbGE6IDAgLCB4bDogMCAgfSwgbE46IHsgeHM6IDAsICBzbTogMCwgIG1lOiAwLCAgbGE6IDAsIHhsOiAwICB9IH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy50aHVtYm5haWxJbWdSZXZlYWxlZCAgID0gZmFsc2U7ICAvLyB0aHVtYm5haWwgaW1hZ2UgYWxyZWFkeSByZXZlYWxlZFxyXG4gICAgICAgICAgICB0aGlzLmltYWdlRG9taW5hbnRDb2xvcnMgICAgPSBudWxsOyAgIC8vIGJhc2U2NCBHSUZcclxuICAgICAgICAgICAgdGhpcy5pbWFnZURvbWluYW50Q29sb3IgICAgID0gbnVsbDsgICAvLyBIRVggUkdCXHJcbiAgICAgICAgICAgIHRoaXMuZmVhdHVyZWQgPSAgICAgICAgICAgICBmYWxzZTsgICAgLy8gZmVhdHVyZWQgZWxlbWVudFxyXG4gICAgICAgICAgICB0aGlzLmZsaWNrclRodW1iU2l6ZXMgPSAgICAge307ICAgICAgIC8vIHN0b3JlIFVSTHMgZm9yIGFsbCBhdmFpbGFibGUgdGh1bWJuYWlsIHNpemVzIChmbGlja3IpXHJcbiAgICAgICAgICAgIHRoaXMucGljYXNhVGh1bWJzID0gICAgICAgICBudWxsOyAgICAgLy8gc3RvcmUgVVJMcyBhbmQgc2l6ZXNcclxuICAgICAgICAgICAgdGhpcy5ob3ZlcmVkID0gICAgICAgICAgICAgIGZhbHNlOyAgICAvLyBpcyB0aGUgdGh1bWJuYWlsIGN1cnJlbnRseSBob3ZlcmVkP1xyXG4gICAgICAgICAgICB0aGlzLmhvdmVySW5pdERvbmUgPSAgICAgICAgZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudElzTG9hZGVkID0gICAgICBmYWxzZTsgICAgLy8gYWxidW06IGFyZSBpdGVtcyBhbHJlYWR5IGxvYWRlZD9cclxuICAgICAgICAgICAgdGhpcy5jb250ZW50TGVuZ3RoID0gICAgICAgIDA7ICAgICAgICAvLyBhbGJ1bTogbnVtYmVyIG9mIGl0ZW1zIChyZWFsIG51bWJlciBvZiBpdGVtcyBpbiBtZW1vcnkpXHJcbiAgICAgICAgICAgIHRoaXMubnVtYmVySXRlbXMgPSAgICAgICAgICAwOyAgICAgICAgLy8gYWxidW06IG51bWJlciBvZiBpdGVtcyAodmFsdWUgcmV0dXJuZWQgYnkgZGF0YSBzb3VyY2UpXHJcbiAgICAgICAgICAgIHRoaXMubWVkaWFOdW1iZXIgPSAgICAgICAgICAwOyAgICAgICAgLy8gbWVkaWEgbnVtYmVyIGluIHRoZSBhbGJ1bVxyXG4gICAgICAgICAgICB0aGlzLmltYWdlQ291bnRlciA9ICAgICAgICAgMDsgICAgICAgIC8vIG51bWJlciBvZiBpbWFnZXMgaW4gYW4gYWxidW1cclxuICAgICAgICAgICAgdGhpcy5lbHRUcmFuc2Zvcm0gPSAgICAgICAgIFtdOyAgICAgICAvLyBzdG9yZSB0aGUgQ1NTIHRyYW5zZm9ybWF0aW9uc1xyXG4gICAgICAgICAgICB0aGlzLmVsdEZpbHRlciA9ICAgICAgICAgICAgW107ICAgICAgIC8vIHN0b3JlIHRoZSBDU1MgZmlsdGVyc1xyXG4gICAgICAgICAgICB0aGlzLmVsdEVmZmVjdCA9ICAgICAgICAgICAgW107ICAgICAgIC8vIHN0b3JlIGRhdGEgYWJvdXQgaG92ZXIgZWZmZWN0cyBhbmltYXRpb25zXHJcbiAgICAgICAgICAgIHRoaXMuYXV0aGtleSA9ICAgICAgICAgICAgICAnJzsgICAgICAgLy8gZm9yIEdvb2dsZSBQaG90b3MgcHJpdmF0ZSAoaGlkZGVuKSBhbGJ1bXNcclxuICAgICAgICAgICAgdGhpcy5wYWdpbmF0aW9uTGFzdFBhZ2UgPSAgIDA7ICAgICAgICAvLyBmb3IgYWxidW1zXHJcbiAgICAgICAgICAgIHRoaXMucGFnaW5hdGlvbkxhc3RXaWR0aCA9ICAwOyAgICAgICAgLy8gZm9yIGFsYnVtc1xyXG4gICAgICAgICAgICB0aGlzLmN1c3RvbURhdGEgPSAgICAgICAgICAge307XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSAgICAgICAgICAgICBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5pbWFnZVdpZHRoID0gICAgICAgICAgIDA7ICAgICAgICAvLyBpbWFnZSBuYXR1cmFsIChyZWFsKSB3aWR0aFxyXG4gICAgICAgICAgICB0aGlzLmltYWdlSGVpZ2h0ID0gICAgICAgICAgMDsgICAgICAgIC8vIGltYWdlIG5hdHVyYWwgKHJlYWwpIGhlaWdodFxyXG4gICAgICAgICAgICB0aGlzLiRlbHQgPSAgICAgICAgICAgICAgICAgbnVsbDsgICAgIC8vIHBvaW50ZXIgdG8gdGhlIGNvcnJlc3BvbmRpbmcgRE9NIGVsZW1lbnRcclxuICAgICAgICAgICAgdGhpcy4kRWx0cyA9ICAgICAgICAgICAgICAgIFtdOyAgICAgICAvLyBjYWNoZWQgcG9pbnRlcnMgdG8gdGhlIHRodW1ibmFpbCBjb250ZW50IC0+IHRvIGF2b2lkIGpRdWVyeSgpLmZpbmQoKVxyXG4gICAgICAgICAgICB0aGlzLnRhZ3MgPSAgICAgICAgICAgICAgICAgW107ICAgICAgIC8vIGxpc3Qgb2YgdGFncyBvZiB0aGUgY3VycmVudCBpdGVtXHJcbiAgICAgICAgICAgIHRoaXMuYWxidW1UYWdMaXN0ID0gICAgICAgICBbXTsgICAgICAgLy8gbGlzdCBvZiBhbGwgdGhlIHRhZ3Mgb2YgdGhlIGl0ZW1zIGNvbnRhaW5lZCBpbiB0aGUgY3VycmVudCBhbGJ1bVxyXG4gICAgICAgICAgICB0aGlzLmFsYnVtVGFnTGlzdFNlbCA9ICAgICAgW107ICAgICAgIC8vIGxpc3Qgb2YgY3VycmVudGx5IHNlbGVjdGVkIHRhZ3MgKG9ubHkgZm9yIGFsYnVtcylcclxuICAgICAgICAgICAgdGhpcy5leGlmID0geyBleHBvc3VyZTogJycsIGZsYXNoOiAnJywgZm9jYWxsZW5ndGg6ICcnLCBmc3RvcDogJycsIGlzbzogJycsIG1vZGVsOiAnJywgdGltZTogJycsIGxvY2F0aW9uOiAnJ307XHJcbiAgICAgICAgICAgIHRoaXMuZGVsZXRlZCA9ICAgICAgICAgICAgICBmYWxzZTsgICAgLy8gaXRlbSBpcyBkZWxldGVkIC0+IGRvIG5vdCBkaXNwbGF5IGFueW1vcmVcbiAgICAgICAgICAgIHRoaXMucm90YXRpb25BbmdsZSA9ICAgICAgICAwOyAgICAgICAgLy8gaW1hZ2UgZGlzcGxheSByb3RhdGlvbiBhbmdsZVxyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIC8vIHB1YmxpYyBzdGF0aWNcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgTkdZMkl0ZW0uR2V0ID0gZnVuY3Rpb24oIGluc3RhbmNlLCBJRCApIHtcclxuICAgICAgICAgICAgdmFyIGwgPSBpbnN0YW5jZS5JLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgaWYoIGluc3RhbmNlLklbaV0uR2V0SUQoKSA9PSBJRCApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpbnN0YW5jZS5JW2ldO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgTkdZMkl0ZW0uR2V0SWR4ID0gZnVuY3Rpb24oIGluc3RhbmNlLCBJRCApIHtcclxuICAgICAgICAgICAgdmFyIGwgPSBpbnN0YW5jZS5JLmxlbmd0aDtcclxuICAgICAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgaWYoIGluc3RhbmNlLklbaV0uR2V0SUQoKSA9PSBJRCApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBjcmVhdGUgbmV3IGl0ZW0gKGltYWdlLCBhbGJ1bSBvciBhbGJ1bVVwKVxyXG4gICAgICAgICAgTkdZMkl0ZW0uTmV3ID0gZnVuY3Rpb24oIGluc3RhbmNlLCB0aXRsZSwgZGVzY3JpcHRpb24sIElELCBhbGJ1bUlELCBraW5kLCB0YWdzICkge1xyXG4gICAgICAgICAgICB2YXIgYWxidW0gPSBOR1kySXRlbS5HZXQoIGluc3RhbmNlLCBhbGJ1bUlEICk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiggYWxidW1JRCAhPSAtMSAmJiBhbGJ1bUlEICE9IDAgJiYgdGl0bGUgIT0naW1hZ2UgZ2FsbGVyeSBieSBuYW5vZ2FsbGVyeTIgW2J1aWxkXScgICkge1xyXG4gICAgICAgICAgICAgIGlmKCBpbnN0YW5jZS5PLnRodW1ibmFpbExldmVsVXAgJiYgYWxidW0uZ2V0Q29udGVudExlbmd0aChmYWxzZSkgPT0gMCAmJiBpbnN0YW5jZS5PLmFsYnVtID09ICcnICkge1xyXG4gICAgICAgICAgICAgICAgLy8gYWRkIG5hdmlnYXRpb24gdGh1bWJuYWlsIChhbGJ1bSB1cClcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gbmV3IE5HWTJJdGVtKCcwJyk7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5JLnB1c2goIGl0ZW0gKTtcclxuICAgICAgICAgICAgICAgIGFsYnVtLmNvbnRlbnRMZW5ndGggKz0gMTtcclxuICAgICAgICAgICAgICAgIGl0ZW0udGl0bGUgPSAnVVAnO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5hbGJ1bUlEID0gYWxidW1JRDtcclxuICAgICAgICAgICAgICAgIGl0ZW0ua2luZCA9ICdhbGJ1bVVwJztcclxuICAgICAgICAgICAgICAgIGl0ZW0uRyA9IGluc3RhbmNlO1xyXG5cclxuICAgICAgICAgICAgICAgIGpRdWVyeS5leHRlbmQoIHRydWUsIGl0ZW0udGh1bWJzLndpZHRoLCBpbnN0YW5jZS50bi5kZWZhdWx0U2l6ZS53aWR0aCk7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkuZXh0ZW5kKCB0cnVlLCBpdGVtLnRodW1icy5oZWlnaHQsIGluc3RhbmNlLnRuLmRlZmF1bHRTaXplLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IE5HWTJJdGVtLkdldChpbnN0YW5jZSwgSUQpO1xyXG4gICAgICAgICAgICBpZiggaXRlbSA9PT0gbnVsbCApe1xyXG4gICAgICAgICAgICAgIC8vIGNyZWF0ZSBhIG5ldyBpdGVtIChvdGhlcndpc2UsIGp1c3QgdXBkYXRlIHRoZSBleGlzdGluZyBvbmUpXHJcbiAgICAgICAgICAgICAgaXRlbSA9IG5ldyBOR1kySXRlbShJRCk7XHJcbiAgICAgICAgICAgICAgaW5zdGFuY2UuSS5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICAgIGlmKCBhbGJ1bUlEICE9IC0xICYmIHRpdGxlICE9J2ltYWdlIGdhbGxlcnkgYnkgbmFub2dhbGxlcnkyIFtidWlsZF0nICkge1xyXG4gICAgICAgICAgICAgICAgYWxidW0uY29udGVudExlbmd0aCs9MTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaXRlbS5HID0gaW5zdGFuY2U7XHJcblxyXG4gICAgICAgICAgICBpdGVtLmFsYnVtSUQgPSBhbGJ1bUlEO1xyXG4gICAgICAgICAgICBpdGVtLmtpbmQgPSBraW5kO1xyXG4gICAgICAgICAgICBpZigga2luZCA9PSAnaW1hZ2UnICkge1xyXG4gICAgICAgICAgICAgIGFsYnVtLmltYWdlQ291bnRlciArPSAxO1xyXG4gICAgICAgICAgICAgIGl0ZW0ubWVkaWFOdW1iZXIgPSBhbGJ1bS5pbWFnZUNvdW50ZXI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGNoZWNrIGtleXdvcmQgdG8gZmluZCBmZWF0dXJlcyBpbWFnZXMvYWxidW1zXHJcbiAgICAgICAgICAgIHZhciBrdyA9IGluc3RhbmNlLk8udGh1bWJuYWlsRmVhdHVyZWRLZXl3b3JkO1xyXG4gICAgICAgICAgICBpZigga3cgIT0gJycgKSB7XHJcbiAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgaXRlbSBmZWF0dXJlZCBiYXNlZCBvbiBhIGtleXdvcmQgaW4gdGhlIHRpdGxlIG9yIGluIHRoZSBkZXNjcmlwdGlvblxyXG4gICAgICAgICAgICAgIGt3ID0ga3cudG9VcHBlckNhc2UoKTtcclxuICAgICAgICAgICAgICB2YXIgcCA9IHRpdGxlLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihrdyk7XHJcbiAgICAgICAgICAgICAgaWYoIHAgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5mZWF0dXJlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUga2V5d29yZCBjYXNlIHVuc2Vuc2l0aXZlXHJcbiAgICAgICAgICAgICAgICB0aXRsZSA9IHRpdGxlLnN1YnN0cmluZygwLCBwKSArIHRpdGxlLnN1YnN0cmluZyhwK2t3Lmxlbmd0aCwgdGl0bGUubGVuZ3RoKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgcCA9IGRlc2NyaXB0aW9uLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihrdyk7XHJcbiAgICAgICAgICAgICAgaWYoIHAgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5mZWF0dXJlZD10cnVlO1xyXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGtleXdvcmQgY2FzZSB1bnNlbnNpdGl2ZVxyXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb249ZGVzY3JpcHRpb24uc3Vic3RyaW5nKDAsIHApICsgZGVzY3JpcHRpb24uc3Vic3RyaW5nKHAgKyBrdy5sZW5ndGgsIGRlc2NyaXB0aW9uLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBUQUdTIFxyXG4gICAgICAgICAgICAvLyBpZiggaW5zdGFuY2UuZ2FsbGVyeUZpbHRlclRhZ3MuR2V0KCkgIT0gZmFsc2UgKSB7XHJcbiAgICAgICAgICAgICAgLy8gaWYoIGluc3RhbmNlLmdhbGxlcnlGaWx0ZXJUYWdzLkdldCgpID09IHRydWUgKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBpZiggdGFncyAhPSAnJyAmJiB0YWdzICE9IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgICAgICAgICAgLy8gdXNlIHNldCB0YWdzXHJcbiAgICAgICAgICAgICAgICAgIC8vIGl0ZW0uc2V0VGFncyh0YWdzLnNwbGl0KCcgJykpO1xyXG4gICAgICAgICAgICAgICAgLy8gfVxyXG4gICAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgICAvLyBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGV4dHJhY3QgdGFncyBzdGFydGluZyB3aXRoICMgKGluIHRpdGxlKVxyXG4gICAgICAgICAgICAgIGlmKCB0eXBlb2YgaW5zdGFuY2UuZ2FsbGVyeUZpbHRlclRhZ3MuR2V0KCkgPT0gJ3N0cmluZycgKSB7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2goIGluc3RhbmNlLmdhbGxlcnlGaWx0ZXJUYWdzLkdldCgpLnRvVXBwZXJDYXNlKCkgKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ1RJVExFJzpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmUgPSAvKD86XnxcXFcpIyhcXHcrKSg/IVxcdykvZywgbWF0Y2gsIG1hdGNoZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFncyA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG1hdGNoID0gcmUuZXhlYyh0aXRsZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXMucHVzaChtYXRjaFsxXS5yZXBsYWNlKC9eXFxzKnxcXHMqJC8sICcnKSk7ICAgLy90cmltIHRyYWlsaW5nL2xlYWRpbmcgd2hpdGVzcGFjZVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpdGVtLnNldFRhZ3MobWF0Y2hlcyk7ICAvL3RhZ3M7XHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSB0aXRsZS5zcGxpdCgnIycpLmpvaW4oJycpOyAgIC8vcmVwbGFjZWFsbFxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICdERVNDUklQVElPTic6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlID0gLyg/Ol58XFxXKSMoXFx3KykoPyFcXHcpL2csIG1hdGNoLCBtYXRjaGVzID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhZ3MgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChtYXRjaCA9IHJlLmV4ZWMoZGVzY3JpcHRpb24pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLnB1c2gobWF0Y2hbMV0ucmVwbGFjZSgvXlxccyp8XFxzKiQvLCAnJykpOyAgIC8vdHJpbSB0cmFpbGluZy9sZWFkaW5nIHdoaXRlc3BhY2VcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXRUYWdzKG1hdGNoZXMpOyAgLy90YWdzO1xyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gZGVzY3JpcHRpb24uc3BsaXQoJyMnKS5qb2luKCcnKTsgICAvL3JlcGxhY2VhbGxcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgaWYoIHRhZ3MgIT0gJycgJiYgdGFncyAhPSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdXNlIHNldCB0YWdzXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXRUYWdzKHRhZ3Muc3BsaXQoJyAnKSk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAgIC8vIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIHNldCAobWF5YmUgbW9kaWZpZWQpIGZpZWxkcyB0aXRsZSBhbmQgZGVzY3JpcHRpb25cclxuICAgICAgICAgICAgaXRlbS50aXRsZSA9IGVzY2FwZUh0bWwoaW5zdGFuY2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgaXRlbS5kZXNjcmlwdGlvbiA9IGVzY2FwZUh0bWwoaW5zdGFuY2UsIGRlc2NyaXB0aW9uKTtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW07XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIHJlbW92ZXMgbG9naWNhbGx5IGN1cnJlbnQgaXRlbVxyXG4gICAgICAgICAgTkdZMkl0ZW0ucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uKCApIHtcclxuICAgICAgICAgICAgdGhpcy5kZWxldGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIHVwZGF0ZSBjb250ZW50IGxlbmd0aCBvZiBwYXJlbnQgYWxidW1cclxuICAgICAgICAgICAgdGhpcy5HLklbTkdZMkl0ZW0uR2V0SWR4KHRoaXMuRywgdGhpcy5hbGJ1bUlEKV0uY29udGVudExlbmd0aC0tO1xyXG4gICAgICAgICAgICB0aGlzLkcuSVtOR1kySXRlbS5HZXRJZHgodGhpcy5HLCB0aGlzLmFsYnVtSUQpXS5udW1iZXJJdGVtcy0tO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gY2hlY2sgaWYgaW4gRE9NIGFuZCByZW1vdmVzIGl0XHJcbiAgICAgICAgICAgIHZhciBuYlRuID0gdGhpcy5HLkdPTS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBJRCA9IHRoaXMuR2V0SUQoKTtcclxuICAgICAgICAgICAgdmFyIGZvdW5kSWR4ID0gLTE7XHJcbiAgICAgICAgICAgIHZhciBmb3VuZEdPTWlkeCA9IC0xO1xyXG4gICAgICAgICAgICBmb3IoIHZhciBpID0gMDsgaSA8IG5iVG4gOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgdmFyIGN1clRuID0gdGhpcy5HLkdPTS5pdGVtc1tpXTtcclxuICAgICAgICAgICAgICB2YXIgaXRlbT10aGlzLkcuSVtjdXJUbi50aHVtYm5haWxJZHhdO1xyXG4gICAgICAgICAgICAgIGlmKCBpdGVtLkdldElEKCkgPT0gSUQgKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBGT1VORFxyXG4gICAgICAgICAgICAgICAgaWYoICFjdXJUbi5uZXZlckRpc3BsYXllZCApIHtcclxuICAgICAgICAgICAgICAgICAgZm91bmRJZHg9IGN1clRuLnRodW1ibmFpbElkeDtcclxuICAgICAgICAgICAgICAgICAgZm91bmRHT01pZHg9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYoIGZvdW5kSWR4ICE9IC0xICkge1xyXG4gICAgICAgICAgICAgICAgICBpZiggIWN1clRuLm5ldmVyRGlzcGxheWVkICkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBpbmRleCB2YWx1ZVxyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uJGdldEVsdCgnLm5HWTJHVGh1bWJuYWlsJykuZGF0YSgnaW5kZXgnLCBpLTEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uJGdldEVsdCgnLm5HWTJHVGh1bWJuYWlsSW1nJykuZGF0YSgnaW5kZXgnLCBpLTEpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCBmb3VuZElkeCAhPSAtMSApIHtcclxuICAgICAgICAgICAgICAvLyBkZWxldGUgaXRlbSBpbiBHT00gYW5kIGRlbGV0ZSB0aHVtYm5haWxcclxuICAgICAgICAgICAgICB2YXIgRyA9IHRoaXMuRztcclxuICAgICAgICAgICAgICBpZiggdGhpcy5zZWxlY3RlZCA9PSB0cnVlICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgRy5HT00ubmJTZWxlY3RlZC0tOyAgICAvLyB1cGRhdGUgdGhlIGdsb2JhbCBjb3VudGVyXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGlmKCBHLklbZm91bmRJZHhdLiRlbHQgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgICBHLklbZm91bmRJZHhdLiRlbHQucmVtb3ZlKCk7ICAgICAgLy8gZGVsZXRlIHRodW1ibmFpbCBET00gb2JqZWN0XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIEcuR09NLml0ZW1zLnNwbGljZShmb3VuZEdPTWlkeCwgMSk7ICAgLy8gZGVsZXRlIGluIEdPTVxyXG4gICAgICAgICAgICAgIGlmKCBHLkdPTS5sYXN0RGlzcGxheWVkSWR4ICE9IC0xICkge1xyXG4gICAgICAgICAgICAgICAgRy5HT00ubGFzdERpc3BsYXllZElkeC09MTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBOR1kySXRlbS5wcm90b3R5cGUuYWRkVG9HT00gPSBmdW5jdGlvbiggKSB7XHJcbiAgICAgICAgICAgIC8vIHJldHJpZXZlIGluZGV4XHJcbiAgICAgICAgICAgIHZhciBJRCA9IHRoaXMuR2V0SUQoKTtcclxuICAgICAgICAgICAgdmFyIGwgPSB0aGlzLkcuSS5sZW5ndGg7XHJcbiAgICAgICAgICAgIGZvciggdmFyIGlkeCA9IDA7IGlkeCA8IGw7IGlkeCsrICkge1xyXG4gICAgICAgICAgICAgIHZhciBpdGVtID0gdGhpcy5HLklbaWR4XTtcclxuICAgICAgICAgICAgICBpZiggaXRlbS5HZXRJRCgpID09IElEICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHcgPSBpdGVtLnRodW1iSW1nKCkud2lkdGg7XHJcbiAgICAgICAgICAgICAgICB2YXIgaCA9IGl0ZW0udGh1bWJJbWcoKS5oZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgZGVmYXVsdCBzaXplIGlmIHJlcXVpcmVkXHJcbiAgICAgICAgICAgICAgICBpZiggaCA9PSAwICkge1xyXG4gICAgICAgICAgICAgICAgICBoID0gdGhpcy5HLnRuLmRlZmF1bHRTaXplLmdldEhlaWdodCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoIHcgPT0gMCApIHtcclxuICAgICAgICAgICAgICAgICAgdyA9IHRoaXMuRy50bi5kZWZhdWx0U2l6ZS5nZXRXaWR0aCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgLy8gYWRkIHRvIEdPTSAtPiB3aWxsIGJlIGRpc3BsYXllZCBvbiBuZXh0IHJlZnJlc2gvcmVzaXplXHJcbiAgICAgICAgICAgICAgICB2YXIgdG4gPSBuZXcgdGhpcy5HLkdPTS5HVG4oaWR4LCB3LCBoKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuRy5HT00uaXRlbXMucHVzaCh0bik7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8gZnVuY3Rpb24gdG8gYXZvaWQgWFNTIGlzc3VlIC0gQ3Jvc3MgU2l0ZSBTY3JpcHRpbmdcclxuICAgICAgICAgIC8vIG9yaWdpbmFsOiBodHRwczovL2dpdGh1Yi5jb20vamFubC9tdXN0YWNoZS5qcy9ibG9iL21hc3Rlci9tdXN0YWNoZS5qcyNMNTVcclxuICAgICAgICAgIHZhciBlbnRpdHlNYXAgPSB7ICcmJzogJyZhbXA7JywgJzwnOiAnJmx0OycsICc+JzogJyZndDsnLCAnXCInOiAnJnF1b3Q7JywgXCInXCI6ICcmIzM5OycsICcvJzogJyYjeDJGOycsICdgJzogJyYjeDYwOycsICc9JzogJyYjeDNEOycgfTtcclxuICAgICAgICAgIGZ1bmN0aW9uIGVzY2FwZUh0bWwgKGluc3RhbmNlLCBzdHJpbmcpIHtcclxuICAgICAgICAgICAgaWYoIGluc3RhbmNlLk8uYWxsb3dIVE1MaW5EYXRhID09IHRydWUgKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuIHN0cmluZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICByZXR1cm4gU3RyaW5nKHN0cmluZykucmVwbGFjZSgvWyY8PlwiJ2A9XFwvXS9nLCBmdW5jdGlvbiBmcm9tRW50aXR5TWFwIChzKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZW50aXR5TWFwW3NdO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgTkdZMkl0ZW0uZ2V0X25leHRJZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5leHRJZDtcclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgLy89PT0gcHVibGljIChzaGFyZWQgYWNyb3NzIGluc3RhbmNlcylcclxuXHJcbiAgICAgICAgICAvLy0tLSBjYWNoZWQgc3ViIGVsZW1lbnRzXHJcbiAgICAgICAgICBOR1kySXRlbS5wcm90b3R5cGUuJGdldEVsdCA9IGZ1bmN0aW9uKCBlbHQsIGZvcmNlUmVmcmVzaCApIHtcclxuICAgICAgICAgICAgaWYoIHRoaXMuJGVsdCA9PSBudWxsICkgeyByZXR1cm4gbnVsbDsgfVxyXG4gICAgICAgICAgICBpZiggdGhpcy4kRWx0c1tlbHRdICE9PSB1bmRlZmluZWQgJiYgIWZvcmNlUmVmcmVzaCA9PSB0cnVlICkge1xyXG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLiRFbHRzW2VsdF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgaWYoIGVsdCA9PSAnLm5HWTJHVGh1bWJuYWlsJyApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuJEVsdHNbZWx0XT10aGlzLiRlbHQ7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy4kRWx0c1tlbHRdPXRoaXMuJGVsdC5maW5kKGVsdCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLiRFbHRzW2VsdF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIHJlbW92ZSBvbmUgZWxlbWVudCAoaW4gRE9NIGFuZCBpbiBjYWNoZSlcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5yZW1vdmVFbHQgPSBmdW5jdGlvbiggZWx0ICkge1xyXG4gICAgICAgICAgICBpZiggdGhpcy4kZWx0ID09IG51bGwgKSB7IHJldHVybjsgfVxyXG4gICAgICAgICAgICBpZiggdGhpcy4kRWx0c1tlbHRdID09IHVuZGVmaW5lZCkgeyByZXR1cm47IH1cclxuICAgICAgICAgICAgdGhpcy4kRWx0c1tlbHRdLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLiRFbHRzLmluZGV4T2YoZWx0KTtcclxuICAgICAgICAgICAgdGhpcy4kRWx0cy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAvLy0tLSByZXR1cm5zIHRoZSBhbGJ1bSBjb250YWluaW5nIHRoZSBpdGVtXHJcbiAgICAgICAgICBOR1kySXRlbS5wcm90b3R5cGUuYWxidW0gPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuRy5JW05HWTJJdGVtLkdldElkeCh0aGlzLkcsIHRoaXMuYWxidW1JRCldO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8tLS0gdmlld2VyIC0gdHJhbnNpdGlvbiBjYW4gYmUgZGlzYWJsZWQgcGVyIG1lZGlhIGtpbmQgLSByZXR1cm5zIHRydWUgaWYgY3VycmVudCBtZWRpYSBzdXBwb3J0cyB0cmFuc2l0aW9uIChzd2lwZSlcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5tZWRpYVRyYW5zaXRpb24gPSBmdW5jdGlvbiggKSB7XHJcbiAgICAgICAgICAgIGlmKCB0aGlzLkcuTy52aWV3ZXJUcmFuc2l0aW9uTWVkaWFLaW5kLmluZGV4T2YoIHRoaXMubWVkaWFLaW5kICkgPiAtMSApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIC8vLS0tIHNldCBvbmUgaW1hZ2UgKHVybCBhbmQgc2l6ZSlcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5pbWFnZVNldCA9IGZ1bmN0aW9uKCBzcmMsIHcsIGggKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3JjID0gc3JjO1xyXG4gICAgICAgICAgICB0aGlzLndpZHRoID0gdztcclxuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSBoO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8tLS0gc2V0IG9uZSB0aHVtYm5haWwgKHVybCBhbmQgc2l6ZSkgLSBzY3JlZW5TaXplIGFuZCBsZXZlbCBhcmUgb3B0aW9ubmFsXHJcbiAgICAgICAgICBOR1kySXRlbS5wcm90b3R5cGUudGh1bWJTZXQgPSBmdW5jdGlvbiggc3JjLCB3LCBoLCBzY3JlZW5TaXplLCBsZXZlbCApIHtcclxuICAgICAgICAgICAgdmFyIGxzdD1bJ3hzJywnc20nLCdtZScsJ2xhJywneGwnXTtcclxuICAgICAgICAgICAgaWYoIHR5cGVvZiBzY3JlZW5TaXplID09PSAndW5kZWZpbmVkJyB8fCBzY3JlZW5TaXplID09ICcnIHx8IHNjcmVlblNpemUgPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgICBmb3IoIHZhciBpPTA7IGk8IGxzdC5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICAgICAgICAgIGlmKCB0eXBlb2YgbGV2ZWwgPT09ICd1bmRlZmluZWQnIHx8IGxldmVsID09ICcnICkge1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnRodW1icy51cmwubDFbbHN0W2ldXT1zcmM7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMudGh1bWJzLmhlaWdodC5sMVtsc3RbaV1dPWg7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMudGh1bWJzLndpZHRoLmwxW2xzdFtpXV09dztcclxuICAgICAgICAgICAgICAgICAgdGhpcy50aHVtYnMudXJsLmxOW2xzdFtpXV09c3JjO1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnRodW1icy5oZWlnaHQubE5bbHN0W2ldXT1oO1xyXG4gICAgICAgICAgICAgICAgICB0aGlzLnRodW1icy53aWR0aC5sTltsc3RbaV1dPXc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgdGhpcy50aHVtYnMudXJsW2xldmVsXVtsc3RbaV1dPXNyYztcclxuICAgICAgICAgICAgICAgICAgdGhpcy50aHVtYnMuaGVpZ2h0W2xldmVsXVtsc3RbaV1dPWg7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMudGh1bWJzLndpZHRoW2xldmVsXVtsc3RbaV1dPXc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIGlmKCB0eXBlb2YgbGV2ZWwgPT09ICd1bmRlZmluZWQnIHx8IGxldmVsID09ICcnIHx8IGxldmVsID09IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRodW1icy51cmwubDFbc2NyZWVuU2l6ZV09c3JjO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aHVtYnMuaGVpZ2h0LmwxW3NjcmVlblNpemVdPWg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRodW1icy53aWR0aC5sMVtzY3JlZW5TaXplXT13O1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aHVtYnMudXJsLmxOW3NjcmVlblNpemVdPXNyYztcclxuICAgICAgICAgICAgICAgIHRoaXMudGh1bWJzLmhlaWdodC5sTltzY3JlZW5TaXplXT1oO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aHVtYnMud2lkdGgubE5bc2NyZWVuU2l6ZV09dztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRodW1icy51cmxbbGV2ZWxdW3NjcmVlblNpemVdPXNyYztcclxuICAgICAgICAgICAgICAgIHRoaXMudGh1bWJzLmhlaWdodFtsZXZlbF1bc2NyZWVuU2l6ZV09aDtcclxuICAgICAgICAgICAgICAgIHRoaXMudGh1bWJzLndpZHRoW2xldmVsXVtzY3JlZW5TaXplXT13O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBsc3Q9Wyd4cycsJ3NtJywnbWUnLCdsYScsJ3hsJ107XHJcbiAgICAgICAgICAgIGZvciggdmFyIGk9MDsgaTwgbHN0Lmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgICAgIHRoaXMudGh1bWJzLmhlaWdodC5sMVtsc3RbaV1dPWg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yKCB2YXIgaT0wOyBpPCBsc3QubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgaWYoIHRoaXMuRy50bi5zZXR0aW5ncy5oZWlnaHQubE5bbHN0W2ldXSA9PSB0aGlzLkcudG4uc2V0dGluZ3MuZ2V0SCgpICYmIHRoaXMuRy50bi5zZXR0aW5ncy53aWR0aC5sMVtsc3RbaV1dID09IHRoaXMuRy50bi5zZXR0aW5ncy5nZXRXKCkgKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRodW1icy5oZWlnaHQubE5bbHN0W2ldXT1oO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAvLy0tLSBzZXQgdGh1bWJuYWlsIGltYWdlIHJlYWwgaGVpZ2h0IGZvciBjdXJyZW50IGxldmVsL3Jlc29sdXRpb24sIGFuZCBmb3IgYWxsIG90aGVycyBsZXZlbC9yZXNvbHV0aW9ucyBoYXZpbmcgdGhlIHNhbWUgc2V0dGluZ3NcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS50aHVtYlNldEltZ0hlaWdodCA9IGZ1bmN0aW9uKCBoICkgeyAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHZhciBsc3Q9Wyd4cycsJ3NtJywnbWUnLCdsYScsJ3hsJ107XHJcbiAgICAgICAgICAgIGZvciggdmFyIGk9MDsgaTwgbHN0Lmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgICAgIGlmKCB0aGlzLkcudG4uc2V0dGluZ3MuaGVpZ2h0LmwxW2xzdFtpXV0gPT0gdGhpcy5HLnRuLnNldHRpbmdzLmdldEgoKSAmJiB0aGlzLkcudG4uc2V0dGluZ3Mud2lkdGgubDFbbHN0W2ldXSA9PSB0aGlzLkcudG4uc2V0dGluZ3MuZ2V0VygpICkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aHVtYnMuaGVpZ2h0LmwxW2xzdFtpXV09aDtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yKCB2YXIgaT0wOyBpPCBsc3QubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgaWYoIHRoaXMuRy50bi5zZXR0aW5ncy5oZWlnaHQubE5bbHN0W2ldXSA9PSB0aGlzLkcudG4uc2V0dGluZ3MuZ2V0SCgpICYmIHRoaXMuRy50bi5zZXR0aW5ncy53aWR0aC5sMVtsc3RbaV1dID09IHRoaXMuRy50bi5zZXR0aW5ncy5nZXRXKCkgKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRodW1icy5oZWlnaHQubE5bbHN0W2ldXT1oO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAvLy0tLSBzZXQgdGh1bWJuYWlsIGltYWdlIHJlYWwgd2lkdGggZm9yIGN1cnJlbnQgbGV2ZWwvcmVzb2x1dGlvbiwgYW5kIGZvciBhbGwgb3RoZXJzIGxldmVsL3Jlc29sdXRpb25zIGhhdmluZyB0aGUgc2FtZSBzZXR0aW5nc1xyXG4gICAgICAgICAgTkdZMkl0ZW0ucHJvdG90eXBlLnRodW1iU2V0SW1nV2lkdGggPSBmdW5jdGlvbiggdyApIHsgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB2YXIgbHN0PVsneHMnLCdzbScsJ21lJywnbGEnLCd4bCddO1xyXG4gICAgICAgICAgICBmb3IoIHZhciBpPTA7IGk8IGxzdC5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICAgICAgICBpZiggdGhpcy5HLnRuLnNldHRpbmdzLmhlaWdodC5sMVtsc3RbaV1dID09IHRoaXMuRy50bi5zZXR0aW5ncy5nZXRIKCkgJiYgdGhpcy5HLnRuLnNldHRpbmdzLndpZHRoLmwxW2xzdFtpXV0gPT0gdGhpcy5HLnRuLnNldHRpbmdzLmdldFcoKSApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGh1bWJzLndpZHRoLmwxW2xzdFtpXV09dztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yKCB2YXIgaT0wOyBpPCBsc3QubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgaWYoIHRoaXMuRy50bi5zZXR0aW5ncy5oZWlnaHQubE5bbHN0W2ldXSA9PSB0aGlzLkcudG4uc2V0dGluZ3MuZ2V0SCgpICYmIHRoaXMuRy50bi5zZXR0aW5ncy53aWR0aC5sMVtsc3RbaV1dID09IHRoaXMuRy50bi5zZXR0aW5ncy5nZXRXKCkgKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRodW1icy53aWR0aC5sTltsc3RbaV1dPXc7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLy0tLSBSZXR1cm5zIFRodW1ibmFpbCBpbWFnZSAoZGVwZW5kaW5nIG9mIHRoZSBzY3JlZW4gcmVzb2x1dGlvbilcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS50aHVtYkltZyA9IGZ1bmN0aW9uICgpIHsgICBcclxuICAgICAgICAgICAgdmFyIHRuSW1nID0geyBzcmM6ICcnLCB3aWR0aDogMCwgaGVpZ2h0OiAwIH07XHJcblxyXG4gICAgICAgICAgICBpZiggdGhpcy50aXRsZSA9PSAnaW1hZ2UgZ2FsbGVyeSBieSBuYW5vZ2FsbGVyeTIgW2J1aWxkXScgKSB7XHJcbiAgICAgICAgICAgICAgdG5JbWcuc3JjID0gdGhpcy5HLmVtcHR5R2lmO1xyXG4gICAgICAgICAgICAgIHRuSW1nLnVybCA9IHRoaXMuRy5lbXB0eUdpZjtcclxuICAgICAgICAgICAgICByZXR1cm4gdG5JbWc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdG5JbWcuc3JjID0gdGhpcy50aHVtYnMudXJsW3RoaXMuRy5HT00uY3VyTmF2TGV2ZWxdW3RoaXMuRy5HT00uY3VyV2lkdGhdO1xyXG4gICAgICAgICAgICB0bkltZy53aWR0aCA9IHRoaXMudGh1bWJzLndpZHRoW3RoaXMuRy5HT00uY3VyTmF2TGV2ZWxdW3RoaXMuRy5HT00uY3VyV2lkdGhdO1xyXG4gICAgICAgICAgICB0bkltZy5oZWlnaHQgPSB0aGlzLnRodW1icy5oZWlnaHRbdGhpcy5HLkdPTS5jdXJOYXZMZXZlbF1bdGhpcy5HLkdPTS5jdXJXaWR0aF07XHJcbiAgICAgICAgICAgIHJldHVybiB0bkltZztcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vLS0tIFNldCB0YWdzIHRvIGl0ZW1zIGFuZCBhZGQgdGhlc2UgdGFncyB0byB0aGUgYWxidW1cclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5zZXRUYWdzID0gZnVuY3Rpb24oIHRhZ3MgKSB7ICAgICAgICAgICAgICBcclxuICAgICAgICAgIGlmKCB0YWdzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy50YWdzID0gdGFncztcclxuICAgICAgICAgICAgICB2YXIgbHN0VGFncyA9IHRoaXMuYWxidW0oKS5hbGJ1bVRhZ0xpc3Q7XHJcbiAgICAgICAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCB0YWdzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRmb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZm9yKCB2YXIgaiA9IDA7IGogPCBsc3RUYWdzLmxlbmd0aDsgaisrICkge1xyXG4gICAgICAgICAgICAgICAgICBpZiggdGFnc1tpXS50b1VwcGVyQ2FzZSgpID09IGxzdFRhZ3Nbal0udG9VcHBlckNhc2UoKSApIHtcclxuICAgICAgICAgICAgICAgICAgICB0Zm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiggdGZvdW5kID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMuYWxidW0oKS5hbGJ1bVRhZ0xpc3QucHVzaCh0YWdzW2ldKVxyXG4gICAgICAgICAgICAgICAgICB0aGlzLmFsYnVtKCkuYWxidW1UYWdMaXN0U2VsLnB1c2godGFnc1tpXSlcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vLS0tIGNoZWNrIGlmIDEgb2YgY3VycmVudCBpdGVtJ3MgdGFncyBpcyBzZWxlY3RlZCAodGFnIGZpbHRlcilcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5jaGVja1RhZ0ZpbHRlciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiggdGhpcy5HLmdhbGxlcnlGaWx0ZXJUYWdzLkdldCgpICE9IGZhbHNlICYmIHRoaXMuYWxidW0oKS5hbGJ1bVRhZ0xpc3QubGVuZ3RoID4gMCApIHtcclxuICAgICAgICAgICAgICBpZiggdGhpcy5HLk8udGh1bWJuYWlsTGV2ZWxVcCAmJiB0aGlzLmtpbmQ9PSdhbGJ1bVVwJyApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICB2YXIgbHN0VGFncyA9IHRoaXMuYWxidW0oKS5hbGJ1bVRhZ0xpc3RTZWw7XHJcbiAgICAgICAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCB0aGlzLnRhZ3MubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IoIHZhciBqID0gMDsgaiA8IGxzdFRhZ3MubGVuZ3RoOyBqKysgKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmKCB0aGlzLnRhZ3NbaV0udG9VcHBlckNhc2UoKSA9PSBsc3RUYWdzW2pdLnRvVXBwZXJDYXNlKCkgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiBmb3VuZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLy0tLSBjaGVjayBpZiAxIG9mIGN1cnJlbnQgaXRlbSdzIHRhZ3MgaXMgZm91bmQgdXNpbmcgQVBJIHNlYXJjaFxyXG4gICAgICAgICAgTkdZMkl0ZW0ucHJvdG90eXBlLmlzU2VhcmNoVGFnRm91bmQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYoIHRoaXMuRy5HT00uYWxidW1TZWFyY2hUYWdzID09ICcnICkgeyByZXR1cm4gdHJ1ZTsgfVxyXG4gICAgICAgICAgICBpZiggdGhpcy5HLk8udGh1bWJuYWlsTGV2ZWxVcCAmJiB0aGlzLmtpbmQgPT0gJ2FsYnVtVXAnICkgeyByZXR1cm4gdHJ1ZTsgfVxyXG5cclxuICAgICAgICAgICAgLy92YXIgbHN0VGFncz10aGlzLmFsYnVtKCkuYWxidW1UYWdMaXN0U2VsO1xyXG4gICAgICAgICAgICBmb3IoIHZhciBpID0gMDsgaSA8IHRoaXMudGFncy5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICAgICAgICBpZiggdGhpcy50YWdzW2ldLnRvVXBwZXJDYXNlKCkuaW5kZXhPZiggdGhpcy5HLkdPTS5hbGJ1bVNlYXJjaFRhZ3MgKSA+PSAwICkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vLS0tIHNldCB0aGUgVVJMIG9mIHRoZSBtZWRpYSB0byBkaXNwbGF5IGluIHRoZSB2aWV3ZXJcclxuICAgICAgICAgIC8vLS0tIG1hcmt1cCBpcyBkZWZpbmVkIGZvciBpbWFnZXNcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5zZXRNZWRpYVVSTCA9IGZ1bmN0aW9uKCB1cmwsIG1lZGlhS2luZCApIHtcclxuICAgICAgICAgICAgdGhpcy5zcmMgPSB1cmw7XHJcbiAgICAgICAgICAgIHRoaXMubWVkaWFLaW5kID0gbWVkaWFLaW5kO1xyXG4gICAgICAgICAgICBpZiggbWVkaWFLaW5kID09ICdpbWcnICkge1xyXG4gICAgICAgICAgICAgIHRoaXMubWVkaWFNYXJrdXAgPSAnPGltZyBjbGFzcz1cIm5HWTJWaWV3ZXJNZWRpYVwiIHNyYz1cIicgKyB1cmwgKyAnXCIgYWx0PVwiIFwiIGl0ZW1wcm9wPVwiY29udGVudFVSTFwiIGRyYWdnYWJsZT1cImZhbHNlXCI+JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLy0tLSBjaGVjayBpZiBjdXJyZW50IGl0ZW0gc2hvdWxkIGJlIGRpc3BsYXllZFxyXG4gICAgICAgICAgTkdZMkl0ZW0ucHJvdG90eXBlLmlzVG9EaXNwbGF5ID0gZnVuY3Rpb24oIGFsYnVtSUQgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFsYnVtSUQgPT0gYWxidW1JRCAmJiB0aGlzLmNoZWNrVGFnRmlsdGVyKCkgJiYgdGhpcy5pc1NlYXJjaEZvdW5kKCkgJiYgdGhpcy5pc1NlYXJjaFRhZ0ZvdW5kKCkgJiYgdGhpcy5kZWxldGVkID09IGZhbHNlO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vLS0tIHJldHVybnMgdGhlIG51bWJlciBvZiBpdGVtcyBvZiB0aGUgY3VycmVudCBhbGJ1bVxyXG4gICAgICAgICAgLy8tLS0gY291bnQgdXNpbmcgdGFncyBmaWx0ZXJcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5nZXRDb250ZW50TGVuZ3RoID0gZnVuY3Rpb24oIGZpbHRlclRhZ3MgKSB7XHJcbiAgICAgICAgICAgIGlmKCBmaWx0ZXJUYWdzID09IGZhbHNlIHx8IHRoaXMuYWxidW1UYWdMaXN0Lmxlbmd0aCA9PSAwIHx8IHRoaXMuRy5nYWxsZXJ5RmlsdGVyVGFncy5HZXQoKSA9PSBmYWxzZSApIHtcclxuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50TGVuZ3RoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIHZhciBsID0gdGhpcy5HLkkubGVuZ3RoO1xyXG4gICAgICAgICAgICAgIHZhciBjbnQgPSAwO1xyXG4gICAgICAgICAgICAgIHZhciBhbGJ1bUlEID0gdGhpcy5HZXRJRCgpO1xyXG4gICAgICAgICAgICAgIGZvciggdmFyIGlkeCA9IDA7IGlkeCA8IGw7IGlkeCsrICkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLkcuSVtpZHhdO1xyXG4gICAgICAgICAgICAgICAgaWYoIGl0ZW0uaXNUb0Rpc3BsYXkoYWxidW1JRCkgKSB7XHJcbiAgICAgICAgICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICByZXR1cm4gY250O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBOR1kySXRlbS5wcm90b3R5cGUuaXNTZWFyY2hGb3VuZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpZiggdGhpcy5HLkdPTS5hbGJ1bVNlYXJjaCAhPSAnJyApIHtcclxuICAgICAgICAgICAgICBpZiggdGhpcy50aXRsZS50b1VwcGVyQ2FzZSgpLmluZGV4T2YoIHRoaXMuRy5HT00uYWxidW1TZWFyY2ggKSA9PSAtMSApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8tLS0gZm9yIGZ1dHVyZSB1c2UuLi5cclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5yZXNwb25zaXZlVVJMID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gJyc7XHJcbiAgICAgICAgICAgIHN3aXRjaCh0aGlzLkcuTy5raW5kKSB7XHJcbiAgICAgICAgICAgICAgY2FzZSAnJzpcclxuICAgICAgICAgICAgICAgIHVybCA9IHRoaXMuc3JjO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnZmxpY2tyJzpcclxuICAgICAgICAgICAgICAgIHVybCA9IHRoaXMuc3JjO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAncGljYXNhJzpcclxuICAgICAgICAgICAgICBjYXNlICdnb29nbGUnOlxyXG4gICAgICAgICAgICAgIGNhc2UgJ2dvb2dsZTInOlxyXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB1cmwgPSB0aGlzLnNyYztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB1cmw7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vLS0tIFJldmVhbCB0aGUgdGh1bWJuYWlsIGltYWdlIHdpdGggYW5pbWF0aW9uIG9uIG9wYWNpdHlcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5UaHVtYm5haWxJbWFnZVJldmVhbCA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIGlmKCB0aGlzLnRodW1ibmFpbEltZ1JldmVhbGVkID09IGZhbHNlICkge1xyXG4gICAgICAgICAgICAgIHRoaXMudGh1bWJuYWlsSW1nUmV2ZWFsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIG5ldyBOR1R3ZWVuYWJsZSgpLnR3ZWVuKHtcclxuICAgICAgICAgICAgICAgIGZyb206ICAgICAgICAgeyBvcGFjaXR5OiAwIH0sXHJcbiAgICAgICAgICAgICAgICB0bzogICAgICAgICAgIHsgb3BhY2l0eTogMSB9LFxyXG4gICAgICAgICAgICAgICAgYXR0YWNobWVudDogICB7IGl0ZW06IHRoaXMgfSxcclxuICAgICAgICAgICAgICAgIGRlbGF5OiAgICAgICAgMzAsXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogICAgIDQwMCxcclxuICAgICAgICAgICAgICAgIGVhc2luZzogICAgICAgJ2Vhc2VPdXRRdWFydCcsXHJcbiAgICAgICAgICAgICAgICBzdGVwOiAgICAgICAgIGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciAkZT1hdHQuaXRlbS4kZ2V0RWx0KCcubkdZMlRuSW1nJyk7XHJcbiAgICAgICAgICAgICAgICAgIGlmKCAkZSAhPSBudWxsICkge1xyXG4gICAgICAgICAgICAgICAgICAgICRlLmNzcyggc3RhdGUgKTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgICAgIC8vIEluIGNhc2Ugb2YgdGh1bWJuYWlscyB3aXRoIHN0YWNrcyAtIGFwcGx5IGEgcGVyY2VudCB0byBhIHZhbHVlIHdoaWNoIGluY2x1ZGUgYSB1bml0XHJcbiAgICAgICAgICBmdW5jdGlvbiBWYWx1ZUFwcGx5UGVyY2VudCggc3RyLCBwZXJjZW50ICkge1xyXG4gICAgICAgICAgICBzdHI9U3RyaW5nKHN0cik7XHJcbiAgICAgICAgICAgIGlmKCBzdHIgPT09ICcwJyB8fCBwZXJjZW50ID09IDEgKSB7IHJldHVybiBzdHI7IH1cclxuICAgICAgICAgICAgdmFyIG4gPSBOdW1iZXIoc3RyLnJlcGxhY2UoL1thLXpBLVpdL2csICcnKSk7XHJcbiAgICAgICAgICAgIHZhciBhciA9IHN0ci5tYXRjaCgvKFteXFwtMC05XFwuXSspL2cpO1xyXG4gICAgICAgICAgICB2YXIgYSA9ICcnO1xyXG4gICAgICAgICAgICBpZiggYXIgIT0gbnVsbCAmJiBhci5sZW5ndGggPiAwICkge1xyXG4gICAgICAgICAgICAgIGEgPSBhci5qb2luKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiggaXNOYU4obikgfHwgbiA9PSAwICkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBzdHI7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG4gPSBuICogcGVyY2VudDtcclxuICAgICAgICAgICAgcmV0dXJuIG4gKyBhO1xyXG4gICAgICAgICAgfSBcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgLy8tLS0gMkQvM0QgQ1NTIHRyYW5zZm9ybSAtIGFwcGx5IHRoZSBjYWNoZWQgdmFsdWUgdG8gZWxlbWVudFxyXG4gICAgICAgICAgTkdZMkl0ZW0ucHJvdG90eXBlLkNTU1RyYW5zZm9ybUFwcGx5ID0gZnVuY3Rpb24gKCBlbHRDbGFzcyApIHtcclxuICAgICAgICAgICAgdmFyIG9iaiA9IHRoaXMuZWx0VHJhbnNmb3JtW2VsdENsYXNzXTtcclxuXHJcbiAgICAgICAgICAgIGlmKCBlbHRDbGFzcyA9PSAnLm5HWTJHVGh1bWJuYWlsJyApIHtcclxuICAgICAgICAgICAgICAvLyB0aHVtYm5haWxcclxuICAgICAgICAgICAgICB2YXIgbmJTdGFja3MgPSBvYmouJGVsdC5sZW5ndGgtMTtcclxuICAgICAgICAgICAgICB2YXIgcFRyYW5zbGF0ZVggPSAxO1xyXG4gICAgICAgICAgICAgIHZhciBwVHJhbnNsYXRlWSA9IDE7XHJcbiAgICAgICAgICAgICAgdmFyIHBUcmFuc2xhdGVaID0gMTtcclxuICAgICAgICAgICAgICB2YXIgcFRyYW5zbGF0ZSA9IDE7XHJcbiAgICAgICAgICAgICAgdmFyIHBSb3RhdGVYID0gMTtcclxuICAgICAgICAgICAgICB2YXIgcFJvdGF0ZVkgPSAxO1xyXG4gICAgICAgICAgICAgIHZhciBwUm90YXRlWiA9IDE7XHJcbiAgICAgICAgICAgICAgdmFyIHBSb3RhdGUgPSAxO1xyXG4gICAgICAgICAgICAgIHZhciBwU2NhbGUgPSAxO1xyXG4gICAgICAgICAgICAgIGZvciggdmFyIG4gPSBuYlN0YWNrczsgbiA+PSAwOyBuLS0gKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB1bml0cyBtdXN0IGJlIGdpdmVuIHdpdGhcclxuICAgICAgICAgICAgICAgIHZhciB2ID0gJ3RyYW5zbGF0ZVgoJyArIFZhbHVlQXBwbHlQZXJjZW50KG9iai50cmFuc2xhdGVYLHBUcmFuc2xhdGVYKSArICcpIHRyYW5zbGF0ZVkoJyArIFZhbHVlQXBwbHlQZXJjZW50KG9iai50cmFuc2xhdGVZLHBUcmFuc2xhdGVZKSArICcpIHRyYW5zbGF0ZVooJyArIFZhbHVlQXBwbHlQZXJjZW50KG9iai50cmFuc2xhdGVaLHBUcmFuc2xhdGVaKSArICcpIHNjYWxlKCcgKyBWYWx1ZUFwcGx5UGVyY2VudChvYmouc2NhbGUscFNjYWxlKSArICcpIHRyYW5zbGF0ZSgnICsgVmFsdWVBcHBseVBlcmNlbnQob2JqLnRyYW5zbGF0ZSxwVHJhbnNsYXRlKSArICcpJztcclxuICAgICAgICAgICAgICAgIGlmKCAhKHRoaXMuRy5JRSA8PSA5KSAmJiAhdGhpcy5HLmlzR2luZ2VyYnJlYWQgKSB7XHJcbiAgICAgICAgICAgICAgICAgIHYgKz0gJyByb3RhdGVYKCcgKyBWYWx1ZUFwcGx5UGVyY2VudChvYmoucm90YXRlWCxwUm90YXRlWCkgKyAnKSByb3RhdGVZKCcgKyBWYWx1ZUFwcGx5UGVyY2VudChvYmoucm90YXRlWSxwUm90YXRlWSkgKyAnKSByb3RhdGVaKCcgKyBWYWx1ZUFwcGx5UGVyY2VudChvYmoucm90YXRlWixwUm90YXRlWikgKyAnKSByb3RhdGUoJyArIFZhbHVlQXBwbHlQZXJjZW50KG9iai5yb3RhdGUscFJvdGF0ZSkgKyAnKSc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgdiArPSAnIHJvdGF0ZSgnICsgVmFsdWVBcHBseVBlcmNlbnQob2JqLnJvdGF0ZVoscFJvdGF0ZVopICsgJyknO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JqLiRlbHRbbl0uc3R5bGVbdGhpcy5HLkNTU3RyYW5zZm9ybU5hbWVdID0gdjtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaWYoIG5iU3RhY2tzID4gMCApIHtcclxuICAgICAgICAgICAgICAgICAgLy8gYXBwbHkgYSBwZXJjZW50IHRvIHRoZSBzdGFjayBlbGVtZW50c1xyXG4gICAgICAgICAgICAgICAgICBwVHJhbnNsYXRlWCAtPSB0aGlzLkcudG4ub3B0LkdldCgnc3RhY2tzVHJhbnNsYXRlWCcpO1xyXG4gICAgICAgICAgICAgICAgICBwVHJhbnNsYXRlWSAtPSB0aGlzLkcudG4ub3B0LkdldCgnc3RhY2tzVHJhbnNsYXRlWScpO1xyXG4gICAgICAgICAgICAgICAgICBwVHJhbnNsYXRlWiAtPSB0aGlzLkcudG4ub3B0LkdldCgnc3RhY2tzVHJhbnNsYXRlWicpO1xyXG4gICAgICAgICAgICAgICAgICBwUm90YXRlWCAgICAtPSB0aGlzLkcudG4ub3B0LkdldCgnc3RhY2tzUm90YXRlWCcpO1xyXG4gICAgICAgICAgICAgICAgICBwUm90YXRlWSAgICAtPSB0aGlzLkcudG4ub3B0LkdldCgnc3RhY2tzUm90YXRlWScpO1xyXG4gICAgICAgICAgICAgICAgICBwUm90YXRlWiAgICAtPSB0aGlzLkcudG4ub3B0LkdldCgnc3RhY2tzUm90YXRlWicpO1xyXG4gICAgICAgICAgICAgICAgICBwU2NhbGUgICAgICAtPSB0aGlzLkcudG4ub3B0LkdldCgnc3RhY2tzU2NhbGUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gdGh1bWJuYWlsIHN1YiBlbGVtZW50XHJcbiAgICAgICAgICAgICAgaWYoIG9iai4kZWx0ICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IoIHZhciBuID0gMDsgbiA8IG9iai4kZWx0Lmxlbmd0aDsgbisrICkge1xyXG4gICAgICAgICAgICAgICAgICBpZiggb2JqLiRlbHRbbl0gIT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHVuaXRzIG11c3QgYmUgZ2l2ZW4gd2l0aFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2ID0gJ3RyYW5zbGF0ZVgoJyArIG9iai50cmFuc2xhdGVYICsgJykgdHJhbnNsYXRlWSgnICsgb2JqLnRyYW5zbGF0ZVkgKyAnKSB0cmFuc2xhdGVaKCcgKyBvYmoudHJhbnNsYXRlWiArICcpIHNjYWxlKCcgKyBvYmouc2NhbGUgKyAnKSB0cmFuc2xhdGUoJyArIG9iai50cmFuc2xhdGUgKyAnKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoICEodGhpcy5HLklFIDw9IDkpICYmICF0aGlzLkcuaXNHaW5nZXJicmVhZCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHYgKz0gJyByb3RhdGVYKCcgKyBvYmoucm90YXRlWCArICcpIHJvdGF0ZVkoJyArIG9iai5yb3RhdGVZICsgJykgcm90YXRlWignICsgb2JqLnJvdGF0ZVogKyAnKSByb3RhdGUoJyArIG9iai5yb3RhdGUgKyAnKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgdiArPSAnIHJvdGF0ZSgnICsgb2JqLnJvdGF0ZVogKyAnKSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG9iai4kZWx0W25dLnN0eWxlW3RoaXMuRy5DU1N0cmFuc2Zvcm1OYW1lXSA9IHY7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAvLy0tLSAyRC8zRCBDU1MgdHJhbnNmb3JtIC0gc2V0IGEgdmFsdWUgaW4gY2FjaGVcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5DU1NUcmFuc2Zvcm1TZXQgPSBmdW5jdGlvbiAoIGVsdENsYXNzLCB0cmFuc2Zvcm0sIHZhbHVlLCBmb3JjZVJlZnJlc2ggKSB7XHJcbiAgICAgICAgICAgIGlmKCB0aGlzLmVsdFRyYW5zZm9ybVtlbHRDbGFzc10gPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZWx0VHJhbnNmb3JtW2VsdENsYXNzXSA9IHsgdHJhbnNsYXRlWDogMCwgdHJhbnNsYXRlWTogMCwgdHJhbnNsYXRlWjogMCwgcm90YXRlWDogMCwgcm90YXRlWTogMCwgcm90YXRlWjogMCwgc2NhbGU6IDEsIHRyYW5zbGF0ZTogJzBweCwwcHgnLCByb3RhdGU6IDAgfTtcclxuICAgICAgICAgICAgICB0aGlzLmVsdFRyYW5zZm9ybVtlbHRDbGFzc10uJGVsdCA9IHRoaXMuJGdldEVsdChlbHRDbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbHRUcmFuc2Zvcm1bZWx0Q2xhc3NdW3RyYW5zZm9ybV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYoIGZvcmNlUmVmcmVzaCA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgICB0aGlzLmVsdFRyYW5zZm9ybVtlbHRDbGFzc10uJGVsdCA9IHRoaXMuJGdldEVsdChlbHRDbGFzcywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgLy8tLS0gQ1NTIEZpbHRlcnMgLSBhcHBseSB0aGUgY2FjaGVkIHZhbHVlIHRvIGVsZW1lbnRcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5DU1NGaWx0ZXJBcHBseSA9IGZ1bmN0aW9uICggZWx0Q2xhc3MgKSB7XHJcbiAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLmVsdEZpbHRlcltlbHRDbGFzc107XHJcbiAgICAgICAgICAgIHZhciB2ID0gJ2JsdXIoJyArIG9iai5ibHVyICsgJykgYnJpZ2h0bmVzcygnICsgb2JqLmJyaWdodG5lc3MgKyAnKSBncmF5c2NhbGUoJyArIG9iai5ncmF5c2NhbGUgKyAnKSBzZXBpYSgnICsgb2JqLnNlcGlhICsgJykgY29udHJhc3QoJyArIG9iai5jb250cmFzdCArICcpIG9wYWNpdHkoJyArIG9iai5vcGFjaXR5ICsgJykgc2F0dXJhdGUoJyArIG9iai5zYXR1cmF0ZSArICcpJztcclxuICAgICAgICAgICAgaWYoIG9iai4kZWx0ICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgZm9yKCB2YXIgbiA9IDA7IG4gPCBvYmouJGVsdC5sZW5ndGg7IG4rKyApIHtcclxuICAgICAgICAgICAgICAgIGlmKCBvYmouJGVsdFtuXSAhPSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICAgIG9iai4kZWx0W25dLnN0eWxlLldlYmtpdEZpbHRlciA9IHY7XHJcbiAgICAgICAgICAgICAgICAgIG9iai4kZWx0W25dLnN0eWxlLmZpbHRlciA9IHY7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIC8vLS0tIENTUyBGaWx0ZXJzIC0gc2V0IGEgdmFsdWUgaW4gY2FjaGVcclxuICAgICAgICAgIE5HWTJJdGVtLnByb3RvdHlwZS5DU1NGaWx0ZXJTZXQgPSBmdW5jdGlvbiAoIGVsdENsYXNzLCBmaWx0ZXIsIHZhbHVlLCBmb3JjZVJlZnJlc2ggKSB7XHJcbiAgICAgICAgICAgIGlmKCB0aGlzLmVsdEZpbHRlcltlbHRDbGFzc10gPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgIHRoaXMuZWx0RmlsdGVyW2VsdENsYXNzXSA9IHsgYmx1cjogMCwgYnJpZ2h0bmVzczogJzEwMCUnLCBncmF5c2NhbGU6ICcwJScsIHNlcGlhOiAnMCUnLCBjb250cmFzdDogJzEwMCUnLCBvcGFjaXR5OiAnMTAwJScsIHNhdHVyYXRlOiAnMTAwJScgfTtcclxuICAgICAgICAgICAgICB0aGlzLmVsdEZpbHRlcltlbHRDbGFzc10uJGVsdCA9IHRoaXMuJGdldEVsdChlbHRDbGFzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5lbHRGaWx0ZXJbZWx0Q2xhc3NdW2ZpbHRlcl0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYoIGZvcmNlUmVmcmVzaCA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgICB0aGlzLmVsdFRyYW5zZm9ybVtlbHRDbGFzc10uJGVsdCA9IHRoaXMuJGdldEVsdChlbHRDbGFzcywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgLy8tLS0gdGh1bWJuYWlsIGhvdmVyIGFuaW1hdGlvblxyXG4gICAgICAgICAgTkdZMkl0ZW0ucHJvdG90eXBlLmFuaW1hdGUgPSBmdW5jdGlvbiAoIGVmZmVjdCwgZGVsYXksIGhvdmVySW4gKSB7XHJcbiAgICAgICAgICAgIGlmKCB0aGlzLiRnZXRFbHQoKSA9PSBudWxsICApIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICAgICAgICB2YXIgY29udGV4dCA9IHt9O1xyXG4gICAgICAgICAgICBjb250ZXh0LkcgPSB0aGlzLkc7XHJcbiAgICAgICAgICAgIGNvbnRleHQuaXRlbSA9IHRoaXM7XHJcbiAgICAgICAgICAgIGNvbnRleHQuZWZmZWN0ID0gZWZmZWN0O1xyXG4gICAgICAgICAgICBjb250ZXh0LmhvdmVySW4gPSBob3ZlckluO1xyXG4gICAgICAgICAgICBjb250ZXh0LmNzc0tpbmQgPSAnJztcclxuICAgICAgICAgICAgaWYoIGhvdmVySW4gKSB7XHJcbiAgICAgICAgICAgICAgLy8gSE9WRVIgSU5cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBpZiggdGhpcy5lbHRFZmZlY3RbZWZmZWN0LmVsZW1lbnRdID09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWx0RWZmZWN0W2VmZmVjdC5lbGVtZW50XSA9IFtdO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiggdGhpcy5lbHRFZmZlY3RbZWZmZWN0LmVsZW1lbnRdW2VmZmVjdC50eXBlXSA9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsdEVmZmVjdFtlZmZlY3QuZWxlbWVudF1bZWZmZWN0LnR5cGVdID0geyBpbml0aWFsVmFsdWU6IDAsIGxhc3RWYWx1ZTogMCB9O1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiggZWZmZWN0LmZpcnN0S2V5ZnJhbWUgKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBzdG9yZSBpbml0aWFsIGFuZCBjdXJyZW50IHZhbHVlIC0+IGZvciB1c2UgaW4gdGhlIGJhY2sgYW5pbWF0aW9uXHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsdEVmZmVjdFtlZmZlY3QuZWxlbWVudF1bZWZmZWN0LnR5cGVdID0geyBpbml0aWFsVmFsdWU6IGVmZmVjdC5mcm9tLCBsYXN0VmFsdWU6IGVmZmVjdC5mcm9tfTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgY29udGV4dC5hbmltZUZyb20gPSBlZmZlY3QuZnJvbTtcclxuICAgICAgICAgICAgICBjb250ZXh0LmFuaW1lVG8gPSBlZmZlY3QudG87XHJcbiAgICAgICAgICAgICAgY29udGV4dC5hbmltZUR1cmF0aW9uID0gcGFyc2VJbnQoZWZmZWN0LmR1cmF0aW9uKTtcclxuICAgICAgICAgICAgICBjb250ZXh0LmFuaW1lRGVsYXkgPSAzMCArIHBhcnNlSW50KGVmZmVjdC5kZWxheSArIGRlbGF5KTsgIC8vIDMwbXMgaXMgYSBkZWZhdWx0IGRlbGF5IHRvIGF2b2lkIGNvbmZsaWN0IHdpdGggb3RoZXIgaW5pdGlhbGl6YXRpb25zXHJcbiAgICAgICAgICAgICAgY29udGV4dC5hbmltZUVhc2luZyA9IGVmZmVjdC5lYXNpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gSE9WRVIgT1VUXHJcbiAgICAgICAgICAgICAgaWYoIGVmZmVjdC5maXJzdEtleWZyYW1lICkge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5hbmltZUZyb20gPSB0aGlzLmVsdEVmZmVjdFtlZmZlY3QuZWxlbWVudF1bZWZmZWN0LnR5cGVdLmxhc3RWYWx1ZTtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuYW5pbWVUbyA9IHRoaXMuZWx0RWZmZWN0W2VmZmVjdC5lbGVtZW50XVtlZmZlY3QudHlwZV0uaW5pdGlhbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgLy8gY29udGV4dC5hbmltZVRvPWVmZmVjdC5mcm9tO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnRleHQuYW5pbWVGcm9tPWVmZmVjdC5mcm9tO1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5hbmltZUZyb20gPSB0aGlzLmVsdEVmZmVjdFtlZmZlY3QuZWxlbWVudF1bZWZmZWN0LnR5cGVdLmxhc3RWYWx1ZTtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuYW5pbWVUbyA9IHRoaXMuZWx0RWZmZWN0W2VmZmVjdC5lbGVtZW50XVtlZmZlY3QudHlwZV0uaW5pdGlhbFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgLy8gY29udGV4dC5hbmltZVRvPWVmZmVjdC50bztcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICBjb250ZXh0LmFuaW1lRHVyYXRpb24gPSBwYXJzZUludChlZmZlY3QuZHVyYXRpb25CYWNrKTtcclxuICAgICAgICAgICAgICBjb250ZXh0LmFuaW1lRGVsYXkgPSAzMCArIHBhcnNlSW50KGVmZmVjdC5kZWxheUJhY2sgKyBkZWxheSk7ICAgLy8gMzBtcyBpcyBhIGRlZmF1bHQgZGVsYXkgdG8gYXZvaWQgY29uZmxpY3Qgd2l0aCBvdGhlciBpbml0aWFsaXphdGlvbnNcclxuICAgICAgICAgICAgICBjb250ZXh0LmFuaW1lRWFzaW5nID0gZWZmZWN0LmVhc2luZ0JhY2s7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAvLyBkZXRlY3QgaWYgYW5pbWF0aW9uIG9uIENTUyB0cmFuc2Zvcm1cclxuICAgICAgICAgICAgdmFyIHRyYW5zZm9ybT1bJ3RyYW5zbGF0ZVgnLCAndHJhbnNsYXRlWScsICd0cmFuc2xhdGVaJywgJ3NjYWxlJywgJ3JvdGF0ZVgnLCAncm90YXRlWScsICdyb3RhdGVaJ107XHJcbiAgICAgICAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgdHJhbnNmb3JtLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgICAgIGlmKCBlZmZlY3QudHlwZSA9PSB0cmFuc2Zvcm1baV0gKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LmNzc0tpbmQgPSAndHJhbnNmb3JtJztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZGV0ZWN0IGlmIGFuaW1hdGlvbiBvbiBDU1MgZmlsdGVyXHJcbiAgICAgICAgICAgIHZhciBmaWx0ZXI9WydibHVyJywgJ2JyaWdodG5lc3MnLCAnZ3JheXNjYWxlJywgJ3NlcGlhJywgJ2NvbnRyYXN0JywgJ29wYWNpdHknLCAnc2F0dXJhdGUnXTtcclxuICAgICAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBmaWx0ZXIubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgaWYoIGVmZmVjdC50eXBlID09IGZpbHRlcltpXSApIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuY3NzS2luZCA9ICdmaWx0ZXInO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGhhbmRsZSBzb21lIHNwZWNpYWwgY2FzZXNcclxuICAgICAgICAgICAgaWYoIGhvdmVySW4gJiYgZWZmZWN0LmVsZW1lbnQgPT0gJy5uR1kyR1RodW1ibmFpbCcgJiYgKCBlZmZlY3QudHlwZSA9PSAnc2NhbGUnIHx8IGVmZmVjdC50eXBlID09ICdyb3RhdGVYJykgKSB7XHJcbiAgICAgICAgICAgICAgdGhpcy5HLkdPTS5sYXN0WkluZGV4Kys7XHJcbiAgICAgICAgICAgICAgdGhpcy4kZ2V0RWx0KGVmZmVjdC5lbGVtZW50KS5jc3MoJ3otaW5kZXgnLCB0aGlzLkcuR09NLmxhc3RaSW5kZXgpO1xyXG4gICAgICAgICAgICAgIC8vIHNldEVsZW1lbnRPblRvcCh0aGlzLkcuJEUuYmFzZSwgdGhpcy4kZ2V0RWx0KGVmZmVjdC5lbGVtZW50KSApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBhbmltYXRpb25cclxuICAgICAgICAgICAgdmFyIHR3ZWVuYWJsZSA9IG5ldyBOR1R3ZWVuYWJsZSgpO1xyXG4gICAgICAgICAgICBjb250ZXh0LnR3ZWVuYWJsZT10d2VlbmFibGU7XHJcbiAgICAgICAgICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAgICAgICAgICAgICAgYXR0YWNobWVudDogICBjb250ZXh0LFxyXG4gICAgICAgICAgICAgIGZyb206ICAgICAgICAgeyAndic6IGNvbnRleHQuYW5pbWVGcm9tIH0sXHJcbiAgICAgICAgICAgICAgdG86ICAgICAgICAgICB7ICd2JzogY29udGV4dC5hbmltZVRvIH0sXHJcbiAgICAgICAgICAgICAgZHVyYXRpb246ICAgICBjb250ZXh0LmFuaW1lRHVyYXRpb24sICAgIC8vcGFyc2VJbnQoZWZmZWN0LmR1cmF0aW9uKSxcclxuICAgICAgICAgICAgICBkZWxheTogICAgICAgIGNvbnRleHQuYW5pbWVEZWxheSwgICAgICAgLy9wYXJzZUludChlZmZlY3QuZGVsYXkpLFxyXG4gICAgICAgICAgICAgIGVhc2luZzogICAgICAgY29udGV4dC5hbmltZUVhc2luZywgICAgICAvLydlYXNlT3V0UXVhcnQnLFxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIHN0ZXA6IGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiggYXR0Lml0ZW0uJGdldEVsdCgpID09IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIHRoZSB0aHVtYm5haWwgbWF5IGJlIGRlc3Ryb3llZCBzaW5jZSB0aGUgc3RhcnQgb2YgdGhlIGFuaW1hdGlvblxyXG4gICAgICAgICAgICAgICAgICBhdHQudHdlZW5hYmxlLnN0b3AoZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAvLyBhdHQudHdlZW5hYmxlLmRpc3Bvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYoIGF0dC5ob3ZlckluICYmICFhdHQuaXRlbS5ob3ZlcmVkICkge1xyXG4gICAgICAgICAgICAgICAgICAvLyB0aHVtYm5haWwgbm8gbW9yZSBob3ZlcmVkXHJcbiAgICAgICAgICAgICAgICAgIGF0dC50d2VlbmFibGUuc3RvcChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgIC8vIGF0dC50d2VlbmFibGUuZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoIGF0dC5HLlZPTS52aWV3ZXJEaXNwbGF5ZWQgKSB7XHJcbiAgICAgICAgICAgICAgICAgIGF0dC50d2VlbmFibGUuc3RvcChmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgIC8vIGF0dC50d2VlbmFibGUuZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIC8vIHRlc3QgaWYgaW4gZGVsYXkgcGhhc2VcclxuICAgICAgICAgICAgICAgIGlmKCBzdGF0ZS52ID09IGF0dC5hbmltZUZyb20gKSB7IHJldHVybjsgfVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBzd2l0Y2goIGF0dC5jc3NLaW5kICkge1xyXG4gICAgICAgICAgICAgICAgICBjYXNlICd0cmFuc2Zvcm0nOlxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU1RyYW5zZm9ybVNldChhdHQuZWZmZWN0LmVsZW1lbnQsIGF0dC5lZmZlY3QudHlwZSwgc3RhdGUudik7XHJcbiAgICAgICAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NUcmFuc2Zvcm1BcHBseSggYXR0LmVmZmVjdC5lbGVtZW50ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbHRlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gd2luZG93Lm5nX2RyYWYoIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTRmlsdGVyU2V0KGF0dC5lZmZlY3QuZWxlbWVudCwgYXR0LmVmZmVjdC50eXBlLCBzdGF0ZS52KTtcclxuICAgICAgICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU0ZpbHRlckFwcGx5KCBhdHQuZWZmZWN0LmVsZW1lbnQgKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdj1zdGF0ZS52O1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKCBzdGF0ZS52LnN1YnN0cmluZygwLDQpID09ICdyZ2IoJyB8fCBzdGF0ZS52LnN1YnN0cmluZygwLDUpID09ICdyZ2JhKCcgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAvLyB0byByZW1vdmUgdmFsdWVzIGFmdGVyIHRoZSBkb3QgKG5vdCBzdXBwb3J0ZWQgYnkgUkdCL1JHQkEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAvLyB2PW5ndGlueWNvbG9yKHN0YXRlLnYpLnRvUmdiU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB2ID0gU2hhZGVCbGVuZENvbnZlcnQoMCwgdik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGF0dC5pdGVtLiRnZXRFbHQoIGF0dC5lZmZlY3QuZWxlbWVudCApLmNzcyggYXR0LmVmZmVjdC50eXBlLCB2ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiggaG92ZXJJbiApIHtcclxuICAgICAgICAgICAgICAgICAgLy8gc3RvcmUgdmFsdWUgZm9yIGJhY2sgYW5pbWF0aW9uXHJcbiAgICAgICAgICAgICAgICAgIGF0dC5pdGVtLmVsdEVmZmVjdFthdHQuZWZmZWN0LmVsZW1lbnRdW2F0dC5lZmZlY3QudHlwZV0ubGFzdFZhbHVlID0gc3RhdGUudjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgIGZpbmlzaDogZnVuY3Rpb24gKHN0YXRlLCBhdHQpIHtcclxuICAgICAgICAgICAgICAgIGlmKCBob3ZlckluICkge1xyXG4gICAgICAgICAgICAgICAgICAvLyBzdG9yZSB2YWx1ZSBmb3IgYmFjayBhbmltYXRpb25cclxuICAgICAgICAgICAgICAgICAgYXR0Lml0ZW0uZWx0RWZmZWN0W2F0dC5lZmZlY3QuZWxlbWVudF1bYXR0LmVmZmVjdC50eXBlXS5sYXN0VmFsdWUgPSBzdGF0ZS52O1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmKCBhdHQuaXRlbS4kZ2V0RWx0KCkgPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgICAgICAgLy8gdGhlIHRodW1ibmFpbCBtYXkgYmUgZGVzdHJveWVkIHNpbmNlIHRoZSBzdGFydCBvZiB0aGUgYW5pbWF0aW9uXHJcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmKCBhdHQuaG92ZXJJbiAmJiAhYXR0Lml0ZW0uaG92ZXJlZCApIHtcclxuICAgICAgICAgICAgICAgICAgLy8gdGh1bWJuYWlsIG5vIG1vcmUgaG92ZXJlZFxyXG4gICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoIGF0dC5HLlZPTS52aWV3ZXJEaXNwbGF5ZWQgKSB7XHJcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyB3aW5kb3cubmdfZHJhZiggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgIHN3aXRjaCggYXR0LmNzc0tpbmQgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndHJhbnNmb3JtJzpcclxuICAgICAgICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU1RyYW5zZm9ybVNldChhdHQuZWZmZWN0LmVsZW1lbnQsIGF0dC5lZmZlY3QudHlwZSwgYXR0LmFuaW1lVG8pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoYXR0LmVmZmVjdC5lbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2ZpbHRlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NGaWx0ZXJTZXQoYXR0LmVmZmVjdC5lbGVtZW50LCBhdHQuZWZmZWN0LnR5cGUsIGF0dC5hbmltZVRvKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU0ZpbHRlckFwcGx5KGF0dC5lZmZlY3QuZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgYXR0Lml0ZW0uJGdldEVsdChhdHQuZWZmZWN0LmVsZW1lbnQpLmNzcyhhdHQuZWZmZWN0LnR5cGUsIGF0dC5hbmltZVRvKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICByZXR1cm4gTkdZMkl0ZW07XHJcbiAgICAgICAgfSkoKTsgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgfVxyXG5cclxuICAgICAgX3RoaXMub3B0aW9ucyA9IGpRdWVyeS5leHRlbmQodHJ1ZSwge30sIGpRdWVyeS5uYW5vZ2FsbGVyeTIuZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgICAvLyBJbml0aWFsaXphdGlvbiBjb2RlXHJcbiAgICAgIF90aGlzLm5HMiA9IG51bGw7XHJcbiAgICAgIF90aGlzLm5HMiA9IG5ldyBuYW5vR0FMTEVSWTIoKTtcclxuICAgICAgX3RoaXMubkcyLmluaXRpYXRlR2FsbGVyeTIoX3RoaXMuZSwgX3RoaXMub3B0aW9ucyApO1xyXG5cclxuICAgIH07XHJcbiAgICAgIFxyXG4gICAgLy8gUFVCTElDIEVYUE9TRUQgTUVUSE9EU1xyXG4gICAgX3RoaXMudGVzdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAvL2FsZXJ0KCd0ZXN0Jyk7XHJcbiAgICAgIC8vIGNvbnNvbGUuZGlyKF90aGlzLm5HLkcuSS5sZW5ndGgpO1xyXG4gICAgICAvLyBjb25zb2xlLmRpcihfdGhpcy5uRyk7XHJcbiAgICAgIC8vcHJpdmF0ZVRlc3QoKTtcclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIC8vIFJ1biBpbml0aWFsaXplclxyXG4gICAgX3RoaXMuaW5pdCgpO1xyXG4gIH07XHJcbiBcclxuICBqUXVlcnkubmFub2dhbGxlcnkyLmRlZmF1bHRPcHRpb25zID0ge1xyXG4gICAga2luZCA6ICAgICAgICAgICAgICAgICAgICAgICAgJycsXHJcbiAgICB1c2VySUQgOiAgICAgICAgICAgICAgICAgICAgICAnJyxcclxuICAgIHBob3Rvc2V0IDogICAgICAgICAgICAgICAgICAgICcnLFxyXG4gICAgYWxidW06ICAgICAgICAgICAgICAgICAgICAgICAgJycsXHJcbiAgICBibGFja0xpc3QgOiAgICAgICAgICAgICAgICAgICAnc2NyYXBib29rfHByb2ZpbHxhdXRvIGJhY2t1cCcsXG4gICAgd2hpdGVMaXN0IDogICAgICAgICAgICAgICAgICAgJycsXG4gICAgYWxidW1MaXN0IDogICAgICAgICAgICAgICAgICAgJycsXHJcbiAgICBhbGJ1bUxpc3QyIDogICAgICAgICAgICAgICAgICBudWxsLFxyXG4gICAgUlRMIDogICAgICAgICAgICAgICAgICAgICAgICAgZmFsc2UsXHJcbiAgICBwb29nbGVwbHVzVXNlVXJsQ3Jvc3NEb21haW4gOiB0cnVlLFxyXG4gICAgZmxpY2tyU2tpcE9yaWdpbmFsIDogICAgICAgICAgdHJ1ZSxcclxuICAgIGJyZWFkY3J1bWJBdXRvSGlkZVRvcExldmVsIDogIHRydWUsXHJcbiAgICBkaXNwbGF5QnJlYWRjcnVtYiA6ICAgICAgICAgICB0cnVlLFxyXG4gICAgYnJlYWRjcnVtYk9ubHlDdXJyZW50TGV2ZWwgOiAgdHJ1ZSxcclxuICAgIGJyZWFkY3J1bWJIaWRlSWNvbnMgOiAgICAgICAgIHRydWUsXHJcbiAgICB0aGVtZSA6ICAgICAgICAgICAgICAgICAgICAgICAnbkdZMicsXHJcbiAgICBnYWxsZXJ5VGhlbWUgOiAgICAgICAgICAgICAgICAnZGFyaycsXG4gICAgdmlld2VyVGhlbWUgOiAgICAgICAgICAgICAgICAgJ2RhcmsnLFxyXG4gICAgaXRlbXMgOiAgICAgICAgICAgICAgICAgICAgICAgbnVsbCxcclxuICAgIGl0ZW1zQmFzZVVSTCA6ICAgICAgICAgICAgICAgICcnLFxyXG4gICAgdGh1bWJuYWlsU2VsZWN0YWJsZSA6ICAgICAgICAgZmFsc2UsXHJcbiAgICBkYXRhUHJvdmlkZXI6ICAgICAgICAgICAgICAgICAnJyxcclxuICAgIGRhdGFDaGFyc2V0OiAgICAgICAgICAgICAgICAgICdMYXRpbicsXHJcbiAgICBhbGxvd0hUTUxpbkRhdGE6ICAgICAgICAgICAgICBmYWxzZSxcbiAgICBsb2NhdGlvbkhhc2ggOiAgICAgICAgICAgICAgICB0cnVlLFxuICAgIHNsaWRlc2hvd0RlbGF5IDogICAgICAgICAgICAgIDMwMDAsXG4gICAgc2xpZGVzaG93QXV0b1N0YXJ0IDogICAgICAgICAgZmFsc2UsXG5cbiAgICBkZWJ1Z01vZGU6ICAgICAgICAgICAgICAgICAgICBmYWxzZSxcblxyXG4gICAgZ2FsbGVyeURpc3BsYXlNb3JlU3RlcCA6ICAgICAgMixcclxuICAgIGdhbGxlcnlEaXNwbGF5TW9kZSA6ICAgICAgICAgICdmdWxsQ29udGVudCcsXHJcbiAgICBnYWxsZXJ5TDFEaXNwbGF5TW9kZSA6ICAgICAgICBudWxsLFxyXG4gICAgZ2FsbGVyeVBhZ2luYXRpb25Nb2RlIDogICAgICAgJ3JlY3RhbmdsZXMnLCAgIC8vICdkb3RzJywgJ3JlY3RhbmdsZXMnLCAnbnVtYmVycydcclxuICAgIC8vIGdhbGxlcnlUaHVtYm5haWxzRGlzcGxheURlbGF5IDogMjAwMCxcclxuICAgIGdhbGxlcnlNYXhSb3dzIDogICAgICAgICAgICAgIDIsXHJcbiAgICBnYWxsZXJ5TDFNYXhSb3dzIDogICAgICAgICAgICBudWxsLFxyXG4gICAgZ2FsbGVyeUxhc3RSb3dGdWxsOiAgICAgICAgICAgZmFsc2UsXHJcbiAgICBnYWxsZXJ5TGF5b3V0RW5naW5lIDogICAgICAgICAnZGVmYXVsdCcsXHJcbiAgICBwYWdpbmF0aW9uU3dpcGU6ICAgICAgICAgICAgICB0cnVlLFxyXG4gICAgcGFnaW5hdGlvblZpc2libGVQYWdlcyA6ICAgICAgMTAsXHJcbiAgICAvLyBwYWdpbmF0aW9uU3dpcGVTZW5zaWJpbGl0eVZlcnQgOiAxMCxcclxuICAgIGdhbGxlcnlGaWx0ZXJUYWdzIDogICAgICAgICAgIGZhbHNlLCAgICAvLyBwb3NzaWJsZSB2YWx1ZXM6IGZhbHNlLCB0cnVlLCAndGl0bGUnLCAnZGVzY3JpcHRpb24nXHJcbiAgICBnYWxsZXJ5TDFGaWx0ZXJUYWdzIDogICAgICAgICBudWxsLCAgICAgLy8gcG9zc2libGUgdmFsdWVzOiBmYWxzZSwgdHJ1ZSwgJ3RpdGxlJywgJ2Rlc2NyaXB0aW9uJ1xyXG4gICAgZ2FsbGVyeU1heEl0ZW1zIDogICAgICAgICAgICAgMCwgICAgICAgIC8vIG1heGltdW0gbnVtYmVyIG9mIGl0ZW1zIHBlciBhbGJ1bSAgLS0+IG9ubHkgZmxpY2tyLCBnb29nbGUyLCBuYW5vX3Bob3Rvc19wcm92aWRlcjJcclxuICAgIGdhbGxlcnlMMU1heEl0ZW1zIDogICAgICAgICAgIG51bGwsICAgICAvLyBtYXhpbXVtIG51bWJlciBvZiBpdGVtcyBwZXIgZ2FsbGVyeSBwYWdlIC0tPiBvbmx5IGZsaWNrciwgZ29vZ2xlMiwgbmFub19waG90b3NfcHJvdmlkZXIyXHJcbiAgICBnYWxsZXJ5U29ydGluZyA6ICAgICAgICAgICAgICAnJyxcclxuICAgIGdhbGxlcnlMMVNvcnRpbmcgOiAgICAgICAgICAgIG51bGwsXHJcbiAgICBnYWxsZXJ5RGlzcGxheVRyYW5zaXRpb24gOiAgICAnbm9uZScsXHJcbiAgICBnYWxsZXJ5TDFEaXNwbGF5VHJhbnNpdGlvbiA6ICBudWxsLFxyXG4gICAgZ2FsbGVyeURpc3BsYXlUcmFuc2l0aW9uRHVyYXRpb24gOiAgICAxMDAwLFxyXG4gICAgZ2FsbGVyeUwxRGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbiA6ICBudWxsLFxyXG4gICAgZ2FsbGVyeVJlc2l6ZUFuaW1hdGlvbiA6ICAgICAgdHJ1ZSxcbiAgICBnYWxsZXJ5UmVuZGVyRGVsYXkgOiAgICAgICAgICA2MCxcblxuICAgIHRodW1ibmFpbENyb3AgOiAgICAgICAgICAgICAgIHRydWUsXHJcbiAgICB0aHVtYm5haWxMMUNyb3AgOiAgICAgICAgICAgICBudWxsLFxuICAgIHRodW1ibmFpbENyb3BTY2FsZUZhY3RvciA6ICAgIDEuNSxcbiAgICB0aHVtYm5haWxMZXZlbFVwIDogICAgICAgICAgICBmYWxzZSxcbiAgICB0aHVtYm5haWxBbGlnbm1lbnQgOiAgICAgICAgICAnZmlsbFdpZHRoJyxcbiAgICB0aHVtYm5haWxXaWR0aCA6ICAgICAgICAgICAgICAzMDAsXHJcbiAgICB0aHVtYm5haWxMMVdpZHRoIDogICAgICAgICAgICBudWxsLFxuICAgIHRodW1ibmFpbEhlaWdodCA6ICAgICAgICAgICAgIDIwMCxcclxuICAgIHRodW1ibmFpbEwxSGVpZ2h0IDogICAgICAgICAgIG51bGwsXHJcbiAgICB0aHVtYm5haWxCYXNlR3JpZEhlaWdodCA6ICAgICAwLFxyXG4gICAgdGh1bWJuYWlsTDFCYXNlR3JpZEhlaWdodCA6ICAgbnVsbCxcbiAgICB0aHVtYm5haWxHdXR0ZXJXaWR0aCA6ICAgICAgICAyLFxyXG4gICAgdGh1bWJuYWlsTDFHdXR0ZXJXaWR0aCA6ICAgICAgbnVsbCxcbiAgICB0aHVtYm5haWxHdXR0ZXJIZWlnaHQgOiAgICAgICAyLFxyXG4gICAgdGh1bWJuYWlsTDFHdXR0ZXJIZWlnaHQgOiAgICAgbnVsbCxcbiAgICB0aHVtYm5haWxCb3JkZXJWZXJ0aWNhbCA6ICAgICAyLFxuICAgIHRodW1ibmFpbEJvcmRlckhvcml6b250YWwgOiAgIDIsXG4gICAgdGh1bWJuYWlsRmVhdHVyZWRLZXl3b3JkIDogICAgJypmZWF0dXJlZCcsXG4gICAgdGh1bWJuYWlsQWxidW1EaXNwbGF5SW1hZ2UgOiAgZmFsc2UsXG4gICAgdGh1bWJuYWlsSG92ZXJFZmZlY3QyIDogICAgICAgJ3Rvb2xzQXBwZWFyJyxcbiAgICB0aHVtYm5haWxCdWlsZEluaXQyIDogICAgICAgICAnJyxcclxuICAgIHRodW1ibmFpbFN0YWNrcyA6ICAgICAgICAgICAgIDAsXHJcbiAgICB0aHVtYm5haWxMMVN0YWNrcyA6ICAgICAgICAgICBudWxsLFxyXG4gICAgdGh1bWJuYWlsU3RhY2tzVHJhbnNsYXRlWCA6ICAgMCxcclxuICAgIHRodW1ibmFpbEwxU3RhY2tzVHJhbnNsYXRlWCA6IG51bGwsXHJcbiAgICB0aHVtYm5haWxTdGFja3NUcmFuc2xhdGVZIDogICAwLFxyXG4gICAgdGh1bWJuYWlsTDFTdGFja3NUcmFuc2xhdGVZIDogbnVsbCxcclxuICAgIHRodW1ibmFpbFN0YWNrc1RyYW5zbGF0ZVogOiAgIDAsXHJcbiAgICB0aHVtYm5haWxMMVN0YWNrc1RyYW5zbGF0ZVogOiBudWxsLFxyXG4gICAgdGh1bWJuYWlsU3RhY2tzUm90YXRlWCA6ICAgICAgMCxcclxuICAgIHRodW1ibmFpbEwxU3RhY2tzUm90YXRlWCA6ICAgIG51bGwsXHJcbiAgICB0aHVtYm5haWxTdGFja3NSb3RhdGVZIDogICAgICAwLFxyXG4gICAgdGh1bWJuYWlsTDFTdGFja3NSb3RhdGVZIDogICAgbnVsbCxcclxuICAgIHRodW1ibmFpbFN0YWNrc1JvdGF0ZVogOiAgICAgIDAsXHJcbiAgICB0aHVtYm5haWxMMVN0YWNrc1JvdGF0ZVogOiAgICBudWxsLFxyXG4gICAgdGh1bWJuYWlsU3RhY2tzU2NhbGUgOiAgICAgICAgMCxcclxuICAgIHRodW1ibmFpbEwxU3RhY2tzU2NhbGUgOiAgICAgIG51bGwsXHJcbiAgICB0aHVtYm5haWxEaXNwbGF5T3V0c2lkZVNjcmVlbjogdHJ1ZSxcclxuICAgIHRodW1ibmFpbFdhaXRJbWFnZUxvYWRlZDogICAgIHRydWUsXHJcbiAgICB0aHVtYm5haWxTbGlkZXJEZWxheTogICAgICAgICAyMDAwLFxyXG4gICAgZ2FsbGVyeUJ1aWxkSW5pdDIgOiAgICAgICAgICAgJycsXHJcbiAgICBwb3J0YWJsZSA6ICAgICAgICAgICAgICAgICAgICBmYWxzZSxcclxuICAgIGV2ZW50c0RlYm91bmNlRGVsYXk6ICAgICAgICAgIDMwLFxuICAgIFxuICAgIHRvdWNoQW5pbWF0aW9uIDogICAgICAgICAgICAgIHRydWUsXHJcbiAgICB0b3VjaEFuaW1hdGlvbkwxIDogICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgdG91Y2hBdXRvT3BlbkRlbGF5IDogICAgICAgICAgMCxcblxuICAgIHRodW1ibmFpbExhYmVsIDoge1xuICAgICAgcG9zaXRpb24gOiAgICAgICAgICAgICAgICAgICdvdmVySW1hZ2VPbkJvdHRvbScsXG4gICAgICBhbGlnbjogICAgICAgICAgICAgICAgICAgICAgJ2NlbnRlcicsXG4gICAgICBkaXNwbGF5IDogICAgICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgIGRpc3BsYXlEZXNjcmlwdGlvbiA6ICAgICAgICBmYWxzZSxcbiAgICAgIHRpdGxlTWF4TGVuZ3RoIDogICAgICAgICAgICAwLFxyXG4gICAgICB0aXRsZU11bHRpTGluZSA6ICAgICAgICAgICAgZmFsc2UsXG4gICAgICBkZXNjcmlwdGlvbk1heExlbmd0aCA6ICAgICAgMCxcclxuICAgICAgZGVzY3JpcHRpb25NdWx0aUxpbmUgOiAgICAgIGZhbHNlLFxuICAgICAgaGlkZUljb25zIDogICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICB0aXRsZSA6ICAgICAgICAgICAgICAgICAgICAgJydcbiAgICB9LFxuXG4gICAgdGh1bWJuYWlsVG9vbGJhckltYWdlIDogICAgICAgeyB0b3BMZWZ0OiAnc2VsZWN0JywgdG9wUmlnaHQgOiAnZmVhdHVyZWQnIH0sXG4gICAgdGh1bWJuYWlsVG9vbGJhckFsYnVtIDogICAgICAgeyB0b3BMZWZ0OiAnc2VsZWN0JywgdG9wUmlnaHQgOiAnY291bnRlcicgIH0sXG4gICAgdGh1bWJuYWlsRGlzcGxheUludGVydmFsIDogICAgMTUsXHJcbiAgICB0aHVtYm5haWxMMURpc3BsYXlJbnRlcnZhbCA6ICBudWxsLFxuICAgIHRodW1ibmFpbERpc3BsYXlUcmFuc2l0aW9uIDogICdmYWRlSW4nLFxyXG4gICAgdGh1bWJuYWlsTDFEaXNwbGF5VHJhbnNpdGlvbiA6IG51bGwsXG4gICAgdGh1bWJuYWlsRGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbjogICAyNDAsXHJcbiAgICB0aHVtYm5haWxMMURpc3BsYXlUcmFuc2l0aW9uRHVyYXRpb246IG51bGwsXG4gICAgdGh1bWJuYWlsT3BlbkltYWdlIDogICAgICAgICAgdHJ1ZSxcclxuICAgIHRodW1ibmFpbE9wZW5PcmlnaW5hbCA6ICAgICAgIGZhbHNlLFxuICAgIHRodW1ibmFpbEdsb2JhbEltYWdlVGl0bGUgOiAgICcnLFxuICAgIHRodW1ibmFpbEdsb2JhbEFsYnVtVGl0bGUgOiAgICcnLFxuICAgIFxuICAgIHZpZXdlciA6ICAgICAgICAgICAgICAgICAgICAgICdpbnRlcm5hbCcsXHJcbiAgICB2aWV3ZXJGdWxsc2NyZWVuOiAgICAgICAgICAgICBmYWxzZSxcclxuICAgIHZpZXdlckRpc3BsYXlMb2dvIDogICAgICAgICAgIGZhbHNlLFxyXG4gICAgaW1hZ2VUcmFuc2l0aW9uIDogICAgICAgICAgICAgJ3N3aXBlMicsXHJcbiAgICB2aWV3ZXJUcmFuc2l0aW9uTWVkaWFLaW5kIDogICAnaW1nJyxcclxuICAgIHZpZXdlclpvb20gOiAgICAgICAgICAgICAgICAgIHRydWUsXHJcbiAgICB2aWV3ZXJJbWFnZURpc3BsYXkgOiAgICAgICAgICAnJyxcclxuICAgIG9wZW5PblN0YXJ0IDogICAgICAgICAgICAgICAgICcnLFxyXG4gICAgdmlld2VySGlkZVRvb2xzRGVsYXkgOiAgICAgICAgMzAwMCxcclxuICAgIHZpZXdlclRvb2xiYXIgOiB7XHJcbiAgICAgIGRpc3BsYXkgOiAgICAgICAgICAgICAgICAgICB0cnVlLFxyXG4gICAgICBwb3NpdGlvbiA6ICAgICAgICAgICAgICAgICAgJ2JvdHRvbU92ZXJJbWFnZScsXHJcbiAgICAgIGZ1bGxXaWR0aCA6ICAgICAgICAgICAgICAgICB0cnVlLFxyXG4gICAgICBhbGlnbiA6ICAgICAgICAgICAgICAgICAgICAgJ2NlbnRlcicsXHJcbiAgICAgIGF1dG9NaW5pbWl6ZSA6ICAgICAgICAgICAgICAwLFxyXG4gICAgICBzdGFuZGFyZCA6ICAgICAgICAgICAgICAgICAgJ21pbmltaXplQnV0dG9uLGxhYmVsJyxcclxuICAgICAgbWluaW1pemVkIDogICAgICAgICAgICAgICAgICdtaW5pbWl6ZUJ1dHRvbixsYWJlbCxpbmZvQnV0dG9uLHNoYXJlQnV0dG9uLGRvd25sb2FkQnV0dG9uLGxpbmtPcmlnaW5hbEJ1dHRvbixmdWxsc2NyZWVuQnV0dG9uJ1xyXG4gICAgfSxcclxuICAgIHZpZXdlclRvb2xzIDoge1xyXG4gICAgICB0b3BMZWZ0IDogICAgICAgICAgICAgICAgICAgJ3BhZ2VDb3VudGVyLHBsYXlQYXVzZUJ1dHRvbicsXHJcbiAgICAgIHRvcFJpZ2h0IDogICAgICAgICAgICAgICAgICAncm90YXRlTGVmdCxyb3RhdGVSaWdodCxmdWxsc2NyZWVuQnV0dG9uLGNsb3NlQnV0dG9uJyBcclxuICAgIH0sXHJcbiAgICBcclxuICAgIGJyZWFrcG9pbnRTaXplU00gOiAgICAgICAgICAgIDQ4MCxcbiAgICBicmVha3BvaW50U2l6ZU1FIDogICAgICAgICAgICA5OTIsXG4gICAgYnJlYWtwb2ludFNpemVMQSA6ICAgICAgICAgICAgMTIwMCxcbiAgICBicmVha3BvaW50U2l6ZVhMIDogICAgICAgICAgICAxODAwLFxyXG4gICAgXG4gICAgZm5UaHVtYm5haWxJbml0IDogICAgICAgICAgICAgbnVsbCxcbiAgICBmblRodW1ibmFpbEhvdmVySW5pdCA6ICAgICAgICBudWxsLFxuICAgIGZuVGh1bWJuYWlsSG92ZXIgOiAgICAgICAgICAgIG51bGwsXG4gICAgZm5UaHVtYm5haWxIb3Zlck91dCA6ICAgICAgICAgbnVsbCxcbiAgICBmblRodW1ibmFpbERpc3BsYXlFZmZlY3QgOiAgICBudWxsLFxyXG4gICAgZm5WaWV3ZXJJbmZvIDogICAgICAgICAgICAgICAgbnVsbCxcclxuICAgIGZuSW1nVG9vbGJhckN1c3RJbml0IDogICAgICAgIG51bGwsXG4gICAgZm5JbWdUb29sYmFyQ3VzdERpc3BsYXkgOiAgICAgbnVsbCxcbiAgICBmbkltZ1Rvb2xiYXJDdXN0Q2xpY2sgOiAgICAgICBudWxsLFxyXG4gICAgZm5Qcm9jZXNzRGF0YSA6ICAgICAgICAgICAgICAgbnVsbCxcclxuICAgIGZuVGh1bWJuYWlsU2VsZWN0aW9uIDogICAgICAgIG51bGwsXHJcbiAgICBmbkdhbGxlcnlSZW5kZXJTdGFydCA6ICAgICAgICBudWxsLFxyXG4gICAgZm5HYWxsZXJ5UmVuZGVyRW5kIDogICAgICAgICAgbnVsbCxcclxuICAgIGZuR2FsbGVyeU9iamVjdE1vZGVsQnVpbHQgOiAgIG51bGwsXHJcbiAgICBmbkdhbGxlcnlMYXlvdXRBcHBsaWVkIDogICAgICBudWxsLFxyXG4gICAgZm5UaHVtYm5haWxDbGlja2VkIDogICAgICAgICAgbnVsbCxcbiAgICBmblNob3BwaW5nQ2FydFVwZGF0ZWQgOiAgICAgICBudWxsLFxuICAgIGZuVGh1bWJuYWlsVG9vbEN1c3RBY3Rpb24gOiAgIG51bGwsXG4gICAgZm5UaHVtYm5haWxPcGVuIDogICAgICAgICAgICAgbnVsbCxcbiAgICBmbkltZ0Rpc3BsYXllZCA6ICAgICAgICAgICAgICBudWxsLFxuXG4gICAgaTE4biA6IHtcclxuICAgICAgJ2JyZWFkY3J1bWJIb21lJyA6ICdHYWxsZXJpZXMnLCAnYnJlYWRjcnVtYkhvbWVfRlInIDogJ0dhbGVyaWVzJyxcclxuICAgICAgJ3RodW1ibmFpbEltYWdlVGl0bGUnIDogJycsICd0aHVtYm5haWxBbGJ1bVRpdGxlJyA6ICcnLFxyXG4gICAgICAndGh1bWJuYWlsSW1hZ2VEZXNjcmlwdGlvbicgOiAnJywgJ3RodW1ibmFpbEFsYnVtRGVzY3JpcHRpb24nIDogJycsXHJcbiAgICAgICdpbmZvQm94UGhvdG8nIDogJ1Bob3RvJywgJ2luZm9Cb3hEYXRlJyA6ICdEYXRlJywgJ2luZm9Cb3hBbGJ1bScgOiAnQWxidW0nLCAnaW5mb0JveERpbWVuc2lvbnMnIDogJ0RpbWVuc2lvbnMnLCAnaW5mb0JveEZpbGVuYW1lJyA6ICdGaWxlbmFtZScsICdpbmZvQm94RmlsZVNpemUnIDogJ0ZpbGUgc2l6ZScsICdpbmZvQm94Q2FtZXJhJyA6ICdDYW1lcmEnLCAnaW5mb0JveEZvY2FsTGVuZ3RoJyA6ICdGb2NhbCBsZW5ndGgnLCAnaW5mb0JveEV4cG9zdXJlJyA6ICdFeHBvc3VyZScsICdpbmZvQm94Rk51bWJlcicgOiAnRiBOdW1iZXInLCAnaW5mb0JveElTTycgOiAnSVNPJywgJ2luZm9Cb3hNYWtlJyA6ICdNYWtlJywgJ2luZm9Cb3hGbGFzaCcgOiAnRmxhc2gnLCAnaW5mb0JveFZpZXdzJyA6ICdWaWV3cycsICdpbmZvQm94Q29tbWVudHMnIDogJ0NvbW1lbnRzJ1xyXG4gICAgfSxcclxuICAgIGljb25zIDoge1xyXG4gICAgICAvLyBzYW1wbGUgZm9yIGZvbnQgYXdlc29tZTogPGkgc3R5bGU9XCJjb2xvcjojZWVlO1wiIGNsYXNzPVwiZmEgZmEtc2VhcmNoLXBsdXNcIj48L2k+XHJcbiAgICAgIHRodW1ibmFpbEFsYnVtOiAgICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLWZvbGRlci1lbXB0eVwiPjwvaT4nLFxyXG4gICAgICB0aHVtYm5haWxJbWFnZTogICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1waWN0dXJlXCI+PC9pPicsXHJcbiAgICAgIGJyZWFkY3J1bWJBbGJ1bTogICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLWZvbGRlci1lbXB0eVwiPjwvaT4nLFxyXG4gICAgICBicmVhZGNydW1iSG9tZTogICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1ob21lXCI+PC9pPicsXHJcbiAgICAgIGJyZWFkY3J1bWJTZXBhcmF0b3I6ICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLWxlZnQtb3BlblwiPjwvaT4nLFxyXG4gICAgICBicmVhZGNydW1iU2VwYXJhdG9yUnRsOiAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1yaWdodC1vcGVuXCI+PC9pPicsXHJcbiAgICAgIG5hdmlnYXRpb25GaWx0ZXJTZWxlY3RlZDogICAgICc8aSBzdHlsZT1cImNvbG9yOiNmZmY7XCIgY2xhc3M9XCJuR1kySWNvbi10b2dnbGUtb25cIj48L2k+JyxcclxuICAgICAgbmF2aWdhdGlvbkZpbHRlclVuc2VsZWN0ZWQ6ICAgJzxpIHN0eWxlPVwiY29sb3I6I2RkZDtcIiBjbGFzcz1cIm5HWTJJY29uLXRvZ2dsZS1vZmZcIj48L2k+JyxcclxuICAgICAgbmF2aWdhdGlvbkZpbHRlclNlbGVjdGVkQWxsOiAgJzxpIGNsYXNzPVwibkdZMkljb24tdG9nZ2xlLW9uXCI+PC9pPjxpIGNsYXNzPVwibkdZMkljb24tb2tcIj48L2k+JyxcclxuICAgICAgdGh1bWJuYWlsU2VsZWN0ZWQ6ICAgICAgICAgICAgJzxpIHN0eWxlPVwiY29sb3I6I2JmZjtcIiBjbGFzcz1cIm5HWTJJY29uLW9rLWNpcmNsZWRcIj48L2k+JyxcclxuICAgICAgdGh1bWJuYWlsVW5zZWxlY3RlZDogICAgICAgICAgJzxpIHN0eWxlPVwiY29sb3I6I2JmZjtcIiBjbGFzcz1cIm5HWTJJY29uLWNpcmNsZS1lbXB0eVwiPjwvaT4nLFxyXG4gICAgICB0aHVtYm5haWxGZWF0dXJlZDogICAgICAgICAgICAnPGkgc3R5bGU9XCJjb2xvcjojZGQ1O1wiIGNsYXNzPVwibkdZMkljb24tc3RhclwiPjwvaT4nLFxyXG4gICAgICB0aHVtYm5haWxDb3VudGVyOiAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1waWN0dXJlXCI+PC9pPicsXHJcbiAgICAgIHRodW1ibmFpbFNoYXJlOiAgICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLW5neTJfc2hhcmUyXCI+PC9pPicsXHJcbiAgICAgIHRodW1ibmFpbERvd25sb2FkOiAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLW5neTJfZG93bmxvYWQyXCI+PC9pPicsXHJcbiAgICAgIHRodW1ibmFpbEluZm86ICAgICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLW5neTJfaW5mbzJcIj48L2k+JyxcclxuICAgICAgdGh1bWJuYWlsQ2FydDogICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tYmFza2V0XCI+PC9pPicsXHJcbiAgICAgIHRodW1ibmFpbERpc3BsYXk6ICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLW5neTJfem9vbV9pbjJcIj48L2k+JyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDE6ICAgICAgICAgJ1QxJyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDI6ICAgICAgICAgJ1QyJyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDM6ICAgICAgICAgJ1QzJyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDQ6ICAgICAgICAgJ1Q0JyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDU6ICAgICAgICAgJ1Q1JyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDY6ICAgICAgICAgJ1Q2JyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDc6ICAgICAgICAgJ1Q3JyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDg6ICAgICAgICAgJ1Q4JyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDk6ICAgICAgICAgJ1Q5JyxcclxuICAgICAgdGh1bWJuYWlsQ3VzdG9tVG9vbDEwOiAgICAgICAgJ1QxMCcsXHJcbiAgICAgIHRodW1ibmFpbEFsYnVtVXA6ICAgICAgICAgICAgICc8aSBzdHlsZT1cImZvbnQtc2l6ZTogM2VtO1wiIGNsYXNzPVwibkdZMkljb24tbmd5Ml9jaGV2cm9uX3VwMlwiPjwvaT4nLFxyXG4gICAgICBwYWdpbmF0aW9uTmV4dDogICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1yaWdodC1vcGVuXCI+PC9pPicsXHJcbiAgICAgIHBhZ2luYXRpb25QcmV2aW91czogICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLWxlZnQtb3BlblwiPjwvaT4nLFxuICAgICAgZ2FsbGVyeU1vcmVCdXR0b246ICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tcGljdHVyZVwiPjwvaT4gJm5ic3A7IDxpIGNsYXNzPVwibkdZMkljb24tcmlnaHQtb3BlblwiPjwvaT4nLFxyXG4gICAgICBidXR0b25DbG9zZTogICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1uZ3kyX2Nsb3NlMlwiPjwvaT4nLFxyXG4gICAgICB2aWV3ZXJQcmV2aW91czogICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1uZ3kyX2NoZXZyb24tbGVmdFwiPjwvaT4nLFxyXG4gICAgICB2aWV3ZXJOZXh0OiAgICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1uZ3kyX2NoZXZyb24tcmlnaHRcIj48L2k+JyxcclxuICAgICAgdmlld2VySW1nUHJldmlvdXM6ICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tbmd5Ml9jaGV2cm9uX2xlZnQzXCI+PC9pPicsXHJcbiAgICAgIHZpZXdlckltZ05leHQ6ICAgICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLW5neTJfY2hldnJvbl9yaWdodDNcIj48L2k+JyxcclxuICAgICAgdmlld2VyRG93bmxvYWQ6ICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tbmd5Ml9kb3dubG9hZDJcIj48L2k+JyxcclxuICAgICAgdmlld2VyVG9vbGJhck1pbjogICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tZWxsaXBzaXMtdmVydFwiPjwvaT4nLFxyXG4gICAgICB2aWV3ZXJUb29sYmFyU3RkOiAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1tZW51XCI+PC9pPicsXHJcbiAgICAgIHZpZXdlclBsYXk6ICAgICAgICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLXBsYXlcIj48L2k+JyxcclxuICAgICAgdmlld2VyUGF1c2U6ICAgICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tcGF1c2VcIj48L2k+JyxcclxuICAgICAgdmlld2VyRnVsbHNjcmVlbk9uOiAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tcmVzaXplLWZ1bGxcIj48L2k+JyxcclxuICAgICAgdmlld2VyRnVsbHNjcmVlbk9mZjogICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tcmVzaXplLXNtYWxsXCI+PC9pPicsXHJcbiAgICAgIHZpZXdlclpvb21JbjogICAgICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLW5neTJfem9vbV9pbjJcIj48L2k+JyxcclxuICAgICAgdmlld2VyWm9vbU91dDogICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tbmd5Ml96b29tX291dDJcIj48L2k+JyxcclxuICAgICAgdmlld2VyTGlua09yaWdpbmFsOiAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tbmd5Ml9leHRlcm5hbDJcIj48L2k+JyxcclxuICAgICAgdmlld2VySW5mbzogICAgICAgICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tbmd5Ml9pbmZvMlwiPjwvaT4nLFxyXG4gICAgICB2aWV3ZXJTaGFyZTogICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1uZ3kyX3NoYXJlMlwiPjwvaT4nLFxuICAgICAgdmlld2VyUm90YXRlTGVmdDogICAgICAgICAgICAgJzxpIGNsYXNzPVwibkdZMkljb24tY2N3XCI+PC9pPicsXG4gICAgICB2aWV3ZXJSb3RhdGVSaWdodDogICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi1jd1wiPjwvaT4nLFxyXG4gICAgICB1c2VyOiAgICAgICAgICAgICAgICAgICAgICAgICAnPGkgY2xhc3M9XCJuR1kySWNvbi11c2VyXCI+PC9pPicsXHJcbiAgICAgIGxvY2F0aW9uOiAgICAgICAgICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLWxvY2F0aW9uXCI+PC9pPicsXHJcbiAgICAgIGNvbmZpZzogICAgICAgICAgICAgICAgICAgICAgICc8aSBjbGFzcz1cIm5HWTJJY29uLXdyZW5jaFwiPjwvaT4nLFxyXG4gICAgICBzaGFyZUZhY2Vib29rOiAgICAgICAgICAgICAgICAnPGkgc3R5bGU9XCJjb2xvcjojM2I1OTk4O1wiIGNsYXNzPVwibkdZMkljb24tZmFjZWJvb2stc3F1YXJlZFwiPjwvaT4nLFxyXG4gICAgICBzaGFyZVR3aXR0ZXI6ICAgICAgICAgICAgICAgICAnPGkgc3R5bGU9XCJjb2xvcjojMDBhY2VkO1wiIGNsYXNzPVwibkdZMkljb24tdHdpdHRlci1zcXVhcmVkXCI+PC9pPicsXHJcbiAgICAgIC8vIHNoYXJlR29vZ2xlUGx1czogICAgICAgICAgICAgICc8aSBzdHlsZT1cImNvbG9yOiNkZDRiMzk7XCIgY2xhc3M9XCJuR1kySWNvbi1ncGx1cy1zcXVhcmVkXCI+PC9pPicsXHJcbiAgICAgIHNoYXJlVHVtYmxyOiAgICAgICAgICAgICAgICAgICc8aSBzdHlsZT1cImNvbG9yOiMzMjUwNmQ7XCIgY2xhc3M9XCJuR1kySWNvbi10dW1ibHItc3F1YXJlZFwiPjwvaT4nLFxyXG4gICAgICBzaGFyZVBpbnRlcmVzdDogICAgICAgICAgICAgICAnPGkgc3R5bGU9XCJjb2xvcjojY2IyMDI3O1wiIGNsYXNzPVwibkdZMkljb24tcGludGVyZXN0LXNxdWFyZWRcIj48L2k+JyxcclxuICAgICAgc2hhcmVWSzogICAgICAgICAgICAgICAgICAgICAgJzxpIHN0eWxlPVwiY29sb3I6IzNiNTk5ODtcIiBjbGFzcz1cIm5HWTJJY29uLXZrb250YWt0ZVwiPjwvaT4nLFxyXG4gICAgICBzaGFyZU1haWw6ICAgICAgICAgICAgICAgICAgICAnPGkgc3R5bGU9XCJjb2xvcjojNTU1O1wiIGNsYXNzPVwibkdZMkljb24tbWFpbC1hbHRcIj48L2k+JyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDE6ICAgICAgICAgICAgJ1QxJyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDI6ICAgICAgICAgICAgJ1QyJyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDM6ICAgICAgICAgICAgJ1QzJyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDQ6ICAgICAgICAgICAgJ1Q0JyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDU6ICAgICAgICAgICAgJ1Q1JyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDY6ICAgICAgICAgICAgJ1Q2JyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDc6ICAgICAgICAgICAgJ1Q3JyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDg6ICAgICAgICAgICAgJ1Q4JyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDk6ICAgICAgICAgICAgJ1Q5JyxcclxuICAgICAgdmlld2VyQ3VzdG9tVG9vbDEwOiAgICAgICAgICAgJ1QxMCdcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBqUXVlcnkuZm4ubmFub2dhbGxlcnkyID0gZnVuY3Rpb24gKGFyZ3MsIG9wdGlvbiwgdmFsdWUpIHtcclxuICAgIFxyXG4gICAgaWYoIHR5cGVvZiBqUXVlcnkodGhpcykuZGF0YSgnbmFub2dhbGxlcnkyZGF0YScpID09PSAndW5kZWZpbmVkJyl7XHJcbiAgICAgIGlmKCBhcmdzID09ICdkZXN0cm95JyApIHtcclxuICAgICAgICAvLyBjb21tYW5kIHRvIGRlc3Ryb3kgYnV0IG5vIGluc3RhbmNlIHlldCAtLT4gZXhpdFxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKXtcclxuICAgICAgICAobmV3IGpRdWVyeS5uYW5vZ2FsbGVyeTIodGhpcywgYXJncykpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAvLyBubyBvcHRpb25zIC0tPlxyXG4gICAgICAvLyBUaGlzIGZ1bmN0aW9uIGJyZWFrcyB0aGUgY2hhaW4sIGJ1dCBwcm92aWRlcyBzb21lIEFQSSBtZXRob2RzXHJcblxyXG4gICAgICB2YXIgbkcyPSQodGhpcykuZGF0YSgnbmFub2dhbGxlcnkyZGF0YScpLm5HMjtcclxuICAgICAgc3dpdGNoKGFyZ3Mpe1xyXG4gICAgICAgIGNhc2UgJ2Rpc3BsYXlJdGVtJzpcclxuICAgICAgICAgIG5HMi5EaXNwbGF5SXRlbShvcHRpb24pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBcclxuICAgICAgICBjYXNlICdzZWFyY2gnOlxyXG4gICAgICAgICAgcmV0dXJuKCBuRzIuU2VhcmNoKG9wdGlvbikpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBcclxuICAgICAgICBjYXNlICdzZWFyY2gyJzpcclxuICAgICAgICAgIHJldHVybiBuRzIuU2VhcmNoMihvcHRpb24sIHZhbHVlKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnc2VhcmNoMkV4ZWN1dGUnOlxyXG4gICAgICAgICAgcmV0dXJuIG5HMi5TZWFyY2gyRXhlY3V0ZSgpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBcclxuICAgICAgICBjYXNlICdyZWZyZXNoJzpcclxuICAgICAgICAgIG5HMi5SZWZyZXNoKCk7XHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAncmVzaXplJzpcclxuICAgICAgICAgIG5HMi5SZXNpemUoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnaW5zdGFuY2UnOlxyXG4gICAgICAgICAgcmV0dXJuIG5HMjtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnZGF0YSc6XHJcbiAgICAgICAgICBuRzIuZGF0YT0ge1xyXG4gICAgICAgICAgICBpdGVtczogbkcyLkksXHJcbiAgICAgICAgICAgIGdhbGxlcnk6IG5HMi5HT00sXHJcbiAgICAgICAgICAgIGxpZ2h0Ym94OiBuRzIuVk9NXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgcmV0dXJuIG5HMi5kYXRhO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBcclxuICAgICAgICBjYXNlICdyZWxvYWQnOlxyXG4gICAgICAgICAgbkcyLlJlbG9hZEFsYnVtKCk7XHJcbiAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnaXRlbXNTZWxlY3RlZEdldCc6XHJcbiAgICAgICAgICByZXR1cm4gbkcyLkl0ZW1zU2VsZWN0ZWRHZXQoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnaXRlbXNTZXRTZWxlY3RlZFZhbHVlJzpcclxuICAgICAgICAgIG5HMi5JdGVtc1NldFNlbGVjdGVkVmFsdWUob3B0aW9uLCB2YWx1ZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIFxyXG4gICAgICAgIGNhc2UgJ29wdGlvbic6XHJcbiAgICAgICAgICBpZih0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnKXtcclxuICAgICAgICAgICAgcmV0dXJuIG5HMi5HZXQob3B0aW9uKTtcclxuICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICBuRzIuU2V0KG9wdGlvbix2YWx1ZSk7XHJcbiAgICAgICAgICAgIGlmKCBvcHRpb24gPT0gJ2RlbW9WaWV3cG9ydFdpZHRoJyApIHtcclxuICAgICAgICAgICAgICAvLyBmb3JjZSByZXNpemUgZXZlbnQgLT4gZm9yIGRlbW8gcHVycG9zZXNcclxuICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnZGVzdHJveSc6XHJcbiAgICAgICAgICBuRzIuRGVzdHJveSgpO1xyXG4gICAgICAgICAgJCh0aGlzKS5yZW1vdmVEYXRhKCduYW5vZ2FsbGVyeTJkYXRhJyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIFxyXG4gICAgICAgIGNhc2UgJ3Nob3BwaW5nQ2FydEdldCc6XHJcbiAgICAgICAgICByZXR1cm4gbkcyLnNob3BwaW5nQ2FydDtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnc2hvcHBpbmdDYXJ0VXBkYXRlJzpcclxuICAgICAgICAgIGlmKCB0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBvcHRpb24gPT09ICd1bmRlZmluZWQnICl7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHZhciBJRCA9IG9wdGlvbjtcclxuICAgICAgICAgIHZhciBjbnQgPSB2YWx1ZTtcclxuICAgICAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbkcyLnNob3BwaW5nQ2FydC5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBpZiggbkcyLnNob3BwaW5nQ2FydFtpXS5JRCA9IElEICkge1xyXG4gICAgICAgICAgICAgIG5HMi5zaG9wcGluZ0NhcnRbaV0uY250ID0gY250O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB2YXIgZnUgPSBHLk8uZm5TaG9wcGluZ0NhcnRVcGRhdGVkO1xyXG4gICAgICAgICAgaWYoIGZ1ICE9PSBudWxsICkge1xyXG4gICAgICAgICAgICB0eXBlb2YgIGZ1ID09ICdmdW5jdGlvbicgPyBmdShuRzIuc2hvcHBpbmdDYXJ0LCBOR1kySXRlbS5HZXQoRywgSUQpKSA6IHdpbmRvd1tmdV0obkcyLnNob3BwaW5nQ2FydCwgTkdZMkl0ZW0uR2V0KEcsIElEKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gbkcyLnNob3BwaW5nQ2FydDtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgY2FzZSAnc2hvcHBpbmdDYXJ0UmVtb3ZlJzpcclxuICAgICAgICAgIGlmKCB0eXBlb2Ygb3B0aW9uID09PSAndW5kZWZpbmVkJyApe1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB2YXIgSUQ9b3B0aW9uO1xyXG4gICAgICAgICAgZm9yKCB2YXIgaT0wOyBpPG5HMi5zaG9wcGluZ0NhcnQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYoIG5HMi5zaG9wcGluZ0NhcnRbaV0uSUQ9SUQgKSB7XHJcbiAgICAgICAgICAgICAgbkcyLnNob3BwaW5nQ2FydC5zcGxpY2UoaSwxKTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgdmFyIGZ1ID0gRy5PLmZuU2hvcHBpbmdDYXJ0VXBkYXRlZDtcclxuICAgICAgICAgIGlmKCBmdSAhPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdShuRzIuc2hvcHBpbmdDYXJ0LCBOR1kySXRlbS5HZXQoRywgSUQpKSA6IHdpbmRvd1tmdV0obkcyLnNob3BwaW5nQ2FydCwgTkdZMkl0ZW0uR2V0KEcsIElEKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gbkcyLnNob3BwaW5nQ2FydDtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICBcclxuICAgICAgICBjYXNlICdjbG9zZVZpZXdlcic6XHJcbiAgICAgICAgICBuRzIuQ2xvc2VWaWV3ZXIoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ21pbmltaXplVG9vbGJhcic6XHJcbiAgICAgICAgICBuRzIuTWluaW1pemVUb29sYmFyKCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdtYXhpbWl6ZVRvb2xiYXInOlxyXG4gICAgICAgICAgbkcyLk1heGltaXplVG9vbGJhcigpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncGFnaW5hdGlvblByZXZpb3VzUGFnZSc6XHJcbiAgICAgICAgICBuRzIuUGFnaW5hdGlvblByZXZpb3VzUGFnZSgpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncGFnaW5hdGlvbk5leHRQYWdlJzpcclxuICAgICAgICAgIG5HMi5wYWdpbmF0aW9uTmV4dFBhZ2UoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3BhZ2luYXRpb25Hb3RvUGFnZSc6XHJcbiAgICAgICAgICBuRzIuUGFnaW5hdGlvbkdvdG9QYWdlKCBvcHRpb24gKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3BhZ2luYXRpb25Db3VudFBhZ2VzJzpcclxuICAgICAgICAgIG5HMi5QYWdpbmF0aW9uQ291bnRQYWdlcygpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgIFxyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiAkKHRoaXMpO1xyXG5cclxuICAgIH1cclxuICB9O1xyXG4gIFxyXG5cclxuICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbiAgLy8gIyMjIyMgbmFub2dhbGxlcnkyIHNjcmlwdCAjIyMjI1xyXG4gIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgLyoqIEBmdW5jdGlvbiBuYW5vR0FMTEVSWTIgKi9cclxuICBmdW5jdGlvbiBuYW5vR0FMTEVSWTIoKSB7XHJcbiAgICBcInVzZSBzdHJpY3RcIjtcclxuXHJcbiAgICAvKipcclxuICAgICogRm9yY2UgcmVsb2FkIHRoZSBjdXJyZW50IGFsYnVtLCBpZiBwcm92aWRlZCBieSBKc29uXHJcbiAgICAqL1xyXG4gICAgdGhpcy5SZWxvYWRBbGJ1bSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgIGlmKCBHLk8ua2luZCA9PT0gJycgKSB7XHJcbiAgICAgICAgdGhyb3cgJ05vdCBzdXBwb3J0ZWQgZm9yIHRoaXMgY29udGVudCBzb3VyY2U6JyArIEcuTy5raW5kO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgYWxidW1JZHggPSBHLkdPTS5hbGJ1bUlkeDtcclxuICAgICAgaWYoIGFsYnVtSWR4ID09IC0xICkge1xyXG4gICAgICAgIHRocm93ICgnQ3VycmVudCBhbGJ1bSBub3QgZm91bmQuJyk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHZhciBhbGJ1bUlEID0gRy5JW2FsYnVtSWR4XS5HZXRJRCgpO1xyXG5cclxuICAgICAgLy8gdW5zZWxlY3QgZXZlcnl0aGluZyAmIHJlbW92ZSBsaW5rIHRvIGFsYnVtICg9bG9naWNhbCBkZWxldGUpXHJcbiAgICAgIHZhciBsID0gRy5JLmxlbmd0aDtcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsIDsgaSsrICkge1xyXG4gICAgICAgIHZhciBpdGVtID0gRy5JW2ldO1xyXG4gICAgICAgIGlmKCBpdGVtLmFsYnVtSUQgPT0gYWxidW1JRCApIHtcclxuICAgICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIEcuSVthbGJ1bUlkeF0uY29udGVudElzTG9hZGVkID0gZmFsc2U7XHJcbiAgICAgIFxyXG4gICAgICBEaXNwbGF5QWxidW0oJy0xJywgYWxidW1JRCk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIFNldCBvbmUgb3Igc2V2ZXJhbCBpdGVtcyBzZWxlY3RlZC91bnNlbGVjdGVkXHJcbiAgICAgKiBAcGFyYW0ge2FycmF5fSBpdGVtc1xyXG4gICAgICovXHJcbiAgICB0aGlzLkl0ZW1zU2V0U2VsZWN0ZWRWYWx1ZSA9IGZ1bmN0aW9uKGl0ZW1zLCB2YWx1ZSl7XHJcbiAgICAgIHZhciBsID0gaXRlbXMubGVuZ3RoO1xyXG4gICAgICBmb3IoIHZhciBqID0gMDsgaiA8IGwgOyBqKyspIHtcclxuICAgICAgICBUaHVtYm5haWxTZWxlY3Rpb25TZXQoaXRlbXNbal0sIHZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBSZXR1cm5zIGFuIGFycmF5IG9mIHNlbGVjdGVkIGl0ZW1zXHJcbiAgICAgKiBAcmV0dXJucyB7QXJyYXl9XHJcbiAgICAgKi9cclxuICAgIHRoaXMuSXRlbXNTZWxlY3RlZEdldCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZhciBzZWxlY3RlZEl0ZW1zID0gW107XHJcbiAgICAgIHZhciBsID0gRy5JLmxlbmd0aDtcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsIDsgaSsrICkge1xyXG4gICAgICAgIGlmKCBHLklbaV0uc2VsZWN0ZWQgPT0gdHJ1ZSApIHtcclxuICAgICAgICAgIHNlbGVjdGVkSXRlbXMucHVzaChHLklbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gc2VsZWN0ZWRJdGVtcztcclxuICAgIH07ICAgIFxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIFJldHVybnMgdGhlIHZhbHVlIG9mIGFuIG9wdGlvblxyXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvblxyXG4gICAgICogQHJldHVybnMge25hbm9HQUxMRVJZLkcuT31cclxuICAgICAqL1xyXG4gICAgdGhpcy5HZXQgPSBmdW5jdGlvbihvcHRpb24pe1xyXG4gICAgICAgIHJldHVybiBHLk9bb3B0aW9uXTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXQgYSBuZXcgdmFsdWUgZm9yIGEgZGVmaW5lZCBvcHRpb25cclxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25cclxuICAgICAqL1xyXG4gICAgdGhpcy5TZXQgPSBmdW5jdGlvbihvcHRpb24sIHZhbHVlKXtcclxuICAgICAgICBHLk9bb3B0aW9uXSA9IHZhbHVlO1xyXG4gICAgICAgIHN3aXRjaCggb3B0aW9uICkge1xyXG4gICAgICAgICAgY2FzZSAndGh1bWJuYWlsU2VsZWN0YWJsZSc6XHJcbiAgICAgICAgICAgIFRodW1ibmFpbFNlbGVjdGlvbkNsZWFyKCk7XHJcbiAgICAgICAgICAgIC8vIHJlZnJlc2ggdGhlIGRpc3BsYXllZCBnYWxsZXJ5XHJcbiAgICAgICAgICAgIEdhbGxlcnlSZW5kZXIoIEcuR09NLmFsYnVtSWR4ICk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogcmVmcmVzaCB0aGUgY3VycmVudCBnYWxsZXJ5XHJcbiAgICAgKi9cclxuICAgIHRoaXMuUmVmcmVzaCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAvLyByZWZyZXNoIHRoZSBkaXNwbGF5ZWQgZ2FsbGVyeVxyXG4gICAgICBHYWxsZXJ5UmVuZGVyKCBHLkdPTS5hbGJ1bUlkeCApO1xyXG4gICAgfTtcclxuICAgIC8qKlxyXG4gICAgICogcmVzaXplIHRoZSBjdXJyZW50IGdhbGxlcnlcclxuICAgICAqL1xyXG4gICAgdGhpcy5SZXNpemUgPSBmdW5jdGlvbigpIHtcclxuICAgICAgLy8gcmVzaXplIHRoZSBkaXNwbGF5ZWQgZ2FsbGVyeVxyXG4gICAgICBHYWxsZXJ5UmVzaXplKCk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogZGlzcGxheSBvbmUgaXRlbSAoaW1hZ2Ugb3IgZ2FsbGVyeSlcclxuICAgICAqICAgaXRlbUlEIHN5bnRheDpcclxuICAgICAqICAgIC0gYWxidW1JRCAtLT4gZGlzcGxheSBvbmUgYWxidW1cclxuICAgICAqICAgIC0gYWxidW1JRC9pbWFnZUlEIC0tPiBkaXNwbGF5IG9uZSBpbWFnZVxyXG4gICAgKi9cclxuICAgIHRoaXMuRGlzcGxheUl0ZW0gPSBmdW5jdGlvbiggaXRlbUlEICkge1xyXG4gICAgICB2YXIgSURzPXBhcnNlSURzKCBpdGVtSUQgKTtcclxuICAgICAgaWYoIElEcy5pbWFnZUlEICE9ICcwJyApIHtcclxuICAgICAgICBEaXNwbGF5UGhvdG8oIElEcy5pbWFnZUlELCBJRHMuYWxidW1JRCApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIERpc3BsYXlBbGJ1bSggJy0xJywgSURzLmFsYnVtSUQgKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICB2YXIgQ291bnRJdGVtc1RvRGlzcGxheSA9IGZ1bmN0aW9uKCBnSWR4ICkge1xyXG4gICAgICBpZiggRy5JW2dJZHhdID09IHVuZGVmaW5lZCApIHsgcmV0dXJuIDA7IH1cclxuICAgICAgdmFyIGFsYnVtSUQgPSBHLklbZ0lkeF0uR2V0SUQoKTtcclxuICAgICAgdmFyIGwgPSBHLkkubGVuZ3RoO1xyXG4gICAgICB2YXIgY250ID0gMDtcclxuICAgICAgZm9yKCB2YXIgaWR4ID0gMDsgaWR4IDwgbDsgaWR4KysgKSB7XHJcbiAgICAgICAgdmFyIGl0ZW0gPSBHLklbaWR4XTtcclxuICAgICAgICBpZiggaXRlbS5pc1RvRGlzcGxheShhbGJ1bUlEKSApIHtcclxuICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gY250O1xyXG4gICAgfSBcclxuICAgIC8qKlxyXG4gICAgICogU2VhcmNoIGluIHRoZSBkaXNwbGF5ZWQgZ2FsbGVyeSAoaW4gdGh1bWJuYWlscyB0aXRsZSlcclxuICAgICAqL1xyXG4gICAgdGhpcy5TZWFyY2ggPSBmdW5jdGlvbiggc2VhcmNoICkge1xyXG4gICAgICBHLkdPTS5hbGJ1bVNlYXJjaCA9IHNlYXJjaC50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICB2YXIgZ0lkeCA9IEcuR09NLmFsYnVtSWR4O1xyXG4gICAgICBHYWxsZXJ5UmVuZGVyKCBHLkdPTS5hbGJ1bUlkeCApO1xyXG4gICAgICByZXR1cm4gQ291bnRJdGVtc1RvRGlzcGxheSggZ0lkeCApO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIFNlYXJjaDIgaW4gdGl0bGUgYW5kIHRhZ3MgLSBzZXQgc2VhcmNoIHZhbHVlc1xyXG4gICAgICovXHJcbiAgICB0aGlzLlNlYXJjaDIgPSBmdW5jdGlvbiggc2VhcmNoVGl0bGUsIHNlYXJjaFRhZ3MgKSB7XHJcbiAgICAgIGlmKCBzZWFyY2hUaXRsZSAhPSBudWxsICYmIHNlYXJjaFRpdGxlICE9IHVuZGVmaW5lZCApIHtcclxuICAgICAgICBHLkdPTS5hbGJ1bVNlYXJjaCA9IHNlYXJjaFRpdGxlLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgRy5HT00uYWxidW1TZWFyY2ggPSAnJztcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYoIHNlYXJjaFRhZ3MgIT0gbnVsbCAmJiBzZWFyY2hUYWdzICE9IHVuZGVmaW5lZCApIHtcclxuICAgICAgICBHLkdPTS5hbGJ1bVNlYXJjaFRhZ3MgPSBzZWFyY2hUYWdzLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgRy5HT00uYWxidW1TZWFyY2hUYWdzID0gJyc7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIENvdW50SXRlbXNUb0Rpc3BsYXkoIEcuR09NLmFsYnVtSWR4ICk7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIFNlYXJjaDIgLSBleGVjdXRlIHRoZSBzZWFyY2ggb24gdGl0bGUgYW5kIHRhZ3NcclxuICAgICAqL1xyXG4gICAgdGhpcy5TZWFyY2gyRXhlY3V0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgZ0lkeCA9IEcuR09NLmFsYnVtSWR4O1xyXG4gICAgICBHYWxsZXJ5UmVuZGVyKCBHLkdPTS5hbGJ1bUlkeCApO1xyXG4gICAgICByZXR1cm4gQ291bnRJdGVtc1RvRGlzcGxheSggZ0lkeCApO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIERlc3Ryb3kgdGhlIGN1cnJlbnQgZ2FsbGVyeVxyXG4gICAgICovXHJcbiAgICB0aGlzLkRlc3Ryb3kgPSBmdW5jdGlvbigpe1xyXG4gICAgICAvLyBhbGVydCgnZGVzdHJveScpO1xyXG4gICAgICAvLyB2YXIgZXZlbnQgPSBuZXcgRXZlbnQoJ2J1aWxkJyk7XHJcbiAgICAgIGlmKCBHLkdPTS5oYW1tZXJ0aW1lICE9IG51bGwgKSB7XHJcbiAgICAgICAgRy5HT00uaGFtbWVydGltZS5kZXN0cm95KCk7XHJcbiAgICAgICAgRy5HT00uaGFtbWVydGltZSA9IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgLy8gRy5HT00udXNlckV2ZW50cy5SZW1vdmVFdnRMaXN0ZW5lcigpO1xyXG4gICAgICAvLyBHLkdPTS51c2VyRXZlbnRzPW51bGw7XHJcbiAgICAgIC8vIEcuVk9NLnVzZXJFdmVudHMuUmVtb3ZlRXZ0TGlzdGVuZXIoKTtcclxuICAgICAgLy8gRy5WT00udXNlckV2ZW50cz1udWxsO1xyXG4gICAgICBpZiggRy5WT00uaGFtbWVydGltZSAhPSBudWxsICkge1xyXG4gICAgICAgIEcuVk9NLmhhbW1lcnRpbWUuZGVzdHJveSgpO1xyXG4gICAgICAgIEcuVk9NLmhhbW1lcnRpbWUgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIC8vVGh1bWJuYWlsSG92ZXJSZUluaXRBbGwoKTsgIFxyXG4gICAgICBcclxuICAgICAgLy8gY29sb3Igc2NoZW1lXHJcbiAgICAgICQoJyNuZ3ljc18nICsgRy5iYXNlRWx0SUQpLnJlbW92ZSgpXHJcbiAgICAgIFxyXG4gICAgICBHLkdPTS5pdGVtcyA9IFtdO1xyXG4gICAgICBOR1kySXRlbS5OZXcoIEcsIEcuaTE4blRyYW5zbGF0aW9ucy5icmVhZGNydW1iSG9tZSwgJycsICcwJywgJy0xJywgJ2FsYnVtJyApO1xyXG4gICAgICBHLkdPTS5uYXZpZ2F0aW9uQmFyLiRuZXdDb250ZW50ID0gbnVsbDtcclxuICAgICAgRy4kRS5iYXNlLmVtcHR5KCk7XHJcbiAgICAgIEcuJEUuYmFzZS5yZW1vdmVEYXRhKCk7XHJcbiAgICAgIGlmKCBHLk8ubG9jYXRpb25IYXNoICkge1xyXG4gICAgICAgIGpRdWVyeSh3aW5kb3cpLm9mZignaGFzaGNoYW5nZS5uYW5vZ2FsbGVyeTIuJyArIEcuYmFzZUVsdElEKTtcclxuICAgICAgfVxyXG4gICAgICBqUXVlcnkod2luZG93KS5vZmYoJ3Jlc2l6ZS5uYW5vZ2FsbGVyeTIuJyArIEcuYmFzZUVsdElEKTtcclxuICAgICAgalF1ZXJ5KHdpbmRvdykub2ZmKCdvcmllbnRhdGlvbkNoYW5nZS5uYW5vZ2FsbGVyeTIuJyArIEcuYmFzZUVsdElEKTtcclxuICAgICAgalF1ZXJ5KHdpbmRvdykub2ZmKCdzY3JvbGwubmFub2dhbGxlcnkyLicgKyBHLmJhc2VFbHRJRCk7XHJcbiAgICAgIEcuR09NLmZpcnN0RGlzcGxheSA9IGZhbHNlO1xuICAgIH07XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogQ2xvc2VWaWV3ZXIgLSBjbG9zZSB0aGUgbWVkaWEgdmlld2VyXHJcbiAgICAgKi9cclxuICAgIHRoaXMuQ2xvc2VWaWV3ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgQ2xvc2VJbnRlcm5hbFZpZXdlcihudWxsKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLyoqXHJcbiAgICAgKiBNaW5pbWl6ZVRvb2xiYXIgLSBkaXNwbGF5IHRoZSBtaW5pbWl6ZWQgbGlnaHRib3ggbWFpbiB0b29sYmFyXHJcbiAgICAgKi9cclxuICAgIHRoaXMuTWluaW1pemVUb29sYmFyID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIFZpZXdlclRvb2xiYXJGb3JWaXNpYmlsaXR5TWluKCk7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogTWF4aW1pemVUb29sYmFyIC0gZGlzcGxheSB0aGUgbWF4aW1pemVkL3N0YW5kYXJkIGxpZ2h0Ym94IG1haW4gdG9vbGJhclxyXG4gICAgICovXHJcbiAgICB0aGlzLk1heGltaXplVG9vbGJhciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBWaWV3ZXJUb29sYmFyRm9yVmlzaWJpbGl0eVN0ZCgpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIFBhZ2luYXRpb25QcmV2aW91c1BhZ2UgLSBnYWxsZXJ5IHBhZ2luYXRlIHRvIHByZXZpb3VzIHBhZ2VcclxuICAgICAqL1xyXG4gICAgdGhpcy5QYWdpbmF0aW9uUHJldmlvdXNQYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHBhZ2luYXRpb25QcmV2aW91c1BhZ2UoKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgXHJcbiAgICAvKipcclxuICAgICAqIFBhZ2luYXRpb25OZXh0UGFnZSAtIGdhbGxlcnkgcGFnaW5hdGUgdG8gbmV4dCBwYWdlXHJcbiAgICAgKi9cclxuICAgIHRoaXMuUGFnaW5hdGlvbk5leHRQYWdlID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgIHBhZ2luYXRpb25OZXh0UGFnZSgpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBcclxuICAgIC8qKlxyXG4gICAgICogUGFnaW5hdGlvbkdvdG9QYWdlIC0gZ2FsbGVyeSBwYWdpbmF0ZSB0byBzcGVjaWZpYyBwYWdlXHJcbiAgICAgKi9cclxuICAgIHRoaXMuUGFnaW5hdGlvbkdvdG9QYWdlID0gZnVuY3Rpb24oIHBhZ2UgKSB7XHJcbiAgICAgIHZhciBhSWR4ID0gRy4kRS5jb25QYWdpbi5kYXRhKCdnYWxsZXJ5SWR4Jyk7XHJcbiAgICAgIGlmKCBwYWdlID4gMSApIHsgcGFnZS0tOyB9XHJcbiAgICAgIEcuR09NLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgPSBwYWdlO1xyXG5cclxuICAgICAgLy8gc2Nyb2xsIHRvIHRvcCBvZiBnYWxsZXJ5IGlmIG5vdCBkaXNwbGF5ZWRcclxuICAgICAgaWYoICFpblZpZXdwb3J0VmVydChHLiRFLmJhc2UsIDApICkge1xyXG4gICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6IEcuJEUuYmFzZS5vZmZzZXQoKS50b3B9LCAyMDApO1xyXG4gICAgICB9XHJcbiAgICAgIEdhbGxlcnlEaXNwbGF5UGFydDEoIHRydWUgKTtcclxuICAgICAgR2FsbGVyeURpc3BsYXlQYXJ0MiggdHJ1ZSApO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUGFnaW5hdGlvbkNvdW50UGFnZXMgLSBnYWxsZXJ5IHBhZ2luYXRpb24gLSByZXR1cm5zIHRoZSBudW1iZXIgb2YgcGFnZXNcclxuICAgICAqL1xyXG4gICAgdGhpcy5QYWdpbmF0aW9uQ291bnRQYWdlcyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICBpZiggRy5HT00uaXRlbXMubGVuZ3RoID09IDAgKSB7IHJldHVybiAwOyB9ICAgLy8gbm8gdGh1bWJuYWlsIHRvIGRpc3BsYXlcclxuXHJcbiAgICAgIHZhciBuYlBhZ2VzID0gTWF0aC5jZWlsKChHLkdPTS5pdGVtc1tHLkdPTS5pdGVtcy5sZW5ndGggLSAxXS5yb3cgKyAxKSAvIEcuZ2FsbGVyeU1heFJvd3MuR2V0KCkpO1xyXG4gICAgICByZXR1cm4gbmJQYWdlcztcclxuICAgIH07XHJcbiAgICBcclxuICAgIFxyXG4gICAgXHJcbiAgICBcclxuICAgIC8vIHRocm90dGxlKClcclxuICAgIC8vIGF1dGhvcjogdW5kZXJzY29yZS5qcyAtIGh0dHA6Ly91bmRlcnNjb3JlanMub3JnL2RvY3MvdW5kZXJzY29yZS5odG1sXHJcbiAgICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIHdoZW4gaW52b2tlZCwgd2lsbCBvbmx5IGJlIHRyaWdnZXJlZCBhdCBtb3N0IG9uY2UgZHVyaW5nIGEgZ2l2ZW4gd2luZG93IG9mIHRpbWUuXHJcbiAgICAvLyBOb3JtYWxseSwgdGhlIHRocm90dGxlZCBmdW5jdGlvbiB3aWxsIHJ1biBhcyBtdWNoIGFzIGl0IGNhbiwgd2l0aG91dCBldmVyIGdvaW5nIG1vcmUgdGhhbiBvbmNlIHBlciB3YWl0IGR1cmF0aW9uO1xyXG4gICAgLy8gYnV0IGlmIHlvde+/vWQgbGlrZSB0byBkaXNhYmxlIHRoZSBleGVjdXRpb24gb24gdGhlIGxlYWRpbmcgZWRnZSwgcGFzcyB7bGVhZGluZzogZmFsc2V9LlxyXG4gICAgLy8gVG8gZGlzYWJsZSBleGVjdXRpb24gb24gdGhlIHRyYWlsaW5nIGVkZ2UsIGRpdHRvLlxyXG4gICAgdmFyIHRocm90dGxlID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgb3B0aW9ucykge1xyXG4gICAgICB2YXIgY29udGV4dCwgYXJncywgcmVzdWx0O1xyXG4gICAgICB2YXIgdGltZW91dCA9IG51bGw7XHJcbiAgICAgIHZhciBwcmV2aW91cyA9IDA7XHJcbiAgICAgIGlmICghb3B0aW9ucykgb3B0aW9ucyA9IHt9O1xyXG4gICAgICB2YXIgbGF0ZXIgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBwcmV2aW91cyA9IG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UgPyAwIDogbmV3IERhdGUoKS5nZXRUaW1lKCk7XHJcbiAgICAgICAgdGltZW91dCA9IG51bGw7XHJcbiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcclxuICAgICAgICBpZiAoIXRpbWVvdXQpIGNvbnRleHQgPSBhcmdzID0gbnVsbDtcclxuICAgICAgfTtcclxuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgICBpZiAoIXByZXZpb3VzICYmIG9wdGlvbnMubGVhZGluZyA9PT0gZmFsc2UpIHByZXZpb3VzID0gbm93O1xyXG4gICAgICAgIHZhciByZW1haW5pbmcgPSB3YWl0IC0gKG5vdyAtIHByZXZpb3VzKTtcclxuICAgICAgICBjb250ZXh0ID0gdGhpcztcclxuICAgICAgICBhcmdzID0gYXJndW1lbnRzO1xyXG4gICAgICAgIGlmIChyZW1haW5pbmcgPD0gMCB8fCByZW1haW5pbmcgPiB3YWl0KSB7XHJcbiAgICAgICAgICBpZiAodGltZW91dCkge1xyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XHJcbiAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcHJldmlvdXMgPSBub3c7XHJcbiAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xyXG4gICAgICAgICAgaWYgKCF0aW1lb3V0KSBjb250ZXh0ID0gYXJncyA9IG51bGw7XHJcbiAgICAgICAgfSBlbHNlIGlmICghdGltZW91dCAmJiBvcHRpb25zLnRyYWlsaW5nICE9PSBmYWxzZSkge1xyXG4gICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHJlbWFpbmluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBcclxuICAgIC8vIERFQk9VTkNFXHJcbiAgICAvLyBhdXRob3I6IEpvaG4gSGFubiAtIGh0dHA6Ly91bnNjcmlwdGFibGUuY29tLzIwMDkvMDMvMjAvZGVib3VuY2luZy1qYXZhc2NyaXB0LW1ldGhvZHMvXHJcbiAgICAvLyBleGVjQXNhcCAtIGZhbHNlIG1lYW5zIGV4ZWN1dGluZyBhdCB0aGUgZW5kIG9mIHRoZSBkZXRlY3Rpb24gcGVyaW9kXHJcbiAgICB2YXIgZGVib3VuY2UgPSBmdW5jdGlvbiAoZnVuYywgdGhyZXNob2xkLCBleGVjQXNhcCkge1xyXG4gICAgICB2YXIgdGltZW91dDtcclxuICAgICAgcmV0dXJuIGZ1bmN0aW9uIGRlYm91bmNlZCAoKSB7XHJcbiAgICAgICAgICB2YXIgb2JqID0gdGhpcywgYXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICAgIGZ1bmN0aW9uIGRlbGF5ZWQgKCkge1xyXG4gICAgICAgICAgICAgIGlmICghZXhlY0FzYXApXHJcbiAgICAgICAgICAgICAgICAgIGZ1bmMuYXBwbHkob2JqLCBhcmdzKTtcclxuICAgICAgICAgICAgICB0aW1lb3V0ID0gbnVsbDsgXHJcbiAgICAgICAgICB9O1xyXG4gICBcclxuICAgICAgICAgIGlmICh0aW1lb3V0KVxyXG4gICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcclxuICAgICAgICAgICAgICAvLyBjbGVhclJlcXVlc3RUaW1lb3V0KHRpbWVvdXQpO1xyXG4gICAgICAgICAgZWxzZSBpZiAoZXhlY0FzYXApXHJcbiAgICAgICAgICAgICAgZnVuYy5hcHBseShvYmosIGFyZ3MpO1xyXG4gICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQoZGVsYXllZCwgdGhyZXNob2xkIHx8IDEwMCk7IFxyXG4gICAgICAgICAgLy8gdGltZW91dCA9IHJlcXVlc3RUaW1lb3V0KGRlbGF5ZWQsIHRocmVzaG9sZCB8fCAxMDApOyBcclxuICAgICAgfTtcclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIC8vIERvdWJsZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWVcclxuICAgIHdpbmRvdy5uZ19kcmFmID0gZnVuY3Rpb24gKGNiKSB7XHJcbiAgICAgIHJldHVybiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShjYilcclxuICAgICAgfSlcclxuICAgIH0gICAgXHJcbiAgICBcclxuICAgIC8vIFJFUVVFU1RUSU1FT1VUIC0gcmVwbGFjZSBTRVRUSU1FT1VUIC0gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vam9lbGFtYmVydC8xMDAyMTE2XHJcbiAgICAvKipcclxuICAgICAqIEJlaGF2ZXMgdGhlIHNhbWUgYXMgc2V0VGltZW91dCBleGNlcHQgdXNlcyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKSB3aGVyZSBwb3NzaWJsZSBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlXHJcbiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBmbiBUaGUgY2FsbGJhY2sgZnVuY3Rpb25cclxuICAgICAqIEBwYXJhbSB7aW50fSBkZWxheSBUaGUgZGVsYXkgaW4gbWlsbGlzZWNvbmRzXHJcbiAgICAgKi9cclxuXHJcbiAgICB3aW5kb3cucmVxdWVzdFRpbWVvdXQgPSBmdW5jdGlvbihmbiwgZGVsYXkpIHtcclxuICAgICAgLy8gaWYoICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lICAgICAgXHQmJiBcclxuICAgICAgICAvLyAhd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSAmJiBcclxuICAgICAgICAvLyAhKHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgJiYgd2luZG93Lm1vekNhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSkgJiYgLy8gRmlyZWZveCA1IHNoaXBzIHdpdGhvdXQgY2FuY2VsIHN1cHBvcnRcclxuICAgICAgICAvLyAhd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgICAgICAmJiBcclxuICAgICAgICAvLyAhd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxyXG4gICAgICAgICAgcmV0dXJuIHdpbmRvdy5zZXRUaW1lb3V0KGZuLCBkZWxheSk7XHJcbiAgICAgICAgICBcclxuICAgICAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICAgICAgaGFuZGxlID0gbmV3IE9iamVjdCgpO1xyXG4gICAgICAgIFxyXG4gICAgICBmdW5jdGlvbiBsb29wKCl7XHJcbiAgICAgICAgdmFyIGN1cnJlbnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuICAgICAgICAgIGRlbHRhID0gY3VycmVudCAtIHN0YXJ0O1xyXG4gIGRlbHRhID0gZGVsYXk7XHJcbiAgXHJcbiAgICAgICAgZGVsdGEgPj0gZGVsYXkgPyBmbi5jYWxsKCkgOiBoYW5kbGUudmFsdWUgPSByZXF1ZXN0QW5pbUZyYW1lKGxvb3ApO1xyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgICAgaGFuZGxlLnZhbHVlID0gcmVxdWVzdEFuaW1GcmFtZShsb29wKTtcclxuICAgICAgcmV0dXJuIGhhbmRsZTtcclxuICAgIH07XHJcblxyXG4gICAgXHJcbiAgICAvLyByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKSBzaGltIGJ5IFBhdWwgSXJpc2hcclxuICAgIC8vIGh0dHA6Ly9wYXVsaXJpc2guY29tLzIwMTEvcmVxdWVzdGFuaW1hdGlvbmZyYW1lLWZvci1zbWFydC1hbmltYXRpbmcvXHJcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1GcmFtZSA9IChmdW5jdGlvbigpIHtcclxuICAgICAgcmV0dXJuICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lICAgICAgIHx8IFxyXG4gICAgICAgICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCBcclxuICAgICAgICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgICAgfHwgXHJcbiAgICAgICAgICB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZSAgICAgIHx8IFxyXG4gICAgICAgICAgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lICAgICB8fCBcclxuICAgICAgICAgIGZ1bmN0aW9uKC8qIGZ1bmN0aW9uICovIGNhbGxiYWNrLCAvKiBET01FbGVtZW50ICovIGVsZW1lbnQpe1xyXG4gICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIDYwKTtcclxuICAgICAgICAgIH07XHJcbiAgICB9KSgpOyAgICBcclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyBDTEVBUlJFUVVFU1RUSU1FT1VUIC0gdG8gcmVwbGFjZSBDTEVBUlRJTUVPVVQgLSBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9qb2VsYW1iZXJ0LzEwMDIxMTZcclxuICAgIC8qKlxyXG4gICAgICogQmVoYXZlcyB0aGUgc2FtZSBhcyBjbGVhclRpbWVvdXQgZXhjZXB0IHVzZXMgY2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lKCkgd2hlcmUgcG9zc2libGUgZm9yIGJldHRlciBwZXJmb3JtYW5jZVxyXG4gICAgICogQHBhcmFtIHtpbnR8b2JqZWN0fSBmbiBUaGUgY2FsbGJhY2sgZnVuY3Rpb25cclxuICAgICAqL1xyXG4gICAgd2luZG93LmNsZWFyUmVxdWVzdFRpbWVvdXQgPSBmdW5jdGlvbihoYW5kbGUpIHtcclxuICAgICAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPyB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUoaGFuZGxlLnZhbHVlKSA6XHJcbiAgICAgICAgd2luZG93LndlYmtpdENhbmNlbEFuaW1hdGlvbkZyYW1lID8gd2luZG93LndlYmtpdENhbmNlbEFuaW1hdGlvbkZyYW1lKGhhbmRsZS52YWx1ZSkgOlxyXG4gICAgICAgIHdpbmRvdy53ZWJraXRDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyB3aW5kb3cud2Via2l0Q2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lKGhhbmRsZS52YWx1ZSkgOiAvKiBTdXBwb3J0IGZvciBsZWdhY3kgQVBJICovXHJcbiAgICAgICAgd2luZG93Lm1vekNhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZSA/IHdpbmRvdy5tb3pDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUoaGFuZGxlLnZhbHVlKSA6XHJcbiAgICAgICAgd2luZG93Lm9DYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcdD8gd2luZG93Lm9DYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUoaGFuZGxlLnZhbHVlKSA6XHJcbiAgICAgICAgd2luZG93Lm1zQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gd2luZG93Lm1zQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lKGhhbmRsZS52YWx1ZSkgOlxyXG4gICAgICAgIGNsZWFyVGltZW91dChoYW5kbGUpO1xyXG4gICAgfTsgICAgXHJcbiAgICBcclxuICAgIFxyXG4gICAgXHJcbiAgICAvKlxyXG4gICAgKiogR2xvYmFsIGRhdGEgZm9yIHRoaXMgbmFub2dhbGxlcnkyIGluc3RhbmNlXHJcbiAgICAqKi9cclxuICAgIHZhciBHPXRoaXM7XHJcbiAgICBHLkkgPSAgICAgICAgICAgICAgICAgICAgICAgW107ICAgICAgICAgICAvLyBnYWxsZXJ5IGl0ZW1zXHJcbiAgICBHLklkID0gICAgICAgICAgICAgICAgICAgICAgW107ICAgICAgICAgICAvLyBnYWxsZXJ5IGl0ZW1zXHJcbiAgICBHLk8gPSAgICAgICAgICAgICAgICAgICAgICAgbnVsbDsgICAgICAgICAvLyB1c2VyIG9wdGlvbnNcclxuICAgIEcuYmFzZUVsdElEID0gICAgICAgICAgICAgICBudWxsOyAgICAgICAgIC8vIElEIG9mIHRoZSBiYXNlIGVsZW1lbnRcclxuICAgIEcuJEUgPSB7IFxyXG4gICAgICBiYXNlOiAgICAgICAgICAgICAgICAgICAgIG51bGwsICAgICAgICAgLy8gYmFzZSBlbGVtZW50XHJcbiAgICAgIGNvblRuUGFyZW50OiAgICAgICAgICAgICAgbnVsbCwgICAgICAgICAvLyAkZ19jb250YWluZXJUaHVtYm5haWxzUGFyZW50XHJcbiAgICAgIGNvbkxvYWRpbmdCOiAgICAgICAgICAgICAgbnVsbCwgICAgICAgICAvLyBsb2FkaW5nIGJhciAtIG5hbm9HYWxsZXJ5TEJhck9mZlxyXG4gICAgICBjb25Db25zb2xlOiAgICAgICAgICAgICAgIG51bGwsICAgICAgICAgLy8gY29uc29sZSBmb3IgZXJyb3IgbWVzc2FnZXNcclxuICAgICAgY29uTmF2aWdhdGlvbkJhcjogICAgICAgICBudWxsLCAgICAgICAgIC8vIGdhbGxlcnkgbmF2aWdhdGlvbiBiYXJcclxuICAgICAgY29uVG5Cb3R0b206ICAgICAgICAgICAgICBudWxsICAgICAgICAgLy8gY29udGFpbmVyIG9uIHRoZSBib3R0b20gb2YgdGhlIGdhbGxlcnlcclxuICAgIH07XHJcbiAgICBHLnNob3BwaW5nQ2FydCA9ICAgICAgICAgICAgW107XHJcbiAgICBHLmxheW91dCA9IHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMYXlvdXQgaW5mb3JtYXRpb25zXHJcbiAgICAgIGludGVybmFsIDogICAgICAgICAgICAgICAgdHJ1ZSxcclxuICAgICAgZW5naW5lIDogICAgICAgICAgICAgICAgICAnJyxcclxuICAgICAgc3VwcG9ydCA6ICAgICAgICAgICAgICAgICB7IHJvd3M6IGZhbHNlIH0sXHJcbiAgICAgIHByZXJlcXVpc2l0ZSA6ICAgICAgICAgICAgeyBpbWFnZVNpemU6IGZhbHNlIH0sXHJcbiAgICAgIFNldEVuZ2luZTogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICBpZiggRy5sYXlvdXQuaW50ZXJuYWwgKSB7XHJcbiAgICAgICAgICBpZiggRy50bi5zZXR0aW5ncy53aWR0aFtHLkdPTS5jdXJOYXZMZXZlbF1bRy5HT00uY3VyV2lkdGhdID09ICdhdXRvJyB8fCBHLnRuLnNldHRpbmdzLndpZHRoW0cuR09NLmN1ck5hdkxldmVsXVtHLkdPTS5jdXJXaWR0aF0gPT0gJycgKSB7XHJcbiAgICAgICAgICAgIC8vIGRvIG5vdCB1c2UgZ2V0SCgpIC8gZ2V0VygpIGhlcmUhXHJcbiAgICAgICAgICAgIEcubGF5b3V0LmVuZ2luZSA9ICdKVVNUSUZJRUQnO1xyXG4gICAgICAgICAgICBHLmxheW91dC5zdXBwb3J0LnJvd3MgPSB0cnVlO1xyXG4gICAgICAgICAgICBHLmxheW91dC5wcmVyZXF1aXNpdGUuaW1hZ2VTaXplID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYoIEcudG4uc2V0dGluZ3MuaGVpZ2h0W0cuR09NLmN1ck5hdkxldmVsXVtHLkdPTS5jdXJXaWR0aF0gPT0gJ2F1dG8nIHx8IEcudG4uc2V0dGluZ3MuaGVpZ2h0W0cuR09NLmN1ck5hdkxldmVsXVtHLkdPTS5jdXJXaWR0aF0gPT0gJycgKSB7XHJcbiAgICAgICAgICAgIC8vIGRvIG5vdCB1c2UgZ2V0SCgpIC8gZ2V0VygpIGhlcmUhXHJcbiAgICAgICAgICAgIEcubGF5b3V0LmVuZ2luZSA9ICdDQVNDQURJTkcnO1xyXG4gICAgICAgICAgICBHLmxheW91dC5zdXBwb3J0LnJvd3MgPSBmYWxzZTtcclxuICAgICAgICAgICAgRy5sYXlvdXQucHJlcmVxdWlzaXRlLmltYWdlU2l6ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiggRy50bi5zZXR0aW5ncy5nZXRNb3NhaWMoKSAhPSBudWxsICkge1xyXG4gICAgICAgICAgICBHLmxheW91dC5lbmdpbmUgPSAnTU9TQUlDJztcclxuICAgICAgICAgICAgRy5sYXlvdXQuc3VwcG9ydC5yb3dzID0gdHJ1ZTtcclxuICAgICAgICAgICAgRy5sYXlvdXQucHJlcmVxdWlzaXRlLmltYWdlU2l6ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIEcubGF5b3V0LmVuZ2luZT0nR1JJRCc7XHJcbiAgICAgICAgICBHLmxheW91dC5zdXBwb3J0LnJvd3M9dHJ1ZTtcclxuICAgICAgICAgIC8vIGlmKCBHLnRuLm9wdC5HZXQoJ2Nyb3AnKSA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgLy8gRy5sYXlvdXQucHJlcmVxdWlzaXRlLmltYWdlU2l6ZSA9IHRydWU7XHJcbiAgICAgICAgICAvLyB9XHJcbiAgICAgICAgICAvLyBlbHNlIHtcclxuICAgICAgICAgICAgRy5sYXlvdXQucHJlcmVxdWlzaXRlLmltYWdlU2l6ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgLy8gfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgRy5nYWxsZXJ5TWF4Um93cyA9IHsgbDE6IDAsIGxOOiAwLFxyXG4gICAgICBHZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBHLmdhbGxlcnlNYXhSb3dzW0cuR09NLmN1ck5hdkxldmVsXTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIEcuZ2FsbGVyeU1heEl0ZW1zID0geyBsMTogMCwgbE46IDAsXHJcbiAgICAgIEdldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIEcuZ2FsbGVyeU1heEl0ZW1zW0cuR09NLmN1ck5hdkxldmVsXTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIEcuZ2FsbGVyeUZpbHRlclRhZ3MgPSB7IGwxOiAwLCBsTjogMCxcclxuICAgICAgR2V0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gRy5nYWxsZXJ5RmlsdGVyVGFnc1tHLkdPTS5jdXJOYXZMZXZlbF07XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBHLmdhbGxlcnlEaXNwbGF5TW9kZSA9IHsgbDE6ICdGVUxMQ09OVEVOVCcsIGxOOiAnRlVMTENPTlRFTlQnLFxyXG4gICAgICBHZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBHLmdhbGxlcnlEaXNwbGF5TW9kZVtHLkdPTS5jdXJOYXZMZXZlbF07XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBHLmdhbGxlcnlMYXN0Um93RnVsbCA9IHsgbDE6IGZhbHNlLCBsTjogZmFsc2UsXHJcbiAgICAgIEdldDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIEcuZ2FsbGVyeUxhc3RSb3dGdWxsW0cuR09NLmN1ck5hdkxldmVsXTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIEcuZ2FsbGVyeVNvcnRpbmcgPSB7IGwxOiAnJywgbE46ICcnLFxyXG4gICAgICBHZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBHLmdhbGxlcnlTb3J0aW5nW0cuR09NLmN1ck5hdkxldmVsXTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIEcuZ2FsbGVyeURpc3BsYXlUcmFuc2l0aW9uID0geyBsMTogJ25vbmUnLCBsTjogJ25vbmUnLFxyXG4gICAgICBHZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBHLmdhbGxlcnlEaXNwbGF5VHJhbnNpdGlvbltHLkdPTS5jdXJOYXZMZXZlbF07XHJcbiAgICAgIH1cclxuICAgIH07XHJcbiAgICBHLmdhbGxlcnlEaXNwbGF5VHJhbnNpdGlvbkR1cmF0aW9uID0geyBsMTogNTAwLCBsTjogNTAwLFxyXG4gICAgICBHZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBHLmdhbGxlcnlEaXNwbGF5VHJhbnNpdGlvbkR1cmF0aW9uW0cuR09NLmN1ck5hdkxldmVsXTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIEcuJGN1cnJlbnRUb3VjaGVkVGh1bWJuYWlsID0gbnVsbDsgICAgXHJcbiAgICBcclxuICAgIC8vICMjIyMjIEdFTkVSQUwgVEhVTUJOQUlMUyBQUk9QRVJUSUVTIC0tPlxyXG4gICAgRy50biA9IHtcclxuICAgICAgLy8gbGV2ZWxsIHNwZWNpZmljIG9wdGlvbnNcclxuICAgICAgb3B0OiAge1xyXG4gICAgICAgIGwxOiB7IGNyb3A6IHRydWUsIHN0YWNrczogMCwgc3RhY2tzVHJhbnNsYXRlWDogMCwgc3RhY2tzVHJhbnNsYXRlWTogMCwgc3RhY2tzVHJhbnNsYXRlWjogMCwgc3RhY2tzUm90YXRlWDogMCwgc3RhY2tzUm90YXRlWTogMCwgc3RhY2tzUm90YXRlWjogMCwgc3RhY2tzU2NhbGU6IDAsIGd1dHRlckhlaWdodDogMCwgZ3V0dGVyV2lkdGg6IDAsIGJhc2VHcmlkSGVpZ2h0OiAwLCBkaXNwbGF5VHJhbnNpdGlvbjogJ0ZBREVJTicsIGRpc3BsYXlUcmFuc2l0aW9uU3RhcnRWYWw6IDAsIGRpc3BsYXlUcmFuc2l0aW9uRWFzaW5nOiAnZWFzZU91dFF1YXJ0JywgZGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbjogMjQwLCBkaXNwbGF5SW50ZXJ2YWw6IDE1IH0sXHJcbiAgICAgICAgbE46IHsgY3JvcDogdHJ1ZSwgc3RhY2tzOiAwLCBzdGFja3NUcmFuc2xhdGVYOiAwLCBzdGFja3NUcmFuc2xhdGVZOiAwLCBzdGFja3NUcmFuc2xhdGVaOiAwLCBzdGFja3NSb3RhdGVYOiAwLCBzdGFja3NSb3RhdGVZOiAwLCBzdGFja3NSb3RhdGVaOiAwLCBzdGFja3NTY2FsZTogMCwgZ3V0dGVySGVpZ2h0OiAwLCBndXR0ZXJXaWR0aDogMCwgYmFzZUdyaWRIZWlnaHQ6IDAsIGRpc3BsYXlUcmFuc2l0aW9uOiAnRkFERUlOJywgZGlzcGxheVRyYW5zaXRpb25TdGFydFZhbDogMCwgZGlzcGxheVRyYW5zaXRpb25FYXNpbmc6ICdlYXNlT3V0UXVhcnQnLCBkaXNwbGF5VHJhbnNpdGlvbkR1cmF0aW9uOiAyNDAsIGRpc3BsYXlJbnRlcnZhbDogMTUgfSxcclxuICAgICAgICBHZXQ6IGZ1bmN0aW9uKG9wdCkge1xyXG4gICAgICAgICAgcmV0dXJuIEcudG4ub3B0W0cuR09NLmN1ck5hdkxldmVsXVtvcHRdO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgc2NhbGU6ICAgICAgICAgICAgICAgICAgICAgICAgICAxLCAgICAgICAgIC8vIGltYWdlIHNjYWxlIGRlcGVuZGluZyBvZiB0aGUgaG92ZXIgZWZmZWN0XHJcbiAgICAgIGJvcmRlcldpZHRoOiAgICAgICAgICAgICAgICAgICAgMCwgICAgICAgICAvLyB0aHVtYm5haWwgY29udGFpbmVyIGJvcmRlciB3aWR0aFxyXG4gICAgICBib3JkZXJIZWlnaHQ6ICAgICAgICAgICAgICAgICAgIDAsICAgICAgICAgLy8gdGh1bWJuYWlsIGNvbnRhaW5lciBib3JkZXIgaGVpZ2h0XHJcbiAgICAgIGxhYmVsSGVpZ2h0OiB7ICAgICAgICAgICAgICAgICAgLy8gaW4gY2FzZSBsYWJlbCBvbiBib3R0b20sIG90aGVyd2lzZSBhbHdheXM9MFxyXG4gICAgICAgIGwxOiAwLCBsTjogMCxcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgcmV0dXJuIEcudG4ubGFiZWxIZWlnaHRbRy5HT00uY3VyTmF2TGV2ZWxdO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgZGVmYXVsdFNpemU6IHsgICAgICAgICAgICAgICAgICAvLyBkZWZhdWx0IHRodW1ibmFpbCBzaXplXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGFiZWwgaGVpZ2h0IGlzIG5vdCBpbmNsdWRlZFxyXG4gICAgICAgIHdpZHRoOiB7ICBsMSA6IHsgeHM6MCwgc206MCwgbWU6MCwgbGE6MCwgeGw6MCB9LCBsTiA6IHsgeHM6MCwgc206MCwgbWU6MCwgbGE6MCwgeGw6MCB9IH0sXHJcbiAgICAgICAgaGVpZ2h0OiB7IGwxIDogeyB4czowLCBzbTowLCBtZTowLCBsYTowLCB4bDowIH0sIGxOIDogeyB4czowLCBzbTowLCBtZTowLCBsYTowLCB4bDowIH0gfSxcclxuICAgICAgICBnZXRXaWR0aDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gRy50bi5kZWZhdWx0U2l6ZS53aWR0aFtHLkdPTS5jdXJOYXZMZXZlbF1bRy5HT00uY3VyV2lkdGhdO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0T3V0ZXJXaWR0aDogZnVuY3Rpb24oKSB7ICAgICAvLyB3aWR0aCBib3JkZXIgaW5jbHVkZWRcclxuICAgICAgICAgIHJldHVybiBHLnRuLmRlZmF1bHRTaXplLndpZHRoW0cuR09NLmN1ck5hdkxldmVsXVtHLkdPTS5jdXJXaWR0aF0rRy50bi5ib3JkZXJXaWR0aCoyO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0SGVpZ2h0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIHJldHVybiBHLnRuLmRlZmF1bHRTaXplLmhlaWdodFtHLkdPTS5jdXJOYXZMZXZlbF1bRy5HT00uY3VyV2lkdGhdO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0T3V0ZXJIZWlnaHQ6IGZ1bmN0aW9uKCkgeyAgICAgLy8gaGVpZ2h0LCBib3JkZXIgaW5jbHVkZWRcclxuICAgICAgICAgIHJldHVybiBHLnRuLmRlZmF1bHRTaXplLmhlaWdodFtHLkdPTS5jdXJOYXZMZXZlbF1bRy5HT00uY3VyV2lkdGhdK0cudG4uYm9yZGVySGVpZ2h0KjI7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICBzZXR0aW5nczogeyAgICAgICAgICAgICAgICAgICAgIC8vIHVzZXIgZGVmaW5lZCB3aWR0aC9oZWlnaHQgb2YgdGhlIGltYWdlIHRvIGRpc3BsYXkgZGVwZW5kaW5nIG9uIHRoZSBzY3JlZW4gc2l6ZVxyXG4gICAgICAgIHdpZHRoOiB7ICBsMSA6IHsgeHM6MCwgc206MCwgbWU6MCwgbGE6MCwgeGw6MCwgeHNjOid1Jywgc21jOid1JywgbWVjOid1JywgbGFjOid1JywgeGxjOid1JyB9LFxyXG4gICAgICAgICAgICAgICAgICBsTiA6IHsgeHM6MCwgc206MCwgbWU6MCwgbGE6MCwgeGw6MCwgeHNjOid1Jywgc21jOid1JywgbWVjOid1JywgbGFjOid1JywgeGxjOid1JyB9IH0sXHJcbiAgICAgICAgaGVpZ2h0OiB7IGwxIDogeyB4czowLCBzbTowLCBtZTowLCBsYTowLCB4bDowLCB4c2M6J3UnLCBzbWM6J3UnLCBtZWM6J3UnLCBsYWM6J3UnLCB4bGM6J3UnIH0sIFxyXG4gICAgICAgICAgICAgICAgICBsTiA6IHsgeHM6MCwgc206MCwgbWU6MCwgbGE6MCwgeGw6MCwgeHNjOid1Jywgc21jOid1JywgbWVjOid1JywgbGFjOid1JywgeGxjOid1JyB9IH0sXHJcbiAgICAgICAgZ2V0SDogZnVuY3Rpb24obCwgdykge1xyXG4gICAgICAgICAgdmFyIGNsID0gKGwgPT0gdW5kZWZpbmVkID8gRy5HT00uY3VyTmF2TGV2ZWwgOiBsKTtcclxuICAgICAgICAgIHZhciBjdyA9ICh3ID09IHVuZGVmaW5lZCA/IEcuR09NLmN1cldpZHRoIDogdyk7XHJcbiAgICAgICAgICBpZiggRy5sYXlvdXQuZW5naW5lID09ICdNT1NBSUMnICkge1xyXG4gICAgICAgICAgcmV0dXJuIEcudG4uc2V0dGluZ3MuaGVpZ2h0W2NsXVtjd10gKiBHLnRuLnNldHRpbmdzLm1vc2FpY1tjbCsnRmFjdG9yJ11bJ2gnXVtjd107XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIEcudG4uc2V0dGluZ3MuaGVpZ2h0W2NsXVtjd107XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXRXOiBmdW5jdGlvbihsLCB3KSB7XHJcbiAgICAgICAgICB2YXIgY2wgPSAobCA9PSB1bmRlZmluZWQgPyBHLkdPTS5jdXJOYXZMZXZlbCA6IGwpO1xyXG4gICAgICAgICAgdmFyIGN3ID0gKHcgPT0gdW5kZWZpbmVkID8gRy5HT00uY3VyV2lkdGggOiB3KTtcclxuICAgICAgICAgIGlmKCBHLmxheW91dC5lbmdpbmUgPT0gJ01PU0FJQycgKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBHLnRuLnNldHRpbmdzLndpZHRoW2NsXVtjd10gKiBHLnRuLnNldHRpbmdzLm1vc2FpY1tjbCsnRmFjdG9yJ11bJ3cnXVtjd107XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIEcudG4uc2V0dGluZ3Mud2lkdGhbY2xdW2N3XTtcclxuICAgICAgICAgICAgLy8gcmV0dXJuIEcudG4uc2V0dGluZ3Mud2lkdGhbRy5HT00uY3VyTmF2TGV2ZWxdW0cuR09NLmN1cldpZHRoXTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIG1vc2FpYzogeyBsMSA6IHsgeHM6IG51bGwsIHNtOiBudWxsLCBtZTogbnVsbCwgbGE6IG51bGwsIHhsOiBudWxsIH0sXHJcbiAgICAgICAgICAgICAgICAgIGxOIDogeyB4czogbnVsbCwgc206IG51bGwsIG1lOiBudWxsLCBsYTogbnVsbCwgeGw6IG51bGwgfSxcclxuICAgICAgICAgICAgICAgICAgbDFGYWN0b3IgOiB7IGggOnsgeHM6IDEsIHNtOiAxLCBtZTogMSwgbGE6IDEsIHhsOiAxIH0sIHcgOnsgeHM6IDEsIHNtOiAxLCBtZTogMSwgbGE6IDEsIHhsOiAxIH19LFxyXG4gICAgICAgICAgICAgICAgICBsTkZhY3RvciA6IHsgaCA6eyB4czogMSwgc206IDEsIG1lOiAxLCBsYTogMSwgeGw6IDEgfSwgdyA6eyB4czogMSwgc206IDEsIG1lOiAxLCBsYTogMSwgeGw6IDEgfX1cclxuICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICBnZXRNb3NhaWM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgcmV0dXJuIEcudG4uc2V0dGluZ3MubW9zYWljW0cuR09NLmN1ck5hdkxldmVsXVtHLkdPTS5jdXJXaWR0aF07XHJcbiAgICAgICAgfSxcclxuICAgICAgICBtb3NhaWNDYWxjRmFjdG9yOiBmdW5jdGlvbihsLCB3KSB7XHJcbiAgICAgICAgICAgIC8vIHJldHJpZXZlIG1heCBzaXplIG11bHRpcGxpY2F0b3JcclxuICAgICAgICAgICAgdmFyIG1heFcgPSAxO1xyXG4gICAgICAgICAgICB2YXIgbWF4SCA9IDE7XHJcbiAgICAgICAgICAgIGZvciggdmFyIG4gPSAwOyBuIDwgRy50bi5zZXR0aW5ncy5tb3NhaWNbbF1bd10ubGVuZ3RoOyBuKysgKSB7XHJcbiAgICAgICAgICAgICAgbWF4VyA9IE1hdGgubWF4KG1heFcsIEcudG4uc2V0dGluZ3MubW9zYWljW2xdW3ddW25dWyd3J10pO1xyXG4gICAgICAgICAgICAgIG1heEggPSBNYXRoLm1heChtYXhILCBHLnRuLnNldHRpbmdzLm1vc2FpY1tsXVt3XVtuXVsnaCddKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpY1tsICsgJ0ZhY3RvciddWydoJ11bd10gPSBtYXhIO1xyXG4gICAgICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpY1tsICsgJ0ZhY3RvciddWyd3J11bd10gPSBtYXhXO1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgLy8gdGh1bWJuYWlsIGhvdmVyIGVmZmVjdHNcclxuICAgICAgaG92ZXJFZmZlY3RzIDoge1xyXG4gICAgICAgIHN0ZCA6ICAgW10sXHJcbiAgICAgICAgbGV2ZWwxOiBbXSxcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgaWYoIEcuR09NLmN1ck5hdkxldmVsID09ICdsMScgJiYgRy50bi5ob3ZlckVmZmVjdHMubGV2ZWwxLmxlbmd0aCAhPT0gMCApIHtcclxuICAgICAgICAgICAgcmV0dXJuIEcudG4uaG92ZXJFZmZlY3RzLmxldmVsMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gRy50bi5ob3ZlckVmZmVjdHMuc3RkO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgLy8gdGh1bWJuYWlsIGluaXRcclxuICAgICAgYnVpbGRJbml0IDoge1xyXG4gICAgICAgIHN0ZCA6ICAgW10sXHJcbiAgICAgICAgbGV2ZWwxOiBbXSxcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgaWYoIEcuR09NLmN1ck5hdkxldmVsID09ICdsMScgJiYgRy50bi5idWlsZEluaXQubGV2ZWwxLmxlbmd0aCAhPT0gMCApIHtcclxuICAgICAgICAgICAgcmV0dXJuIEcudG4uYnVpbGRJbml0LmxldmVsMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gRy50bi5idWlsZEluaXQuc3RkO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgLy8gdGh1bWJuYWlsIHRvb2xiYXJzXHJcbiAgICAgIHRvb2xiYXI6IHtcclxuICAgICAgICBhbGJ1bSA6ICAgeyB0b3BMZWZ0IDogJycsIHRvcFJpZ2h0OiAnJywgYm90dG9tTGVmdDogJycsIGJvdHRvbVJpZ2h0OiAnJyB9LFxyXG4gICAgICAgIGltYWdlIDogICB7IHRvcExlZnQgOiAnJywgdG9wUmlnaHQ6ICcnLCBib3R0b21MZWZ0OiAnJywgYm90dG9tUmlnaHQ6ICcnIH0sXHJcbiAgICAgICAgYWxidW1VcCA6IHsgdG9wTGVmdCA6ICcnLCB0b3BSaWdodDogJycsIGJvdHRvbUxlZnQ6ICcnLCBib3R0b21SaWdodDogJycgfSxcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCBpdGVtICkge1xyXG4gICAgICAgICAgcmV0dXJuIEcudG4udG9vbGJhcltpdGVtLmtpbmRdO1xyXG4gICAgICAgIH0sXHJcbiAgICAgIH0sXHJcbiAgICAgIHN0eWxlOiB7XHJcbiAgICAgICAgLy8gaW5saW5lIENTU1xyXG4gICAgICAgIGwxIDogeyBsYWJlbDogJycsIHRpdGxlOiAnJywgZGVzYzogJycgfSxcclxuICAgICAgICBsTiA6IHsgbGFiZWw6ICcnLCB0aXRsZTogJycsIGRlc2M6ICcnIH0sXHJcbiAgICAgICAgZ2V0VGl0bGUgOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIHJldHVybiAoJ3N0eWxlPVwiJyArIEcudG4uc3R5bGVbRy5HT00uY3VyTmF2TGV2ZWxdLnRpdGxlICsgJ1wiJyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXREZXNjIDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICByZXR1cm4gKCdzdHlsZT1cIicgKyBHLnRuLnN0eWxlW0cuR09NLmN1ck5hdkxldmVsXS5kZXNjICsgJ1wiJyk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBnZXRMYWJlbDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICB2YXIgcz0nc3R5bGU9XCInKyBHLnRuLnN0eWxlW0cuR09NLmN1ck5hdkxldmVsXS5sYWJlbDtcclxuICAgICAgICAgIHMrPSAoRy5PLlJUTCA/ICdcImRpcmVjdGlvbjpSVEw7XCInIDonJyk7XHJcbiAgICAgICAgICBzKz0nXCInO1xyXG4gICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgRy5zY3JvbGxUaW1lT3V0ID0gICAgICAgICAgICAgMDtcclxuICAgIEcuaTE4blRyYW5zbGF0aW9ucyA9ICAgICAgICAgIHsncGFnaW5hdGlvblByZXZpb3VzJzonUHJldmlvdXMnLCAncGFnaW5hdGlvbk5leHQnOidOZXh0JywgJ2JyZWFkY3J1bWJIb21lJzonTGlzdCBvZiBBbGJ1bXMnLCAndGh1bWJuYWlsSW1hZ2VUaXRsZSc6JycsICd0aHVtYm5haWxBbGJ1bVRpdGxlJzonJywgJ3RodW1ibmFpbEltYWdlRGVzY3JpcHRpb24nOicnLCAndGh1bWJuYWlsQWxidW1EZXNjcmlwdGlvbic6JycgfTtcclxuICAgIEcuZW1wdHlHaWYgPSAgICAgICAgICAgICAgICAgICdkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhFQUFRQUlBQUFQLy8vLy8vL3lINUJBRUtBQUVBTEFBQUFBQVFBQkFBQUFJT2pJK3B5KzBQbzV5MDJvdXpQZ1VBT3c9PSc7XHJcbiAgICBHLkNTU3RyYW5zZm9ybU5hbWUgPSAgICAgICAgICBGaXJzdFN1cHBvcnRlZFByb3BlcnR5TmFtZShbXCJ0cmFuc2Zvcm1cIiwgXCJtc1RyYW5zZm9ybVwiLCBcIk1velRyYW5zZm9ybVwiLCBcIldlYmtpdFRyYW5zZm9ybVwiLCBcIk9UcmFuc2Zvcm1cIl0pO1xyXG4gICAgLy8gRy5DU1NmaWx0ZXJOYW1lID0gICAgICAgICAgRmlyc3RTdXBwb3J0ZWRQcm9wZXJ0eU5hbWUoW1wiZmlsdGVyXCIsIFwiV2Via2l0RmlsdGVyXCJdKTtcclxuICAgIEcuQ1NTdHJhbnNmb3JtU3R5bGUgPSAgICAgICAgIEZpcnN0U3VwcG9ydGVkUHJvcGVydHlOYW1lKFtcInRyYW5zZm9ybVN0eWxlXCIsIFwibXNUcmFuc2Zvcm1TdHlsZVwiLCBcIk1velRyYW5zZm9ybVN0eWxlXCIsIFwiV2Via2l0VHJhbnNmb3JtU3R5bGVcIiwgXCJPVHJhbnNmb3JtU3R5bGVcIl0pO1xyXG4gICAgRy5DU1NwZXJzcGVjdGl2ZSA9ICAgICAgICAgICAgRmlyc3RTdXBwb3J0ZWRQcm9wZXJ0eU5hbWUoW1wicGVyc3BlY3RpdmVcIiwgXCJtc1BlcnNwZWN0aXZlXCIsIFwiTW96UGVyc3BlY3RpdmVcIiwgXCJXZWJraXRQZXJzcGVjdGl2ZVwiLCBcIk9QZXJzcGVjdGl2ZVwiXSk7XHJcbiAgICBHLkNTU2JhY2tmYWNlVmlzaWJpbGl0eU5hbWUgPSBGaXJzdFN1cHBvcnRlZFByb3BlcnR5TmFtZShbXCJiYWNrZmFjZVZpc2liaWxpdHlcIiwgXCJtc0JhY2tmYWNlVmlzaWJpbGl0eVwiLCBcIk1vekJhY2tmYWNlVmlzaWJpbGl0eVwiLCBcIldlYmtpdEJhY2tmYWNlVmlzaWJpbGl0eVwiLCBcIk9CYWNrZmFjZVZpc2liaWxpdHlcIl0pO1xyXG4gICAgRy5DU1N0cmFuc2l0aW9uTmFtZSA9ICAgICAgICAgRmlyc3RTdXBwb3J0ZWRQcm9wZXJ0eU5hbWUoW1widHJhbnNpdGlvblwiLCBcIm1zVHJhbnNpdGlvblwiLCBcIk1velRyYW5zaXRpb25cIiwgXCJXZWJraXRUcmFuc2l0aW9uXCIsIFwiT1RyYW5zaXRpb25cIl0pO1xyXG4gICAgRy5DU1NhbmltYXRpb25OYW1lID0gICAgICAgICAgRmlyc3RTdXBwb3J0ZWRQcm9wZXJ0eU5hbWUoW1wiYW5pbWF0aW9uXCIsIFwibXNBbmltYXRpb25cIiwgXCJNb3pBbmltYXRpb25cIiwgXCJXZWJraXRBbmltYXRpb25cIiwgXCJPQW5pbWF0aW9uXCJdKTtcclxuICAgIEcuR2FsbGVyeVJlc2l6ZVRocm90dGxlZCA9ICAgIHRocm90dGxlKEdhbGxlcnlSZXNpemUsIDMwLCB7bGVhZGluZzogZmFsc2V9KTtcclxuICAgIFxyXG4gICAgRy5ibGFja0xpc3QgPSAgICAgICAgICAgICAgICAgbnVsbDsgICAgIC8vIGFsYnVtIHdoaXRlIGxpc3RcclxuICAgIEcud2hpdGVMaXN0ID0gICAgICAgICAgICAgICAgIG51bGw7ICAgICAvLyBhbGJ1bSBibGFjayBsaXN0XHJcbiAgICBHLmFsYnVtTGlzdCA9ICAgICAgICAgICAgICAgICBbXTsgICAgICAgLy8gYWxidW0gbGlzdFxyXG4gICAgRy5sb2NhdGlvbkhhc2hMYXN0VXNlZCA9ICAgICAgJyc7XHJcbiAgICBHLmN1c3RHbG9iYWxzID0gICAgICAgICAgICAgICB7fTtcclxuICAgIEcudG91Y2hBdXRvT3BlbkRlbGF5VGltZXJJRCA9IDA7XHJcbiAgICBHLmkxOG5MYW5nID0gICAgICAgICAgICAgICAgICAnJztcclxuICAgIEcudGltZUxhc3RUb3VjaFN0YXJ0ID0gICAgICAgIDA7XHJcbiAgICBHLmN1c3RHbG9iYWxzID0gICAgICAgICAgICAgICB7fTtcclxuICAgIEcubWFya3VwT3JBcGlQcm9jZXNzZWQgPSAgICAgIGZhbHNlO1xyXG4gICAgXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8tLS0gR2FsbGVyeSBPYmplY3QgTW9kZWxcclxuICAgIEcuR09NID0ge1xyXG4gICAgICBhbGJ1bUlkeCA6ICAgICAgICAgICAgICAgICAgLTEsIC8vIGluZGV4IChpbiBHLkkpIG9mIHRoZSBjdXJyZW50bHkgZGlzcGxheWVkIGFsYnVtXHJcbiAgICAgIGNsaXBBcmVhIDogICAgICAgICAgICAgICAgICB7IHRvcDogMCwgaGVpZ2h0OiAwIH0sIC8vIGFyZWEgb2YgdGhlIEdPTSB0byBkaXNwbGF5IG9uIHNjcmVlblxyXG4gICAgICBkaXNwbGF5QXJlYSA6ICAgICAgICAgICAgICAgeyB3aWR0aDogMCAsIGhlaWdodDogMCB9LCAvLyBzaXplIG9mIHRoZSBHT00gYXJlYSAoPXVzZWQgYXJlYSwgbm90IGF2YWlsYWJsZSBhcmVhKVxyXG4gICAgICBkaXNwbGF5QXJlYUxhc3QgOiAgICAgICAgICAgeyB3aWR0aDogMCAsIGhlaWdodDogMCB9LCAvLyBwcmV2aW91cyBzaXplIG9mIHRoZSBHT00gYXJlYVxyXG4gICAgICBkaXNwbGF5ZWRNb3JlU3RlcHMgOiAgICAgICAgMCwgIC8vIGN1cnJlbnQgbnVtYmVyIG9mIGRpc3BsYXllZCBzdGVwcyAobW9yZUJ1dHRvbiBtb2RlKVxyXG4gICAgICBpdGVtczogICAgICAgICAgICAgICAgICAgICAgW10sIC8vIGN1cnJlbnQgaXRlbXMgb2YgdGhlIEdPTVNcclxuICAgICAgJGltZ1ByZWxvYWRlcjogICAgICAgICAgICAgIFtdLFxyXG4gICAgICB0aHVtYm5haWxzMkRpc3BsYXk6ICAgICAgICAgW10sXHJcbiAgICAgIGl0ZW1zRGlzcGxheWVkIDogICAgICAgICAgICAwLCAvLyBudW1iZXIgb2YgY3VycmVudGx5IGRpc3BsYXllZCB0aHVtYm5haWxzXHJcbiAgICAgIGZpcnN0RGlzcGxheSA6ICAgICAgICAgICAgICB0cnVlLFxyXG4gICAgICBmaXJzdERpc3BsYXlUaW1lIDogICAgICAgICAgMCwgICAgICAvLyBpbiBjb25qdW5jdGlvbiB3aXRoIGdhbGxlcnlSZW5kZXJEZWxheVxyXG4gICAgICBuYXZpZ2F0aW9uQmFyIDogeyAgICAgICAgICAgLy8gY29udGVudCBvZiB0aGUgbmF2aWdhdGlvbiBiYXIgKGZvciBicmVhZGNydW1iIGFuZCBmaWx0ZXIgdGFncylcclxuICAgICAgICBkaXNwbGF5ZWQ6ICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAkbmV3Q29udGVudDogICAgICAgICAgICAgICcnXHJcbiAgICAgIH0sXHJcbiAgICAgIGNhY2hlIDogeyAgICAgICAgICAgICAgICAgICAvLyBjYWNoZWQgZGF0YVxyXG4gICAgICAgIHZpZXdwb3J0OiAgICAgICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgY29udGFpbmVyT2Zmc2V0OiAgICAgICAgICBudWxsLFxyXG4gICAgICAgIGFyZWFXaWR0aDogICAgICAgICAgICAgICAgMTAwICAgICAgICAgLy8gYXZhaWxhYmxlIGFyZWEgd2lkdGhcclxuICAgICAgfSxcclxuICAgICAgbmJTZWxlY3RlZCA6ICAgICAgICAgICAgICAgIDAsICAgICAgICAvLyBudW1iZXIgb2Ygc2VsZWN0ZWQgaXRlbXNcclxuICAgICAgcGFnaW5hdGlvbiA6ICAgICAgICAgICAgICAgIHsgY3VycmVudFBhZ2U6IDAgfSwgLy8gcGFnaW5hdGlvbiBkYXRhXHJcbiAgICAgIHBhblRocmVzaG9sZDogICAgICAgICAgICAgICA2MCwgICAgICAgLy8gdGhyZXNob2xkIHZhbHVlIChpbiBwaXhlbHMpIHRvIGJsb2NrIGhvcml6b250YWwgcGFuL3N3aXBlXG4gICAgICBwYW5ZT25seTogICAgICAgICAgICAgICAgICAgZmFsc2UsICAgIC8vIHRocmVzaG9sZCB2YWx1ZSByZWFjaCAtPiBkZWZpbml0aXZlbHkgYmxvY2sgaG9yaXpvbnRhbCBwYW4gdW50aWwgZW5kIG9mIHBhblxuICAgICAgbGFzdEZ1bGxSb3cgOiAgICAgICAgICAgICAgIC0xLCAgICAgICAvLyBudW1iZXIgb2YgdGhlIGxhc3Qgcm93IHdpdGhvdXQgaG9sZXNcclxuICAgICAgbGFzdERpc3BsYXllZElkeDogICAgICAgICAgIC0xLCAgICAgICAvLyB1c2VkIHRvIGRpc3BsYXkgdGhlIGNvdW50ZXIgb2Ygbm90IGRpc3BsYXllZCBpdGVtc1xyXG4gICAgICBkaXNwbGF5SW50ZXJ2YWwgOiAgICAgICAgICAgeyBmcm9tOiAwLCBsZW46IDAgfSxcclxuICAgICAgdXNlckV2ZW50czogICAgICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgIGhhbW1lcnRpbWU6ICAgICAgICAgICAgICAgICBudWxsLFxyXG4gICAgICBjdXJOYXZMZXZlbDogICAgICAgICAgICAgICAgJ2wxJywgICAvLyBjdXJyZW50IG5hdmlnYXRpb24gbGV2ZWwgKGwxIG9yIExOKVxyXG4gICAgICBjdXJXaWR0aDogICAgICAgICAgICAgICAgICAgJ21lJyxcclxuICAgICAgYWxidW1TZWFyY2g6ICAgICAgICAgICAgICAgICcnLCAgICAgLy8gY3VycmVudCBzZWFyY2ggc3RyaW5nIC0+IHRpdGxlICh1c2VkIHRvIGZpbHRlciB0aGUgdGh1bWJuYWlscyBvbiBzY3JlZW4pXHJcbiAgICAgIGFsYnVtU2VhcmNoVGFnczogICAgICAgICAgICAnJywgICAgIC8vIGN1cnJlbnQgc2VhcmNoIHN0cmluZyAtPiB0YWdzXHJcbiAgICAgIGxhc3RaSW5kZXg6ICAgICAgICAgICAgICAgICAwLCAgICAgIC8vIHVzZWQgdG8gcHV0IGEgdGh1bWJuYWlsIG9uIHRvcCBvZiBhbGwgb3RoZXJzIChmb3IgZXhlbXBsZSBmb3Igc2NhbGUgaG92ZXIgZWZmZWN0KVxyXG4gICAgICBsYXN0UmFuZG9tVmFsdWU6ICAgICAgICAgICAgMCxcclxuICAgICAgc2xpZGVyIDogeyAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2xpZGVyIG9uIGxhc3QgdGh1bWJuYWlsXHJcbiAgICAgICAgaG9zdElkeDogICAgICAgICAgICAgICAgICAtMSwgICAgICAgLy8gaWR4IG9mIHRoZSB0aHVtYm5haWwgaG9zdGluZyB0aGUgc2xpZGVyXHJcbiAgICAgICAgaG9zdEl0ZW06ICAgICAgICAgICAgICAgICBudWxsLCAgICAgLy8gaXRlbSBob3N0aW5nIHRoZSBzbGlkZXJcclxuICAgICAgICBjdXJyZW50SWR4OiAgICAgICAgICAgICAgIDAsICAgICAgICAvLyBpZHggb2YgdGhlIGN1cnJlbnQgZGlzcGxheWVkIGl0ZW1cclxuICAgICAgICBuZXh0SWR4OiAgICAgICAgICAgICAgICAgIDAsICAgICAgICAvLyBpZHggb2YgdGhlIG5leHQgaXRlbSB0byBkaXNwbGF5IGluIHRoZSBzbGlkZXJcclxuICAgICAgICB0aW1lcklEOiAgICAgICAgICAgICAgICAgIDAsXHJcbiAgICAgICAgdHdlZW46ICAgICAgICAgICAgICAgICAgICBudWxsICAgICAgLy8gdHJhbmlzdGlvbiB0d2VlbiBpbnN0YW5jZVxyXG4gICAgICB9LFxyXG4gICAgICBOR1kySXRlbTogZnVuY3Rpb24oIGlkeCApIHsgICAvLyByZXR1cm5zIGEgTkdZMkl0ZW0gb3IgbnVsbCBpZiBpdCBkb2VzIG5vdCBleGlzdFxyXG4gICAgICAgIGlmKCBHLkdPTS5pdGVtc1tpZHhdID09IHVuZGVmaW5lZCB8fCBHLkdPTS5pdGVtc1tpZHhdID09IG51bGwgKSB7IHJldHVybiBudWxsOyB9XHJcbiAgICAgICAgdmFyIGkgPSBHLkdPTS5pdGVtc1tpZHhdLnRodW1ibmFpbElkeDtcclxuICAgICAgICByZXR1cm4gRy5JW2ldO1xyXG4gICAgICB9LFxyXG4gICAgICAvLyBPbmUgR09NIGl0ZW0gKHRodW1ibmFpbClcclxuICAgICAgLy8gZnVuY3Rpb24gR1RuKGluZGV4LCB3aWR0aCwgaGVpZ2h0KSB7XHJcbiAgICAgIEdUbjogZnVuY3Rpb24oaW5kZXgsIHdpZHRoLCBoZWlnaHQpIHtcclxuICAgICAgICB0aGlzLnRodW1ibmFpbElkeCA9IGluZGV4O1xyXG4gICAgICAgIHRoaXMud2lkdGggPSAgICAgICAgICAgICAgICAwOyAgICAgIC8vIHRodW1ibmFpbCB3aWR0aFxyXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gICAgICAgICAgICAgICAwOyAgICAgIC8vIHRodW1ibmFpbCBoZWlnaHRcclxuICAgICAgICB0aGlzLnRvcCA9ICAgICAgICAgICAgICAgICAgMDsgICAgICAvLyBwb3NpdGlvbjogdG9wXHJcbiAgICAgICAgdGhpcy5sZWZ0ID0gICAgICAgICAgICAgICAgIDA7ICAgICAgLy8gcG9zaXRpb246IGxlZnRcclxuICAgICAgICB0aGlzLnJvdyA9ICAgICAgICAgICAgICAgICAgMDsgICAgICAvLyBwb3NpdGlvbjogcm93IG51bWJlclxyXG4gICAgICAgIHRoaXMuaW1hZ2VXaWR0aCA9ICAgICAgICAgICB3aWR0aDsgIC8vIGltYWdlIHdpZHRoXHJcbiAgICAgICAgdGhpcy5pbWFnZUhlaWdodCA9ICAgICAgICAgIGhlaWdodDsgLy8gaW1hZ2UgaGVpZ2h0XHJcbiAgICAgICAgdGhpcy5yZXNpemVkQ29udGVudFdpZHRoID0gIDA7XHJcbiAgICAgICAgdGhpcy5yZXNpemVkQ29udGVudEhlaWdodCA9IDA7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5ZWQgPSAgICAgICAgICAgIGZhbHNlO1xyXG4gICAgICAgIHRoaXMubmV2ZXJEaXNwbGF5ZWQgPSAgICAgICB0cnVlO1xyXG4gICAgICAgIHRoaXMuaW5EaXNwbGF5QXJlYSA9ICAgICAgICBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgXHJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gICAgLy8tLS0gVmlld2VyIE9iamVjdCBNb2RlbFxyXG4gICAgXHJcbiAgICBHLlZPTSA9IHtcclxuICAgICAgdmlld2VyRGlzcGxheWVkOiAgICAgICAgICAgIGZhbHNlLCAgLy8gaXMgdGhlIHZpZXdlciBjdXJyZW50bHkgZGlzcGxheWVkXHJcbiAgICAgIHZpZXdlcklzRnVsbHNjcmVlbjogICAgICAgICBmYWxzZSwgIC8vIHZpZXdlciBpbiBmdWxsc2NyZWVuIG1vZGVcclxuICAgICAgaW5mb0Rpc3BsYXllZDogICAgICAgICAgICAgIGZhbHNlLCAgLy8gaXMgdGhlIGluZm8gYm94IGRpc3BsYXllZFxyXG4gICAgICB0b29sYmFyc0Rpc3BsYXllZDogICAgICAgICAgdHJ1ZSwgICAvLyB0aGUgdG9vbGJhcnMgYXJlIGRpc3BsYXllZFxyXG4gICAgICB0b29sc0hpZGU6ICAgICAgICAgICAgICAgICAgbnVsbCxcclxuICAgICAgc2F2ZU92ZXJmbG93WDogICAgICAgICAgICAgICd2aXNpYmxlJywgICAgLy8gc3RvcmUgdGhlIHZhbHVlIHRvIHJlc3RvcmUgaXQgYmFjayBhZnRlciB2aWV3ZXIgaXMgY2xvc2VkXHJcbiAgICAgIHNhdmVPdmVyZmxvd1k6ICAgICAgICAgICAgICAndmlzaWJsZScsXHJcbiAgICAgIHpvb20gOiB7XHJcbiAgICAgICAgcG9zWDogICAgICAgICAgICAgICAgICAgICAwLCAgICAgIC8vIHBvc2l0aW9uIHRvIGNlbnRlciB6b29tIGluL291dFxyXG4gICAgICAgIHBvc1k6ICAgICAgICAgICAgICAgICAgICAgMCxcclxuICAgICAgICB1c2VyRmFjdG9yOiAgICAgICAgICAgICAgIDEsICAgICAgLy8gdXNlciB6b29tIGZhY3RvciAoYXBwbGllZCB0byB0aGUgYmFzZVpvb20gZmFjdG9yKVxyXG4gICAgICAgIGlzWm9vbWluZzogICAgICAgICAgICAgICAgZmFsc2VcclxuICAgICAgfSxcbiAgICAgIHBhZGRpbmc6ICAgICAgICAgICAgICAgICAgICB7IEg6IDAsIFY6IDAgfSwgLy8gcGFkZGluZyBmb3IgdGhlIGltYWdlXHJcbiAgICAgIHdpbmRvdzogICAgICAgICAgICAgICAgICAgICB7IGxhc3RXaWR0aDogMCwgbGFzdEhlaWdodDogMCB9LFxyXG4gICAgICAkY29udDogICAgICAgICAgICAgICAgICAgICAgbnVsbCwgICAvLyB2aWV3ZXIgY29udGFpbmVyXHJcbiAgICAgICR2aWV3ZXI6ICAgICAgICAgICAgICAgICAgICBudWxsLFxyXG4gICAgICAkdG9vbGJhcjogICAgICAgICAgICAgICAgICAgbnVsbCwgICAvLyB2aWV3ZXJUb29sYmFyXHJcbiAgICAgICR0b29sYmFyVEw6ICAgICAgICAgICAgICAgICBudWxsLCAgIC8vIHZpZXdlciB0b29sYmFyIG9uIHRvcCBsZWZ0XHJcbiAgICAgICR0b29sYmFyVFI6ICAgICAgICAgICAgICAgICBudWxsLCAgIC8vIHZpZXdlciB0b29sYmFyIG9uIHRvcCByaWdodFxyXG4gICAgICAkY29udGVudDogICAgICAgICAgICAgICAgICAgbnVsbCwgICAvLyB2aWV3ZXIgY29udGVudFxyXG4gICAgICBcclxuICAgICAgJG1lZGlhUHJldmlvdXM6ICAgICAgICAgICAgIG51bGwsICAgLy8gcHJldmlvdXMgaW1hZ2VcclxuICAgICAgJG1lZGlhQ3VycmVudDogICAgICAgICAgICAgIG51bGwsICAgLy8gY3VycmVudCBpbWFnZVxyXG4gICAgICAkbWVkaWFOZXh0OiAgICAgICAgICAgICAgICAgbnVsbCwgICAvLyBuZXh0IGltYWdlXHJcbiAgICAgIHRvb2xiYXJNb2RlOiAgICAgICAgICAgICAgICAnc3RkJywgIC8vIGN1cnJlbnQgdG9vbGJhciBtb2RlIChzdGFuZGFyZCwgbWluaW1pemVkKVxyXG4gICAgICBwbGF5U2xpZGVzaG93IDogICAgICAgICAgICAgZmFsc2UsICAvLyBzbGlkZSBzaG93IG1vZGUgc3RhdHVzXHJcbiAgICAgIHBsYXlTbGlkZXNob3dUaW1lcklEOiAgICAgICAwLCAgICAgIC8vIHNsaWRlc2hvdyBtb2RlIHRpbWVcclxuICAgICAgc2xpZGVzaG93RGVsYXk6ICAgICAgICAgICAgIDMwMDAsICAgLy8gc2xpZGVzaG93IG1vZGUgLSBkZWxheSBiZWZvcmUgbmV4dCBpbWFnZVxyXG4gICAgICBhbGJ1bUlEOiAgICAgICAgICAgICAgICAgICAgLTEsXHJcbiAgICAgIGN1cnJJdGVtSWR4OiAgICAgICAgICAgICAgICAtMSxcclxuICAgICAgdmlld2VyTWVkaWFJc0NoYW5nZWQ6ICAgICAgIGZhbHNlLCAgLy8gbWVkaWEgZGlzcGxheSBpcyBjdXJyZW50bHkgbW9kaWZpZWRcclxuICAgICAgaXRlbXM6ICAgICAgICAgICAgICAgICAgICAgIFtdLCAgICAgLy8gY3VycmVudCBsaXN0IG9mIGltYWdlcyB0byBiZSBtYW5hZ2VkIGJ5IHRoZSB2aWV3ZXJcclxuICAgICAgTkdZMkl0ZW06IGZ1bmN0aW9uKCBuICkgeyAgIC8vIHJldHVybnMgYSBOR1kySXRlbVxyXG4gICAgICAgIHN3aXRjaCggbiApIHtcclxuICAgICAgICAgIGNhc2UgLTE6ICAgLy8gcHJldmlvdXNcclxuICAgICAgICAgICAgdmFyIGlkeD10aGlzLklkeFByZXZpb3VzKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBHLklbdGhpcy5pdGVtc1tpZHhdLm5neTJJdGVtSWR4XTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlIDE6ICAgLy8gbmV4dFxyXG4gICAgICAgICAgICB2YXIgaWR4PXRoaXMuSWR4TmV4dCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gRy5JW3RoaXMuaXRlbXNbaWR4XS5uZ3kySXRlbUlkeF07XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAwOiAgIC8vIGN1cnJlbnRcclxuICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIHJldHVybiBHLklbdGhpcy5pdGVtc1tHLlZPTS5jdXJySXRlbUlkeF0ubmd5Mkl0ZW1JZHhdO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIElkeE5leHQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBuID0gMDtcclxuICAgICAgICBpZiggRy5WT00uY3Vyckl0ZW1JZHggIT0gKEcuVk9NLml0ZW1zLmxlbmd0aC0xKSApIHtcclxuICAgICAgICAgIG4gPSBHLlZPTS5jdXJySXRlbUlkeCArIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuO1xyXG4gICAgICB9LFxyXG4gICAgICBJZHhQcmV2aW91czogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdmFyIG4gPSBHLlZPTS5jdXJySXRlbUlkeCAtIDE7XHJcbiAgICAgICAgaWYoIEcuVk9NLmN1cnJJdGVtSWR4ID09IDAgKSB7XHJcbiAgICAgICAgICBuID0gRy5WT00uaXRlbXMubGVuZ3RoIC0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgIH0sXHJcbiAgICAgIHVzZXJFdmVudHM6ICAgICAgICAgbnVsbCwgICAvLyB1c2VyIGV2ZW50cyBtYW5hZ2VtZW50XHJcbiAgICAgIGhhbW1lcnRpbWU6ICAgICAgICAgbnVsbCwgICAvLyBoYW1tZXIuanMgbWFuYWdlclxyXG4gICAgICBzd2lwZVBvc1g6ICAgICAgICAgIDAsICAgICAgLy8gY3VycmVudCBob3Jpem9udGFsIHN3aXAgcG9zaXRpb25cclxuICAgICAgcGFuUG9zWDogICAgICAgICAgICAwLCAgICAgIC8vIHBvc2l0aW9uIGZvciBtYW51YWwgcGFuXHJcbiAgICAgIHBhblBvc1k6ICAgICAgICAgICAgMCxcbiAgICAgIHBhblRocmVzaG9sZDogICAgICAgNjAsICAgICAvLyB0aHJlc2hvbGQgdmFsdWUgKGluIHBpeGVscykgdG8gYmxvY2sgdmVydGljYWwgcGFuXG4gICAgICBwYW5YT25seTogICAgICAgICAgIGZhbHNlLCAgLy8gdGhyZXNob2xkIHZhbHVlIHJlYWNoIC0+IGRlZmluaXRpdmVseSBibG9jayB2ZXJ0aWNhbCBwYW4gdW50aWwgZW5kIG9mIHBhblxuICAgICAgdmlld2VyVGhlbWU6ICAgICAgICAnJyxcclxuICAgICAgdGltZUltZ0NoYW5nZWQ6ICAgICAwLFxyXG4gICAgICBJbWFnZUxvYWRlcjoge1xyXG4gICAgICAgIC8vIGZpcmVzIGEgY2FsbGJhY2sgd2hlbiBpbWFnZSBzaXplIGlzIGtub3cgKGR1cmluZyBkb3dubG9hZClcclxuICAgICAgICAvLyBpbnNwaXJlZCBieSBST0IgLSBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vdXNlcnMvMjI2NTA3L3JvYlxyXG4gICAgICAgIG1heENoZWNrczogICAgICAgIDEwMDAsXHJcbiAgICAgICAgbGlzdDogICAgICAgICAgICAgW10sXHJcbiAgICAgICAgaW50ZXJ2YWxIYW5kbGUgOiAgbnVsbCxcclxuXHJcbiAgICAgICAgbG9hZEltYWdlIDogZnVuY3Rpb24gKGNhbGxiYWNrLCBuZ2l0ZW0pIHtcclxuICAgICAgICAgIGlmKCBuZ2l0ZW0ubWVkaWFLaW5kICE9ICdpbWcnICkgeyByZXR1cm47IH0gICAgIC8vIGlnbm9yZSAtIG9ubHkgZm9yIGltYWdlc1xyXG4gICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSAoKTtcclxuICAgICAgICAgIGltZy5zcmMgPSBuZ2l0ZW0ucmVzcG9uc2l2ZVVSTCgpO1xyXG4gICAgICAgICAgaWYgKGltZy53aWR0aCAmJiBpbWcuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrIChpbWcud2lkdGgsIGltZy5oZWlnaHQsIG5naXRlbSwgMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgb2JqID0ge2ltYWdlOiBpbWcsIHVybDogbmdpdGVtLnJlc3BvbnNpdmVVUkwoKSwgbmdpdGVtOiBuZ2l0ZW0sIGNhbGxiYWNrOiBjYWxsYmFjaywgY2hlY2tzOiAxfTtcclxuICAgICAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgICAgIGZvciAoaT0wOyBpIDwgdGhpcy5saXN0Lmxlbmd0aDsgaSsrKSAgICB7XHJcbiAgICAgICAgICAgICAgaWYgKHRoaXMubGlzdFtpXSA9PSBudWxsKVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmxpc3RbaV0gPSBvYmo7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pbnRlcnZhbEhhbmRsZSlcclxuICAgICAgICAgICAgICB0aGlzLmludGVydmFsSGFuZGxlID0gc2V0SW50ZXJ2YWwodGhpcy5pbnRlcnZhbCwgNTApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAvLyBjYWxsZWQgYnkgc2V0SW50ZXJ2YWwgIFxyXG4gICAgICAgIGludGVydmFsIDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgdmFyIGNvdW50ID0gMDtcclxuICAgICAgICAgIHZhciBsaXN0ID0gRy5WT00uSW1hZ2VMb2FkZXIubGlzdCwgaXRlbTtcclxuICAgICAgICAgIGZvciAodmFyIGk9MDsgaTxsaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGl0ZW0gPSBsaXN0W2ldO1xyXG4gICAgICAgICAgICBpZiAoaXRlbSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgaWYgKGl0ZW0uaW1hZ2Uud2lkdGggJiYgaXRlbS5pbWFnZS5oZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIEcuVk9NLkltYWdlTG9hZGVyLmxpc3RbaV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5jYWxsYmFjayAoaXRlbS5pbWFnZS53aWR0aCwgaXRlbS5pbWFnZS5oZWlnaHQsIGl0ZW0ubmdpdGVtLCBpdGVtLmNoZWNrcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbS5jaGVja3MgPiBHLlZPTS5JbWFnZUxvYWRlci5tYXhDaGVja3MpIHtcclxuICAgICAgICAgICAgICAgIEcuVk9NLkltYWdlTG9hZGVyLmxpc3RbaV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaXRlbS5jYWxsYmFjayAoMCwgMCwgaXRlbS5uZ2l0ZW0sIGl0ZW0uY2hlY2tzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvdW50Kys7XHJcbiAgICAgICAgICAgICAgICBpdGVtLmNoZWNrcysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgaWYgKGNvdW50ID09IDApIHtcclxuICAgICAgICAgICAgRy5WT00uSW1hZ2VMb2FkZXIubGlzdCA9IFtdO1xyXG4gICAgICAgICAgICBjbGVhckludGVydmFsIChHLlZPTS5JbWFnZUxvYWRlci5pbnRlcnZhbEhhbmRsZSk7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBHLlZPTS5JbWFnZUxvYWRlci5pbnRlcnZhbEhhbmRsZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIE9uZSBWT00gaXRlbSAoaW1hZ2UpXHJcbiAgICBmdW5jdGlvbiBWSW1nKGluZGV4KSB7XHJcbiAgICAgIHRoaXMuJGUgPSBudWxsO1xyXG4gICAgICB0aGlzLm5neTJJdGVtSWR4ID0gaW5kZXg7XHJcbiAgICAgIHRoaXMubWVkaWFOdW1iZXIgPSAwOyAgICAgXHJcbiAgICAgIHRoaXMucG9zWCA9IDA7ICAgIC8vIHRvIGNlbnRlciB0aGUgZWxlbWVudFxyXG4gICAgICB0aGlzLnBvc1kgPSAwO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLy0tLSBwb3B1cFxyXG4gICAgRy5wb3B1cCA9IHtcclxuICAgICAgaXNEaXNwbGF5ZWQ6ICAgICAgZmFsc2UsXHJcbiAgICAgICRlbHQ6ICAgICAgICAgICAgIG51bGwsXHJcbiAgICAgIGNsb3NlOiBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiggdGhpcy4kZWx0ICE9IG51bGwgKSB7XHJcbiAgICAgICAgICB2YXIgdHdlZW5hYmxlID0gbmV3IE5HVHdlZW5hYmxlKCk7XHJcbiAgICAgICAgICB0d2VlbmFibGUudHdlZW4oe1xyXG4gICAgICAgICAgICBmcm9tOiAgICAgICB7IG9wYWNpdHk6MSAgfSxcclxuICAgICAgICAgICAgdG86ICAgICAgICAgeyBvcGFjaXR5OjAgfSxcclxuICAgICAgICAgICAgYXR0YWNobWVudDogeyB0OiB0aGlzIH0sXHJcbiAgICAgICAgICAgIGVhc2luZzogICAgICdlYXNlSW5PdXRTaW5lJyxcclxuICAgICAgICAgICAgZHVyYXRpb246ICAgMTAwLFxyXG4gICAgICAgICAgICBzdGVwOiBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgICAgIGlmKCBhdHQudC4kZWx0ICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgICBhdHQudC4kZWx0LmNzcygnb3BhY2l0eScsc3RhdGUub3BhY2l0eSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaW5pc2g6IGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgaWYoIGF0dC50LiRlbHQgIT0gbnVsbCApIHtcclxuICAgICAgICAgICAgICAgIGF0dC50LiRlbHQucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICBhdHQudC4kZWx0PW51bGw7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGF0dC50LmlzRGlzcGxheWVkPWZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyBDb2xvciBzY2hlbWVzIC0gR2FsbGVyeVxyXG4gICAgLy8gZ2FkcmllbnQgZ2VuZXJhdG9yOiBodHRwczovL3d3dy5ncmFiaWVudC5jb20vXHJcbiAgICBHLmdhbGxlcnlUaGVtZV9kYXJrID0ge1xyXG4gICAgICBuYXZpZ2F0aW9uQmFyIDogICAgICAgICB7IGJhY2tncm91bmQ6ICdub25lJywgYm9yZGVyVG9wOiAnJywgYm9yZGVyQm90dG9tOiAnJywgYm9yZGVyUmlnaHQ6ICcnLCBib3JkZXJMZWZ0OiAnJyB9LFxyXG4gICAgICBuYXZpZ2F0aW9uQnJlYWRjcnVtYiA6ICB7IGJhY2tncm91bmQ6ICcjMTExJywgY29sb3I6ICcjZmZmJywgY29sb3JIb3ZlcjogJyNjY2MnLCBib3JkZXJSYWRpdXM6ICc0cHgnIH0sXHJcbiAgICAgIG5hdmlnYXRpb25GaWx0ZXIgOiAgICAgIHsgY29sb3I6ICcjZGRkJywgYmFja2dyb3VuZDogJyMxMTEnLCBjb2xvclNlbGVjdGVkOiAnI2ZmZicsIGJhY2tncm91bmRTZWxlY3RlZDogJyMxMTEnLCBib3JkZXJSYWRpdXM6ICc0cHgnIH0sXHJcbiAgICAgIHRodW1ibmFpbCA6ICAgICAgICAgICAgIHsgYmFja2dyb3VuZDogJyM0NDQnLCBiYWNrZ3JvdW5kSW1hZ2U6ICdsaW5lYXItZ3JhZGllbnQoMzE1ZGVnLCAjMTExIDAlLCAjNDQ1IDkwJSknLCBib3JkZXJDb2xvcjogJyMwMDAnLCBsYWJlbE9wYWNpdHkgOiAxLCBsYWJlbEJhY2tncm91bmQ6ICdyZ2JhKDM0LCAzNCwgMzQsIDApJywgdGl0bGVDb2xvcjogJyNmZmYnLCB0aXRsZUJnQ29sb3I6ICd0cmFuc3BhcmVudCcsIHRpdGxlU2hhZG93OiAnJywgZGVzY3JpcHRpb25Db2xvcjogJyNjY2MnLCBkZXNjcmlwdGlvbkJnQ29sb3I6ICd0cmFuc3BhcmVudCcsIGRlc2NyaXB0aW9uU2hhZG93OiAnJywgc3RhY2tCYWNrZ3JvdW5kOiAnI2FhYScgfSxcclxuICAgICAgdGh1bWJuYWlsSWNvbiA6ICAgICAgICAgeyBwYWRkaW5nOiAnNXB4JywgY29sb3I6ICcjZmZmJyB9LFxyXG4gICAgICBwYWdpbmF0aW9uIDogICAgICAgICAgICB7IGJhY2tncm91bmQ6ICcjMTgxODE4JywgYmFja2dyb3VuZFNlbGVjdGVkOiAnIzY2NicsIGNvbG9yOiAnI2ZmZicsIGJvcmRlclJhZGl1czogJzJweCcsIHNoYXBlQm9yZGVyOiAnM3B4IHNvbGlkICM2NjYnLCBzaGFwZUNvbG9yOiAnIzQ0NCcsIHNoYXBlU2VsZWN0ZWRDb2xvcjogJyNhYWEnfVxyXG4gICAgfTtcclxuXHJcbiAgICBHLmdhbGxlcnlUaGVtZV9saWdodCA9IHtcclxuICAgICAgbmF2aWdhdGlvbkJhciA6ICAgICAgICAgeyBiYWNrZ3JvdW5kOiAnbm9uZScsIGJvcmRlclRvcDogJycsIGJvcmRlckJvdHRvbTogJycsIGJvcmRlclJpZ2h0OiAnJywgYm9yZGVyTGVmdDogJycgfSxcclxuICAgICAgbmF2aWdhdGlvbkJyZWFkY3J1bWIgOiAgeyBiYWNrZ3JvdW5kOiAnI2VlZScsIGNvbG9yOiAnIzAwMCcsIGNvbG9ySG92ZXI6ICcjMzMzJywgYm9yZGVyUmFkaXVzOiAnNHB4JyB9LFxyXG4gICAgICBuYXZpZ2F0aW9uRmlsdGVyIDogICAgICB7IGJhY2tncm91bmQ6ICcjZWVlJywgY29sb3I6ICcjMjIyJywgY29sb3JTZWxlY3RlZDogJyMwMDAnLCBiYWNrZ3JvdW5kU2VsZWN0ZWQ6ICcjZWVlJywgYm9yZGVyUmFkaXVzOiAnNHB4JyB9LFxyXG4gICAgICB0aHVtYm5haWwgOiAgICAgICAgICAgICB7IGJhY2tncm91bmQ6ICcjNDQ0JywgYmFja2dyb3VuZEltYWdlOiAnbGluZWFyLWdyYWRpZW50KDMxNWRlZywgIzExMSAwJSwgIzQ0NSA5MCUpJywgYm9yZGVyQ29sb3I6ICcjMDAwJywgbGFiZWxPcGFjaXR5IDogMSwgbGFiZWxCYWNrZ3JvdW5kOiAncmdiYSgzNCwgMzQsIDM0LCAwKScsIHRpdGxlQ29sb3I6ICcjZmZmJywgdGl0bGVCZ0NvbG9yOiAndHJhbnNwYXJlbnQnLCB0aXRsZVNoYWRvdzogJycsIGRlc2NyaXB0aW9uQ29sb3I6ICcjY2NjJywgZGVzY3JpcHRpb25CZ0NvbG9yOiAndHJhbnNwYXJlbnQnLCBkZXNjcmlwdGlvblNoYWRvdzogJycsIHN0YWNrQmFja2dyb3VuZDogJyM4ODgnIH0sXHJcbiAgICAgIHRodW1ibmFpbEljb24gOiAgICAgICAgIHsgcGFkZGluZzogJzVweCcsIGNvbG9yOiAnI2ZmZicgfSxcclxuICAgICAgcGFnaW5hdGlvbiA6ICAgICAgICAgICAgeyBiYWNrZ3JvdW5kOiAnI2VlZScsIGJhY2tncm91bmRTZWxlY3RlZDogJyNhYWEnLCBjb2xvcjogJyMwMDAnLCBib3JkZXJSYWRpdXM6ICcycHgnLCBzaGFwZUJvcmRlcjogJzNweCBzb2xpZCAjNjY2Jywgc2hhcGVDb2xvcjogJyM0NDQnLCBzaGFwZVNlbGVjdGVkQ29sb3I6ICcjYWFhJ31cclxuICAgIH07XHJcblxyXG4gICAgLy8gQ29sb3Igc2NoZW1lcyAtIGxpZ2h0Ym94XHJcbiAgICBHLnZpZXdlclRoZW1lX2RhcmsgPSB7XHJcbiAgICAgIGJhY2tncm91bmQ6ICAgICAgICAgICAgICcjMDAwJyxcbiAgICAgIGltYWdlQm9yZGVyOiAgICAgICAgICAgICdub25lJyxcbiAgICAgIGltYWdlQm94U2hhZG93OiAgICAgICAgICdub25lJyxcclxuICAgICAgYmFyQmFja2dyb3VuZDogICAgICAgICAgJ3JnYmEoNCwgNCwgNCwgMC4yKScsXG4gICAgICBiYXJCb3JkZXI6ICAgICAgICAgICAgICAnMHB4IHNvbGlkICMxMTEnLFxuICAgICAgYmFyQ29sb3I6ICAgICAgICAgICAgICAgJyNlZWUnLFxuICAgICAgYmFyRGVzY3JpcHRpb25Db2xvcjogICAgJyNhYWEnXHJcbiAgICB9O1xyXG4gICAgRy52aWV3ZXJUaGVtZV9ib3JkZXIgPSB7XHJcbiAgICAgIGJhY2tncm91bmQ6ICAgICAgICAgICAgICdyZ2JhKDEsIDEsIDEsIDAuNzUpJyxcbiAgICAgIGltYWdlQm9yZGVyOiAgICAgICAgICAgICc0cHggc29saWQgI2Y4ZjhmOCcsXG4gICAgICBpbWFnZUJveFNoYWRvdzogICAgICAgICAnIzg4OCAwcHggMHB4IDIwcHgnLFxyXG4gICAgICBiYXJCYWNrZ3JvdW5kOiAgICAgICAgICAncmdiYSg0LCA0LCA0LCAwLjIpJyxcbiAgICAgIGJhckJvcmRlcjogICAgICAgICAgICAgICcwcHggc29saWQgIzExMScsXG4gICAgICBiYXJDb2xvcjogICAgICAgICAgICAgICAnI2VlZScsXG4gICAgICBiYXJEZXNjcmlwdGlvbkNvbG9yOiAgICAnI2FhYSdcclxuICAgIH07XHJcbiAgICBHLnZpZXdlclRoZW1lX2xpZ2h0ID0ge1xyXG4gICAgICBiYWNrZ3JvdW5kOiAgICAgICAgICAgICAnI2Y4ZjhmOCcsXG4gICAgICBpbWFnZUJvcmRlcjogICAgICAgICAgICAnbm9uZScsXG4gICAgICBpbWFnZUJveFNoYWRvdzogICAgICAgICAnbm9uZScsXHJcbiAgICAgIGJhckJhY2tncm91bmQ6ICAgICAgICAgICdyZ2JhKDQsIDQsIDQsIDAuNyknLFxuICAgICAgYmFyQm9yZGVyOiAgICAgICAgICAgICAgJzBweCBzb2xpZCAjMTExJyxcbiAgICAgIGJhckNvbG9yOiAgICAgICAgICAgICAgICcjZWVlJyxcbiAgICAgIGJhckRlc2NyaXB0aW9uQ29sb3I6ICAgICcjYWFhJ1xyXG4gICAgfTtcclxuXHJcbiAgICAgIFxyXG4gICAgXHJcbiAgICAvLyBzaG9ydGN1dCB3aXRoIEcgY29udGV4dCB0byBOR1kyVE9PTFNcclxuICAgIC8vIHZhciBOYW5vQWxlcnQgPSAgICAgICAgICAgTkdZMlRvb2xzLk5hbm9BbGVydC5iaW5kKEcpO1xyXG4gICAgLy8gdmFyIE5hbm9Db25zb2xlTG9nID0gICAgICBOR1kyVG9vbHMuTmFub0NvbnNvbGVMb2cuYmluZChHKTtcclxuICAgIHZhciBOYW5vQWxlcnQgPSAgICAgICAgICAgTkdZMlRvb2xzLk5hbm9BbGVydDtcclxuICAgIHZhciBOYW5vQ29uc29sZUxvZyA9ICAgICAgTkdZMlRvb2xzLk5hbm9Db25zb2xlTG9nO1xyXG5cclxuICAgIFxyXG4gICAgLyoqIEBmdW5jdGlvbiBpbml0aWF0ZUdhbGxlcnkyICovXHJcbiAgICB0aGlzLmluaXRpYXRlR2FsbGVyeTIgPSBmdW5jdGlvbiggZWxlbWVudCwgcGFyYW1zICkge1xyXG5cclxuICAgICAgLy8gR0xPQkFMIE9QVElPTlNcclxuICAgICAgRy5PID0gICAgICAgICAgICAgICBwYXJhbXM7XHJcbiAgICAgIC8vIEJhc2UgZWxlbWVudFxyXG4gICAgICBHLiRFLmJhc2UgPSAgICAgICAgIGpRdWVyeShlbGVtZW50KTtcclxuICAgICAgRy5iYXNlRWx0SUQgPSAgICAgICBHLiRFLmJhc2UuYXR0cignaWQnKTtcclxuICAgICAgaWYoIEcuYmFzZUVsdElEID09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAvLyBzZXQgYSBkZWZhdWx0IElEIHRvIHRoZSByb290IGNvbnRhaW5lclxyXG4gICAgICAgIEcuYmFzZUVsdElEPSdteV9uYW5vZ2FsbGVyeSc7XHJcbiAgICAgICAgRy4kRS5iYXNlLmF0dHIoJ2lkJywgRy5iYXNlRWx0SUQpXHJcbiAgICAgIH1cclxuICAgICAgRy5PLiRtYXJrdXAgPSAgICAgICBbXTtcclxuICAgICAgRGVmaW5lVmFyaWFibGVzKCk7XHJcbiAgICAgIFNldFBvbHlGaWxscygpO1xyXG4gICAgICBCdWlsZFNrZWxldG9uKCk7XHJcbiAgICAgIEcuR09NLmZpcnN0RGlzcGxheVRpbWU9RGF0ZS5ub3coKTtcclxuICAgICAgXHJcbiAgICAgIFNldEdsb2JhbEV2ZW50cygpO1xyXG5cclxuICAgICAgLy8gY2hlY2sgaWYgb25seSBvbmUgc3BlY2lmaWMgYWxidW0gd2lsbCBiZSB1c2VkXHJcbiAgICAgIHZhciBhbGJ1bVRvRGlzcGxheSA9IEcuTy5hbGJ1bTtcclxuICAgICAgaWYoIGFsYnVtVG9EaXNwbGF5ID09ICcnICYmIEcuTy5waG90b3NldCAhPSAnJyApIHtcclxuICAgICAgICBhbGJ1bVRvRGlzcGxheSA9IEcuTy5waG90b3NldDtcclxuICAgICAgICBHLk8uYWxidW0gPSBHLk8ucGhvdG9zZXQ7XHJcbiAgICAgIH1cclxuICAgICAgaWYoIGFsYnVtVG9EaXNwbGF5ICE9ICcnICkge1xyXG4gICAgICAgIEcuTy5kaXNwbGF5QnJlYWRjcnVtYiA9IGZhbHNlOyAgICAvLyBubyBicmVhZGNydW1iIHNpbmNlIG9ubHkgMSBhbGJ1bVxyXG4gICAgICAgIGlmKCBhbGJ1bVRvRGlzcGxheS50b1VwcGVyQ2FzZSgpICE9ICdOT05FJyApIHtcclxuICAgICAgICAgIC8vIG9wZW4gc3BlY2lmaWMgYWxidW1cclxuICAgICAgICBcclxuICAgICAgICAgIHZhciBwPWFsYnVtVG9EaXNwbGF5LmluZGV4T2YoJyZhdXRoa2V5PScpO1xyXG4gICAgICAgICAgaWYoIHAgPT0gLTEgKSB7XHJcbiAgICAgICAgICAgIHA9YWxidW1Ub0Rpc3BsYXkuaW5kZXhPZignP2F1dGhrZXk9Jyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiggcCA+IDAgKSB7XHJcbiAgICAgICAgICAgIC8vIHByaXZhdCBhbGJ1bSB3aXRoIGF1dGhrZXlcclxuICAgICAgICAgICAgRy5PLmxvY2F0aW9uSGFzaD1mYWxzZTsgICAvLyBkaXNhYmxlIGhhc2ggbG9jYXRpb24gZm9yIGhpZGRlbi9wcml2YXQgYWxidW1zIC0tPiBpbXBvc3NpYmxlIHRvIGhhbmRsZVxyXG4gICAgICAgICAgICB2YXIgYWxidW1JRD1hbGJ1bVRvRGlzcGxheS5zdWJzdHJpbmcoMCxwKTtcclxuICAgICAgICAgICAgdmFyIG9wdD1hbGJ1bVRvRGlzcGxheS5zdWJzdHJpbmcocCk7XHJcbiAgICAgICAgICAgIGlmKCBvcHQuaW5kZXhPZignR3Yxc1JnJykgPT0gLTEgKSB7XHJcbiAgICAgICAgICAgICAgb3B0ID0gJyZhdXRoa2V5PUd2MXNSZycrb3B0LnN1YnN0cmluZyg5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbmV3SXRlbSA9IE5HWTJJdGVtLk5ldyggRywgJycsICcnLCBhbGJ1bUlELCAnLTEnLCAnYWxidW0nICk7XHJcbiAgICAgICAgICAgIG5ld0l0ZW0uYXV0aGtleSA9IG9wdDtcclxuICAgICAgICAgICAgRGlzcGxheUFsYnVtKCctMScsIGFsYnVtSUQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIG9wZW4gYSBwdWJsaWMgYWxidW1cclxuICAgICAgICAgICAgaWYoIEcuTy5raW5kID09IFwibmFub19waG90b3NfcHJvdmlkZXIyXCIpIHtcclxuICAgICAgICAgICAgICBpZiggYWxidW1Ub0Rpc3BsYXkgPT0gZGVjb2RlVVJJQ29tcG9uZW50KGFsYnVtVG9EaXNwbGF5KSkge1xyXG4gICAgICAgICAgICAgICAgLy8gYWxidW0gSUQgbXVzdCBiZSBlbmNvZGVkXHJcbiAgICAgICAgICAgICAgICBhbGJ1bVRvRGlzcGxheSA9IGVuY29kZVVSSUNvbXBvbmVudChhbGJ1bVRvRGlzcGxheSk7XHJcbiAgICAgICAgICAgICAgICBHLk8uYWxidW0gPSBhbGJ1bVRvRGlzcGxheTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgTkdZMkl0ZW0uTmV3KCBHLCAnJywgJycsIGFsYnVtVG9EaXNwbGF5LCAnLTEnLCAnYWxidW0nICk7XHJcbiAgICAgICAgICAgIGlmKCAhUHJvY2Vzc0xvY2F0aW9uSGFzaCgpICkge1xyXG4gICAgICAgICAgICAgIERpc3BsYXlBbGJ1bSgnLTEnLCBhbGJ1bVRvRGlzcGxheSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIHVzZSBmdWxsIGNvbnRlbnRcclxuICAgICAgLy8gYWRkIGJhc2UgYWxidW1cclxuICAgICAgTkdZMkl0ZW0uTmV3KCBHLCBHLmkxOG5UcmFuc2xhdGlvbnMuYnJlYWRjcnVtYkhvbWUsICcnLCAnMCcsICctMScsICdhbGJ1bScgKTtcclxuXHJcbiAgICAgIHByb2Nlc3NTdGFydE9wdGlvbnMoKTtcclxuXHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKiBAZnVuY3Rpb24gcHJvY2Vzc1N0YXJ0T3B0aW9ucyAqL1xyXG4gICAgZnVuY3Rpb24gcHJvY2Vzc1N0YXJ0T3B0aW9ucygpIHtcclxuICAgICAgLy8gb3BlbiBpbWFnZSBvciBhbGJ1bVxyXG4gICAgICAvLyAxLiBsb2FkIGhpZGRlbiBhbGJ1bXNcclxuICAgICAgLy8gMi4gY2hlY2sgaWYgbG9jYXRpb24gaGFzaCBzZXQgKGRlZXAgbGlua2luZylcclxuICAgICAgLy8gMy4gY2hlY2sgb3Blbk9uU3RhcnQgcGFyYW1ldGVyXHJcbiAgICAgIC8vIDQuIG9wZW4gcm9vdCBhbGJ1bSAoSUQ9LTEpXHJcblxyXG4gICAgICAvLyBoaWRkZW4vcHJpdmF0ZSBhbGJ1bXMgYXJlIGxvYWRlZCBvbiBwbHVnaW4gc3RhcnQgKFBpY2FzYSkgLS0+IG5vIG1vcmUgYXZhaWxhYmxlIGluIEdvb2dsZSBQaG90b3NcclxuICAgICAgLy8gaWYoIEcuYWxidW1MaXN0SGlkZGVuLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgIC8vICBqUXVlcnkubmFub2dhbGxlcnkyWydkYXRhXycrRy5PLmtpbmRdKEcsICdHZXRIaWRkZW5BbGJ1bXMnLCBHLmFsYnVtTGlzdEhpZGRlbiwgcHJvY2Vzc1N0YXJ0T3B0aW9uc1BhcnQyKTtcclxuICAgICAgLy8gIHJldHVybjtcclxuICAgICAgLy99XHJcbiAgICAgIFxyXG4gICAgICBpZiggIVByb2Nlc3NMb2NhdGlvbkhhc2goKSApIHtcclxuICAgICAgICBwcm9jZXNzU3RhcnRPcHRpb25zUGFydDIoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8qKiBAZnVuY3Rpb24gcHJvY2Vzc1N0YXJ0T3B0aW9uc1BhcnQyICovXHJcbiAgICBmdW5jdGlvbiBwcm9jZXNzU3RhcnRPcHRpb25zUGFydDIoKSB7XHJcbiAgXHJcbiAgICAgIC8vIENoZWNrIGxvY2F0aW9uIGhhc2ggKyBzdGFydCBwYXJhbWV0ZXJzIC0+IGRldGVybWluZSB3aGF0IHRvIGRvIG9uIHN0YXJ0XHJcbiAgICAgIC8vIG9wZW5PblN0YXJ0IHBhcmFtZXRlclxyXG4gICAgICBpZiggRy5PLm9wZW5PblN0YXJ0ICE9ICcnICkge1xyXG4gICAgICAgIHZhciBJRHMgPSBwYXJzZUlEcyhHLk8ub3Blbk9uU3RhcnQpO1xyXG4gICAgICAgIGlmKCBJRHMuaW1hZ2VJRCAhPSAnMCcgKSB7XHJcbiAgICAgICAgICBEaXNwbGF5UGhvdG8oSURzLmltYWdlSUQsIElEcy5hbGJ1bUlEKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBEaXNwbGF5QWxidW0oJy0xJywgSURzLmFsYnVtSUQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyBvcGVuIHJvb3QgYWxidW0gKElEID0gLTEpXHJcbiAgICAgICAgRGlzcGxheUFsYnVtKCctMScsIDApO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFBhcnNlIHN0cmluZyB0byBleHRyYWN0IGFsYnVtSUQgYW5kIGltYWdlSUQgKGZvcm1hdCBhbGJ1bUlEL2ltYWdlSUQpXHJcbiAgICBmdW5jdGlvbiBwYXJzZUlEcyggSURzICkge1xyXG4gICAgICB2YXIgcj17IGFsYnVtSUQ6ICcwJywgaW1hZ2VJRDogJzAnIH07XHJcbiAgICAgIFxyXG4gICAgICB2YXIgdD1JRHMuc3BsaXQoJy8nKTtcclxuICAgICAgaWYoIHQubGVuZ3RoID4gMCApIHtcclxuICAgICAgICByLmFsYnVtSUQgPSB0WzBdO1xyXG4gICAgICAgIGlmKCB0Lmxlbmd0aCA+IDEgKSB7XHJcbiAgICAgICAgICByLmltYWdlSUQgPSB0WzFdO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcjtcclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIC8qKiBAZnVuY3Rpb24gRGlzcGxheUFsYnVtICovXHJcbiAgICBmdW5jdGlvbiBEaXNwbGF5QWxidW0oIGltYWdlSUQsIGFsYnVtSUQgKSB7XHJcbiAgICAgIC8vIGNsb3NlIHZpZXdlciBpZiBhbHJlYWR5IGRpc3BsYXllZFxyXG4gICAgICBpZiggRy5WT00udmlld2VyRGlzcGxheWVkICkge1xyXG4gICAgICAgIENsb3NlSW50ZXJuYWxWaWV3ZXIobnVsbCk7XHJcbiAgICAgIH1cclxuICAgIFxyXG4gICAgICAvLyBzZXQgY3VycmVudCBuYXZpZ2F0aW9uIGxldmVsIChsMSBvciBsTilcclxuICAgICAgdmFyIGFsYnVtSWR4ID0gTkdZMkl0ZW0uR2V0SWR4KEcsIGFsYnVtSUQpO1xyXG4gICAgICBHLkdPTS5jdXJOYXZMZXZlbCA9ICdsTic7XHJcbiAgICAgIGlmKCBhbGJ1bUlkeCA9PSAwICkge1xyXG4gICAgICAgIEcuR09NLmN1ck5hdkxldmVsID0gJ2wxJztcclxuICAgICAgfVxyXG4gICAgICBHLmxheW91dC5TZXRFbmdpbmUoKTtcclxuICAgICAgRy5nYWxsZXJ5UmVzaXplRXZlbnRFbmFibGVkID0gZmFsc2U7XHJcblxyXG4gICAgICBpZiggYWxidW1JZHggPT0gLTEgKSB7XHJcbiAgICAgICAgTkdZMkl0ZW0uTmV3KCBHLCAnJywgJycsIGFsYnVtSUQsICcwJywgJ2FsYnVtJyApOyAgICAvLyBjcmVhdGUgZW1wdHkgYWxidW1cclxuICAgICAgICBhbGJ1bUlkeCA9IEcuSS5sZW5ndGggLSAxO1xyXG4gICAgICB9XHJcbiAgICBcclxuICAgICAgaWYoICFHLklbYWxidW1JZHhdLmNvbnRlbnRJc0xvYWRlZCApIHtcclxuICAgICAgICAvLyBnZXQgY29udGVudCBvZiB0aGUgYWxidW0gaWYgbm90IGFscmVhZHkgbG9hZGVkXHJcbiAgICAgICAgQWxidW1HZXRDb250ZW50KCBhbGJ1bUlELCBEaXNwbGF5QWxidW0sIGltYWdlSUQsIGFsYnVtSUQgKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgIFxyXG4gICAgICBUaHVtYm5haWxTZWxlY3Rpb25DbGVhcigpO1xyXG4gICAgXHJcbiAgICAgIEcuR09NLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgPSAwO1xyXG4gICAgICBTZXRMb2NhdGlvbkhhc2goIGFsYnVtSUQsICcnICk7XHJcbiAgICAgIEdhbGxlcnlSZW5kZXIoIGFsYnVtSWR4ICk7XHJcbiAgICBcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8tLS0tLSBtYW5hZ2UgdGhlIGJvdHRvbSBhcmVhIG9mIHRoZSBnYWxsZXJ5IC0+IFwicGFnaW5hdGlvblwiIG9yIFwibW9yZSBidXR0b25cIlxyXG4gICAgZnVuY3Rpb24gR2FsbGVyeUJvdHRvbU1hbmFnZSgpIHtcclxuXHJcbiAgICAgIHN3aXRjaCggRy5nYWxsZXJ5RGlzcGxheU1vZGUuR2V0KCkgKSB7XHJcbiAgICAgICAgY2FzZSAnUEFHSU5BVElPTic6XHJcbiAgICAgICAgICBpZiggRy5sYXlvdXQuc3VwcG9ydC5yb3dzICYmIEcuZ2FsbGVyeU1heFJvd3MuR2V0KCkgPiAwICkge1xyXG4gICAgICAgICAgICBNYW5hZ2VQYWdpbmF0aW9uKCBHLkdPTS5hbGJ1bUlkeCApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnTU9SRUJVVFRPTic6XHJcbiAgICAgICAgICBHLiRFLmNvblRuQm90dG9tLm9mZignY2xpY2snKTtcclxuICAgICAgICAgIHZhciBuYiA9IEcuR09NLml0ZW1zLmxlbmd0aC1HLkdPTS5pdGVtc0Rpc3BsYXllZDtcclxuICAgICAgICAgIGlmKCBuYiA9PSAwICkge1xyXG4gICAgICAgICAgICBHLiRFLmNvblRuQm90dG9tLmVtcHR5KCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgRy4kRS5jb25UbkJvdHRvbS5odG1sKCc8ZGl2IGNsYXNzPVwibkdZMkdhbGxlcnlNb3JlQnV0dG9uXCI+PGRpdiBjbGFzcz1cIm5HWTJHYWxsZXJ5TW9yZUJ1dHRvbkFubm90YXRpb25cIj4rJytuYisnICcgKyBHLk8uaWNvbnMuZ2FsbGVyeU1vcmVCdXR0b24gKyc8L2Rpdj48L2Rpdj4nKTtcclxuICAgICAgICAgICAgRy4kRS5jb25UbkJvdHRvbS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgICAgRy5HT00uZGlzcGxheWVkTW9yZVN0ZXBzKys7XHJcbiAgICAgICAgICAgICAgR2FsbGVyeVJlc2l6ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0ZVTExDT05URU5UJzpcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyBhZGQgb25lIGFsYnVtL2ZvbGRlciB0byB0aGUgYnJlYWRjcnVtYlxyXG4gICAgZnVuY3Rpb24gYnJlYWRjcnVtYkFkZCggYWxidW1JZHggKSB7XHJcblxyXG4gICAgICB2YXIgaWM9Jyc7XHJcbiAgICAgIGlmKCAhRy5PLmJyZWFkY3J1bWJIaWRlSWNvbnMgKSB7XHJcbiAgICAgICAgaWM9Ry5PLmljb25zLmJyZWFkY3J1bWJBbGJ1bTtcclxuICAgICAgICBpZiggYWxidW1JZHggPT0gMCApIHtcclxuICAgICAgICAgIGljPUcuTy5pY29ucy5icmVhZGNydW1iSG9tZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgdmFyICRuZXdEaXYgPWpRdWVyeSgnPGRpdiBjbGFzcz1cIm9uZUl0ZW1cIj4nK2ljICsgRy5JW2FsYnVtSWR4XS50aXRsZSsnPC9kaXY+JykuYXBwZW5kVG8oRy5HT00ubmF2aWdhdGlvbkJhci4kbmV3Q29udGVudC5maW5kKCcubkdZMkJyZWFkY3J1bWInKSk7XHJcbiAgICAgIGlmKCBHLk8uYnJlYWRjcnVtYk9ubHlDdXJyZW50TGV2ZWwgKSB7XHJcbiAgICAgICAgLy8gbGluayB0byBwYXJlbnQgZm9sZGVyIChvbmx5IDEgbGV2ZWwgaXMgZGlzcGxheWVkIGluIHRoZSBicmVhZGNydW1iKVxyXG4gICAgICAgIGlmKCBhbGJ1bUlkeCA9PSAwICkge1xyXG4gICAgICAgICAgLy8gbm8gcGFyZW50IGxldmVsIC0+IHN0YXkgb24gY3VycmVudCBvbmVcclxuICAgICAgICAgIGpRdWVyeSgkbmV3RGl2KS5kYXRhKCdhbGJ1bUlEJywnMCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGpRdWVyeSgkbmV3RGl2KS5kYXRhKCdhbGJ1bUlEJyxHLklbYWxidW1JZHhdLmFsYnVtSUQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyBsaW5rIHRvIGN1cnJlbnQgZm9sZGVyXHJcbiAgICAgICAgalF1ZXJ5KCRuZXdEaXYpLmRhdGEoJ2FsYnVtSUQnLEcuSVthbGJ1bUlkeF0uR2V0SUQoKSk7XHJcbiAgICAgIH1cclxuICAgICAgJG5ld0Rpdi5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY0FsYnVtSUQ9alF1ZXJ5KHRoaXMpLmRhdGEoJ2FsYnVtSUQnKTtcclxuICAgICAgICBEaXNwbGF5QWxidW0oJy0xJywgY0FsYnVtSUQpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYWRkIG9uZSBzZXBhcmF0b3IgdG8gYnJlYWRjcnVtYlxyXG4gICAgZnVuY3Rpb24gYnJlYWRjcnVtYkFkZFNlcGFyYXRvciggbGFzdEFsYnVtSUQgKSB7XHJcbiAgICAgIHZhciAkbmV3U2VwPWpRdWVyeSgnPGRpdiBjbGFzcz1cIm9uZUl0ZW1cIj4nKyhHLk8uUlRMID8gRy5PLmljb25zLmJyZWFkY3J1bWJTZXBhcmF0b3JSdGwgOiBHLk8uaWNvbnMuYnJlYWRjcnVtYlNlcGFyYXRvcikrJzwvZGl2PicpLmFwcGVuZFRvKEcuR09NLm5hdmlnYXRpb25CYXIuJG5ld0NvbnRlbnQuZmluZCgnLm5HWTJCcmVhZGNydW1iJykpO1xyXG4gICAgICBqUXVlcnkoJG5ld1NlcCkuZGF0YSgnYWxidW1JZHgnLGxhc3RBbGJ1bUlEKTtcclxuICAgICAgJG5ld1NlcC5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgc2VwQWxidW1JZHg9alF1ZXJ5KHRoaXMpLmRhdGEoJ2FsYnVtSWR4Jyk7XHJcbiAgICAgICAgRGlzcGxheUFsYnVtKCctMScsIEcuSVtzZXBBbGJ1bUlkeF0uR2V0SUQoKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIFxyXG4gICAgLy8gTWFuYWdlIHRoZSBnYWxsZXJ5IHRvb2xiYXIgKGJyZWFkY3J1bWIgKyB0YWcgZmlsdGVyKVxyXG4gICAgZnVuY3Rpb24gR2FsbGVyeU5hdmlnYXRpb25CYXIoIGFsYnVtSWR4ICkge1xyXG5cclxuICAgICAgLy8gVGl0bGUgKyBiYWNrZ3JvdW5kIGltYWdlXHJcbiAgICAgIC8vIHZhciBiZ0ltYWdlPScnO1xyXG4gICAgICAvLyB2YXIgbD1HLkkubGVuZ3RoO1xyXG4gICAgICAvLyB2YXIgYWxidW1JRCA9IEcuSVthbGJ1bUlkeF0uR2V0SUQoKTtcclxuICAgICAgLy8gZm9yKCB2YXIgaWR4PTA7IGlkeDxsIDsgaWR4KyspIHtcclxuICAgICAgICAvLyB2YXIgaXRlbT1HLklbaWR4XTtcclxuICAgICAgICAvLyBpZiggaXRlbS5raW5kID09ICdpbWFnZScgJiYgaXRlbS5pc1RvRGlzcGxheShhbGJ1bUlEKSApIHtcclxuICAgICAgICAgIC8vIGJnSW1hZ2U9JzxkaXYgaWQ9XCJwaXBvXCIgY2xhc3M9XCJwaXBvXCIgc3R5bGU9XCJoZWlnaHQ6IDE1MHB4OyB3aWR0aDoxMDAlOyBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoXCInICsgaXRlbS5yZXNwb25zaXZlVVJMKCkgKyAnXCIpOyBiYWNrZ3JvdW5kLXNpemU6IGNvdmVyOyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOyBmaWx0ZXI6Ymx1cigycHgpXCI+cGlwbzwvZGl2Pic7XHJcbiAgICAgICAgICAvLyBicmVhaztcclxuICAgICAgICAvLyB9XHJcbiAgICAgIC8vIH1cclxuXHJcbiAgICAgIC8vY29uc29sZS5sb2coYmdJbWFnZSk7XHJcbiAgICBcclxuICAgICAgLy8gbmV3IG5hdmlnYXRpb24gYmFyIGl0ZW1zIGFyZSBub3QgYnVpbGQgaW4gdGhlIERPTSwgYnV0IGluIG1lbW9yeVxyXG4gICAgICBHLkdPTS5uYXZpZ2F0aW9uQmFyLiRuZXdDb250ZW50PWpRdWVyeSgnPGRpdiBjbGFzcz1cIm5HWTJOYXZpZ2F0aW9uYmFyXCI+PC9kaXY+Jyk7XHJcbiAgICAgIC8vRy5HT00ubmF2aWdhdGlvbkJhci4kbmV3Q29udGVudCA9IGpRdWVyeShiZ0ltYWdlICk7XHJcbiAgICAgIC8vY29uc29sZS5sb2coRy5HT00ubmF2aWdhdGlvbkJhci4kbmV3Q29udGVudCk7XHJcblxyXG4gICAgICAvLy0tIG1hbmFnZSBicmVhZGNydW1iXHJcbiAgICAgIGlmKCBHLk8uZGlzcGxheUJyZWFkY3J1bWIgPT0gdHJ1ZSAmJiAhRy5PLnRodW1ibmFpbEFsYnVtRGlzcGxheUltYWdlKSB7XHJcbiAgICAgICAgLy8gcmV0cmlldmUgbmV3IGZvbGRlciBsZXZlbFxyXG4gICAgICAgIHZhciBuZXdMZXZlbCA9IDAsXHJcbiAgICAgICAgbHN0SXRlbXM9W107XHJcbiAgICAgICAgaWYoIGFsYnVtSWR4ICE9IDAgKSB7XHJcbiAgICAgICAgICB2YXIgbD1HLkkubGVuZ3RoLFxyXG4gICAgICAgICAgcGFyZW50SUQ9MDtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgbHN0SXRlbXMucHVzaChhbGJ1bUlkeCk7XHJcbiAgICAgICAgICB2YXIgY3VySWR4PWFsYnVtSWR4O1xyXG4gICAgICAgICAgbmV3TGV2ZWwrKztcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgd2hpbGUoIEcuSVtjdXJJZHhdLmFsYnVtSUQgIT0gMCAmJiBHLklbY3VySWR4XS5hbGJ1bUlEICE9IC0xKSB7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaT0xOyBpIDwgbDsgaSsrICkge1xyXG4gICAgICAgICAgICAgIGlmKCBHLklbaV0uR2V0SUQoKSA9PSBHLklbY3VySWR4XS5hbGJ1bUlEICkge1xyXG4gICAgICAgICAgICAgICAgY3VySWR4PWk7XHJcbiAgICAgICAgICAgICAgICBsc3RJdGVtcy5wdXNoKGN1cklkeCk7XHJcbiAgICAgICAgICAgICAgICBuZXdMZXZlbCsrO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGJ1aWxkIGJyZWFkY3J1bWJcclxuICAgICAgICBpZiggIShHLk8uYnJlYWRjcnVtYkF1dG9IaWRlVG9wTGV2ZWwgJiYgbmV3TGV2ZWwgPT0gMCkgKSB7XHJcbiAgICAgICAgICBCcmVhZGNydW1iQnVpbGQoIGxzdEl0ZW1zICk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBcclxuICAgICAgLy8tLSBtYW5hZ2UgYW5kIGJ1aWxkIHRhZyBmaWx0ZXJzXHJcbiAgICAgIGlmKCBHLmdhbGxlcnlGaWx0ZXJUYWdzLkdldCgpICE9IGZhbHNlICkge1xyXG4gICAgICAgIHZhciBuVGFncz1HLklbYWxidW1JZHhdLmFsYnVtVGFnTGlzdC5sZW5ndGg7XHJcbiAgICAgICAgaWYoIG5UYWdzID4gMCApIHtcclxuICAgICAgICAgIGZvcih2YXIgaT0wOyBpIDwgblRhZ3M7IGkrKyApIHtcclxuICAgICAgICAgICAgdmFyIHM9Ry5JW2FsYnVtSWR4XS5hbGJ1bVRhZ0xpc3RbaV07XHJcbiAgICAgICAgICAgIHZhciBpYz1HLk8uaWNvbnMubmF2aWdhdGlvbkZpbHRlclVuc2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgIHZhciB0YWdDbGFzcz0nVW5zZWxlY3RlZCc7XHJcbiAgICAgICAgICAgIGlmKCBqUXVlcnkuaW5BcnJheShzLCBHLklbYWxidW1JZHhdLmFsYnVtVGFnTGlzdFNlbCkgPj0gMCApIHtcclxuICAgICAgICAgICAgICB0YWdDbGFzcz0nU2VsZWN0ZWQnO1xyXG4gICAgICAgICAgICAgIGljPUcuTy5pY29ucy5uYXZpZ2F0aW9uRmlsdGVyU2VsZWN0ZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyICRuZXdUYWc9alF1ZXJ5KCc8ZGl2IGNsYXNzPVwibkdZMk5hdmlnYXRpb25iYXJJdGVtIG5HWTJOYXZGaWx0ZXInK3RhZ0NsYXNzKydcIj4nK2ljKycgJytzKyc8L2Rpdj4nKS5hcHBlbmRUbyhHLkdPTS5uYXZpZ2F0aW9uQmFyLiRuZXdDb250ZW50KTtcclxuICAgICAgICAgICAgJG5ld1RhZy5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICB2YXIgJHRoaXM9alF1ZXJ5KHRoaXMpO1xyXG4gICAgICAgICAgICAgIHZhciB0YWc9JHRoaXMudGV4dCgpLnJlcGxhY2UoL15cXHMqfFxccyokLywgJycpOyAgLy90cmltIHRyYWlsaW5nL2xlYWRpbmcgd2hpdGVzcGFjZVxyXG4gICAgICAgICAgICAgIC8vIGlmKCAkdGhpcy5oYXNDbGFzcygnb25lVGFnVW5zZWxlY3RlZCcpICl7XHJcbiAgICAgICAgICAgICAgaWYoICR0aGlzLmhhc0NsYXNzKCduR1kyTmF2RmlsdGVyVW5zZWxlY3RlZCcpICl7XHJcbiAgICAgICAgICAgICAgICBHLklbYWxidW1JZHhdLmFsYnVtVGFnTGlzdFNlbC5wdXNoKHRhZyk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRpZHg9alF1ZXJ5LmluQXJyYXkodGFnLEcuSVthbGJ1bUlkeF0uYWxidW1UYWdMaXN0U2VsKTtcclxuICAgICAgICAgICAgICAgIGlmKCB0aWR4ICE9IC0xICkge1xyXG4gICAgICAgICAgICAgICAgICBHLklbYWxidW1JZHhdLmFsYnVtVGFnTGlzdFNlbC5zcGxpY2UodGlkeCwxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgJHRoaXMudG9nZ2xlQ2xhc3MoJ25HWTJOYXZGaWx0ZXJzLW9uZVRhZ1Vuc2VsZWN0ZWQgbkdZMk5hdkZpbHRlcnMtb25lVGFnU2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICBEaXNwbGF5QWxidW0oJy0xJywgRy5JW2FsYnVtSWR4XS5HZXRJRCgpKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB2YXIgJG5ld0NsZWFyRmlsdGVyPWpRdWVyeSgnPGRpdiBjbGFzcz1cIm5HWTJOYXZpZ2F0aW9uYmFySXRlbSBuR1kyTmF2RmlsdGVyU2VsZWN0QWxsXCI+JytHLk8uaWNvbnMubmF2aWdhdGlvbkZpbHRlclNlbGVjdGVkQWxsKyc8L2Rpdj4nKS5hcHBlbmRUbyhHLkdPTS5uYXZpZ2F0aW9uQmFyLiRuZXdDb250ZW50KTtcclxuICAgICAgICAgICRuZXdDbGVhckZpbHRlci5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIG5UYWdzPUcuSVthbGJ1bUlkeF0uYWxidW1UYWdMaXN0Lmxlbmd0aDtcclxuICAgICAgICAgICAgRy5JW2FsYnVtSWR4XS5hbGJ1bVRhZ0xpc3RTZWw9W107XHJcbiAgICAgICAgICAgIGZvcih2YXIgaT0wOyBpIDxuVGFnczsgaSsrICkge1xyXG4gICAgICAgICAgICAgIHZhciBzPUcuSVthbGJ1bUlkeF0uYWxidW1UYWdMaXN0W2ldO1xyXG4gICAgICAgICAgICAgIEcuSVthbGJ1bUlkeF0uYWxidW1UYWdMaXN0U2VsLnB1c2gocyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgRGlzcGxheUFsYnVtKCctMScsIEcuSVthbGJ1bUlkeF0uR2V0SUQoKSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIEJyZWFkY3J1bWJCdWlsZChsc3RJdGVtcykge1xyXG5cclxuICAgIC8vIGNvbnNvbGUubG9nKEcuR09NLm5hdmlnYXRpb25CYXIuJG5ld0NvbnRlbnQpO1xyXG4gICAgalF1ZXJ5KCc8ZGl2IGNsYXNzPVwibkdZMk5hdmlnYXRpb25iYXJJdGVtIG5HWTJCcmVhZGNydW1iXCI+PC9kaXY+JykuYXBwZW5kVG8oRy5HT00ubmF2aWdhdGlvbkJhci4kbmV3Q29udGVudCk7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhHLkdPTS5uYXZpZ2F0aW9uQmFyLiRuZXdDb250ZW50KTtcclxuICAgICAgXHJcbiAgICAgIGlmKCBHLk8uYnJlYWRjcnVtYk9ubHlDdXJyZW50TGV2ZWwgKSB7XHJcbiAgICAgICAgLy8gZGlzcGxheSBvbmx5IDEgc2VwYXJhdG9yIGFuZCB0aGUgY3VycmVudCBmb2xkZXIgbGV2ZWxcclxuICAgICAgICBpZiggbHN0SXRlbXMubGVuZ3RoID09IDAgKSB7XHJcbiAgICAgICAgICBicmVhZGNydW1iQWRkKDApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHZhciBsYXN0PWxzdEl0ZW1zLmxlbmd0aC0xO1xyXG4gICAgICAgICAgaWYoIGxzdEl0ZW1zLmxlbmd0aCA9PSAxICkge1xyXG4gICAgICAgICAgICBicmVhZGNydW1iQWRkU2VwYXJhdG9yKDApOyAgICAvLyByb290IGxldmVsXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYnJlYWRjcnVtYkFkZFNlcGFyYXRvcihsc3RJdGVtc1swXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhZGNydW1iQWRkKGxzdEl0ZW1zWzBdKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgLy8gZGlzcGxheSB0aGUgZnVsbCBicmVhZGNydW0gKGZ1bGwgZm9sZGVyIGxldmVscyBpbmNsdWRpbmcgcm9vdCBsZXZlbClcclxuICAgICAgICBicmVhZGNydW1iQWRkKDApO1xyXG4gICAgICAgIGlmKCBsc3RJdGVtcy5sZW5ndGggPiAwICkge1xyXG4gICAgICAgICAgYnJlYWRjcnVtYkFkZFNlcGFyYXRvcigwKTtcclxuICAgICAgICAgIGZvcih2YXIgaT1sc3RJdGVtcy5sZW5ndGgtMTsgaT49MCA7IGktLSApIHtcclxuICAgICAgICAgICAgYnJlYWRjcnVtYkFkZChsc3RJdGVtc1tpXSk7XHJcbiAgICAgICAgICAgIGlmKCBpID4gMCApIHtcclxuICAgICAgICAgICAgICBicmVhZGNydW1iQWRkU2VwYXJhdG9yKGxzdEl0ZW1zW2ktMV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICBcclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIC8vIERpc3BsYXkgZ2FsbGVyeSBwYWdpbmF0aW9uXHJcbiAgICBmdW5jdGlvbiBNYW5hZ2VQYWdpbmF0aW9uKCBhbGJ1bUlkeCApIHtcclxuXHJcbiAgICAgIEcuJEUuY29uVG5Cb3R0b20uY3NzKCdvcGFjaXR5JywgMCk7XHJcbiAgICAgIEcuJEUuY29uVG5Cb3R0b20uY2hpbGRyZW4oKS5yZW1vdmUoKTtcclxuXHJcbiAgICAgIGlmKCBHLkdPTS5pdGVtcy5sZW5ndGggPT0gMCApIHsgcmV0dXJuOyB9ICAgLy8gbm8gdGh1bWJuYWlsIHRvIGRpc3BsYXlcclxuXHJcbiAgICAgIC8vIGNhbGN1bGF0ZSB0aGUgbnVtYmVyIG9mIHBhZ2VzXHJcbiAgICAgIHZhciBuYlBhZ2VzPU1hdGguY2VpbCgoRy5HT00uaXRlbXNbRy5HT00uaXRlbXMubGVuZ3RoIC0gMV0ucm93ICsgMSkvRy5nYWxsZXJ5TWF4Um93cy5HZXQoKSk7XHJcblxyXG4gICAgICAvLyBvbmx5IG9uZSBwYWdlIC0+IGRvIG5vdCBkaXNwbGF5IHBhZ2luYXRpb25cclxuICAgICAgaWYoIG5iUGFnZXMgPT0gMSApIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICAvLyBjaGVjayBpZiBjdXJyZW50IHBhZ2Ugc3RpbGwgZXhpc3RzIChmb3IgZXhhbXBsZSBhZnRlciBhIHJlc2l6ZSlcclxuICAgICAgaWYoIEcuR09NLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgPiAobmJQYWdlcy0xKSApIHtcclxuICAgICAgICBHLkdPTS5wYWdpbmF0aW9uLmN1cnJlbnRQYWdlID0gbmJQYWdlcy0xO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBHYWxsZXJ5UmVuZGVyR2V0SW50ZXJ2YWwoKTtcclxuICAgICAgLy8gbm90aGluZyB0byBkaXNwbGF5IC0tPiBleGl0XHJcbiAgICAgIGlmKCBHLkdPTS5kaXNwbGF5SW50ZXJ2YWwubGVuID09IDAgKSB7IHJldHVybjsgfVxyXG4gICAgICBcclxuICAgICAgLy8gZGlzcGxheSBcInByZXZpb3VzXCJcclxuICAgICAgaWYoIEcuTy5nYWxsZXJ5UGFnaW5hdGlvbk1vZGUgPT0gJ05VTUJFUlMnICYmIEcuR09NLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgPiAwICkge1xyXG4gICAgICAgIHZhciAkZWx0UHJldiA9IGpRdWVyeSgnPGRpdiBjbGFzcz1cIm5HWTJQYWdpbmF0aW9uUHJldlwiPicrRy5PLmljb25zLnBhZ2luYXRpb25QcmV2aW91cysnPC9kaXY+JykuYXBwZW5kVG8oRy4kRS5jb25UbkJvdHRvbSk7XHJcbiAgICAgICAgJGVsdFByZXYuY2xpY2soZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgcGFnaW5hdGlvblByZXZpb3VzUGFnZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgZmlyc3RQYWdlID0gMDtcclxuICAgICAgdmFyIGxhc3RQYWdlID0gbmJQYWdlcztcclxuICAgICAgaWYoIEcuTy5nYWxsZXJ5UGFnaW5hdGlvbk1vZGUgIT0gJ05VTUJFUlMnICkge1xyXG4gICAgICAgIC8vIG5vICdwcmV2aW91cycvJ25leHQnIGFuZCBubyBtYXggbnVtYmVyIG9mIHBhZ2luYXRpb24gaXRlbXNcclxuICAgICAgICBmaXJzdFBhZ2UgPSAwO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIGRpc3BsYXkgcGFnaW5hdGlvbiBudW1iZXJzIGFuZCBwcmV2aW91cy9uZXh0XHJcbiAgICAgICAgdmFyIHZwID0gRy5PLnBhZ2luYXRpb25WaXNpYmxlUGFnZXM7XHJcbiAgICAgICAgdmFyIG51bWJlck9mUGFnZXNUb0Rpc3BsYXkgPSBHLk8ucGFnaW5hdGlvblZpc2libGVQYWdlcztcclxuICAgICAgICBpZiggbnVtYmVyT2ZQYWdlc1RvRGlzcGxheSA+PSBuYlBhZ2VzICkge1xyXG4gICAgICAgICAgZmlyc3RQYWdlID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAvLyB3ZSBoYXZlIG1vcmUgcGFnZXMgdGhhbiB3ZSB3YW50IHRvIGRpc3BsYXlcclxuICAgICAgICAgIHZhciBuYkJlZm9yZUFmdGVyID0gMDtcclxuICAgICAgICAgIGlmKCBpc09kZChudW1iZXJPZlBhZ2VzVG9EaXNwbGF5KSApIHtcclxuICAgICAgICAgICAgbmJCZWZvcmVBZnRlciA9IChudW1iZXJPZlBhZ2VzVG9EaXNwbGF5ICsgMSkgLyAyO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG5iQmVmb3JlQWZ0ZXIgPSBudW1iZXJPZlBhZ2VzVG9EaXNwbGF5IC8gMjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYoIEcuR09NLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgPCBuYkJlZm9yZUFmdGVyICkge1xyXG4gICAgICAgICAgICBmaXJzdFBhZ2UgPSAwO1xyXG4gICAgICAgICAgICBsYXN0UGFnZSA9IG51bWJlck9mUGFnZXNUb0Rpc3BsYXkgLSAxO1xyXG4gICAgICAgICAgICBpZiggbGFzdFBhZ2UgPiBuYlBhZ2VzICkge1xyXG4gICAgICAgICAgICAgIGxhc3RQYWdlID0gbmJQYWdlcyAtIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBmaXJzdFBhZ2UgPSBHLkdPTS5wYWdpbmF0aW9uLmN1cnJlbnRQYWdlIC0gbmJCZWZvcmVBZnRlcjtcclxuICAgICAgICAgICAgbGFzdFBhZ2UgPSBmaXJzdFBhZ2UgKyBudW1iZXJPZlBhZ2VzVG9EaXNwbGF5O1xyXG4gICAgICAgICAgICBpZiggbGFzdFBhZ2UgPiBuYlBhZ2VzICkge1xyXG4gICAgICAgICAgICAgIGxhc3RQYWdlID0gbmJQYWdlcyAtIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYoIChsYXN0UGFnZSAtIGZpcnN0UGFnZSkgPCBudW1iZXJPZlBhZ2VzVG9EaXNwbGF5ICkge1xyXG4gICAgICAgICAgICBmaXJzdFBhZ2UgPSBsYXN0UGFnZSAtIG51bWJlck9mUGFnZXNUb0Rpc3BsYXk7XHJcbiAgICAgICAgICAgIGlmKCBmaXJzdFBhZ2UgPCAwICkge1xyXG4gICAgICAgICAgICAgIGZpcnN0UGFnZSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyByZW5kZXIgcGFnaW5hdGlvbiBpdGVtc1xyXG4gICAgICBmb3IodmFyIGkgPSBmaXJzdFBhZ2U7IGkgPCBsYXN0UGFnZTsgaSsrICkge1xyXG4gICAgICAgIHZhciBjID0gJyc7XHJcbiAgICAgICAgdmFyIHAgPSAnJztcclxuXHJcbiAgICAgICAgc3dpdGNoKCBHLk8uZ2FsbGVyeVBhZ2luYXRpb25Nb2RlICkge1xyXG4gICAgICAgICAgY2FzZSAnTlVNQkVSUyc6XHJcbiAgICAgICAgICAgIGMgPSAnbkdZMnBhZ2luYXRpb25JdGVtJztcclxuICAgICAgICAgICAgcCA9IGkgKyAxO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0RPVFMnOlxyXG4gICAgICAgICAgICBjID0gJ25HWTJwYWdpbmF0aW9uRG90JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdSRUNUQU5HTEVTJzpcclxuICAgICAgICAgICAgYyA9ICduR1kycGFnaW5hdGlvblJlY3RhbmdsZSc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiggaSA9PSBHLkdPTS5wYWdpbmF0aW9uLmN1cnJlbnRQYWdlICkge1xyXG4gICAgICAgICAgYyArPSAnQ3VycmVudFBhZ2UnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIGVsdCQgPSBqUXVlcnkoJzxkaXYgY2xhc3M9XCInICsgYyArICdcIj4nICsgcCArICc8L2Rpdj4nKS5hcHBlbmRUbyhHLiRFLmNvblRuQm90dG9tKTtcclxuICAgICAgICBlbHQkLmRhdGEoJ3BhZ2VOdW1iZXInLCBpICk7XHJcbiAgICAgICAgZWx0JC5jbGljayggZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgRy5HT00ucGFnaW5hdGlvbi5jdXJyZW50UGFnZSA9IGpRdWVyeSh0aGlzKS5kYXRhKCdwYWdlTnVtYmVyJyk7XHJcbiAgICAgICAgICBUcmlnZ2VyQ3VzdG9tRXZlbnQoJ3BhZ2VDaGFuZ2VkJyk7XHJcblxyXG4gICAgICAgICAgLy8gc2Nyb2xsIHRvIHRvcCBvZiBnYWxsZXJ5IGlmIG5vdCBkaXNwbGF5ZWRcclxuICAgICAgICAgIGlmKCAhaW5WaWV3cG9ydFZlcnQoRy4kRS5iYXNlLCAwKSApIHtcclxuICAgICAgICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogRy4kRS5iYXNlLm9mZnNldCgpLnRvcH0sIDIwMCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBHYWxsZXJ5RGlzcGxheVBhcnQxKCB0cnVlICk7XHJcbiAgICAgICAgICBHYWxsZXJ5RGlzcGxheVBhcnQyKCB0cnVlICk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBkaXNwbGF5IFwibmV4dFwiXHJcbiAgICAgIGlmKCBHLk8uZ2FsbGVyeVBhZ2luYXRpb25Nb2RlID09ICdOVU1CRVJTJyAmJiAoRy5HT00ucGFnaW5hdGlvbi5jdXJyZW50UGFnZSArIDEpIDwgbmJQYWdlcyApIHtcclxuICAgICAgICB2YXIgJGVsdE5leHQgPSBqUXVlcnkoJzxkaXYgY2xhc3M9XCJuR1kyUGFnaW5hdGlvbk5leHRcIj4nICsgRy5PLmljb25zLnBhZ2luYXRpb25OZXh0ICsgJzwvZGl2PicpLmFwcGVuZFRvKEcuJEUuY29uVG5Cb3R0b20pO1xyXG4gICAgICAgICRlbHROZXh0LmNsaWNrKCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICBwYWdpbmF0aW9uTmV4dFBhZ2UoKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgRy4kRS5jb25UbkJvdHRvbS5jc3MoJ29wYWNpdHknLCAxKTtcclxuXHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBpc09kZChudW0pIHsgcmV0dXJuIChudW0gJSAyKSA9PSAxO31cclxuICAgIFxyXG4gICAgLy8gcGFnaW5hdGlvbiAtIG5leHQgcGFnZVxyXG4gICAgZnVuY3Rpb24gcGFnaW5hdGlvbk5leHRQYWdlKCkge1xyXG4gICAgICB2YXIgYUlkeCA9IEcuR09NLmFsYnVtSWR4LFxyXG4gICAgICBuMSA9IDA7XHJcbiAgICAgIFRodW1ibmFpbEhvdmVyT3V0QWxsKCk7XG4gICAgICBcclxuICAgICAgLy8gcGFnaW5hdGlvbiAtIG1heCBsaW5lcyBwZXIgcGFnZSBtb2RlXHJcbiAgICAgIGlmKCBHLmdhbGxlcnlNYXhSb3dzLkdldCgpID4gMCApIHtcclxuICAgICAgICAvLyBudW1iZXIgb2YgcGFnZXNcclxuICAgICAgICBuMSA9IChHLkdPTS5pdGVtc1tHLkdPTS5pdGVtcy5sZW5ndGggLSAxXS5yb3cgKyAxKSAvIEcuZ2FsbGVyeU1heFJvd3MuR2V0KCk7XHJcbiAgICAgIH1cclxuICAgICAgdmFyIG4yID0gTWF0aC5jZWlsKG4xKTtcclxuICAgICAgdmFyIHBuID0gRy5HT00ucGFnaW5hdGlvbi5jdXJyZW50UGFnZTtcclxuICAgICAgaWYoIHBuIDwgKG4yLTEpICkge1xyXG4gICAgICAgIHBuKys7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcG4gPSAwO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBHLkdPTS5wYWdpbmF0aW9uLmN1cnJlbnRQYWdlID0gcG47XHJcbiAgICAgIFRyaWdnZXJDdXN0b21FdmVudCgncGFnZUNoYW5nZWQnKTtcclxuXHJcbiAgICAgIC8vIHNjcm9sbCB0byB0b3Agb2YgZ2FsbGVyeSBpZiBub3QgZGlzcGxheWVkXHJcbiAgICAgIGlmKCAhaW5WaWV3cG9ydFZlcnQoRy4kRS5iYXNlLCAwKSApIHtcclxuICAgICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7c2Nyb2xsVG9wOiBHLiRFLmJhc2Uub2Zmc2V0KCkudG9wfSwgMjAwKTtcclxuICAgICAgfVxyXG4gICAgICBHYWxsZXJ5RGlzcGxheVBhcnQxKCB0cnVlICk7XHJcbiAgICAgIEdhbGxlcnlEaXNwbGF5UGFydDIoIHRydWUgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gcGFnaW5hdGlvbiAtIHByZXZpb3VzIHBhZ2VcclxuICAgIGZ1bmN0aW9uIHBhZ2luYXRpb25QcmV2aW91c1BhZ2UoKSB7XHJcbiAgICAgIC8vIHZhciBhSWR4PUcuJEUuY29uVG5Cb3R0b20uZGF0YSgnZ2FsbGVyeUlkeCcpLFxyXG4gICAgICB2YXIgYUlkeCA9IEcuR09NLmFsYnVtSWR4LFxyXG4gICAgICBuMSA9IDA7XHJcblxuICAgICAgVGh1bWJuYWlsSG92ZXJPdXRBbGwoKTtcbiAgICAgIFxyXG4gICAgICAvLyBwYWdpbmF0aW9uIC0gbWF4IGxpbmVzIHBlciBwYWdlIG1vZGVcclxuICAgICAgaWYoIEcuZ2FsbGVyeU1heFJvd3MuR2V0KCkgPiAwICkge1xyXG4gICAgICAgIC8vIG51bWJlciBvZiBwYWdlc1xyXG4gICAgICAgIG4xID0gKEcuR09NLml0ZW1zW0cuR09NLml0ZW1zLmxlbmd0aCAtIDFdLnJvdyArIDEpIC8gRy5nYWxsZXJ5TWF4Um93cy5HZXQoKTtcclxuICAgICAgfVxyXG4gICAgICB2YXIgbjIgPSBNYXRoLmNlaWwobjEpO1xyXG4gICAgICBcclxuICAgICAgLy8gdmFyIHBuPUcuJEUuY29uVG5Cb3R0b20uZGF0YSgnY3VycmVudFBhZ2VOdW1iZXInKTtcclxuICAgICAgdmFyIHBuID0gRy5HT00ucGFnaW5hdGlvbi5jdXJyZW50UGFnZTtcclxuICAgICAgaWYoIHBuID4gMCApIHtcclxuICAgICAgICBwbi0tO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHBuID0gbjIgLSAxO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBHLkdPTS5wYWdpbmF0aW9uLmN1cnJlbnRQYWdlID0gcG47XHJcbiAgICAgIFRyaWdnZXJDdXN0b21FdmVudCgncGFnZUNoYW5nZWQnKTtcclxuXHJcbiAgICAgIC8vIHNjcm9sbCB0byB0b3Agb2YgZ2FsbGVyeSBpZiBub3QgZGlzcGxheWVkXHJcbiAgICAgIGlmKCAhaW5WaWV3cG9ydFZlcnQoRy4kRS5iYXNlLCAwKSApIHtcclxuICAgICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7c2Nyb2xsVG9wOiBHLiRFLmJhc2Uub2Zmc2V0KCkudG9wfSwgMjAwKTtcclxuICAgICAgfVxyXG4gICAgICBHYWxsZXJ5RGlzcGxheVBhcnQxKCB0cnVlICk7XHJcbiAgICAgIEdhbGxlcnlEaXNwbGF5UGFydDIoIHRydWUgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyByZXRyaWV2ZSB0aGUgZnJvbS90byBpbnRlcnZhbGwgZm9yIGdhbGxlcnkgdGh1bWJuYWlsIHJlbmRlclxyXG4gICAgZnVuY3Rpb24gR2FsbGVyeVJlbmRlckdldEludGVydmFsKCkge1xyXG4gICAgICBHLkdPTS5kaXNwbGF5SW50ZXJ2YWwuZnJvbSA9IDA7XHJcbiAgICAgIEcuR09NLmRpc3BsYXlJbnRlcnZhbC5sZW4gPSBHLkkubGVuZ3RoO1xyXG4gICAgICBcclxuICAgICAgc3dpdGNoKCBHLmdhbGxlcnlEaXNwbGF5TW9kZS5HZXQoKSApIHtcclxuICAgICAgICBjYXNlICdQQUdJTkFUSU9OJzpcclxuICAgICAgICAgIGlmKCBHLmxheW91dC5zdXBwb3J0LnJvd3MgKSB7XHJcbiAgICAgICAgICAgIHZhciBuYlRuID0gRy5HT00uaXRlbXMubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgZmlyc3RSb3cgPSBHLkdPTS5wYWdpbmF0aW9uLmN1cnJlbnRQYWdlICogRy5nYWxsZXJ5TWF4Um93cy5HZXQoKTtcclxuICAgICAgICAgICAgdmFyIGxhc3RSb3cgPSBmaXJzdFJvdyArIEcuZ2FsbGVyeU1heFJvd3MuR2V0KCk7XHJcbiAgICAgICAgICAgIHZhciBmaXJzdFRuID0gLTE7XHJcbiAgICAgICAgICAgIEcuR09NLmRpc3BsYXlJbnRlcnZhbC5sZW4gPSAwO1xyXG4gICAgICAgICAgICBmb3IoIHZhciBpID0gMDsgaSA8IG5iVG4gOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgdmFyIGN1clRuID0gRy5HT00uaXRlbXNbaV07XHJcbiAgICAgICAgICAgICAgaWYoIGN1clRuLnJvdyA+PSBmaXJzdFJvdyAmJiBjdXJUbi5yb3cgPCBsYXN0Um93ICkge1xyXG4gICAgICAgICAgICAgICAgaWYoIGZpcnN0VG4gPT0gLTEgKSB7XHJcbiAgICAgICAgICAgICAgICAgIEcuR09NLmRpc3BsYXlJbnRlcnZhbC5mcm9tID0gaTtcclxuICAgICAgICAgICAgICAgICAgZmlyc3RUbiA9IGk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBHLkdPTS5kaXNwbGF5SW50ZXJ2YWwubGVuKys7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdNT1JFQlVUVE9OJzpcclxuICAgICAgICAgIGlmKCBHLmxheW91dC5zdXBwb3J0LnJvd3MgKSB7XHJcbiAgICAgICAgICAgIHZhciBuYlRuID0gRy5HT00uaXRlbXMubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgbGFzdFJvdyA9IEcuTy5nYWxsZXJ5RGlzcGxheU1vcmVTdGVwICogKEcuR09NLmRpc3BsYXllZE1vcmVTdGVwcysxKTtcclxuICAgICAgICAgICAgRy5HT00uZGlzcGxheUludGVydmFsLmxlbiA9IDA7XHJcbiAgICAgICAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbmJUbiA7IGkrKyApIHtcclxuICAgICAgICAgICAgICB2YXIgY3VyVG4gPSBHLkdPTS5pdGVtc1tpXTtcclxuICAgICAgICAgICAgICBpZiggY3VyVG4ucm93IDwgbGFzdFJvdyApIHtcclxuICAgICAgICAgICAgICAgIEcuR09NLmRpc3BsYXlJbnRlcnZhbC5sZW4rKztcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1JPV1MnOlxyXG4gICAgICAgICAgaWYoIEcubGF5b3V0LnN1cHBvcnQucm93cyApIHtcclxuICAgICAgICAgICAgdmFyIG5iVG4gPSBHLkdPTS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBsYXN0Um93ID0gRy5nYWxsZXJ5TWF4Um93cy5HZXQoKTtcclxuICAgICAgICAgICAgaWYoIEcuZ2FsbGVyeUxhc3RSb3dGdWxsLkdldCgpICYmIEcuR09NLmxhc3RGdWxsUm93ICE9IC0xICkge1xyXG4gICAgICAgICAgICAgIGlmKCBsYXN0Um93ID4gKEcuR09NLmxhc3RGdWxsUm93ICsgMSkgKSB7XHJcbiAgICAgICAgICAgICAgICBsYXN0Um93ID0gRy5HT00ubGFzdEZ1bGxSb3cgKyAxO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBHLkdPTS5kaXNwbGF5SW50ZXJ2YWwubGVuID0gMDtcclxuICAgICAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBuYlRuIDsgaSsrICkge1xyXG4gICAgICAgICAgICAgIHZhciBjdXJUbiA9IEcuR09NLml0ZW1zW2ldO1xyXG4gICAgICAgICAgICAgIGlmKCBjdXJUbi5yb3cgPCBsYXN0Um93ICkge1xyXG4gICAgICAgICAgICAgICAgRy5HT00uZGlzcGxheUludGVydmFsLmxlbisrO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICBjYXNlICdGVUxMQ09OVEVOVCc6XHJcbiAgICAgICAgaWYoIEcubGF5b3V0LnN1cHBvcnQucm93cyAmJiBHLmdhbGxlcnlMYXN0Um93RnVsbC5HZXQoKSAmJiBHLkdPTS5sYXN0RnVsbFJvdyAhPSAtMSApIHtcclxuICAgICAgICAgICAgdmFyIG5iVG4gPSBHLkdPTS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBsYXN0Um93ID0gRy5HT00ubGFzdEZ1bGxSb3cgKyAxO1xyXG4gICAgICAgICAgICBHLkdPTS5kaXNwbGF5SW50ZXJ2YWwubGVuID0gMDtcclxuICAgICAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBuYlRuIDsgaSsrICkge1xyXG4gICAgICAgICAgICAgIHZhciBjdXJUbiA9IEcuR09NLml0ZW1zW2ldO1xyXG4gICAgICAgICAgICAgIGlmKCBjdXJUbi5yb3cgPCBsYXN0Um93ICkge1xyXG4gICAgICAgICAgICAgICAgRy5HT00uZGlzcGxheUludGVydmFsLmxlbisrO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyBSRU5ERVIgVEhFIEdBTExFUllcclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlSZW5kZXIoIGFsYnVtSWR4ICkge1xyXG4gICAgICBUcmlnZ2VyQ3VzdG9tRXZlbnQoJ2dhbGxlcnlSZW5kZXJTdGFydCcpO1xyXG4gICAgICBcclxuICAgICAgY2xlYXJUaW1lb3V0KEcuR09NLnNsaWRlci50aW1lcklEKTtcclxuICAgICAgRy5HT00uc2xpZGVyLmhvc3RJZHggPSAtMTsgICAgICAvLyBkaXNhYmxlZCBzbGlkZXIgb24gdGh1bWJuYWlsXHJcbiAgICAgIFxyXG4gICAgICB2YXIgZnU9Ry5PLmZuR2FsbGVyeVJlbmRlclN0YXJ0O1xyXG4gICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdShhbGJ1bUlkeCkgOiB3aW5kb3dbZnVdKGFsYnVtSWR4KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgRy5sYXlvdXQuU2V0RW5naW5lKCk7XHJcbiAgICAgIEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICBHLkdPTS5hbGJ1bUlkeCA9IC0xO1xyXG4gICAgICBHLkdPTS5sYXN0RGlzcGxheWVkSWR4ID0gLTE7XHJcblxyXG4gICAgICAvLyBwYWdpbmF0aW9uXHJcbiAgICAgIGlmKCBHLiRFLmNvblRuQm90dG9tICE9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgLy8gRy4kRS5jb25UbkJvdHRvbS5jaGlsZHJlbigpLnJlbW92ZSgpO1xyXG4gICAgICAgIEcuJEUuY29uVG5Cb3R0b20uZW1wdHkoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gbmF2aWdhdGlvbiB0b29sYmFyIChicmVhZGNydW1iICsgdGFnIGZpbHRlcnMpXHJcbiAgICAgIEdhbGxlcnlOYXZpZ2F0aW9uQmFyKGFsYnVtSWR4KTtcclxuICAgICAgXHJcbiAgICAgIGlmKCBHLkdPTS5maXJzdERpc3BsYXkgKSB7XHJcbiAgICAgICAgRy5HT00uZmlyc3REaXNwbGF5ID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIGQgPSBEYXRlLm5vdygpLUcuR09NLmZpcnN0RGlzcGxheVRpbWU7XHJcbiAgICAgICAgaWYoIGQgPCBHLk8uZ2FsbGVyeVJlbmRlckRlbGF5ICkge1xyXG4gICAgICAgICAgLy8gc2V0VGltZW91dCggZnVuY3Rpb24oKSB7IEdhbGxlcnlSZW5kZXJQYXJ0MSggYWxidW1JZHggKX0sIEcuTy5nYWxsZXJ5UmVuZGVyRGVsYXktZCApO1xyXG4gICAgICAgICAgcmVxdWVzdFRpbWVvdXQoIGZ1bmN0aW9uKCkgeyBHYWxsZXJ5UmVuZGVyUGFydDEoIGFsYnVtSWR4ICl9LCBHLk8uZ2FsbGVyeVJlbmRlckRlbGF5LWQgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBHYWxsZXJ5UmVuZGVyUGFydDEoIGFsYnVtSWR4ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEcuTy5nYWxsZXJ5UmVuZGVyRGVsYXkgPSAwO1xyXG4gICAgICAgIFxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB2YXIgaGlkZU5hdmlnYXRpb25CYXIgPSBmYWxzZTtcclxuICAgICAgICBpZiggRy5HT00ubmF2aWdhdGlvbkJhci4kbmV3Q29udGVudC5jaGlsZHJlbigpLmxlbmd0aCA9PSAwICkge1xyXG4gICAgICAgICAgaGlkZU5hdmlnYXRpb25CYXIgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaGlkZSBldmVyeXRoaW5nXHJcbiAgICAgICAgdmFyIHR3ZWVuYWJsZSA9IG5ldyBOR1R3ZWVuYWJsZSgpO1xyXG4gICAgICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAgICAgICAgICBmcm9tOiAgICAgICAgIHsgJ29wYWNpdHknOiAxIH0sXHJcbiAgICAgICAgICB0bzogICAgICAgICAgIHsgJ29wYWNpdHknOiAwIH0sXHJcbiAgICAgICAgICBkdXJhdGlvbjogICAgIDMwMCxcclxuICAgICAgICAgIGVhc2luZzogICAgICAgJ2Vhc2VJblF1YXJ0JyxcclxuICAgICAgICAgIGF0dGFjaG1lbnQ6ICAgeyBoOiBoaWRlTmF2aWdhdGlvbkJhciB9LFxyXG4gICAgICAgICAgc3RlcDogICAgICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgICAvLyB3aW5kb3cubmdfZHJhZiggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgRy4kRS5jb25UblBhcmVudC5jc3MoeydvcGFjaXR5Jzogc3RhdGUub3BhY2l0eSB9KTtcclxuICAgICAgICAgICAgICBpZiggYXR0LmggKSB7XHJcbiAgICAgICAgICAgICAgICBHLiRFLmNvbk5hdmlnYXRpb25CYXIuY3NzKHsgJ29wYWNpdHknOiBzdGF0ZS5vcGFjaXR5IH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZmluaXNoOiAgICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgICAvLyB3aW5kb3cubmdfZHJhZiggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgaWYoIGF0dC5oICkge1xyXG4gICAgICAgICAgICAgICAgRy4kRS5jb25OYXZpZ2F0aW9uQmFyLmNzcyh7ICdvcGFjaXR5JzogMCwgJ2Rpc3BsYXknOiAnbm9uZScgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIC8vIHNjcm9sbCB0byB0b3Agb2YgdGhlIGdhbGxlcnkgaWYgbmVlZGVkXHJcbiAgICAgICAgICAgICAgdmFyIGdhbGxlcnlPVG9wID0gRy4kRS5iYXNlLm9mZnNldCgpLnRvcDtcclxuICAgICAgICAgICAgICBpZiggZ2FsbGVyeU9Ub3AgPCBHLkdPTS5jYWNoZS52aWV3cG9ydC50ICkge1xyXG4gICAgICAgICAgICAgICAgLy8galF1ZXJ5KCdodG1sLCBib2R5JykuYW5pbWF0ZSh7c2Nyb2xsVG9wOiBnYWxsZXJ5T1RvcH0sIDIwMCk7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6IGdhbGxlcnlPVG9wfSwgNTAwLCBcImxpbmVhclwiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgR2FsbGVyeVJlbmRlclBhcnQxKCBhbGJ1bUlkeCApO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgR2FsbGVyeVJlbmRlclBhcnQxKCBhbGJ1bUlkeCApO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgZnVuY3Rpb24gR2FsbGVyeVJlbmRlclBhcnQxKCBhbGJ1bUlkeCApIHtcclxuICAgICAgLy8gZGlzcGxheSBuZXcgbmF2aWdhdGlvbiBiYXJcclxuICAgICAgdmFyIG9sZE4gPSBHLiRFLmNvbk5hdmlnYXRpb25CYXIuY2hpbGRyZW4oKS5sZW5ndGg7XHJcbiAgICAgIEcuJEUuY29uTmF2aWdhdGlvbkJhci5lbXB0eSgpO1xyXG4gICAgICBHLkdPTS5uYXZpZ2F0aW9uQmFyLiRuZXdDb250ZW50LmNoaWxkcmVuKCkuY2xvbmUodHJ1ZSx0cnVlKS5hcHBlbmRUbyhHLiRFLmNvbk5hdmlnYXRpb25CYXIpO1xyXG4gICAgICAvLyBHLkdPTS5uYXZpZ2F0aW9uQmFyLiRuZXdDb250ZW50LmFwcGVuZFRvKEcuJEUuY29uTmF2aWdhdGlvbkJhcik7XHJcbiAgICAgIGlmKCBHLiRFLmNvbk5hdmlnYXRpb25CYXIuY2hpbGRyZW4oKS5sZW5ndGggPiAwICYmIG9sZE4gPT0gMCApIHtcclxuICAgICAgICBHLiRFLmNvbk5hdmlnYXRpb25CYXIuY3NzKHsgJ29wYWNpdHknOiAwLCAnZGlzcGxheSc6ICdibG9jaycgfSk7XHJcbiAgICAgICAgdmFyIHR3ZWVuYWJsZSA9IG5ldyBOR1R3ZWVuYWJsZSgpO1xyXG4gICAgICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAgICAgICAgICBmcm9tOiAgICAgeyBvcGFjaXR5OiAwIH0sXHJcbiAgICAgICAgICB0bzogICAgICAgeyBvcGFjaXR5OiAxIH0sXHJcbiAgICAgICAgICBkdXJhdGlvbjogMjAwLFxyXG4gICAgICAgICAgZWFzaW5nOiAgICdlYXNlSW5RdWFydCcsXHJcbiAgICAgICAgICBzdGVwOiAgICAgZnVuY3Rpb24gKHN0YXRlKSB7XHJcbiAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICBHLiRFLmNvbk5hdmlnYXRpb25CYXIuY3NzKCBzdGF0ZSApO1xyXG4gICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBmaW5pc2g6ICAgZnVuY3Rpb24gKHN0YXRlKSB7XHJcbiAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICBHLiRFLmNvbk5hdmlnYXRpb25CYXIuY3NzKHsgJ29wYWNpdHknOiAxIH0pO1xyXG4gICAgICAgICAgICAgIC8vIGRpc3BsYXkgZ2FsbGVyeVxyXG4gICAgICAgICAgICAgIC8vIEdhbGxlcnlSZW5kZXJQYXJ0MiggYWxidW1JZHggKTtcclxuICAgICAgICAgICAgICAvLyBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IEdhbGxlcnlSZW5kZXJQYXJ0MihhbGJ1bUlkeCkgfSwgNjApO1xyXG4gICAgICAgICAgICAgIHJlcXVlc3RUaW1lb3V0KGZ1bmN0aW9uKCl7IEdhbGxlcnlSZW5kZXJQYXJ0MihhbGJ1bUlkeCkgfSwgNjApO1xyXG4gICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyBkaXNwbGF5IGdhbGxlcnlcclxuICAgICAgICAvLyBHYWxsZXJ5UmVuZGVyUGFydDIoIGFsYnVtSWR4ICk7XHJcbiAgICAgICAgICAgIC8vIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgR2FsbGVyeVJlbmRlclBhcnQyKGFsYnVtSWR4KSB9LCA2MCk7XHJcbiAgICAgICAgICAgIHJlcXVlc3RUaW1lb3V0KGZ1bmN0aW9uKCl7IEdhbGxlcnlSZW5kZXJQYXJ0MihhbGJ1bUlkeCkgfSwgNjApO1xyXG4gICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBHYWxsZXJ5IHJlbmRlciBwYXJ0IDIgLT4gcmVtb3ZlIGFsbCB0aHVtYm5haWxzXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5UmVuZGVyUGFydDIoYWxidW1JZHgpIHtcclxuICAgICAgRy5HT00ubGFzdFpJbmRleCA9IHBhcnNlSW50KEcuJEUuYmFzZS5jc3MoJ3otaW5kZXgnKSk7XHJcbiAgICAgIGlmKCBpc05hTihHLkdPTS5sYXN0WkluZGV4KSApIHtcclxuICAgICAgICBHLkdPTS5sYXN0WkluZGV4PTA7XHJcbiAgICAgIH1cclxuICAgICAgRy4kRS5jb25UblBhcmVudC5jc3MoeyAnb3BhY2l0eSc6IDAgfSk7XHJcbiAgICAgIEcuJEUuY29uVG4ub2ZmKCkuZW1wdHkoKTtcclxuICAgICAgdmFyIGwgPSBHLkkubGVuZ3RoO1xyXG4gICAgICBmb3IoIHZhciBpID0gMDsgaSA8IGwgOyBpKysgKSB7XHJcbiAgICAgICAgLy8gcmVzZXQgZWFjaCBpdGVtXHJcbiAgICAgICAgdmFyIGl0ZW0gPSBHLklbaV07XHJcbiAgICAgICAgaXRlbS5ob3ZlcmVkID0gZmFsc2U7XHJcbiAgICAgICAgaXRlbS4kZWx0ID0gbnVsbDtcclxuICAgICAgICBpdGVtLiRFbHRzID0gW107XHJcbiAgICAgICAgaXRlbS5lbHRUcmFuc2Zvcm0gPSBbXTtcclxuICAgICAgICBpdGVtLmVsdEZpbHRlciA9IFtdO1xyXG4gICAgICAgIGl0ZW0ud2lkdGggPSAwO1xyXG4gICAgICAgIGl0ZW0uaGVpZ2h0ID0gMDtcclxuICAgICAgICBpdGVtLmxlZnQgPSAwO1xyXG4gICAgICAgIGl0ZW0udG9wID0gMDtcclxuICAgICAgICBpdGVtLnJlc2l6ZWRDb250ZW50V2lkdGggPSAwO1xyXG4gICAgICAgIGl0ZW0ucmVzaXplZENvbnRlbnRIZWlnaHQgPSAwO1xyXG4gICAgICAgIGl0ZW0udGh1bWJuYWlsSW1nUmV2ZWFsZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYoIEcuQ1NTdHJhbnNmb3JtTmFtZSA9PSBudWxsICkge1xyXG4gICAgICAgIEcuJEUuY29uVG4uY3NzKCdsZWZ0JywgJzBweCcpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIEcuJEUuY29uVG4uY3NzKCBHLkNTU3RyYW5zZm9ybU5hbWUsICd0cmFuc2xhdGVYKDBweCknKTtcclxuICAgICAgICBHLiRFLmNvblRuLmNzcyggRy5DU1N0cmFuc2Zvcm1OYW1lLCAnbm9uZScpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IEdhbGxlcnlSZW5kZXJQYXJ0MyhhbGJ1bUlkeCkgfSwgNjApO1xyXG4gICAgICByZXF1ZXN0VGltZW91dChmdW5jdGlvbigpeyBHYWxsZXJ5UmVuZGVyUGFydDMoYWxidW1JZHgpIH0sIDYwKTtcclxuICAgICAgLy8gR2FsbGVyeVJlbmRlclBhcnQzKGFsYnVtSWR4KTtcclxuXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEdhbGxlcnkgcmVuZGVyIHBhcnQgMiAtPiBzdGFydCBidWlsZGluZyB0aGUgbmV3IGdhbGxlcnlcclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlSZW5kZXJQYXJ0MyhhbGJ1bUlkeCkge1xyXG4gICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7ICAgICAgXHJcbiAgICAgIFxyXG4gICAgICBHLiRFLmNvblRuUGFyZW50LmNzcyggJ29wYWNpdHknLCAxKTtcclxuXHJcbiAgICAgIEcuR09NLml0ZW1zID0gW107XHJcbiAgICAgIEcuR09NLmRpc3BsYXllZE1vcmVTdGVwcyA9IDA7XHJcbiAgICAgIC8vIHJldHJpZXZlIGxhYmVsIGhlaWdodCAgICAgIFxyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbExhYmVsLmdldCgncG9zaXRpb24nKSA9PSAnb25Cb3R0b20nICkge1xyXG4gICAgICAgIC8vIHJldHJpZXZlIGhlaWdodCBlYWNoIHRpbWUgYmVjYXVzZSBzaXplIGNhbiBjaGFuZ2UgZGVwZW5kaW5nIG9uIHRodW1ibmFpbCdzIHNldHRpbmdzXHJcbiAgICAgICAgRy50bi5sYWJlbEhlaWdodFtHLkdPTS5jdXJOYXZMZXZlbF09VGh1bWJuYWlsR2V0TGFiZWxIZWlnaHQoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBHLnRuLmxhYmVsSGVpZ2h0W0cuR09NLmN1ck5hdkxldmVsXT0wO1xyXG4gICAgICB9XHJcbiAgICAgIEcuR09NLmFsYnVtSWR4PWFsYnVtSWR4O1xyXG5cclxuICAgICAgVHJpZ2dlckN1c3RvbUV2ZW50KCdnYWxsZXJ5UmVuZGVyRW5kJyk7XHJcbiAgICAgIHZhciBmdT1HLk8uZm5HYWxsZXJ5UmVuZGVyRW5kO1xyXG4gICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdShhbGJ1bUlkeCkgOiB3aW5kb3dbZnVdKGFsYnVtSWR4KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU3RlcCAxOiBwb3B1bGF0ZSBHT01cclxuICAgICAgaWYoIEdhbGxlcnlQb3B1bGF0ZUdPTSgpICkge1xyXG5cclxuICAgICAgICAvLyBzdGVwIDI6IGNhbGN1bGF0ZSBsYXlvdXRcclxuICAgICAgICBHYWxsZXJ5U2V0TGF5b3V0KCk7XHJcblxyXG4gICAgICAgIC8vIHN0ZXAgMzogZGlzcGxheSBnYWxsZXJ5XHJcbiAgICAgICAgR2FsbGVyeUFwcGVhcigpO1xyXG4gICAgICAgIC8vIEdhbGxlcnlEaXNwbGF5KCBmYWxzZSApO1xyXG4gICAgICAgIEdhbGxlcnlEaXNwbGF5UGFydDEoIGZhbHNlICk7XHJcbiAgICAgICAgLy8gc2V0VGltZW91dChmdW5jdGlvbigpeyBHYWxsZXJ5RGlzcGxheVBhcnQyKCBmYWxzZSApIH0sIDEyMCk7XHJcbiAgICAgICAgcmVxdWVzdFRpbWVvdXQoZnVuY3Rpb24oKXsgR2FsbGVyeURpc3BsYXlQYXJ0MiggZmFsc2UgKSB9LCAxMjApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmKCBHLk8uZGVidWdNb2RlICkgeyBjb25zb2xlLmxvZygnR2FsbGVyeVJlbmRlclBhcnQzOiAnKyAobmV3IERhdGUoKS1kKSk7IH1cclxuXHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgLy8gUmVzaXplIHRoZSBnYWxsZXJ5XHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5UmVzaXplKCkge1xyXG4gICAgICB2YXIgZCA9IG5ldyBEYXRlKCk7XHJcbiAgICAgIEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICAvLyBHLkdPTS5jYWNoZS5hcmVhV2lkdGg9Ry4kRS5jb25UblBhcmVudC53aWR0aCgpO1xyXG4gICAgICBpZiggR2FsbGVyeVNldExheW91dCgpID09IGZhbHNlICkge1xyXG4gICAgICAgIEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgaWYoIEcuTy5kZWJ1Z01vZGUgKSB7IGNvbnNvbGUubG9nKCdHYWxsZXJ5UmVzaXplMTogJysgKG5ldyBEYXRlKCktZCkpOyB9XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGlmKCBHLk8uZGVidWdNb2RlICkgeyBjb25zb2xlLmxvZygnR2FsbGVyeVJlc2l6ZVNldExheW91dDogJysgKG5ldyBEYXRlKCktZCkpOyB9XHJcblxyXG4gICAgICBHYWxsZXJ5RGlzcGxheVBhcnQxKCBmYWxzZSApO1xyXG4gICAgICBHYWxsZXJ5RGlzcGxheVBhcnQyKCBmYWxzZSApO1xyXG5cclxuICAgICAgaWYoIEcuTy5kZWJ1Z01vZGUgKSB7IGNvbnNvbGUubG9nKCdHYWxsZXJ5UmVzaXplRnVsbDogJysgKG5ldyBEYXRlKCktZCkpOyB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyBjb3B5IGl0ZW1zIChhbGJ1bSBjb250ZW50KSB0byBHT01cclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlQb3B1bGF0ZUdPTSgpIHtcclxuICAgICAgXHJcbiAgICAgIHZhciBwcmVsb2FkSW1hZ2VzID0gJyc7XHJcbiAgICAgIHZhciBpbWFnZVNpemVSZXF1ZXN0ZWQgPSBmYWxzZTtcclxuICAgICAgdmFyIGFsYnVtSUQgPSBHLklbRy5HT00uYWxidW1JZHhdLkdldElEKCk7XHJcbiAgICAgIHZhciBsID0gRy5JLmxlbmd0aDtcclxuICAgICAgdmFyIGNudCA9IDA7XHJcblxyXG4gICAgICBmb3IoIHZhciBpZHggPSAwOyBpZHggPCBsOyBpZHgrKyApIHtcclxuICAgICAgICB2YXIgaXRlbSA9IEcuSVtpZHhdO1xyXG4gICAgICAgIC8vIGNoZWNrIGFsYnVtXHJcbiAgICAgICAgaWYoIGl0ZW0uaXNUb0Rpc3BsYXkoYWxidW1JRCkgKSB7XHJcbiAgICAgICAgICB2YXIgdyA9IGl0ZW0udGh1bWJJbWcoKS53aWR0aDtcclxuICAgICAgICAgIHZhciBoID0gaXRlbS50aHVtYkltZygpLmhlaWdodDtcclxuICAgICAgICAgIC8vIGlmIHVua25vd24gaW1hZ2Ugc2l6ZSBhbmQgbGF5b3V0IGlzIG5vdCBncmlkIC0tPiB3ZSBuZWVkIHRvIHJldHJpZXZlIHRoZSBzaXplIG9mIHRoZSBpbWFnZXNcclxuICAgICAgICAgIGlmKCBHLmxheW91dC5wcmVyZXF1aXNpdGUuaW1hZ2VTaXplICYmICggdyA9PSAwIHx8IGggPT0gMCkgKSB7XHJcbiAgICAgICAgICAvLyBpZiggdHJ1ZSApIHtcclxuICAgICAgICAgICAgaW1hZ2VTaXplUmVxdWVzdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgcHJlbG9hZEltYWdlcyArPSAnPGltZyBzcmM9XCInK2l0ZW0udGh1bWJJbWcoKS5zcmMrJ1wiIGRhdGEtaWR4PVwiJytjbnQrJ1wiIGRhdGEtYWxidW1pZHg9XCInK0cuR09NLmFsYnVtSWR4KydcIj4nO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBzZXQgZGVmYXVsdCBzaXplIGlmIHJlcXVpcmVkXHJcbiAgICAgICAgICBpZiggaCA9PSAwICkge1xyXG4gICAgICAgICAgICBoID0gRy50bi5kZWZhdWx0U2l6ZS5nZXRIZWlnaHQoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmKCB3ID09IDAgKSB7XHJcbiAgICAgICAgICAgIHcgPSBHLnRuLmRlZmF1bHRTaXplLmdldFdpZHRoKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICB2YXIgdG4gPSBuZXcgRy5HT00uR1RuKGlkeCwgdywgaCk7XHJcbiAgICAgICAgICBHLkdPTS5pdGVtcy5wdXNoKHRuKTtcclxuICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgVHJpZ2dlckN1c3RvbUV2ZW50KCdnYWxsZXJ5T2JqZWN0TW9kZWxCdWlsdCcpO1xyXG4gICAgICB2YXIgZnUgPSBHLk8uZm5HYWxsZXJ5T2JqZWN0TW9kZWxCdWlsdDtcclxuICAgICAgaWYoIGZ1ICE9PSBudWxsICkge1xyXG4gICAgICAgIHR5cGVvZiBmdSA9PSAnZnVuY3Rpb24nID8gZnUoKSA6IHdpbmRvd1tmdV0oKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYoIGltYWdlU2l6ZVJlcXVlc3RlZCApIHtcclxuICAgICAgICAvLyBwcmVsb2FkIGltYWdlcyB0byByZXRyaWV2ZSB0aGVpciBzaXplIGFuZCB0aGVuIHJlc2l6ZSB0aGUgZ2FsbGVyeSAoPUdhbGxlcnlTZXRMYXlvdXQoKSsgR2FsbGVyeURpc3BsYXkoKSlcclxuICAgICAgICB2YXIgJG5ld0ltZyA9IGpRdWVyeShwcmVsb2FkSW1hZ2VzKTtcclxuICAgICAgICB2YXIgZ2lfaW1nTG9hZCA9IG5naW1hZ2VzTG9hZGVkKCAkbmV3SW1nICk7XHJcbiAgICAgICAgJG5ld0ltZyA9IG51bGw7XHJcbiAgICAgICAgZ2lfaW1nTG9hZC5vbiggJ3Byb2dyZXNzJywgZnVuY3Rpb24oIGluc3RhbmNlLCBpbWFnZSApIHtcclxuICAgICAgICBcclxuICAgICAgICAgIGlmKCBpbWFnZS5pc0xvYWRlZCApIHtcclxuICAgICAgICAgICAgdmFyIGlkeCA9IGltYWdlLmltZy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWR4Jyk7XHJcbiAgICAgICAgICAgIHZhciBhbGJ1bUlkeCA9IGltYWdlLmltZy5nZXRBdHRyaWJ1dGUoJ2RhdGEtYWxidW1pZHgnKTtcclxuICAgICAgICAgICAgaWYoIGFsYnVtSWR4ID09IEcuR09NLmFsYnVtSWR4ICkge1xyXG4gICAgICAgICAgICAgIC8vIGlnbm9yZSBldmVudCBpZiBub3Qgb24gY3VycmVudCBhbGJ1bVxyXG4gICAgICAgICAgICAgIHZhciBjdXJUbiA9IEcuR09NLml0ZW1zW2lkeF07XHJcbiAgICAgICAgICAgICAgY3VyVG4uaW1hZ2VXaWR0aCA9IGltYWdlLmltZy5uYXR1cmFsV2lkdGg7XHJcbiAgICAgICAgICAgICAgY3VyVG4uaW1hZ2VIZWlnaHQgPSBpbWFnZS5pbWcubmF0dXJhbEhlaWdodDtcclxuICAgICAgICAgICAgICB2YXIgaXRlbSA9IEcuSVtjdXJUbi50aHVtYm5haWxJZHhdO1xyXG4gICAgICAgICAgICAgIGl0ZW0udGh1bWJzLndpZHRoW0cuR09NLmN1ck5hdkxldmVsXVtHLkdPTS5jdXJXaWR0aF0gPSBjdXJUbi5pbWFnZVdpZHRoO1xyXG4gICAgICAgICAgICAgIGl0ZW0udGh1bWJzLmhlaWdodFtHLkdPTS5jdXJOYXZMZXZlbF1bRy5HT00uY3VyV2lkdGhdID0gY3VyVG4uaW1hZ2VIZWlnaHQ7XHJcbiBcclxuICAgICAgICAgICAgICAvLyByZXNpemUgdGhlIGdhbGxlcnlcclxuICAgICAgICAgICAgICBHLkdhbGxlcnlSZXNpemVUaHJvdHRsZWQoKTtcclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAvLyBzZXQgdGhlIHJldHJpZXZlZCBzaXplIHRvIGFsbCBsZXZlbHMgd2l0aCBzYW1lIGNvbmZpZ3VyYXRpb24gIFxyXG4gICAgICAgICAgICAgIHZhciBvYmplY3QgPSBpdGVtLnRodW1icy53aWR0aC5sMTtcclxuICAgICAgICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBvYmplY3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvYmplY3QuaGFzT3duUHJvcGVydHkocHJvcGVydHkpKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmKCBwcm9wZXJ0eSAhPSBHLkdPTS5jdXJXaWR0aCApIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiggRy50bi5zZXR0aW5ncy53aWR0aC5sMVtwcm9wZXJ0eV0gPT0gRy50bi5zZXR0aW5ncy5nZXRXKCkgJiYgRy50bi5zZXR0aW5ncy5oZWlnaHQubDFbcHJvcGVydHldID09IEcudG4uc2V0dGluZ3MuZ2V0SCgpICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgaXRlbS50aHVtYnMud2lkdGgubDFbcHJvcGVydHldID0gY3VyVG4uaW1hZ2VXaWR0aDtcclxuICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udGh1bWJzLmhlaWdodC5sMVtwcm9wZXJ0eV0gPSBjdXJUbi5pbWFnZUhlaWdodDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgb2JqZWN0ID0gaXRlbS50aHVtYnMud2lkdGgubE47XHJcbiAgICAgICAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gb2JqZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAob2JqZWN0Lmhhc093blByb3BlcnR5KHByb3BlcnR5KSkge1xyXG4gICAgICAgICAgICAgICAgICBpZiggcHJvcGVydHkgIT0gRy5HT00uY3VyV2lkdGggKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIEcudG4uc2V0dGluZ3Mud2lkdGgubE5bcHJvcGVydHldID09IEcudG4uc2V0dGluZ3MuZ2V0VygpICYmIEcudG4uc2V0dGluZ3MuaGVpZ2h0LmxOW3Byb3BlcnR5XSA9PSBHLnRuLnNldHRpbmdzLmdldEgoKSApIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGl0ZW0udGh1bWJzLndpZHRoLmxOW3Byb3BlcnR5XSA9IGN1clRuLmltYWdlV2lkdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICBpdGVtLnRodW1icy5oZWlnaHQubE5bcHJvcGVydHldID0gY3VyVG4uaW1hZ2VIZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgRy5nYWxsZXJ5UmVzaXplRXZlbnRFbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vLS0tLS0gQ2FsY3VsYXRlIHRoZSBsYXlvdXQgb2YgdGhlIHRodW1ibmFpbHNcclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlTZXRMYXlvdXQoKSB7XHJcbiAgICAgIHZhciByID0gdHJ1ZTtcclxuICAgICAgLy8gd2lkdGggb2YgdGhlIGF2YWlsYWJsZSBhcmVhXHJcbiAgICAgIEcuR09NLmNhY2hlLmFyZWFXaWR0aCA9IEcuJEUuY29uVG5QYXJlbnQud2lkdGgoKTtcclxuICAgICAgRy5HT00uZGlzcGxheUFyZWEgPSB7IHdpZHRoOjAsIGhlaWdodDowIH07XHJcblxyXG4gICAgICBzd2l0Y2goIEcubGF5b3V0LmVuZ2luZSApIHtcclxuICAgICAgICBjYXNlICdKVVNUSUZJRUQnOlxyXG4gICAgICAgICAgciA9IEdhbGxlcnlTZXRMYXlvdXRXaWR0aHRBdXRvKCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdDQVNDQURJTkcnOlxyXG4gICAgICAgICAgciA9IEdhbGxlcnlTZXRMYXlvdXRIZWlnaHRBdXRvKCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdNT1NBSUMnOlxyXG4gICAgICAgICAgciA9IEdhbGxlcnlTZXRMYXlvdXRNb3NhaWMoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0dSSUQnOlxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICByID0gR2FsbGVyeVNldExheW91dEdyaWQoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBUcmlnZ2VyQ3VzdG9tRXZlbnQoJ2dhbGxlcnlMYXlvdXRBcHBsaWVkJyk7XHJcbiAgICAgIHZhciBmdSA9IEcuTy5mbkdhbGxlcnlMYXlvdXRBcHBsaWVkO1xyXG4gICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdSgpIDogd2luZG93W2Z1XSgpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiByO1xyXG5cclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAvLy0tLS0tIENBU0NBRElORyBMQVlPVVRcclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlTZXRMYXlvdXRIZWlnaHRBdXRvKCkge1xyXG4gICAgICB2YXIgY3VyQ29sID0gICAgICAwLFxyXG4gICAgICBhcmVhV2lkdGggPSAgICAgICBHLkdPTS5jYWNoZS5hcmVhV2lkdGgsXHJcbiAgICAgIGN1clJvdyA9ICAgICAgICAgIDAsXHJcbiAgICAgIGNvbEhlaWdodCA9ICAgICAgIFtdLFxyXG4gICAgICBtYXhDb2wgPSAgICAgICAgICBOYlRodW1ibmFpbHNQZXJSb3coYXJlYVdpZHRoKSxcclxuICAgICAgZ3V0dGVyV2lkdGggPSAgICAgMCxcclxuICAgICAgZ3V0dGVySGVpZ2h0ID0gICAgRy50bi5vcHQuR2V0KCdndXR0ZXJIZWlnaHQnKTtcclxuICAgICAgdmFyIHcgPSAgICAgICAgICAgMDtcclxuICAgICAgdmFyIHNjYWxlRmFjdG9yID0gMTtcclxuICAgICAgdmFyIHRuV2lkdGggPSAgICAgRy50bi5kZWZhdWx0U2l6ZS5nZXRPdXRlcldpZHRoKCk7XHJcbiAgICAgIHZhciBuYlRuID0gICAgICAgIEcuR09NLml0ZW1zLmxlbmd0aDtcclxuICAgICAgdmFyIGN1clBvc1kgPSAwO1xyXG5cclxuICAgICAgaWYoIEcuTy50aHVtYm5haWxBbGlnbm1lbnQgPT0gJ2p1c3RpZmllZCcgKSB7XHJcbiAgICAgICAgbWF4Q29sID0gTWF0aC5taW4obWF4Q29sLCBuYlRuKTtcclxuICAgICAgICBndXR0ZXJXaWR0aCA9ICggbWF4Q29sID09IDEgPyAwIDogKGFyZWFXaWR0aCAtIChtYXhDb2wgKiB0bldpZHRoKSApIC8gKG1heENvbCAtIDEpICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZ3V0dGVyV2lkdGg9Ry50bi5vcHQuR2V0KCdndXR0ZXJXaWR0aCcpO1xyXG4gICAgICB9XHJcblxyXG5cclxuICAgICAgdmFyIGJvcmRlcldpZHRoID0gRy50bi5ib3JkZXJXaWR0aCAqIDI7XHJcbiAgICAgIHZhciBib3JkZXJIZWlnaHQgPSBHLnRuLmJvcmRlckhlaWdodCAqIDI7XHJcblxyXG4gICAgICBHLkdPTS5sYXN0RnVsbFJvdz0tMTsgICAvLyBmZWF0dXJlIGRpc2FibGVkXHJcblxyXG4gICAgICAvLyBSZXRyaWV2ZSB0aGUgcmVhbCB1c2VkIHdpZHRoIG9mIHRoZSBhcmVhICh0aGUgZXZhbHVhdGlvbiBpcyBiYXNlZCBvbiB0aGUgY29udGVudCBvZiB0aGUgZmlyc3QgbGluZSlcclxuICAgICAgaWYoIEcuTy50aHVtYm5haWxBbGlnbm1lbnQgPT0gJ2ZpbGxXaWR0aCcgKSB7XHJcbiAgICAgICAgLy8gZmlsbFdpZHRoIC0tPiBldmFsdWF0ZSBzY2FsZSBmYWN0b3IgYW5kIG51bWJlciBvZiBjb2x1bW5zXHJcbiAgICAgICAgdmFyIHRvdGFsR3V0dGVyV2lkdGggPSAobWF4Q29sIC0gMSkgKiBndXR0ZXJXaWR0aDtcclxuICAgICAgICBzY2FsZUZhY3RvciA9IChhcmVhV2lkdGggLSB0b3RhbEd1dHRlcldpZHRoKSAvIChtYXhDb2wgKiB0bldpZHRoKTtcclxuICAgICAgICBpZiggc2NhbGVGYWN0b3IgPiAxICkge1xyXG4gICAgICAgICAgbWF4Q29sKys7IC8vIGFkZCBvbmUgY29sdW1uIGFuZCByZS1ldmFsdWF0ZSB0aGUgc2NhbGUgZmFjdG9yXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRvdGFsR3V0dGVyV2lkdGggPSAobWF4Q29sIC0gMSkgKiBndXR0ZXJXaWR0aDtcclxuICAgICAgICBzY2FsZUZhY3RvciA9IE1hdGgubWluKCAoYXJlYVdpZHRoIC0gdG90YWxHdXR0ZXJXaWR0aCkgLyAobWF4Q29sKnRuV2lkdGgpLCAxKTsgICAvLyBubyB1cHNjYWxlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIFxyXG4gICAgICB0bldpZHRoID0gdG5XaWR0aCAqIHNjYWxlRmFjdG9yO1xyXG4gICAgICB2YXIgY29udGVudFdpZHRoID0gdG5XaWR0aCAtIGJvcmRlcldpZHRoO1xyXG5cclxuICAgICAgLy8gbG9vcCB0byBwb3NpdGlvbiB0aGUgdGh1bWJuYWlscywgYW5kIHNldCB0aGVpciBzaXplXHJcbiAgICAgIHZhciBiYXNlSGVpZ2h0ID0gRy50bi5vcHQuR2V0KCdiYXNlR3JpZEhlaWdodCcpICogc2NhbGVGYWN0b3I7XHJcbiAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbmJUbiA7IGkrKyApIHtcclxuICAgICAgICB2YXIgY3VyVG4gPSBHLkdPTS5pdGVtc1tpXTtcclxuICAgICAgICBpZiggY3VyVG4uZGVsZXRlZCA9PSB0cnVlICkgeyBicmVhazsgfSAgICAvLyBpdGVtIGlzIGxvZ2ljYWxseSBkZWxldGVkXHJcbiAgICAgICAgaWYoIGN1clRuLmltYWdlSGVpZ2h0ID4gMCAmJiBjdXJUbi5pbWFnZVdpZHRoID4gMCApIHtcclxuICAgICAgICAgIHZhciBjdXJQb3NYID0gMCxcclxuICAgICAgICAgIGN1clBvc1kgPSAwO1xyXG4gICAgICAgICAgdmFyIGltYWdlUmF0aW8gPSBjdXJUbi5pbWFnZUhlaWdodCAvIGN1clRuLmltYWdlV2lkdGg7XHJcbiAgICAgICAgICAvLyBjdXJUbi5yZXNpemVkQ29udGVudFdpZHRoID0gdG5XaWR0aCAtIGJvcmRlcldpZHRoO1xyXG4gICAgICAgICAgY3VyVG4ucmVzaXplZENvbnRlbnRXaWR0aCA9IGNvbnRlbnRXaWR0aDtcclxuICAgICAgICAgIGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0ID0gY3VyVG4ucmVzaXplZENvbnRlbnRXaWR0aCAqIGltYWdlUmF0aW87XHJcbiAgICAgICAgICBpZiggYmFzZUhlaWdodCA+IDAgKSB7XHJcbiAgICAgICAgICAgIC8vIGdyaWQgYmFzZWQgdmVydGljYWwgcG9zaXRpb25cclxuICAgICAgICAgICAgdmFyIHQ9IE1hdGgubWF4KCBNYXRoLnRydW5jKGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0L2Jhc2VIZWlnaHQpLCAxKSA7XHJcbiAgICAgICAgICAgIGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0ID0gYmFzZUhlaWdodCAqIHQgKyAoKHQtMSkqKGJvcmRlckhlaWdodCtndXR0ZXJIZWlnaHQpKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgY3VyVG4uaGVpZ2h0ID0gY3VyVG4ucmVzaXplZENvbnRlbnRIZWlnaHQgKyBib3JkZXJIZWlnaHQgKyBHLnRuLmxhYmVsSGVpZ2h0LmdldCgpO1xyXG4gICAgICAgICAgY3VyVG4ud2lkdGggPSB0bldpZHRoO1xyXG4gICAgICAgICAgY3VyVG4ucm93ID0gMDtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYoIGN1clJvdyA9PSAwICkge1xyXG4gICAgICAgICAgICAvLyBmaXJzdCByb3dcclxuICAgICAgICAgICAgY3VyUG9zWCA9IGN1ckNvbCAqICh0bldpZHRoICsgZ3V0dGVyV2lkdGgpO1xyXG4gICAgICAgICAgICBjb2xIZWlnaHRbY3VyQ29sXSA9IGN1clRuLmhlaWdodCArIGd1dHRlckhlaWdodDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGN1ckNvbCsrO1xyXG4gICAgICAgICAgICBpZiggY3VyQ29sID49IG1heENvbCApIHtcclxuICAgICAgICAgICAgICBjdXJDb2wgPSAwO1xyXG4gICAgICAgICAgICAgIGN1clJvdysrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGM9MCxcclxuICAgICAgICAgICAgbWluQ29sSGVpZ2h0PWNvbEhlaWdodFswXTtcclxuICAgICAgICAgICAgZm9yKCB2YXIgaiA9IDE7IGogPCBtYXhDb2w7IGorKykge1xyXG4gICAgICAgICAgICAgIGlmKCAoY29sSGVpZ2h0W2pdICsgNSkgPCBtaW5Db2xIZWlnaHQgKSB7ICAgICAvLyArNSAtLT4gdGhyZXNob2xkXHJcbiAgICAgICAgICAgICAgICBtaW5Db2xIZWlnaHQgPSBjb2xIZWlnaHRbal07XHJcbiAgICAgICAgICAgICAgICBjID0gajtcclxuICAgICAgICAgICAgICAgIC8vYnJlYWs7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1clBvc1kgPSBjb2xIZWlnaHRbY107XHJcbiAgICAgICAgICAgIGN1clBvc1ggPSBjICogKHRuV2lkdGggKyBndXR0ZXJXaWR0aCk7XHJcbiAgICAgICAgICAgIGNvbEhlaWdodFtjXSA9IGN1clBvc1kgKyBjdXJUbi5oZWlnaHQgKyBndXR0ZXJIZWlnaHQ7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdmFyIHggPSBjdXJQb3NYO1xyXG4gICAgICAgICAgaWYoIEcuTy5SVEwpIHtcclxuICAgICAgICAgICAgeD0gdyAtIGN1clBvc1ggLSB0bldpZHRoO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGN1clRuLmxlZnQgPSB4O1xyXG4gICAgICAgICAgY3VyVG4udG9wID0gY3VyUG9zWTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIEcuR09NLmRpc3BsYXlBcmVhLndpZHRoPSBtYXhDb2wgKiAodG5XaWR0aCArIGd1dHRlcldpZHRoKSAtIGd1dHRlcldpZHRoO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAvLy0tLS0tIEpVU1RJRklFRCBMQVlPVVRcclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlTZXRMYXlvdXRXaWR0aHRBdXRvKCkge1xyXG4gICAgICB2YXIgY3VyV2lkdGggPSAgICAgICAgICAgICAgIDAsXHJcbiAgICAgIGFyZWFXaWR0aCA9ICAgICAgICAgICAgICAgICAgRy5HT00uY2FjaGUuYXJlYVdpZHRoLFxyXG4gICAgICBsYXN0UG9zWCA9ICAgICAgICAgICAgICAgICAgIDAsXHJcbiAgICAgIGN1clBvc1kgPSAgICAgICAgICAgICAgICAgICAgMCxcclxuICAgICAgcm93TGFzdEl0ZW0gPSAgICAgICAgICAgICAgICBbXSxcclxuICAgICAgcm93TnVtID0gICAgICAgICAgICAgICAgICAgICAwLFxyXG4gICAgICByb3dIZWlnaHQgPSAgICAgICAgICAgICAgICAgIFtdLFxyXG4gICAgICBiTmV3Um93ID0gICAgICAgICAgICAgICAgICAgIGZhbHNlLFxyXG4gICAgICBjbnQgPSAgICAgICAgICAgICAgICAgICAgICAgIDAsXHJcbiAgICAgIGd1dHRlcldpZHRoID0gICAgICAgICAgICAgICAgRy50bi5vcHQuR2V0KCdndXR0ZXJXaWR0aCcpLFxyXG4gICAgICBndXR0ZXJIZWlnaHQgPSAgICAgICAgICAgICAgIEcudG4ub3B0LkdldCgnZ3V0dGVySGVpZ2h0Jyk7XHJcbiAgICAgIC8vIGJ5IGdyaWVmLW9mLXRoZXNlLWRheXNcclxuICAgICAgdmFyIG1heFJvd0hlaWdodFZlcnRpY2FsID0gICAwOyAvLyBtYXggaGVpZ2h0IG9mIGEgcm93IHdpdGggdmVydGljYWwgdGh1bWJzXHJcbiAgICAgIHZhciBtYXhSb3dIZWlnaHRIb3Jpem9udGFsID0gMDsgLy8gbWF4IGhlaWdodCBvZiBhIHJvdyB3aXRoIGhvcml6b250YWwgdGh1bWJzXHJcbiAgICAgIHZhciByb3dIYXNWZXJ0aWNhbCA9ICAgICAgICAgZmFsc2U7IC8vIGN1cnJlbnQgcm93IGhhcyB2ZXJ0aWNhbCB0aHVtYnNcclxuICAgICAgdmFyIHJvd0hhc0hvcml6b250YWwgPSAgICAgICBmYWxzZTsgLy8gY3VycmVudCByb3cgaGFzIGhvcml6b250YWwgdGh1bWJzXHJcblxyXG4gICAgICB2YXIgdG5IZWlnaHQgPSBHLnRuLmRlZmF1bHRTaXplLmdldE91dGVySGVpZ2h0KCk7XHJcbiAgICAgIHZhciBib3JkZXJXaWR0aCA9IEcudG4uYm9yZGVyV2lkdGggKiAyO1xyXG4gICAgICB2YXIgYm9yZGVySGVpZ2h0ID0gRy50bi5ib3JkZXJIZWlnaHQgKiAyO1xyXG4gICAgICB2YXIgbmJUbkluQ3VyclJvdyA9IDE7XHJcbiAgICAgIHZhciBuYlRuID0gRy5HT00uaXRlbXMubGVuZ3RoO1xyXG5cclxuICAgICAgLy8gZmlyc3QgbG9vcCAtLT4gcmV0cmlldmUgZWFjaCByb3cgaW1hZ2UgaGVpZ2h0XHJcbiAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbmJUbiA7IGkrKyApIHtcclxuICAgICAgICB2YXIgY3VyVG4gPSBHLkdPTS5pdGVtc1tpXTtcclxuICAgICAgICBpZiggY3VyVG4uZGVsZXRlZCA9PSB0cnVlICkgeyBicmVhazsgfSAgICAvLyBpdGVtIGlzIGxvZ2ljYWxseSBkZWxldGVkXHJcbiAgICAgICAgaWYoIGN1clRuLmltYWdlV2lkdGggPiAwICkge1xyXG4gICAgICAgICAgdmFyIGltYWdlUmF0aW8gPSBjdXJUbi5pbWFnZVdpZHRoIC8gY3VyVG4uaW1hZ2VIZWlnaHQ7XHJcbiAgICAgICAgICB2YXIgaW1hZ2VXaWR0aCA9IE1hdGguZmxvb3IoIHRuSGVpZ2h0ICogaW1hZ2VSYXRpbyApO1xyXG5cclxuICAgICAgICAgIGlmKCBiTmV3Um93ICkge1xyXG4gICAgICAgICAgICBiTmV3Um93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJvd051bSsrO1xyXG4gICAgICAgICAgICBjdXJXaWR0aCA9IDA7XHJcbiAgICAgICAgICAgIHJvd0hhc1ZlcnRpY2FsID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHJvd0hhc0hvcml6b250YWwgPSBmYWxzZTtcclxuICAgICAgICAgICAgbmJUbkluQ3VyclJvdyA9IDE7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyBieSBncmllZi1vZi10aGVzZS1kYXlzXHJcbiAgICAgICAgICBpZiggY3VyVG4uaW1hZ2VIZWlnaHQgPiBjdXJUbi5pbWFnZVdpZHRoICkge1xyXG4gICAgICAgICAgICByb3dIYXNWZXJ0aWNhbCA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcm93SGFzSG9yaXpvbnRhbCA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIGlmKCAoY3VyV2lkdGggKyBndXR0ZXJXaWR0aCArIGltYWdlV2lkdGgpIDwgKGFyZWFXaWR0aCAtIChuYlRuSW5DdXJyUm93ICogYm9yZGVyV2lkdGgpKSApIHtcclxuICAgICAgICAgICAgLy8gZW5vdWdoIHBsYWNlIGxlZnQgaW4gdGhlIGN1cnJlbnQgcm93XHJcbiAgICAgICAgICAgIGN1cldpZHRoICs9IGltYWdlV2lkdGggKyBndXR0ZXJXaWR0aDtcclxuICAgICAgICAgICAgcm93SGVpZ2h0W3Jvd051bV0gPSB0bkhlaWdodDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIHByZXZlbnQgaW5jb21wbGV0ZSByb3cgZnJvbSBiZWluZyBoZWlnaGVyIHRoYW4gdGhlIHByZXZpb3VzIG9uZXMuXHJcbiAgICAgICAgICAgIC8vIGJ5IGdyaWVmLW9mLXRoZXNlLWRheXNcclxuICAgICAgICAgICAgdmFyIHJvd0hlaWdodExpbWl0ID0gTWF0aC5tYXgocm93SGFzVmVydGljYWwgPyBtYXhSb3dIZWlnaHRWZXJ0aWNhbCA6IDAsIHJvd0hhc0hvcml6b250YWwgPyBtYXhSb3dIZWlnaHRIb3Jpem9udGFsIDogMCk7XHJcbiAgICAgICAgICAgIGlmKCByb3dIZWlnaHRMaW1pdCA+IDAgKSB7XHJcbiAgICAgICAgICAgICAgcm93SGVpZ2h0W3Jvd051bV0gPSBNYXRoLm1pbihyb3dIZWlnaHRbcm93TnVtXSwgcm93SGVpZ2h0TGltaXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByb3dMYXN0SXRlbVtyb3dOdW1dID0gaTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBuZXcgcm93IGFmdGVyIGN1cnJlbnQgaXRlbSAtLT4gd2UgbmVlZCB0byBhZHVqZXQgdGhlIHJvdyBoZWlnaHQgdG8gaGF2ZSBlbm91Z2ggc3BhY2UgZm9yIHRoZSBjdXJyZW50IHRodW1ibmFpbFxyXG4gICAgICAgICAgICBjdXJXaWR0aCArPSBndXR0ZXJXaWR0aCtpbWFnZVdpZHRoO1xyXG4gICAgICAgICAgICB2YXIgcmF0aW8gPSAoYXJlYVdpZHRoIC0gbmJUbkluQ3VyclJvdyAqIGJvcmRlcldpZHRoKSAvIGN1cldpZHRoO1xyXG4gICAgICAgICAgICB2YXIgckggPSBNYXRoLmZsb29yKHRuSGVpZ2h0ICogcmF0aW8pO1xyXG4gICAgICAgICAgICByb3dIZWlnaHRbcm93TnVtXSA9IHJIO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gc2F2ZSB0aGUgbWF4IHJvdyBoZWlnaHQgZm9yIGVhY2ggdGh1bWIgb3JpZW50YXRpb24uXHJcbiAgICAgICAgICAgIC8vIGJ5IGdyaWVmLW9mLXRoZXNlLWRheXNcclxuICAgICAgICAgICAgaWYoIHJvd0hhc1ZlcnRpY2FsICkge1xyXG4gICAgICAgICAgICAgIG1heFJvd0hlaWdodFZlcnRpY2FsID0gTWF0aC5tYXgoIG1heFJvd0hlaWdodFZlcnRpY2FsLCBySCApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCByb3dIYXNIb3Jpem9udGFsICkge1xyXG4gICAgICAgICAgICAgIG1heFJvd0hlaWdodEhvcml6b250YWwgPSBNYXRoLm1heCggbWF4Um93SGVpZ2h0SG9yaXpvbnRhbCwgckggKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcm93TGFzdEl0ZW1bcm93TnVtXSA9IGk7XHJcbiAgICAgICAgICAgIGJOZXdSb3cgPSB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY250Kys7XHJcbiAgICAgICAgICBuYlRuSW5DdXJyUm93Kys7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICByb3dOdW0gPSAwO1xyXG4gICAgICBjdXJQb3NZID0gMDtcclxuICAgICAgbGFzdFBvc1ggPSAwO1xyXG4gICAgICBjbnQgPSAwO1xyXG4gICAgICBcclxuICAgICAgRy5HT00ubGFzdEZ1bGxSb3cgPSAwOyAgICAvLyBkaXNwbGF5IGF0IGxlYXQgMSByb3cgKGV2ZW4gaWYgbm90IGZ1bGwpXHJcbiAgICAgIFxyXG4gICAgICAvLyBzZWNvbmQgbG9vcCAtLT4gY2FsY3VsYXRlIGVhY2ggdGh1bWJuYWlsIHNpemVcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBuYlRuIDsgaSsrICkge1xyXG4gICAgICAgIHZhciBjdXJUbiA9IEcuR09NLml0ZW1zW2ldO1xyXG4gICAgICAgIGlmKCBjdXJUbi5pbWFnZVdpZHRoID4gMCApIHtcclxuICAgICAgICAgIHZhciBpbWFnZVJhdGlvID0gY3VyVG4uaW1hZ2VXaWR0aCAvIGN1clRuLmltYWdlSGVpZ2h0O1xyXG4gICAgICAgICAgdmFyIGltYWdlV2lkdGggPSBNYXRoLmZsb29yKCBpbWFnZVJhdGlvICogcm93SGVpZ2h0W3Jvd051bV0gKTsgLy8gYm9yZGVyIGlzIGFscmVhZHkgTk9UIGluY2x1ZGVkXHJcblxyXG4gICAgICAgICAgaWYoIGkgPT0gcm93TGFzdEl0ZW1bcm93TnVtXSApIHtcclxuICAgICAgICAgICAgLy8gcm93IGxhc3QgaXRlbSAtLT4gYWRqdXN0IGltYWdlIHdpZHRoIGJlY2F1c2Ugb2Ygcm91bmRpbmcgcHJvYmxlbXNcclxuICAgICAgICAgICAgaWYoIHJvd0xhc3RJdGVtLmxlbmd0aCAhPSAocm93TnVtKzEpICkge1xyXG4gICAgICAgICAgICAgIC8vIGxhc3QgaXRlbSBpbiBjdXJyZW50IHJvdyAtPiB1c2UgdGhlIGZ1bGwgcmVtYWluaW5nIHdpZHRoXHJcbiAgICAgICAgICAgICAgaW1hZ2VXaWR0aCA9IGFyZWFXaWR0aCAtIGxhc3RQb3NYIC0gYm9yZGVyV2lkdGg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gdmVyeSBsYXN0IGl0ZW0gKG9uIHRoZSBsYXN0IHJvdylcclxuICAgICAgICAgICAgICBpZiggKGxhc3RQb3NYICsgZ3V0dGVyV2lkdGggKyBpbWFnZVdpZHRoICsgYm9yZGVyV2lkdGggKSA+IGFyZWFXaWR0aCApIHtcclxuICAgICAgICAgICAgICAgIC8vIHJlZHVjZSBzaXplIGlmIGltYWdlIGlzIHdpZGVyIGFzIHRoZSByZW1haW5pbmcgc3BhY2VcclxuICAgICAgICAgICAgICAgIGltYWdlV2lkdGggPSBhcmVhV2lkdGggLSBsYXN0UG9zWCAtIGJvcmRlcldpZHRoO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICB2YXIgcmggPSBwYXJzZUludCggcm93SGVpZ2h0W3Jvd051bV0gKTtcclxuICAgICAgICAgIGltYWdlV2lkdGggPSBwYXJzZUludCggaW1hZ2VXaWR0aCApO1xyXG5cclxuICAgICAgICAgIC8vIHRodW1ibmFpbCBpbWFnZSBzaXplXHJcbiAgICAgICAgICBjdXJUbi5yZXNpemVkQ29udGVudFdpZHRoID0gaW1hZ2VXaWR0aDtcclxuICAgICAgICAgIGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0ID0gcmg7XHJcbiAgICAgICAgICAvLyB0aHVtYm5haWwgcG9zaXRpb24gYW5kIHNpemVcclxuICAgICAgICAgIGN1clRuLndpZHRoID0gaW1hZ2VXaWR0aCArIGJvcmRlcldpZHRoO1xyXG4gICAgICAgICAgY3VyVG4uaGVpZ2h0PSByaCArIEcudG4ubGFiZWxIZWlnaHQuZ2V0KCkgKyBib3JkZXJIZWlnaHQ7XHJcbiAgICAgICAgICBjdXJUbi5yb3cgPSByb3dOdW07XHJcblxyXG4gICAgICAgICAgY3VyVG4udG9wID0gY3VyUG9zWTtcclxuICAgICAgICAgIHZhciB4ID0gbGFzdFBvc1g7XHJcbiAgICAgICAgICBpZiggRy5PLlJUTCkge1xyXG4gICAgICAgICAgICB4ID0gYXJlYVdpZHRoIC0gbGFzdFBvc1ggLSBjdXJUbi53aWR0aCA7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBjdXJUbi5sZWZ0ID0geDtcclxuXHJcbiAgICAgICAgICBsYXN0UG9zWCArPSBjdXJUbi53aWR0aCArIGd1dHRlcldpZHRoO1xyXG5cclxuICAgICAgICAgIGlmKCBpID09IHJvd0xhc3RJdGVtW3Jvd051bV0gKSB7XHJcbiAgICAgICAgICAgIC8vIHN0YXJ0IGEgbmV3IHJvd1xyXG4gICAgICAgICAgICBjdXJQb3NZICs9IGN1clRuLmhlaWdodCArIGd1dHRlckhlaWdodDtcclxuICAgICAgICAgICAgRy5HT00ubGFzdEZ1bGxSb3cgPSByb3dOdW0gLSAxO1xyXG4gICAgICAgICAgICByb3dOdW0rKztcclxuICAgICAgICAgICAgbGFzdFBvc1ggPSAwO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY250Kys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYoIGZhbHNlICkge1xyXG4gICAgICAgIHZhciBuZXdUb3AgPSAwO1xyXG4gICAgICAgIGlmKCB0eXBlb2YgR09NaWR4ICE9PSAndW5kZWZpbmVkJyApIHtcclxuICAgICAgICAgIC8vIGhvdmVyIGVmZmVjdCBvbiBnYWxsZXJ5ICh2cyBvbiB0aHVtYm5haWwpIC0tPiBleHBlcmltZW50YWwgLyBub3QgdXNlZFxyXG4gICAgICAgICAgaWYoIEcuR09NLmFsYnVtSWR4ICE9IC0xICkge1xyXG4gICAgICAgICAgICB2YXIgaG92ZXJlZFRuID0gRy5HT00uaXRlbXNbR09NaWR4XTtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBHLklbaG92ZXJlZFRuLnRodW1ibmFpbElkeF07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBob3ZlcmVkIHRodW1ibmFpbFxyXG4gICAgICAgICAgICBob3ZlcmVkVG4ud2lkdGggKz0gNDA7XHJcbiAgICAgICAgICAgIGhvdmVyZWRUbi5oZWlnaHQgKz0gNDA7XHJcbiAgICAgICAgICAgIC8vIHRvZG8gOiBsZWZ0XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IoIHZhciBpID0gMDsgaSA8IG5iVG4gOyBpKysgKSB7XHJcbiAgICAgICAgICAgICAgdmFyIGN1clRuID0gRy5HT00uaXRlbXNbaV07XHJcbiAgICAgICAgICAgICAgaWYoIGN1clRuLmltYWdlV2lkdGggPiAwICkge1xyXG4gICAgICAgICAgICAgICAgaWYoIGN1clRuLnJvdyA9PSBob3ZlcmVkVG4ucm93ICkge1xyXG4gICAgICAgICAgICAgICAgICAvLyBob3ZlcmVkIHJvd1xyXG4gICAgICAgICAgICAgICAgICBuZXdUb3AgPSA0MDtcclxuICAgICAgICAgICAgICAgICAgaWYoIGhvdmVyZWRUbi50aHVtYm5haWxJZHggIT0gY3VyVG4udGh1bWJuYWlsSWR4ICkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vdCBob3ZlcmVkIHRodW1ibmFpbFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIGN1clRuLnJlc2l6ZWRDb250ZW50V2lkdGgrPTEwO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0Kz0yMDtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjdXJUbi53aWR0aCs9MTA7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VyVG4udG9wICs9IDMwO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1clRuLndpZHRoIC09IDIwO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1clRuLmhlaWdodCAtPSAyMDtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIG5vdCBob3ZlcmVkIHJvd1xyXG4gICAgICAgICAgICAgICAgICBpZiggY3VyVG4ucm93ID09IDAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZmlyc3Qgcm93XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VyVG4udG9wICs9IG5ld1RvcDtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgRy5HT00uZGlzcGxheUFyZWEud2lkdGggPSBhcmVhV2lkdGg7XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSAgICBcclxuICAgIFxyXG5cclxuICAgIC8vLS0tLS0gTU9TQUlDIExBWU9VVFxyXG4gICAgLy8gR3JpZCB1c2luZyBhIHVzZXIgZGVmaW5lZCBwYXR0ZXJuIGxheW91dFxyXG4gICAgLy8gV2l0aCB0aGlzIGxheW91dCwgYSBwYXR0ZXJuIGRlZmluaXRpb24gaXMgaGFuZGVsZCBhIHJvd1xyXG4gICAgZnVuY3Rpb24gR2FsbGVyeVNldExheW91dE1vc2FpYygpIHtcclxuICAgICAgdmFyIGFyZWFXaWR0aCA9ICAgICBHLkdPTS5jYWNoZS5hcmVhV2lkdGg7XHJcbiAgICAgIHZhciBndXR0ZXJIZWlnaHQgPSAgRy50bi5vcHQuR2V0KCdndXR0ZXJIZWlnaHQnKTtcclxuICAgICAgdmFyIGd1dHRlcldpZHRoID0gICBHLnRuLm9wdC5HZXQoJ2d1dHRlcldpZHRoJyk7XHJcbiAgICAgIHZhciBib3JkZXJXaWR0aCA9ICAgRy50bi5ib3JkZXJXaWR0aCAqIDI7XHJcbiAgICAgIHZhciBib3JkZXJIZWlnaHQgPSAgRy50bi5ib3JkZXJIZWlnaHQgKiAyO1xyXG5cclxuICAgICAgdmFyIG5iVG4gPSBHLkdPTS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgIHZhciByb3cgPSAwO1xyXG4gICAgICB2YXIgaCA9IDA7XHJcbiAgICAgIHZhciBuID0gMDtcclxuICAgICAgXHJcbiAgICAgIFxyXG4gICAgICAvLyBmaXJzdCBsb29wOiBldmFsdWF0ZSB0aGUgZ2FsbGVyeSB3aWR0aCBiYXNlZCBvbiB0aGUgZmlyc3Qgcm93XHJcbiAgICAgIHZhciBuYkNvbHMgPSAwO1xyXG4gICAgICB2YXIgbWF4VyA9IDA7XHJcbiAgICAgIHZhciBtb3NhaWNQYXR0ZXJuID0gRy50bi5zZXR0aW5ncy5nZXRNb3NhaWMoKTtcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBuYlRuIDsgaSsrICkge1xyXG4gICAgICAgIHZhciBjdXJQYXR0ZXJuRWx0ID0gbW9zYWljUGF0dGVybltuXTtcclxuXHJcbiAgICAgICAgdmFyIGNMZWZ0ID0gKGN1clBhdHRlcm5FbHQuYyAtIDEpICogRy50bi5kZWZhdWx0U2l6ZS5nZXRPdXRlcldpZHRoKCkgKyAoY3VyUGF0dGVybkVsdC5jIC0gMSkgKiBndXR0ZXJXaWR0aDtcclxuICAgICAgICB2YXIgY1dpZHRoID0gY3VyUGF0dGVybkVsdC53ICogRy50bi5kZWZhdWx0U2l6ZS5nZXRPdXRlcldpZHRoKCkgKyAoY3VyUGF0dGVybkVsdC53IC0gMSkgKiBndXR0ZXJXaWR0aDtcclxuICAgICAgICBcclxuICAgICAgICBtYXhXPU1hdGgubWF4KG1heFcsIGNMZWZ0ICsgY1dpZHRoICk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbmJDb2xzPU1hdGgubWF4KG5iQ29scywgKGN1clBhdHRlcm5FbHQuYyAtIDEpICsgY3VyUGF0dGVybkVsdC53ICk7XHJcblxyXG4gICAgICAgIG4rKztcclxuICAgICAgICBpZiggbiA+PSBtb3NhaWNQYXR0ZXJuLmxlbmd0aCApIHtcclxuICAgICAgICAgIC8vIGVuZCBvZiBwYXR0ZXJuXHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgdmFyIHRvdGFsR3V0dGVyV2lkdGggPSAobmJDb2xzIC0gMSkgKiBndXR0ZXJXaWR0aDtcclxuICAgICAgdmFyIHNjYWxlRmFjdG9yID0gTWF0aC5taW4oIChhcmVhV2lkdGggLSB0b3RhbEd1dHRlcldpZHRoICkgLyAoIG1heFcgLSB0b3RhbEd1dHRlcldpZHRoICksIDEpO1xyXG4gICAgICBcclxuICAgICAgLy8gc2Vjb25kIGxvb3A6IHBvc2l0aW9uIGFsbCB0aGUgdGh1bWJuYWlscyBiYXNlZCBvbiB0aGUgbGF5b3V0IHBhdHRlcm5cclxuICAgICAgcm93ID0gMDtcclxuICAgICAgbiA9IDA7XHJcbiAgICAgIHZhciBtb3NhaWNQYXR0ZXJuID0gRy50bi5zZXR0aW5ncy5nZXRNb3NhaWMoKTtcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBuYlRuIDsgaSsrICkge1xyXG4gICAgICAgIHZhciBjdXJUbiA9IEcuR09NLml0ZW1zW2ldO1xyXG4gICAgICAgIHZhciBjdXJQYXR0ZXJuRWx0ID0gbW9zYWljUGF0dGVybltuXTtcclxuICAgICAgICBcclxuICAgICAgICBjdXJUbi50b3AgPSAoY3VyUGF0dGVybkVsdC5yIC0gMSkgKiBHLnRuLmRlZmF1bHRTaXplLmdldE91dGVySGVpZ2h0KCkqc2NhbGVGYWN0b3IgKyAoY3VyUGF0dGVybkVsdC5yIC0gMSkgKiBndXR0ZXJIZWlnaHQgKyByb3cgKiBoICsgKEcudG4ubGFiZWxIZWlnaHQuZ2V0KCkqKGN1clBhdHRlcm5FbHQuci0xKSkgO1xyXG4gICAgICAgIGlmKCByb3cgPiAwICkge1xyXG4gICAgICAgICAgY3VyVG4udG9wICs9IGd1dHRlckhlaWdodDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGN1clRuLmxlZnQgPSAoY3VyUGF0dGVybkVsdC5jIC0gMSkgKiBHLnRuLmRlZmF1bHRTaXplLmdldE91dGVyV2lkdGgoKSpzY2FsZUZhY3RvciArIChjdXJQYXR0ZXJuRWx0LmMgLSAxKSAqIGd1dHRlcldpZHRoO1xyXG5cclxuICAgICAgICBjdXJUbi5oZWlnaHQgPSBjdXJQYXR0ZXJuRWx0LmggKiBHLnRuLmRlZmF1bHRTaXplLmdldE91dGVySGVpZ2h0KCkgKiBzY2FsZUZhY3RvciArIChjdXJQYXR0ZXJuRWx0LmggLSAxKSAqIGd1dHRlckhlaWdodCArIChHLnRuLmxhYmVsSGVpZ2h0LmdldCgpICogY3VyUGF0dGVybkVsdC5oKTtcclxuICAgICAgICBjdXJUbi5yZXNpemVkQ29udGVudEhlaWdodCA9IGN1clRuLmhlaWdodCAtIEcudG4ubGFiZWxIZWlnaHQuZ2V0KCkgLSBib3JkZXJIZWlnaHQ7XHJcblxyXG4gICAgICAgIGN1clRuLndpZHRoID0gY3VyUGF0dGVybkVsdC53ICogRy50bi5kZWZhdWx0U2l6ZS5nZXRPdXRlcldpZHRoKCkqc2NhbGVGYWN0b3IgKyAoY3VyUGF0dGVybkVsdC53IC0gMSkgKiBndXR0ZXJXaWR0aDtcclxuICAgICAgICBjdXJUbi5yZXNpemVkQ29udGVudFdpZHRoID0gY3VyVG4ud2lkdGggLSBib3JkZXJXaWR0aCA7XHJcblxyXG4gICAgICAgIGN1clRuLnJvdyA9IHJvdztcclxuICAgICAgICBpZiggcm93ID09IDAgKSB7XHJcbiAgICAgICAgICBoPU1hdGgubWF4KGgsIGN1clRuLnRvcCArIGN1clRuLmhlaWdodCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBuKys7XHJcbiAgICAgICAgaWYoIG4gPj0gbW9zYWljUGF0dGVybi5sZW5ndGggKSB7XHJcbiAgICAgICAgICAvLyBlbmQgcGF0dGVybiAtPiBuZXcgbGluZVxyXG4gICAgICAgICAgbiA9IDA7XHJcbiAgICAgICAgICByb3crKztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIEcuR09NLmRpc3BsYXlBcmVhLndpZHRoID0gKG1heFcgLSB0b3RhbEd1dHRlcldpZHRoKSAqIHNjYWxlRmFjdG9yICsgdG90YWxHdXR0ZXJXaWR0aDtcclxuICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyAtLS0gR1JJRCBMQVlPVVRcclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlTZXRMYXlvdXRHcmlkKCkge1xyXG4gICAgICB2YXIgY3VyUG9zWD0gICAgICAwLFxyXG4gICAgICBjdXJQb3NZPSAgICAgICAgICAwLCAgIFxyXG4gICAgICBhcmVhV2lkdGg9ICAgICAgICBHLkdPTS5jYWNoZS5hcmVhV2lkdGgsXHJcbiAgICAgIGd1dHRlcldpZHRoPSAgICAgIDAsXHJcbiAgICAgIGd1dHRlckhlaWdodD0gICAgIEcudG4ub3B0LkdldCgnZ3V0dGVySGVpZ2h0JyksXHJcbiAgICAgIG1heENvbD0gICAgICAgICAgIE5iVGh1bWJuYWlsc1BlclJvdyhhcmVhV2lkdGgpLFxyXG4gICAgICB3PSAgICAgICAgICAgICAgICAwLFxyXG4gICAgICBjb2xzPSAgICAgICAgICAgICBbXSxcclxuICAgICAgY3VyQ29sPSAgICAgICAgICAgMCxcclxuICAgICAgbmV3QXJlYVdpZHRoID0gICAgYXJlYVdpZHRoLFxyXG4gICAgICB0bldpZHRoPSAgICAgICAgICBHLnRuLmRlZmF1bHRTaXplLmdldE91dGVyV2lkdGgoKTtcclxuICAgICAgdmFyIHNjYWxlRmFjdG9yID0gMTtcclxuICAgICAgdmFyIG5iVG49ICAgICAgICAgRy5HT00uaXRlbXMubGVuZ3RoO1xyXG4gICAgICB2YXIgYm9yZGVyV2lkdGggPSBHLnRuLmJvcmRlcldpZHRoICogMjtcclxuICAgICAgdmFyIGJvcmRlckhlaWdodCA9Ry50bi5ib3JkZXJIZWlnaHQgKiAyO1xyXG4gICAgICBcclxuICAgICAgLy8gcmV0cmlldmUgZ3V0dGVyIHdpZHRoXHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsQWxpZ25tZW50ID09ICdqdXN0aWZpZWQnICkge1xyXG4gICAgICAgIG1heENvbCA9IE1hdGgubWluKCBtYXhDb2wsIG5iVG4pO1xyXG4gICAgICAgIGd1dHRlcldpZHRoID0gKG1heENvbD09MSA/IDAgOiAoYXJlYVdpZHRoLShtYXhDb2wqdG5XaWR0aCkpLyhtYXhDb2wtMSkpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIGd1dHRlcldpZHRoID0gRy50bi5vcHQuR2V0KCdndXR0ZXJXaWR0aCcpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBmaXJzdCBsb29wIHRvIHJldHJpZXZlIHRoZSByZWFsIHVzZWQgd2lkdGggb2YgdGhlIGFyZWEgKHRoZSBldmFsdWF0aW9uIGlzIGJhc2VkIG9uIHRoZSBjb250ZW50IG9mIHRoZSBmaXJzdCBsaW5lKVxyXG4gICAgICAvLyBSZXRyaWV2ZSB0aGUgcmVhbCB1c2VkIHdpZHRoIG9mIHRoZSBhcmVhICh0aGUgZXZhbHVhdGlvbiBpcyBiYXNlZCBvbiB0aGUgY29udGVudCBvZiB0aGUgZmlyc3QgbGluZSlcclxuICAgICAgaWYoIEcuTy5SVEwgfHwgRy5PLnRodW1ibmFpbEFsaWdubWVudCA9PSAnZmlsbFdpZHRoJyApIHtcclxuICAgICAgICAvLyBzY2FsZWQgLS0+IGV2YWx1YXRlIHNjYWxlIGZhY3RvciBhbmQgbnVtYmVyIG9mIGNvbHVtbnNcclxuICAgICAgICB2YXIgdG90YWxHdXR0ZXJXaWR0aCA9IChtYXhDb2wtMSkgKiBndXR0ZXJXaWR0aDtcclxuICAgICAgICBzY2FsZUZhY3RvciA9IChhcmVhV2lkdGggLSB0b3RhbEd1dHRlcldpZHRoKSAvIChtYXhDb2wqdG5XaWR0aCk7XHJcbiAgICAgICAgaWYoIHNjYWxlRmFjdG9yID4gMSApIHtcclxuICAgICAgICAgIG1heENvbCsrOyAvLyBhZGQgb25lIGNvbHVtbiBhbmQgcmUtZXZhbHVhdGUgdGhlIHNjYWxlIGZhY3RvclxyXG4gICAgICAgIH1cclxuICAgICAgICB0b3RhbEd1dHRlcldpZHRoID0gKG1heENvbC0xKSAqIGd1dHRlcldpZHRoO1xyXG4gICAgICAgIHNjYWxlRmFjdG9yID0gTWF0aC5taW4oIChhcmVhV2lkdGggLSB0b3RhbEd1dHRlcldpZHRoKSAvIChtYXhDb2wqdG5XaWR0aCksIDEpOyAgIC8vIG5vIHVwc2NhbGVcclxuICAgICAgICBuZXdBcmVhV2lkdGggPSAobWF4Q29sKnRuV2lkdGgpICsgdG90YWxHdXR0ZXJXaWR0aDtcclxuICAgICAgfVxyXG5cclxuICAgICAgXHJcbiAgICAgIEcuR09NLmxhc3RGdWxsUm93ID0gMCA7ICAgIC8vIGRpc3BsYXkgYXQgbGVhdCAxIHJvdyAoZXZlbiBpZiBub3QgZnVsbClcclxuICAgICAgdmFyIGxhc3RQb3NZID0gMDtcclxuICAgICAgdmFyIHJvdyA9IDA7XHJcbiAgICAgIFxyXG4gICAgICB0bldpZHRoID0gdG5XaWR0aCAqIHNjYWxlRmFjdG9yO1xyXG4gICAgICB2YXIgY29udGVudFdpZHRoID0gdG5XaWR0aCAtIGJvcmRlcldpZHRoO1xyXG4gICAgICB2YXIgdG5IZWlnaHQgPSBHLnRuLmRlZmF1bHRTaXplLmdldE91dGVySGVpZ2h0KCkgKiBzY2FsZUZhY3RvciArIEcudG4ubGFiZWxIZWlnaHQuZ2V0KCk7XHJcbiAgICAgIHZhciBjb250ZW50SGVpZ2h0ID0gRy50bi5kZWZhdWx0U2l6ZS5nZXRPdXRlckhlaWdodCgpICogc2NhbGVGYWN0b3IgLSBib3JkZXJIZWlnaHQ7XHJcbiAgICAgIFxyXG4gICAgICAvLyBsb29wIHRvIHBvc2l0aW9uIGFuZCB0byBzZXQgc2l6ZSBvZiBhbGwgdGh1bWJuYWlsc1xyXG4gICAgICBmb3IoIHZhciBpID0gMDsgaSA8IG5iVG4gOyBpKysgKSB7XHJcbiAgICAgICAgaWYoIGN1clBvc1kgPT0gMCApIHtcclxuICAgICAgICAgIGN1clBvc1ggPSBjdXJDb2wgKiAodG5XaWR0aCArIGd1dHRlcldpZHRoKVxyXG4gICAgICAgICAgY29sc1tjdXJDb2xdID0gY3VyUG9zWDtcclxuICAgICAgICAgIHcgPSBjdXJQb3NYICsgdG5XaWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBjdXJQb3NYID0gY29sc1tjdXJDb2xdO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHggPSBjdXJQb3NYO1xyXG4gICAgICAgIGlmKCBHLk8uUlRMICkge1xyXG4gICAgICAgICAgeCA9IHBhcnNlSW50KG5ld0FyZWFXaWR0aCkgLSBjdXJQb3NYIC0gdG5XaWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gTUFOREFUT1JZIDogc2V0IHRodW1ibmFpbCBwb3NpdGlvbiBBTkQgc2l6ZVxyXG4gICAgICAgIHZhciBjdXJUbj1HLkdPTS5pdGVtc1tpXTtcclxuICAgICAgICBjdXJUbi50b3AgPSBjdXJQb3NZO1xyXG4gICAgICAgIGN1clRuLmxlZnQgPSB4O1xyXG4gICAgICAgIGN1clRuLmhlaWdodCA9IHRuSGVpZ2h0O1xyXG4gICAgICAgIGN1clRuLndpZHRoID0gdG5XaWR0aDtcclxuICAgICAgICAvLyBpbWFnZSBzaXplXHJcbiAgICAgICAgaWYoIEcuTy50aHVtYm5haWxBbGlnbm1lbnQgPT0gJ2ZpbGxXaWR0aCcgKSB7XHJcbiAgICAgICAgICBjdXJUbi5yZXNpemVkQ29udGVudFdpZHRoID0gY29udGVudFdpZHRoO1xyXG4gICAgICAgICAgY3VyVG4ucmVzaXplZENvbnRlbnRIZWlnaHQgPSBjb250ZW50SGVpZ2h0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBjdXJUbi5yb3cgPSByb3c7XHJcbiAgICAgICAgbGFzdFBvc1kgPSBjdXJQb3NZO1xyXG5cclxuICAgICAgICBjdXJDb2wrKztcclxuICAgICAgICBpZiggY3VyQ29sID49IG1heENvbCApe1xyXG4gICAgICAgICAgLy8gbmV3IGxpbmVcclxuICAgICAgICAgIGN1ckNvbCA9IDA7XHJcbiAgICAgICAgICBjdXJQb3NZICs9IHRuSGVpZ2h0ICsgZ3V0dGVySGVpZ2h0O1xyXG4gICAgICAgICAgRy5HT00ubGFzdEZ1bGxSb3cgPSByb3c7XHJcbiAgICAgICAgICByb3crKztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgRy5HT00uZGlzcGxheUFyZWEud2lkdGggPSB3O1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8tLS0tLSBEaXNwbGF5IHRoZSB0aHVtYm5haWxzIGFjY29yZGluZyB0byB0aGUgY2FsY3VsYXRlZCBsYXlvdXRcclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlEaXNwbGF5UGFydDEoIGZvcmNlVHJhbnNpdGlvbiApIHtcclxuICAgICAgaWYoIEcuQ1NTdHJhbnNmb3JtTmFtZSA9PSBudWxsICkge1xyXG4gICAgICAgIEcuJEUuY29uVG4uY3NzKCAnbGVmdCcgLCAnMHB4Jyk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgRy4kRS5jb25Ubi5jc3MoIEcuQ1NTdHJhbnNmb3JtTmFtZSAsICdub25lJyk7XHJcbiAgICAgIH1cclxuICAgICAgQ2FjaGVWaWV3cG9ydCgpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBDYWNoZVZpZXdwb3J0KCkge1xyXG4gICAgICBHLkdPTS5jYWNoZS52aWV3cG9ydCA9IGdldFZpZXdwb3J0KCk7XHJcbiAgICAgIEcuR09NLmNhY2hlLmFyZWFXaWR0aCA9IEcuJEUuY29uVG5QYXJlbnQud2lkdGgoKTtcclxuICAgICAgRy5HT00uY2FjaGUuY29udGFpbmVyT2Zmc2V0ID0gRy4kRS5jb25UblBhcmVudC5vZmZzZXQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5RGlzcGxheVBhcnQyKCBmb3JjZVRyYW5zaXRpb24gKSB7XHJcblxyXG4gICAgICB2YXIgbmJUbiA9IEcuR09NLml0ZW1zLmxlbmd0aDtcclxuICAgICAgRy5HT00uaXRlbXNEaXNwbGF5ZWQgPSAwO1xyXG4gICAgICB2YXIgdGhyZXNob2xkID0gNTA7XHJcbiAgICAgIHZhciBjbnQgPSAwOyAgICAvLyBjb3VudGVyIGZvciBkZWxheSBiZXR3ZWVuIGVhY2ggdGh1bWJuYWlsIGRpc3BsYXlcclxuICAgICAgXHJcblxyXG4gICAgICBHYWxsZXJ5UmVuZGVyR2V0SW50ZXJ2YWwoKTtcclxuICAgICAgXHJcbiAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbmJUbiA7IGkrKyApIHtcclxuICAgICAgICB2YXIgY3VyVG4gPSBHLkdPTS5pdGVtc1tpXTtcclxuICAgICAgICBpZiggaSA+PSBHLkdPTS5kaXNwbGF5SW50ZXJ2YWwuZnJvbSAmJiBjbnQgPCBHLkdPTS5kaXNwbGF5SW50ZXJ2YWwubGVuICkge1xyXG4gICAgICAgICAgY3VyVG4uaW5EaXNwbGF5QXJlYSA9IHRydWU7XHJcbiAgICAgICAgICBpZiggZm9yY2VUcmFuc2l0aW9uICkge1xyXG4gICAgICAgICAgICBjdXJUbi5uZXZlckRpc3BsYXllZCA9IHRydWU7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBHLkdPTS5pdGVtc0Rpc3BsYXllZCsrO1xyXG4gICAgICAgICAgY250Kys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2V7XHJcbiAgICAgICAgICBjdXJUbi5pbkRpc3BsYXlBcmVhID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBib3R0b20gb2YgdGhlIGdhbGxlcnkgKHBhZ2luYXRpb24sIG1vcmUgYnV0dG9uLi4uKVxyXG4gICAgICBHYWxsZXJ5Qm90dG9tTWFuYWdlKCk7XHJcblxyXG4gICAgICB2YXIgdG5Ub0Rpc3BsYXkgPSBbXTtcclxuICAgICAgdmFyIHRuVG9SZURpc3BsYXkgPSBbXTtcclxuICAgICAgXHJcbiAgICAgIEcuR09NLmNsaXBBcmVhLnRvcCA9IC0xO1xyXG4gICAgICBjbnQgPSAwIDtcclxuICAgICAgdmFyIGxhc3RUbklkeCA9IC0xO1xyXG4gICAgICBHLkdPTS5jbGlwQXJlYS5oZWlnaHQgPSAwO1xyXG4gICAgICAvLyBOT1RFOiBsb29wIGFsd2F5cyB0aGUgd2hvbGUgR09NLml0ZW1zIC0tPiBpbiBjYXNlIGFuIGFscmVhZHkgZGlzcGxheWVkIHRodW1ibmFpbCBuZWVkcyB0byBiZSByZW1vdmVkXHJcbiAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbmJUbiA7IGkrKyApIHtcclxuICAgICAgICB2YXIgY3VyVG4gPSBHLkdPTS5pdGVtc1tpXTtcclxuICAgICAgICBpZiggY3VyVG4uaW5EaXNwbGF5QXJlYSApIHtcclxuICAgICAgICAgIGlmKCBHLkdPTS5jbGlwQXJlYS50b3AgPT0gLTEgKSB7XHJcbiAgICAgICAgICAgIEcuR09NLmNsaXBBcmVhLnRvcCA9IGN1clRuLnRvcDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmKCAoY3VyVG4udG9wIC0gRy5HT00uY2xpcEFyZWEudG9wKSA8PSAtMSApIHtcclxuICAgICAgICAgICAgLy8gd2l0aCBtb3NhaWMgbGF5b3V0LCB0aGUgZmlyc3QgdGh1bWJuYWlsIG1heSBub3QgZ2l2ZSB0aGUgdG9wIHBvc2l0aW9uXHJcbiAgICAgICAgICAgIEcuR09NLmNsaXBBcmVhLnRvcCA9IGN1clRuLnRvcDtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBHLkdPTS5jbGlwQXJlYS5oZWlnaHQgPSBNYXRoLm1heCggRy5HT00uY2xpcEFyZWEuaGVpZ2h0LCBjdXJUbi50b3AtRy5HT00uY2xpcEFyZWEudG9wICsgY3VyVG4uaGVpZ2h0KTtcclxuICAgICAgICBcclxuICAgICAgICAgIGlmKCBjdXJUbi5uZXZlckRpc3BsYXllZCApIHtcclxuICAgICAgICAgICAgLy8gdGh1bWJuYWlsIGlzIG5vdCBkaXNwbGF5ZWQgLT4gY2hlY2sgaWYgaW4gdmlld3BvcnQgdG8gZGlzcGxheSBvciBub3RcclxuICAgICAgICAgICAgdmFyIHRvcCA9IEcuR09NLmNhY2hlLmNvbnRhaW5lck9mZnNldC50b3AgKyAoY3VyVG4udG9wIC0gRy5HT00uY2xpcEFyZWEudG9wKTtcclxuICAgICAgICAgICAgLy8gdmFyIGxlZnQ9Y29udGFpbmVyT2Zmc2V0LmxlZnQrY3VyVG4ubGVmdDtcclxuICAgICAgICAgICAgaWYoICh0b3AgKyBjdXJUbi5oZWlnaHQpID49IChHLkdPTS5jYWNoZS52aWV3cG9ydC50IC0gdGhyZXNob2xkKSAmJiB0b3AgPD0gKEcuR09NLmNhY2hlLnZpZXdwb3J0LnQgKyBHLkdPTS5jYWNoZS52aWV3cG9ydC5oICsgdGhyZXNob2xkKSApIHtcclxuICAgICAgICAgICAgICAvLyBidWlsZCB0aHVtYm5haWxcclxuICAgICAgICAgICAgICB2YXIgaXRlbSA9IEcuSVtjdXJUbi50aHVtYm5haWxJZHhdO1xyXG4gICAgICAgICAgICAgIGlmKCBpdGVtLiRlbHQgPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgICAgIFRodW1ibmFpbEJ1aWxkKCBpdGVtLCBjdXJUbi50aHVtYm5haWxJZHgsIGksIChpKzEpID09IG5iVG4gKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgdG5Ub0Rpc3BsYXkucHVzaCh7aWR4OmksIGRlbGF5OmNudH0pO1xyXG4gICAgICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdG5Ub1JlRGlzcGxheS5wdXNoKHtpZHg6IGksIGRlbGF5OiAwfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICAvLyBHLkdPTS5pdGVtc0Rpc3BsYXllZCsrO1xyXG4gICAgICAgICAgbGFzdFRuSWR4ID0gaTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBjdXJUbi5kaXNwbGF5ZWQgPSBmYWxzZTtcclxuICAgICAgICAgIHZhciBpdGVtID0gRy5JW2N1clRuLnRodW1ibmFpbElkeF07XHJcbiAgICAgICAgICBpZiggaXRlbS4kZWx0ICE9IG51bGwgKXtcclxuICAgICAgICAgICAgaXRlbS4kZWx0LmNzcyh7IG9wYWNpdHk6IDAsIGRpc3BsYXk6ICdub25lJyB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHZhciBhcmVhV2lkdGggPSBHLiRFLmNvblRuUGFyZW50LndpZHRoKCk7XHJcblxyXG4gICAgICAvLyBzZXQgZ2FsbGVyeSBhcmVhIHJlYWxseSB1c2VkIHNpemVcclxuICAgICAgLy8gaWYoIEcuR09NLmRpc3BsYXlBcmVhLndpZHRoICE9IEcuR09NLmRpc3BsYXlBcmVhTGFzdC53aWR0aCB8fCBHLkdPTS5kaXNwbGF5QXJlYS5oZWlnaHQgIT0gRy5HT00uZGlzcGxheUFyZWFMYXN0LmhlaWdodCApIHtcclxuICAgICAgaWYoIEcuR09NLmRpc3BsYXlBcmVhLndpZHRoICE9IEcuR09NLmRpc3BsYXlBcmVhTGFzdC53aWR0aCB8fCBHLkdPTS5jbGlwQXJlYS5oZWlnaHQgIT0gRy5HT00uZGlzcGxheUFyZWFMYXN0LmhlaWdodCApIHtcclxuICAgICAgICBHLiRFLmNvblRuLndpZHRoKCBHLkdPTS5kaXNwbGF5QXJlYS53aWR0aCApLmhlaWdodCggRy5HT00uY2xpcEFyZWEuaGVpZ2h0ICk7XHJcbiAgICAgICAgRy5HT00uZGlzcGxheUFyZWFMYXN0LndpZHRoID0gRy5HT00uZGlzcGxheUFyZWEud2lkdGg7XHJcbiAgICAgICAgRy5HT00uZGlzcGxheUFyZWFMYXN0LmhlaWdodCA9IEcuR09NLmNsaXBBcmVhLmhlaWdodDtcclxuICAgICAgICAvLyBHLkdPTS5kaXNwbGF5QXJlYUxhc3QuaGVpZ2h0PUcuR09NLmRpc3BsYXlBcmVhLmhlaWdodC1HLkdPTS5jbGlwQXJlYS50b3A7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmKCBhcmVhV2lkdGggIT0gRy4kRS5jb25UblBhcmVudC53aWR0aCgpICkge1xyXG4gICAgICAgIC8vIGdhbGxlcnkgYXJlYSB3aWR0aCBjaGFuZ2VkIHNpbmNlIGxheW91dCBjYWxjdWxhdGlvbiAoZm9yIGV4YW1wbGUgd2hlbiBhIHNjcm9sbGJhciBhcHBlYXJlZClcclxuICAgICAgICAvLyBzbyB3ZSBuZWVkIHJlLWNhbGN1bGF0ZSB0aGUgbGF5b3V0IGJlZm9yZSBkaXNwbGF5aW5nIHRoZSB0aHVtYm5haWxzXHJcbiAgICAgICAgRy5HT00uY2FjaGUuYXJlYVdpZHRoID0gRy4kRS5jb25UblBhcmVudC53aWR0aCgpO1xyXG4gICAgICAgIEdhbGxlcnlTZXRMYXlvdXQoKTtcclxuICAgICAgICBHYWxsZXJ5RGlzcGxheVBhcnQxKCBmb3JjZVRyYW5zaXRpb24gKTtcclxuICAgICAgICBHYWxsZXJ5RGlzcGxheVBhcnQyKCBmb3JjZVRyYW5zaXRpb24gKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGNvdW50ZXIgb2Ygbm90IGRpc3BsYXllZCBpbWFnZXMgKGlzIGRpc3BsYXllZCBvbiB0aGUgbGFzdCB0aHVtYm5haWwpXHJcbiAgICAgIGlmKCBHLmxheW91dC5zdXBwb3J0LnJvd3MgKSB7XHJcbiAgICAgICAgaWYoIEcuZ2FsbGVyeURpc3BsYXlNb2RlLkdldCgpID09ICdST1dTJyB8fCAoRy5nYWxsZXJ5RGlzcGxheU1vZGUuR2V0KCkgPT0gJ0ZVTExDT05URU5UJyAmJiBHLmdhbGxlcnlMYXN0Um93RnVsbC5HZXQoKSAmJiBHLkdPTS5sYXN0RnVsbFJvdyAhPSAtMSkgKXtcclxuICAgICAgICAgIGlmKCBsYXN0VG5JZHggPCAobmJUbiAtIDEpICkge1xyXG4gICAgICAgICAgICBHLkdPTS5sYXN0RGlzcGxheWVkSWR4TmV3ID0gbGFzdFRuSWR4O1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIEcuR09NLmxhc3REaXNwbGF5ZWRJZHhOZXcgPS0gMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIHJlbW92ZSBsYXN0IGRpc3BsYXllZCBjb3VudGVyXHJcbiAgICAgICAgICBpZiggRy5HT00ubGFzdERpc3BsYXllZElkeCAhPSAtMSApIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBHLklbRy5HT00uaXRlbXNbRy5HT00ubGFzdERpc3BsYXllZElkeF0udGh1bWJuYWlsSWR4XTtcclxuICAgICAgICAgICAgaXRlbS4kZ2V0RWx0KCcubkdZMkdUaHVtYm5haWxJY29uc0Z1bGxUaHVtYm5haWwnKS5odG1sKCcnKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIFxyXG4gICAgICAvLyBiYXRjaCBzZXQgcG9zaXRpb24gKGFuZCBkaXNwbGF5IGFuaW1hdGlvbikgdG8gYWxsIHRodW1ibmFpbHNcclxuICAgICAgLy8gZmlyc3QgZGlzcGxheSBuZXdseSBidWlsdCB0aHVtYm5haWxzXHJcbiAgICAgIHZhciBuYkJ1aWxkID0gdG5Ub0Rpc3BsYXkubGVuZ3RoO1xyXG4gICAgICBHLkdPTS50aHVtYm5haWxzMkRpc3BsYXk9W107XHJcbiAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbmJCdWlsZCA7IGkrKyApIHtcclxuICAgICAgICAvLyBUaHVtYm5haWxTZXRQb3NpdGlvbih0blRvRGlzcGxheVtpXS5pZHgsIHRuVG9EaXNwbGF5W2ldLmRlbGF5KzEwKTtcclxuICAgICAgICBUaHVtYm5haWxTZXRQb3NpdGlvbih0blRvRGlzcGxheVtpXS5pZHgsIGkpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyB0aGVuIHJlLXBvc2l0aW9uIGFscmVhZHkgZGlzcGxheWVkIHRodW1ibmFpbHNcclxuICAgICAgdmFyIG4gPSB0blRvUmVEaXNwbGF5Lmxlbmd0aDtcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBuIDsgaSsrICkge1xyXG4gICAgICAgIC8vIFRodW1ibmFpbFNldFBvc2l0aW9uKHRuVG9SZURpc3BsYXlbaV0uaWR4LCBuYkJ1aWxkKzEpO1xyXG4gICAgICAgIFRodW1ibmFpbFNldFBvc2l0aW9uKHRuVG9SZURpc3BsYXlbaV0uaWR4LCBpKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgVGh1bWJuYWlsRGlzcGxheUFuaW1CYXRjaCgpO1xyXG5cclxuICAgICAgaWYoIEcudG4ub3B0LkdldCgnZGlzcGxheVRyYW5zaXRpb24nKSA9PSAnTk9ORScgKSB7XHJcbiAgICAgICAgRy5nYWxsZXJ5UmVzaXplRXZlbnRFbmFibGVkID0gdHJ1ZTtcclxuICAgICAgICAvLyBHYWxsZXJ5VGh1bWJuYWlsU2xpZGVyQnVpbGRBbmRTdGFydCgpOyAgLy8gaW1hZ2Ugc2xpZGVyIG9uIGxhc3QgZGlzcGxheWVkIHRodW1ibmFpbFxyXG4gICAgICAgIFRyaWdnZXJDdXN0b21FdmVudCgnZ2FsbGVyeURpc3BsYXllZCcpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmVxdWVzdFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgLy8gY2hhbmdlIHZhbHVlIGFmdGVyIHRoZSBlbmQgb2YgdGhlIGRpc3BsYXkgdHJhbnNpc3Rpb24gb2YgdGhlIG5ld2x5IGJ1aWx0IHRodW1ibmFpbHNcclxuICAgICAgICAgIEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAvLyBHYWxsZXJ5VGh1bWJuYWlsU2xpZGVyQnVpbGRBbmRTdGFydCgpOyAgLy8gaW1hZ2Ugc2xpZGVyIG9uIGxhc3QgZGlzcGxheWVkIHRodW1ibmFpbFxyXG4gICAgICAgICAgVHJpZ2dlckN1c3RvbUV2ZW50KCdnYWxsZXJ5RGlzcGxheWVkJyk7XHJcbiAgICAgICAgfSwgbmJCdWlsZCAqIEcudG4ub3B0LkdldCgnZGlzcGxheUludGVydmFsJykpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIC8vIFRodW1ibmFpbDogc2V0IHRoZSBuZXcgcG9zaXRpb25cclxuICAgIGZ1bmN0aW9uIFRodW1ibmFpbFNldFBvc2l0aW9uKCBHT01pZHgsIGNudCApIHtcclxuICAgICAgdmFyIG5ld1RvcD0gICAwO1xyXG4gICAgICB2YXIgY3VyVG49ICAgIEcuR09NLml0ZW1zW0dPTWlkeF07XHJcbiAgICAgIHZhciBpZHg9ICAgICAgRy5HT00uaXRlbXNbR09NaWR4XS50aHVtYm5haWxJZHg7XHJcbiAgICAgIHZhciBpdGVtPSAgICAgRy5JW2lkeF07XHJcbiAgICBcclxuICAgICAgaWYoIGN1clRuLm5ldmVyRGlzcGxheWVkICkge1xyXG4gICAgICAgIC8vIHRodW1ibmFpbCBpcyBidWlsdCBidXQgaGFzIG5ldmVyIGJlZW4gZGlzcGxheWVkICg9Zmlyc3QgZGlzcGxheSlcclxuICAgICAgICB2YXIgdG9wID0gY3VyVG4udG9wIC0gRy5HT00uY2xpcEFyZWEudG9wO1xyXG4gICAgICAgIGlmKCBHLnRuLm9wdC5HZXQoJ3N0YWNrcycpID4gMCApIHtcclxuICAgICAgICAgIC8vIHdlIGhhdmUgc3RhY2tzIC0+IGRvIG5vdCBkaXNwbGF5IHRoZW0gaGVyZS4gVGhleSB3aWxsIGJlIGRpc3BsYXllZCBhdCB0aGUgZW5kIG9mIHRoZSBkaXNwbGF5IGFuaW1hdGlvblxyXG4gICAgICAgICAgaXRlbS4kZWx0Lmxhc3QoKS5jc3MoeyBkaXNwbGF5OiAnYmxvY2snfSk7XHJcbiAgICAgICAgICBpdGVtLiRlbHQuY3NzKHsgdG9wOiB0b3AgLCBsZWZ0OiBjdXJUbi5sZWZ0IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIGl0ZW0uJGVsdC5jc3MoeyBkaXNwbGF5OiAnYmxvY2snLCB0b3A6IHRvcCAsIGxlZnQ6IGN1clRuLmxlZnQgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5ld1RvcD10b3A7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gZGlzcGxheSB0aGUgaW1hZ2Ugb2YgdGhlIHRodW1ibmFpbCB3aGVuIGZ1bGx5IGxvYWRlZFxyXG4gICAgICAgIGlmKCBHLk8udGh1bWJuYWlsV2FpdEltYWdlTG9hZGVkID09PSB0cnVlICkge1xyXG4gICAgICAgICAgdmFyIGdpX2ltZ0xvYWQgPSBuZ2ltYWdlc0xvYWRlZCggaXRlbS4kZ2V0RWx0KCcubkdZMlRuSW1nMicpICk7XHJcbiAgICAgICAgICBnaV9pbWdMb2FkLm9uKCAncHJvZ3Jlc3MnLCBmdW5jdGlvbiggaW5zdGFuY2UsIGltYWdlICkge1xyXG4gICAgICAgICAgICBpZiggaW1hZ2UuaXNMb2FkZWQgKSB7XHJcbiAgICAgICAgICAgICAgdmFyIGFsYnVtSWR4ID0gaW1hZ2UuaW1nLmdldEF0dHJpYnV0ZSgnZGF0YS1hbGJ1bWlkeCcpO1xyXG4gICAgICAgICAgICAgIGlmKCBhbGJ1bUlkeCA9PSBHLkdPTS5hbGJ1bUlkeCApIHtcclxuICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBldmVudCBpZiBub3Qgb24gY3VycmVudCBhbGJ1bVxyXG4gICAgICAgICAgICAgICAgdmFyIGlkeCA9IGltYWdlLmltZy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWR4Jyk7XHJcbiAgICAgICAgICAgICAgICBHLklbaWR4XS5UaHVtYm5haWxJbWFnZVJldmVhbCgpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGRpc3BsYXkgdGhlIHRodW1ibmFpbFxyXG4gICAgICAgIFRodW1ibmFpbEFwcGVhcihHT01pZHgsIGNudCk7XHJcblxyXG4gICAgICAgIGN1clRuLmRpc3BsYXllZCA9IHRydWU7XHJcbiAgICAgICAgY3VyVG4ubmV2ZXJEaXNwbGF5ZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICB2YXIgdG9wT2xkID0gRy5HT00uY2FjaGUuY29udGFpbmVyT2Zmc2V0LnRvcCArIGl0ZW0udG9wO1xyXG4gICAgICAgIHZhciB0b3AgPSBHLkdPTS5jYWNoZS5jb250YWluZXJPZmZzZXQudG9wICsgKGN1clRuLnRvcCAtIEcuR09NLmNsaXBBcmVhLnRvcCk7XHJcbiAgICAgICAgbmV3VG9wID0gY3VyVG4udG9wIC0gRy5HT00uY2xpcEFyZWEudG9wO1xyXG4gICAgICAgIHZhciB2cCA9IEcuR09NLmNhY2hlLnZpZXdwb3J0O1xyXG4gICAgICAgIGlmKCBHLk8udGh1bWJuYWlsRGlzcGxheU91dHNpZGVTY3JlZW4gfHwgKCAoICh0b3BPbGQgKyBjdXJUbi5oZWlnaHQpID49ICh2cC50IC0gdnAuaCkgJiYgdG9wT2xkIDw9ICh2cC50ICsgdnAuaCAqIDQpICkgfHxcclxuICAgICAgICAgICAgICAoICh0b3AgKyBjdXJUbi5oZWlnaHQpID49ICh2cC50IC0gdnAuaCkgJiYgdG9wIDw9ICh2cC50ICsgdnAuaCAqIDQpICkgKSAgKSB7XHJcbiAgICAgICAgICAvLyB0aHVtYm5haWwgcG9zaXRpb25lZCBpbiBlbmxhcmdlZCB2aWV3cG9ydCAodmlld3BvcnQgKyA0IHggdmlld3BvcnQgaGVpZ2h0KSAodjEuNTogY2hhbmdlZCBmcm9tIDIgdG8gNClcclxuICAgICAgICAgIGlmKCBjdXJUbi5kaXNwbGF5ZWQgKSB7XHJcbiAgICAgICAgICAgIC8vIHRodW1ibmFpbCBpcyBkaXNwbGF5ZWRcclxuICAgICAgICAgICAgaWYoIGl0ZW0udG9wICE9IGN1clRuLnRvcCB8fCBpdGVtLmxlZnQgIT0gY3VyVG4ubGVmdCApIHtcclxuICAgICAgICAgICAgICAvLyBzZXQgcG9zaXRpb25cclxuICAgICAgICAgICAgICBpZiggRy5PLmdhbGxlcnlSZXNpemVBbmltYXRpb24gPT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgICAgIC8vIHdpdGggdHJhbnNpdGlvblxyXG4gICAgICAgICAgICAgICAgdmFyIHR3ZWVuYWJsZSA9IG5ldyBOR1R3ZWVuYWJsZSgpO1xyXG4gICAgICAgICAgICAgICAgdHdlZW5hYmxlLnR3ZWVuKHtcclxuICAgICAgICAgICAgICAgICAgZnJvbTogICAgICAgeyB0b3A6IGl0ZW0udG9wLCBsZWZ0OiBpdGVtLmxlZnQsICBoZWlnaHQ6IGl0ZW0uaGVpZ2h0LCAgd2lkdGg6IGl0ZW0ud2lkdGggfSxcclxuICAgICAgICAgICAgICAgICAgdG86ICAgICAgICAgeyB0b3A6IG5ld1RvcCwgICBsZWZ0OiBjdXJUbi5sZWZ0LCBoZWlnaHQ6IGN1clRuLmhlaWdodCwgd2lkdGg6IGN1clRuLndpZHRoIH0sXHJcbiAgICAgICAgICAgICAgICAgIGF0dGFjaG1lbnQ6IHsgJGU6IGl0ZW0uJGVsdCB9LFxyXG4gICAgICAgICAgICAgICAgICBkdXJhdGlvbjogICAxMDAsXHJcbiAgICAgICAgICAgICAgICAgIGRlbGF5OiAgICAgIGNudCAqIEcudG4ub3B0LkdldCgnZGlzcGxheUludGVydmFsJykgLyA1LFxyXG4gICAgICAgICAgICAgICAgICAvLyBlYXNpbmc6ICAgICAnZWFzZUluT3V0UXVhZCcsXHJcbiAgICAgICAgICAgICAgICAgIGVhc2luZzogICAgICdlYXNlT3V0UXVhcnQnLFxyXG4gICAgICAgICAgICAgICAgICBzdGVwOiAgICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGF0dC4kZS5jc3Moc3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICBmaW5pc2g6ICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcz10aGlzO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRpc3Bvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gc2V0IHBvc2l0aW9uIHdpdGhvdXQgdHJhbnNpdGlvblxyXG4gICAgICAgICAgICAgICAgLy8gaXRlbS4kZWx0LmNzcyh7IHRvcDogY3VyVG4udG9wICwgbGVmdDogY3VyVG4ubGVmdCB9KTtcclxuICAgICAgICAgICAgICAgIGl0ZW0uJGVsdC5jc3MoeyB0b3A6IG5ld1RvcCAsIGxlZnQ6IGN1clRuLmxlZnQgfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gcmUtZGlzcGxheSB0aHVtYm5haWxcclxuICAgICAgICAgICAgY3VyVG4uZGlzcGxheWVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgLy8gaXRlbS4kZWx0LmNzcyh7IGRpc3BsYXk6ICdibG9jaycsIHRvcDogY3VyVG4udG9wICwgbGVmdDogY3VyVG4ubGVmdCwgb3BhY2l0eToxIH0pO1xyXG4gICAgICAgICAgICBpdGVtLiRlbHQuY3NzKHsgZGlzcGxheTogJ2Jsb2NrJywgdG9wOiBuZXdUb3AsIGxlZnQ6IGN1clRuLmxlZnQsIG9wYWNpdHk6IDEgfSk7XHJcbiAgICAgICAgICAgIFRodW1ibmFpbEFwcGVhckZpbmlzaChpdGVtKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAvLyB1bmRpc3BsYXkgdGh1bWJuYWlsIGlmIG5vdCBpbiB2aWV3cG9ydCttYXJnaW4gLS0+IHBlcmZvcm1hbmNlIGdhaW5cclxuICAgICAgICAgIGN1clRuLmRpc3BsYXllZCA9IGZhbHNlO1xyXG4gICAgICAgICAgaXRlbS4kZWx0LmNzcyh7IGRpc3BsYXk6ICdub25lJ30pO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBpdGVtLmxlZnQgPSBjdXJUbi5sZWZ0O1xyXG4gICAgICBpdGVtLnRvcCA9IG5ld1RvcDtcclxuICAgICAgXHJcbiAgICAgIC8vIHNldCBuZXcgc2l6ZSBpZiBjaGFuZ2VkXHJcbiAgICAgIGlmKCBpdGVtLndpZHRoICE9IGN1clRuLndpZHRoIHx8IGl0ZW0uaGVpZ2h0ICE9IGN1clRuLmhlaWdodCApIHtcclxuICAgICAgICBpdGVtLiRlbHQuY3NzKHsgd2lkdGg6IGN1clRuLndpZHRoICwgaGVpZ2h0OiBjdXJUbi5oZWlnaHQgfSk7XHJcbiAgICAgICAgaXRlbS53aWR0aCA9IGN1clRuLndpZHRoO1xyXG4gICAgICAgIGl0ZW0uaGVpZ2h0ID0gY3VyVG4uaGVpZ2h0O1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGlmKCBjdXJUbi5yZXNpemVkQ29udGVudFdpZHRoID4gMCApIHtcclxuICAgICAgICAvLyByZXNpemUgYWxzbyB0aGUgY29udGVudCAoPWltYWdlKVxyXG4gICAgICAgIGlmKCBpdGVtLnJlc2l6ZWRDb250ZW50V2lkdGggIT0gY3VyVG4ucmVzaXplZENvbnRlbnRXaWR0aCB8fCBpdGVtLnJlc2l6ZWRDb250ZW50SGVpZ2h0ICE9IGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0ICkge1xyXG4gICAgICAgICAgaWYoIGl0ZW0ua2luZCA9PSAnYWxidW1VcCcgKSB7XHJcbiAgICAgICAgICAgIC8vIGl0ZW0uJGdldEVsdCgnLm5HWTJHVGh1bWJuYWlsQWxidW1VcCcpLmNzcyh7J2hlaWdodCc6IGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0LCAnd2lkdGgnOiBjdXJUbi5yZXNpemVkQ29udGVudFdpZHRofSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaXRlbS4kZ2V0RWx0KCcubkdZMkdUaHVtYm5haWxJbWFnZScpLmNzcyh7J2hlaWdodCc6IGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0LCAnd2lkdGgnOiBjdXJUbi5yZXNpemVkQ29udGVudFdpZHRofSk7XHJcblxyXG4gICAgICAgICAgICBpZiggRy5sYXlvdXQuZW5naW5lID09ICdKVVNUSUZJRUQnICApIHtcclxuICAgICAgICAgICAgICBpdGVtLiRnZXRFbHQoJy5uR1kyR1RodW1ibmFpbEltZycpLmNzcyh7J2hlaWdodCc6IGN1clRuLnJlc2l6ZWRDb250ZW50SGVpZ2h0LCAnd2lkdGgnOiBjdXJUbi5yZXNpemVkQ29udGVudFdpZHRofSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGl0ZW0ucmVzaXplZENvbnRlbnRXaWR0aCA9IGN1clRuLnJlc2l6ZWRDb250ZW50V2lkdGg7XHJcbiAgICAgICAgICBpdGVtLnJlc2l6ZWRDb250ZW50SGVpZ2h0ID0gY3VyVG4ucmVzaXplZENvbnRlbnRIZWlnaHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBcclxuICAgICAgLy8gYWRkIGNvdW50ZXIgb2YgcmVtYWluaW5nIChub3QgZGlzcGxheWVkKSBpbWFnZXMgXHJcbiAgICAgIGlmKCBHLkdPTS5sYXN0RGlzcGxheWVkSWR4TmV3ID09IEdPTWlkeCAmJiAgRy5sYXlvdXQuc3VwcG9ydC5yb3dzICkge1xyXG4gICAgICAgIGlmKCAoRy5nYWxsZXJ5RGlzcGxheU1vZGUuR2V0KCkgPT0gJ1JPV1MnICYmIEcuZ2FsbGVyeU1heFJvd3MuR2V0KCkgPiAwKSB8fCAoRy5nYWxsZXJ5RGlzcGxheU1vZGUuR2V0KCkgPT0gJ0ZVTExDT05URU5UJyAmJiBHLmdhbGxlcnlMYXN0Um93RnVsbC5HZXQoKSAmJiBHLkdPTS5sYXN0RnVsbFJvdyAhPSAtMSkgKXtcclxuICAgICAgICAgIC8vIG51bWJlciBvZiBpdGVtc1xyXG4gICAgICAgICAgdmFyIG5iID0gRy5HT00uaXRlbXMubGVuZ3RoIC0gR09NaWR4IC0gMTtcclxuICAgICAgICAgIGlmKCBpdGVtLmFsYnVtSUQgIT0gJzAnICYmIEcuTy50aHVtYm5haWxMZXZlbFVwICkge1xyXG4gICAgICAgICAgICBuYi0tO1xyXG4gICAgICAgICAgfVxyXG5cclxuICAgICAgICAgIGlmKCBuYiA+IDAgKSB7XHJcbiAgICAgICAgICAgIC8vIGRpc3BsYXkgY291bnRlclxyXG4gICAgICAgICAgICBpZiggRy5PLnRodW1ibmFpbE9wZW5JbWFnZSB8fCBHLk8udGh1bWJuYWlsU2xpZGVyRGVsYXkgPiAwICApIHtcclxuICAgICAgICAgICAgICBpdGVtLiRnZXRFbHQoJy5uR1kyR1RodW1ibmFpbEljb25zRnVsbFRodW1ibmFpbCcpLmh0bWwoICcrJyArIG5iKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gaWYoIEcubGF5b3V0LmVuZ2luZSA9PSAnR1JJRCcgJiYgRy5HT00uc2xpZGVyLmhvc3RJdGVtICE9IEcuR09NLk5HWTJJdGVtKEdPTWlkeCkgKSB7XHJcbiAgICAgICAgICAgIC8vIGltYWdlIHNsaWRlciBvbiBsYXN0IGRpc3BsYXllZCB0aHVtYm5haWxcclxuICAgICAgICAgICAgaWYoIEcuR09NLnNsaWRlci5ob3N0SXRlbSAhPSBHLkdPTS5OR1kySXRlbShHT01pZHgpICkge1xyXG5cclxuICAgICAgICAgICAgICAvLyBzZXQgY3VycmVudCBzbGlkZXIgYmFjayB0byBpbml0aWFsIGNvbnRlbnRcclxuICAgICAgICAgICAgICBHYWxsZXJ5VGh1bWJuYWlsU2xpZGVyU2V0Q29udGVudCggRy5HT00uc2xpZGVyLmhvc3RJdGVtICk7XHJcbiAgICAgICAgICAgICAgLy8gbmV3IHNsaWRlclxyXG4gICAgICAgICAgICAgIEcuR09NLnNsaWRlci5ob3N0SWR4ID0gR09NaWR4O1xyXG4gICAgICAgICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbSA9IEcuR09NLk5HWTJJdGVtKEdPTWlkeCk7XHJcbiAgICAgICAgICAgICAgRy5HT00uc2xpZGVyLm5leHRJZHggPSBHT01pZHg7XHJcbiAgICAgICAgICAgICAgRy5HT00uc2xpZGVyLmN1cnJlbnRJZHggPSBHT01pZHg7XHJcbiAgICAgICAgICAgICAgR2FsbGVyeVRodW1ibmFpbFNsaWRlckJ1aWxkQW5kU3RhcnQoKTsgIC8vIGltYWdlIHNsaWRlciBvbiBsYXN0IGRpc3BsYXllZCB0aHVtYm5haWxcclxuICAgICAgICAgICAgICAvLyBHYWxsZXJ5VGh1bWJuYWlsU2xpZGVyU2V0TmV4dENvbnRlbnQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIC8vIHJlc2V0IHNsaWRlciBjb250ZW50IHRvIGluaXRpYWwgY29udGVudCBiZWNhdXNlIGFsbCB0aHVtYm5haWxzIGFyZSBkaXNwbGF5ZWRcclxuICAgICAgICAgICAgR2FsbGVyeVRodW1ibmFpbFNsaWRlclNldENvbnRlbnQoIEcuR09NLnNsaWRlci5ob3N0SXRlbSApO1xyXG4gICAgICAgICAgICBHLkdPTS5zbGlkZXIuaG9zdElkeCA9IC0xO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBHLkdPTS5sYXN0RGlzcGxheWVkSWR4ID0gR09NaWR4O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgICAvLyByZXBsYWNlIGltYWdlIG9uIGxhc3QgdGh1bWJuYWlscyB3aXRoIG5vdCBkaXNwbGF5ZWQgb25lcyAobW9kZSBST1dTIG9yIEZVTExDT05URU5UIHdpdGggZ2FsbGVyeUxhc3RSb3dGdWxsIGVuYWJsZWQpXHJcbiAgICAvLyBmdW5jdGlvbiBHYWxsZXJ5TGFzdFRodW1ibmFpbFNsaWRlSW1hZ2UoKSB7XHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5VGh1bWJuYWlsU2xpZGVyQnVpbGRBbmRTdGFydCgpIHtcclxuXHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsU2xpZGVyRGVsYXkgPT0gMCB8fCBHLkdPTS5zbGlkZXIuaG9zdElkeCA9PSAtMSApIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgY2xlYXJUaW1lb3V0KEcuR09NLnNsaWRlci50aW1lcklEKTtcclxuICAgICAgXHJcbiAgICAgIHZhciBpdGVtID0gRy5HT00uc2xpZGVyLmhvc3RJdGVtO1xyXG5cclxuICAgICAgLy8gZHVwcGxpY2F0ZSBpbWFnZSBsYXllciAtPiBmb3IgdGhlIG5leHQgaW1hZ2VcclxuICAgICAgaWYoIGl0ZW0uJGdldEVsdCgnLm5HWTJUbkltZ05leHQnKS5sZW5ndGggPT0gMCApIHtcclxuICAgICAgICBpdGVtLiRnZXRFbHQoJy5uR1kyVG5JbWcnKS5jbG9uZSgpLnJlbW92ZUNsYXNzKCduR1kyVG5JbWcnKS5hZGRDbGFzcygnbkdZMlRuSW1nTmV4dCcpLmluc2VydEFmdGVyKGl0ZW0uJGdldEVsdCgnLm5HWTJUbkltZycpKTtcclxuICAgICAgICBpdGVtLiRnZXRFbHQoJy5uR1kyVG5JbWdCYWNrJykuY2xvbmUoKS5yZW1vdmVDbGFzcygnbkdZMlRuSW1nQmFjaycpLmFkZENsYXNzKCduR1kyVG5JbWdCYWNrTmV4dCcpLmluc2VydEFmdGVyKGl0ZW0uJGdldEVsdCgnLm5HWTJUbkltZycsIHRydWUpKTtcclxuICAgICAgICBpdGVtLiRnZXRFbHQoJy5uR1kyR1RodW1ibmFpbEltYWdlJywgdHJ1ZSk7IC8vIGltcG9ydGFudCAtPiByZWZyZXNoIHRoZSBjYWNoZVxyXG4gICAgICAgIGl0ZW0uJGdldEVsdCgnLm5HWTJHVGh1bWJuYWlsSW1nJywgdHJ1ZSk7ICAgLy8gaW1wb3J0YW50IC0+IHJlZnJlc2ggdGhlIGNhY2hlXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGl0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMlRuSW1nTmV4dCcsICd0cmFuc2xhdGVYJywgJzEwMCUnLCB0cnVlKTtcclxuICAgICAgaXRlbS5DU1NUcmFuc2Zvcm1BcHBseSggJy5uR1kyVG5JbWdOZXh0JyApO1xyXG4gICAgICBpdGVtLkNTU1RyYW5zZm9ybVNldCgnLm5HWTJUbkltZ0JhY2tOZXh0JywgJ3RyYW5zbGF0ZVgnLCAnMTAwJScsIHRydWUpO1xyXG4gICAgICBpdGVtLkNTU1RyYW5zZm9ybUFwcGx5KCAnLm5HWTJUbkltZ0JhY2tOZXh0JyApO1xyXG5cclxuICAgICAgR2FsbGVyeVRodW1ibmFpbFNsaWRlclNldE5leHRDb250ZW50KCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBjbGVhclRpbWVvdXQoRy5HT00uc2xpZGVyLnRpbWVySUQpO1xyXG4gICAgICAvLyBHLkdPTS5zbGlkZXIudGltZXJJRCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgR2FsbGVyeVRodW1ibmFpbFNsaWRlclN0YXJ0VHJhbnNpdGlvbigpIH0sIEcuTy50aHVtYm5haWxTbGlkZXJEZWxheSk7XHJcbiAgICAgIEcuR09NLnNsaWRlci50aW1lcklEID0gcmVxdWVzdFRpbWVvdXQoZnVuY3Rpb24oKXsgR2FsbGVyeVRodW1ibmFpbFNsaWRlclN0YXJ0VHJhbnNpdGlvbigpIH0sIEcuTy50aHVtYm5haWxTbGlkZXJEZWxheSk7XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5VGh1bWJuYWlsU2xpZGVyU2V0TmV4dENvbnRlbnQoKSB7XHJcblxyXG4gICAgICBHLkdPTS5zbGlkZXIubmV4dElkeCsrO1xyXG4gICAgICBpZiggRy5HT00uc2xpZGVyLm5leHRJZHggPj0gRy5HT00uaXRlbXMubGVuZ3RoICkge1xyXG4gICAgICAgIEcuR09NLnNsaWRlci5uZXh0SWR4ID0gRy5HT00uc2xpZGVyLmhvc3RJZHg7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIG5ldyBpbWFnZVxyXG4gICAgICB2YXIgbmV3SXRlbSA9IEcuR09NLk5HWTJJdGVtKEcuR09NLnNsaWRlci5uZXh0SWR4KTtcclxuICAgICAgdmFyIGltZ0JsdXJyZWQgPSBHLmVtcHR5R2lmO1xyXG4gICAgICB2YXIgYmdJbWcgPSBcInVybCgnXCIgKyBHLmVtcHR5R2lmICsgXCInKVwiO1xyXG4gICAgICBpZiggbmV3SXRlbS5pbWFnZURvbWluYW50Q29sb3JzICE9IG51bGwgKSB7XHJcbiAgICAgICAgaW1nQmx1cnJlZCA9IG5ld0l0ZW0uaW1hZ2VEb21pbmFudENvbG9ycztcclxuICAgICAgICBiZ0ltZyA9IFwidXJsKCdcIiArIG5ld0l0ZW0uaW1hZ2VEb21pbmFudENvbG9ycyArIFwiJylcIjtcclxuICAgICAgfVxyXG4gICAgICBHLkdPTS5zbGlkZXIuaG9zdEl0ZW0uJGdldEVsdCgnLm5HWTJUbkltZ0JhY2tOZXh0JywgdHJ1ZSkuY3NzKHsnYmFja2dyb3VuZC1pbWFnZSc6IGJnSW1nLCBvcGFjaXR5OiAxIH0pO1xyXG4gICAgICBHLkdPTS5zbGlkZXIuaG9zdEl0ZW0uJGdldEVsdCgnLm5HWTJUbkltZ05leHQnLCB0cnVlKS5jc3MoeyAnYmFja2dyb3VuZC1pbWFnZSc6IFwidXJsKCdcIiArIG5ld0l0ZW0udGh1bWJJbWcoKS5zcmMgKyBcIicpXCIsIG9wYWNpdHk6IDEgfSk7XHJcbiAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS4kZ2V0RWx0KCcubkdZMlRuSW1nTmV4dCAubkdZMkdUaHVtYm5haWxJbWcnLCB0cnVlKS5hdHRyKCdzcmMnLCBuZXdJdGVtLnRodW1iSW1nKCkuc3JjICk7XHJcbiAgICAgIFxyXG5cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gdGh1bWJuYWlsIHNsaWRlciAtIHRyYW5zaXRpb24gZnJvbSBvbmUgaW1hZ2UgdG8gdGhlIG5leHQgb25lXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5VGh1bWJuYWlsU2xpZGVyU3RhcnRUcmFuc2l0aW9uKCkge1xyXG4gICAgICBcclxuICAgICAgaWYoIEcuR09NLnNsaWRlci5ob3N0SXRlbS4kZ2V0RWx0KCkgIT0gbnVsbCApIHtcclxuXHJcbiAgICAgICAgLy8gc2xpZGVyIHRyYW5zaXRpb25cclxuICAgICAgICB2YXIgdHdlZW5hYmxlID0gbmV3IE5HVHdlZW5hYmxlKCk7XHJcbiAgICAgICAgRy5HT00uc2xpZGVyLnR3ZWVuID0gdHdlZW5hYmxlO1xyXG4gICAgICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAgICAgICAgICBmcm9tOiAgICAgICAgIHsgJ2xlZnQnOiAxMDAgfSxcclxuICAgICAgICAgIHRvOiAgICAgICAgICAgeyAnbGVmdCc6IDAgfSxcclxuICAgICAgICAgIGR1cmF0aW9uOiAgICAgODAwLFxyXG4gICAgICAgICAgZGVsYXk6ICAgICAgICAwLFxyXG4gICAgICAgICAgLy8gZWFzaW5nOiAgICAgICAnZWFzZUluT3V0UXVhZCcsXHJcbiAgICAgICAgICBlYXNpbmc6ICAgICAgICdlYXNlT3V0UXVhcnQnLFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBzdGVwOiBmdW5jdGlvbiAoc3RhdGUpIHtcclxuICAgICAgICAgICAgaWYoIEcuR09NLnNsaWRlci5ob3N0SXRlbS4kZ2V0RWx0KCkgPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgICAvLyB0aGUgdGh1bWJuYWlsIG1heSBoYXZlIGJlZW4gZGVzdHJveWVkIHNpbmNlIHRoZSBzdGFydCBvZiB0aGUgYW5pbWF0aW9uXHJcbiAgICAgICAgICAgICAgRy5HT00uc2xpZGVyLnR3ZWVuLnN0b3AoZmFsc2UpO1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gd2luZG93Lm5nX2RyYWYoIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgIC8vIHNsaWRlIGN1cnJlbnQgY29udGVudFxyXG4gICAgICAgICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS5DU1NUcmFuc2Zvcm1TZXQoJy5uR1kyVG5JbWdCYWNrJywgJ3RyYW5zbGF0ZVgnLCAtKDEwMCAtIHN0YXRlLmxlZnQpICsgJyUnKTtcclxuICAgICAgICAgICAgICBHLkdPTS5zbGlkZXIuaG9zdEl0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoICcubkdZMlRuSW1nQmFjaycgKTtcclxuICAgICAgICAgICAgICBHLkdPTS5zbGlkZXIuaG9zdEl0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMlRuSW1nJywgJ3RyYW5zbGF0ZVgnLCAtKDEwMCAtIHN0YXRlLmxlZnQpICsgJyUnKTtcclxuICAgICAgICAgICAgICBHLkdPTS5zbGlkZXIuaG9zdEl0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoICcubkdZMlRuSW1nJyApO1xyXG5cclxuICAgICAgICAgICAgICAvLyBzbGlkZSBuZXcgY29udGVudFxyXG4gICAgICAgICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS5DU1NUcmFuc2Zvcm1TZXQoJy5uR1kyVG5JbWdCYWNrTmV4dCcsICd0cmFuc2xhdGVYJywgc3RhdGUubGVmdCArICclJyk7XHJcbiAgICAgICAgICAgICAgRy5HT00uc2xpZGVyLmhvc3RJdGVtLkNTU1RyYW5zZm9ybUFwcGx5KCAnLm5HWTJUbkltZ0JhY2tOZXh0JyApO1xyXG4gICAgICAgICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS5DU1NUcmFuc2Zvcm1TZXQoJy5uR1kyVG5JbWdOZXh0JywgJ3RyYW5zbGF0ZVgnLCBzdGF0ZS5sZWZ0ICsgJyUnKTtcclxuICAgICAgICAgICAgICBHLkdPTS5zbGlkZXIuaG9zdEl0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoICcubkdZMlRuSW1nTmV4dCcgKTtcclxuICAgICAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBmaW5pc2g6IGZ1bmN0aW9uIChzdGF0ZSkge1xyXG4gICAgICAgICAgICBpZiggRy5HT00uc2xpZGVyLmhvc3RJdGVtLiRnZXRFbHQoKSA9PSBudWxsICkge1xyXG4gICAgICAgICAgICAgIC8vIHRoZSB0aHVtYm5haWwgbWF5IGJlIGRlc3Ryb3llZCBzaW5jZSB0aGUgc3RhcnQgb2YgdGhlIGFuaW1hdGlvblxyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiggRy5HT00uTkdZMkl0ZW0oRy5HT00uc2xpZGVyLm5leHRJZHgpID09IG51bGwgKSB7IHJldHVybjsgfSAvLyBpdGVtIGRvZXMgbm90IGV4aXN0IGFueW1vcmVcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAvLyBzZXQgbmV3IGNvbnRlbnQgYXMgY3VycmVudCBjb250ZW50XHJcbiAgICAgICAgICAgICAgR2FsbGVyeVRodW1ibmFpbFNsaWRlclNldENvbnRlbnQoIEcuR09NLk5HWTJJdGVtKEcuR09NLnNsaWRlci5uZXh0SWR4KSApO1xyXG4gICAgICAgICAgICAgIEcuR09NLnNsaWRlci5jdXJyZW50SWR4ID0gRy5HT00uc2xpZGVyLm5leHRJZHg7XHJcbiAgICAgICAgICAgICAgR2FsbGVyeVRodW1ibmFpbFNsaWRlclNldE5leHRDb250ZW50KCk7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KEcuR09NLnNsaWRlci50aW1lcklEKTtcclxuICAgICAgICAgICAgICAvLyBHLkdPTS5zbGlkZXIudGltZXJJRD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IEdhbGxlcnlUaHVtYm5haWxTbGlkZXJTdGFydFRyYW5zaXRpb24oKSB9LCBHLk8udGh1bWJuYWlsU2xpZGVyRGVsYXkpO1xyXG4gICAgICAgICAgICAgIEcuR09NLnNsaWRlci50aW1lcklEID0gcmVxdWVzdFRpbWVvdXQoZnVuY3Rpb24oKXsgR2FsbGVyeVRodW1ibmFpbFNsaWRlclN0YXJ0VHJhbnNpdGlvbigpIH0sIEcuTy50aHVtYm5haWxTbGlkZXJEZWxheSk7XHJcbiAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIHNldCBtYWluIGNvbnRlbnQgb2YgdGhlIHRodW1ibmFpbCBob3N0aW5nIHRoZSBzbGlkZXJcclxuICAgIC8vIGhpZGUgdGhlIGVsZW1lbnRzIGZvciB0aGUgbmV4dCBjb250ZW50IG9mIHRoZSBzbGlkZXJcclxuICAgIGZ1bmN0aW9uIEdhbGxlcnlUaHVtYm5haWxTbGlkZXJTZXRDb250ZW50KCBuZ3kyaXRlbUNvbnRlbnQgKSB7XHJcbiAgICAgICAgaWYoIEcuR09NLnNsaWRlci5ob3N0SWR4ID09IC0xICkgeyByZXR1cm47IH1cclxuICAgICAgICBcclxuICAgICAgICBpZiggRy5HT00uc2xpZGVyLnR3ZWVuICE9IG51bGwgKSB7XHJcbiAgICAgICAgICBpZiggRy5HT00uc2xpZGVyLnR3ZWVuLl9pc1R3ZWVuaW5nICA9PSB0cnVlICkge1xyXG4gICAgICAgICAgICBHLkdPTS5zbGlkZXIudHdlZW4uc3RvcChmYWxzZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgYmdJbWcgPSBcInVybCgnXCIgKyBHLmVtcHR5R2lmICsgXCInKVwiO1xyXG4gICAgICAgIGlmKCBuZ3kyaXRlbUNvbnRlbnQuaW1hZ2VEb21pbmFudENvbG9ycyAhPSBudWxsICkge1xyXG4gICAgICAgICAgYmdJbWcgPSBcInVybCgnXCIgKyBuZ3kyaXRlbUNvbnRlbnQuaW1hZ2VEb21pbmFudENvbG9ycyArIFwiJylcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgRy5HT00uc2xpZGVyLmhvc3RJdGVtLiRnZXRFbHQoJy5uR1kyVG5JbWdCYWNrJykuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJywgYmdJbWcpO1xyXG4gICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS4kZ2V0RWx0KCcubkdZMlRuSW1nJykuY3NzKCdiYWNrZ3JvdW5kLWltYWdlJywgXCJ1cmwoJ1wiICsgbmd5Mml0ZW1Db250ZW50LnRodW1iSW1nKCkuc3JjICsgXCInKVwiICk7XHJcbiAgICAgICAgRy5HT00uc2xpZGVyLmhvc3RJdGVtLiRnZXRFbHQoJy5uR1kyVG5JbWcgLm5HWTJHVGh1bWJuYWlsSW1nJykuYXR0cignc3JjJywgbmd5Mml0ZW1Db250ZW50LnRodW1iSW1nKCkuc3JjICk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgRy5HT00uc2xpZGVyLmhvc3RJdGVtLkNTU1RyYW5zZm9ybVNldCgnLm5HWTJUbkltZ0JhY2snLCAndHJhbnNsYXRlWCcsICcwJyk7XHJcbiAgICAgICAgRy5HT00uc2xpZGVyLmhvc3RJdGVtLkNTU1RyYW5zZm9ybUFwcGx5KCAnLm5HWTJUbkltZ0JhY2snICk7XHJcbiAgICAgICAgRy5HT00uc2xpZGVyLmhvc3RJdGVtLkNTU1RyYW5zZm9ybVNldCgnLm5HWTJUbkltZycsICd0cmFuc2xhdGVYJywgJzAnKTtcclxuICAgICAgICBHLkdPTS5zbGlkZXIuaG9zdEl0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoICcubkdZMlRuSW1nJyApO1xyXG5cclxuICAgICAgICAvLyBwbGFjZSB0aGUgY29udGFpbmVycyBmb3IgdGhlIG5leHQgaW1hZ2Ugc2xpZGVyIG91dHNpZGUgb2YgdGhlIHRodW1ibmFpbCAoPWhpZGRlbilcclxuICAgICAgICBHLkdPTS5zbGlkZXIuaG9zdEl0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMlRuSW1nQmFja05leHQnLCAndHJhbnNsYXRlWCcsICcxMDAlJywgdHJ1ZSk7XHJcbiAgICAgICAgRy5HT00uc2xpZGVyLmhvc3RJdGVtLkNTU1RyYW5zZm9ybUFwcGx5KCAnLm5HWTJUbkltZ0JhY2tOZXh0JyApO1xyXG4gICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS5DU1NUcmFuc2Zvcm1TZXQoJy5uR1kyVG5JbWdOZXh0JywgJ3RyYW5zbGF0ZVgnLCAnMTAwJScsIHRydWUpO1xyXG4gICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS5DU1NUcmFuc2Zvcm1BcHBseSggJy5uR1kyVG5JbWdOZXh0JyApO1xyXG5cclxuICAgICAgICAvLyBzZXQgbmV3IHRpdGxlIGFuZCBkZXNjcmlwdGlvblxyXG4gICAgICAgIGlmKCBHLk8udGh1bWJuYWlsTGFiZWwuZ2V0KCdkaXNwbGF5JykgPT0gdHJ1ZSApIHtcclxuICAgICAgICAgIHZhciBpY29ucyA9IEcuTy5pY29ucy50aHVtYm5haWxBbGJ1bTtcclxuICAgICAgICAgIGlmKCBuZ3kyaXRlbUNvbnRlbnQua2luZCAhPSAnYWxidW0nICkge1xyXG4gICAgICAgICAgICBpY29ucyA9IEcuTy5pY29ucy50aHVtYm5haWxJbWFnZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS4kZ2V0RWx0KCcubkdZMkdUaHVtYm5haWxUaXRsZScpLmh0bWwoaWNvbnMgKyBnZXRUaHVtYm5haWxUaXRsZShuZ3kyaXRlbUNvbnRlbnQpKTtcclxuICAgICAgICAgIEcuR09NLnNsaWRlci5ob3N0SXRlbS4kZ2V0RWx0KCcubkdZMkdUaHVtYm5haWxEZXNjcmlwdGlvbicpLmh0bWwoaWNvbnMgKyBnZXRUdW1ibmFpbERlc2NyaXB0aW9uKG5neTJpdGVtQ29udGVudCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgXHJcbiAgIFxyXG4gICAgXHJcbiAgICAvLyBDb21wdXRlIHRoZSBoZWlnaHQgb2YgdGhlIGxhYmVsIHBhcnQgb2YgYSB0aHVtYm5haWwgKHRpdGxlK2Rlc2NyaXB0aW9uLCBib3RoIHNpbmdsZSBsaW5lKVxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsR2V0TGFiZWxIZWlnaHQoKSB7XHJcbiAgICAgIHZhciBuZXdFbHQgPSBbXSxcclxuICAgICAgbmV3RWx0SWR4ID0gIDA7XHJcblxyXG4gICAgICAvLyBpZiggRy5PLnRodW1ibmFpbExhYmVsLmdldCgnZGlzcGxheScpID09IGZhbHNlICYmIEcudG4udG9vbGJhci5nZXRXaWR0aChpdGVtKSA8PSAwICkge1xyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbExhYmVsLmdldCgnZGlzcGxheScpID09IGZhbHNlICApIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdmFyIGRlc2M9Jyc7XHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsTGFiZWwuZ2V0KCdkaXNwbGF5RGVzY3JpcHRpb24nKSA9PSB0cnVlICkge1xyXG4gICAgICAgIGRlc2MgPSAnYUF6WmpKJztcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gdmlzaWJpbGl0eSBzZXQgdG8gaGlkZGVuXHJcbiAgICAgIG5ld0VsdFtuZXdFbHRJZHgrK10gPSAnPGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsICcgKyBHLk8udGhlbWUgKyAnXCIgc3R5bGU9XCJkaXNwbGF5OmJsb2NrO3Zpc2liaWxpdHk6aGlkZGVuO3Bvc2l0aW9uOmFic29sdXRlO3RvcDotOTk5OXB4O2xlZnQ6LTk5OTlweDtcIiA+PGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsU3ViXCI+JztcclxuICAgICAgaWYoIEcuTy50aHVtYm5haWxMYWJlbC5nZXQoJ2Rpc3BsYXknKSA9PSB0cnVlICkge1xyXG4gICAgICAgIC8vIExhYmVsczogdGl0bGUgYW5kIGRlc2NyaXB0aW9uXHJcbiAgICAgICAgbmV3RWx0W25ld0VsdElkeCsrXSA9ICcgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbExhYmVsXCIgJysgRy50bi5zdHlsZS5nZXRMYWJlbCgpICsnPic7XHJcbiAgICAgICAgbmV3RWx0W25ld0VsdElkeCsrXSA9ICcgICAgPGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsQWxidW1UaXRsZVwiICcrRy50bi5zdHlsZS5nZXRUaXRsZSgpKyc+YUF6WmpKPC9kaXY+JztcclxuICAgICAgICBpZiggRy5PLnRodW1ibmFpbExhYmVsLmdldCgnZGlzcGxheURlc2NyaXB0aW9uJykgPT0gdHJ1ZSApIHtcclxuICAgICAgICAgIG5ld0VsdFtuZXdFbHRJZHgrK10gPSAnICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbERlc2NyaXB0aW9uXCIgJytHLnRuLnN0eWxlLmdldERlc2MoKSsnPicrJ2FBelpqSicrJzwvZGl2Pic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5ld0VsdFtuZXdFbHRJZHgrK10gPSAnICA8L2Rpdj4nO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBuZXdFbHRbbmV3RWx0SWR4KytdID0gJzwvZGl2PjwvZGl2Pic7XHJcbiAgICBcclxuICAgICAgdmFyICRuZXdEaXYgPSBqUXVlcnkobmV3RWx0LmpvaW4oJycpKS5hcHBlbmRUbyhHLiRFLmNvblRuKTtcclxuICAgICAgdmFyIGggPSAkbmV3RGl2LmZpbmQoJy5uR1kyR1RodW1ibmFpbExhYmVsJykub3V0ZXJIZWlnaHQodHJ1ZSk7XHJcbiAgICAgICRuZXdEaXYucmVtb3ZlKCk7XHJcblxyXG4gICAgICByZXR1cm4gaDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsQnVpbGRTdGFja3MoIGJnQ29sb3IgKSB7XHJcbiAgICAgIHZhciBucz1HLnRuLm9wdC5HZXQoJ3N0YWNrcycpO1xyXG4gICAgICBpZiggbnMgPT0gMCApIHsgcmV0dXJuICcnOyB9XHJcbiAgICAgXHJcbiAgICAgIHZhciBzPScnO1xyXG4gICAgICBmb3IoIHZhciBpPTA7IGk8bnM7IGkrKyApIHtcclxuICAgICAgICBzPSc8ZGl2IGNsYXNzPVwibkdZMkdUaHVtYm5haWxTdGFjayBcIiBzdHlsZT1cImRpc3BsYXk6bm9uZTsnK2JnQ29sb3IrJ1wiPjwvZGl2PicrcztcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcztcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8tLS0tLSBCdWlsZCBvbmUgVVAgdGh1bWJuYWlsICg9bmF2aWdhdGlvbiB0aHVtYm5haWwpXHJcbiAgICBmdW5jdGlvbiBUaHVtYm5haWxCdWlsZEFsYnVtcFVwKCBpdGVtLCBpZHgsIEdPTWlkeCApIHtcclxuICAgICAgdmFyIG5ld0VsdCA9IFtdLFxyXG4gICAgICBuZXdFbHRJZHggPSAwO1xyXG4gICAgICBcclxuICAgICAgdmFyIG1wID0gJyc7XHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsT3BlbkltYWdlID09PSBmYWxzZSApIHtcclxuICAgICAgICBtcCA9ICdjdXJzb3I6ZGVmYXVsdDsnXHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIG5ld0VsdFtuZXdFbHRJZHgrK10gPSBUaHVtYm5haWxCdWlsZFN0YWNrcygnJykgKyAnPGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7b3BhY2l0eTowOycgKyBtcCArICdcIiA+JztcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXSA9ICcgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbFN1YlwiPic7XHJcblxyXG4gICAgICB2YXIgaD1HLnRuLmRlZmF1bHRTaXplLmdldEhlaWdodCgpLFxyXG4gICAgICB3PUcudG4uZGVmYXVsdFNpemUuZ2V0V2lkdGgoKTtcclxuXHJcbiAgICAgIG5ld0VsdFtuZXdFbHRJZHgrK10gPSAnICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEltYWdlXCIgc3R5bGU9XCJ3aWR0aDonK3crJ3B4O2hlaWdodDonK2grJ3B4O1wiPjxpbWcgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEltZ1wiIHNyYz1cIicrRy5lbXB0eUdpZisnXCIgYWx0PVwiXCIgc3R5bGU9XCJtYXgtd2lkdGg6Jyt3KydweDttYXgtaGVpZ2h0OicraCsncHg7XCIgPjwvZGl2Pic7XHJcbiAgICAgIC8vIG5ld0VsdFtuZXdFbHRJZHgrK10gPSAnICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEFsYnVtVXBcIiBzdHlsZT1cIndpZHRoOicrdysncHg7aGVpZ2h0OicraCsncHg7XCI+JytHLk8uaWNvbnMudGh1bWJuYWlsQWxidW1VcCsnPC9kaXY+JztcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXSA9ICcgICAgPGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsQWxidW1VcFwiID4nK0cuTy5pY29ucy50aHVtYm5haWxBbGJ1bVVwKyc8L2Rpdj4nO1xyXG4gICAgICBuZXdFbHRbbmV3RWx0SWR4KytdID0gJyAgPC9kaXY+JztcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXSA9ICc8L2Rpdj4nO1xyXG4gICAgICBcclxuICAgICAgdmFyICRuZXdEaXYgPSBqUXVlcnkobmV3RWx0LmpvaW4oJycpKS5hcHBlbmRUbyhHLiRFLmNvblRuKTsgLy8uYW5pbWF0ZSh7IG9wYWNpdHk6IDF9LDEwMDAsICdzd2luZycpOyAgLy8uc2hvdygnc2xvdycpOyAvLy5mYWRlSW4oJ3Nsb3cnKS5zbGlkZURvd24oJ3Nsb3cnKTtcclxuICAgICAgXHJcbiAgICAgIGl0ZW0uJGVsdCA9ICRuZXdEaXY7XHJcbiAgICAgICRuZXdEaXYuZGF0YSgnaW5kZXgnLCBHT01pZHgpO1xyXG4gICAgICBpdGVtLiRnZXRFbHQoJy5uR1kyR1RodW1ibmFpbEltZycpLmRhdGEoJ2luZGV4JywgR09NaWR4KTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIC8vLS0tLS0gQnVpbGQgb25lIHRodW1ibmFpbFxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsQnVpbGQoIGl0ZW0sIGlkeCwgR09NaWR4LCBsYXN0T25lICkge1xyXG4gICAgICBpdGVtLmVsdFRyYW5zZm9ybSA9ICBbXTtcclxuICAgICAgaXRlbS5lbHRGaWx0ZXIgPSAgICAgW107XHJcbiAgICAgIGl0ZW0uaG92ZXJJbml0RG9uZSA9IGZhbHNlO1xyXG4gICAgICBpdGVtLiRFbHRzID0gICAgICAgICBbXTtcclxuXHJcbiAgICAgIGlmKCBpdGVtLmtpbmQgPT0gJ2FsYnVtVXAnICkge1xyXG4gICAgICAgIFRodW1ibmFpbEJ1aWxkQWxidW1wVXAoIGl0ZW0sIGlkeCwgR09NaWR4KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHZhciBuZXdFbHQgPSBbXSxcclxuICAgICAgbmV3RWx0SWR4ID0gMDtcclxuXHJcbiAgICAgIHZhciBtcCA9ICcnO1xyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbE9wZW5JbWFnZSA9PT0gZmFsc2UgKSB7XHJcbiAgICAgICAgbXAgPSAnY3Vyc29yOmRlZmF1bHQ7J1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyB2YXIgc3JjID0gZW5jb2RlVVJJKGl0ZW0udGh1bWJJbWcoKS5zcmMpLFxyXG4gICAgICB2YXIgc3JjID0gKGl0ZW0udGh1bWJJbWcoKS5zcmMpLnJlcGxhY2UoLycvZywgXCIlMjdcIiksICAgLy8gcmVwbGFjZSBzaW5nbGUgcXVvdGUgd2l0aCAlMjdcclxuICAgICAgc1RpdGxlID0gZ2V0VGh1bWJuYWlsVGl0bGUoaXRlbSk7XHJcblxyXG4gICAgICAvLyBpbWFnZSBiYWNrZ3JvdW5kIC0+IHZpc2libGUgZHVyaW5nIGltYWdlIGRvd25sb2FkXHJcbiAgICAgIHZhciBiZyA9ICcnO1xyXG4gICAgICB2YXIgYmdJbWcgPSBcImJhY2tncm91bmQtaW1hZ2U6IHVybCgnXCIgKyBHLmVtcHR5R2lmICsgXCInKTtcIjtcclxuICAgICAgaWYoIGl0ZW0uaW1hZ2VEb21pbmFudENvbG9ycyAhPSBudWxsICkge1xyXG4gICAgICAgIC8vIGRvbWluYW50IGNvbG9yUyAoYmx1cnJlZCBwcmV2aWV3IGltYWdlKVxyXG4gICAgICAgIGJnSW1nID0gXCJiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJ1wiICsgaXRlbS5pbWFnZURvbWluYW50Q29sb3JzICsgXCInKTtcIjtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyBkb21pbmFudCBjb2xvciAtPiBiYWNrZ3JvdW5kIGNvbG9yXHJcbiAgICAgICAgaWYoIGl0ZW0uaW1hZ2VEb21pbmFudENvbG9yICE9IG51bGwgKSB7XHJcbiAgICAgICAgICBiZyA9ICdiYWNrZ3JvdW5kLWNvbG9yOicgKyBpdGVtLmltYWdlRG9taW5hbnRDb2xvciArICc7JztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBiZ0ltZyA9ICcnO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIG9wID0gJ29wYWNpdHk6MTsnO1xyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbFdhaXRJbWFnZUxvYWRlZCA9PSB0cnVlICkge1xyXG4gICAgICAgIG9wID0gJ29wYWNpdHk6MDsnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyAjIyMjIyB0aHVtYm5haWwgY29udGFpbmVycyAgKHdpdGggc3RhY2tzKVxyXG4gICAgICBuZXdFbHRbbmV3RWx0SWR4KytdID0gVGh1bWJuYWlsQnVpbGRTdGFja3MoYmcpICsgJzxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbFwiIHN0eWxlPVwiZGlzcGxheTpub25lO29wYWNpdHk6MDsnICsgbXAgKyAnXCI+PGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsU3ViICcgKyAoIEcuTy50aHVtYm5haWxTZWxlY3RhYmxlICYmIGl0ZW0uc2VsZWN0ZWQgPyBcIm5HWTJHVGh1bWJuYWlsU3ViU2VsZWN0ZWRcIiA6IFwiXCIgKSArICdcIj4nO1xyXG5cclxuICAgICAgXHJcbiAgICAgIC8vIGltYWdlIHNpemVcclxuICAgICAgdmFyIHcgPSBHLnRuLnNldHRpbmdzLmdldFcoKTtcclxuICAgICAgdmFyIGggPSBHLnRuLnNldHRpbmdzLmdldEgoKTtcclxuICAgICAgaWYoIEcudG4uc2V0dGluZ3MuZ2V0TW9zYWljKCkgIT09IG51bGwgKSB7XHJcbiAgICAgICAgLy8gbW9zYWljIGxheW91dCAtPiBcclxuICAgICAgICB3ID0gRy5HT00uaXRlbXNbR09NaWR4XS53aWR0aDtcclxuICAgICAgICBoID0gRy5HT00uaXRlbXNbR09NaWR4XS5oZWlnaHQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHZhciBiZ1NpemUgPSAnY29udGFpbic7XHJcbiAgICAgIGlmKCBHLnRuLm9wdC5HZXQoJ2Nyb3AnKSApIHtcclxuICAgICAgICBiZ1NpemUgPSAnY292ZXInO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyAjIyMjIyBsYXllciBmb3IgaW1hZ2UgYmFja2dyb3VuZCAoY29sb3IsIGRvbWluYW50IGNvbG9yLCBibHVycmVkIHByZXZpZXcpXHJcbiAgICAgIHZhciBzMSA9IFwicG9zaXRpb246IGFic29sdXRlOyB0b3A6IDBweDsgbGVmdDogMHB4OyB3aWR0aDpcIiArIHcgKyBcInB4OyBoZWlnaHQ6XCIgKyBoICsgXCJweDtcIisgYmcgKyBiZ0ltZyArIFwiIGJhY2tncm91bmQtcG9zaXRpb246IGNlbnRlciBjZW50ZXI7ICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OyBiYWNrZ3JvdW5kLXNpemU6XCIgKyBiZ1NpemUgKyBcIjsgb3ZlcmZsb3c6IGhpZGRlbjtcIjtcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXT0nPGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsSW1hZ2UgbkdZMlRuSW1nQmFja1wiIHN0eWxlPVwiJyArIHMxICsgJ1wiPjwvZGl2Pic7XHJcbiAgICAgIFxyXG4gICAgICAvLyAjIyMjIGxheWVyIGZvciBpbWFnZSBcclxuICAgICAgdmFyIHMyID0gb3AgKyBcInBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwcHg7IGxlZnQ6IDBweDsgd2lkdGg6XCIgKyB3ICsgXCJweDsgaGVpZ2h0OlwiICsgaCArIFwicHg7IGJhY2tncm91bmQtaW1hZ2U6IHVybCgnXCIgKyBzcmMgKyBcIicpOyBiYWNrZ3JvdW5kLXBvc2l0aW9uOiBjZW50ZXIgY2VudGVyOyBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0OyBiYWNrZ3JvdW5kLXNpemU6XCIgKyBiZ1NpemUgKyBcIjsgb3ZlcmZsb3c6IGhpZGRlbjtcIjtcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXT0nPGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsSW1hZ2UgbkdZMlRuSW1nXCIgc3R5bGU9XCInICsgczIgKyAnXCI+JztcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXT0nICA8aW1nIGNsYXNzPVwibkdZMkdUaHVtYm5haWxJbWcgbkdZMlRuSW1nMlwiIHNyYz1cIicgKyBzcmMgKyAnXCIgYWx0PVwiJyArIHNUaXRsZSArICdcIiBzdHlsZT1cIm9wYWNpdHk6MDtcIiBkYXRhLWlkeD1cIicgKyBpZHggKyAnXCIgZGF0YS1hbGJ1bWlkeD1cIicgKyBHLkdPTS5hbGJ1bUlkeCArICdcIiA+JztcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXT0nPC9kaXY+JztcclxuICAgICAgXHJcbiAgICAgIC8vICMjIyMjIGxheWVyIGZvciB1c2VyIGN1c3RvbWl6YXRpb24gcHVycG9zZXNcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXT0nPGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsQ3VzdG9tTGF5ZXJcIj48L2Rpdj4nO1xyXG5cclxuICAgICAgLy8gIyMjIyMgbGF5ZXIgZm9yIGxhYmVscyAodGl0bGUgKyBkZXNjcmlwdGlvbiBhbmQgdGhlaXIgaWNvbnMpXHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsTGFiZWwuZ2V0KCdkaXNwbGF5JykgPT0gdHJ1ZSApIHtcclxuICAgICAgICAvLyBMYWJlbHM6IHRpdGxlIGFuZCBkZXNjcmlwdGlvblxyXG4gICAgICAgIG5ld0VsdFtuZXdFbHRJZHgrK109ICcgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbExhYmVsXCIgJysgRy50bi5zdHlsZS5nZXRMYWJlbChpdGVtKSArICc+JztcclxuICAgICAgICBpZiggaXRlbS5raW5kID09ICdhbGJ1bScgKSB7XHJcbiAgICAgICAgICAvLyBhbGJ1bSBraW5kXHJcbiAgICAgICAgICBuZXdFbHRbbmV3RWx0SWR4KytdPSAnICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbFRpdGxlIG5HWTJHVGh1bWJuYWlsQWxidW1UaXRsZVwiICcgKyBHLnRuLnN0eWxlLmdldFRpdGxlKCkgKyAnPicgKyBHLk8uaWNvbnMudGh1bWJuYWlsQWxidW0gKyBzVGl0bGUgKyAnPC9kaXY+JztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAvLyBpbWFnZS9tZWRpYSBraW5kXHJcbiAgICAgICAgICBuZXdFbHRbbmV3RWx0SWR4KytdPSAnICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbFRpdGxlIG5HWTJHVGh1bWJuYWlsSW1hZ2VUaXRsZVwiICcgKyBHLnRuLnN0eWxlLmdldFRpdGxlKCkgKyAnPicgKyBHLk8uaWNvbnMudGh1bWJuYWlsSW1hZ2UgKyBzVGl0bGUgKyAnPC9kaXY+JztcclxuICAgICAgICB9XHJcbiAgICAgICAgbmV3RWx0W25ld0VsdElkeCsrXT0gJyAgICA8ZGl2IGNsYXNzPVwibkdZMkdUaHVtYm5haWxEZXNjcmlwdGlvblwiICcgKyBHLnRuLnN0eWxlLmdldERlc2MoKSArICc+JyArIGdldFR1bWJuYWlsRGVzY3JpcHRpb24oaXRlbSkgKyAnPC9kaXY+JztcclxuICAgICAgICBuZXdFbHRbbmV3RWx0SWR4KytdPSAnICA8L2Rpdj4nO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyAjIyMjIyBsYXllciBmb3IgdG9vbHNcclxuICAgICAgbmV3RWx0W25ld0VsdElkeCsrXSA9IFRodW1ibmFpbEJ1aWxkVG9vbHMoaXRlbSwgbGFzdE9uZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBjbG9zZSBjb250YWluZXJzXHJcbiAgICAgIG5ld0VsdFtuZXdFbHRJZHgrK109JzwvZGl2PjwvZGl2Pic7XHJcbiAgICAgIFxyXG4gICAgICB2YXIgJG5ld0RpdiA9alF1ZXJ5KG5ld0VsdC5qb2luKCcnKSkuYXBwZW5kVG8oRy4kRS5jb25Ubik7XHJcblxyXG4gICAgICBpdGVtLiRlbHQ9JG5ld0RpdjtcclxuICAgICAgJG5ld0Rpdi5kYXRhKCdpbmRleCcsR09NaWR4KTtcclxuICAgICAgaXRlbS4kZ2V0RWx0KCcubkdZMkdUaHVtYm5haWxJbWcnKS5kYXRhKCdpbmRleCcsR09NaWR4KTtcclxuICAgICAgXHJcbiAgICAgIC8vIEN1c3RvbSBpbml0IGZ1bmN0aW9uXHJcbiAgICAgIHZhciBmdT1HLk8uZm5UaHVtYm5haWxJbml0O1xyXG4gICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdSgkbmV3RGl2LCBpdGVtLCBHT01pZHgpIDogd2luZG93W2Z1XSgkbmV3RGl2LCBpdGVtLCBHT01pZHgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiggaXRlbS50aXRsZSAhPSAnaW1hZ2UgZ2FsbGVyeSBieSBuYW5vZ2FsbGVyeTIgW2J1aWxkXScgKSB7XHJcbiAgICAgICAgVGh1bWJuYWlsT3ZlckluaXQoR09NaWR4KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIDtcclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIC8vIFRodW1ibmFpbCBsYXllciBmb3IgdG9vbHMgKHRvb2xiYXJzIGFuZCBjb3VudGVyKVxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsQnVpbGRUb29scyggaXRlbSwgbGFzdFRodW1ibmFpbCApIHtcclxuICAgIFxyXG4gICAgICAvLyB0b29sYmFyc1xyXG4gICAgICB2YXIgdGIgPSBUaHVtYm5haWxCdWlsZFRvb2xiYXJPbmUoaXRlbSwgJ3RvcExlZnQnKSArIFRodW1ibmFpbEJ1aWxkVG9vbGJhck9uZShpdGVtLCAndG9wUmlnaHQnKSArIFRodW1ibmFpbEJ1aWxkVG9vbGJhck9uZShpdGVtLCAnYm90dG9tTGVmdCcpICsgVGh1bWJuYWlsQnVpbGRUb29sYmFyT25lKGl0ZW0sICdib3R0b21SaWdodCcpO1xyXG4gICAgICBcclxuICAgICAgLy8gY291bnRlciBvZiBub3QgZGlzcGxheWVkIGltYWdlc1xyXG4gICAgICB0YiArPSAnPGRpdiBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsSWNvbnNGdWxsVGh1bWJuYWlsXCI+PC9kaXY+JztcclxuXHJcbiAgICAgIHJldHVybiB0YjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsQnVpbGRUb29sYmFyT25lKCBpdGVtLCBwb3NpdGlvbiApIHtcclxuICAgICAgdmFyIHRvb2xiYXIgPSAnJztcclxuICAgICAgdmFyIHRiID0gICAgICBHLnRuLnRvb2xiYXIuZ2V0KGl0ZW0pO1xyXG4gICAgICB2YXIgd2lkdGggPSAgIHsgeHM6MCwgc206MSwgbWU6MiwgbGE6MywgeGw6NCB9O1xyXG4gICAgICB2YXIgY250ID0gICAgIDA7XHJcbiAgICAgIFxyXG4gICAgICBpZiggdGJbcG9zaXRpb25dICE9ICcnICkge1xyXG4gICAgICAgIHZhciBwb3M9J3RvcDogMDsgcmlnaHQ6IDA7IHRleHQtYWxpZ246IHJpZ2h0Oyc7ICAgICAvLyAndG9wUmlnaHQnIGFuZCBkZWZhdWx0XHJcbiAgICAgICAgc3dpdGNoKCBwb3NpdGlvbiApIHtcclxuICAgICAgICAgIGNhc2UgJ3RvcExlZnQnOlxyXG4gICAgICAgICAgICBwb3MgPSAndG9wOiAwOyBsZWZ0OiAwOyB0ZXh0LWFsaWduOiBsZWZ0Oyc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnYm90dG9tUmlnaHQnOlxyXG4gICAgICAgICAgICBwb3MgPSAnYm90dG9tOiAwOyByaWdodDogMDsgdGV4dC1hbGlnbjogcmlnaHQ7JztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdib3R0b21MZWZ0JzpcclxuICAgICAgICAgICAgcG9zID0gJ2JvdHRvbTogMDsgbGVmdDogMDsgdGV4dC1hbGlnbjogbGVmdDsnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdG9vbGJhciArPSAnICA8dWwgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEljb25zXCIgc3R5bGU9XCInICsgcG9zICsgJ1wiPic7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIGljb25zID0gdGJbcG9zaXRpb25dLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgdmFyIG5iID0gaWNvbnMubGVuZ3RoO1xyXG4gICAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbmI7IGkrKyApIHtcclxuICAgICAgICAgIHZhciBpY29uID0gaWNvbnNbaV0ucmVwbGFjZSgvXlxccyp8XFxzKiQvLCAnJyk7ICAgLy90cmltIHRyYWlsaW5nL2xlYWRpbmcgd2hpdGVzcGFjZVxyXG5cclxuICAgICAgICAgIHZhciBtaW5XaWR0aCA9IGljb24uc3Vic3RyaW5nKDAsMikudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICAgIHZhciB0SWNvbiA9IGljb247XHJcbiAgICAgICAgICB2YXIgZGlzcGxheSA9IHRydWU7XHJcbiAgICAgICAgICBpZiggL3hzfHNtfG1lfGxhfHhsL2kudGVzdChtaW5XaWR0aCkgKSB7XHJcbiAgICAgICAgICAgIC8vIGNoZWNrIHZpc2JpbGl0eSAoZGVwZW5kaW5nIG9uIHNjcmVlbiB3aWR0aClcclxuICAgICAgICAgICAgaWYoIHdpZHRoW21pbldpZHRoXSA+IHdpZHRoW0cuR09NLmN1cldpZHRoXSApIHtcclxuICAgICAgICAgICAgICBkaXNwbGF5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdEljb24gPSBpY29uLnN1YnN0cmluZygyKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIFxyXG4gICAgICAgICAgaWYoIGRpc3BsYXkgKSB7XHJcbiAgICAgICAgICAgIHZhciBzcD0oaSsxPG5iID8gJyZuYnNwOycgOicnKTtcclxuICAgICAgICAgICAgc3dpdGNoKCB0SWNvbiApIHtcclxuICAgICAgICAgICAgICBjYXNlICdDT1VOVEVSJzpcclxuICAgICAgICAgICAgICAgIGlmKCBpdGVtLmtpbmQgPT0gJ2FsYnVtJyApIHtcclxuICAgICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDxsaSBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsSWNvblwiIGRhdGEtbmd5MmFjdGlvbj1cIlwiPic7XHJcbiAgICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEljb25JbWFnZUNvdW50ZXJcIj48L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgICA8ZGl2IGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uVGV4dFwiPicgKyBHLk8uaWNvbnMudGh1bWJuYWlsQ291bnRlcitNYXRoLm1heCgoaXRlbS5nZXRDb250ZW50TGVuZ3RoKGZhbHNlKSksaXRlbS5udW1iZXJJdGVtcykgKyBzcCArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgPC9saT4nO1xyXG4gICAgICAgICAgICAgICAgICBjbnQrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ0NPVU5URVIyJzpcclxuICAgICAgICAgICAgICAgIGlmKCBpdGVtLmtpbmQgPT0gJ2FsYnVtJyApIHtcclxuICAgICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDxsaSBjbGFzcz1cIm5HWTJHVGh1bWJuYWlsSWNvblwiIGRhdGEtbmd5MmFjdGlvbj1cIlwiPic7XHJcbiAgICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEljb25UZXh0QmFkZ2VcIj4nICsgRy5PLmljb25zLnRodW1ibmFpbENvdW50ZXIrTWF0aC5tYXgoKGl0ZW0uZ2V0Q29udGVudExlbmd0aChmYWxzZSkpLGl0ZW0ubnVtYmVySXRlbXMpICsgc3AgKyAnPC9kaXY+JztcclxuICAgICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDwvbGk+JztcclxuICAgICAgICAgICAgICAgICAgY250Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTSEFSRSc6XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgPGxpIGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uXCIgZGF0YS1uZ3kyYWN0aW9uPVwiJyArIHRJY29uICsgJ1wiPic7XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgICA8ZGl2PicgKyBHLk8uaWNvbnMudGh1bWJuYWlsU2hhcmUgKyAnPC9kaXY+JztcclxuICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICA8L2xpPic7XHJcbiAgICAgICAgICAgICAgICBjbnQrKztcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ0RPV05MT0FEJzpcclxuICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICA8bGkgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEljb25cIiBkYXRhLW5neTJhY3Rpb249XCInICsgdEljb24gKyAnXCI+JztcclxuICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICAgIDxkaXY+JyArIEcuTy5pY29ucy50aHVtYm5haWxEb3dubG9hZCArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDwvbGk+JztcclxuICAgICAgICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnSU5GTyc6XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgPGxpIGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uXCIgZGF0YS1uZ3kyYWN0aW9uPVwiJyArIHRJY29uICsgJ1wiPic7XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgICA8ZGl2PicgKyBHLk8uaWNvbnMudGh1bWJuYWlsSW5mbyArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDwvbGk+JztcclxuICAgICAgICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ0FSVCc6XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgPGxpIGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uXCIgZGF0YS1uZ3kyYWN0aW9uPVwiJyArIHRJY29uICsgJ1wiPic7XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgICA8ZGl2PicgKyBHLk8uaWNvbnMudGh1bWJuYWlsQ2FydCArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDwvbGk+JztcclxuICAgICAgICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnRElTUExBWSc6XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgPGxpIGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uXCIgZGF0YS1uZ3kyYWN0aW9uPVwiRElTUExBWVwiPic7XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgICA8ZGl2IGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uSW1hZ2VTaGFyZVwiPicgKyBHLk8uaWNvbnMudGh1bWJuYWlsRGlzcGxheSArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDwvbGk+JztcclxuICAgICAgICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NMSc6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NMic6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NMyc6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NNCc6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NNSc6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NNic6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NNyc6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NOCc6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NOSc6XHJcbiAgICAgICAgICAgICAgY2FzZSAnQ1VTVE9NMTAnOlxyXG4gICAgICAgICAgICAgICAgdmFyIGN1c3QgPSB0SWNvbi5yZXBsYWNlKCdDVVNUT00nLCAnJyk7XHJcbiAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgPGxpIGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uXCIgZGF0YS1uZ3kyYWN0aW9uPVwiJyArIHRJY29uLnRvTG93ZXJDYXNlKCkgKyAnXCI+JztcclxuICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEljb25JbWFnZVNoYXJlXCI+JyArIEcuTy5pY29uc1sndGh1bWJuYWlsQ3VzdG9tVG9vbCcgKyBjdXN0XSArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDwvbGk+JztcclxuICAgICAgICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnRkVBVFVSRUQnOlxyXG4gICAgICAgICAgICAgICAgaWYoIGl0ZW0uZmVhdHVyZWQgPT09IHRydWUgKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICA8bGkgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEljb25cIiBkYXRhLW5neTJhY3Rpb249XCJcIj4nO1xyXG4gICAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgICA8ZGl2IGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uSW1hZ2VGZWF0dXJlZFwiPicgKyBHLk8uaWNvbnMudGh1bWJuYWlsRmVhdHVyZWQgKyAnPC9kaXY+JztcclxuICAgICAgICAgICAgICAgICAgdG9vbGJhciArPSAnICAgIDwvbGk+JztcclxuICAgICAgICAgICAgICAgICAgY250Kys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTRUxFQ1QnOlxyXG4gICAgICAgICAgICAgICAgaWYoIEcuTy50aHVtYm5haWxTZWxlY3RhYmxlID09IHRydWUgKSB7XHJcbiAgICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICA8bGkgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEljb25cIiBkYXRhLW5neTJhY3Rpb249XCJUT0dHTEVTRUxFQ1RcIj4nO1xyXG4gICAgICAgICAgICAgICAgICBpZiggaXRlbS5zZWxlY3RlZCA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgICAgICAgICB0b29sYmFyICs9ICcgICAgICA8ZGl2IGNsYXNzPVwibkdZMkdUaHVtYm5haWxJY29uSW1hZ2VTZWxlY3QgbkdZMlRodW1ibmFpbFNlbGVjdGVkXCI+JyArIEcuTy5pY29ucy50aHVtYm5haWxTZWxlY3RlZCArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICAgIDxkaXYgY2xhc3M9XCJuR1kyR1RodW1ibmFpbEljb25JbWFnZVNlbGVjdCBuR1kyVGh1bWJuYWlsVW5zZWxlY3RlZFwiPicgKyBHLk8uaWNvbnMudGh1bWJuYWlsVW5zZWxlY3RlZCArICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIHRvb2xiYXIgKz0gJyAgICA8L2xpPic7XHJcbiAgICAgICAgICAgICAgICAgIGNudCsrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdG9vbGJhciArPSAnICA8L3VsPic7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmKCBjbnQgPiAwICkge1xyXG4gICAgICAgIHJldHVybiB0b29sYmFyO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBnZXRUaHVtYm5haWxUaXRsZSggaXRlbSApIHtcclxuICAgIFxyXG4gICAgICB2YXIgc1RpdGxlID0gaXRlbS50aXRsZTtcclxuICAgICAgaWYoIEcuTy50aHVtYm5haWxMYWJlbC5nZXQoJ2Rpc3BsYXknKSA9PSB0cnVlICkge1xyXG4gICAgICAgIGlmKCBzVGl0bGUgPT09IHVuZGVmaW5lZCB8fCBzVGl0bGUubGVuZ3RoID09IDAgKSB7IHNUaXRsZSA9ICcmbmJzcDsnOyB9XHJcblxyXG4gICAgICAgIGlmKCBHLmkxOG5UcmFuc2xhdGlvbnMudGh1bWJuYWlsSW1hZ2VUaXRsZSAhPSAnJyApIHtcclxuICAgICAgICAgIHNUaXRsZSA9IEcuaTE4blRyYW5zbGF0aW9ucy50aHVtYm5haWxJbWFnZVRpdGxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbWwgPSBHLk8udGh1bWJuYWlsTGFiZWwuZ2V0KCd0aXRsZU1heExlbmd0aCcpO1xyXG4gICAgICAgIGlmKCBtbCA+IDMgJiYgc1RpdGxlLmxlbmd0aCA+IG1sICl7XHJcbiAgICAgICAgICBzVGl0bGUgPSBzVGl0bGUuc3Vic3RyaW5nKDAsIG1sKSArICcuLi4nO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHNUaXRsZTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRUdW1ibmFpbERlc2NyaXB0aW9uKCBpdGVtICkge1xyXG4gICAgICB2YXIgc0Rlc2MgPSAnJztcclxuICAgICAgaWYoIEcuTy50aHVtYm5haWxMYWJlbC5nZXQoJ2Rpc3BsYXlEZXNjcmlwdGlvbicpID09IHRydWUgKSB7IFxyXG4gICAgICAgIGlmKCBpdGVtLmtpbmQgPT0gJ2FsYnVtJyApIHtcclxuICAgICAgICAgIGlmKCBHLmkxOG5UcmFuc2xhdGlvbnMudGh1bWJuYWlsSW1hZ2VEZXNjcmlwdGlvbiAhPSAnJyApIHtcclxuICAgICAgICAgICAgc0Rlc2MgPSBHLmkxOG5UcmFuc2xhdGlvbnMudGh1bWJuYWlsQWxidW1EZXNjcmlwdGlvbjtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzRGVzYyA9IGl0ZW0uZGVzY3JpcHRpb247XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgaWYoIEcuaTE4blRyYW5zbGF0aW9ucy50aHVtYm5haWxJbWFnZURlc2NyaXB0aW9uICE9ICcnICkge1xyXG4gICAgICAgICAgICBzRGVzYyA9IEcuaTE4blRyYW5zbGF0aW9ucy50aHVtYm5haWxJbWFnZURlc2NyaXB0aW9uO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHNEZXNjID0gaXRlbS5kZXNjcmlwdGlvbjtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG1sID0gRy5PLnRodW1ibmFpbExhYmVsLmdldCgnZGVzY3JpcHRpb25NYXhMZW5ndGgnKTtcclxuICAgICAgICBpZiggbWwgPiAzICYmIHNEZXNjLmxlbmd0aCA+IG1sICl7XHJcbiAgICAgICAgICBzRGVzYyA9IHNEZXNjLnN1YnN0cmluZygwLCBtbCkgKyAnLi4uJztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIHNEZXNjLmxlbmd0aCA9PSAwICkge1xyXG4gICAgICAgICAgc0Rlc2MgPSAnJm5ic3A7JztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiBzRGVzYztcclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIFxyXG4gICAgLy8gUmV0cmlldmUgdGhlIG1heGltdW0gbnVtYmVyIG9mIHRodW1ibmFpbHMgdGhhdCBmaXRzIGluIG9uZSByb3dcclxuICAgIGZ1bmN0aW9uIE5iVGh1bWJuYWlsc1BlclJvdyggYXJlYVdpZHRoICkge1xyXG4gICAgICB2YXIgdG5XID0gRy50bi5kZWZhdWx0U2l6ZS5nZXRPdXRlcldpZHRoKCk7XHJcbiAgICAgIFxyXG4gICAgICB2YXIgbmJNYXhUbiA9IDA7XHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsQWxpZ25tZW50ID09ICdqdXN0aWZpZWQnICkge1xyXG4gICAgICAgIG5iTWF4VG4gPSBNYXRoLmZsb29yKChhcmVhV2lkdGgpLyh0blcpKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBuYk1heFRuID0gTWF0aC5mbG9vcigoYXJlYVdpZHRoICsgRy50bi5vcHQuR2V0KCdndXR0ZXJXaWR0aCcpKS8odG5XICsgRy50bi5vcHQuR2V0KCdndXR0ZXJXaWR0aCcpKSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmKCAgRy5PLm1heEl0ZW1zUGVyTGluZSA+MCAmJiBuYk1heFRuID4gIEcuTy5tYXhJdGVtc1BlckxpbmUgKSB7XHJcbiAgICAgICAgbmJNYXhUbiA9IEcuTy5tYXhJdGVtc1BlckxpbmU7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmKCBuYk1heFRuIDwgMSApIHsgbmJNYXhUbiA9IDE7IH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiBuYk1heFRuXHJcbiAgICB9XHJcbiAgXHJcbiAgICAvLyBUaHVtYm5haWwgZGlzcGxheSBhbmltYXRpb25cclxuICAgIGZ1bmN0aW9uIFRodW1ibmFpbEFwcGVhciggbiwgY250ICkge1xyXG4gICAgICB2YXIgY3VyVG4gPSBHLkdPTS5pdGVtc1tuXTtcclxuICAgICAgdmFyIGl0ZW0gPSBHLklbY3VyVG4udGh1bWJuYWlsSWR4XTtcclxuXHJcbiAgICBcclxuICAgICAgaWYoIEcudG4ub3B0LkdldCgnZGlzcGxheVRyYW5zaXRpb24nKSA9PSAnTk9ORScgKSB7XHJcbiAgICAgICAgaXRlbS4kZWx0LmNzcyh7IG9wYWNpdHk6IDEgfSk7XHJcbiAgICAgICAgVGh1bWJuYWlsQXBwZWFyRmluaXNoKCBpdGVtICk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgaWYoIGl0ZW0uJGVsdCA9PSBudWxsICkgeyByZXR1cm47IH1cclxuICAgICAgICB2YXIgdG9wID0gRy5HT00uY2FjaGUuY29udGFpbmVyT2Zmc2V0LnRvcCArICggY3VyVG4udG9wIC0gRy5HT00uY2xpcEFyZWEudG9wICk7XHJcbiAgICAgICAgdmFyIHZwID0gRy5HT00uY2FjaGUudmlld3BvcnQ7XHJcbiAgICAgICAgaWYoICh0b3AgKyAoY3VyVG4udG9wIC0gRy5HT00uY2xpcEFyZWEudG9wKSkgPj0gKHZwLnQgLSA1MCkgJiYgdG9wIDw9ICh2cC50ICsgdnAuaCArIDUwKSApIHtcclxuICAgICAgICAgIC8vIGRpc3BsYXkgYW5pbWF0aW9uIG9ubHkgaWYgaW4gdGhlIGN1cnJlbnQgdmlld3BvcnRcclxuICAgICAgICAgIHZhciBkZWxheSA9IGNudCAqIEcudG4ub3B0LkdldCgnZGlzcGxheUludGVydmFsJyk7XHJcbiAgICAgICAgICBpZiggRy50bi5vcHQuR2V0KCdkaXNwbGF5VHJhbnNpdGlvbicpID09ICdDVVNUT00nICkge1xyXG4gICAgICAgICAgICBpZiggRy5HT00uY3VyTmF2TGV2ZWwgPT0gJ2xOJyApIHtcclxuICAgICAgICAgICAgICBHLk8uZm5UaHVtYm5haWxEaXNwbGF5RWZmZWN0KGl0ZW0uJGVsdCwgaXRlbSwgbiwgZGVsYXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIEcuTy5mblRodW1ibmFpbEwxRGlzcGxheUVmZmVjdChpdGVtLiRlbHQsIGl0ZW0sIG4sIGRlbGF5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIEcuR09NLnRodW1ibmFpbHMyRGlzcGxheS5wdXNoKHtpdG06IGl0ZW0sIGQ6IGRlbGF5fSk7XHJcbiAgICAgICAgICAgIC8vIFRodW1ibmFpbERpc3BsYXlBbmltMihpdGVtLCBkZWxheSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgaXRlbS4kZWx0LmNzcyh7IG9wYWNpdHk6IDEgfSk7XHJcbiAgICAgICAgICBUaHVtYm5haWxBcHBlYXJGaW5pc2goaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgLy8gZGlzcGxheXMgdGh1bWJuYWlsIHN0YWNrcyBhdCB0aGUgZW5kIG9mIHRoZSBkaXNwbGF5IGFuaW1hdGlvblxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsQXBwZWFyRmluaXNoKCBpdGVtICkge1xyXG4gICAgXHJcbiAgICAgIC8vIGFkZCBzdGFja3NcclxuICAgICAgdmFyIG5zID0gRy50bi5vcHQuR2V0KCdzdGFja3MnKTtcclxuICAgICAgaWYoIG5zID4gMCApIHtcclxuICAgICAgICAvLyBkaXNwbGF5IHN0YWNrc1xyXG4gICAgICAgIGl0ZW0uJGVsdC5jc3MoeyBkaXNwbGF5OiAnYmxvY2snfSk7XHJcbiAgICAgICAgdmFyIG8gPSAwLjk7XHJcbiAgICAgICAgLy8gc2V0IHN0YWNrIG9wYWNpdHlcclxuICAgICAgICBmb3IoIHZhciBpID0gbnMtMTsgaT49MDsgaS0tICkge1xyXG4gICAgICAgICAgaXRlbS4kZWx0LmVxKGkpLmNzcygnb3BhY2l0eScsIG8pO1xyXG4gICAgICAgICAgbyA9IG8gLSAwLjI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcblxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsRGlzcGxheUFuaW0yKCBpdGVtLCBkZWxheSApIHtcclxuICAgICAgZnVuY3Rpb24gcmFuZG9tSW50RnJvbUludGVydmFsKG1pbixtYXgpIHtcclxuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKihtYXgtbWluKzEpK21pbik7XHJcbiAgICAgIH1cclxuICAgICAgdmFyIG9Gcm9tID0ge307XHJcbiAgICAgIHZhciBvVG8gPSB7fTtcclxuICAgIFxyXG4gICAgICBzd2l0Y2ggKEcudG4ub3B0LkdldCgnZGlzcGxheVRyYW5zaXRpb24nKSkge1xyXG4gICAgICAgIGNhc2UgJ1JBTkRPTVNDQUxFJzpcclxuICAgICAgICAgIHZhciBzY2FsZXMgPSBbMC45NSwgMSwgMS4wNSwgMS4xXTtcclxuICAgICAgICAgIHZhciB6aSA9IFsxLCAyLCAzLCA0XTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgdmFyIHIgPSByYW5kb21JbnRGcm9tSW50ZXJ2YWwoMCwzKTtcclxuICAgICAgICAgIHdoaWxlKCByID09IEcuR09NLmxhc3RSYW5kb21WYWx1ZSApIHtcclxuICAgICAgICAgICAgciA9IHJhbmRvbUludEZyb21JbnRlcnZhbCgwLDMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgRy5HT00ubGFzdFJhbmRvbVZhbHVlID0gcjtcclxuICAgICAgICAgIHZhciBmID0gc2NhbGVzW3JdO1xyXG4gICAgICAgICAgLy8gaXRlbS4kZWx0LmNzcyh7ICd6LWluZGV4JzogRy5HT00ubGFzdFpJbmRleCt6aVtyXSwgJ2JveC1zaGFkb3cnOiAnLTFweCAycHggNXB4IDFweCByZ2JhKDAsIDAsIDAsIDAuNyknIH0pO1xyXG4gICAgICAgICAgaXRlbS4kZWx0LmNzcyh7ICd6LWluZGV4JzogRy5HT00ubGFzdFpJbmRleCt6aVtyXSwgJ2JveC1zaGFkb3cnOiAnMHB4IDBweCA1cHggM3B4IHJnYmEoMCwwLDAsMC43NCknIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBvRnJvbSA9IHsgc2NhbGU6IDAuNSwgb3BhY2l0eTowIH07XHJcbiAgICAgICAgICBvVG8gPSAgIHsgc2NhbGU6IGYsICAgb3BhY2l0eToxIH07XHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAnU0NBTEVVUCc6XHJcbiAgICAgICAgICB2YXIgZiA9IEcudG4ub3B0LkdldCgnZGlzcGxheVRyYW5zaXRpb25TdGFydFZhbCcpO1xyXG4gICAgICAgICAgaWYoIGYgPT0gMCApIHsgZiA9IDAuNjsgfSAgIC8vIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAgIG9Gcm9tID0geyBzY2FsZTogZiwgb3BhY2l0eTogMCB9O1xyXG4gICAgICAgICAgb1RvID0gICB7IHNjYWxlOiAxLCBvcGFjaXR5OiAxIH07XHJcbiAgICAgICAgICBicmVhaztcclxuXHJcbiAgICAgICAgY2FzZSAnU0NBTEVET1dOJzpcclxuICAgICAgICAgIHZhciBmID0gRy50bi5vcHQuR2V0KCdkaXNwbGF5VHJhbnNpdGlvblN0YXJ0VmFsJyk7XHJcbiAgICAgICAgICBpZiggZiA9PSAwICkgeyBmPTEuMzsgfSAgIC8vIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAgIG9Gcm9tID0geyBzY2FsZTogZiwgb3BhY2l0eTogMCB9O1xyXG4gICAgICAgICAgb1RvID0gICB7IHNjYWxlOiAxLCBvcGFjaXR5OiAxIH07XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdTTElERVVQJzpcclxuICAgICAgICAgIHZhciBmID0gRy50bi5vcHQuR2V0KCdkaXNwbGF5VHJhbnNpdGlvblN0YXJ0VmFsJyk7XHJcbiAgICAgICAgICBpZiggZiA9PSAwICkgeyBmPTUwOyB9ICAgLy8gZGVmYXVsdCB2YWx1ZVxyXG4gICAgICAgICAgb0Zyb20gPSB7IG9wYWNpdHk6IDAsIHRyYW5zbGF0ZVk6IGYgfTtcclxuICAgICAgICAgIG9UbyA9ICAgeyBvcGFjaXR5OiAxLCB0cmFuc2xhdGVZOiAwIH07XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdTTElERURPV04nOlxyXG4gICAgICAgICAgdmFyIGY9Ry50bi5vcHQuR2V0KCdkaXNwbGF5VHJhbnNpdGlvblN0YXJ0VmFsJyk7XHJcbiAgICAgICAgICBpZiggZiA9PSAwICkgeyBmPS01MDsgfSAgIC8vIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAgIG9Gcm9tID0geyBvcGFjaXR5OiAwLCB0cmFuc2xhdGVZOiBmIH07XHJcbiAgICAgICAgICBvVG8gPSAgIHsgb3BhY2l0eTogMSwgdHJhbnNsYXRlWTogMCB9O1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnRkxJUFVQJzpcclxuICAgICAgICAgIHZhciBmPUcudG4ub3B0LkdldCgnZGlzcGxheVRyYW5zaXRpb25TdGFydFZhbCcpO1xyXG4gICAgICAgICAgaWYoIGYgPT0gMCApIHsgZj0xMDA7IH0gICAvLyBkZWZhdWx0IHZhbHVlXHJcbiAgICAgICAgICBvRnJvbSA9IHsgb3BhY2l0eTogMCwgdHJhbnNsYXRlWTogZiwgcm90YXRlWDogNDUgfTtcclxuICAgICAgICAgIG9UbyA9ICAgeyBvcGFjaXR5OiAxLCB0cmFuc2xhdGVZOiAwLCByb3RhdGVYOiAwICB9O1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBcclxuICAgICAgICBjYXNlICdGTElQRE9XTic6XHJcbiAgICAgICAgICB2YXIgZj1HLnRuLm9wdC5HZXQoJ2Rpc3BsYXlUcmFuc2l0aW9uU3RhcnRWYWwnKTtcclxuICAgICAgICAgIGlmKCBmID09IDAgKSB7IGY9LTEwMDsgfSAgIC8vIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAgIG9Gcm9tID0geyBvcGFjaXR5OiAwLCB0cmFuc2xhdGVZOiBmLCByb3RhdGVYOiAtNDUgfTtcclxuICAgICAgICAgIG9UbyA9ICAgeyBvcGFjaXR5OiAxLCB0cmFuc2xhdGVZOiAwLCByb3RhdGVYOiAwIH07XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdTTElERVVQMic6XHJcbiAgICAgICAgICB2YXIgZj1HLnRuLm9wdC5HZXQoJ2Rpc3BsYXlUcmFuc2l0aW9uU3RhcnRWYWwnKTtcclxuICAgICAgICAgIGlmKCBmID09IDAgKSB7IGY9MTAwOyB9ICAgLy8gZGVmYXVsdCB2YWx1ZVxyXG4gICAgICAgICAgb0Zyb20gPSB7IG9wYWNpdHk6IDAsIHRyYW5zbGF0ZVk6IGYsIHJvdGF0ZVk6IDQwIH07XHJcbiAgICAgICAgICBvVG8gPSAgIHsgb3BhY2l0eTogMSwgdHJhbnNsYXRlWTogMCwgcm90YXRlWTogMCAgfTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1NMSURFRE9XTjInOlxyXG4gICAgICAgICAgdmFyIGY9Ry50bi5vcHQuR2V0KCdkaXNwbGF5VHJhbnNpdGlvblN0YXJ0VmFsJyk7XHJcbiAgICAgICAgICBpZiggZiA9PSAwICkgeyBmPS0xMDA7IH0gICAvLyBkZWZhdWx0IHZhbHVlXHJcbiAgICAgICAgICBvRnJvbSA9IHsgb3BhY2l0eTogMCwgdHJhbnNsYXRlWTogZiwgcm90YXRlWTogNDAgfTtcclxuICAgICAgICAgIG9UbyA9ICAgeyBvcGFjaXR5OiAxLCB0cmFuc2xhdGVZOiAwLCByb3RhdGVZOiAwICB9O1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnU0xJREVSSUdIVCc6XHJcbiAgICAgICAgICB2YXIgZj1HLnRuLm9wdC5HZXQoJ2Rpc3BsYXlUcmFuc2l0aW9uU3RhcnRWYWwnKTtcclxuICAgICAgICAgIGlmKCBmID09IDAgKSB7IGY9LTE1MDsgfSAgIC8vIGRlZmF1bHQgdmFsdWVcclxuICAgICAgICAgIG9Gcm9tID0geyBvcGFjaXR5OiAwLCB0cmFuc2xhdGVYOiBmIH07XHJcbiAgICAgICAgICBvVG8gPSAgIHsgb3BhY2l0eTogMSwgdHJhbnNsYXRlWDogMCB9O1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgJ1NMSURFTEVGVCc6XHJcbiAgICAgICAgICB2YXIgZj1HLnRuLm9wdC5HZXQoJ2Rpc3BsYXlUcmFuc2l0aW9uU3RhcnRWYWwnKTtcclxuICAgICAgICAgIGlmKCBmID09IDAgKSB7IGY9MTUwOyB9ICAgLy8gZGVmYXVsdCB2YWx1ZVxyXG4gICAgICAgICAgb0Zyb20gPSB7IG9wYWNpdHk6IDAsIHRyYW5zbGF0ZVg6IGYgfTtcclxuICAgICAgICAgIG9UbyA9ICAgeyBvcGFjaXR5OiAxLCB0cmFuc2xhdGVYOiAwIH07XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIFxyXG4gICAgICAgIGNhc2UgJ0ZBREVJTic6XHJcbiAgICAgICAgICBvRnJvbSA9IHsgb3BhY2l0eTogMCB9O1xyXG4gICAgICAgICAgb1RvID0gICB7IG9wYWNpdHk6IDEgfTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIHZhciB0d2VlbmFibGUgPSBuZXcgTkdUd2VlbmFibGUoKTtcclxuICAgICAgdHdlZW5hYmxlLnR3ZWVuKHtcclxuICAgICAgICBmcm9tOiAgICAgICAgIG9Gcm9tLFxyXG4gICAgICAgIHRvOiAgICAgICAgICAgb1RvLFxyXG4gICAgICAgIGF0dGFjaG1lbnQ6ICAgeyAkZTppdGVtLiRlbHQsIGl0ZW06IGl0ZW0sIHR3OiB0d2VlbmFibGUgfSxcclxuICAgICAgICBkZWxheTogICAgICAgIGRlbGF5LFxyXG4gICAgICAgIGR1cmF0aW9uOiAgICAgRy50bi5vcHQuR2V0KCdkaXNwbGF5VHJhbnNpdGlvbkR1cmF0aW9uJyksXHJcbiAgICAgICAgZWFzaW5nOiAgICAgICBHLnRuLm9wdC5HZXQoJ2Rpc3BsYXlUcmFuc2l0aW9uRWFzaW5nJyksXHJcbiAgICAgICAgc3RlcDogICAgICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmKCBhdHQuaXRlbS4kZWx0ID09PSBudWxsICkgeyAgLy8gdGhlIHRodW1ibmFpbCBtYXkgaGF2ZSBiZWVuIGRlc3Ryb3llZCBzaW5jZSB0aGUgc3RhcnQgb2YgdGhlIGFuaW1hdGlvblxyXG4gICAgICAgICAgICAgIGF0dC50dy5zdG9wKGZhbHNlKTtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3dpdGNoIChHLnRuLm9wdC5HZXQoJ2Rpc3BsYXlUcmFuc2l0aW9uJykpIHtcclxuICAgICAgICAgICAgICBjYXNlICdSQU5ET01TQ0FMRSc6XHJcbiAgICAgICAgICAgICAgICBhdHQuJGUuY3NzKCBHLkNTU3RyYW5zZm9ybU5hbWUgLCAnc2NhbGUoJyArIHN0YXRlLnNjYWxlICsgJyknKS5jc3MoJ29wYWNpdHknLCBzdGF0ZS5vcGFjaXR5KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ1NDQUxFVVAnOlxyXG4gICAgICAgICAgICAgICAgYXR0LiRlLmNzcyggRy5DU1N0cmFuc2Zvcm1OYW1lICwgJ3NjYWxlKCcrc3RhdGUuc2NhbGUrJyknKS5jc3MoJ29wYWNpdHknLHN0YXRlLm9wYWNpdHkpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnU0NBTEVET1dOJzpcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLiRlbHQubGFzdCgpLmNzcygnb3BhY2l0eScsIHN0YXRlLm9wYWNpdHkpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMkdUaHVtYm5haWwnLCAnc2NhbGUnLCBzdGF0ZS5zY2FsZSk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NUcmFuc2Zvcm1BcHBseSgnLm5HWTJHVGh1bWJuYWlsJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTTElERVVQJzpcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLiRlbHQuY3NzKCdvcGFjaXR5Jywgc3RhdGUub3BhY2l0eSk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NUcmFuc2Zvcm1TZXQoJy5uR1kyR1RodW1ibmFpbCcsICd0cmFuc2xhdGUnLCAnMHB4LCAnK3N0YXRlLnRyYW5zbGF0ZVkgKyAncHgnKTtcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU1RyYW5zZm9ybUFwcGx5KCcubkdZMkdUaHVtYm5haWwnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ1NMSURFRE9XTic6XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS4kZWx0LmNzcygnb3BhY2l0eScsIHN0YXRlLm9wYWNpdHkpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMkdUaHVtYm5haWwnLCAndHJhbnNsYXRlJywgJzBweCwnK3N0YXRlLnRyYW5zbGF0ZVkrJ3B4Jyk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NUcmFuc2Zvcm1BcHBseSgnLm5HWTJHVGh1bWJuYWlsJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdGTElQVVAnOlxyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMkdUaHVtYm5haWwnLCAndHJhbnNsYXRlJywgJzBweCwnK3N0YXRlLnRyYW5zbGF0ZVkrJ3B4Jyk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NUcmFuc2Zvcm1TZXQoJy5uR1kyR1RodW1ibmFpbCcsICdyb3RhdGVYJywgc3RhdGUucm90YXRlWCsnZGVnJyk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS4kZWx0LmNzcygnb3BhY2l0eScsIHN0YXRlLm9wYWNpdHkpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoJy5uR1kyR1RodW1ibmFpbCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnRkxJUERPV04nOlxyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uJGVsdC5jc3MoJ29wYWNpdHknLCBzdGF0ZS5vcGFjaXR5KTtcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU1RyYW5zZm9ybVNldCgnLm5HWTJHVGh1bWJuYWlsJywgJ3RyYW5zbGF0ZScsICcwcHgsJyArIHN0YXRlLnRyYW5zbGF0ZVkgKyAncHgnKTtcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU1RyYW5zZm9ybVNldCgnLm5HWTJHVGh1bWJuYWlsJywgJ3JvdGF0ZVgnLCBzdGF0ZS5yb3RhdGVYICsgJ2RlZycpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoJy5uR1kyR1RodW1ibmFpbCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnU0xJREVVUDInOlxyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uJGVsdC5jc3MoJ29wYWNpdHknLCBzdGF0ZS5vcGFjaXR5KTtcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU1RyYW5zZm9ybVNldCgnLm5HWTJHVGh1bWJuYWlsJywgJ3RyYW5zbGF0ZScsICcwcHgsJyArIHN0YXRlLnRyYW5zbGF0ZVkgKyAncHgnKTtcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU1RyYW5zZm9ybVNldCgnLm5HWTJHVGh1bWJuYWlsJywgJ3JvdGF0ZVknLCBzdGF0ZS5yb3RhdGVZICsgJ2RlZycpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoJy5uR1kyR1RodW1ibmFpbCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnU0xJREVET1dOMic6XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS4kZWx0LmNzcygnb3BhY2l0eScsIHN0YXRlLm9wYWNpdHkpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMkdUaHVtYm5haWwnLCAndHJhbnNsYXRlJywgJzBweCwgJyArIHN0YXRlLnRyYW5zbGF0ZVkgKyAncHgnKTtcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLkNTU1RyYW5zZm9ybVNldCgnLm5HWTJHVGh1bWJuYWlsJywgJ3JvdGF0ZVknLCBzdGF0ZS5yb3RhdGVZICsgJ2RlZycpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoJy5uR1kyR1RodW1ibmFpbCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnU0xJREVSSUdIVCc6XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS4kZWx0LmNzcygnb3BhY2l0eScsIHN0YXRlLm9wYWNpdHkpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMkdUaHVtYm5haWwnLCAndHJhbnNsYXRlJywgc3RhdGUudHJhbnNsYXRlWCArICdweCwgMHB4Jyk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NUcmFuc2Zvcm1BcHBseSgnLm5HWTJHVGh1bWJuYWlsJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTTElERUxFRlQnOlxyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMkdUaHVtYm5haWwnLCAndHJhbnNsYXRlJywgc3RhdGUudHJhbnNsYXRlWCArICdweCwgMHB4Jyk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS4kZWx0LmNzcygnb3BhY2l0eScsIHN0YXRlLm9wYWNpdHkpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtQXBwbHkoJy5uR1kyR1RodW1ibmFpbCcpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnRkFERUlOJzpcclxuICAgICAgICAgICAgICAgIGF0dC4kZS5jc3Moc3RhdGUpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgLy8gYXR0LiRlLmNzcyggRy5DU1N0cmFuc2Zvcm1OYW1lICwgJ3NjYWxlKCcrc3RhdGUuc2NhbGUrJyknKS5jc3MoJ29wYWNpdHknLHN0YXRlLm9wYWNpdHkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZmluaXNoOiAgICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmKCBhdHQuaXRlbS4kZWx0ID09PSBudWxsICkgeyByZXR1cm47IH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHN3aXRjaCAoRy50bi5vcHQuR2V0KCdkaXNwbGF5VHJhbnNpdGlvbicpKSB7XHJcbiAgICAgICAgICAgICAgY2FzZSAnUkFORE9NU0NBTEUnOlxyXG4gICAgICAgICAgICAgICAgYXR0LiRlLmNzcyggRy5DU1N0cmFuc2Zvcm1OYW1lICwgJ3NjYWxlKCcrc3RhdGUuc2NhbGUrJyknKS5jc3MoJ29wYWNpdHknLCAnJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTQ0FMRVVQJzpcclxuICAgICAgICAgICAgICAgIGF0dC4kZS5jc3MoIEcuQ1NTdHJhbnNmb3JtTmFtZSAsICcnKS5jc3MoJ29wYWNpdHknLCAnJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTQ0FMRURPV04nOlxyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uJGVsdC5sYXN0KCkuY3NzKCdvcGFjaXR5JywgJycpO1xyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uQ1NTVHJhbnNmb3JtU2V0KCcubkdZMkdUaHVtYm5haWwnLCAnc2NhbGUnLCBzdGF0ZS5zY2FsZSk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NUcmFuc2Zvcm1BcHBseSgnLm5HWTJHVGh1bWJuYWlsJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTTElERVVQJzpcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLiRlbHQuY3NzKCdvcGFjaXR5JywgJycpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnU0xJREVET1dOJzpcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLiRlbHQuY3NzKCdvcGFjaXR5JywgJycpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnRkxJUFVQJzpcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLiRlbHQuY3NzKCdvcGFjaXR5JywgJycpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnRkxJUERPV04nOlxyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uJGVsdC5jc3MoJ29wYWNpdHknLCAnJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTTElERVVQMic6XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS4kZWx0LmNzcygnb3BhY2l0eScsICcnKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgJ1NMSURFRE9XTjInOlxyXG4gICAgICAgICAgICAgICAgYXR0Lml0ZW0uJGVsdC5jc3MoJ29wYWNpdHknLCAnJyk7XHJcbiAgICAgICAgICAgICAgICBhdHQuaXRlbS5DU1NUcmFuc2Zvcm1BcHBseSgnLm5HWTJHVGh1bWJuYWlsJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlICdTTElERVJJR0hUJzpcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLiRlbHQuY3NzKCdvcGFjaXR5JywgJycpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnU0xJREVMRUZUJzpcclxuICAgICAgICAgICAgICAgIGF0dC5pdGVtLiRlbHQuY3NzKCdvcGFjaXR5JywgJycpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAnRkFERUlOJzpcclxuICAgICAgICAgICAgICAgIGF0dC4kZS5jc3MoJ29wYWNpdHknLCAnJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBUaHVtYm5haWxBcHBlYXJGaW5pc2goYXR0Lml0ZW0pO1xyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gYmF0Y2ggZGlzcGxheSB0aHVtYm5haWxzIHdpdGggYW5pbWF0aW9uXHJcbiAgICBmdW5jdGlvbiBUaHVtYm5haWxEaXNwbGF5QW5pbUJhdGNoKCkge1xyXG4gICAgICBcclxuICAgICAgRy5HT00udGh1bWJuYWlsczJEaXNwbGF5LmZvckVhY2goIGZ1bmN0aW9uKG9uZSkge1xyXG4gICAgICAgIFRodW1ibmFpbERpc3BsYXlBbmltMihvbmUuaXRtLCBvbmUuZCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBHLkdPTS50aHVtYm5haWxzMkRpc3BsYXk9W107XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG5cclxuICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbiAgICAvLyBHYWxsZXJ5IGRpc3BsYXkgYW5pbWF0aW9uXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5QXBwZWFyKCkge1xyXG4gICAgICBcclxuICAgICAgdmFyIGQ9Ry5nYWxsZXJ5RGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbi5HZXQoKTtcclxuICAgICAgc3dpdGNoKCBHLmdhbGxlcnlEaXNwbGF5VHJhbnNpdGlvbi5HZXQoKSApe1xyXG4gICAgICAgIGNhc2UgJ1JPVEFURVgnOlxyXG4gICAgICAgICAgRy4kRS5iYXNlLmNzcyh7IHBlcnNwZWN0aXZlOiAnMTAwMHB4JywgJ3BlcnNwZWN0aXZlLW9yaWdpbic6ICc1MCUgMCUnIH0pO1xyXG4gICAgICAgICAgdmFyIHR3ZWVuYWJsZSA9IG5ldyBOR1R3ZWVuYWJsZSgpO1xyXG4gICAgICAgICAgdHdlZW5hYmxlLnR3ZWVuKHtcclxuICAgICAgICAgICAgZnJvbTogICAgICAgICB7IHI6IDUwIH0sXHJcbiAgICAgICAgICAgIHRvOiAgICAgICAgICAgeyByOiAwICB9LFxyXG4gICAgICAgICAgICBhdHRhY2htZW50OiAgIHsgb3JnSWR4OiBHLkdPTS5hbGJ1bUlkeCB9LFxyXG4gICAgICAgICAgICBkdXJhdGlvbjogICAgIGQsXHJcbiAgICAgICAgICAgIGVhc2luZzogICAgICAgJ2Vhc2VPdXRDaXJjJyxcclxuICAgICAgICAgICAgc3RlcDogICAgICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgICAgIGlmKCBhdHQub3JnSWR4ID09IEcuR09NLmFsYnVtSWR4ICkge1xyXG4gICAgICAgICAgICAgICAgLy8gd2luZG93Lm5nX2RyYWYoIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICBHLiRFLmNvblRuUGFyZW50LmNzcyggRy5DU1N0cmFuc2Zvcm1OYW1lICwgJ3JvdGF0ZVgoJyArIHN0YXRlLnIgKyAnZGVnKScpO1xyXG4gICAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ1NMSURFVVAnOlxyXG4gICAgICAgICAgRy4kRS5jb25UblBhcmVudC5jc3MoeyBvcGFjaXR5OiAwIH0pO1xyXG4gICAgICAgICAgdmFyIHR3ZWVuYWJsZSA9IG5ldyBOR1R3ZWVuYWJsZSgpO1xyXG4gICAgICAgICAgdHdlZW5hYmxlLnR3ZWVuKHtcclxuICAgICAgICAgICAgZnJvbTogICAgICAgICB7IHk6IDIwMCwgbzogMCB9LFxyXG4gICAgICAgICAgICB0bzogICAgICAgICAgIHsgeTogMCwgICBvOiAxIH0sXHJcbiAgICAgICAgICAgIGF0dGFjaG1lbnQ6ICAgeyBvcmdJZHg6IEcuR09NLmFsYnVtSWR4IH0sXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiAgICAgZCxcclxuICAgICAgICAgICAgZWFzaW5nOiAgICAgICAnZWFzZU91dENpcmMnLFxyXG4gICAgICAgICAgICBzdGVwOiAgICAgICAgIGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgaWYoIGF0dC5vcmdJZHggPT0gRy5HT00uYWxidW1JZHggKSB7XHJcbiAgICAgICAgICAgICAgICAvLyB3aW5kb3cubmdfZHJhZiggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgIEcuJEUuY29uVG5QYXJlbnQuY3NzKCBHLkNTU3RyYW5zZm9ybU5hbWUgLCAndHJhbnNsYXRlKCAwcHgsICcrc3RhdGUueSArICdweCknKS5jc3MoJ29wYWNpdHknLCBzdGF0ZS5vKTtcclxuICAgICAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdOT05FJzpcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuXHJcblxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4gICAgLy8gIyMjIyMgVEhVTUJOQUlMIEhPVkVSIE1BTkFHRU1FTlQgIyMjIyNcclxuICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsT3ZlckluaXQoIEdPTWlkeCApIHtcclxuICAgICAgLy8gT3ZlciBpbml0IGluIDIgc3RlcDpcclxuICAgICAgLy8gMSkgaW5pdCB3aXRoIHRodW1ibmFpbEJ1aWxkSW5pdDIgcGFyYW1ldGVyXHJcbiAgICAgIC8vIDIpIGluaXQgd2l0aCB0aGUgaG92ZXIgZWZmZWN0IHBhcmFtZXRlclxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICAgIHZhciBjdXJUbiA9IEcuR09NLml0ZW1zW0dPTWlkeF07XHJcbiAgICAgIHZhciBpdGVtID0gRy5JW2N1clRuLnRodW1ibmFpbElkeF07XHJcblxyXG4gICAgICBpZiggaXRlbS4kZWx0ID09IG51bGwgKSB7IHJldHVybjsgfSAvLyB6b21iaWVcclxuICAgICAgXHJcbiAgICAgIHZhciBmdSA9IEcuTy5mblRodW1ibmFpbEhvdmVySW5pdDtcclxuICAgICAgaWYoIGZ1ICE9PSBudWxsICkge1xyXG4gICAgICAgIHR5cGVvZiBmdSA9PSAnZnVuY3Rpb24nID8gZnUoJGUsIGl0ZW0sIEdPTWlkeCkgOiB3aW5kb3dbZnVdKCRlLCBpdGVtLCBHT01pZHgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBidWlsZCBpbml0aWFsaXphdGlvblxyXG4gICAgICB2YXIgaW5pdHMgPSBHLnRuLmJ1aWxkSW5pdC5nZXQoKTtcbiAgICAgIGZvciggdmFyIGogPSAwOyBqIDwgaW5pdHMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICBzd2l0Y2goIGluaXRzW2pdLnByb3BlcnR5ICkge1xyXG4gICAgICAgICAgLy8gQ1NTIFRyYW5zZm9ybVxyXG4gICAgICAgICAgY2FzZSAnc2NhbGUnOlxyXG4gICAgICAgICAgY2FzZSAncm90YXRlWCc6XHJcbiAgICAgICAgICBjYXNlICdyb3RhdGVZJzpcclxuICAgICAgICAgIGNhc2UgJ3JvdGF0ZVonOlxyXG4gICAgICAgICAgY2FzZSAndHJhbnNsYXRlWCc6XHJcbiAgICAgICAgICBjYXNlICd0cmFuc2xhdGVZJzpcclxuICAgICAgICAgIGNhc2UgJ3RyYW5zbGF0ZVonOlxyXG4gICAgICAgICAgICBpdGVtLkNTU1RyYW5zZm9ybVNldChpbml0c1tqXS5lbGVtZW50LCBpbml0c1tqXS5wcm9wZXJ0eSwgaW5pdHNbal0udmFsdWUpO1xyXG4gICAgICAgICAgICBpdGVtLkNTU1RyYW5zZm9ybUFwcGx5KGluaXRzW2pdLmVsZW1lbnQpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIC8vIENTUyBmaWx0ZXJcclxuICAgICAgICAgIGNhc2UgJ2JsdXInOlxyXG4gICAgICAgICAgY2FzZSAnYnJpZ2h0bmVzcyc6XHJcbiAgICAgICAgICBjYXNlICdncmF5c2NhbGUnOlxyXG4gICAgICAgICAgY2FzZSAnc2VwaWEnOlxuICAgICAgICAgIGNhc2UgJ2NvbnRyYXN0JzpcbiAgICAgICAgICBjYXNlICdvcGFjaXR5JzpcbiAgICAgICAgICBjYXNlICdzYXR1cmF0ZSc6XHJcbiAgICAgICAgICAgIGl0ZW0uQ1NTRmlsdGVyU2V0KGluaXRzW2pdLmVsZW1lbnQsIGluaXRzW2pdLnByb3BlcnR5LCBpbml0c1tqXS52YWx1ZSk7XHJcbiAgICAgICAgICAgIGl0ZW0uQ1NTRmlsdGVyQXBwbHkoaW5pdHNbal0uZWxlbWVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgdmFyICR0PWl0ZW0uJGdldEVsdChpbml0c1tqXS5lbGVtZW50KTtcclxuICAgICAgICAgICAgJHQuY3NzKCBpbml0c1tqXS5wcm9wZXJ0eSwgaW5pdHNbal0udmFsdWUgKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBob3ZlclxyXG4gICAgICB2YXIgZWZmZWN0cyA9IEcudG4uaG92ZXJFZmZlY3RzLmdldCgpO1xuICAgICAgZm9yKCB2YXIgaiA9IDA7IGogPCBlZmZlY3RzLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgaWYoIGVmZmVjdHNbal0uZmlyc3RLZXlmcmFtZSA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgIHN3aXRjaCggZWZmZWN0c1tqXS50eXBlICkge1xyXG4gICAgICAgICAgICBjYXNlICdzY2FsZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3JvdGF0ZVgnOlxyXG4gICAgICAgICAgICBjYXNlICdyb3RhdGVZJzpcclxuICAgICAgICAgICAgY2FzZSAncm90YXRlWic6XHJcbiAgICAgICAgICAgIGNhc2UgJ3RyYW5zbGF0ZVgnOlxyXG4gICAgICAgICAgICBjYXNlICd0cmFuc2xhdGVZJzpcclxuICAgICAgICAgICAgY2FzZSAndHJhbnNsYXRlWic6XHJcbiAgICAgICAgICAgICAgaXRlbS5DU1NUcmFuc2Zvcm1TZXQoZWZmZWN0c1tqXS5lbGVtZW50LCBlZmZlY3RzW2pdLnR5cGUsIGVmZmVjdHNbal0uZnJvbSk7XHJcbiAgICAgICAgICAgICAgaXRlbS5DU1NUcmFuc2Zvcm1BcHBseShlZmZlY3RzW2pdLmVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdibHVyJzpcclxuICAgICAgICAgICAgY2FzZSAnYnJpZ2h0bmVzcyc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2dyYXlzY2FsZSc6XHJcbiAgICAgICAgICAgIGNhc2UgJ3NlcGlhJzpcclxuICAgICAgICAgICAgY2FzZSAnY29udHJhc3QnOlxuICAgICAgICAgICAgY2FzZSAnb3BhY2l0eSc6XG4gICAgICAgICAgICBjYXNlICdzYXR1cmF0ZSc6XG4gICAgICAgICAgICAgIGl0ZW0uQ1NTRmlsdGVyU2V0KGVmZmVjdHNbal0uZWxlbWVudCwgZWZmZWN0c1tqXS50eXBlLCBlZmZlY3RzW2pdLmZyb20pO1xyXG4gICAgICAgICAgICAgIGl0ZW0uQ1NTRmlsdGVyQXBwbHkoZWZmZWN0c1tqXS5lbGVtZW50KTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICB2YXIgJHQgPSBpdGVtLiRnZXRFbHQoZWZmZWN0c1tqXS5lbGVtZW50KTtcclxuICAgICAgICAgICAgICAkdC5jc3MoIGVmZmVjdHNbal0udHlwZSwgZWZmZWN0c1tqXS5mcm9tICk7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGl0ZW0uaG92ZXJJbml0RG9uZT10cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIFRodW1ibmFpbEhvdmVyUmVJbml0QWxsKCkge1xyXG4gICAgICBpZiggRy5HT00uYWxidW1JZHggPT0gLTEgKSB7IHJldHVybjsgfTtcclxuICAgICAgdmFyIGwgPSBHLkdPTS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbCA7IGkrKyApIHtcclxuICAgICAgICBUaHVtYm5haWxPdmVySW5pdChpKTtcclxuICAgICAgICAvLyBHLkdPTS5pdGVtc1tpXS5ob3ZlcmVkPWZhbHNlO1xyXG4gICAgICAgIEcuSVtHLkdPTS5pdGVtc1tpXS50aHVtYm5haWxJZHhdLmhvdmVyZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBUaHVtYm5haWxIb3ZlciggR09NaWR4ICkge1xyXG4gICAgICBpZiggRy5HT00uYWxidW1JZHggPT0gLTEgfHwgIUcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCApIHsgcmV0dXJuOyB9O1xyXG4gICAgICBpZiggRy5HT00uc2xpZGVyLmhvc3RJZHggPT0gR09NaWR4ICkge1xyXG4gICAgICAgIC8vIHNsaWRlciBob3N0ZWQgb24gdGh1bWJuYWlsIC0+IG5vIGhvdmVyIGVmZmVjdFxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICB2YXIgY3VyVG4gPSBHLkdPTS5pdGVtc1tHT01pZHhdO1xyXG4gICAgICB2YXIgaXRlbSA9IEcuSVtjdXJUbi50aHVtYm5haWxJZHhdO1xyXG4gICAgICBpZiggaXRlbS5raW5kID09ICdhbGJ1bVVwJyB8fCBpdGVtLiRlbHQgPT0gbnVsbCApIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICBpdGVtLmhvdmVyZWQgPSB0cnVlO1xyXG5cclxuICAgICAgdmFyIGZ1ID0gRy5PLmZuVGh1bWJuYWlsSG92ZXI7XHJcbiAgICAgIGlmKCBmdSAhPT0gbnVsbCApIHtcclxuICAgICAgICB0eXBlb2YgZnUgPT0gJ2Z1bmN0aW9uJyA/IGZ1KGl0ZW0uJGVsdCwgaXRlbSwgR09NaWR4KSA6IHdpbmRvd1tmdV0oaXRlbS4kZWx0LCBpdGVtLCBHT01pZHgpO1xyXG4gICAgICB9XHJcbiAgICAgIHZhciBlZmZlY3RzID0gRy50bi5ob3ZlckVmZmVjdHMuZ2V0KCk7XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGZvciggdmFyIGogPSAwOyBqIDwgZWZmZWN0cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgaWYoIGVmZmVjdHNbal0uaG92ZXJpbiA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgLy9pdGVtLmFuaW1hdGUoIGVmZmVjdHNbal0sIGoqMTAsICB0cnVlICk7XHJcbiAgICAgICAgICAgIGl0ZW0uYW5pbWF0ZSggZWZmZWN0c1tqXSwgMCwgIHRydWUgKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gZWZmZWN0cyBvbiB3aG9sZSBsYXlvdXRcclxuICAgICAgICAvLyBHYWxsZXJ5UmVzaXplKCBHT01pZHggKTtcclxuICAgICAgfVxyXG4gICAgICBjYXRjaCAoZSkgeyBcclxuICAgICAgICBOYW5vQWxlcnQoRywgJ2Vycm9yIG9uIGhvdmVyOiAnICsgZS5tZXNzYWdlICk7XHJcbiAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsSG92ZXJPdXRBbGwoKSB7XHJcbiAgICAgIGlmKCBHLkdPTS5hbGJ1bUlkeCA9PSAtMSApIHsgcmV0dXJuOyB9O1xyXG4gICAgICB2YXIgbCA9IEcuR09NLml0ZW1zLmxlbmd0aDtcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsIDsgaSsrICkge1xyXG4gICAgICAgIGlmKCBHLkdPTS5pdGVtc1tpXS5pbkRpc3BsYXlBcmVhICkge1xyXG4gICAgICAgICAgVGh1bWJuYWlsSG92ZXJPdXQoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgRy5JW0cuR09NLml0ZW1zW2ldLnRodW1ibmFpbElkeF0uaG92ZXJlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsSG92ZXJPdXQoIEdPTWlkeCApIHtcclxuICAgICAgaWYoIEcuR09NLmFsYnVtSWR4ID09IC0xIHx8ICFHLmdhbGxlcnlSZXNpemVFdmVudEVuYWJsZWQgKSB7IHJldHVybjsgfVxyXG5cclxuICAgICAgaWYoIEcuR09NLnNsaWRlci5ob3N0SWR4ID09IEdPTWlkeCApIHtcclxuICAgICAgICAvLyBzbGlkZXIgb24gdGh1bWJuYWlsIC0+IG5vIGhvdmVyIGVmZmVjdFxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIGN1clRuID0gRy5HT00uaXRlbXNbR09NaWR4XTtcclxuICAgICAgdmFyIGl0ZW0gPSBHLklbY3VyVG4udGh1bWJuYWlsSWR4XTtcclxuICAgICAgaWYoIGl0ZW0ua2luZCA9PSAnYWxidW1VcCcgfHwgIWl0ZW0uaG92ZXJlZCApIHsgcmV0dXJuOyB9XHJcbiAgICAgIGl0ZW0uaG92ZXJlZCA9IGZhbHNlO1xyXG4gICAgICBpZiggaXRlbS4kZWx0ID09IG51bGwgKSB7IHJldHVybjsgfVxyXG5cclxuICAgICAgdmFyIGZ1ID0gRy5PLmZuVGh1bWJuYWlsSG92ZXJPdXQ7XHJcbiAgICAgIGlmKCBmdSAhPT0gbnVsbCApIHtcclxuICAgICAgICB0eXBlb2YgZnUgPT0gJ2Z1bmN0aW9uJyA/IGZ1KGl0ZW0uJGVsdCwgaXRlbSwgR09NaWR4KSA6IHdpbmRvd1tmdV0oaXRlbS4kZWx0LCBpdGVtLCBHT01pZHgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgZWZmZWN0cyA9IEcudG4uaG92ZXJFZmZlY3RzLmdldCgpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGZvciggdmFyIGogPSAwOyBqIDwgZWZmZWN0cy5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgaWYoIGVmZmVjdHNbal0uaG92ZXJvdXQgPT09IHRydWUgKSB7XHJcbiAgICAgICAgICAgIC8vIGl0ZW0uYW5pbWF0ZSggZWZmZWN0c1tqXSwgaioxMCwgZmFsc2UgKTtcclxuICAgICAgICAgICAgaXRlbS5hbmltYXRlKCBlZmZlY3RzW2pdLCAwLCBmYWxzZSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBlZmZlY3RzIG9uIHdob2xlIGxheW91dFxyXG4gICAgICAgIC8vIEdhbGxlcnlSZXNpemUoICk7XHJcbiAgICAgIH1cclxuICAgICAgY2F0Y2ggKGUpIHsgXHJcbiAgICAgICAgTmFub0FsZXJ0KEcsICdlcnJvciBvbiBob3Zlck91dDogJyArIGUubWVzc2FnZSApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcblxyXG4gICAgLyoqIEBmdW5jdGlvbiBEaXNwbGF5UGhvdG8gKi9cclxuICAgIGZ1bmN0aW9uIERpc3BsYXlQaG90byggaW1hZ2VJRCwgYWxidW1JRCApIHtcclxuXHJcbiAgICAgIGlmKCBHLk8uZGVidWdNb2RlICkgeyBjb25zb2xlLmxvZygnI0Rpc3BsYXlQaG90byA6ICcrICBhbGJ1bUlEICsnLScrIGltYWdlSUQpOyB9XHJcbiAgICAgIHZhciBhbGJ1bUlkeCA9IE5HWTJJdGVtLkdldElkeChHLCBhbGJ1bUlEKTtcclxuICAgICAgaWYoIGFsYnVtSWR4ID09IDAgKSB7XHJcbiAgICAgICAgRy5HT00uY3VyTmF2TGV2ZWwgPSAnbDEnO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIEcuR09NLmN1ck5hdkxldmVsID0gJ2xOJztcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYoIGFsYnVtSWR4ID09IC0xICkge1xyXG4gICAgICAgIC8vIGdldCBjb250ZW50IG9mIGFsYnVtIG9uIHJvb3QgbGV2ZWxcclxuICAgICAgICBpZiggRy5PLmtpbmQgIT0gJycgKSB7XHJcbiAgICAgICAgICAvLyBkbyBub3QgYWRkIGFsYnVtIGlmIE1hcmt1cCBvciBKYXZhc2NyaXB0IGRhdGFcclxuICAgICAgICAgIE5HWTJJdGVtLk5ldyggRywgJycsICcnLCBhbGJ1bUlELCAnMCcsICdhbGJ1bScgKTsgICAgLy8gY3JlYXRlIGVtcHR5IGFsYnVtXHJcbiAgICAgICAgICBhbGJ1bUlkeCA9IEcuSS5sZW5ndGggLSAxO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIG5neTJJdGVtSWR4ID0gTkdZMkl0ZW0uR2V0SWR4KEcsIGltYWdlSUQpO1xyXG4gICAgICBpZiggbmd5Mkl0ZW1JZHggPT0gLTEgKSB7XHJcbiAgICAgICAgLy8gZ2V0IGNvbnRlbnQgb2YgdGhlIGFsYnVtXHJcbiAgICAgICAgQWxidW1HZXRDb250ZW50KCBhbGJ1bUlELCBEaXNwbGF5UGhvdG8sIGltYWdlSUQsIGFsYnVtSUQgKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmKCBHLk8uZGVidWdNb2RlICkgeyBjb25zb2xlLmxvZygnI0Rpc3BsYXlQaG90byA6ICcrICBuZ3kySXRlbUlkeCk7IH1cclxuICAgICBcclxuICAgICAgRGlzcGxheVBob3RvSWR4KG5neTJJdGVtSWR4KTtcclxuICAgIFxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyBCRVRBIC0+IE5PVCBmaW5pc2hlZCBhbmQgbm90IHVzZWQgYXQgdGhpcyB0aW1lXHJcbiAgICAvLyBSZXRyaWV2ZSB0aGUgdGl0bGUrZGVzY3JpcHRpb24gb2YgT05FIGFsYnVtXHJcbiAgICBmdW5jdGlvbiBhbGJ1bUdldEluZm8oIGFsYnVtSWR4LCBmblRvQ2FsbCApIHtcclxuICAgICAgdmFyIHVybCA9ICAgJyc7XHJcbiAgICAgIHZhciBraW5kID0gICdpbWFnZSc7XHJcbiAgICAgIFxyXG4gICAgICBzd2l0Y2goIEcuTy5raW5kICkge1xyXG4gICAgICAgIGNhc2UgJ2pzb24nOlxyXG4gICAgICAgICAgLy8gVE9ET1xyXG4gICAgICAgIGNhc2UgJ2ZsaWNrcic6XHJcbiAgICAgICAgICAvLyBUT0RPXHJcbiAgICAgICAgY2FzZSAncGljYXNhJzpcclxuICAgICAgICBjYXNlICdnb29nbGUnOlxyXG4gICAgICAgIGNhc2UgJ2dvb2dsZTInOlxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB1cmwgPSBHLkdvb2dsZS51cmwoKSArICd1c2VyLycrRy5PLnVzZXJJRCsnL2FsYnVtaWQvJytHLklbYWxidW1JZHhdLkdldElEKCkrJz9hbHQ9anNvbiYmbWF4LXJlc3VsdHM9MSZmaWVsZHM9dGl0bGUnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGpRdWVyeS5hamF4U2V0dXAoeyBjYWNoZTogZmFsc2UgfSk7XHJcbiAgICAgIGpRdWVyeS5zdXBwb3J0LmNvcnMgPSB0cnVlO1xyXG4gICAgICBcclxuICAgICAgdmFyIHRJZCA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIC8vIHdvcmthcm91bmQgdG8gaGFuZGxlIEpTT05QIChjcm9zcy1kb21haW4pIGVycm9yc1xyXG4gICAgICAgIC8vUHJlbG9hZGVySGlkZSgpO1xyXG4gICAgICAgIE5hbm9BbGVydChHLCAnQ291bGQgbm90IHJldHJpZXZlIEFKQVggZGF0YS4uLicpO1xyXG4gICAgICB9LCA2MDAwMCApO1xyXG4gICAgICBqUXVlcnkuZ2V0SlNPTih1cmwsIGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgeGhyKSB7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRJZCk7XHJcbiAgICAgICAgLy9QcmVsb2FkZXJIaWRlKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgZm5Ub0NhbGwoIEcuSVthbGJ1bUlkeF0uR2V0SUQoKSApO1xyXG5cclxuICAgICAgfSlcclxuICAgICAgLmZhaWwoIGZ1bmN0aW9uKGpxeGhyLCB0ZXh0U3RhdHVzLCBlcnJvcikge1xyXG4gICAgICAgIGNsZWFyVGltZW91dCh0SWQpO1xyXG4gICAgICAgIC8vUHJlbG9hZGVySGlkZSgpO1xyXG4gICAgICAgIHZhciBlcnIgPSB0ZXh0U3RhdHVzICsgJywgJyArIGVycm9yO1xyXG4gICAgICAgIE5hbm9BbGVydCgnQ291bGQgbm90IHJldHJpZXZlIGFqYXggZGF0YTogJyArIGVycik7XHJcbiAgICAgIH0pOyAgICAgIFxyXG4gICAgXHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICAvLyBmdW5jdGlvbiBBbGJ1bUdldENvbnRlbnQoIGFsYnVtSWR4LCBmblRvQ2FsbCApIHtcclxuICAgIGZ1bmN0aW9uIEFsYnVtR2V0Q29udGVudCggYWxidW1JRCwgZm5Ub0NhbGwsIGZuUGFyYW0xLCBmblBhcmFtMiApIHtcclxuICAgICAgLy8gdmFyIHVybD0nJztcclxuICAgICAgLy8gdmFyIGtpbmQ9J2ltYWdlJztcclxuICAgICAgLy8gdmFyIGFsYnVtSWR4PU5HWTJJdGVtLkdldElkeChHLCBhbGJ1bUlEKTtcclxuICAgICAgLy8gdmFyIHBob3RvSWR4PU5HWTJJdGVtLkdldElkeChHLCBwaG90b0lEKTtcclxuICAgICAgXHJcbiAgICAgIHN3aXRjaCggRy5PLmtpbmQgKSB7XHJcbiAgICAgICAgLy8gTUFSS1VQIC8gQVBJXHJcbiAgICAgICAgY2FzZSAnJzpcclxuICAgICAgICAgIEFsYnVtR2V0TWFya3VwT3JBcGkoZm5Ub0NhbGwsIGZuUGFyYW0xLCBmblBhcmFtMik7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICAvLyBKU09OLCBGbGlja3IsIFBpY2FzYSwgLi4uXHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIGpRdWVyeS5uYW5vZ2FsbGVyeTJbJ2RhdGFfJytHLk8ua2luZF0oRywgJ0FsYnVtR2V0Q29udGVudCcsIGFsYnVtSUQsIGZuVG9DYWxsLCBmblBhcmFtMSwgZm5QYXJhbTIgKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgdmFyIG1lZGlhTGlzdCA9IHtcclxuICAgICAgeW91dHViZSA6IHtcclxuICAgICAgICBnZXRJRDogZnVuY3Rpb24oIHVybCApIHtcclxuICAgICAgICAgIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNTkxNTQ3L2hvdy10by1nZXQteW91dHViZS12aWRlby1pZC1mcm9tLXVybFxyXG4gICAgICAgICAgdmFyIHMgPSB1cmwubWF0Y2goIC8oPzpodHRwcz86XFwvezJ9KT8oPzp3ezN9XFwuKT95b3V0dSg/OmJlKT9cXC4oPzpjb218YmUpKD86XFwvd2F0Y2hcXD92PXxcXC8pKFteXFxzJl0rKS8gKTtcclxuICAgICAgICAgIHJldHVybiBzICE9IG51bGwgPyBzWzFdIDogbnVsbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRodW1iVXJsOiBmdW5jdGlvbiggaWQgKSB7XHJcbiAgICAgICAgICByZXR1cm4gJ2h0dHBzOi8vaW1nLnlvdXR1YmUuY29tL3ZpLycgKyBpZCArICcvaHFkZWZhdWx0LmpwZyc7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB1cmw6IGZ1bmN0aW9uKCBpZCApIHtcclxuICAgICAgICAgIHJldHVybiAnaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvJyArIGlkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWFya3VwOiBmdW5jdGlvbiggaWQgKSB7XHJcbiAgICAgICAgICAvLyByZXR1cm4gJzxpZnJhbWUgY2xhc3M9XCJuR1kyVmlld2VyTWVkaWFcIiBzcmM9XCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8nICsgaWQgKyAnP3JlbD0wXCIgZnJhbWVib3JkZXI9XCIwXCIgZ2VzdHVyZT1cIm1lZGlhXCIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPic7XHJcbiAgICAgICAgICByZXR1cm4gJzxpZnJhbWUgY2xhc3M9XCJuR1kyVmlld2VyTWVkaWFcIiBzcmM9XCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8nICsgaWQgKyAnP3JlbD0wXCIgZnJhbWVib3JkZXI9XCIwXCIgYWxsb3c9XCJhdXRvcGxheVwiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4nO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAga2luZDogJ2lmcmFtZSdcclxuICAgICAgfSxcclxuICAgICAgdmltZW8gOiB7XHJcbiAgICAgICAgZ2V0SUQ6IGZ1bmN0aW9uKCB1cmwgKSB7XHJcbiAgICAgICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yOTE2NTQ0L3BhcnNpbmctYS12aW1lby1pZC11c2luZy1qYXZhc2NyaXB0XHJcbiAgICAgICAgICB2YXIgcyA9IHVybC5tYXRjaCggL14uKih2aW1lb1xcLmNvbVxcLykoKGNoYW5uZWxzXFwvW0Etel0rXFwvKXwoZ3JvdXBzXFwvW0Etel0rXFwvdmlkZW9zXFwvKSk/KFswLTldKykvICk7XHJcbiAgICAgICAgICByZXR1cm4gcyAhPSBudWxsID8gc1s1XSA6IG51bGw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB1cmw6IGZ1bmN0aW9uKCBpZCApIHtcclxuICAgICAgICAgIHJldHVybiAnaHR0cHM6Ly9wbGF5ZXIudmltZW8uY29tL3ZpZGVvLycgKyBpZDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1hcmt1cDogZnVuY3Rpb24oIGlkICkge1xyXG4gICAgICAgICAgLy8gcmV0dXJuICc8aWZyYW1lIGNsYXNzPVwibkdZMlZpZXdlck1lZGlhXCIgc3JjPVwiaHR0cHM6Ly9wbGF5ZXIudmltZW8uY29tL3ZpZGVvLycgKyBpZCArICc/cmVsPTBcIiBmcmFtZWJvcmRlcj1cIjBcIiBnZXN0dXJlPVwibWVkaWFcIiBhbGxvd2Z1bGxzY3JlZW4+PC9pZnJhbWU+JztcclxuICAgICAgICAgIHJldHVybiAnPGlmcmFtZSBjbGFzcz1cIm5HWTJWaWV3ZXJNZWRpYVwiIHNyYz1cImh0dHBzOi8vcGxheWVyLnZpbWVvLmNvbS92aWRlby8nICsgaWQgKyAnP3JlbD0wXCIgZnJhbWVib3JkZXI9XCIwXCIgYWxsb3c9XCJhdXRvcGxheVwiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4nO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAga2luZDogJ2lmcmFtZSdcclxuICAgICAgfSxcclxuICAgICAgZGFpbHltb3Rpb24gOiB7XHJcbiAgICAgICAgZ2V0SUQ6IGZ1bmN0aW9uKCB1cmwgKSB7XHJcbiAgICAgICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjM4NzM4OS9ob3ctdG8tcGFyc2UtZGFpbHltb3Rpb24tdmlkZW8tdXJsLWluLWphdmFzY3JpcHRcclxuICAgICAgICAgIHZhciBtID0gdXJsLm1hdGNoKC9eLitkYWlseW1vdGlvbi5jb21cXC8odmlkZW98aHViKVxcLyhbXl9dKylbXiNdKigjdmlkZW89KFteXyZdKykpPy8pO1xyXG4gICAgICAgICAgaWYgKG0gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICBpZihtWzRdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIG1bNF07XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHJldHVybiBtWzJdO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0aHVtYlVybDogZnVuY3Rpb24oIGlkICkge1xyXG4gICAgICAgICAgcmV0dXJuICdodHRwczovL3d3dy5kYWlseW1vdGlvbi5jb20vdGh1bWJuYWlsL3ZpZGVvLycgKyBpZDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHVybDogZnVuY3Rpb24oIGlkICkge1xyXG4gICAgICAgICAgcmV0dXJuICdodHRwczovL3d3dy5kYWlseW1vdGlvbi5jb20vZW1iZWQvdmlkZW8vJyArIGlkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWFya3VwOiBmdW5jdGlvbiggaWQgKSB7XHJcbiAgICAgICAgICAvLyByZXR1cm4gJzxpZnJhbWUgY2xhc3M9XCJuR1kyVmlld2VyTWVkaWFcIiBzcmM9XCJodHRwczovL3d3dy5kYWlseW1vdGlvbi5jb20vZW1iZWQvdmlkZW8vJyArIGlkICsgJz9yZWw9MFwiIGZyYW1lYm9yZGVyPVwiMFwiIGdlc3R1cmU9XCJtZWRpYVwiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4nO1xyXG4gICAgICAgICAgcmV0dXJuICc8aWZyYW1lIGNsYXNzPVwibkdZMlZpZXdlck1lZGlhXCIgc3JjPVwiaHR0cHM6Ly93d3cuZGFpbHltb3Rpb24uY29tL2VtYmVkL3ZpZGVvLycgKyBpZCArICc/cmVsPTBcIiBmcmFtZWJvcmRlcj1cIjBcIiBhbGxvdz1cImF1dG9wbGF5XCIgYWxsb3dmdWxsc2NyZWVuPjwvaWZyYW1lPic7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBraW5kOiAnaWZyYW1lJ1xyXG4gICAgICB9LFxyXG4gICAgICBzZWxmaG9zdGVkIDoge1xyXG5cdFx0XHRcdC8vIFNFTEYtSE9TVEVEIFZJREVPU1xyXG4gICAgICAgIGdldElEOiBmdW5jdGlvbiggdXJsICkge1xyXG4gICAgICAgICAgLy8gSW4gb3JkZXIgdG8gbGVhdmUgdGhpbmdzIGFzIGlzLCBJIHVzZWQgSUQgdG8gaWRlbnRpZnkgdGhlIGV4dGVuc2lvblxyXG4gICAgICAgICAgLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNjk5NzI2Mi9ob3ctdG8tcHVsbC11cmwtZmlsZS1leHRlbnNpb24tb3V0LW9mLXVybC1zdHJpbmctdXNpbmctamF2YXNjcmlwdFxyXG4gICAgICAgICAgLy8gTWFrZSBzdXJlIHRoZSBtZXRob2QgdXNlZCBmb3IgdmVyaWZ5aW5nIHRoZSBleHRlbnNpb24gbWF0Y2hlcyB0aGUga2luZCBvZiB1cmwgeW91ciBzZWxmaG9zdGVkIHZpZGVvIGhhc1xyXG4gICAgICAgICAgdmFyIGV4dGVuc2lvbiA9IHVybC5zcGxpdCgnLicpLnBvcCgpO1xyXG5cclxuICAgICAgICAgIC8vIHN1cHBvcnRlZCBleHRlbnNpb25zXHJcbiAgICAgICAgICB2YXIgcyA9ICggZXh0ZW5zaW9uID09PSAnbXA0JyB8fCBleHRlbnNpb24gPT09ICd3ZWJtJyB8fCBleHRlbnNpb24gPT09ICdvZ3YnIHx8IGV4dGVuc2lvbiA9PT0gJzNncCcgKSA/IGV4dGVuc2lvbiA6IG51bGwgO1xyXG4gICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBtYXJrdXA6IGZ1bmN0aW9uKCB1cmwgKSB7XHJcbiAgICAgICAgICAvLyByZXR1cm4gJzx2aWRlbyBjb250cm9scyBjbGFzcz1cIm5HWTJWaWV3ZXJNZWRpYVwiPjxzb3VyY2Ugc3JjPVwiJHtpZC5zcmN9XCIgdHlwZT1cInZpZGVvLyR7aWQudHlwZX1cIiBwcmVsb2FkPVwiYXV0b1wiPllvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IHRoZSB2aWRlbyB0YWcgKEhUTUwgNSkuPC92aWRlbz4nO1xyXG4gICAgICAgICAgdmFyIGV4dGVuc2lvbiA9IHVybC5zcGxpdCgnLicpLnBvcCgpO1xyXG4gICAgICAgICAgcmV0dXJuICc8dmlkZW8gY29udHJvbHMgY2xhc3M9XCJuR1kyVmlld2VyTWVkaWFcIj48c291cmNlIHNyYz1cIicrIHVybCArJ1wiIHR5cGU9XCJ2aWRlby8nKyBleHRlbnNpb24gKydcIiBwcmVsb2FkPVwiYXV0b1wiPllvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IHRoZSB2aWRlbyB0YWcgKEhUTUwgNSkuPC92aWRlbz4nO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAga2luZDogJ3ZpZGVvJyxcclxuICAgICAgICBzZWxmaG9zdGVkIDogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgZnVuY3Rpb24gQWxidW1HZXRNYXJrdXBPckFwaSAoIGZuVG9DYWxsLCBmblBhcmFtMSwgZm5QYXJhbTIgKSB7XHJcbiAgICBcclxuICAgICAgaWYoIEcubWFya3VwT3JBcGlQcm9jZXNzZWQgPT09IHRydWUgKSB7XHJcbiAgICAgICAgLy8gYWxyZWFkeSBwcm9jZXNzZWQgKG1heWJlIGxvY2F0aW9uIGhhc2ggdG8gdW5rbm93IHJlZmVyZW5jZSkgLT4gZGlzcGxheSByb290IGFsYnVtXHJcbiAgICAgICAgRGlzcGxheUFsYnVtKCctMScsIDApO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYoIEcuTy5pdGVtcyAhPT0gdW5kZWZpbmVkICYmIEcuTy5pdGVtcyAhPT0gbnVsbCApIHtcclxuICAgICAgICAvLyBkYXRhIGRlZmluZWQgYXMgYW4gb2JqZWN0IGluIGFuIG9wdGlvbiBwYXJhbWV0ZXJcclxuICAgICAgICBHZXRDb250ZW50QXBpT2JqZWN0KCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgIGlmKCBHLk8uJG1hcmt1cC5sZW5ndGggPiAwICkge1xyXG4gICAgICAgICAgLy8gZGF0YSBkZWZpbmVkIGFzIG1hcmt1cCAoaHJlZiBlbGVtZW50cylcclxuICAgICAgICAgIEdldENvbnRlbnRNYXJrdXAoIEcuTy4kbWFya3VwICk7XHJcbiAgICAgICAgICBHLk8uJG1hcmt1cD1bXSAgO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIE5hbm9Db25zb2xlTG9nKEcsICdlcnJvcjogbm8gbWVkaWEgdG8gcHJvY2Vzcy4nKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIEcubWFya3VwT3JBcGlQcm9jZXNzZWQgPSB0cnVlO1xyXG4gICAgICBpZiggZm5Ub0NhbGwgIT09IG51bGwgJiYgIGZuVG9DYWxsICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBmblRvQ2FsbCggZm5QYXJhbTEsIGZuUGFyYW0yLCBudWxsICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gU3RhcnRzV2l0aFByb3RvY29sICggcGF0aCApIHtcclxuICAgICAgaWYoIHBhdGggPT0gbnVsbCB8fCBwYXRoID09IHVuZGVmaW5lZCApIHsgcmV0dXJuIGZhbHNlOyB9XHJcbiAgICAgIFxyXG4gICAgICB2YXIgcGF0dGVybiA9IC9eKChodHRwfGh0dHBzfGZ0cHxmdHBzfGZpbGUpOlxcL1xcLykvO1xyXG4gICAgICBpZiggIXBhdHRlcm4udGVzdChwYXRoKSApIHtcclxuICAgICAgICAvLyBub3QgYSBmdWxsIFVSTFxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gR2V0Q29udGVudEFwaU9iamVjdCgpIHtcclxuICAgICAgdmFyIGZvdW5kQWxidW1JRD1mYWxzZTtcclxuICAgICAgdmFyIG5iVGl0bGVzID0gMDtcclxuICAgICAgdmFyIEFsYnVtUG9zdFByb2Nlc3MgPSBOR1kyVG9vbHMuQWxidW1Qb3N0UHJvY2Vzcy5iaW5kKEcpO1xyXG5cclxuICAgICAgRy5JWzBdLmNvbnRlbnRJc0xvYWRlZD10cnVlO1xyXG5cclxuICAgICAgalF1ZXJ5LmVhY2goRy5PLml0ZW1zLCBmdW5jdGlvbihpLGl0ZW0pe1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB0aXRsZSA9ICcnO1xyXG4gICAgICAgIHRpdGxlPUdldEkxOG5JdGVtKGl0ZW0sICd0aXRsZScpO1xyXG4gICAgICAgIGlmKCB0aXRsZSA9PT0gdW5kZWZpbmVkICkgeyB0aXRsZT0nJzsgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBzcmM9Jyc7XHJcbiAgICAgICAgaWYoIGl0ZW1bJ3NyYycrUmV0cmlldmVDdXJXaWR0aCgpLnRvVXBwZXJDYXNlKCldICE9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICBzcmMgPSBpdGVtWydzcmMnK1JldHJpZXZlQ3VyV2lkdGgoKS50b1VwcGVyQ2FzZSgpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBzcmMgPSBpdGVtLnNyYztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoICFTdGFydHNXaXRoUHJvdG9jb2woc3JjKSApIHtcclxuICAgICAgICAgIHNyYyA9IEcuTy5pdGVtc0Jhc2VVUkwgKyBzcmM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgdGh1bWJzcmMgPSAnJztcclxuICAgICAgICBpZiggaXRlbS5zcmN0ICE9PSB1bmRlZmluZWQgJiYgaXRlbS5zcmN0Lmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgICB0aHVtYnNyYyA9IGl0ZW0uc3JjdDtcclxuICAgICAgICAgIGlmKCAhU3RhcnRzV2l0aFByb3RvY29sKHRodW1ic3JjKSApIHtcclxuICAgICAgICAgICAgdGh1bWJzcmMgPSBHLk8uaXRlbXNCYXNlVVJMICsgdGh1bWJzcmM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdGh1bWJzcmMgPSBzcmM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB0aHVtYnNyY1gyID0gJyc7XHJcbiAgICAgICAgaWYoIGl0ZW0uc3JjdDJ4ICE9PSB1bmRlZmluZWQgJiYgaXRlbS5zcmN0MngubGVuZ3RoID4gMCApIHtcclxuICAgICAgICAgIHRodW1ic3JjWDIgPSBpdGVtLnNyY3QyeDtcclxuICAgICAgICAgIGlmKCAhU3RhcnRzV2l0aFByb3RvY29sKHRodW1ic3JjWDIpICkge1xyXG4gICAgICAgICAgICB0aHVtYnNyY1gyID0gRy5PLml0ZW1zQmFzZVVSTCArIHRodW1ic3JjWDI7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgaWYoIHRodW1ic3JjICE9ICcnICkge1xyXG4gICAgICAgICAgICB0aHVtYnNyY1gyID0gdGh1bWJzcmM7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGh1bWJzcmNYMiA9IHNyYztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCBHLk8udGh1bWJuYWlsTGFiZWwuZ2V0KCd0aXRsZScpICE9ICcnICkge1xyXG4gICAgICAgICAgdGl0bGUgPSBHZXRJbWFnZVRpdGxlKHNyYyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZGVzY3JpcHRpb249Jyc7ICAgICAvLycmbmJzcDsnO1xyXG4gICAgICAgIGRlc2NyaXB0aW9uPUdldEkxOG5JdGVtKGl0ZW0sJ2Rlc2NyaXB0aW9uJyk7XHJcbiAgICAgICAgaWYoIGRlc2NyaXB0aW9uID09PSB1bmRlZmluZWQgKSB7IGRlc2NyaXB0aW9uPScnOyB9XHJcbiAgICAgICAgLy9pZiggdG9UeXBlKGl0ZW0uZGVzY3JpcHRpb24pID09ICdzdHJpbmcnICkge1xyXG4gICAgICAgIC8vICBkZXNjcmlwdGlvbj1pdGVtLmRlc2NyaXB0aW9uO1xyXG4gICAgICAgIC8vfVxyXG5cclxuICAgICAgICB2YXIgdGFncyA9IEdldEkxOG5JdGVtKGl0ZW0sICd0YWdzJyk7XHJcbiAgICAgICAgaWYoIHRhZ3MgPT09IHVuZGVmaW5lZCApIHsgdGFncz0nJzsgfVxyXG5cclxuICAgICAgICB2YXIgYWxidW1JRCA9IDA7XHJcbiAgICAgICAgaWYoIGl0ZW0uYWxidW1JRCAhPT0gdW5kZWZpbmVkICApIHtcclxuICAgICAgICAgIGFsYnVtSUQ9aXRlbS5hbGJ1bUlEO1xyXG4gICAgICAgICAgZm91bmRBbGJ1bUlEID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIElEID0gbnVsbDtcclxuICAgICAgICBpZiggaXRlbS5JRCAhPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgSUQgPSBpdGVtLklEO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIga2luZCA9ICdpbWFnZSc7XHJcbiAgICAgICAgaWYoIGl0ZW0ua2luZCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0ua2luZC5sZW5ndGggPiAwICkge1xyXG4gICAgICAgICAga2luZCA9IGl0ZW0ua2luZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIG5ld0l0ZW09TkdZMkl0ZW0uTmV3KCBHLCB0aXRsZSwgZGVzY3JpcHRpb24sIElELCBhbGJ1bUlELCBraW5kLCB0YWdzICk7XHJcbiAgICAgICAgaWYoIHRpdGxlICE9ICcnICkge1xyXG4gICAgICAgICAgbmJUaXRsZXMrKztcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gbWVkaWEgc291cmNlIHVybCAtIGltZyBpcyB0aGUgZGVmYXVsdCBtZWRpYSBraW5kXHJcbiAgICAgICAgbmV3SXRlbS5zZXRNZWRpYVVSTCggc3JjLCAnaW1nJyk7XHJcblxyXG4gICAgICAgIC8vIG1hbmFnZSBtZWRpYSBraW5kcyBvdGhlciB0aGFuIElNR1xyXG4gICAgICAgIGpRdWVyeS5lYWNoKG1lZGlhTGlzdCwgZnVuY3Rpb24gKCBuLCBtZWRpYSApIHtcclxuICAgICAgICAgIHZhciBpZCA9IG1lZGlhLmdldElEKHNyYyk7XHJcbiAgICAgICAgICBpZiggaWQgIT0gbnVsbCApIHtcclxuICAgICAgICAgICAgaWYoIHR5cGVvZiBtZWRpYS51cmwgPT0gJ2Z1bmN0aW9uJyApIHsgc3JjID0gbWVkaWEudXJsKGlkKTsgIH1cclxuICAgICAgICAgICAgaWYoIHR5cGVvZiBtZWRpYS50aHVtYlVybCA9PSAnZnVuY3Rpb24nICkgeyB0aHVtYnNyYyA9IG1lZGlhLnRodW1iVXJsKGlkKTsgIH1cclxuICAgICAgICAgICAgbmV3SXRlbS5tZWRpYUtpbmQgPSBtZWRpYS5raW5kO1xyXG4gICAgICAgICAgICBuZXdJdGVtLm1lZGlhTWFya3VwID0gKCBtZWRpYS5zZWxmaG9zdGVkICkgPyBtZWRpYS5tYXJrdXAoIHNyYyApIDogbWVkaWEubWFya3VwKGlkKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBpbWFnZSBzaXplXHJcbiAgICAgICAgaWYoIGl0ZW0uaW1hZ2VXaWR0aCAhPT0gdW5kZWZpbmVkICkgeyBuZXdJdGVtLmltYWdlV2lkdGggPSBpdGVtLndpZHRoOyB9XHJcbiAgICAgICAgaWYoIGl0ZW0uaW1hZ2VIZWlnaHQgIT09IHVuZGVmaW5lZCApIHsgbmV3SXRlbS5pbWFnZUhlaWdodCA9IGl0ZW0uaGVpZ2h0OyB9XHJcblxyXG4gICAgICAgIC8vIFRIVU1CTkFJTFNcclxuICAgICAgICBcclxuICAgICAgICAvLyB0aHVtYm5haWwgaW1hZ2Ugc2l6ZVxyXG4gICAgICAgIHZhciB0dyA9IGl0ZW0uaW1ndFdpZHRoICE9PSB1bmRlZmluZWQgPyBpdGVtLmltZ3RXaWR0aCA6IDA7XHJcbiAgICAgICAgdmFyIHRoID0gaXRlbS5pbWd0SGVpZ2h0ICE9PSB1bmRlZmluZWQgPyBpdGVtLmltZ3RIZWlnaHQgOiAwO1xyXG5cclxuICAgICAgICAvLyBkZWZhdWx0IHRodW1ibmFpbCBVUkwgYW5kIHNpemVcclxuICAgICAgICBuZXdJdGVtLnRodW1icyA9IHtcclxuICAgICAgICAgIHVybDogICAgeyBsMSA6IHsgeHM6IHRodW1ic3JjLCBzbTogdGh1bWJzcmMsIG1lOiB0aHVtYnNyYywgbGE6IHRodW1ic3JjLCB4bDogdGh1bWJzcmMgfSwgbE4gOiB7IHhzOiB0aHVtYnNyYywgc206IHRodW1ic3JjLCBtZTogdGh1bWJzcmMsIGxhOiB0aHVtYnNyYywgeGw6IHRodW1ic3JjIH0gfSxcclxuICAgICAgICAgIHdpZHRoOiAgeyBsMSA6IHsgeHM6IHR3LCBzbTogdHcsIG1lOiB0dywgbGE6IHR3LCB4bDogdHcgfSwgbE4gOiB7IHhzOiB0dywgc206IHR3LCBtZTogdHcsIGxhOiB0dywgeGw6IHR3IH0gfSxcclxuICAgICAgICAgIGhlaWdodDogeyBsMSA6IHsgeHM6IHRoLCBzbTogdGgsIG1lOiB0aCwgbGE6IHRoLCB4bDogdGggfSwgbE4gOiB7IHhzOiB0aCwgc206IHRoLCBtZTogdGgsIGxhOiB0aCwgeGw6IHRoIH0gfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gZGVmYXVsdCBtZWRpYSB0eXBlIC0+IElNR1xyXG4gICAgICAgIGlmKCBuZXdJdGVtLm1lZGlhS2luZCA9PSAnaW1nJyApIHtcclxuICAgICAgICBcclxuICAgICAgICAgIC8vIHJlc3BvbnNpdmUgdGh1bWJuYWlscyBVUkwgYW5kIHNpemVcclxuICAgICAgICAgIHZhciBsc3Q9Wyd4cycsICdzbScsICdtZScsICdsYScsICd4bCddO1xyXG4gICAgICAgICAgZm9yKCB2YXIgaT0wOyBpPCBsc3QubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgIC8vIHVybFxyXG4gICAgICAgICAgICB2YXIgdHVybCA9IGl0ZW1bJ3NyY3QnICsgbHN0W2ldLnRvVXBwZXJDYXNlKCldO1xyXG4gICAgICAgICAgICBpZiggdHVybCAhPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgICAgIGlmKCAhU3RhcnRzV2l0aFByb3RvY29sKHR1cmwpICkge1xyXG4gICAgICAgICAgICAgICAgdHVybCA9IEcuTy5pdGVtc0Jhc2VVUkwgKyB0dXJsO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBuZXdJdGVtLnVybC5sMVtsc3RbaV1dID0gdHVybDtcclxuICAgICAgICAgICAgICBuZXdJdGVtLnVybC5sTltsc3RbaV1dID0gdHVybDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyB3aWR0aFxyXG4gICAgICAgICAgICB2YXIgdHcgPSBpdGVtWydpbWd0JyArIGxzdFtpXS50b1VwcGVyQ2FzZSgpICsgJ1dpZHRoJ107XHJcbiAgICAgICAgICAgIGlmKCB0dyAhPSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgICAgbmV3SXRlbS53aWR0aC5sMVtsc3RbaV1dID0gcGFyc2VJbnQodHcpO1xyXG4gICAgICAgICAgICAgIG5ld0l0ZW0ud2lkdGgubE5bbHN0W2ldXSA9IHBhcnNlSW50KHR3KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBoZWlnaHRcclxuICAgICAgICAgICAgdmFyIHRoID0gaXRlbVsnaW1ndCcgKyBsc3RbaV0udG9VcHBlckNhc2UoKSArICdIZWlnaHQnXTtcclxuICAgICAgICAgICAgaWYoIHRoICE9IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgICAgICBuZXdJdGVtLmhlaWdodC5sMVtsc3RbaV1dID0gcGFyc2VJbnQodGgpO1xyXG4gICAgICAgICAgICAgIG5ld0l0ZW0uaGVpZ2h0LmxOW2xzdFtpXV0gPSBwYXJzZUludCh0aCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gZG9taW5hbnQgY29sb3JzIChuZWVkcyB0byBiZSBhIGJhc2U2NCBnaWYpXHJcbiAgICAgICAgaWYoIGl0ZW0uaW1hZ2VEb21pbmFudENvbG9ycyAhPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgbmV3SXRlbS5pbWFnZURvbWluYW50Q29sb3JzID0gaXRlbS5pbWFnZURvbWluYW50Q29sb3JzO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBkb21pbmFudCBjb2xvciAocmdiIGhleClcclxuICAgICAgICBpZiggaXRlbS5pbWFnZURvbWluYW50Q29sb3IgIT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgIG5ld0l0ZW0uaW1hZ2VEb21pbmFudENvbG9yID0gaXRlbS5pbWFnZURvbWluYW50Q29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGRlc3QgdXJsXHJcbiAgICAgICAgaWYoIGl0ZW0uZGVzdFVSTCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGVzdFVSTC5sZW5ndGg+MCApIHtcclxuICAgICAgICAgIG5ld0l0ZW0uZGVzdGluYXRpb25VUkwgPSBpdGVtLmRlc3RVUkw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGRvd25sb2FkIGltYWdlIHVybFxyXG4gICAgICAgIGlmKCBpdGVtLmRvd25sb2FkVVJMICE9PSB1bmRlZmluZWQgJiYgaXRlbS5kb3dubG9hZFVSTC5sZW5ndGg+MCApIHtcclxuICAgICAgICAgIG5ld0l0ZW0uZG93bmxvYWRVUkwgPSBpdGVtLmRvd25sb2FkVVJMO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBFWElGIERBVEFcclxuICAgICAgICAvLyBFeGlmIC0gbW9kZWxcclxuICAgICAgICBpZiggaXRlbS5leGlmTW9kZWwgIT09IHVuZGVmaW5lZCApIHsgbmV3SXRlbS5leGlmLm1vZGVsID0gaXRlbS5leGlmTW9kZWw7IH1cclxuICAgICAgICAvLyBFeGlmIC0gZmxhc2hcclxuICAgICAgICBpZiggaXRlbS5leGlmRmxhc2ggIT09IHVuZGVmaW5lZCApIHsgbmV3SXRlbS5leGlmLmZsYXNoID0gaXRlbS5leGlmRmxhc2g7IH1cclxuICAgICAgICAvLyBFeGlmIC0gZm9jYWxsZW5ndGhcclxuICAgICAgICBpZiggaXRlbS5leGlmRm9jYWxMZW5ndGggIT09IHVuZGVmaW5lZCApIHsgbmV3SXRlbS5leGlmLmZvY2FsbGVuZ3RoID0gaXRlbS5leGlmRm9jYWxMZW5ndGg7IH1cclxuICAgICAgICAvLyBFeGlmIC0gZnN0b3BcclxuICAgICAgICBpZiggaXRlbS5leGlmRlN0b3AgIT09IHVuZGVmaW5lZCApIHsgbmV3SXRlbS5leGlmLmZzdG9wID0gaXRlbS5leGlmRlN0b3A7IH1cclxuICAgICAgICAvLyBFeGlmIC0gZXhwb3N1cmVcclxuICAgICAgICBpZiggaXRlbS5leGlmRXhwb3N1cmUgIT09IHVuZGVmaW5lZCApIHsgbmV3SXRlbS5leGlmLmV4cG9zdXJlID0gaXRlbS5leGlmRXhwb3N1cmU7IH1cclxuICAgICAgICAvLyBFeGlmIC0gdGltZVxyXG4gICAgICAgIGlmKCBpdGVtLmV4aWZJc28gIT09IHVuZGVmaW5lZCApIHsgbmV3SXRlbS5leGlmLmlzbyA9IGl0ZW0uZXhpZklzbzsgfVxyXG4gICAgICAgIC8vIEV4aWYgLSBpc29cclxuICAgICAgICBpZiggaXRlbS5leGlmVGltZSAhPT0gdW5kZWZpbmVkICkgeyBuZXdJdGVtLmV4aWYudGltZSA9IGl0ZW0uZXhpZlRpbWU7IH1cclxuICAgICAgICAvLyBFeGlmIC0gbG9jYXRpb25cclxuICAgICAgICBpZiggaXRlbS5leGlmTG9jYXRpb24gIT09IHVuZGVmaW5lZCApIHsgbmV3SXRlbS5leGlmLmxvY2F0aW9uICA9IGl0ZW0uZXhpZkxvY2F0aW9uOyB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gY3VzdG9tIGRhdGFcclxuICAgICAgICBpZiggaXRlbS5jdXN0b21EYXRhICE9PSBudWxsICkge1xyXG4gICAgICAgICAgbmV3SXRlbS5jdXN0b21EYXRhID0gY2xvbmVKU09iamVjdCggaXRlbS5jdXN0b21EYXRhICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBuZXdJdGVtLmNvbnRlbnRJc0xvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgdmFyIGZ1ID0gRy5PLmZuUHJvY2Vzc0RhdGE7XHJcbiAgICAgICAgaWYoIGZ1ICE9PSBudWxsICkge1xyXG4gICAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdShuZXdJdGVtLCAnYXBpJywgaXRlbSkgOiB3aW5kb3dbZnVdKG5ld0l0ZW0sICdhcGknLCBpdGVtKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXG4gICAgICAgIEFsYnVtUG9zdFByb2Nlc3MoYWxidW1JRCk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gaWYoIGZvdW5kQWxidW1JRCApIHsgRy5PLmRpc3BsYXlCcmVhZGNydW1iPXRydWU7IH1cclxuICAgICAgaWYoIG5iVGl0bGVzID09IDAgKSB7IEcuTy50aHVtYm5haWxMYWJlbC5kaXNwbGF5PWZhbHNlOyB9XHJcblxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIEdldENvbnRlbnRNYXJrdXAoICRlbGVtZW50cyApIHtcclxuICAgICAgdmFyIGZvdW5kQWxidW1JRCA9IGZhbHNlO1xyXG4gICAgICB2YXIgbmJUaXRsZXMgPSAwO1xyXG4gICAgICB2YXIgQWxidW1Qb3N0UHJvY2VzcyA9IE5HWTJUb29scy5BbGJ1bVBvc3RQcm9jZXNzLmJpbmQoRyk7XHJcblxyXG4gICAgICBHLklbMF0uY29udGVudElzTG9hZGVkID0gdHJ1ZTtcclxuXHJcbiAgICAgIGpRdWVyeS5lYWNoKCRlbGVtZW50cywgZnVuY3Rpb24oaSwgaXRlbSl7XHJcblxyXG4gICAgICAgIC8vIGNyZWF0ZSBkaWN0aW9ubmFyeSB3aXRoIGFsbCBkYXRhIGF0dHJpYnV0ZSBuYW1lIGluIGxvd2VyY2FzZSAodG8gYmUgY2FzZSB1bnNlbnNpdGl2ZSlcclxuICAgICAgICB2YXIgZGF0YSA9IHtcclxuICAgICAgICAgIC8vIHNvbWUgZGVmYXVsdCB2YWx1ZXNcclxuICAgICAgICAgICdkYXRhLW5nZGVzYyc6ICAgICAgICAgICAgICAgICAgJycsICAgICAgICAgLy8gaXRlbSBkZXNjcmlwdGlvblxyXG4gICAgICAgICAgJ2RhdGEtbmdpZCc6ICAgICAgICAgICAgICAgICAgICBudWxsLCAgICAgICAvLyBJRFxyXG4gICAgICAgICAgJ2RhdGEtbmdraW5kJzogICAgICAgICAgICAgICAgICAnaW1hZ2UnLCAgICAvLyBraW5kIChpbWFnZSwgYWxidW0sIGFsYnVtdXApXHJcbiAgICAgICAgICAnZGF0YS1uZ3RhZ3MnOiAgICAgICAgICAgICAgICAgIG51bGwsICAgICAgIC8vIHRhZ3NcclxuICAgICAgICAgICdkYXRhLW5nZGVzdCc6ICAgICAgICAgICAgICAgICAgJycsICAgICAgICAgLy8gZGVzdGluYXRpb24gVVJMXHJcbiAgICAgICAgICAnZGF0YS1uZ3RodW1iaW1nd2lkdGgnOiAgICAgICAgIDAsICAgICAgICAgIC8vIHRodW1ibmFpbCB3aWR0aFxyXG4gICAgICAgICAgJ2RhdGEtbmd0aHVtYmltZ2hlaWdodCc6ICAgICAgICAwLCAgICAgICAgICAvLyB0aHVtYm5haWwgaGVpZ2h0XHJcbiAgICAgICAgICAnZGF0YS1uZ2ltYWdld2lkdGgnOiAgICAgICAgICAgIDAsICAgICAgICAgIC8vIGltYWdlIHdpZHRoXHJcbiAgICAgICAgICAnZGF0YS1uZ2ltYWdlaGVpZ2h0JzogICAgICAgICAgIDAsICAgICAgICAgIC8vIGltYWdlIGhlaWdodFxyXG4gICAgICAgICAgJ2RhdGEtbmdpbWFnZWRvbWluYW50Y29sb3JzJzogICBudWxsLCAgICAgICAvLyBpbWFnZSBkb21pbmFudCBjb2xvcnNcclxuICAgICAgICAgICdkYXRhLW5naW1hZ2Vkb21pbmFudGNvbG9yJzogICAgbnVsbCwgICAgICAgLy8gaW1hZ2UgZG9taW5hbnQgY29sb3JzXHJcbiAgICAgICAgICAnZGF0YS1uZ2V4aWZtb2RlbCc6ICAgICAgICAgICAgICcnLCAgICAgICAgIC8vIEVYSUYgZGF0YVxyXG4gICAgICAgICAgJ2RhdGEtbmdleGlmZmxhc2gnOiAgICAgICAgICAgICAnJyxcclxuICAgICAgICAgICdkYXRhLW5nZXhpZmZvY2FsbGVuZ3RoJzogICAgICAgJycsXHJcbiAgICAgICAgICAnZGF0YS1uZ2V4aWZmc3RvcCc6ICAgICAgICAgICAgICcnLFxyXG4gICAgICAgICAgJ2RhdGEtbmdleGlmZXhwb3N1cmUnOiAgICAgICAgICAnJyxcclxuICAgICAgICAgICdkYXRhLW5nZXhpZmlzbyc6ICAgICAgICAgICAgICAgJycsXHJcbiAgICAgICAgICAnZGF0YS1uZ2V4aWZ0aW1lJzogICAgICAgICAgICAgICcnLFxyXG4gICAgICAgICAgJ2RhdGEtbmdleGlmbG9jYXRpb24nOiAgICAgICAgICAnJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgW10uZm9yRWFjaC5jYWxsKCBpdGVtLmF0dHJpYnV0ZXMsIGZ1bmN0aW9uKGF0dHIpIHtcclxuICAgICAgICAgIGRhdGFbYXR0ci5uYW1lLnRvTG93ZXJDYXNlKCldID0gYXR0ci52YWx1ZTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gcmVzcG9uc2l2ZSBpbWFnZSBzb3VyY2VcclxuICAgICAgICB2YXIgc3JjID0gJycsXHJcbiAgICAgICAgc3QgPSBSZXRyaWV2ZUN1cldpZHRoKCkudG9VcHBlckNhc2UoKTtcclxuICAgICAgICBpZiggZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZGF0YS1uZ3NyYycrc3QpICkge1xyXG4gICAgICAgICAgc3JjID0gZGF0YVsnZGF0YS1uZ3NyYycrc3RdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiggc3JjID09ICcnICkge1xyXG4gICAgICAgICAgc3JjID0gZGF0YVsnaHJlZiddO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiggIVN0YXJ0c1dpdGhQcm90b2NvbChzcmMpICkge1xyXG4gICAgICAgICAgc3JjID0gRy5PLml0ZW1zQmFzZVVSTCArIHNyYztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHRodW1ibmFpbFxyXG4gICAgICAgIHZhciB0aHVtYnNyYyA9ICcnO1xyXG4gICAgICAgIGlmKCBkYXRhLmhhc093blByb3BlcnR5KCdkYXRhLW5ndGh1bWInKSApIHtcclxuICAgICAgICAgIHRodW1ic3JjID0gZGF0YVsnZGF0YS1uZ3RodW1iJ107XHJcbiAgICAgICAgICBpZiggIVN0YXJ0c1dpdGhQcm90b2NvbCh0aHVtYnNyYykgKSB7XHJcbiAgICAgICAgICAgIHRodW1ic3JjID0gRy5PLml0ZW1zQmFzZVVSTCArIHRodW1ic3JjO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHRodW1ic3JjID0gc3JjO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgdGh1bWJzcmNYMiA9ICcnO1xyXG4gICAgICAgIGlmKCBkYXRhLmhhc093blByb3BlcnR5KCdkYXRhLW5ndGh1bWIyeCcpICkge1xyXG4gICAgICAgICAgdGh1bWJzcmNYMiA9IGRhdGFbJ2RhdGEtbmd0aHVtYjJ4J107XHJcbiAgICAgICAgICBpZiggIVN0YXJ0c1dpdGhQcm90b2NvbCh0aHVtYnNyY1gyKSApIHtcclxuICAgICAgICAgICAgdGh1bWJzcmNYMiA9IEcuTy5pdGVtc0Jhc2VVUkwgKyB0aHVtYnNyY1gyO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvL25ld09iai5kZXNjcmlwdGlvbj1qUXVlcnkoaXRlbSkuYXR0cignZGF0YS1uZ2Rlc2MnKTtcclxuICAgICAgICB2YXIgZGVzY3JpcHRpb24gPSBkYXRhWydkYXRhLW5nZGVzYyddO1xyXG4gICAgICAgIHZhciBJRCA9IGRhdGFbJ2lkJ107XHJcbiAgICAgICAgaWYoIElEID09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICAgIElEID0gZGF0YVsnZGF0YS1uZ2lkJ107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBraW5kID0gZGF0YVsnZGF0YS1uZ2tpbmQnXTtcclxuICAgICAgICB2YXIgdGFncyA9IGRhdGFbJ2RhdGEtbmd0YWdzJ107XHJcblxyXG4gICAgICAgIHZhciBhbGJ1bUlEID0gJzAnO1xyXG4gICAgICAgIGlmKCBkYXRhLmhhc093blByb3BlcnR5KCdkYXRhLW5nYWxidW1pZCcpICkge1xyXG4gICAgICAgICAgYWxidW1JRCA9IGRhdGFbJ2RhdGEtbmdhbGJ1bWlkJ107XHJcbiAgICAgICAgICBmb3VuZEFsYnVtSUQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB2YXIgdGl0bGUgPSBqUXVlcnkoaXRlbSkudGV4dCgpO1xyXG4gICAgICAgIGlmKCAhKEcuTy50aHVtYm5haWxMYWJlbC5nZXQoJ3RpdGxlJykgPT0gJycgfHwgRy5PLnRodW1ibmFpbExhYmVsLmdldCgndGl0bGUnKSA9PSB1bmRlZmluZWQpICkge1xyXG4gICAgICAgICAgdGl0bGUgPSBHZXRJbWFnZVRpdGxlKHNyYyk7XHJcbiAgICAgICAgfVxyXG5cclxuXHJcbiAgICAgICAgdmFyIG5ld0l0ZW0gPSBOR1kySXRlbS5OZXcoIEcsIHRpdGxlLCBkZXNjcmlwdGlvbiwgSUQsIGFsYnVtSUQsIGtpbmQsIHRhZ3MgKTtcclxuICAgICAgICBpZiggdGl0bGUgIT0gJycgKSB7XHJcbiAgICAgICAgICBuYlRpdGxlcysrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gbWVkaWEgc291cmNlIHVybCAtIGltZyBpcyB0aGUgZGVmYXVsdCBtZWRpYSBraW5kXHJcbiAgICAgICAgbmV3SXRlbS5zZXRNZWRpYVVSTCggc3JjLCAnaW1nJyk7XHJcblxyXG4gICAgICAgIC8vIG1hbmFnZSBtZWRpYSBraW5kcyBvdGhlciB0aGFuIElNR1xyXG4gICAgICAgIG5ld0l0ZW0ubWVkaWFLaW5kID0gJ2ltZyc7XHJcbiAgICAgICAgalF1ZXJ5LmVhY2gobWVkaWFMaXN0LCBmdW5jdGlvbiAoIG4sIG1lZGlhICkge1xyXG4gICAgICAgICAgdmFyIGlkID0gbWVkaWEuZ2V0SUQoc3JjKTtcclxuICAgICAgICAgIGlmKCBpZCAhPSBudWxsICkge1xyXG4gICAgICAgICAgICBpZiggdHlwZW9mIG1lZGlhLnVybCA9PSAnZnVuY3Rpb24nICkgeyBzcmMgPSBtZWRpYS51cmwoaWQpOyAgfVxyXG4gICAgICAgICAgICBpZiggdHlwZW9mIG1lZGlhLnRodW1iVXJsID09ICdmdW5jdGlvbicgKSB7IHRodW1ic3JjID0gbWVkaWEudGh1bWJVcmwoaWQpOyAgfVxyXG4gICAgICAgICAgICBuZXdJdGVtLm1lZGlhS2luZCA9IG1lZGlhLmtpbmQ7XHJcbiAgICAgICAgICAgIG5ld0l0ZW0ubWVkaWFNYXJrdXAgPSAoIG1lZGlhLnNlbGZob3N0ZWQgKSA/IG1lZGlhLm1hcmt1cCggc3JjICkgOiBtZWRpYS5tYXJrdXAoaWQpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gaW1hZ2Ugc2l6ZVxyXG4gICAgICAgIG5ld0l0ZW0uaW1hZ2VXaWR0aCA9IHBhcnNlSW50KCBkYXRhWydkYXRhLW5naW1hZ2V3aWR0aCddICk7XHJcbiAgICAgICAgbmV3SXRlbS5pbWFnZUhlaWdodCA9IHBhcnNlSW50KCBkYXRhWydkYXRhLW5naW1hZ2VoZWlnaHQnXSApO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIGRlZmF1bHQgdGh1bWJuYWlsIGltYWdlIFVSTCBhbmQgc2l6ZVxyXG4gICAgICAgIHZhciB0dyA9IHBhcnNlSW50KGRhdGFbJ2RhdGEtbmd0aHVtYmltZ3dpZHRoJ10pO1xyXG4gICAgICAgIHZhciB0aCA9IHBhcnNlSW50KGRhdGFbJ2RhdGEtbmd0aHVtYmltZ2hlaWdodCddKTtcclxuICAgICAgICBuZXdJdGVtLnRodW1icyA9IHtcclxuICAgICAgICAgIHVybDogICAgeyBsMSA6IHsgeHM6IHRodW1ic3JjLCBzbTogdGh1bWJzcmMsIG1lOiB0aHVtYnNyYywgbGE6IHRodW1ic3JjLCB4bDogdGh1bWJzcmMgfSwgbE4gOiB7IHhzOiB0aHVtYnNyYywgc206IHRodW1ic3JjLCBtZTogdGh1bWJzcmMsIGxhOiB0aHVtYnNyYywgeGw6IHRodW1ic3JjIH0gfSxcclxuICAgICAgICAgIHdpZHRoOiAgeyBsMSA6IHsgeHM6IHR3LCBzbTogdHcsIG1lOiB0dywgbGE6IHR3LCB4bDogdHcgfSwgbE4gOiB7IHhzOiB0dywgc206IHR3LCBtZTogdHcsIGxhOiB0dywgeGw6IHR3IH0gfSxcclxuICAgICAgICAgIGhlaWdodDogeyBsMSA6IHsgeHM6IHRoLCBzbTogdGgsIG1lOiB0aCwgbGE6IHRoLCB4bDogdGggfSwgbE4gOiB7IHhzOiB0aCwgc206IHRoLCBtZTogdGgsIGxhOiB0aCwgeGw6IHRoIH0gfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8vIGRlZmF1bHQgbWVkaWEgdHlwZSAtPiBJTUdcclxuICAgICAgICBpZiggbmV3SXRlbS5tZWRpYUtpbmQgPT0gJ2ltZycgKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICAvLyByZXNwb25zaXZlIHRodW1ibmFpbHMgVVJMIGFuZCBzaXplXHJcbiAgICAgICAgICB2YXIgbHN0ID0gWyd4cycsICdzbScsICdtZScsICdsYScsICd4bCddO1xyXG4gICAgICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsc3QubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICAgIC8vIHVybFxyXG4gICAgICAgICAgICBpZiggZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZGF0YS1uZ3RodW1iJyArIGxzdFtpXSkgKSB7XHJcbiAgICAgICAgICAgICAgdmFyIHR1cmw9ZGF0YVsnZGF0YS1uZ3RodW1iJyArIGxzdFtpXV07XHJcbiAgICAgICAgICAgICAgaWYoICFTdGFydHNXaXRoUHJvdG9jb2wodHVybCkgKSB7XHJcbiAgICAgICAgICAgICAgICB0dXJsID0gRy5PLml0ZW1zQmFzZVVSTCArIHR1cmw7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIG5ld0l0ZW0udXJsLmwxW2xzdFtpXV0gPSB0dXJsO1xyXG4gICAgICAgICAgICAgIG5ld0l0ZW0udXJsLmxOW2xzdFtpXV0gPSB0dXJsO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyB3aWR0aFxyXG4gICAgICAgICAgICBpZiggZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZGF0YS1uZ3RodW1iJyArIGxzdFtpXSArICd3aWR0aCcpICkge1xyXG4gICAgICAgICAgICAgIHZhciB0dz1wYXJzZUludChkYXRhWydkYXRhLW5ndGh1bWInICsgbHN0W2ldICsgJ3dpZHRoJ10pO1xyXG4gICAgICAgICAgICAgIG5ld0l0ZW0ud2lkdGgubDFbbHN0W2ldXSA9IHR3O1xyXG4gICAgICAgICAgICAgIG5ld0l0ZW0ud2lkdGgubE5bbHN0W2ldXSA9IHR3O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGhlaWdodFxyXG4gICAgICAgICAgICBpZiggZGF0YS5oYXNPd25Qcm9wZXJ0eSgnZGF0YS1uZ3RodW1iJyArIGxzdFtpXSArICdoZWlnaHQnKSApIHtcclxuICAgICAgICAgICAgICB2YXIgdGg9cGFyc2VJbnQoJ2RhdGEtbmd0aHVtYicgKyBsc3RbaV0gKyAnaGVpZ2h0Jyk7XHJcbiAgICAgICAgICAgICAgbmV3SXRlbS5oZWlnaHQubDFbbHN0W2ldXSA9IHRoO1xyXG4gICAgICAgICAgICAgIG5ld0l0ZW0uaGVpZ2h0LmxOW2xzdFtpXV0gPSB0aDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICAvLyBkb21pbmFudCBjb2xvclMgKG5lZWRzIHRvIGJlIGEgYmFzZTY0IGdpZilcclxuICAgICAgICBuZXdJdGVtLmltYWdlRG9taW5hbnRDb2xvcnMgPSBkYXRhWydkYXRhLW5naW1hZ2Vkb21pbmFudGNvbG9ycyddO1xyXG4gICAgICAgIC8vIGRvbWluYW50IGNvbG9yIChyZ2IgaGV4KVxyXG4gICAgICAgIG5ld0l0ZW0uaW1hZ2VEb21pbmFudENvbG9yID0gZGF0YVsnZGF0YS1uZ2ltYWdlZG9taW5hbnRjb2xvcnMnXTtcclxuXHJcbiAgICAgICAgbmV3SXRlbS5kZXN0aW5hdGlvblVSTCA9IGRhdGFbJ2RhdGEtbmdkZXN0J107XHJcbiAgICAgICAgbmV3SXRlbS5kb3dubG9hZFVSTCA9IGRhdGFbJ2RhdGEtbmdkb3dubG9hZHVybCddO1xyXG5cclxuICAgICAgICAvLyBFeGlmIC0gbW9kZWxcclxuICAgICAgICBuZXdJdGVtLmV4aWYubW9kZWw9ZGF0YVsnZGF0YS1uZ2V4aWZtb2RlbCddO1xyXG4gICAgICAgIC8vIEV4aWYgLSBmbGFzaFxyXG4gICAgICAgIG5ld0l0ZW0uZXhpZi5mbGFzaD1kYXRhWydkYXRhLW5nZXhpZmZsYXNoJ107XHJcbiAgICAgICAgLy8gRXhpZiAtIGZvY2FsbGVuZ3RoXHJcbiAgICAgICAgbmV3SXRlbS5leGlmLmZvY2FsbGVuZ3RoPWRhdGFbJ2RhdGEtbmdleGlmZm9jYWxsZW5ndGgnXTtcclxuICAgICAgICAvLyBFeGlmIC0gZnN0b3BcclxuICAgICAgICBuZXdJdGVtLmV4aWYuZnN0b3A9ZGF0YVsnZGF0YS1uZ2V4aWZmc3RvcCddO1xyXG4gICAgICAgIC8vIEV4aWYgLSBleHBvc3VyZVxyXG4gICAgICAgIG5ld0l0ZW0uZXhpZi5leHBvc3VyZT1kYXRhWydkYXRhLW5nZXhpZmV4cG9zdXJlJ107XHJcbiAgICAgICAgLy8gRXhpZiAtIGlzb1xyXG4gICAgICAgIG5ld0l0ZW0uZXhpZi5pc289ZGF0YVsnZGF0YS1uZ2V4aWZpc28nXTtcclxuICAgICAgICAvLyBFeGlmIC0gdGltZVxyXG4gICAgICAgIG5ld0l0ZW0uZXhpZi50aW1lPWRhdGFbJ2RhdGEtbmdleGlmdGltZSddO1xyXG4gICAgICAgIC8vIEV4aWYgLSBsb2NhdGlvblxyXG4gICAgICAgIG5ld0l0ZW0uZXhpZi5sb2NhdGlvbj1kYXRhWydkYXRhLW5nZXhpZmxvY2F0aW9uJ107XHJcbiAgICAgICAgXHJcbiAgICAgICAgbmV3SXRlbS5jb250ZW50SXNMb2FkZWQ9dHJ1ZTtcclxuXHJcbiAgICAgICAgLy8gY3VzdG9tIGRhdGFcclxuICAgICAgICBpZiggalF1ZXJ5KGl0ZW0pLmRhdGEoJ2N1c3RvbWRhdGEnKSAhPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgbmV3SXRlbS5jdXN0b21EYXRhPWNsb25lSlNPYmplY3QoalF1ZXJ5KGl0ZW0pLmRhdGEoJ2N1c3RvbWRhdGEnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIGN1c3RvbSBkYXRhXHJcbiAgICAgICAgaWYoIGpRdWVyeShpdGVtKS5kYXRhKCduZ2N1c3RvbWRhdGEnKSAhPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgbmV3SXRlbS5jdXN0b21EYXRhPWNsb25lSlNPYmplY3QoalF1ZXJ5KGl0ZW0pLmRhdGEoJ25nY3VzdG9tZGF0YScpKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBmdT1HLk8uZm5Qcm9jZXNzRGF0YTtcclxuICAgICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICB0eXBlb2YgZnUgPT0gJ2Z1bmN0aW9uJyA/IGZ1KG5ld0l0ZW0sICdtYXJrdXAnLCBpdGVtKSA6IHdpbmRvd1tmdV0obmV3SXRlbSwgJ21hcmt1cCcsIGl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBBbGJ1bVBvc3RQcm9jZXNzKGFsYnVtSUQpO1xyXG5cclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBpZiggZm91bmRBbGJ1bUlEICkgeyBHLk8uZGlzcGxheUJyZWFkY3J1bWI9dHJ1ZTsgfVxyXG4gICAgICBpZiggbmJUaXRsZXMgPT0gMCApIHsgRy5PLnRodW1ibmFpbExhYmVsLmRpc3BsYXkgPSBmYWxzZTsgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIC8vICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbiAgICAvLyAjIyMjIyBERUZJTkUgVkFSSUFCTEVTICAgICAjIyMjI1xyXG4gICAgLy8gIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbiAgICBcclxuICAgIC8qKiBAZnVuY3Rpb24gRGVmaW5lVmFyaWFibGVzICovXHJcbiAgICBmdW5jdGlvbiBEZWZpbmVWYXJpYWJsZXMoKSB7XHJcbiAgICBcclxuICAgICAgLy8gY2hhbmdlICdwaWNhc2EnIHRvICdnb29nbGUnIGZvciBjb21wYXRpYmlsaXR5IHJlYXNvblxyXG4gICAgICBpZiggRy5PLmtpbmQudG9VcHBlckNhc2UoKSA9PSAnUElDQVNBJyAgfHwgRy5PLmtpbmQudG9VcHBlckNhc2UoKSA9PSAnR09PR0xFJykge1xyXG4gICAgICAgIEcuTy5raW5kPSdnb29nbGUyJztcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIC8vIG1hbmFnZW1lbnQgb2Ygc2NyZWVuIHdpZHRoXHJcbiAgICAgIEcuR09NLmNhY2hlLnZpZXdwb3J0ID0gZ2V0Vmlld3BvcnQoKTtcclxuICAgICAgRy5HT00uY3VyV2lkdGggPSBSZXRyaWV2ZUN1cldpZHRoKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyB0dW1ibmFpbCB0b29sYmFyXHJcbiAgICAgIGpRdWVyeS5leHRlbmQodHJ1ZSwgRy50bi50b29sYmFyLmltYWdlLCBHLk8udGh1bWJuYWlsVG9vbGJhckltYWdlICk7XHJcbiAgICAgIGpRdWVyeS5leHRlbmQodHJ1ZSwgRy50bi50b29sYmFyLmFsYnVtLCBHLk8udGh1bWJuYWlsVG9vbGJhckFsYnVtICk7XHJcbiAgICAgIHZhciB0ID0gWydpbWFnZScsICdhbGJ1bSddO1xyXG4gICAgICB2YXIgcG9zPSBbJ3RvcExlZnQnLCAndG9wUmlnaHQnLCAnYm90dG9tTGVmdCcsICdib3R0b21SaWdodCddXHJcbiAgICAgIGZvciggdmFyIGk9MDsgaSA8IHQubGVuZ3RoIDsgaSsrICkge1xyXG4gICAgICAgIGZvciggdmFyIGo9MDsgaiA8IHBvcy5sZW5ndGggOyBqKysgKSB7XHJcbiAgICAgICAgICBHLnRuLnRvb2xiYXJbdFtpXV1bcG9zW2pdXSA9IEcudG4udG9vbGJhclt0W2ldXVtwb3Nbal1dLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyB0aHVtYm5haWxzIGxhYmVsIC0gbGV2ZWwgZGVwZW5kYW50IHNldHRpbmdzXHJcbiAgICAgIEcuTy50aHVtYm5haWxMYWJlbC5nZXQgPSBmdW5jdGlvbiggb3B0ICkge1xyXG4gICAgICAgIGlmKCBHLkdPTS5jdXJOYXZMZXZlbCA9PSAnbDEnICYmIEcuTy50aHVtYm5haWxMMUxhYmVsICE9PSB1bmRlZmluZWQgJiYgRy5PLnRodW1ibmFpbEwxTGFiZWxbb3B0XSAhPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgcmV0dXJuIEcuTy50aHVtYm5haWxMMUxhYmVsW29wdF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgcmV0dXJuIEcuTy50aHVtYm5haWxMYWJlbFtvcHRdO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuICAgICAgRy5PLnRodW1ibmFpbExhYmVsLnNldCA9IGZ1bmN0aW9uKCBvcHQsIHZhbHVlICkge1xyXG4gICAgICAgIGlmKCBHLkdPTS5jdXJOYXZMZXZlbCA9PSAnbDEnICYmIEcuTy50aHVtYm5haWxMMUxhYmVsICE9PSB1bmRlZmluZWQgJiYgRy5PLnRodW1ibmFpbEwxTGFiZWxbb3B0XSAhPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgRy5PLnRodW1ibmFpbEwxTGFiZWxbb3B0XT12YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBHLk8udGh1bWJuYWlsTGFiZWxbb3B0XT12YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZiggRy5PLmJsYWNrTGlzdCAhPSAnJyApIHsgRy5ibGFja0xpc3Q9Ry5PLmJsYWNrTGlzdC50b1VwcGVyQ2FzZSgpLnNwbGl0KCd8Jyk7IH1cclxuICAgICAgaWYoIEcuTy53aGl0ZUxpc3QgIT0gJycgKSB7IEcud2hpdGVMaXN0PUcuTy53aGl0ZUxpc3QudG9VcHBlckNhc2UoKS5zcGxpdCgnfCcpOyB9XHJcblxyXG4gICAgICBpZiggRy5PLmFsYnVtTGlzdDIgIT09IHVuZGVmaW5lZCAmJiBHLk8uYWxidW1MaXN0MiAhPT0gbnVsbCAmJiBHLk8uYWxidW1MaXN0Mi5jb25zdHJ1Y3RvciA9PT0gQXJyYXkgICkge1xyXG4gICAgICAgIHZhciBsPUcuTy5hbGJ1bUxpc3QyLmxlbmd0aDtcclxuICAgICAgICBmb3IodmFyIGk9MDsgaTwgbDsgaSsrICkge1xyXG4gICAgICAgICAgRy5hbGJ1bUxpc3QucHVzaChHLk8uYWxidW1MaXN0MltpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEcuYWxidW1MaXN0PUcuTy5hbGJ1bUxpc3QudG9VcHBlckNhc2UoKS5zcGxpdCgnfCcpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmKCBHLk8uYWxidW1MaXN0MiAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBHLk8uYWxidW1MaXN0MiA9PSAnc3RyaW5nJyAgICkge1xyXG4gICAgICAgIEcuYWxidW1MaXN0LnB1c2goRy5PLmFsYnVtTGlzdDIpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBcclxuICAgICAgLy8gdGh1bWJuYWlsIGltYWdlIGNyb3BcclxuICAgICAgRy50bi5vcHQubE4uY3JvcCA9IEcuTy50aHVtYm5haWxDcm9wO1xyXG4gICAgICBHLnRuLm9wdC5sMS5jcm9wID0gRy5PLnRodW1ibmFpbEwxQ3JvcCAhPSBudWxsID8gRy5PLnRodW1ibmFpbEwxQ3JvcCA6IEcuTy50aHVtYm5haWxDcm9wO1xyXG5cclxuXHJcbiAgICAgIGZ1bmN0aW9uIFRodW1ibmFpbE9wdCggbE4sIGwxLCBvcHQpIHtcclxuICAgICAgICBHLnRuLm9wdC5sTltvcHRdPUcuT1tsTl07XHJcbiAgICAgICAgRy50bi5vcHQubDFbb3B0XT1HLk9bbE5dO1xyXG4gICAgICAgIGlmKCB0b1R5cGUoRy5PW2wxXSkgPT0gJ251bWJlcicgKSB7XHJcbiAgICAgICAgICBHLnRuLm9wdC5sMVtvcHRdPUcuT1tsMV07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vIHRodW1ibmFpbCBzdGFja3NcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxTdGFja3MnLCAndGh1bWJuYWlsTDFTdGFja3MnLCAnc3RhY2tzJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBzdGFja3MgdHJhbnNsYXRlIFhcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxTdGFja3NUcmFuc2xhdGVYJywgJ3RodW1ibmFpbEwxU3RhY2tzVHJhbnNsYXRlWCcsICdzdGFja3NUcmFuc2xhdGVYJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBzdGFja3MgdHJhbnNsYXRlIFlcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxTdGFja3NUcmFuc2xhdGVZJywgJ3RodW1ibmFpbEwxU3RhY2tzVHJhbnNsYXRlWScsICdzdGFja3NUcmFuc2xhdGVZJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBzdGFja3MgdHJhbnNsYXRlIFpcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxTdGFja3NUcmFuc2xhdGVaJywgJ3RodW1ibmFpbEwxU3RhY2tzVHJhbnNsYXRlWicsICdzdGFja3NUcmFuc2xhdGVaJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBzdGFja3Mgcm90YXRlIFhcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxTdGFja3NSb3RhdGVYJywgJ3RodW1ibmFpbEwxU3RhY2tzUm90YXRlWCcsICdzdGFja3NSb3RhdGVYJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBzdGFja3Mgcm90YXRlIFlcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxTdGFja3NSb3RhdGVZJywgJ3RodW1ibmFpbEwxU3RhY2tzUm90YXRlWScsICdzdGFja3NSb3RhdGVZJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBzdGFja3Mgcm90YXRlIFpcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxTdGFja3NSb3RhdGVaJywgJ3RodW1ibmFpbEwxU3RhY2tzUm90YXRlWicsICdzdGFja3NSb3RhdGVaJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBzdGFja3Mgc2NhbGVcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxTdGFja3NTY2FsZScsICd0aHVtYm5haWxMMVN0YWNrc1NjYWxlJywgJ3N0YWNrc1NjYWxlJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBndXR0ZXIgd2lkdGhcclxuICAgICAgVGh1bWJuYWlsT3B0KCd0aHVtYm5haWxHdXR0ZXJXaWR0aCcsICd0aHVtYm5haWxMMUd1dHRlcldpZHRoJywgJ2d1dHRlcldpZHRoJyk7XHJcbiAgICAgIC8vIHRodW1ibmFpbCBndXR0ZXIgaGVpZ2h0XHJcbiAgICAgIFRodW1ibmFpbE9wdCgndGh1bWJuYWlsR3V0dGVySGVpZ2h0JywgJ3RodW1ibmFpbEwxR3V0dGVySGVpZ2h0JywgJ2d1dHRlckhlaWdodCcpO1xyXG4gICAgICAvLyB0aHVtYm5haWwgZ3JpZCBiYXNlIGhlaWdodCAoZm9yIGNhc2NhZGluZyBsYXlvdXQpXHJcbiAgICAgIFRodW1ibmFpbE9wdCgndGh1bWJuYWlsQmFzZUdyaWRIZWlnaHQnLCAndGh1bWJuYWlsTDFCYXNlR3JpZEhlaWdodCcsICdiYXNlR3JpZEhlaWdodCcpO1xyXG4gICAgICBcclxuICAgICAgLy8gZ2FsbGVyeSBkaXNwbGF5IG1vZGVcclxuICAgICAgRy5nYWxsZXJ5RGlzcGxheU1vZGUubE4gPSBHLk8uZ2FsbGVyeURpc3BsYXlNb2RlLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIEcuZ2FsbGVyeURpc3BsYXlNb2RlLmwxID0gRy5PLmdhbGxlcnlMMURpc3BsYXlNb2RlICE9IG51bGwgPyBHLk8uZ2FsbGVyeUwxRGlzcGxheU1vZGUudG9VcHBlckNhc2UoKSA6IEcuTy5nYWxsZXJ5RGlzcGxheU1vZGUudG9VcHBlckNhc2UoKTtcclxuICAgICAgXHJcbiAgICAgIC8vIGdhbGxlcnkgbWF4aW11bSBudW1iZXIgb2YgbGluZXMgb2YgdGh1bWJuYWlsc1xyXG4gICAgICBHLmdhbGxlcnlNYXhSb3dzLmxOID0gRy5PLmdhbGxlcnlNYXhSb3dzO1xyXG4gICAgICBHLmdhbGxlcnlNYXhSb3dzLmwxID0gdG9UeXBlKEcuTy5nYWxsZXJ5TDFNYXhSb3dzKSA9PSAnbnVtYmVyJyA/IEcuTy5nYWxsZXJ5TDFNYXhSb3dzIDogRy5PLmdhbGxlcnlNYXhSb3dzO1xyXG5cclxuICAgICAgLy8gZ2FsbGVyeSBsYXN0IHJvdyBmdWxsXHJcbiAgICAgIEcuZ2FsbGVyeUxhc3RSb3dGdWxsLmxOID0gRy5PLmdhbGxlcnlMYXN0Um93RnVsbDtcclxuICAgICAgRy5nYWxsZXJ5TGFzdFJvd0Z1bGwubDEgPSBHLk8uZ2FsbGVyeUwxTGFzdFJvd0Z1bGwgIT0gbnVsbCA/IEcuTy5nYWxsZXJ5TDFMYXN0Um93RnVsbCA6IEcuTy5nYWxsZXJ5TGFzdFJvd0Z1bGw7XHJcbiAgICAgIFxyXG4gICAgICAvLyBnYWxsZXJ5IHNvcnRpbmdcclxuICAgICAgRy5nYWxsZXJ5U29ydGluZy5sTiA9IEcuTy5nYWxsZXJ5U29ydGluZy50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICBHLmdhbGxlcnlTb3J0aW5nLmwxID0gRy5PLmdhbGxlcnlMMVNvcnRpbmcgIT0gbnVsbCA/IEcuTy5nYWxsZXJ5TDFTb3J0aW5nLnRvVXBwZXJDYXNlKCkgOiBHLmdhbGxlcnlTb3J0aW5nLmxOO1xyXG4gICAgICBcclxuICAgICAgLy8gZ2FsbGVyeSBkaXNwbGF5IHRyYW5zaXRpb25cclxuICAgICAgRy5nYWxsZXJ5RGlzcGxheVRyYW5zaXRpb24ubE4gPSBHLk8uZ2FsbGVyeURpc3BsYXlUcmFuc2l0aW9uLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgIEcuZ2FsbGVyeURpc3BsYXlUcmFuc2l0aW9uLmwxID0gRy5PLmdhbGxlcnlMMURpc3BsYXlUcmFuc2l0aW9uICE9IG51bGwgPyBHLk8uZ2FsbGVyeUwxRGlzcGxheVRyYW5zaXRpb24udG9VcHBlckNhc2UoKSA6IEcuZ2FsbGVyeURpc3BsYXlUcmFuc2l0aW9uLmxOO1xyXG5cclxuICAgICAgLy8gZ2FsbGVyeSBkaXNwbGF5IHRyYW5zaXRpb24gZHVyYXRpb25cclxuICAgICAgRy5nYWxsZXJ5RGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbi5sTiA9IEcuTy5nYWxsZXJ5RGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbjtcclxuICAgICAgRy5nYWxsZXJ5RGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbi5sMSA9IEcuTy5nYWxsZXJ5TDFEaXNwbGF5VHJhbnNpdGlvbkR1cmF0aW9uICE9IG51bGwgPyBHLk8uZ2FsbGVyeUwxRGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbiA6IEcuZ2FsbGVyeURpc3BsYXlUcmFuc2l0aW9uRHVyYXRpb24ubE47XHJcbiAgICAgIFxyXG4gICAgICAvLyBnYWxsZXJ5IG1heCBpdGVtcyBwZXIgYWxidW0gKG5vdCBmb3IgaW5saW5lL2FwaSBkZWZpbmVkIGl0ZW1zKVxyXG4gICAgICBHLmdhbGxlcnlNYXhJdGVtcy5sTiA9IEcuTy5nYWxsZXJ5TWF4SXRlbXM7XHJcbiAgICAgIEcuZ2FsbGVyeU1heEl0ZW1zLmwxID0gdG9UeXBlKEcuTy5nYWxsZXJ5TDFNYXhJdGVtcykgPT0gJ251bWJlcicgPyBHLk8uZ2FsbGVyeUwxTWF4SXRlbXMgOiBHLk8uZ2FsbGVyeU1heEl0ZW1zO1xyXG5cclxuICAgICAgLy8gZ2FsbGVyeSBmaWx0ZXIgdGFnc1xyXG4gICAgICBHLmdhbGxlcnlGaWx0ZXJUYWdzLmxOID0gRy5PLmdhbGxlcnlGaWx0ZXJUYWdzO1xyXG4gICAgICBHLmdhbGxlcnlGaWx0ZXJUYWdzLmwxID0gRy5PLmdhbGxlcnlMMUZpbHRlclRhZ3MgIT0gbnVsbCA/IEcuTy5nYWxsZXJ5TDFGaWx0ZXJUYWdzIDogRy5PLmdhbGxlcnlGaWx0ZXJUYWdzO1xyXG4gICAgICBcclxuICAgICAgLy8gZ2FsbGVyeSBwYWdpbmF0aW9uXHJcbiAgICAgIEcuTy5nYWxsZXJ5UGFnaW5hdGlvbk1vZGUgPSBHLk8uZ2FsbGVyeVBhZ2luYXRpb25Nb2RlLnRvVXBwZXJDYXNlKCk7XHJcblxyXG4gICAgICBpZiggdG9UeXBlKEcuTy5zbGlkZXNob3dEZWxheSkgPT0gJ251bWJlcicgJiYgRy5PLnNsaWRlc2hvd0RlbGF5ID49IDIwMDAgKSB7XHJcbiAgICAgICAgRy5WT00uc2xpZGVzaG93RGVsYXkgPSBHLk8uc2xpZGVzaG93RGVsYXk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgTmFub0NvbnNvbGVMb2coRywgJ1BhcmFtZXRlciBcInNsaWRlc2hvd0RlbGF5XCIgbXVzdCBiZSBhbiBpbnRlZ2VyID49IDIwMDAgbXMuJyk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGdhbGxlcnkgZGlzcGxheSB0cmFuc2l0aW9uXHJcbiAgICAgIGlmKCB0eXBlb2YgRy5PLnRodW1ibmFpbERpc3BsYXlUcmFuc2l0aW9uID09ICdib29sZWFuJyApIHtcclxuICAgICAgICBpZiggRy5PLnRodW1ibmFpbERpc3BsYXlUcmFuc2l0aW9uID09PSB0cnVlICkge1xyXG4gICAgICAgICAgRy50bi5vcHQubE4uZGlzcGxheVRyYW5zaXRpb24gPSAnRkFERUlOJztcclxuICAgICAgICAgIEcudG4ub3B0LmwxLmRpc3BsYXlUcmFuc2l0aW9uID0gJ0ZBREVJTic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgRy50bi5vcHQubE4uZGlzcGxheVRyYW5zaXRpb24gPSAnTk9ORSc7XHJcbiAgICAgICAgICBHLnRuLm9wdC5sMS5kaXNwbGF5VHJhbnNpdGlvbiA9ICdOT05FJztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmKCBHLk8uZm5UaHVtYm5haWxEaXNwbGF5RWZmZWN0ICE9PSAnJyApIHtcbiAgICAgICAgRy50bi5vcHQubE4uZGlzcGxheVRyYW5zaXRpb24gPSAnQ1VTVE9NJztcbiAgICAgICAgRy50bi5vcHQubDEuZGlzcGxheVRyYW5zaXRpb24gPSAnQ1VTVE9NJztcbiAgICAgIH1cbiAgICAgIGlmKCBHLk8uZm5UaHVtYm5haWxMMURpc3BsYXlFZmZlY3QgIT09ICcnICkge1xuICAgICAgICBHLnRuLm9wdC5sMS5kaXNwbGF5VHJhbnNpdGlvbiA9ICdDVVNUT00nO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBwYXJzZSB0aHVtYm5haWwgZGlzcGxheSB0cmFuc2l0aW9uXHJcbiAgICAgIGZ1bmN0aW9uIHRodW1ibmFpbERpc3BsYXlUcmFuc2l0aW9uUGFyc2UoIGNmZywgbGV2ZWwgKSB7XHJcbiAgICAgICAgaWYoIHR5cGVvZiBjZmcgPT0gJ3N0cmluZycgKSB7XHJcbiAgICAgICAgICB2YXIgc3Q9Y2ZnLnNwbGl0KCdfJyk7XHJcbiAgICAgICAgICBpZiggc3QubGVuZ3RoID09IDEgKSB7XHJcbiAgICAgICAgICAgIEcudG4ub3B0W2xldmVsXVsnZGlzcGxheVRyYW5zaXRpb24nXSA9IGNmZy50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYoIHN0Lmxlbmd0aCA9PSAyICkge1xyXG4gICAgICAgICAgICBHLnRuLm9wdFtsZXZlbF1bJ2Rpc3BsYXlUcmFuc2l0aW9uJ10gPSBzdFswXS50b1VwcGVyQ2FzZSgpO1xyXG4gICAgICAgICAgICBHLnRuLm9wdFtsZXZlbF1bJ2Rpc3BsYXlUcmFuc2l0aW9uU3RhcnRWYWwnXSA9IE51bWJlcihzdFsxXSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiggc3QubGVuZ3RoID09IDMgKSB7XHJcbiAgICAgICAgICAgIEcudG4ub3B0W2xldmVsXVsnZGlzcGxheVRyYW5zaXRpb24nXSA9IHN0WzBdLnRvVXBwZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIEcudG4ub3B0W2xldmVsXVsnZGlzcGxheVRyYW5zaXRpb25TdGFydFZhbCddID0gTnVtYmVyKHN0WzFdKTtcclxuICAgICAgICAgICAgRy50bi5vcHRbbGV2ZWxdWydkaXNwbGF5VHJhbnNpdGlvbkVhc2luZyddID0gc3RbMl07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHRodW1ibmFpbERpc3BsYXlUcmFuc2l0aW9uUGFyc2UoIEcuTy50aHVtYm5haWxEaXNwbGF5VHJhbnNpdGlvbiwgJ2xOJyk7XHJcbiAgICAgIHRodW1ibmFpbERpc3BsYXlUcmFuc2l0aW9uUGFyc2UoIEcuTy50aHVtYm5haWxEaXNwbGF5VHJhbnNpdGlvbiwgJ2wxJyk7XHJcbiAgICAgIHRodW1ibmFpbERpc3BsYXlUcmFuc2l0aW9uUGFyc2UoIEcuTy50aHVtYm5haWxMMURpc3BsYXlUcmFuc2l0aW9uLCAnbDEnKTtcclxuXHJcbiAgICAgIFxyXG4gICAgICAvLyB0aHVtYm5haWwgZGlzcGxheSB0cmFuc2l0aW9uIGR1cmF0aW9uXHJcbiAgICAgIFRodW1ibmFpbE9wdCgndGh1bWJuYWlsRGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbicsICd0aHVtYm5haWxMMURpc3BsYXlUcmFuc2l0aW9uRHVyYXRpb24nLCAnZGlzcGxheVRyYW5zaXRpb25EdXJhdGlvbicpO1xyXG4gICAgICAvLyB0aHVtYm5haWwgZGlzcGxheSB0cmFuc2l0aW9uIGludGVydmFsIGR1cmF0aW9uXHJcbiAgICAgIFRodW1ibmFpbE9wdCgndGh1bWJuYWlsRGlzcGxheUludGVydmFsJywgJ3RodW1ibmFpbEwxRGlzcGxheUludGVydmFsJywgJ2Rpc3BsYXlJbnRlcnZhbCcpO1xyXG5cclxuICAgICAgXHJcbiAgICAgIC8vIHJlc29sdXRpb24gYnJlYWtwb2ludHMgLS0+IGNvbnZlcnQgb2xkIHN5bnRheCB0byBuZXcgb25lXHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsU2l6ZVNNICE9PSB1bmRlZmluZWQgKSB7IEcuTy5icmVha3BvaW50U2l6ZVNNID0gRy5PLnRodW1ibmFpbFNpemVTTTsgfVxyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbFNpemVNRSAhPT0gdW5kZWZpbmVkICkgeyBHLk8uYnJlYWtwb2ludFNpemVNRSA9IEcuTy50aHVtYm5haWxTaXplTUU7IH1cclxuICAgICAgaWYoIEcuTy50aHVtYm5haWxTaXplTEEgIT09IHVuZGVmaW5lZCApIHsgRy5PLmJyZWFrcG9pbnRTaXplTEEgPSBHLk8udGh1bWJuYWlsU2l6ZUxBOyB9XHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsU2l6ZVhMICE9PSB1bmRlZmluZWQgKSB7IEcuTy5icmVha3BvaW50U2l6ZVhMID0gRy5PLnRodW1ibmFpbFNpemVYTDsgfVxyXG5cclxuICAgICAgLy8gVEhVTUJOQUlMIEJVSUxEIElOSVRcclxuICAgICAgLy9sZXZlbCAxXHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsTDFCdWlsZEluaXQyICE9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgIHZhciB0MSA9IEcuTy50aHVtYm5haWxMMUJ1aWxkSW5pdDIuc3BsaXQoJ3wnKTtcclxuICAgICAgICBmb3IoIHZhciBpID0gMDsgaSA8IHQxLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgdmFyIG8xID0gdDFbaV0udHJpbSgpLnNwbGl0KCdfJyk7XHJcbiAgICAgICAgICBpZiggbzEubGVuZ3RoID09IDMgKSB7XHJcbiAgICAgICAgICAgIHZhciBpMSA9IE5ld1RCdWlsZEluaXQoKTtcclxuICAgICAgICAgICAgaTEuZWxlbWVudCA9IFRodW1ibmFpbE92ZXJFZmZlY3RzR2V0Q1NTRWxlbWVudChvMVswXSwgJycpO1xyXG4gICAgICAgICAgICBpMS5wcm9wZXJ0eSA9IG8xWzFdO1xyXG4gICAgICAgICAgICBpMS52YWx1ZSA9IG8xWzJdO1xyXG4gICAgICAgICAgICBHLnRuLmJ1aWxkSW5pdC5sZXZlbDEucHVzaChpMSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIC8vbGV2ZWwgTlxyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbEJ1aWxkSW5pdDIgIT09IHVuZGVmaW5lZCApIHtcclxuICAgICAgICB2YXIgdDEgPSBHLk8udGh1bWJuYWlsQnVpbGRJbml0Mi5zcGxpdCgnfCcpO1xyXG4gICAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgdDEubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICB2YXIgbzEgPSB0MVtpXS50cmltKCkuc3BsaXQoJ18nKTtcclxuICAgICAgICAgIGlmKCBvMS5sZW5ndGggPT0gMyApIHtcclxuICAgICAgICAgICAgdmFyIGkxID0gTmV3VEJ1aWxkSW5pdCgpO1xyXG4gICAgICAgICAgICBpMS5lbGVtZW50ID0gVGh1bWJuYWlsT3ZlckVmZmVjdHNHZXRDU1NFbGVtZW50KG8xWzBdLCAnJyk7XHJcbiAgICAgICAgICAgIGkxLnByb3BlcnR5ID0gbzFbMV07XHJcbiAgICAgICAgICAgIGkxLnZhbHVlID0gbzFbMl07XHJcbiAgICAgICAgICAgIEcudG4uYnVpbGRJbml0LnN0ZC5wdXNoKGkxKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIFxyXG4gICAgICAvLyBUSFVNQk5BSUwgSE9WRVIgRUZGRVRDU1xyXG4gICAgICBcclxuICAgICAgLy8gdGh1bWJuYWlscyBob3ZlciBlZmZlY3RzIC0gTGV2ZWwxXHJcbiAgICAgIHZhciB0TDFIRSA9IEcuTy50aHVtYm5haWxMMUhvdmVyRWZmZWN0MjtcclxuICAgICAgaWYoIHRMMUhFICE9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgc3dpdGNoKCB0b1R5cGUodEwxSEUpICkge1xyXG4gICAgICAgICAgY2FzZSAnc3RyaW5nJzpcclxuICAgICAgICAgICAgdmFyIHRtcCA9IHRMMUhFLnNwbGl0KCd8Jyk7XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0bXAubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICB2YXIgb0RlZiA9IE5ld1RIb3ZlckVmZmVjdCgpO1xyXG4gICAgICAgICAgICAgIG9EZWYgPSBUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoIHRtcFtpXS50cmltKCksIG9EZWYgKTtcclxuICAgICAgICAgICAgICBpZiggIG9EZWYgIT0gbnVsbCApIHtcclxuICAgICAgICAgICAgICAgIEcudG4uaG92ZXJFZmZlY3RzLmxldmVsMS5wdXNoKG9EZWYpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ29iamVjdCc6XHJcbiAgICAgICAgICAgIHZhciBvRGVmID0gTmV3VEhvdmVyRWZmZWN0KCk7XHJcbiAgICAgICAgICAgIG9EZWYgPSBqUXVlcnkuZXh0ZW5kKG9EZWYsdEwxSEUpO1xyXG4gICAgICAgICAgICBvRGVmID0gVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCBvRGVmLm5hbWUsIG9EZWYgKTtcclxuICAgICAgICAgICAgaWYoICBvRGVmICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgRy50bi5ob3ZlckVmZmVjdHMubGV2ZWwxLnB1c2gob0RlZik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdhcnJheSc6XHJcbiAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCB0TDFIRS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgIHZhciBvRGVmID0gTmV3VEhvdmVyRWZmZWN0KCk7XHJcbiAgICAgICAgICAgICAgb0RlZiA9IGpRdWVyeS5leHRlbmQob0RlZix0TDFIRVtpXSk7XHJcbiAgICAgICAgICAgICAgb0RlZiA9IFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCggb0RlZi5uYW1lLCBvRGVmICk7XHJcbiAgICAgICAgICAgICAgaWYoICBvRGVmICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgICBHLnRuLmhvdmVyRWZmZWN0cy5sZXZlbDEucHVzaChvRGVmKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdudWxsJzpcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBOYW5vQWxlcnQoRywgJ2luY29ycmVjdCBwYXJhbWV0ZXIgZm9yIFwidGh1bWJuYWlsTDFIb3ZlckVmZmVjdDJcIi4nKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgRy50bi5ob3ZlckVmZmVjdHMubGV2ZWwxID0gVGh1bWJuYWlsT3ZlckVmZmVjdHNQcmVzZXQoRy50bi5ob3ZlckVmZmVjdHMubGV2ZWwxKTtcclxuICBcclxuICAgICAgLy8gdGh1bWJuYWlscyBob3ZlciBlZmZlY3RzIC0gb3RoZXIgbGV2ZWxzXHJcbiAgICAgIHZhciB0SEUgPSBHLk8udGh1bWJuYWlsSG92ZXJFZmZlY3QyO1xyXG4gICAgICBzd2l0Y2goIHRvVHlwZSh0SEUpICkge1xyXG4gICAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgICAgICB2YXIgdG1wID0gdEhFLnNwbGl0KCd8Jyk7XHJcbiAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdG1wLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBvRGVmID0gTmV3VEhvdmVyRWZmZWN0KCk7XHJcbiAgICAgICAgICAgIG9EZWYgPSBUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoIHRtcFtpXS50cmltKCksIG9EZWYgKTtcclxuICAgICAgICAgICAgaWYoICBvRGVmICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgRy50bi5ob3ZlckVmZmVjdHMuc3RkLnB1c2gob0RlZik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ29iamVjdCc6XHJcbiAgICAgICAgICB2YXIgb0RlZiA9IE5ld1RIb3ZlckVmZmVjdCgpO1xyXG4gICAgICAgICAgb0RlZiA9IGpRdWVyeS5leHRlbmQob0RlZiwgdEhFKTtcclxuICAgICAgICAgIG9EZWYgPSBUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoIG9EZWYubmFtZSwgb0RlZiApO1xyXG4gICAgICAgICAgaWYoICBvRGVmICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgIEcudG4uaG92ZXJFZmZlY3RzLnN0ZC5wdXNoKG9EZWYpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnYXJyYXknOlxyXG4gICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHRIRS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgb0RlZiA9IE5ld1RIb3ZlckVmZmVjdCgpO1xyXG4gICAgICAgICAgICBvRGVmID0galF1ZXJ5LmV4dGVuZChvRGVmLHRIRVtpXSk7XHJcbiAgICAgICAgICAgIG9EZWYgPSBUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoIG9EZWYubmFtZSwgb0RlZiApO1xyXG4gICAgICAgICAgICBpZiggIG9EZWYhPSBudWxsICkge1xyXG4gICAgICAgICAgICAgIEcudG4uaG92ZXJFZmZlY3RzLnN0ZC5wdXNoKG9EZWYpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdudWxsJzpcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBOYW5vQWxlcnQoRywgJ2luY29ycmVjdCBwYXJhbWV0ZXIgZm9yIFwidGh1bWJuYWlsSG92ZXJFZmZlY3QyXCIuJyk7XHJcbiAgICAgIH1cclxuICAgICAgRy50bi5ob3ZlckVmZmVjdHMuc3RkID0gVGh1bWJuYWlsT3ZlckVmZmVjdHNQcmVzZXQoRy50bi5ob3ZlckVmZmVjdHMuc3RkKTtcclxuXHJcbiAgICAgIFxyXG4gICAgICBpZiggRy5PLnRvdWNoQW5pbWF0aW9uTDEgPT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgIEcuTy50b3VjaEFuaW1hdGlvbkwxID0gRy5PLnRvdWNoQW5pbWF0aW9uO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBkaXNhYmxlIHRodW1ibmFpbCB0b3VjaCBhbmltYXRpb24gd2hlbiBubyBob3ZlciBlZmZlY3QgZGVmaW5lZFxyXG4gICAgICBpZiggRy50bi5ob3ZlckVmZmVjdHMuc3RkLmxlbmd0aCA9PSAwICkge1xyXG4gICAgICAgIGlmKCBHLnRuLmhvdmVyRWZmZWN0cy5sZXZlbDEubGVuZ3RoID09IDAgKSB7XHJcbiAgICAgICAgICBHLk8udG91Y2hBbmltYXRpb25MMSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBHLk8udG91Y2hBbmltYXRpb24gPSBmYWxzZTtcclxuICAgICAgfSAgICAgIFxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICAgIC8vIHRodW1ibmFpbCBzaXplc1xyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbEhlaWdodCA9PSAwIHx8IEcuTy50aHVtYm5haWxIZWlnaHQgPT0gJycgICkgeyBHLk8udGh1bWJuYWlsSGVpZ2h0ID0gJ2F1dG8nOyB9XHJcbiAgICAgIGlmKCBHLk8udGh1bWJuYWlsV2lkdGggPT0gMCB8fCBHLk8udGh1bWJuYWlsV2lkdGggPT0gJycgKSB7IEcuTy50aHVtYm5haWxXaWR0aCA9ICdhdXRvJzsgfVxyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbEwxSGVpZ2h0ID09IDAgfHwgRy5PLnRodW1ibmFpbEwxSGVpZ2h0ID09ICcnICkgeyBHLk8udGh1bWJuYWlsTDFIZWlnaHQgPSAnYXV0byc7IH1cclxuICAgICAgaWYoIEcuTy50aHVtYm5haWxMMVdpZHRoID09IDAgfHwgRy5PLnRodW1ibmFpbEwxV2lkdGggPT0gJycgKSB7IEcuTy50aHVtYm5haWxMMVdpZHRoID0gJ2F1dG8nOyB9XHJcblxyXG4gICAgICAvLyBSRVRSSUVWRSBBTEwgVEhVTUJOQUlMIFNJWkVTXHJcbiAgICAgIGZ1bmN0aW9uIFRodW1ibmFpbFNpemVzKCBzcmNPcHQsIG9ubHlsMSwgb3B0KSB7XHJcbiAgICAgICAgaWYoIEcuT1tzcmNPcHRdID09IG51bGwgKSB7IHJldHVybjsgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKCB0b1R5cGUoRy5PW3NyY09wdF0pID09ICdudW1iZXInICkge1xyXG4gICAgICAgICAgVGh1bWJuYWlsc1NldFNpemUoIG9wdCwgJ2wxJywgRy5PW3NyY09wdF0sICd1Jyk7XHJcbiAgICAgICAgICBpZiggIW9ubHlsMSApIHtcclxuICAgICAgICAgICAgVGh1bWJuYWlsc1NldFNpemUoIG9wdCwgJ2xOJywgRy5PW3NyY09wdF0sICd1Jyk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdmFyIHdzPUcuT1tzcmNPcHRdLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICB2YXIgdiA9ICdhdXRvJztcclxuICAgICAgICAgIGlmKCB3c1swXS5zdWJzdHJpbmcoMCw0KSAhPSAnYXV0bycgKSB7IHY9cGFyc2VJbnQod3NbMF0pOyB9XHJcbiAgICAgICAgICB2YXIgYyA9ICd1JztcclxuICAgICAgICAgIGlmKCB3c1swXS5jaGFyQXQod3NbMF0ubGVuZ3RoIC0gMSkgPT0gJ0MnICkgeyBjPSdjJzsgfVxyXG4gICAgICAgICAgVGh1bWJuYWlsc1NldFNpemUoIG9wdCwgJ2wxJywgdiwgYyApOyAgIC8vIGRlZmF1bHQgdmFsdWUgZm9yIGFsbCByZXNvbHV0aW9ucyBhbmQgbmF2aWdhdGlvbiBsZXZlbHNcclxuICAgICAgICAgIGlmKCAhb25seWwxICkge1xyXG4gICAgICAgICAgICBUaHVtYm5haWxzU2V0U2l6ZSggb3B0LCAnbE4nLCB2LCBjICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBmb3IoIHZhciBpID0gMTsgaSA8IHdzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgICAgICB2YXIgciA9IHdzW2ldLnN1YnN0cmluZygwLDIpLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgICAgIGlmKCAveHN8c218bWV8bGF8eGwvaS50ZXN0KHIpICkge1xyXG4gICAgICAgICAgICAgIHZhciB3ID0gd3NbaV0uc3Vic3RyaW5nKDIpO1xyXG4gICAgICAgICAgICAgIHZhciB2ID0gJ2F1dG8nO1xyXG4gICAgICAgICAgICAgIGlmKCB3LnN1YnN0cmluZygwLDQpICE9ICdhdXRvJyApIHsgdiA9IHBhcnNlSW50KHcpOyB9XHJcbiAgICAgICAgICAgICAgdmFyIGMgPSAndSc7XHJcbiAgICAgICAgICAgICAgaWYoIHcuY2hhckF0KHcubGVuZ3RoIC0gMSkgPT0gJ0MnICkgeyBjID0gJ2MnOyB9XHJcbiAgICAgICAgICAgICAgRy50bi5zZXR0aW5nc1tvcHRdWydsMSddW3JdID0gdjtcclxuICAgICAgICAgICAgICBHLnRuLnNldHRpbmdzW29wdF1bJ2wxJ11bciArICdjJ10gPSBjO1xyXG4gICAgICAgICAgICAgIGlmKCAhb25seWwxICkge1xyXG4gICAgICAgICAgICAgICAgRy50bi5zZXR0aW5nc1tvcHRdWydsTiddW3JdID0gdjtcclxuICAgICAgICAgICAgICAgIEcudG4uc2V0dGluZ3Nbb3B0XVsnbE4nXVtyICsgJ2MnXSA9IGM7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFRodW1ibmFpbFNpemVzKCAndGh1bWJuYWlsV2lkdGgnLCBmYWxzZSwgJ3dpZHRoJyk7XHJcbiAgICAgIFRodW1ibmFpbFNpemVzKCAndGh1bWJuYWlsTDFXaWR0aCcsIHRydWUsICd3aWR0aCcpO1xyXG4gICAgICBcclxuICAgICAgVGh1bWJuYWlsU2l6ZXMoICd0aHVtYm5haWxIZWlnaHQnLCBmYWxzZSwgJ2hlaWdodCcpO1xyXG4gICAgICBUaHVtYm5haWxTaXplcyggJ3RodW1ibmFpbEwxSGVpZ2h0JywgdHJ1ZSwgJ2hlaWdodCcpO1xyXG5cclxuICAgICAgXHJcbiAgICAgIEcuTy50aHVtYm5haWxCb3JkZXJIb3Jpem9udGFsID0gcGFyc2VJbnQoRy5PLnRodW1ibmFpbEJvcmRlckhvcml6b250YWwpO1xyXG4gICAgICBHLk8udGh1bWJuYWlsQm9yZGVyVmVydGljYWwgPSBwYXJzZUludChHLk8udGh1bWJuYWlsQm9yZGVyVmVydGljYWwpO1xyXG4gICAgICBHLk8udGh1bWJuYWlsTGFiZWxIZWlnaHQgPSBwYXJzZUludChHLk8udGh1bWJuYWlsTGFiZWxIZWlnaHQpO1xyXG5cclxuICAgICAgXHJcbiAgICAgIC8vIHJldHJpZXZlIGFsbCBtb3NhaWMgbGF5b3V0IHBhdHRlcm5zXHJcbiAgICAgIC8vIGRlZmF1bHQgcGF0dGVyblxyXG4gICAgICBpZiggRy5PLmdhbGxlcnlNb3NhaWMgIT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgIC8vIGNsb25lIG9iamVjdFxyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmwxLnhzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmwxLnNtID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmwxLm1lID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmwxLmxhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmwxLnhsID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmxOLnhzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmxOLnNtID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmxOLm1lID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmxOLmxhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmxOLnhsID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljQ2FsY0ZhY3RvcignbDEnLCAneHMnKTtcclxuICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpY0NhbGNGYWN0b3IoJ2wxJywgJ3NtJyk7XHJcbiAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWNDYWxjRmFjdG9yKCdsMScsICdtZScpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljQ2FsY0ZhY3RvcignbDEnLCAnbGEnKTtcclxuICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpY0NhbGNGYWN0b3IoJ2wxJywgJ3hsJyk7XHJcbiAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWNDYWxjRmFjdG9yKCdsTicsICd4cycpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljQ2FsY0ZhY3RvcignbE4nLCAnc20nKTtcclxuICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpY0NhbGNGYWN0b3IoJ2xOJywgJ21lJyk7XHJcbiAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWNDYWxjRmFjdG9yKCdsTicsICdsYScpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljQ2FsY0ZhY3RvcignbE4nLCAneGwnKTtcclxuICAgICAgfVxyXG4gICAgICBpZiggRy5PLmdhbGxlcnlMMU1vc2FpYyAhPSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgLy8gZGVmYXVsdCBMMSBwYXR0ZXJuXHJcbiAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWMubDEueHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KEcuTy5nYWxsZXJ5TDFNb3NhaWMpKTtcclxuICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpYy5sMS5zbSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoRy5PLmdhbGxlcnlMMU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmwxLm1lID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShHLk8uZ2FsbGVyeUwxTW9zYWljKSk7XHJcbiAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWMubDEubGEgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KEcuTy5nYWxsZXJ5TDFNb3NhaWMpKTtcclxuICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpYy5sMS54bCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoRy5PLmdhbGxlcnlMMU1vc2FpYykpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljQ2FsY0ZhY3RvcignbDEnLCAneHMnKTtcclxuICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpY0NhbGNGYWN0b3IoJ2wxJywgJ3NtJyk7XHJcbiAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWNDYWxjRmFjdG9yKCdsMScsICdtZScpO1xyXG4gICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljQ2FsY0ZhY3RvcignbDEnLCAnbGEnKTtcclxuICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpY0NhbGNGYWN0b3IoJ2wxJywgJ3hsJyk7XHJcbiAgICAgIH1cclxuICAgICAgZm9yKCB2YXIgdyA9IDA7IHcgPCBHLnRuLnNldHRpbmdzLm1vc2FpYy5sMTsgdysrICkge1xyXG4gICAgICAgIGlmKCBHLk9bJ2dhbGxlcnlNb3NhaWMnICsgRy50bi5zZXR0aW5ncy5tb3NhaWMubDFbd10udG9VcHBlckNhc2UoKV0gIT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWMubE5bdG4uc2V0dGluZ3MubW9zYWljLmwxW3ddXSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoIEcuT1snZ2FsbGVyeU1vc2FpYycgKyBHLnRuLnNldHRpbmdzLm1vc2FpYy5sMVt3XS50b1VwcGVyQ2FzZSgpXSApKTtcclxuICAgICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljLmwxW3RuLnNldHRpbmdzLm1vc2FpYy5sMVt3XV0gPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KCBHLk9bJ2dhbGxlcnlNb3NhaWMnICsgRy50bi5zZXR0aW5ncy5tb3NhaWMubDFbd10udG9VcHBlckNhc2UoKV0gKSk7XHJcbiAgICAgICAgICBHLnRuLnNldHRpbmdzLm1vc2FpY0NhbGNGYWN0b3IoJ2wxJywgRy50bi5zZXR0aW5ncy5tb3NhaWMubDFbd10pO1xyXG4gICAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWNDYWxjRmFjdG9yKCdsTicsIEcudG4uc2V0dGluZ3MubW9zYWljLmwxW3ddKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZm9yKCB2YXIgdyA9IDA7IHcgPCBHLnRuLnNldHRpbmdzLm1vc2FpYy5sMTsgdysrICkge1xyXG4gICAgICAgIGlmKCBHLk9bJ2dhbGxlcnlMMU1vc2FpYycrRy50bi5zZXR0aW5ncy5tb3NhaWMubDFbd10udG9VcHBlckNhc2UoKV0gIT0gdW5kZWZpbmVkICkge1xyXG4gICAgICAgICAgRy50bi5zZXR0aW5ncy5tb3NhaWMubDFbdG4uc2V0dGluZ3MubW9zYWljLmwxW3ddXSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoIEcuT1snZ2FsbGVyeUwxTW9zYWljJytHLnRuLnNldHRpbmdzLm1vc2FpYy5sMVt3XS50b1VwcGVyQ2FzZSgpXSApKTtcclxuICAgICAgICAgIEcudG4uc2V0dGluZ3MubW9zYWljQ2FsY0ZhY3RvcignbDEnLCBHLnRuLnNldHRpbmdzLm1vc2FpYy5sMVt3XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBHLk8uaW1hZ2VUcmFuc2l0aW9uID0gRy5PLmltYWdlVHJhbnNpdGlvbi50b1VwcGVyQ2FzZSgpO1xyXG5cclxuICAgICAgRy5sYXlvdXQuU2V0RW5naW5lKCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBpbml0IHBsdWdpbnNcclxuICAgICAgc3dpdGNoKCBHLk8ua2luZCApIHtcclxuICAgICAgICAvLyBNQVJLVVAgLyBBUElcclxuICAgICAgICBjYXNlICcnOlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgLy8gSlNPTiwgRmxpY2tyLCBQaWNhc2EsIC4uLlxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgalF1ZXJ5Lm5hbm9nYWxsZXJ5MlsnZGF0YV8nICsgRy5PLmtpbmRdKEcsICdJbml0JyApO1xyXG4gICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIC8vIEhPVkVSIEVGRkVDVFNcclxuICAgIGZ1bmN0aW9uIFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCggbmFtZSwgZWZmZWN0KSB7XHJcbiAgICAgIHZhciBlYXNpbmdzID0gWyAnZWFzZUluUXVhZCcsICdlYXNlT3V0UXVhZCcsICdlYXNlSW5PdXRRdWFkJywgJ2Vhc2VJbkN1YmljJywgJ2Vhc2VPdXRDdWJpYycsICdlYXNlSW5PdXRDdWJpYycsICdlYXNlSW5RdWFydCcsICdlYXNlT3V0UXVhcnQnLCAnZWFzZUluT3V0UXVhcnQnLCAnZWFzZUluUXVpbnQnLCAnZWFzZU91dFF1aW50JywgJ2Vhc2VJbk91dFF1aW50JywgJ2Vhc2VJblNpbmUnLCAnZWFzZU91dFNpbmUnLCAnZWFzZUluT3V0U2luZScsICdlYXNlSW5FeHBvJywgJ2Vhc2VPdXRFeHBvJywgJ2Vhc2VJbk91dEV4cG8nLCAnZWFzZUluQ2lyYycsICdlYXNlT3V0Q2lyYycsICdlYXNlSW5PdXRDaXJjJywgJ2Vhc2VPdXRCb3VuY2UnLCAnZWFzZUluQmFjaycsICdlYXNlT3V0QmFjaycsICdlYXNlSW5PdXRCYWNrJywgJ2VsYXN0aWMnLCAnYm91bmNlJ107XHJcbiAgICBcclxuICAgICAgdmFyIHNwID0gbmFtZS5zcGxpdCgnXycpO1xyXG4gICAgICBpZiggc3AubGVuZ3RoID49IDQgKSB7XHJcbiAgICAgICAgLy8gdmFyIG9EZWY9TmV3VEhvdmVyRWZmZWN0KCk7XHJcbiAgICAgICAgZWZmZWN0Lm5hbWUgPSAnJztcclxuICAgICAgICBlZmZlY3QudHlwZSA9IHNwWzFdO1xyXG4gICAgICAgIGVmZmVjdC5mcm9tID0gc3BbMl07XHJcbiAgICAgICAgZWZmZWN0LnRvID0gc3BbM107XHJcbiAgICAgICAgaWYoIHNwLmxlbmd0aCA+PSA1ICkge1xyXG4gICAgICAgICAgLy8gZWZmZWN0LmR1cmF0aW9uPXNwWzRdO1xyXG5cclxuICAgICAgICAgIGZvciggdmFyIG4gPSA0OyBuIDwgc3AubGVuZ3RoOyBuKysgKSB7XHJcbiAgICAgICAgICAgIHZhciB2ID0gc3Bbbl07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBjaGVjayBpZiBhbiBlYXNpbmcgbmFtZVxyXG4gICAgICAgICAgICB2YXIgZm91bmRFYXNpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yKCB2YXIgZSA9IDA7IGUgPCBlYXNpbmdzLmxlbmd0aDsgZSsrKSB7XHJcbiAgICAgICAgICAgICAgaWYoIHYgPT0gZWFzaW5nc1tlXSApIHtcclxuICAgICAgICAgICAgICAgIGZvdW5kRWFzaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGVmZmVjdC5lYXNpbmcgPSB2O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCBmb3VuZEVhc2luZyA9PT0gdHJ1ZSApIHtcclxuICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdiA9IHYudG9VcHBlckNhc2UoKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCB2ID09ICdIT1ZFUklOJyApIHtcclxuICAgICAgICAgICAgICBlZmZlY3QuaG92ZXJvdXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiggdiA9PSAnSE9WRVJPVVQnICkge1xyXG4gICAgICAgICAgICAgIGVmZmVjdC5ob3ZlcmluID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCB2ID09ICdLRVlGUkFNRScgKSB7XHJcbiAgICAgICAgICAgICAgZWZmZWN0LmZpcnN0S2V5ZnJhbWUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIG51bSA9IHBhcnNlSW50KHYucmVwbGFjZSgvW14wLTlcXC5dL2csICcnKSwgMTApOyAgIC8vIGV4dHJhY3QgYSBudW1iZXIgaWYgb25lIGV4aXN0c1xyXG5cclxuICAgICAgICAgICAgaWYoIG51bSA+IDAgKSB7XHJcbiAgICAgICAgICAgICAgLy8gdGhlIHN0cmluZyBjb250YWlucyBhIG51bWJlcnMgPiAwXHJcbiAgICAgICAgICAgICAgaWYoIHYuaW5kZXhPZignRFVSQVRJT04nKSA+PSAwICkge1xyXG4gICAgICAgICAgICAgICAgZWZmZWN0LmR1cmF0aW9uID0gbnVtO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGlmKCB2LmluZGV4T2YoJ0RVUkFUSU9OQkFDSycpID49IDAgKSB7XHJcbiAgICAgICAgICAgICAgICBlZmZlY3QuZHVyYXRpb25CYWNrID0gbnVtO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGlmKCB2LmluZGV4T2YoJ0RFTEFZJykgPj0gMCApIHtcclxuICAgICAgICAgICAgICAgIGVmZmVjdC5kZWxheSA9IG51bTtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiggdi5pbmRleE9mKCdERUxBWUJBQ0snKSA+PSAwICkge1xyXG4gICAgICAgICAgICAgICAgZWZmZWN0LmRlbGF5QmFjayA9IG51bTtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAvLyBubyBwYXJhbWV0ZXIgbmFtZSBmb3VuZCAtPiBkZWZhdWx0IGlzIGR1cmF0aW9uXHJcbiAgICAgICAgICAgICAgZWZmZWN0LmR1cmF0aW9uID0gbnVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICAgICAgXHJcbiAgICAgICAgZWZmZWN0LmVsZW1lbnQ9VGh1bWJuYWlsT3ZlckVmZmVjdHNHZXRDU1NFbGVtZW50KHNwWzBdLCBlZmZlY3QudHlwZSk7XHJcbiAgICAgICAgXHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgZWZmZWN0Lm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIC8vIE5hbm9BbGVydChHLCAnaW5jb3JyZWN0IHBhcmFtZXRlciBmb3IgXCJ0aHVtYm5haWxIb3ZlckVmZmVjdFwiOiAnICsgbmFtZSk7XHJcbiAgICAgICAgLy8gcmV0dXJuIG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGVmZmVjdDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBUaHVtYm5haWxPdmVyRWZmZWN0c0dldENTU0VsZW1lbnQoIGVsZW1lbnQsIHByb3BlcnR5ICkge1xyXG4gICAgICAgIHZhciByID0gZWxlbWVudDtcclxuICAgICAgICBcclxuICAgICAgICBzd2l0Y2ggKCBlbGVtZW50ICkge1xyXG4gICAgICAgICAgY2FzZSAnaW1hZ2UnOlxyXG4gICAgICAgICAgICBpZiggcHJvcGVydHkgPT0gJ2JsdXInIHx8IHByb3BlcnR5ID09ICdicmlnaHRuZXNzJyB8fCBwcm9wZXJ0eSA9PSAnZ3JheXNjYWxlJyB8fCBwcm9wZXJ0eSA9PSAnc2VwaWEnIHx8IHByb3BlcnR5ID09ICdjb250cmFzdCcgfHwgcHJvcGVydHkgPT0gJ29wYWNpdHknfHwgcHJvcGVydHkgPT0gJ3NhdHVyYXRlJyApIHtcclxuICAgICAgICAgICAgICAvLyByPScubkdZMkdUaHVtYm5haWxJbWcnO1xyXG4gICAgICAgICAgICAgIHIgPSAnLm5HWTJHVGh1bWJuYWlsSW1hZ2UnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIHIgPSAnLm5HWTJHVGh1bWJuYWlsSW1hZ2UnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAndGh1bWJuYWlsJzpcclxuICAgICAgICAgICAgciA9ICcubkdZMkdUaHVtYm5haWwnO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ2xhYmVsJzpcclxuICAgICAgICAgICAgciA9ICcubkdZMkdUaHVtYm5haWxMYWJlbCc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAndGl0bGUnOlxyXG4gICAgICAgICAgICByID0gJy5uR1kyR1RodW1ibmFpbFRpdGxlJztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdkZXNjcmlwdGlvbic6XHJcbiAgICAgICAgICAgIHIgPSAnLm5HWTJHVGh1bWJuYWlsRGVzY3JpcHRpb24nO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ3Rvb2xzJzpcclxuICAgICAgICAgICAgciA9ICcubkdZMkdUaHVtYm5haWxJY29ucyc7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnY3VzdG9tbGF5ZXInOlxyXG4gICAgICAgICAgICByID0gJy5uR1kyR1RodW1ibmFpbEN1c3RvbUxheWVyJztcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBjb252ZXJ0IHByZXNldCBob3ZlciBlZmZlY3RzIHRvIG5ldyBvbmVzIChuYW5vZ2FsbGVyeTIpXHJcbiAgICBmdW5jdGlvbiBUaHVtYm5haWxPdmVyRWZmZWN0c1ByZXNldCggZWZmZWN0cyApIHtcclxuXHJcbiAgICAgIC8vIENPTVBBVElCSUxJVFkgV0lUSCBuYW5vR0FMTEVSWVxyXG4gICAgICAvLyBPSzpcclxuICAgICAgLy8gICdib3JkZXJMaWdodGVyJywgJ2JvcmRlckRhcmtlcicsICdzY2FsZTEyMCcsICdsYWJlbEFwcGVhcicsICdsYWJlbEFwcGVhcjc1JywgJ2xhYmVsT3BhY2l0eTUwJywgJ3NjYWxlTGFiZWxPdmVySW1hZ2UnXHJcbiAgICAgIC8vICAnb3ZlclNjYWxlJywgJ292ZXJTY2FsZU91dHNpZGUnLCAnZGVzY3JpcHRpb25BcHBlYXInXHJcbiAgICAgIC8vICAnc2xpZGVVcCcsICdzbGlkZURvd24nLCAnc2xpZGVSaWdodCcsICdzbGlkZUxlZnQnXHJcbiAgICAgIC8vICAnaW1hZ2VTY2FsZTE1MCcsICdpbWFnZVNjYWxlSW44MCcsICdpbWFnZVNjYWxlMTUwT3V0c2lkZScsICdpbWFnZVNsaWRlVXAnLCAnaW1hZ2VTbGlkZURvd24nLCAnaW1hZ2VTbGlkZVJpZ2h0JywgJ2ltYWdlU2xpZGVMZWZ0J1xyXG4gICAgICAvLyAgJ2xhYmVsU2xpZGVVcFRvcCcsICdsYWJlbFNsaWRlVXAnLCAnbGFiZWxTbGlkZURvd24nLCAnZGVzY3JpcHRpb25TbGlkZVVwJ1xyXG4gICAgICAvLyBLTzpcclxuICAgICAgLy8gICdsYWJlbFNwbGl0NCcsICdsYWJlbFNwbGl0VmVydCcsICdsYWJlbEFwcGVhclNwbGl0NCcsICdsYWJlbEFwcGVhclNwbGl0VmVydCcgXHJcbiAgICAgIC8vIFRPRE86XHJcbiAgICAgIC8vICAncm90YXRlQ29ybmVyQkwnLCAncm90YXRlQ29ybmVyQlInLCAnaW1hZ2VTcGxpdDQnLCAnaW1hZ2VTcGxpdFZlcnQnLCAnaW1hZ2VSb3RhdGVDb3JuZXJCTCcsICdpbWFnZVJvdGF0ZUNvcm5lckJSJywgJ2ltYWdlRmxpcEhvcml6b250YWwnLCAnaW1hZ2VGbGlwVmVydGljYWwnXHJcblxyXG4gICAgXHJcbiAgIFxyXG4gICAgICB2YXIgbmV3RWZmZWN0cz1bXTtcclxuICAgICAgZm9yKCB2YXIgaT0wOyBpPCBlZmZlY3RzLmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIHN3aXRjaCggZWZmZWN0c1tpXS5uYW1lLnRvVXBwZXJDYXNlKCkgKSB7XHJcbiAgICAgICAgICBjYXNlICdCT1JERVJMSUdIVEVSJzpcclxuICAgICAgICAgICAgLy8gdmFyIGNvbG9yPW5ndGlueWNvbG9yKEdhbGxlcnlUaGVtZUdldEN1cnJlbnQoKS50aHVtYm5haWwuYm9yZGVyQ29sb3IpO1xyXG4gICAgICAgICAgICAvLyBuYW1lPSd0aHVtYm5haWxfYm9yZGVyQ29sb3JfJytjb2xvci50b1JnYlN0cmluZygpKydfJytjb2xvci5saWdodGVuKDUwKS50b1JnYlN0cmluZygpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgdmFyIHJnYiA9IENvbG9ySGVscGVyVG9SR0IoR2FsbGVyeVRoZW1lR2V0Q3VycmVudCgpLnRodW1ibmFpbC5ib3JkZXJDb2xvcik7XHJcbiAgICAgICAgICAgIG5hbWUgPSAndGh1bWJuYWlsX2JvcmRlckNvbG9yXycrcmdiKydfJytTaGFkZUJsZW5kQ29udmVydCgwLjUsIHJnYiApO1xyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KG5hbWUsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdCT1JERVJEQVJLRVInOlxyXG4gICAgICAgICAgICAvLyB2YXIgY29sb3I9bmd0aW55Y29sb3IoR2FsbGVyeVRoZW1lR2V0Q3VycmVudCgpLnRodW1ibmFpbC5ib3JkZXJDb2xvcik7XHJcbiAgICAgICAgICAgIC8vIG5hbWU9J3RodW1ibmFpbF9ib3JkZXJDb2xvcl8nK2NvbG9yLnRvUmdiU3RyaW5nKCkrJ18nK2NvbG9yLmRhcmtlbig1MCkudG9SZ2JTdHJpbmcoKTtcclxuICAgICAgICAgICAgdmFyIHJnYiA9IENvbG9ySGVscGVyVG9SR0IoR2FsbGVyeVRoZW1lR2V0Q3VycmVudCgpLnRodW1ibmFpbC5ib3JkZXJDb2xvcik7XHJcbiAgICAgICAgICAgIG5hbWUgPSAndGh1bWJuYWlsX2JvcmRlckNvbG9yXycrcmdiKydfJytTaGFkZUJsZW5kQ29udmVydCgtMC41LCByZ2IgKTtcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdChuYW1lLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnU0NBTEUxMjAnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCd0aHVtYm5haWxfc2NhbGVfMS4wMF8xLjIwJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0xBQkVMQVBQRUFSJzpcclxuICAgICAgICAgIGNhc2UgJ0xBQkVMQVBQRUFSNzUnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdsYWJlbF9vcGFjaXR5XzAuMDBfMS4wMCcsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdUT09MU0FQUEVBUic6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ3Rvb2xzX29wYWNpdHlfMF8xJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ1RPT0xTU0xJREVET1dOJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgndG9vbHNfdHJhbnNsYXRlWV8tMTAwJV8wJScsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdUT09MU1NMSURFVVAnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCd0b29sc190cmFuc2xhdGVZXzEwMCVfMCUnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnTEFCRUxPUEFDSVRZNTAnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdsYWJlbF9vcGFjaXR5XzEuMDBfMC41MCcsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdMQUJFTFNMSURFVVBUT1AnOlxyXG4gICAgICAgICAgY2FzZSAnTEFCRUxTTElERVVQJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnbGFiZWxfdHJhbnNsYXRlWV8xMDAlXzAlJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0xBQkVMU0xJREVET1dOJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnbGFiZWxfdHJhbnNsYXRlWV8tMTAwJV8wJScsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdTQ0FMRUxBQkVMT1ZFUklNQUdFJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnbGFiZWxfc2NhbGVfMC4wMF8xLjAwJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICB2YXIgbiA9IGNsb25lSlNPYmplY3QoZWZmZWN0c1tpXSk7XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2ltYWdlX3NjYWxlXzEuMDBfMC4wMCcsIG4pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdPVkVSU0NBTEUnOlxyXG4gICAgICAgICAgY2FzZSAnT1ZFUlNDQUxFT1VUU0lERSc6XHJcbiAgICAgICAgICAgIG5hbWUgPSAnbGFiZWxfc2NhbGVfMF8xMDAnO1xyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdsYWJlbF9zY2FsZV8yLjAwXzEuMDAnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIHZhciBuID0gY2xvbmVKU09iamVjdChlZmZlY3RzW2ldKTtcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnbGFiZWxfb3BhY2l0eV8wLjAwXzEuMDAnLCBuKSk7XHJcbiAgICAgICAgICAgIG4gPSBjbG9uZUpTT2JqZWN0KGVmZmVjdHNbaV0pO1xyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdpbWFnZV9zY2FsZV8xLjAwXzAuMDAnLCBuKSk7XHJcbiAgICAgICAgICAgIG4gPSBjbG9uZUpTT2JqZWN0KGVmZmVjdHNbaV0pO1xyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdpbWFnZV9vcGFjaXR5XzEuMDBfMC4wMCcsIG4pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdERVNDUklQVElPTkFQUEVBUic6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2Rlc2NyaXB0aW9uX29wYWNpdHlfMF8xJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ1NMSURFUklHSFQnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdpbWFnZV90cmFuc2xhdGVYXzAlXzEwMCUnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2xhYmVsX3RyYW5zbGF0ZVhfLTEwMCVfMCUnLCBjbG9uZUpTT2JqZWN0KGVmZmVjdHNbaV0pKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnU0xJREVMRUZUJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnaW1hZ2VfdHJhbnNsYXRlWF8wJV8tMTAwJScsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnbGFiZWxfdHJhbnNsYXRlWF8xMDAlXzAlJywgY2xvbmVKU09iamVjdChlZmZlY3RzW2ldKSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ1NMSURFVVAnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdpbWFnZV90cmFuc2xhdGVZXzAlXy0xMDAlJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdsYWJlbF90cmFuc2xhdGVZXzEwMCVfMCUnLCBjbG9uZUpTT2JqZWN0KGVmZmVjdHNbaV0pKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnU0xJREVET1dOJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnaW1hZ2VfdHJhbnNsYXRlWV8wJV8xMDAlJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdsYWJlbF90cmFuc2xhdGVZXy0xMDAlXzAlJywgY2xvbmVKU09iamVjdChlZmZlY3RzW2ldKSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0lNQUdFU0NBTEUxNTAnOlxyXG4gICAgICAgICAgY2FzZSAnSU1BR0VTQ0FMRTE1ME9VVFNJREUnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdpbWFnZV9zY2FsZV8xLjAwXzEuNTAnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnSU1BR0VTQ0FMRUlOODAnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdpbWFnZV9zY2FsZV8xLjIwXzEuMDAnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnSU1BR0VTTElERVJJR0hUJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnaW1hZ2VfdHJhbnNsYXRlWF8wJV8xMDAlJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0lNQUdFU0xJREVMRUZUJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnaW1hZ2VfdHJhbnNsYXRlWF8wJV8tMTAwJScsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdJTUFHRVNMSURFVVAnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdpbWFnZV90cmFuc2xhdGVZXzAlXy0xMDAlJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0lNQUdFU0xJREVET1dOJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnaW1hZ2VfdHJhbnNsYXRlWV8wJV8xMDAlJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0xBQkVMU0xJREVVUCc6XHJcbiAgICAgICAgICBjYXNlICdMQUJFTFNMSURFVVBUT1AnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdsYWJlbF90cmFuc2xhdGVZXzEwMCVfMCUnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnTEFCRUxTTElERVVQRE9XTic6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2xhYmVsX3RyYW5zbGF0ZVlfMCVfMTAwJScsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdERVNDUklQVElPTlNMSURFVVAnOlxyXG4gICAgICAgICAgICBuZXdFZmZlY3RzLnB1c2goVGh1bWJuYWlsSG92ZXJFZmZlY3RFeHRyYWN0KCdkZXNjcmlwdGlvbl90cmFuc2xhdGVZXzExMCVfMCUnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICAgIGNhc2UgJ0lNQUdFQkxVUk9OJzpcclxuICAgICAgICAgICAgbmV3RWZmZWN0cy5wdXNoKFRodW1ibmFpbEhvdmVyRWZmZWN0RXh0cmFjdCgnaW1hZ2VfYmx1cl8yLjAwcHhfMC4wMHB4JywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0lNQUdFQkxVUk9GRic6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2ltYWdlX2JsdXJfMC4wMHB4XzIuMDBweCcsIGVmZmVjdHNbaV0pKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdJTUFHRUdSQVlPTic6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2ltYWdlX2dyYXlzY2FsZV8wJV8xMDAlJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0lNQUdFR1JBWU9GRic6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2ltYWdlX2dyYXlzY2FsZV8xMDAlXzAlJywgZWZmZWN0c1tpXSkpO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0lNQUdFU0VQSUFPTic6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2ltYWdlX3NlcGlhXzEwMCVfMSUnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnSU1BR0VTRVBJQU9GRic6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChUaHVtYm5haWxIb3ZlckVmZmVjdEV4dHJhY3QoJ2ltYWdlX3NlcGlhXzElXzEwMCUnLCBlZmZlY3RzW2ldKSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIG5ld0VmZmVjdHMucHVzaChlZmZlY3RzW2ldKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gbmV3RWZmZWN0cztcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gVGh1bWJuYWlsIGhvdmVyIGVmZmVjdCBkZWZpbml0aW9uXHJcbiAgICBmdW5jdGlvbiBOZXdUSG92ZXJFZmZlY3QoKSB7XHJcbiAgICAgIHZhciBvRGVmPXsgXHJcbiAgICAgICAgICBuYW1lOiAgICAgICAgICAgJycsXHJcbiAgICAgICAgICBlbGVtZW50OiAgICAgICAgJycsICAgICAgICAgICAgICAgLy8gZWxlbWVudCBjbGFzc1xyXG4gICAgICAgICAgdHlwZTogICAgICAgICAgICcnLCAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgZnJvbTogICAgICAgICAgICcnLCAgICAgICAgICAgICAgIC8vIHN0YXJ0IHZhbHVlXHJcbiAgICAgICAgICB0bzogICAgICAgICAgICAgJycsICAgICAgICAgICAgICAgLy8gZW5kIHZhbHVlXHJcbiAgICAgICAgICBob3ZlcmluOiAgICAgICAgdHJ1ZSxcclxuICAgICAgICAgIGhvdmVyb3V0OiAgICAgICB0cnVlLFxyXG4gICAgICAgICAgZmlyc3RLZXlmcmFtZTogIHRydWUsXHJcbiAgICAgICAgICBkZWxheTogICAgICAgICAgMCxcclxuICAgICAgICAgIGRlbGF5QmFjazogICAgICAwLFxyXG4gICAgICAgICAgZHVyYXRpb246ICAgICAgIDQwMCxcclxuICAgICAgICAgIGR1cmF0aW9uQmFjazogICAzMDAsXHJcbiAgICAgICAgICBlYXNpbmc6ICAgICAgICAgJ2Vhc2VPdXRRdWFydCcsXHJcbiAgICAgICAgICBlYXNpbmdCYWNrOiAgICAgJ2Vhc2VPdXRRdWFydCcsXHJcbiAgICAgICAgICBhbmltUGFyYW06ICAgICAgbnVsbFxyXG4gICAgICAgIH07XHJcbiAgICAgIHJldHVybiBvRGVmO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIE5ld1RCdWlsZEluaXQoKSB7XHJcbiAgICAgIC8vIHRvIHNldCBDU1MgcHJvcGVydGllc1xyXG4gICAgICB2YXIgb0RlZj17IGVsZW1lbnQ6ICcnLCBwcm9wZXJ0eTogJycsIHZhbHVlOiAnJyB9O1xyXG4gICAgICByZXR1cm4gb0RlZjtcclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIFRodW1ibmFpbFN0eWxlKCBjZmcsIGxldmVsKSB7XHJcbiAgICBcclxuICAgICAgc3dpdGNoKCBjZmcucG9zaXRpb24gKXtcclxuICAgICAgICBjYXNlICdvbkJvdHRvbScgOlxyXG4gICAgICAgICAgRy50bi5zdHlsZVtsZXZlbF1bJ2xhYmVsJ10gPSAnYm90dG9tOjA7ICc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdvdmVySW1hZ2VPblRvcCcgOlxyXG4gICAgICAgICAgRy50bi5zdHlsZVtsZXZlbF1bJ2xhYmVsJ10gPSAndG9wOjA7IHBvc2l0aW9uOmFic29sdXRlOyc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdvdmVySW1hZ2VPbk1pZGRsZScgOlxyXG4gICAgICAgICAgRy50bi5zdHlsZVtsZXZlbF1bJ2xhYmVsJ10gPSAndG9wOjA7IGJvdHRvbTowOyc7XHJcbiAgICAgICAgICBHLnRuLnN0eWxlW2xldmVsXVsndGl0bGUnXSA9ICdwb3NpdGlvbjphYnNvbHV0ZTsgYm90dG9tOjUwJTsnO1xyXG4gICAgICAgICAgRy50bi5zdHlsZVtsZXZlbF1bJ2Rlc2MnXSA9ICdwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjUwJTsnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnY3VzdG9tJyA6XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdvdmVySW1hZ2VPbkJvdHRvbScgOlxyXG4gICAgICAgIGRlZmF1bHQgOlxyXG4gICAgICAgICAgRy5PLnRodW1ibmFpbExhYmVsLnBvc2l0aW9uID0gJ292ZXJJbWFnZU9uQm90dG9tJztcclxuICAgICAgICAgIEcudG4uc3R5bGVbbGV2ZWxdLmxhYmVsID0gJ2JvdHRvbTowOyBwb3NpdGlvbjphYnNvbHV0ZTsnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgLy8gaWYoIEcubGF5b3V0LmVuZ2luZSAhPSAnQ0FTQ0FESU5HJyApIHtcclxuICAgICAgaWYoIGNmZy5wb3NpdGlvbiAhPSAnb25Cb3R0b20nICkge1xyXG4gICAgICAgIC8vIG11bHRpLWxpbmVcclxuICAgICAgICBpZiggY2ZnLnRpdGxlTXVsdGlMaW5lICkge1xyXG4gICAgICAgICAgRy50bi5zdHlsZVtsZXZlbF1bJ3RpdGxlJ10gPSAnd2hpdGUtc3BhY2U6bm9ybWFsOyc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCBjZmcuZGVzY3JpcHRpb25NdWx0aUxpbmUgKSB7XHJcbiAgICAgICAgICBHLnRuLnN0eWxlW2xldmVsXVsnZGVzYyddID0gJ3doaXRlLXNwYWNlOm5vcm1hbDsnO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgXHJcbiAgICAgIHN3aXRjaCggY2ZnLmFsaWduICkge1xyXG4gICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgICAgRy50bi5zdHlsZVtsZXZlbF0ubGFiZWwgKz0gJ3RleHQtYWxpZ246cmlnaHQ7JztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICBHLnRuLnN0eWxlW2xldmVsXS5sYWJlbCArPSAndGV4dC1hbGlnbjpsZWZ0Oyc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBHLnRuLnN0eWxlW2xldmVsXS5sYWJlbCArPSAndGV4dC1hbGlnbjpjZW50ZXI7JztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIGlmKCBjZmcudGl0bGVGb250U2l6ZSAhPSB1bmRlZmluZWQgJiYgY2ZnLnRpdGxlRm9udFNpemUgIT0gJycgKSB7XHJcbiAgICAgICAgRy50bi5zdHlsZVtsZXZlbF0udGl0bGUgKz0gJ2ZvbnQtc2l6ZTonICsgY2ZnLnRpdGxlRm9udFNpemUgKyAnOyc7XHJcbiAgICAgIH1cclxuICAgICAgaWYoIGNmZy5kZXNjcmlwdGlvbkZvbnRTaXplICE9IHVuZGVmaW5lZCAmJiBjZmcuZGVzY3JpcHRpb25Gb250U2l6ZSAhPSAnJyApIHtcclxuICAgICAgICBHLnRuLnN0eWxlW2xldmVsXS5kZXNjICs9ICdmb250LXNpemU6JyArIGNmZy5kZXNjcmlwdGlvbkZvbnRTaXplICsgJzsnO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiggY2ZnLmRpc3BsYXlEZXNjcmlwdGlvbiA9PSBmYWxzZSApIHtcclxuICAgICAgICBHLnRuLnN0eWxlW2xldmVsXS5kZXNjICs9ICdkaXNwbGF5Om5vbmU7JztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgLy8gY2FjaGUgc29tZSB0aHVtYm5haWwgc2V0dGluZ3NcclxuICAgIGZ1bmN0aW9uIFRodW1ibmFpbERlZkNhY2hlcygpIHtcclxuICAgICAgLy8gdGh1bWJuYWlsIGNvbnRlbnQgQ1NTIHN0eWxlc1xyXG5cclxuICAgICAgLy8gc2V0dGluZ3MgZm9yIGxldmVsIEwxIGFuZCBMTlxyXG4gICAgICBUaHVtYm5haWxTdHlsZSggRy5PLnRodW1ibmFpbExhYmVsLCAnbE4nKTtcclxuICAgICAgVGh1bWJuYWlsU3R5bGUoIEcuTy50aHVtYm5haWxMYWJlbCwgJ2wxJyk7XHJcblxyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbEwxTGFiZWwgJiYgRy5PLnRodW1ibmFpbEwxTGFiZWwuZGlzcGxheSApIHtcclxuICAgICAgICAvLyBzZXR0aW5ncyBmb3IgbGV2ZWwgTDFcclxuICAgICAgICBUaHVtYm5haWxTdHlsZSggRy5PLnRodW1ibmFpbEwxTGFiZWwsICdsMScpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBHLnRuLmJvcmRlcldpZHRoID0gRy5PLnRodW1ibmFpbEJvcmRlckhvcml6b250YWw7XHJcbiAgICAgIEcudG4uYm9yZGVySGVpZ2h0ID0gRy5PLnRodW1ibmFpbEJvcmRlclZlcnRpY2FsO1xyXG4gICAgICBcclxuXHJcbiAgICAgIC8vIGRlZmF1bHQgdGh1bWJuYWlsIHNpemVzIGxldmVscyBsMSBhbmQgbE5cclxuICAgICAgdmFyIGxzdD1bJ3hzJywnc20nLCdtZScsJ2xhJywneGwnXTtcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsc3QubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgdmFyIHcgPSBHLnRuLnNldHRpbmdzLndpZHRoLmxOW2xzdFtpXV07XHJcbiAgICAgICAgaWYoIHcgIT0gJ2F1dG8nICkge1xyXG4gICAgICAgICAgRy50bi5kZWZhdWx0U2l6ZS53aWR0aC5sTltsc3RbaV1dID0gdztcclxuICAgICAgICAgIEcudG4uZGVmYXVsdFNpemUud2lkdGgubDFbbHN0W2ldXSA9IHc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgdmFyIGggPSBHLnRuLnNldHRpbmdzLmhlaWdodC5sTltsc3RbaV1dO1xyXG4gICAgICAgICAgRy50bi5kZWZhdWx0U2l6ZS53aWR0aC5sTltsc3RbaV1dID0gaDsgICAgICAvLyBkeW5hbWljIHdpZHRoIC0tPiBzZXQgaGVpZ2h0IHZhbHVlIGFzIGRlZmF1bHQgZm9yIHRoZSB3aWR0aFxyXG4gICAgICAgICAgRy50bi5kZWZhdWx0U2l6ZS53aWR0aC5sMVtsc3RbaV1dID0gaDsgICAgICAvLyBkeW5hbWljIHdpZHRoIC0tPiBzZXQgaGVpZ2h0IHZhbHVlIGFzIGRlZmF1bHRcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsc3QubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgdmFyIGggPSBHLnRuLnNldHRpbmdzLmhlaWdodC5sTltsc3RbaV1dO1xyXG4gICAgICAgIGlmKCBoICE9ICdhdXRvJyApIHtcclxuICAgICAgICAgIC8vIGdyaWQgb3IganVzdGlmaWVkIGxheW91dFxyXG4gICAgICAgICAgRy50bi5kZWZhdWx0U2l6ZS5oZWlnaHQubE5bbHN0W2ldXSA9IGg7ICAvLytHLnRuLmxhYmVsSGVpZ2h0LmdldCgpO1xyXG4gICAgICAgICAgRy50bi5kZWZhdWx0U2l6ZS5oZWlnaHQubDFbbHN0W2ldXSA9IGg7ICAvLytHLnRuLmxhYmVsSGVpZ2h0LmdldCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHZhciB3ID0gRy50bi5zZXR0aW5ncy53aWR0aC5sTltsc3RbaV1dO1xyXG4gICAgICAgICAgRy50bi5kZWZhdWx0U2l6ZS5oZWlnaHQubE5bbHN0W2ldXSA9IHc7ICAgICAgLy8gZHluYW1pYyBoZWlnaHQgLS0+IHNldCB3aWR0aCB2YWx1ZSBhcyBkZWZhdWx0IGZvciB0aGUgaGVpZ2h0XHJcbiAgICAgICAgICBHLnRuLmRlZmF1bHRTaXplLmhlaWdodC5sMVtsc3RbaV1dID0gdzsgICAgICAvLyBkeW5hbWljIGhlaWdodCAtLT4gc2V0IHdpZHRoIHZhbHVlIGFzIGRlZmF1bHRcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGRlZmF1bHQgdGh1bWJuYWlsIHNpemVzIGxldmVscyBsMVxyXG4gICAgICBmb3IoIHZhciBpID0gMDsgaSA8IGxzdC5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICB2YXIgdyA9IEcudG4uc2V0dGluZ3Mud2lkdGgubDFbbHN0W2ldXTtcclxuICAgICAgICBpZiggdyAhPSAnYXV0bycgKSB7XHJcbiAgICAgICAgICBHLnRuLmRlZmF1bHRTaXplLndpZHRoLmwxW2xzdFtpXV0gPSB3O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgIHZhciBoID0gRy50bi5zZXR0aW5ncy5oZWlnaHQubDFbbHN0W2ldXTtcclxuICAgICAgICAgIEcudG4uZGVmYXVsdFNpemUud2lkdGgubDFbbHN0W2ldXSA9IGg7ICAgICAgLy8gZHluYW1pYyB3aWR0aCAtLT4gc2V0IGhlaWdodCB2YWx1ZSBhcyBkZWZhdWx0XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbHN0Lmxlbmd0aDsgaSsrICkge1xyXG4gICAgICAgIHZhciBoID0gRy50bi5zZXR0aW5ncy5oZWlnaHQubDFbbHN0W2ldXTtcclxuICAgICAgICBpZiggaCAhPSAnYXV0bycgKSB7XHJcbiAgICAgICAgICAvLyBncmlkIG9yIGp1c3RpZmllZCBsYXlvdXRcclxuICAgICAgICAgIEcudG4uZGVmYXVsdFNpemUuaGVpZ2h0LmwxW2xzdFtpXV0gPSBoOyAgLy8rRy50bi5sYWJlbEhlaWdodC5nZXQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICB2YXIgdyA9IEcudG4uc2V0dGluZ3Mud2lkdGgubDFbbHN0W2ldXTtcclxuICAgICAgICAgIEcudG4uZGVmYXVsdFNpemUuaGVpZ2h0LmwxW2xzdFtpXV09IHcgOyAgICAgIC8vIGR5bmFtaWMgaGVpZ2h0IC0tPiBzZXQgd2lkdGggdmFsdWUgYXMgZGVmYXVsdFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIC8vICMjIyMjIFRIVU1CTkFJTCBTSVpFIE1BTkFHRU1FTlRcclxuICAgIGZ1bmN0aW9uIFRodW1ibmFpbHNTZXRTaXplKCBkaXIsIGxldmVsLCB2LCBjcm9wICkge1xyXG4gICAgICBHLnRuLnNldHRpbmdzW2Rpcl1bbGV2ZWxdWyd4cyddID0gdjtcclxuICAgICAgRy50bi5zZXR0aW5nc1tkaXJdW2xldmVsXVsnc20nXSA9IHY7XHJcbiAgICAgIEcudG4uc2V0dGluZ3NbZGlyXVtsZXZlbF1bJ21lJ10gPSB2O1xyXG4gICAgICBHLnRuLnNldHRpbmdzW2Rpcl1bbGV2ZWxdWydsYSddID0gdjtcclxuICAgICAgRy50bi5zZXR0aW5nc1tkaXJdW2xldmVsXVsneGwnXSA9IHY7XHJcbiAgICAgIEcudG4uc2V0dGluZ3NbZGlyXVtsZXZlbF1bJ3hzYyddID0gY3JvcDtcclxuICAgICAgRy50bi5zZXR0aW5nc1tkaXJdW2xldmVsXVsnc21jJ10gPSBjcm9wO1xyXG4gICAgICBHLnRuLnNldHRpbmdzW2Rpcl1bbGV2ZWxdWydtZWMnXSA9IGNyb3A7XHJcbiAgICAgIEcudG4uc2V0dGluZ3NbZGlyXVtsZXZlbF1bJ2xhYyddID0gY3JvcDtcclxuICAgICAgRy50bi5zZXR0aW5nc1tkaXJdW2xldmVsXVsneGxjJ10gPSBjcm9wO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvL1xyXG4gICAgZnVuY3Rpb24gR2FsbGVyeVRoZW1lR2V0Q3VycmVudCgpIHtcclxuXHJcbiAgICAgIHZhciBjcz1udWxsO1xyXG4gICAgICBzd2l0Y2godG9UeXBlKEcuTy5nYWxsZXJ5VGhlbWUpKSB7XHJcbiAgICAgICAgY2FzZSAnb2JqZWN0JzogICAgLy8gdXNlciBjdXN0b20gY29sb3Igc2NoZW1lIG9iamVjdCBcclxuICAgICAgICAgIGNzID0gRy5nYWxsZXJ5VGhlbWVfZGFyazsgIC8vIGRlZmF1bHQgY29sb3Igc2NoZW1lXHJcbiAgICAgICAgICBqUXVlcnkuZXh0ZW5kKHRydWUsY3MsRy5PLmdhbGxlcnlUaGVtZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdzdHJpbmcnOiAgICAvLyBuYW1lIG9mIGFuIGludGVybmFsIGRlZmluZWQgY29sb3Igc2NoZW1lXHJcbiAgICAgICAgICBzd2l0Y2goIEcuTy5nYWxsZXJ5VGhlbWUgKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ2xpZ2h0JzpcclxuICAgICAgICAgICAgICBjcyA9IEcuZ2FsbGVyeVRoZW1lX2xpZ2h0O1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzpcclxuICAgICAgICAgICAgY2FzZSAnZGFyayc6XHJcbiAgICAgICAgICAgIGNhc2UgJ25vbmUnOlxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgIGNzID0gRy5nYWxsZXJ5VGhlbWVfZGFyaztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBjcyA9IEcuZ2FsbGVyeVRoZW1lX2Rhcms7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGNzO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyAjIyMjIyBCUkVBRENSVU1CL1RIVU1CTkFJTCBDT0xPUiBTQ0hFTUUgIyMjIyNcclxuICAgIGZ1bmN0aW9uIFNldEdhbGxlcnlUaGVtZSgpIHtcclxuICAgIFxyXG4gICAgICBpZiggdHlwZW9mIEcuTy5jb2xvclNjaGVtZSAgIT09ICd1bmRlZmluZWQnICkge1xyXG4gICAgICAgIEcuTy5nYWxsZXJ5VGhlbWUgPSBHLk8uY29sb3JTY2hlbWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHZhciBjcyA9IG51bGw7XHJcbiAgICAgIHZhciBnYWxsZXJ5VGhlbWUgPSAnJztcclxuICAgICAgc3dpdGNoKHRvVHlwZShHLk8uZ2FsbGVyeVRoZW1lKSkge1xyXG4gICAgICAgIGNhc2UgJ29iamVjdCc6ICAgIC8vIHVzZXIgY3VzdG9tIGNvbG9yIHNjaGVtZSBvYmplY3QgXHJcbiAgICAgICAgICBjcyA9IEcuZ2FsbGVyeVRoZW1lX2Rhcms7ICAvLyBkZWZhdWx0IGNvbG9yIHNjaGVtZVxyXG4gICAgICAgICAgalF1ZXJ5LmV4dGVuZCh0cnVlLGNzLEcuTy5nYWxsZXJ5VGhlbWUpO1xyXG4gICAgICAgICAgZ2FsbGVyeVRoZW1lPSduYW5vZ2FsbGVyeV9nYWxsZXJ5dGhlbWVfY3VzdG9tXycgKyBHLmJhc2VFbHRJRDtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3N0cmluZyc6ICAgIC8vIG5hbWUgb2YgYW4gaW50ZXJuYWwgZGVmaW5lZCBjb2xvciBzY2hlbWVcclxuICAgICAgICAgIHN3aXRjaCggRy5PLmdhbGxlcnlUaGVtZSApIHtcclxuICAgICAgICAgICAgY2FzZSAnbGlnaHQnOlxyXG4gICAgICAgICAgICAgIGNzID0gRy5nYWxsZXJ5VGhlbWVfbGlnaHQ7XHJcbiAgICAgICAgICAgICAgZ2FsbGVyeVRoZW1lPSduYW5vZ2FsbGVyeV9nYWxsZXJ5dGhlbWVfbGlnaHRfJyArIEcuYmFzZUVsdElEO1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzpcclxuICAgICAgICAgICAgY2FzZSAnZGFyayc6XHJcbiAgICAgICAgICAgIGNhc2UgJ25vbmUnOlxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgIGNzID0gRy5nYWxsZXJ5VGhlbWVfZGFyaztcclxuICAgICAgICAgICAgICBnYWxsZXJ5VGhlbWU9J25hbm9nYWxsZXJ5X2dhbGxlcnl0aGVtZV9kYXJrXycgKyBHLmJhc2VFbHRJRDtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBOYW5vQWxlcnQoRywgJ0Vycm9yIGluIGdhbGxlcnlUaGVtZSBwYXJhbWV0ZXIuJyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vdmFyIHMxPScubmFub2dhbGxlcnlfdGhlbWVfJytHLk8udGhlbWUrJyAnO1xyXG4gICAgICB2YXIgczE9Jy4nICsgZ2FsbGVyeVRoZW1lICsgJyAnO1xyXG4gICAgXHJcbiAgICAgIC8vIG5hdmlnYXRpb24gYmFyXHJcbiAgICAgIHZhciBzPXMxKycubkdZMk5hdmlnYXRpb25iYXIgeyBiYWNrZ3JvdW5kOicrY3MubmF2aWdhdGlvbkJhci5iYWNrZ3JvdW5kKyc7IH0nKydcXG4nO1xyXG4gICAgICBpZiggY3MubmF2aWdhdGlvbkJhci5ib3JkZXIgIT09IHVuZGVmaW5lZCAmJiBjcy5uYXZpZ2F0aW9uQmFyLmJvcmRlciAhPT0gJycgKSB7IHMrPXMxKycubkdZMk5hdmlnYXRpb25iYXIgeyBib3JkZXI6Jytjcy5uYXZpZ2F0aW9uQmFyLmJvcmRlcisnOyB9JysnXFxuJzsgfVxyXG4gICAgICBpZiggY3MubmF2aWdhdGlvbkJhci5ib3JkZXJUb3AgIT09IHVuZGVmaW5lZCAmJiBjcy5uYXZpZ2F0aW9uQmFyLmJvcmRlclRvcCAhPT0gJycgKSB7IHMrPXMxKycubkdZMk5hdmlnYXRpb25iYXIgeyBib3JkZXItdG9wOicrY3MubmF2aWdhdGlvbkJhci5ib3JkZXJUb3ArJzsgfScrJ1xcbic7IH1cclxuICAgICAgaWYoIGNzLm5hdmlnYXRpb25CYXIuYm9yZGVyQm90dG9tICE9PSB1bmRlZmluZWQgJiYgY3MubmF2aWdhdGlvbkJhci5ib3JkZXJCb3R0b20gIT09ICcnICkgeyBzKz1zMSsnLm5HWTJOYXZpZ2F0aW9uYmFyIHsgYm9yZGVyLWJvdHRvbTonK2NzLm5hdmlnYXRpb25CYXIuYm9yZGVyQm90dG9tKyc7IH0nKydcXG4nOyB9XHJcbiAgICAgIGlmKCBjcy5uYXZpZ2F0aW9uQmFyLmJvcmRlclJpZ2h0ICE9PSB1bmRlZmluZWQgJiYgY3MubmF2aWdhdGlvbkJhci5ib3JkZXJSaWdodCAhPT0gJycgKSB7IHMrPXMxKycubkdZMk5hdmlnYXRpb25iYXIgeyBib3JkZXItcmlnaHQ6Jytjcy5uYXZpZ2F0aW9uQmFyLmJvcmRlclJpZ2h0Kyc7IH0nKydcXG4nOyB9XHJcbiAgICAgIGlmKCBjcy5uYXZpZ2F0aW9uQmFyLmJvcmRlckxlZnQgIT09IHVuZGVmaW5lZCAmJiBjcy5uYXZpZ2F0aW9uQmFyLmJvcmRlckxlZnQgIT09ICcnICkgeyBzKz1zMSsnLm5HWTJOYXZpZ2F0aW9uYmFyIHsgYm9yZGVyLWxlZnQ6Jytjcy5uYXZpZ2F0aW9uQmFyLmJvcmRlckxlZnQrJzsgfScrJ1xcbic7IH1cclxuICAgICAgXHJcbiAgICAgIC8vIG5hdmlnYXRpb24gYmFyIC0gYnJlYWRjcnVtYlxyXG4gICAgICBzKz1zMSsnLm5HWTJCcmVhZGNydW1iIHsgYmFja2dyb3VuZDonK2NzLm5hdmlnYXRpb25CcmVhZGNydW1iLmJhY2tncm91bmQrJzsgYm9yZGVyLXJhZGl1czonK2NzLm5hdmlnYXRpb25CcmVhZGNydW1iLmJvcmRlclJhZGl1cysnOyB9JysnXFxuJztcclxuICAgICAgcys9czErJy5uR1kyQnJlYWRjcnVtYiAub25lSXRlbSAgeyBjb2xvcjonK2NzLm5hdmlnYXRpb25CcmVhZGNydW1iLmNvbG9yKyc7IH0nKydcXG4nO1xyXG4gICAgICBzKz1zMSsnLm5HWTJCcmVhZGNydW1iIC5vbmVJdGVtOmhvdmVyIHsgY29sb3I6Jytjcy5uYXZpZ2F0aW9uQnJlYWRjcnVtYi5jb2xvckhvdmVyKyc7IH0nKydcXG4nO1xyXG5cclxuICAgICAgLy8gbmF2aWdhdGlvbiBiYXIgLSB0YWcgZmlsdGVyXHJcbiAgICAgIHMrPXMxKycubkdZMk5hdkZpbHRlclVuc2VsZWN0ZWQgeyBjb2xvcjonK2NzLm5hdmlnYXRpb25GaWx0ZXIuY29sb3IrJzsgYmFja2dyb3VuZDonK2NzLm5hdmlnYXRpb25GaWx0ZXIuYmFja2dyb3VuZCsnOyBib3JkZXItcmFkaXVzOicrY3MubmF2aWdhdGlvbkZpbHRlci5ib3JkZXJSYWRpdXMrJzsgfScrJ1xcbic7XHJcbiAgICAgIHMrPXMxKycubkdZMk5hdkZpbHRlclNlbGVjdGVkIHsgY29sb3I6Jytjcy5uYXZpZ2F0aW9uRmlsdGVyLmNvbG9yU2VsZWN0ZWQrJzsgYmFja2dyb3VuZDonK2NzLm5hdmlnYXRpb25GaWx0ZXIuYmFja2dyb3VuZFNlbGVjdGVkKyc7IGJvcmRlci1yYWRpdXM6Jytjcy5uYXZpZ2F0aW9uRmlsdGVyLmJvcmRlclJhZGl1cysnOyB9JysnXFxuJztcclxuICAgICAgcys9czErJy5uR1kyTmF2RmlsdGVyU2VsZWN0QWxsIHsgY29sb3I6Jytjcy5uYXZpZ2F0aW9uRmlsdGVyLmNvbG9yU2VsZWN0ZWQrJzsgYmFja2dyb3VuZDonK2NzLm5hdmlnYXRpb25GaWx0ZXIuYmFja2dyb3VuZCsnOyBib3JkZXItcmFkaXVzOicrY3MubmF2aWdhdGlvbkZpbHRlci5ib3JkZXJSYWRpdXMrJzsgfScrJ1xcbic7XHJcbiAgICAgIFxyXG4gICAgICAvLyB0aHVtYm5haWxzXHJcbiAgICAgIHMrPXMxKycubkdZMkdUaHVtYm5haWwgeyBiYWNrZ3JvdW5kOicrY3MudGh1bWJuYWlsLmJhY2tncm91bmQrJzsgYm9yZGVyLWNvbG9yOicrY3MudGh1bWJuYWlsLmJvcmRlckNvbG9yKyc7IGJvcmRlci10b3Atd2lkdGg6JytHLk8udGh1bWJuYWlsQm9yZGVyVmVydGljYWwrJ3B4OyBib3JkZXItcmlnaHQtd2lkdGg6JytHLk8udGh1bWJuYWlsQm9yZGVySG9yaXpvbnRhbCsncHg7IGJvcmRlci1ib3R0b20td2lkdGg6JytHLk8udGh1bWJuYWlsQm9yZGVyVmVydGljYWwrJ3B4OyBib3JkZXItbGVmdC13aWR0aDonK0cuTy50aHVtYm5haWxCb3JkZXJIb3Jpem9udGFsKydweDt9JysnXFxuJztcclxuICAgICAgcys9czErJy5uR1kyR1RodW1ibmFpbFN0YWNrIHsgYmFja2dyb3VuZDonK2NzLnRodW1ibmFpbC5zdGFja0JhY2tncm91bmQrJzsgfScrJ1xcbic7XHJcbiAgICAgIC8vIHMrPXMxKycubkdZMkdUaHVtYm5haWxJbWFnZSB7IGJhY2tncm91bmQ6Jytjcy50aHVtYm5haWwuYmFja2dyb3VuZCsnOyBiYWNrZ3JvdW5kLWltYWdlOicrY3MudGh1bWJuYWlsLmJhY2tncm91bmRJbWFnZSsnOyB9JysnXFxuJztcclxuICAgICAgcys9czErJy5uR1kyVG5JbWdCYWNrIHsgYmFja2dyb3VuZDonK2NzLnRodW1ibmFpbC5iYWNrZ3JvdW5kKyc7IGJhY2tncm91bmQtaW1hZ2U6Jytjcy50aHVtYm5haWwuYmFja2dyb3VuZEltYWdlKyc7IH0nKydcXG4nO1xyXG4gICAgICBzKz1zMSsnLm5HWTJHVGh1bWJuYWlsQWxidW1VcCB7IGJhY2tncm91bmQ6Jytjcy50aHVtYm5haWwuYmFja2dyb3VuZCsnOyBiYWNrZ3JvdW5kLWltYWdlOicrY3MudGh1bWJuYWlsLmJhY2tncm91bmRJbWFnZSsnOyBjb2xvcjonK2NzLnRodW1ibmFpbC50aXRsZUNvbG9yKyc7IH0nKydcXG4nO1xyXG4gICAgICBzKz1zMSsnLm5HWTJHVGh1bWJuYWlsSWNvbnNGdWxsVGh1bWJuYWlsIHsgY29sb3I6Jytjcy50aHVtYm5haWwudGl0bGVDb2xvcisnOyB9XFxuJztcclxuICAgICAgcys9czErJy5uR1kyR1RodW1ibmFpbExhYmVsIHsgYmFja2dyb3VuZDonK2NzLnRodW1ibmFpbC5sYWJlbEJhY2tncm91bmQrJzsgb3BhY2l0eTonK2NzLnRodW1ibmFpbC5sYWJlbE9wYWNpdHkrJzsgfScrJ1xcbic7XHJcbiAgICAgIHMrPXMxKycubkdZMkdUaHVtYm5haWxJbWFnZVRpdGxlICB7IGNvbG9yOicrY3MudGh1bWJuYWlsLnRpdGxlQ29sb3IrJzsgYmFja2dyb3VuZC1jb2xvcjonK2NzLnRodW1ibmFpbC50aXRsZUJnQ29sb3IrJzsgJysoY3MudGh1bWJuYWlsLnRpdGxlU2hhZG93ID09JycgPyAnJzogJ1RleHQtU2hhZG93OicrY3MudGh1bWJuYWlsLnRpdGxlU2hhZG93Kyc7JykrJyB9JysnXFxuJztcclxuICAgICAgcys9czErJy5uR1kyR1RodW1ibmFpbEFsYnVtVGl0bGUgeyBjb2xvcjonK2NzLnRodW1ibmFpbC50aXRsZUNvbG9yKyc7IGJhY2tncm91bmQtY29sb3I6Jytjcy50aHVtYm5haWwudGl0bGVCZ0NvbG9yKyc7ICcrKGNzLnRodW1ibmFpbC50aXRsZVNoYWRvdyA9PScnID8gJyc6ICdUZXh0LVNoYWRvdzonK2NzLnRodW1ibmFpbC50aXRsZVNoYWRvdysnOycpKycgfScrJ1xcbic7XHJcbiAgICAgIHMrPXMxKycubkdZMkdUaHVtYm5haWxEZXNjcmlwdGlvbiB7IGNvbG9yOicrY3MudGh1bWJuYWlsLmRlc2NyaXB0aW9uQ29sb3IrJzsgYmFja2dyb3VuZC1jb2xvcjonK2NzLnRodW1ibmFpbC5kZXNjcmlwdGlvbkJnQ29sb3IrJzsgJysoY3MudGh1bWJuYWlsLmRlc2NyaXB0aW9uU2hhZG93ID09JycgPyAnJzogJ1RleHQtU2hhZG93OicrY3MudGh1bWJuYWlsLmRlc2NyaXB0aW9uU2hhZG93Kyc7JykrJyB9JysnXFxuJztcclxuXHJcbiAgICAgIC8vIHRodW1ibmFpbHMgLSBpY29uc1xyXG4gICAgICBzKz1zMSsnLm5HWTJHVGh1bWJuYWlsSWNvbnMgeyBwYWRkaW5nOicrY3MudGh1bWJuYWlsSWNvbi5wYWRkaW5nKyc7IH1cXG4nO1xyXG4gICAgICBzKz1zMSsnLm5HWTJHVGh1bWJuYWlsSWNvbiB7IGNvbG9yOicrY3MudGh1bWJuYWlsSWNvbi5jb2xvcisnOyB9XFxuJztcclxuICAgICAgcys9czErJy5uR1kyR1RodW1ibmFpbEljb25UZXh0QmFkZ2UgeyBiYWNrZ3JvdW5kLWNvbG9yOicrY3MudGh1bWJuYWlsSWNvbi5jb2xvcisnOyB9XFxuJztcclxuICAgICAgXHJcbiAgICAgIC8vIGdhbGxlcnkgcGFnaW5hdGlvbiAtPiBkb3QvcmVjdGFuZ2xlIGJhc2VkXHJcbiAgICAgIGlmKCBHLk8uZ2FsbGVyeVBhZ2luYXRpb25Nb2RlICE9ICdOVU1CRVJTJyApIHtcclxuICAgICAgICBzKz1zMSsnLm5HWTJwYWdpbmF0aW9uRG90IHsgYm9yZGVyOicrY3MucGFnaW5hdGlvbi5zaGFwZUJvcmRlcisnOyBiYWNrZ3JvdW5kOicrY3MucGFnaW5hdGlvbi5zaGFwZUNvbG9yKyc7fVxcbic7XHJcbiAgICAgICAgcys9czErJy5uR1kycGFnaW5hdGlvbkRvdEN1cnJlbnRQYWdlIHsgYm9yZGVyOicrY3MucGFnaW5hdGlvbi5zaGFwZUJvcmRlcisnOyBiYWNrZ3JvdW5kOicrY3MucGFnaW5hdGlvbi5zaGFwZVNlbGVjdGVkQ29sb3IrJzt9XFxuJztcclxuICAgICAgICBzKz1zMSsnLm5HWTJwYWdpbmF0aW9uUmVjdGFuZ2xlIHsgYm9yZGVyOicrY3MucGFnaW5hdGlvbi5zaGFwZUJvcmRlcisnOyBiYWNrZ3JvdW5kOicrY3MucGFnaW5hdGlvbi5zaGFwZUNvbG9yKyc7fVxcbic7XHJcbiAgICAgICAgcys9czErJy5uR1kycGFnaW5hdGlvblJlY3RhbmdsZUN1cnJlbnRQYWdlIHsgYm9yZGVyOicrY3MucGFnaW5hdGlvbi5zaGFwZUJvcmRlcisnOyBiYWNrZ3JvdW5kOicrY3MucGFnaW5hdGlvbi5zaGFwZVNlbGVjdGVkQ29sb3IrJzt9XFxuJztcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzKz1zMSsnLm5HWTJwYWdpbmF0aW9uSXRlbSB7IGJhY2tncm91bmQ6Jytjcy5wYWdpbmF0aW9uLmJhY2tncm91bmQrJzsgY29sb3I6Jytjcy5wYWdpbmF0aW9uLmNvbG9yKyc7IGJvcmRlci1yYWRpdXM6Jytjcy5wYWdpbmF0aW9uLmJvcmRlclJhZGl1cysnOyB9XFxuJztcclxuICAgICAgICBzKz1zMSsnLm5HWTJwYWdpbmF0aW9uSXRlbUN1cnJlbnRQYWdlIHsgYmFja2dyb3VuZDonK2NzLnBhZ2luYXRpb24uYmFja2dyb3VuZCsnOyBjb2xvcjonK2NzLnBhZ2luYXRpb24uY29sb3IrJzsgYm9yZGVyLXJhZGl1czonK2NzLnBhZ2luYXRpb24uYm9yZGVyUmFkaXVzKyc7IH1cXG4nO1xyXG4gICAgICAgIHMrPXMxKycubkdZMlBhZ2luYXRpb25QcmV2IHsgYmFja2dyb3VuZDonK2NzLnBhZ2luYXRpb24uYmFja2dyb3VuZCsnOyBjb2xvcjonK2NzLnBhZ2luYXRpb24uY29sb3IrJzsgYm9yZGVyLXJhZGl1czonK2NzLnBhZ2luYXRpb24uYm9yZGVyUmFkaXVzKyc7IH1cXG4nO1xyXG4gICAgICAgIHMrPXMxKycubkdZMlBhZ2luYXRpb25OZXh0IHsgYmFja2dyb3VuZDonK2NzLnBhZ2luYXRpb24uYmFja2dyb3VuZCsnOyBjb2xvcjonK2NzLnBhZ2luYXRpb24uY29sb3IrJzsgYm9yZGVyLXJhZGl1czonK2NzLnBhZ2luYXRpb24uYm9yZGVyUmFkaXVzKyc7IH1cXG4nO1xyXG4gICAgICAgIHMrPXMxKycubkdZMnBhZ2luYXRpb25JdGVtQ3VycmVudFBhZ2UgeyBiYWNrZ3JvdW5kOicrY3MucGFnaW5hdGlvbi5iYWNrZ3JvdW5kU2VsZWN0ZWQrJzsgfVxcbic7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIGdhbGxlcnkgbW9yZSBidXR0b25cclxuICAgICAgcys9czErJy5uR1kyR2FsbGVyeU1vcmVCdXR0b25Bbm5vdGF0aW9uIHsgYmFja2dyb3VuZDonK2NzLnRodW1ibmFpbC5iYWNrZ3JvdW5kKyc7IGJvcmRlci1jb2xvcjonK2NzLnRodW1ibmFpbC5ib3JkZXJDb2xvcisnOyBib3JkZXItdG9wLXdpZHRoOicrRy5PLnRodW1ibmFpbEJvcmRlclZlcnRpY2FsKydweDsgYm9yZGVyLXJpZ2h0LXdpZHRoOicrRy5PLnRodW1ibmFpbEJvcmRlckhvcml6b250YWwrJ3B4OyBib3JkZXItYm90dG9tLXdpZHRoOicrRy5PLnRodW1ibmFpbEJvcmRlclZlcnRpY2FsKydweDsgYm9yZGVyLWxlZnQtd2lkdGg6JytHLk8udGh1bWJuYWlsQm9yZGVySG9yaXpvbnRhbCsncHg7fVxcbic7XHJcbiAgICAgIHMrPXMxKycubkdZMkdhbGxlcnlNb3JlQnV0dG9uQW5ub3RhdGlvbiAgeyBjb2xvcjonK2NzLnRodW1ibmFpbC50aXRsZUNvbG9yKyc7ICcrKGNzLnRodW1ibmFpbC50aXRsZVNoYWRvdyA9PScnID8gJyc6ICdUZXh0LVNoYWRvdzonK2NzLnRodW1ibmFpbC50aXRsZVNoYWRvdykrJzsgfVxcbic7XHJcbiAgICAgIFxyXG4gICAgICBqUXVlcnkoJ2hlYWQnKS5hcHBlbmQoJzxzdHlsZSBpZD1cIm5neWNzXycrRy5iYXNlRWx0SUQrJ1wiPicrcysnPC9zdHlsZT4nKTtcclxuICAgICAgRy4kRS5iYXNlLmFkZENsYXNzKGdhbGxlcnlUaGVtZSk7XHJcblxyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gIyMjIyMgVklFV0VSIENPTE9SIFNDSEVNRSAjIyMjI1xyXG4gICAgZnVuY3Rpb24gU2V0Vmlld2VyVGhlbWUoICkge1xyXG5cclxuICAgICAgaWYoIEcuVk9NLnZpZXdlclRoZW1lICE9ICcnICkge1xyXG4gICAgICAgIEcuVk9NLiRjb250LmFkZENsYXNzKEcuVk9NLnZpZXdlclRoZW1lKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmKCB0eXBlb2YgRy5PLmNvbG9yU2NoZW1lVmlld2VyICAhPT0gJ3VuZGVmaW5lZCcgKSB7XHJcbiAgICAgICAgRy5PLnZpZXdlclRoZW1lID0gRy5PLmNvbG9yU2NoZW1lVmlld2VyO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgY3M9bnVsbDtcclxuICAgICAgc3dpdGNoKHRvVHlwZShHLk8udmlld2VyVGhlbWUpKSB7XHJcbiAgICAgICAgY2FzZSAnb2JqZWN0JzogICAgLy8gdXNlciBjdXN0b20gY29sb3Igc2NoZW1lIG9iamVjdCBcclxuICAgICAgICAgIGNzID0gRy52aWV3ZXJUaGVtZV9kYXJrO1xyXG4gICAgICAgICAgalF1ZXJ5LmV4dGVuZCh0cnVlLCBjcywgRy5PLnZpZXdlclRoZW1lKTtcclxuICAgICAgICAgIEcuVk9NLnZpZXdlclRoZW1lID0gJ25hbm9nYWxsZXJ5X3ZpZXdlcnRoZW1lX2N1c3RvbV8nICsgRy5iYXNlRWx0SUQ7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdzdHJpbmcnOiAgICAvLyBuYW1lIG9mIGFuIGludGVybmFsIGRlZmluZWQgY29sb3Igc2NoZW1lXHJcbiAgICAgICAgICBzd2l0Y2goIEcuTy52aWV3ZXJUaGVtZSApIHtcclxuICAgICAgICAgICAgY2FzZSAnbm9uZSc6XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlICdsaWdodCc6XHJcbiAgICAgICAgICAgICAgY3MgPSBHLnZpZXdlclRoZW1lX2xpZ2h0O1xyXG4gICAgICAgICAgICAgIEcuVk9NLnZpZXdlclRoZW1lID0gJ25hbm9nYWxsZXJ5X3ZpZXdlcnRoZW1lX2xpZ2h0XycgKyBHLmJhc2VFbHRJRDtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnYm9yZGVyJzpcclxuICAgICAgICAgICAgICBjcyA9IEcudmlld2VyVGhlbWVfYm9yZGVyO1xyXG4gICAgICAgICAgICAgIEcuVk9NLnZpZXdlclRoZW1lID0gJ25hbm9nYWxsZXJ5X3ZpZXdlcnRoZW1lX2JvcmRlcl8nICsgRy5iYXNlRWx0SUQ7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2RhcmsnOlxyXG4gICAgICAgICAgICBjYXNlICdkZWZhdWx0JzpcclxuICAgICAgICAgICAgICBjcyA9IEcudmlld2VyVGhlbWVfZGFyaztcclxuICAgICAgICAgICAgICBHLlZPTS52aWV3ZXJUaGVtZSA9ICduYW5vZ2FsbGVyeV92aWV3ZXJ0aGVtZV9kYXJrXycgKyBHLmJhc2VFbHRJRDtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICBOYW5vQWxlcnQoRywgJ0Vycm9yIGluIHZpZXdlclRoZW1lIHBhcmFtZXRlci4nKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIHMxID0gJy4nICsgRy5WT00udmlld2VyVGhlbWUgKyAnICc7XHJcbiAgICAgIHZhciBzID0gczEgKyAnLm5HWTJWaWV3ZXIgeyBiYWNrZ3JvdW5kOicgKyBjcy5iYWNrZ3JvdW5kICsgJzsgfScrJ1xcbic7XHJcbiAgICAgIHMgKz0gczEgKyAnLm5HWTJWaWV3ZXJNZWRpYSB7IGJvcmRlcjonICsgY3MuaW1hZ2VCb3JkZXIgKyAnOyBib3gtc2hhZG93OicgKyBjcy5pbWFnZUJveFNoYWRvdyArICc7IH0nKydcXG4nO1xyXG4gICAgICBzICs9IHMxICsgJy5uR1kyVmlld2VyIC50b29sYmFyQmFja2dyb3VuZCB7IGJhY2tncm91bmQ6JyArIGNzLmJhckJhY2tncm91bmQgKyAnOyB9JysnXFxuJztcclxuICAgICAgcyArPSBzMSArICcubkdZMlZpZXdlciAubkdZMlZpZXdlclRvb2xzVG9wTGVmdCB7IGJhY2tncm91bmQ6JyArIGNzLmJhckJhY2tncm91bmQgKyAnOyB9JysnXFxuJztcclxuICAgICAgcyArPSBzMSArICcubkdZMlZpZXdlciAubkdZMlZpZXdlclRvb2xzVG9wUmlnaHQgeyBiYWNrZ3JvdW5kOicgKyBjcy5iYXJCYWNrZ3JvdW5kICsgJzsgfScrJ1xcbic7XHJcbiAgICAgIHMgKz0gczEgKyAnLm5HWTJWaWV3ZXIgLm5HWTJWaWV3ZXJBcmVhTmV4dCB7IGJhY2tncm91bmQ6JyArIGNzLmJhckJhY2tncm91bmQgKyAnOyB9JysnXFxuJztcclxuICAgICAgcyArPSBzMSArICcubkdZMlZpZXdlciAubkdZMlZpZXdlckFyZWFQcmV2aW91cyB7IGJhY2tncm91bmQ6JyArIGNzLmJhckJhY2tncm91bmQgKyAnOyB9JysnXFxuJztcclxuICAgICAgcyArPSBzMSArICcubkdZMlZpZXdlciAudG9vbGJhciB7IGJvcmRlcjonICsgY3MuYmFyQm9yZGVyICsgJzsgY29sb3I6JyArIGNzLmJhckNvbG9yICsgJzsgfScrJ1xcbic7XHJcbiAgICAgIHMgKz0gczEgKyAnLm5HWTJWaWV3ZXIgLnRvb2xiYXIgLnByZXZpb3VzQnV0dG9uOmFmdGVyIHsgY29sb3I6JyArIGNzLmJhckNvbG9yICsgJzsgfScrJ1xcbic7XHJcbiAgICAgIHMgKz0gczEgKyAnLm5HWTJWaWV3ZXIgLnRvb2xiYXIgLm5leHRCdXR0b246YWZ0ZXIgeyBjb2xvcjonICsgY3MuYmFyQ29sb3IgKyAnOyB9JysnXFxuJztcclxuICAgICAgcyArPSBzMSArICcubkdZMlZpZXdlciAudG9vbGJhciAuY2xvc2VCdXR0b246YWZ0ZXIgeyBjb2xvcjonICsgY3MuYmFyQ29sb3IgKyAnOyB9JysnXFxuJztcclxuICAgICAgcyArPSBzMSArICcubkdZMlZpZXdlciAudG9vbGJhciAubGFiZWwgLnRpdGxlIHsgY29sb3I6JyArIGNzLmJhckNvbG9yICsgJzsgfScrJ1xcbic7XHJcbiAgICAgIHMgKz0gczEgKyAnLm5HWTJWaWV3ZXIgLnRvb2xiYXIgLmxhYmVsIC5kZXNjcmlwdGlvbiB7IGNvbG9yOicgKyBjcy5iYXJEZXNjcmlwdGlvbkNvbG9yICsgJzsgfScrJ1xcbic7XHJcbiAgICAgIGpRdWVyeSgnaGVhZCcpLmFwcGVuZCgnPHN0eWxlPicgKyBzICsgJzwvc3R5bGU+Jyk7XHJcbiAgICAgIEcuVk9NLiRjb250LmFkZENsYXNzKEcuVk9NLnZpZXdlclRoZW1lKTtcclxuICAgIH07XHJcblxyXG4gICAgXHJcbiAgICBcclxuICAgIC8qKiBAZnVuY3Rpb24gU2V0UG9seUZpbGxzICovXHJcbiAgICBmdW5jdGlvbiBTZXRQb2x5RmlsbHMoKSB7XHJcblxyXG4gICAgICAvLyBQT0xZRklMTCBGT1IgQklORCBmdW5jdGlvbiAtLT4gZm9yIG9sZGVyIFNhZmFyaSBtb2JpbGVcclxuICAgICAgLy8gZm91bmQgb24gTUROOiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9GdW5jdGlvbi9iaW5kI0NvbXBhdGliaWxpdHlcclxuICAgICAgaWYgKCFGdW5jdGlvbi5wcm90b3R5cGUuYmluZCkge1xyXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKG9UaGlzKSB7XHJcbiAgICAgICAgICBpZiAodHlwZW9mIHRoaXMgIT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICAvLyBjbG9zZXN0IHRoaW5nIHBvc3NpYmxlIHRvIHRoZSBFQ01BU2NyaXB0IDVcclxuICAgICAgICAgICAgLy8gaW50ZXJuYWwgSXNDYWxsYWJsZSBmdW5jdGlvblxyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgLSB3aGF0IGlzIHRyeWluZyB0byBiZSBib3VuZCBpcyBub3QgY2FsbGFibGVcIik7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdmFyIGFBcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSwgXHJcbiAgICAgICAgICAgICAgZlRvQmluZCA9IHRoaXMsIFxyXG4gICAgICAgICAgICAgIGZOT1AgPSBmdW5jdGlvbiAoKSB7fSxcclxuICAgICAgICAgICAgICBmQm91bmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZlRvQmluZC5hcHBseSh0aGlzIGluc3RhbmNlb2YgZk5PUCAmJiBvVGhpc1xyXG4gICAgICAgICAgICAgICAgICAgICAgID8gdGhpc1xyXG4gICAgICAgICAgICAgICAgICAgICAgIDogb1RoaXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgYUFyZ3MuY29uY2F0KEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykpKTtcclxuICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgIGZOT1AucHJvdG90eXBlID0gdGhpcy5wcm90b3R5cGU7XHJcbiAgICAgICAgICBmQm91bmQucHJvdG90eXBlID0gbmV3IGZOT1AoKTtcclxuXHJcbiAgICAgICAgICByZXR1cm4gZkJvdW5kO1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHJlcXVlc3RBbmltYXRpb25GcmFtZSBwb2x5ZmlsbCBieSBFcmlrIE3vv71sbGVyLiBmaXhlcyBmcm9tIFBhdWwgSXJpc2ggYW5kIFRpbm8gWmlqZGVsXHJcbiAgICAgIC8vIGh0dHA6Ly9wYXVsaXJpc2guY29tLzIwMTEvcmVxdWVzdGFuaW1hdGlvbmZyYW1lLWZvci1zbWFydC1hbmltYXRpbmcvXHJcbiAgICAgIC8vIGh0dHA6Ly9teS5vcGVyYS5jb20vZW1vbGxlci9ibG9nLzIwMTEvMTIvMjAvcmVxdWVzdGFuaW1hdGlvbmZyYW1lLWZvci1zbWFydC1lci1hbmltYXRpbmdcclxuICAgICAgLy8gTUlUIGxpY2Vuc2VcclxuICAgICAgKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBsYXN0VGltZSA9IDA7XHJcbiAgICAgICAgdmFyIHZlbmRvcnMgPSBbJ21zJywgJ21veicsICd3ZWJraXQnLCAnbyddO1xyXG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdmVuZG9ycy5sZW5ndGggJiYgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWU7ICsreCkge1xyXG4gICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2ZW5kb3JzW3hdKydSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcclxuICAgICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSA9IHdpbmRvd1t2ZW5kb3JzW3hdKydDYW5jZWxBbmltYXRpb25GcmFtZSddIHx8IHdpbmRvd1t2ZW5kb3JzW3hdKydDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKVxyXG4gICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrLCBlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJyVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICB2YXIgdGltZVRvQ2FsbCA9IE1hdGgubWF4KDAsIDE2IC0gKGN1cnJUaW1lIC0gbGFzdFRpbWUpKTtcclxuICAgICAgICAgICAgdmFyIGlkID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGNhbGxiYWNrKGN1cnJUaW1lICsgdGltZVRvQ2FsbCk7IH0sIHRpbWVUb0NhbGwpO1xyXG4gICAgICAgICAgICBsYXN0VGltZSA9IGN1cnJUaW1lICsgdGltZVRvQ2FsbDtcclxuICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgICAgfTtcclxuICAgICAgIFxyXG4gICAgICAgIGlmICghd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKVxyXG4gICAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oaWQpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGlkKTtcclxuICAgICAgICAgIH07XHJcbiAgICAgIH0oKSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBhcnJheS5yZW1vdmVJZiAtPiByZW1vdmVzIGl0ZW1zIGZyb20gYXJyYXkgYmFzZSBvbiBhIGZ1bmN0aW9uJ3MgcmVzdWx0XHJcbiAgICAgIEFycmF5LnByb3RvdHlwZS5yZW1vdmVJZiA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICAgICAgdmFyIGkgPSB0aGlzLmxlbmd0aDtcclxuICAgICAgICB3aGlsZSAoaS0tKSB7XHJcbiAgICAgICAgICBpZiAoY2FsbGJhY2sodGhpc1tpXSwgaSkpIHtcclxuICAgICAgICAgICAgdGhpcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9OyAgXG5cbiAgICAgIC8vIElFMTEgZm9yIHN0YXJ0c1dpdGggXG4gICAgICAvLyB0aGFua3MgdG8gQGxpY2h0YW1iZXJnIC0gaHR0cHM6Ly9naXRodWIuY29tL2xpY2h0YW1iZXJnXG4gICAgICBpZiAoIVN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aCkge1xuICAgICAgICBTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGggPSBmdW5jdGlvbihzZWFyY2hTdHJpbmcsIHBvc2l0aW9uKSB7XG4gICAgICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbiB8fCAwO1xuICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4T2Yoc2VhcmNoU3RyaW5nLCBwb3NpdGlvbikgPT09IHBvc2l0aW9uO1xuICAgICAgICB9O1xuICAgICAgfVxyXG4gICAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyBHYWxsZXJ5IGNsaWNrZWQvdG91Y2hlZCAtPiByZXRyaWV2ZSAmIGV4ZWN1dGUgYWN0aW9uXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5Q2xpY2tlZChlKSB7XHJcbiAgICBcclxuICAgICAgdmFyIHIgPSBHYWxsZXJ5RXZlbnRSZXRyaWV2ZUVsZW1lbnRsKGUsIGZhbHNlKTtcclxuXHJcbiAgICAgIGlmKCByLkdPTWlkeCA9PSAtMSApIHsgcmV0dXJuICdleGl0JzsgfVxyXG4gICAgICBcclxuICAgICAgdmFyIGlkeCA9IEcuR09NLml0ZW1zW3IuR09NaWR4XS50aHVtYm5haWxJZHg7XHJcbiAgICAgIGlmKCBHLkdPTS5zbGlkZXIuaG9zdElkeCA9PSByLkdPTWlkeCApIHtcclxuICAgICAgICAvLyBzbGlkZXIgb24gdGh1bWJuYWlsIC0+IG9wZW4gdGhlIGRpc3BsYXllZCBpbWFnZVxyXG4gICAgICAgIGlkeCA9IEcuR09NLml0ZW1zW0cuR09NLnNsaWRlci5jdXJyZW50SWR4XS50aHVtYm5haWxJZHg7XHJcbiAgICAgIH1cclxuICAgICAgc3dpdGNoKCByLmFjdGlvbiApIHtcclxuICAgICAgICBjYXNlICdPUEVOJzpcclxuICAgICAgICAgIFRodW1ibmFpbE9wZW4oaWR4LCBmYWxzZSk7XHJcbiAgICAgICAgICByZXR1cm4gJ2V4aXQnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnRElTUExBWSc6XHJcbiAgICAgICAgICAvLyB1c2VkIHRoZSBkaXNwbGF5IGljb24gKGlnbm9yZSBpZiBzZWxlY3Rpb24gbW9kZSlcclxuICAgICAgICAgIFRodW1ibmFpbE9wZW4oaWR4LCB0cnVlKTtcclxuICAgICAgICAgIHJldHVybiAnZXhpdCc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdUT0dHTEVTRUxFQ1QnOlxyXG4gICAgICAgICAgVGh1bWJuYWlsU2VsZWN0aW9uVG9nZ2xlKGlkeCk7XHJcbiAgICAgICAgICByZXR1cm4gJ2V4aXQnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnU0hBUkUnOlxyXG4gICAgICAgICAgUG9wdXBTaGFyZShpZHgpO1xyXG4gICAgICAgICAgcmV0dXJuICdleGl0JztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ0RPV05MT0FEJzpcclxuICAgICAgICAgIERvd25sb2FkSW1hZ2UoaWR4KTtcclxuICAgICAgICAgIHJldHVybiAnZXhpdCc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdJTkZPJzpcclxuICAgICAgICAgIEl0ZW1EaXNwbGF5SW5mbyhHLklbaWR4XSk7XHJcbiAgICAgICAgICByZXR1cm4gJ2V4aXQnO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnQ0FSVCc6XHJcbiAgICAgICAgICBBZGRUb0NhcnQoaWR4KTtcclxuICAgICAgICAgIHJldHVybiAnZXhpdCc7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgLy8gYWxsIG90aGVyIGFjdGlvbnMgKGN1c3RvbTEuLjEwLCBvciBhbnl0aGluZyBlbHNlKVxyXG4gICAgICAgICAgdmFyIGZ1ID0gRy5PLmZuVGh1bWJuYWlsVG9vbEN1c3RBY3Rpb247XHJcbiAgICAgICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICAgIHR5cGVvZiBmdSA9PSAnZnVuY3Rpb24nID8gZnUoci5hY3Rpb24sIEcuSVtpZHhdKSA6IHdpbmRvd1tmdV0oci5hY3Rpb24sIEcuSVtpZHhdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRG93bmxvYWQgYW4gaW1hZ2VcclxuICAgIGZ1bmN0aW9uIERvd25sb2FkSW1hZ2UoaWR4KSB7XHJcbiAgICAgIGlmKCBHLklbaWR4XS5tZWRpYUtpbmQgIT0gJ2ltZycgKSB7IHJldHVybjsgfVxyXG5cclxuICAgICAgXHJcbiAgICAgIHZhciB1cmwgPSBHLklbaWR4XS5zcmM7XHJcblxyXG4gICAgICBpZiggRy5JW2lkeF0uZG93bmxvYWRVUkwgIT0gdW5kZWZpbmVkICYmIEcuSVtpZHhdLmRvd25sb2FkVVJMICE9ICcnICkge1xyXG4gICAgICAgIHVybCA9IEcuSVtpZHhdLmRvd25sb2FkVVJMO1xyXG4gICAgICB9XHJcbiAgICAgIFxuICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICBhLmhyZWYgPSB1cmw7XG4gICAgICAvLyBhLmRvd25sb2FkID0gdXJsLnNwbGl0KCcuJykucG9wKCk7XHJcbiAgICAgIGEuZG93bmxvYWQgPSB1cmwuc3BsaXQoJy8nKS5wb3AoKTtcclxuICAgICAgYS50YXJnZXQgPSAnX2JsYW5rJztcclxuICAgICAgYS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTtcbiAgICAgIGEuY2xpY2soKTtcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYSk7ICAgICAgXG4gICAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gYWRkIG9uZSBpbWFnZSB0byB0aGUgc2hvcHBpbmcgY2FydFxyXG4gICAgZnVuY3Rpb24gQWRkVG9DYXJ0KCBpZHggKSB7XHJcbiAgICAgIC8vIGluY3JlbWVudCBjb3VudGVyIGlmIGFscmVhZHkgaW4gc2hvcHBpbmcgY2FydFxyXG4gICAgICB2YXIgZm91bmQ9ZmFsc2U7XHJcbiAgICAgIGZvciggdmFyIGk9MDsgaTxHLnNob3BwaW5nQ2FydC5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICBpZiggRy5zaG9wcGluZ0NhcnRbaV0uaWR4ID09IGlkeCApIHtcclxuICAgICAgICAgIEcuc2hvcHBpbmdDYXJ0W2ldLmNudCsrO1xyXG4gICAgICAgICAgdmFyIGZ1ID0gRy5PLmZuU2hvcHBpbmdDYXJ0VXBkYXRlZDtcclxuICAgICAgICAgIGlmKCBmdSAhPT0gbnVsbCApIHtcclxuICAgICAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdShHLnNob3BwaW5nQ2FydCwgRy5JW2lkeF0pIDogd2luZG93W2Z1XShHLnNob3BwaW5nQ2FydCwgRy5JW2lkeF0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgVHJpZ2dlckN1c3RvbUV2ZW50KCdzaG9wcGluZ0NhcnRVcGRhdGVkJyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBhZGQgdG8gc2hvcHBpbmcgY2FydFxyXG4gICAgICBpZiggIWZvdW5kKSB7XHJcbiAgICAgICAgRy5zaG9wcGluZ0NhcnQucHVzaCggeyBpZHg6aWR4LCBJRDpHLklbaWR4XS5HZXRJRCgpLCBjbnQ6MX0gKTtcclxuICAgICAgICB2YXIgZnU9Ry5PLmZuU2hvcHBpbmdDYXJ0VXBkYXRlZDtcclxuICAgICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICB0eXBlb2YgZnUgPT0gJ2Z1bmN0aW9uJyA/IGZ1KEcuc2hvcHBpbmdDYXJ0LCBHLklbaWR4XSkgOiB3aW5kb3dbZnVdKEcuc2hvcHBpbmdDYXJ0LCBHLklbaWR4XSk7XG4gICAgICAgIH1cbiAgICAgICAgVHJpZ2dlckN1c3RvbUV2ZW50KCdzaG9wcGluZ0NhcnRVcGRhdGVkJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG5cclxuICAgIC8vIEFsbCB0aHVtYm5haWxzIGFyZSBzZXQgdG8gdW5zZWxlY3RlZFxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsU2VsZWN0aW9uQ2xlYXIoKSB7XHJcbiAgICAgIEcuR09NLm5iU2VsZWN0ZWQgPSAwO1xyXG4gICAgICBmb3IoIHZhciBpID0gMCwgbmJUbiA9IEcuR09NLml0ZW1zLmxlbmd0aDsgaSA8IG5iVG4gOyBpKysgKSB7XHJcbiAgICAgICAgdmFyIGl0ZW0gPSBHIC5JW0cuR09NLml0ZW1zW2ldLnRodW1ibmFpbElkeF07XHJcbiAgICAgICAgaWYoIGl0ZW0uc2VsZWN0ZWQgKSB7XHJcbiAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICB2YXIgZnUgPSBHLk8uZm5UaHVtYm5haWxTZWxlY3Rpb247XHJcbiAgICAgICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICAgIHR5cGVvZiBmdSA9PSAnZnVuY3Rpb24nID8gZnUoaXRlbS4kZWx0LCBpdGVtLCBHLkkpIDogd2luZG93W2Z1XShpdGVtLiRlbHQsIGl0ZW0sIEcuSSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBUaHVtYm5haWxTZWxlY3Rpb25Ub2dnbGUoIGlkeCApe1xyXG4gICAgICB2YXIgaXRlbSA9IEcuSVtpZHhdO1xyXG4gICAgICBpZiggaXRlbS5zZWxlY3RlZCA9PT0gdHJ1ZSApIHtcclxuICAgICAgICBUaHVtYm5haWxTZWxlY3Rpb25TZXQoaXRlbSwgZmFsc2UpO1xyXG4gICAgICAgIEcuR09NLm5iU2VsZWN0ZWQtLTtcclxuICAgICAgICBUcmlnZ2VyQ3VzdG9tRXZlbnQoJ2l0ZW1VblNlbGVjdGVkJyk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgVGh1bWJuYWlsU2VsZWN0aW9uU2V0KGl0ZW0sIHRydWUpO1xyXG4gICAgICAgIEcuR09NLm5iU2VsZWN0ZWQrKztcclxuICAgICAgICBUcmlnZ2VyQ3VzdG9tRXZlbnQoJ2l0ZW1TZWxlY3RlZCcpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgLy8gdGhpcyByZXBsYWNlcyBUaHVtYm5haWxTZWxlY3Rpb24oKVxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsU2VsZWN0aW9uU2V0KGl0ZW0sIHNlbGVjdGVkICl7XHJcbiAgICAgIFxyXG4gICAgICBpdGVtLnNlbGVjdGVkID0gc2VsZWN0ZWQ7XHJcbiAgICAgIFxyXG4gICAgICBUaHVtYm5haWxTZWxlY3Rpb25TZXRJY29uKCBpdGVtICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBjYWxsZWQgd2hlbiB0aGUgc2VsZWN0aW9uIHN0YXR1cyBvZiBhbiBpdGVtIGNoYW5nZWRcbiAgICAgIHZhciBmdT1HLk8uZm5UaHVtYm5haWxTZWxlY3Rpb247XHJcbiAgICAgIGlmKCBmdSAhPT0gbnVsbCApIHtcclxuICAgICAgICB0eXBlb2YgZnUgPT0gJ2Z1bmN0aW9uJyA/IGZ1KGl0ZW0uJGVsdCwgaXRlbSwgRy5JKSA6IHdpbmRvd1tmdV0oaXRlbS4kZWx0LCBpdGVtLCBHLkkpO1xyXG4gICAgICB9XHJcbiAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVGh1bWJuYWlsU2VsZWN0aW9uU2V0SWNvbiggaXRlbSApIHtcclxuICAgICAgaWYoIGl0ZW0uJGVsdCA9PSBudWxsICkge1xyXG4gICAgICAgIC8vIHRodW1ibmFpbCBpcyBub3QgYnVpbHRcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgLy8gdmFyICRzdWIgPSBpdGVtLiRnZXRFbHQoJy5uR1kyR1RodW1ibmFpbFN1YicpO1xyXG4gICAgICB2YXIgJHN1YiA9IGl0ZW0uJGdldEVsdCgnLm5HWTJHVGh1bWJuYWlsJyk7XHJcbiAgICAgIHZhciAkaWNvbiA9IGl0ZW0uJGdldEVsdCgnLm5HWTJHVGh1bWJuYWlsSWNvbkltYWdlU2VsZWN0Jyk7XHJcbiAgICAgIGlmKCBpdGVtLnNlbGVjdGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgJHN1Yi5hZGRDbGFzcygnbkdZMkdUaHVtYm5haWxTdWJTZWxlY3RlZCcpO1xyXG4gICAgICAgICRpY29uLmFkZENsYXNzKCduR1kyVGh1bWJuYWlsU2VsZWN0ZWQnKTtcclxuICAgICAgICAkaWNvbi5yZW1vdmVDbGFzcygnbkdZMlRodW1ibmFpbFVuc2VsZWN0ZWQnKTtcclxuICAgICAgICAkaWNvbi5odG1sKEcuTy5pY29ucy50aHVtYm5haWxTZWxlY3RlZCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgJHN1Yi5yZW1vdmVDbGFzcygnbkdZMkdUaHVtYm5haWxTdWJTZWxlY3RlZCcpO1xyXG4gICAgICAgICRpY29uLnJlbW92ZUNsYXNzKCduR1kyVGh1bWJuYWlsU2VsZWN0ZWQnKTtcclxuICAgICAgICAkaWNvbi5hZGRDbGFzcygnbkdZMlRodW1ibmFpbFVuc2VsZWN0ZWQnKTtcclxuICAgICAgICAkaWNvbi5odG1sKEcuTy5pY29ucy50aHVtYm5haWxVbnNlbGVjdGVkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIC8vIGRpc3BsYXkgYSBtb2RhbCBwb3B1cCBmb3Igc2hhcmluZyBpbWFnZS9hbGJ1bVxyXG4gICAgZnVuY3Rpb24gUG9wdXBTaGFyZShpZHgpIHtcclxuICAgIFxyXG4gICAgICAvLyBTRUUgU0FNUExFUzogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vY2hyaXNqbGVlLzUxOTYxMzlcclxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL0p1bGllbmgvU2hhcnJyZVxyXG4gICAgXHJcbiAgICAgIHZhciBpdGVtPUcuSVtpZHhdO1xyXG5cclxuICAgICAgdmFyIGN1cnJlbnRVUkw9ZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgZG9jdW1lbnQubG9jYXRpb24uaG9zdG5hbWUgKyBkb2N1bWVudC5sb2NhdGlvbi5wYXRobmFtZTtcclxuICAgICAgdmFyIG5ld0xvY2F0aW9uSGFzaCA9ICcjbmFub2dhbGxlcnkvJyArIEcuYmFzZUVsdElEICsgJy8nO1xyXG4gICAgICBpZiggaXRlbS5raW5kID09ICdpbWFnZScgKSB7XHJcbiAgICAgICAgbmV3TG9jYXRpb25IYXNoICs9IGl0ZW0uYWxidW1JRCArICcvJyArIGl0ZW0uR2V0SUQoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBuZXdMb2NhdGlvbkhhc2ggKz0gaXRlbS5HZXRJRCgpO1xyXG4gICAgICB9XHJcbiAgICBcclxuICAgICAgdmFyIGNvbnRlbnQgPSAnJztcclxuICAgICAgY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1cIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiIGRhdGEtc2hhcmU9XCJmYWNlYm9va1wiPicgICArIEcuTy5pY29ucy5zaGFyZUZhY2Vib29rICsgICAnPC9kaXY+JztcclxuICAgICAgY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1cIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiIGRhdGEtc2hhcmU9XCJwaW50ZXJlc3RcIj4nICArIEcuTy5pY29ucy5zaGFyZVBpbnRlcmVzdCArICAnPC9kaXY+JztcclxuICAgICAgY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1cIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiIGRhdGEtc2hhcmU9XCJ0dW1ibHJcIj4nICAgICArIEcuTy5pY29ucy5zaGFyZVR1bWJsciArICAgICAnPC9kaXY+JztcclxuICAgICAgY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1cIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiIGRhdGEtc2hhcmU9XCJ0d2l0dGVyXCI+JyAgICArIEcuTy5pY29ucy5zaGFyZVR3aXR0ZXIgKyAgICAnPC9kaXY+JztcclxuICAgICAgLy8gY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1cIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiIGRhdGEtc2hhcmU9XCJnb29nbGVwbHVzXCI+JyArIEcuTy5pY29ucy5zaGFyZUdvb2dsZVBsdXMgKyAnPC9kaXY+JztcclxuICAgICAgY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1cIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiIGRhdGEtc2hhcmU9XCJ2a1wiPicgICAgICAgICArIEcuTy5pY29ucy5zaGFyZVZLICsgICAgICAgICAnPC9kaXY+JztcclxuICAgICAgY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1cIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiIGRhdGEtc2hhcmU9XCJtYWlsXCI+JyAgICAgICArIEcuTy5pY29ucy5zaGFyZU1haWwgKyAgICAgICAnPC9kaXY+JztcclxuICAgICAgY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1cIiBzdHlsZT1cInRleHQtYWxpZ246Y2VudGVyO1wiPjwvZGl2Pic7XHJcbiAgICAgIGNvbnRlbnQgKz0gJzxpbnB1dCBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1UZXh0XCIgcmVhZG9ubHkgdHlwZT1cInRleHRcIiB2YWx1ZT1cIicgKyBjdXJyZW50VVJMK25ld0xvY2F0aW9uSGFzaCArICdcIiBzdHlsZT1cIndpZHRoOjEwMCU7dGV4dC1hbGlnbjpjZW50ZXI7XCI+JztcclxuICAgICAgY29udGVudCArPSAnPGJyPic7XHJcblxyXG4gICAgICBjdXJyZW50VVJMID0gZW5jb2RlVVJJQ29tcG9uZW50KGRvY3VtZW50LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIGRvY3VtZW50LmxvY2F0aW9uLmhvc3RuYW1lICsgZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUgKyBuZXdMb2NhdGlvbkhhc2gpO1xyXG5cclxuICAgICAgdmFyIGN1cnJlbnRUaXRsZSA9IGl0ZW0udGl0bGU7XHJcbiAgICAgIHZhciBjdXJyZW50VG4gPSBpdGVtLnRodW1iSW1nKCkuc3JjO1xyXG4gICAgICBcclxuICAgICAgXHJcbiAgICAgIFBvcHVwKCdTaGFyZSB0bzonLCBjb250ZW50LCAnQ2VudGVyJyk7XHJcbiAgICAgIFxyXG4gICAgICBHLnBvcHVwLiRlbHQuZmluZCgnLm5HWTJQb3B1cE9uZUl0ZW0nKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICBcclxuICAgICAgICB2YXIgc2hhcmVVUkwgPSAnJztcclxuICAgICAgICB2YXIgZm91bmQgPSB0cnVlO1xyXG4gICAgICAgIHN3aXRjaChqUXVlcnkodGhpcykuYXR0cignZGF0YS1zaGFyZScpLnRvVXBwZXJDYXNlKCkpIHtcclxuICAgICAgICAgIGNhc2UgJ0ZBQ0VCT09LJzpcclxuICAgICAgICAgICAgLy8gPGEgbmFtZT1cImZiX3NoYXJlXCIgdHlwZT1cImJ1dHRvblwiIGhyZWY9XCJodHRwOi8vd3d3LmZhY2Vib29rLmNvbS9zaGFyZXIucGhwP3U9eyR1cmx9Jm1lZGlhPXskaW1nUGF0aH0mZGVzY3JpcHRpb249eyRkZXNjfVwiIGNsYXNzPVwiam9pbkZCXCI+U2hhcmUgWW91ciBBZHZlcnRpc2U8L2E+XHJcbiAgICAgICAgICAgIC8vd2luZG93Lm9wZW4oXCJodHRwczovL3d3dy5mYWNlYm9vay5jb20vc2hhcmVyLnBocD91PVwiK2N1cnJlbnRVUkwsXCJcIixcImhlaWdodD0zNjgsd2lkdGg9NjAwLGxlZnQ9MTAwLHRvcD0xMDAsbWVudWJhcj0wXCIpO1xyXG4gICAgICAgICAgICBzaGFyZVVSTCA9ICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vc2hhcmVyLnBocD91PScgKyBjdXJyZW50VVJMO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ1ZLJzpcclxuICAgICAgICAgICAgc2hhcmVVUkwgPSAnaHR0cDovL3ZrLmNvbS9zaGFyZS5waHA/dXJsPScgKyBjdXJyZW50VVJMO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ0dPT0dMRVBMVVMnOlxyXG4gICAgICAgICAgICBzaGFyZVVSTCA9IFwiaHR0cHM6Ly9wbHVzLmdvb2dsZS5jb20vc2hhcmU/dXJsPVwiICsgY3VycmVudFVSTDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICBjYXNlICdUV0lUVEVSJzpcclxuICAgICAgICAgICAgLy8gc2hhcmVVUkw9XCJodHRwczovL3R3aXR0ZXIuY29tL3NoYXJlP3VybD1cIitjdXJyZW50VVJMK1wiJnRleHQ9XCIrY3VycmVudFRpdGxlO1xyXG4gICAgICAgICAgICBzaGFyZVVSTCA9ICdodHRwczovL3R3aXR0ZXIuY29tL2ludGVudC90d2VldD90ZXh0PScgKyBjdXJyZW50VGl0bGUgKyAndXJsPScgKyBjdXJyZW50VVJMO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ1BJTlRFUkVTVCc6XHJcbiAgICAgICAgICAgIC8vIHNoYXJlVVJMPSdodHRwczovL3BpbnRlcmVzdC5jb20vcGluL2NyZWF0ZS9ib29rbWFya2xldC8/bWVkaWE9JytjdXJyZW50VG4rJyZ1cmw9JytjdXJyZW50VVJMKycmZGVzY3JpcHRpb249JytjdXJyZW50VGl0bGU7XHJcbiAgICAgICAgICAgIHNoYXJlVVJMID0gJ2h0dHBzOi8vcGludGVyZXN0LmNvbS9waW4vY3JlYXRlL2J1dHRvbi8/bWVkaWE9JyArIGN1cnJlbnRUbiArICcmdXJsPScgKyBjdXJyZW50VVJMICsgJyZkZXNjcmlwdGlvbj0nICsgY3VycmVudFRpdGxlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGNhc2UgJ1RVTUJMUic6XHJcbiAgICAgICAgICAgIC8vc2hhcmVVUkw9J2h0dHBzOi8vd3d3LnR1bWJsci5jb20vd2lkZ2V0cy9zaGFyZS90b29sL3ByZXZpZXc/Y2FwdGlvbj08c3Ryb25nPicrY3VycmVudFRpdGxlKyc8L3N0cm9uZz4mdGFncz1uYW5vZ2FsbGVyeTImdXJsPScrY3VycmVudFVSTCsnJnNoYXJlU291cmNlPWxlZ2FjeSZwb3N0dHlwZT1waG90byZjb250ZW50PScrY3VycmVudFRuKycmY2xpY2t0aHJvdWdoVXJsPScrY3VycmVudFVSTDtcclxuICAgICAgICAgICAgc2hhcmVVUkwgPSAnaHR0cDovL3d3dy50dW1ibHIuY29tL3NoYXJlL2xpbms/dXJsPScgKyBjdXJyZW50VVJMICsgJyZuYW1lPScgKyBjdXJyZW50VGl0bGU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAnTUFJTCc6XHJcbiAgICAgICAgICAgIHNoYXJlVVJMID0gJ21haWx0bzo/c3ViamVjdD0nICsgY3VycmVudFRpdGxlICsgJyZib2R5PScgKyBjdXJyZW50VVJMO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBpZiggZm91bmQgKSB7XHJcbiAgICAgICAgICB3aW5kb3cub3BlbihzaGFyZVVSTCwgXCJcIiAsIFwiaGVpZ2h0PTU1MCx3aWR0aD01MDAsbGVmdD0xMDAsdG9wPTEwMCxtZW51YmFyPTBcIiApO1xyXG4gICAgICAgICAgRy5wb3B1cC5jbG9zZSgpO1xyXG4gICAgICAgICAgLy8gJHBvcHVwLnJlbW92ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIGJ1aWxkIGEgbW9kYWwgcG9wdXBcclxuICAgIGZ1bmN0aW9uIFBvcHVwKHRpdGxlLCBjb250ZW50LCBhbGlnbikge1xyXG4gICAgICB2YXIgcHAgPSAgJzxkaXYgY2xhc3M9XCJuR1kyUG9wdXBcIiBzdHlsZT1cIm9wYWNpdHk6MDtcIj48ZGl2IGNsYXNzPVwibkdZMlBvcHVwQ29udGVudCcgKyBhbGlnbiArICdcIj4nO1xyXG4gICAgICBwcCAgICArPSAgJzxkaXYgY2xhc3M9XCJuR1kyUG9wdXBDbG9zZUJ1dHRvblwiPicgKyBHLk8uaWNvbnMuYnV0dG9uQ2xvc2UgKyAnPC9kaXY+JztcclxuICAgICAgcHAgICAgKz0gICc8ZGl2IGNsYXNzPVwibkdZMlBvcHVwVGl0bGVcIj4nICsgdGl0bGUgKyAnPC9kaXY+JztcclxuICAgICAgcHAgICAgKz0gIGNvbnRlbnQ7XHJcbiAgICAgIHBwICAgICs9ICAnPC9kaXY+PC9kaXY+JztcclxuICAgICAgXHJcbiAgICAgIEcucG9wdXAuJGVsdCA9IGpRdWVyeShwcCkuYXBwZW5kVG8oJ2JvZHknKTtcclxuICAgICAgc2V0RWxlbWVudE9uVG9wKCBHLlZPTS4kdmlld2VyLCBHLnBvcHVwLiRlbHQpO1xyXG4gICAgICBcclxuICAgICAgRy5wb3B1cC5pc0Rpc3BsYXllZCA9IHRydWU7XHJcbiAgICAgIFxyXG4gICAgICB2YXIgdHdlZW5hYmxlID0gbmV3IE5HVHdlZW5hYmxlKCk7XHJcbiAgICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAgICAgICAgZnJvbTogICAgICAgeyBvcGFjaXR5OiAwIH0sXHJcbiAgICAgICAgdG86ICAgICAgICAgeyBvcGFjaXR5OiAxIH0sXHJcbiAgICAgICAgZWFzaW5nOiAgICAgJ2Vhc2VJbk91dFNpbmUnLFxyXG4gICAgICAgIGR1cmF0aW9uOiAgIDI1MCxcclxuICAgICAgICBzdGVwOiAgICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgRy5wb3B1cC4kZWx0LmNzcyggc3RhdGUgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgRy5wb3B1cC4kZWx0LmZpbmQoJy5uR1kyUG9wdXBDbG9zZUJ1dHRvbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIEcucG9wdXAuY2xvc2UoKTtcclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgfVxyXG5cclxuXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5TW91c2VFbnRlcihlKSB7XHJcbiAgICAgIGlmKCAhRy5WT00udmlld2VyRGlzcGxheWVkICYmIEcuR09NLmFsYnVtSWR4ICE9IC0xICkge1xyXG4gICAgICAgIHZhciByID0gR2FsbGVyeUV2ZW50UmV0cmlldmVFbGVtZW50bChlLCB0cnVlKTtcclxuICAgICAgICAvLyBpZiggci5hY3Rpb24gPT0gJ09QRU4nICYmIHIuR09NaWR4ICE9IC0xICkge1xyXG4gICAgICAgIGlmKCByLkdPTWlkeCAhPSAtMSApIHtcclxuICAgICAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQ7XHJcbiAgICAgICAgICAvLyBpZiggdGFyZ2V0LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSAhPSAnbkdZMkdUaHVtYm5haWwnICkgeyByZXR1cm47IH1cclxuICAgICAgICAgIFRodW1ibmFpbEhvdmVyKHIuR09NaWR4KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gR2FsbGVyeU1vdXNlTGVhdmUoZSkge1xyXG4gICAgICBpZiggIUcuVk9NLnZpZXdlckRpc3BsYXllZCAmJiBHLkdPTS5hbGJ1bUlkeCAhPSAtMSApIHtcclxuICAgICAgICB2YXIgciA9IEdhbGxlcnlFdmVudFJldHJpZXZlRWxlbWVudGwoZSwgdHJ1ZSk7XHJcbiAgICAgICAgaWYoIHIuR09NaWR4ICE9IC0xICkge1xyXG4gICAgICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDtcclxuICAgICAgICAgIC8vIGlmKCB0YXJnZXQuZ2V0QXR0cmlidXRlKCdjbGFzcycpICE9ICduR1kyR1RodW1ibmFpbCcgKSB7IHJldHVybjsgfVxyXG4gICAgICAgICAgVGh1bWJuYWlsSG92ZXJPdXQoci5HT01pZHgpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5RXZlbnRSZXRyaWV2ZUVsZW1lbnRsKCBlLCBpZ25vcmVTdWJJdGVtcyApIHtcclxuICAgICAgdmFyIHIgPSB7IGFjdGlvbjogJ05PTkUnLCBHT01pZHg6IC0xIH07XHJcbiAgICAgIFxyXG4gICAgICBpZiggZSA9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgcmV0dXJuIHI7XHJcbiAgICAgIH1cclxuICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDtcclxuICAgICAgd2hpbGUoIHRhcmdldCAhPSBHLiRFLmNvblRuUGFyZW50WzBdICkgeyAgICAgICAvLyBsb29wIGVsZW1lbnQgcGFyZW50IHVwIHRvIGZpbmQgdGhlIHRodW1ibmFpbCBlbGVtZW50XHJcbiAgICAgICAgaWYoIGpRdWVyeSh0YXJnZXQpLmhhc0NsYXNzKCduR1kyR1RodW1ibmFpbCcpICkge1xyXG4gICAgICAgICAgaWYoIHIuYWN0aW9uID09ICdOT05FJyApIHtcclxuICAgICAgICAgICAgci5hY3Rpb24gPSAnT1BFTic7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByLkdPTWlkeCA9IGpRdWVyeSh0YXJnZXQpLmRhdGEoJ2luZGV4Jyk7XHJcbiAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgLy8gaWYoICFpZ25vcmVTdWJJdGVtcyAmJiBqUXVlcnkodGFyZ2V0KS5oYXNDbGFzcygnbkdZMkdUaHVtYm5haWxJY29uJykgKSB7XHJcbiAgICAgICAgaWYoICFpZ25vcmVTdWJJdGVtcyApIHtcclxuICAgICAgICAgIHZhciBhID0galF1ZXJ5KHRhcmdldCkuZGF0YSgnbmd5MmFjdGlvbicpO1xyXG4gICAgICAgICAgaWYoIGEgIT0gJycgJiYgYSAhPSB1bmRlZmluZWQgKSB7XHJcbiAgICAgICAgICAgIHIuYWN0aW9uID0gYTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIHRhcmdldC5wYXJlbnROb2RlID09IG51bGwgKSB7XHJcbiAgICAgICAgICByZXR1cm4gcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHI7XHJcbiAgICB9XHJcbiAgICBcclxuXHJcbiAgICAvLyBPcGVuIG9uZSB0aHVtYm5haWxcclxuICAgIGZ1bmN0aW9uIFRodW1ibmFpbE9wZW4oIGlkeCwgaWdub3JlU2VsZWN0ZWQgKSB7XHJcbiAgICAgIHZhciBpdGVtID0gRy5JW2lkeF07XHJcblxyXG4gICAgICB2YXIgZnUgPSBHLk8uZm5UaHVtYm5haWxDbGlja2VkO1xyXG4gICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdShpdGVtLiRlbHQsIGl0ZW0pIDogd2luZG93W2Z1XShpdGVtLiRlbHQsIGl0ZW0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBvcGVuIFVSTFxyXG4gICAgICBpZiggaXRlbS5kZXN0aW5hdGlvblVSTCAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGVzdGluYXRpb25VUkwubGVuZ3RoID4gMCApIHtcclxuICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBpdGVtLmRlc3RpbmF0aW9uVVJMO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgc3dpdGNoKCBpdGVtLmtpbmQgKSB7XHJcbiAgICAgICAgY2FzZSAnaW1hZ2UnOlxyXG4gICAgICAgICAgaWYoIGlnbm9yZVNlbGVjdGVkID09PSBmYWxzZSAmJiBHLkdPTS5uYlNlbGVjdGVkID4gMCApIHtcclxuICAgICAgICAgICAgVGh1bWJuYWlsU2VsZWN0aW9uVG9nZ2xlKGlkeCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gZGlzcGxheSBpbWFnZVxyXG4gICAgICAgICAgICBEaXNwbGF5UGhvdG9JZHgoaWR4KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2FsYnVtJzpcclxuICAgICAgICAgIGlmKCBpZ25vcmVTZWxlY3RlZCA9PT0gZmFsc2UgJiYgRy5HT00ubmJTZWxlY3RlZCA+IDAgKSB7XHJcbiAgICAgICAgICAgIFRodW1ibmFpbFNlbGVjdGlvblRvZ2dsZShpZHgpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmKCBHLk8udGh1bWJuYWlsQWxidW1EaXNwbGF5SW1hZ2UgJiYgaWR4ICE9IDAgKSB7XHJcbiAgICAgICAgICAgICAgLy8gZGlzcGxheSBhbGJ1bSBjb250ZW50IGluIGxpZ2h0Ym94XHJcbiAgICAgICAgICAgICAgRGlzcGxheUZpcnN0TWVkaWFJbkFsYnVtKGlkeCk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIC8vIGRpc3BsYXkgYWxidW0gY29udGVudCBpbiBnYWxsZXJ5XHJcbiAgICAgICAgICAgICAgRGlzcGxheUFsYnVtKCctMScsIGl0ZW0uR2V0SUQoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2FsYnVtVXAnOlxyXG4gICAgICAgICAgdmFyIHBhcmVudCA9IE5HWTJJdGVtLkdldChHLCBpdGVtLmFsYnVtSUQpO1xyXG4gICAgICAgICAgRGlzcGxheUFsYnVtKCctMScsIHBhcmVudC5hbGJ1bUlEKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIERpc3BsYXlGaXJzdE1lZGlhSW5BbGJ1bSggYWxidW1JZHggKSB7XHJcbiAgICAgIGlmKCBHLk8uZGVidWdNb2RlICkgeyBjb25zb2xlLmxvZygnI0Rpc3BsYXlGaXJzdFBob3RvSW5BbGJ1bSA6ICcrICBhbGJ1bUlkeCk7IH1cclxuXHJcbiAgICAgIHZhciBpdGVtID0gRy5JW2FsYnVtSWR4XTtcclxuICAgICAgXHJcbiAgICAgIHZhciBsID0gRy5JLmxlbmd0aDtcclxuICAgICAgZm9yKCB2YXIgaSA9IDA7IGkgPCBsOyBpKysgKSB7XHJcbiAgICAgICAgaWYoIEcuSVtpXS5hbGJ1bUlEID09IGl0ZW0uR2V0SUQoKSApIHtcclxuICAgICAgICAgIERpc3BsYXlQaG90b0lkeCggaSApO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gbG9hZCBhbGJ1bSBjb250ZW50XHJcbiAgICAgIEFsYnVtR2V0Q29udGVudCggaXRlbS5HZXRJRCgpLCBEaXNwbGF5Rmlyc3RNZWRpYUluQWxidW0sIGFsYnVtSWR4LCBudWxsICk7XHJcbiAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcblxyXG4gICAgLy8gT3BlbiBsaW5rIHRvIG9yaWdpbmFsIGltYWdlIChuZXcgd2luZG93KVxyXG4gICAgZnVuY3Rpb24gT3Blbk9yaWdpbmFsKCBpdGVtICkge1xyXG4gICAgICBzd2l0Y2goIEcuTy5raW5kICkge1xyXG4gICAgICAgIGNhc2UgJ2ZsaWNrcic6XHJcbiAgICAgICAgICB2YXIgc1UgPSAnaHR0cHM6Ly93d3cuZmxpY2tyLmNvbS9waG90b3MvJyArIEcuTy51c2VySUQgKyAnLycgKyBpdGVtLkdldElEKCk7XHJcbiAgICAgICAgICBpZiggaXRlbS5hbGJ1bUlEICE9ICcwJyApIHtcclxuICAgICAgICAgICAgc1UgKz0gJy9pbi9hbGJ1bS0nICsgaXRlbS5hbGJ1bUlEICsgJy8nO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgd2luZG93Lm9wZW4oc1UsICdfYmxhbmsnKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3BpY2FzYSc6XHJcbiAgICAgICAgY2FzZSAnZ29vZ2xlJzpcclxuICAgICAgICBjYXNlICdnb29nbGUyJzpcclxuICAgICAgICAgIC8vIG5vIG1vcmUgd29ya2luZyBzaW5jZSBHb29nbGUgY2hhbmdlZCB0aGUgYWNjZXNzIHRvIEdvb2dsZSBQaG90b3MgaW4gMjAxN1xyXG4gICAgICAgICAgLy8gdmFyIHNVPSdodHRwczovL3BsdXMuZ29vZ2xlLmNvbS9waG90b3MvJytHLk8udXNlcklEKycvYWxidW1zLycraXRlbS5hbGJ1bUlEKycvJytpdGVtLkdldElEKCk7XHJcbiAgICAgICAgICAvLyB3aW5kb3cub3BlbihzVSwnX2JsYW5rJyk7XHJcbiAgICAgICAgICAvLyBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgdmFyIHNVID0gaXRlbS5yZXNwb25zaXZlVVJMKCk7XHJcbiAgICAgICAgICB3aW5kb3cub3BlbihzVSwgJ19ibGFuaycpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gRGlzcGxheSBvbmUgcGhvdG8gKHdpdGggaW50ZXJuYWwgb3IgZXh0ZXJuYWwgdmlld2VyKVxyXG4gICAgZnVuY3Rpb24gRGlzcGxheVBob3RvSWR4KCBuZ3kySXRlbUlkeCApIHtcclxuXHJcbiAgICAgIGlmKCAhRy5PLnRodW1ibmFpbE9wZW5JbWFnZSApIHsgcmV0dXJuOyB9XHJcblxyXG4gICAgICBpZiggRy5PLnRodW1ibmFpbE9wZW5PcmlnaW5hbCApIHtcclxuICAgICAgICAvLyBPcGVuIGxpbmsgdG8gb3JpZ2luYWwgaW1hZ2VcclxuICAgICAgICBPcGVuT3JpZ2luYWwoIEcuSVtuZ3kySXRlbUlkeF0gKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgdmFyIGl0ZW1zID0gW107XHJcbiAgICAgIEcuVk9NLmN1cnJJdGVtSWR4ID0gMDtcclxuICAgICAgRy5WT00uaXRlbXMgPSBbXTtcclxuICAgICAgRy5WT00uYWxidW1JRCA9IEcuSVtuZ3kySXRlbUlkeF0uYWxidW1JRDtcclxuICAgICAgXHJcbiAgICAgIHZhciB2aW1nID0gbmV3IFZJbWcobmd5Mkl0ZW1JZHgpO1xyXG4gICAgICBHLlZPTS5pdGVtcy5wdXNoKHZpbWcpO1xyXG4gICAgICBpdGVtcy5wdXNoKEcuSVtuZ3kySXRlbUlkeF0pO1xyXG4gICAgICAvL1RPRE8gLT4gZGFuZ2VyPyAtPiBwb3VycXVvaSByZWNvbnN0cnVpcmUgbGEgbGlzdGUgc2kgZO+/vWrvv70gb3V2ZXJ0IChiYWNrL2ZvcndhcmQpICAgICBcclxuICAgICAgdmFyIGwgPSBHLkkubGVuZ3RoO1xyXG4gICAgICBmb3IoIHZhciBpZHggPSBuZ3kySXRlbUlkeCsxOyBpZHggPCBsIDsgaWR4KyspIHtcclxuICAgICAgICB2YXIgaXRlbSA9IEcuSVtpZHhdO1xyXG4gICAgICAgIGlmKCBpdGVtLmtpbmQgPT0gJ2ltYWdlJyAmJiBpdGVtLmlzVG9EaXNwbGF5KEcuVk9NLmFsYnVtSUQpICYmIGl0ZW0uZGVzdGluYXRpb25VUkwgPT0gJycgKSB7XHJcbiAgICAgICAgICB2YXIgdmltZyA9IG5ldyBWSW1nKGlkeCk7XHJcbiAgICAgICAgICBHLlZPTS5pdGVtcy5wdXNoKHZpbWcpO1xyXG4gICAgICAgICAgaXRlbXMucHVzaChpdGVtKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgdmFyIGxhc3QgPSBHLlZPTS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgIHZhciBjbnQgPSAxO1xyXG4gICAgICBmb3IoIHZhciBpZHggPSAwOyBpZHggPCBuZ3kySXRlbUlkeCA7IGlkeCsrKSB7XHJcbiAgICAgICAgdmFyIGl0ZW0gPSBHLklbaWR4XTtcclxuICAgICAgICBpZiggaXRlbS5raW5kID09ICdpbWFnZScgJiYgaXRlbS5pc1RvRGlzcGxheShHLlZPTS5hbGJ1bUlEKSAmJiBpdGVtLmRlc3RpbmF0aW9uVVJMID09ICcnICkge1xyXG4gICAgICAgICAgdmFyIHZpbWcgPSBuZXcgVkltZyhpZHgpO1xyXG4gICAgICAgICAgdmltZy5tZWRpYU51bWJlciA9IGNudDtcclxuICAgICAgICAgIEcuVk9NLml0ZW1zLnB1c2godmltZyk7XHJcbiAgICAgICAgICBpdGVtcy5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgY250Kys7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGZvciggdmFyIGkgPSAwOyBpIDwgbGFzdDsgaSsrICkge1xyXG4gICAgICAgIEcuVk9NLml0ZW1zW2ldLm1lZGlhTnVtYmVyID0gY250O1xyXG4gICAgICAgIGNudCsrO1xyXG4gICAgICB9XHJcbiAgICBcclxuICAgICAgLy8gb3BlbnMgbWVkaWEgd2l0aCBleHRlcm5hbCB2aWV3ZXJcbiAgICAgIHZhciBmdSA9IEcuTy5mblRodW1ibmFpbE9wZW47XHJcbiAgICAgIGlmKCBmdSAhPT0gbnVsbCApIHtcclxuICAgICAgICB0eXBlb2YgZnUgPT0gJ2Z1bmN0aW9uJyA/IGZ1KGl0ZW1zKSA6IHdpbmRvd1tmdV0oaXRlbXMpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIC8vIHVzZSBpbnRlcm5hbCB2aWV3ZXJcclxuICAgICAgaWYoICFHLlZPTS52aWV3ZXJEaXNwbGF5ZWQgKSB7XHJcbiAgICAgICAgLy8gYnVpbGQgdmlld2VyIGFuZCBkaXNwbGF5XHJcbiAgICAgICAgT3BlbkludGVybmFsVmlld2VyKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgLy8gdmlld2VyIGFscmVhZHkgZGlzcGxheWVkIC0+IGRpc3BsYXkgbmV3IG1lZGlhIGluIGN1cnJlbnQgdmlld2VyXHJcbiAgICAgICAgRy5WT00uJG1lZGlhQ3VycmVudC5lbXB0eSgpO1xyXG4gICAgICAgIHZhciBpdGVtID0gRy5WT00uTkdZMkl0ZW0oMCk7XHJcbiAgICAgICAgdmFyIHNwcmVsb2FkZXIgPSAnPGRpdiBjbGFzcz1cIm5HWTJWaWV3ZXJNZWRpYUxvYWRlckRpc3BsYXllZFwiPjwvZGl2Pic7XHJcbiAgICAgICAgaWYoIGl0ZW0ubWVkaWFLaW5kID09ICdpbWcnICYmIGl0ZW0uaW1hZ2VXaWR0aCAhPSAwICYmIGl0ZW0uaW1hZ2VIZWlnaHQgIT0gMCApIHtcclxuICAgICAgICAgIHNwcmVsb2FkZXIgPSAnPGRpdiBjbGFzcz1cIm5HWTJWaWV3ZXJNZWRpYUxvYWRlckhpZGRlblwiPjwvZGl2Pic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEcuVk9NLiRtZWRpYUN1cnJlbnQuYXBwZW5kKCBzcHJlbG9hZGVyICsgaXRlbS5tZWRpYU1hcmt1cCk7XHJcbiAgICAgICAgVmlld2VyU2V0TWVkaWFWaXNpYmlsaXR5KEcuVk9NLk5HWTJJdGVtKDEpLCBHLlZPTS4kbWVkaWFOZXh0LCAwKTtcclxuICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoRy5WT00uTkdZMkl0ZW0oLTEpLCBHLlZPTS4kbWVkaWFQcmV2aW91cywgMCk7XHJcbiAgICAgICAgaWYoIGl0ZW0ubWVkaWFLaW5kID09ICdpbWcnICkge1xyXG4gICAgICAgICAgRy5WT00uSW1hZ2VMb2FkZXIubG9hZEltYWdlKFZpZXdlSW1nU2l6ZVJldHJpZXZlZCwgaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEcuVk9NLiRtZWRpYUN1cnJlbnQuY3NzKHsgb3BhY2l0eTowIH0pLmF0dHIoJ3NyYycsJycpO1xyXG4gICAgICAgIC8vIEcuVk9NLkltYWdlTG9hZGVyLmxvYWRJbWFnZShWaWV3ZUltZ1NpemVSZXRyaWV2ZWQsIEcuVk9NLk5HWTJJdGVtKDApKTtcclxuICAgICAgICAvLyBHLlZPTS4kbWVkaWFDdXJyZW50LmNoaWxkcmVuKCkuZXEoMCkuYXR0cignc3JjJyxHLmVtcHR5R2lmKS5hdHRyKCdzcmMnLCBHLlZPTS5OR1kySXRlbSgwKS5yZXNwb25zaXZlVVJMKCkpO1xyXG4gICAgICAgIERpc3BsYXlJbnRlcm5hbFZpZXdlcigwLCAnJyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVmlld2VyWm9vbVN0YXJ0KCkge1xyXG4gICAgICBpZiggRy5PLnZpZXdlclpvb20gJiYgIUcuVk9NLnZpZXdlck1lZGlhSXNDaGFuZ2VkICkge1xyXG4gICAgICAgIHZhciBpdGVtPUcuVk9NLk5HWTJJdGVtKDApO1xyXG4gICAgICAgIGlmKCBpdGVtLmltYWdlSGVpZ2h0ID4gMCAmJiBpdGVtLmltYWdlV2lkdGggPiAwICkge1xyXG4gICAgICAgICAgaWYoIEcuVk9NLnpvb20uaXNab29taW5nID09PSBmYWxzZSApIHtcclxuICAgICAgICAgICAgLy8gZGVmYXVsdCB6b29tXHJcbiAgICAgICAgICAgIEcuVk9NLnpvb20udXNlckZhY3RvciA9IDE7XHJcbiAgICAgICAgICAgIEcuVk9NLnpvb20uaXNab29taW5nID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgICAgICAgXHJcbiAgICBmdW5jdGlvbiBWaWV3ZXJab29tSW4oIHpvb21JbiApIHtcclxuICAgIGlmKCB6b29tSW4gKSB7XHJcbiAgICAgICAgLy8gem9vbSBpblxyXG4gICAgICAgIEcuVk9NLnpvb20udXNlckZhY3Rvcis9MC4xO1xyXG4gICAgICAgIFZpZXdlclpvb21NYXgoKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyB6b29tIG91dFxyXG4gICAgICAgIEcuVk9NLnpvb20udXNlckZhY3Rvci09MC4xO1xyXG4gICAgICAgIFZpZXdlclpvb21NaW4oKTtcclxuICAgICAgfVxyXG4gICAgICBWaWV3ZXJNZWRpYVNldFBvc0FuZFpvb20oKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVmlld2VyWm9vbU1heCgpIHtcclxuICAgICAgaWYoIEcuVk9NLnpvb20udXNlckZhY3RvciA+IDMgKSB7XHJcbiAgICAgICAgRy5WT00uem9vbS51c2VyRmFjdG9yID0gMztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gVmlld2VyWm9vbU1pbigpIHtcbiAgICBcclxuICAgICAgaWYoIEcuVk9NLnpvb20udXNlckZhY3RvciA8IDAuMiApIHtcclxuICAgICAgICBHLlZPTS56b29tLnVzZXJGYWN0b3IgPSAwLjI7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICBcclxuICAgIC8vIFNldCBwb3NpdGlvbiBhbmQgc2l6ZSBvZiBhbGwgMyBtZWRpYSBjb250YWluZXJzXHJcbiAgICBmdW5jdGlvbiBWaWV3ZXJNZWRpYVNldFBvc0FuZFpvb20oKSB7XHJcbiAgICBcclxuICAgICAgaWYoICFHLlZPTS56b29tLmlzWm9vbWluZyApIHtcclxuICAgICAgICBHLlZPTS56b29tLnVzZXJGYWN0b3IgPSAxO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICBWaWV3ZXJNZWRpYVNldFBvc0FuZFpvb21PbmUoIEcuVk9NLk5HWTJJdGVtKDApLCBHLlZPTS4kbWVkaWFDdXJyZW50LCB0cnVlICk7XHJcbiAgICAgICAgVmlld2VyTWVkaWFTZXRQb3NBbmRab29tT25lKCBHLlZPTS5OR1kySXRlbSgtMSksIEcuVk9NLiRtZWRpYVByZXZpb3VzLCBmYWxzZSApO1xyXG4gICAgICAgIFZpZXdlck1lZGlhU2V0UG9zQW5kWm9vbU9uZSggRy5WT00uTkdZMkl0ZW0oMSksIEcuVk9NLiRtZWRpYU5leHQsIGZhbHNlICk7XHJcbiAgICAgIC8vIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcblxyXG4gICAgXHJcbiAgICAvLyBNZWRpYSB3aGljaCBpcyBub3QgSU1HIC0+IGNlbnRlciBhbmQgc2V0IHNpemVcclxuICAgIGZ1bmN0aW9uIFZpZXdlck1lZGlhQ2VudGVyTm90SW1nKCAkbWVkaWFDb250YWluZXIgKSB7XHJcbiAgICAgIHZhciAkbWVkaWEgPSAkbWVkaWFDb250YWluZXIuY2hpbGRyZW4oKS5lcSgxKTtcclxuICAgICAgJG1lZGlhLmNzcyggeydoZWlnaHQnOiAnODAlJyB9KTtcclxuICAgICAgJG1lZGlhLmNzcyggeyd3aWR0aCc6ICAnOTAlJyB9KTtcclxuICAgICAgJG1lZGlhWzBdLnN0eWxlW0cuQ1NTdHJhbnNmb3JtTmFtZV0gPSAndHJhbnNsYXRlKDBweCwgXCI1MCVcIikgJztcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gU2V0IHBvc2l0aW9uIGFuZCBzaXplIG9mIE9ORSBtZWRpYSBjb250YWluZXJcclxuICAgIGZ1bmN0aW9uIFZpZXdlck1lZGlhU2V0UG9zQW5kWm9vbU9uZShpdGVtLCAkaW1nLCBpc0N1cnJlbnQgKSB7XHJcblxyXG4gICAgICBpZiggaXRlbS5tZWRpYUtpbmQgIT0gJ2ltZycgKSB7XHJcbiAgICAgICAgVmlld2VyTWVkaWFDZW50ZXJOb3RJbWcoJGltZyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiggaXRlbS5pbWFnZUhlaWdodCA9PSAwIHx8IGl0ZW0uaW1hZ2VXaWR0aCA9PSAwICkgeyBcclxuICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoIGl0ZW0sICRpbWcsIDAgKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHBhcnQgMTogc2V0IHRoZSBpbWFnZSBzaXplXHJcbiAgICAgIHZhciB6b29tVXNlckZhY3RvciA9IGlzQ3VycmVudCA9PSB0cnVlID8gRy5WT00uem9vbS51c2VyRmFjdG9yIDogMTtcclxuICAgICAgXHJcbiAgICAgIHZhciBkcHIgPSAxO1xyXG4gICAgICBpZiggRy5PLnZpZXdlckltYWdlRGlzcGxheSA9PSAnYmVzdEltYWdlUXVhbGl0eScgKSB7XHJcbiAgICAgICAgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW87XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIHJldHJpZXZlIHRoZSBiYXNlIHpvb20gZmFjdG9yIChpbWFnZSBmaWxsIHNjcmVlbilcclxuICAgICAgdmFyIHpvb21CYXNlRmFjdG9yVyA9IChHLlZPTS53aW5kb3cubGFzdFdpZHRoICAtIEcuVk9NLnBhZGRpbmcuVikgLyAoaXRlbS5pbWFnZVdpZHRoICAvIGRwcik7XHJcbiAgICAgIHZhciB6b29tQmFzZUZhY3RvckggPSAoRy5WT00ud2luZG93Lmxhc3RIZWlnaHQgLSBHLlZPTS5wYWRkaW5nLkgpIC8gKGl0ZW0uaW1hZ2VIZWlnaHQgLyBkcHIpO1xyXG4gICAgICB2YXIgem9vbUJhc2VGYWN0b3IgPSBNYXRoLm1pbih6b29tQmFzZUZhY3RvclcsIHpvb21CYXNlRmFjdG9ySCk7XHJcbiAgICAgIGlmKCB6b29tQmFzZUZhY3RvciA+IDEgJiYgRy5PLnZpZXdlckltYWdlRGlzcGxheSAhPSAndXBzY2FsZScgKSB7XHJcbiAgICAgICAgLy8gbm8gdXBzY2FsZVxyXG4gICAgICAgIHpvb21CYXNlRmFjdG9yID0gMTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdmFyIGltYWdlQ3VycmVudEhlaWdodCA9IChpdGVtLmltYWdlSGVpZ2h0IC8gZHByKSAqIHpvb21Vc2VyRmFjdG9yICogem9vbUJhc2VGYWN0b3I7XHJcbiAgICAgIHZhciBpbWFnZUN1cnJlbnRXaWR0aCAgPSAoaXRlbS5pbWFnZVdpZHRoIC8gZHByKSAgKiB6b29tVXNlckZhY3RvciAqIHpvb21CYXNlRmFjdG9yO1xyXG4gICAgICAkaW1nLmNoaWxkcmVuKCkuZXEoMSkuY3NzKCB7J2hlaWdodCc6IGltYWdlQ3VycmVudEhlaWdodCB9KTtcclxuICAgICAgJGltZy5jaGlsZHJlbigpLmVxKDEpLmNzcyggeyd3aWR0aCc6ICBpbWFnZUN1cnJlbnRXaWR0aCAgfSk7XHJcblxyXG4gICAgICAvLyByZXRyaWV2ZSBwb3NYL1kgdG8gY2VudGVyIGltYWdlXHJcbiAgICAgIHZhciBwb3NYID0gMDtcclxuICAgICAgaWYoIGltYWdlQ3VycmVudFdpZHRoID4gRy5WT00ud2luZG93Lmxhc3RXaWR0aCApIHtcclxuICAgICAgICBwb3NYID0gLShpbWFnZUN1cnJlbnRXaWR0aCAtIEcuVk9NLndpbmRvdy5sYXN0V2lkdGgpLzI7XHJcbiAgICAgIH1cclxuICAgICAgdmFyIHBvc1kgPSAwO1xyXG4gICAgICBpZiggaW1hZ2VDdXJyZW50SGVpZ2h0ID4gRy5WT00ud2luZG93Lmxhc3RIZWlnaHQgKSB7XHJcbiAgICAgICAgcG9zWSA9ICggaW1hZ2VDdXJyZW50SGVpZ2h0IC0gRy5WT00ud2luZG93Lmxhc3RIZWlnaHQgKSAvIDI7XHJcbiAgICAgIH1cclxuICAgICAgcG9zWSA9IDA7ICAgLy8gYWN0dWFsbHksIGl0IHNlZW1zIHRoYXQgdGhlIGltYWdlIGlzIGFsd2F5cyBjZW50ZXJlZCB2ZXJ0aWNhbGx5IC0+IHNvIG5vIG5lZWQgdG8gdG8gYW55dGhpbmdcclxuICAgICAgXHJcbiAgICAgIC8vIFBhcnQgMjogc2V0IHRoZSBYL1kgcG9zaXRpb24gKGZvciB6b29tL3BhbilcclxuICAgICAgaWYoIGlzQ3VycmVudCApIHtcclxuICAgICAgICBpZiggIUcuVk9NLnpvb20uaXNab29taW5nICkge1xyXG4gICAgICAgICAgRy5WT00ucGFuUG9zWCA9IDA7XHJcbiAgICAgICAgICBHLlZPTS5wYW5Qb3NZID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgRy5WT00uem9vbS5wb3NYID0gcG9zWDtcclxuICAgICAgICBHLlZPTS56b29tLnBvc1kgPSBwb3NZO1xyXG4gICAgICAgIFZpZXdlckltYWdlUGFuU2V0UG9zaXRpb24oRy5WT00ucGFuUG9zWCwgRy5WT00ucGFuUG9zWSwgJGltZywgZmFsc2UpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIGVsc2Uge1xyXG4gICAgICAgIC8vJGltZ1swXS5zdHlsZVtHLkNTU3RyYW5zZm9ybU5hbWVdPSAndHJhbnNsYXRlM0QoJysgcG9zWCsncHgsICcrIHBvc1krJ3B4LCAwKSAnO1xyXG4gICAgICAvLyB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIC8vIHNldCB0aGUgcGFuIHBvc2l0aW9uIG9mIGVhY2ggbWVkaWEgY29udGFpbmVyXHJcbiAgICAgICAgVmlld2VyTWVkaWFQYW5YKCBHLlZPTS5zd2lwZVBvc1ggKTtcclxuICAgICAgICAkaW1nLmNoaWxkcmVuKCkuZXEoMSlbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXT0gJ3RyYW5zbGF0ZSgwcHgsIDBweCkgcm90YXRlKCcrIGl0ZW0ucm90YXRpb25BbmdsZSArJ2RlZyknO1xuICAgICAgfVxyXG4gICAgICBcclxuICAgIH1cclxuXHJcbiAgICAvLyBwb3NpdGlvbiB0aGUgaW1hZ2UgZGVwZW5kaW5nIG9uIHRoZSB6b29tIGZhY3RvciBhbmQgdGhlIHBhbiBYL1kgcG9zaXRpb25cclxuICAgIC8vIElNRyBpcyB0aGUgb25seSBtZWRpYSBzdXBwb3J0aW5nIHpvb20vcGFuXHJcbiAgICBmdW5jdGlvbiBWaWV3ZXJJbWFnZVBhblNldFBvc2l0aW9uKHBvc1gsIHBvc1ksIGltYWdlQ29udGFpbmVyLCBzYXZlUG9zaXRpb24gKSB7XHJcbiAgICAgIGlmKCBzYXZlUG9zaXRpb24gKSB7XHJcbiAgICAgICAgRy5WT00ucGFuUG9zWCA9IHBvc1g7XHJcbiAgICAgICAgRy5WT00ucGFuUG9zWSA9IHBvc1k7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHBvc1ggKz0gRy5WT00uem9vbS5wb3NYO1xyXG4gICAgICBwb3NZICs9IEcuVk9NLnpvb20ucG9zWTtcbiAgICAgIFxuICAgICAgLy8gaW1hZ2VDb250YWluZXIuY2hpbGRyZW4oKS5lcSgxKVswXS5zdHlsZVtHLkNTU3RyYW5zZm9ybU5hbWVdPSAndHJhbnNsYXRlKCcrIHBvc1ggKyAncHgsICcrIHBvc1kgKyAncHgpJztcbiAgICAgIGltYWdlQ29udGFpbmVyLmNoaWxkcmVuKCkuZXEoMSlbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXT0gJ3RyYW5zbGF0ZSgnKyBwb3NYICsgJ3B4LCAnKyBwb3NZICsgJ3B4KSByb3RhdGUoJysgRy5WT00uTkdZMkl0ZW0oMCkucm90YXRpb25BbmdsZSArJ2RlZyknO1xyXG5cclxuXHJcbiAgICB9XHJcbiAgICBcclxuXHJcbiAgICAvLyBkaXNwbGF5IG1lZGlhIHdpdGggaW50ZXJuYWwgdmlld2VyXHJcbiAgICBmdW5jdGlvbiBPcGVuSW50ZXJuYWxWaWV3ZXIoICApIHtcclxuXHJcbiAgICAgIEcuVk9NLnZpZXdlckRpc3BsYXllZCA9IHRydWU7XHJcbiAgICAgIEcuR09NLmZpcnN0RGlzcGxheSA9IGZhbHNlO1xyXG4gICAgICBcclxuICAgICAgRy5WT00uc2F2ZU92ZXJmbG93WCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHkpWydvdmVyZmxvdy14J107XHJcbiAgICAgIEcuVk9NLnNhdmVPdmVyZmxvd1kgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5ib2R5KVsnb3ZlcmZsb3cteSddO1xyXG4gICAgICBqUXVlcnkoJ2JvZHknKS5jc3MoeyBvdmVyZmxvdzogJ2hpZGRlbicgfSk7ICAvL2F2b2lkIHNjcm9sbGJhcnNcclxuXHJcbiAgICAgIEcuVk9NLiRjb250ID0galF1ZXJ5KCc8ZGl2ICBjbGFzcz1cIm5HWTIgbkdZMlZpZXdlckNvbnRhaW5lclwiIHN0eWxlPVwib3BhY2l0eToxXCI+PC9kaXY+JykuYXBwZW5kVG8oJ2JvZHknKTtcclxuICAgICAgXHJcbiAgICAgIFNldFZpZXdlclRoZW1lKCk7XHJcblxyXG4gICAgICBHLlZPTS4kdmlld2VyID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwibkdZMlZpZXdlclwiIHN0eWxlPVwib3BhY2l0eTowXCIgaXRlbXNjb3BlIGl0ZW10eXBlPVwiaHR0cDovL3NjaGVtYS5vcmcvSW1hZ2VPYmplY3RcIj48L2Rpdj4nKS5hcHBlbmRUbyggRy5WT00uJGNvbnQgKTtcclxuICAgICAgRy5WT00uJHZpZXdlci5jc3MoeyBtc1RvdWNoQWN0aW9uOiAnbm9uZScsIHRvdWNoQWN0aW9uOiAnbm9uZScgfSk7ICAgICAgICAgICAgLy8gYXZvaWQgcGluY2ggem9vbVxyXG5cclxuICAgICAgRy5WT00uY3Vyckl0ZW1JZHggPSAwO1xyXG4gICAgICB2YXIgc01lZGlhID0gJzxkaXYgY2xhc3M9XCJuR1kyVmlld2VyTWVkaWFQYW5cIj48ZGl2IGNsYXNzPVwibkdZMlZpZXdlck1lZGlhTG9hZGVyRGlzcGxheWVkXCI+PC9kaXY+JyArIEcuVk9NLk5HWTJJdGVtKC0xKS5tZWRpYU1hcmt1cCArICc8L2Rpdj4nOyAgICAvLyBwcmV2aW91cyBtZWRpYVxyXG4gICAgICBzTWVkaWEgICAgKz0gJzxkaXYgY2xhc3M9XCJuR1kyVmlld2VyTWVkaWFQYW5cIj48ZGl2IGNsYXNzPVwibkdZMlZpZXdlck1lZGlhTG9hZGVyRGlzcGxheWVkXCI+PC9kaXY+JyArIEcuVk9NLk5HWTJJdGVtKDApLm1lZGlhTWFya3VwICArICc8L2Rpdj4nOyAgICAvLyBjdXJyZW50IG1lZGlhXHJcbiAgICAgIHNNZWRpYSAgICArPSAnPGRpdiBjbGFzcz1cIm5HWTJWaWV3ZXJNZWRpYVBhblwiPjxkaXYgY2xhc3M9XCJuR1kyVmlld2VyTWVkaWFMb2FkZXJEaXNwbGF5ZWRcIj48L2Rpdj4nICsgRy5WT00uTkdZMkl0ZW0oMSkubWVkaWFNYXJrdXAgICsgJzwvZGl2Pic7ICAgIC8vIG5leHQgbWVkaWFcclxuXHJcbiAgICAgIHZhciBzTmF2ID0gJyc7XHJcbiAgICAgIHZhciBpY29uUCA9IEcuTy5pY29ucy52aWV3ZXJJbWdQcmV2aW91cztcclxuICAgICAgaWYoIGljb25QICE9IHVuZGVmaW5lZCAmJiBpY29uUCAhPSAnJykge1xyXG4gICAgICAgIHNOYXYgKz0gJzxkaXYgY2xhc3M9XCJuR1kyVmlld2VyQXJlYVByZXZpb3VzIG5neTJ2aWV3ZXJUb29sQWN0aW9uXCIgZGF0YS1uZ3kyYWN0aW9uPVwicHJldmlvdXNcIj4nICsgaWNvblAgKyAnPC9kaXY+JztcclxuICAgICAgfVxyXG4gICAgICB2YXIgaWNvbk4gPSBHLk8uaWNvbnMudmlld2VySW1nTmV4dDtcclxuICAgICAgaWYoIGljb25OICE9IHVuZGVmaW5lZCAmJiBpY29uTiAhPSAnJykge1xyXG4gICAgICAgIHNOYXYgKz0gJzxkaXYgY2xhc3M9XCJuR1kyVmlld2VyQXJlYU5leHQgbmd5MnZpZXdlclRvb2xBY3Rpb25cIiBkYXRhLW5neTJhY3Rpb249XCJuZXh0XCI+JyArIGljb25OICsgJzwvZGl2Pic7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIEcuVk9NLiRjb250ZW50ID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwibkdZMlZpZXdlckNvbnRlbnRcIj4nICsgc01lZGlhICsgc05hdiArICc8L2Rpdj4nKS5hcHBlbmRUbyggRy5WT00uJHZpZXdlciApO1xyXG5cclxuICAgICAgdmFyICRtZWRpYVBhbiA9IEcuVk9NLiRjb250ZW50LmZpbmQoJy5uR1kyVmlld2VyTWVkaWFQYW4nKTtcclxuICAgICAgRy5WT00uJG1lZGlhUHJldmlvdXMgPSAkbWVkaWFQYW4uZXEoMCk7ICAgIC8vIHBvaW50ZXIgdG8gcHJldmlvdXMgbWVkaWEgY29udGFpbmVyXHJcbiAgICAgIEcuVk9NLiRtZWRpYUN1cnJlbnQgPSAkbWVkaWFQYW4uZXEoMSk7ICAgICAvLyBwb2ludGVyIHRvIGN1cnJlbnQgbWVkaWEgY29udGFpbmVyXHJcbiAgICAgIEcuVk9NLiRtZWRpYU5leHQgPSAkbWVkaWFQYW4uZXEoMik7ICAgICAgICAvLyBwb2ludGVyIHRvIG5leHQgbWVkaWEgY29udGFpbmVyXHJcblxyXG4gICAgICBHLlZPTS5JbWFnZUxvYWRlci5sb2FkSW1hZ2UoIFZpZXdlSW1nU2l6ZVJldHJpZXZlZCwgRy5WT00uTkdZMkl0ZW0oMCkgICk7XHJcbiAgICAgIEcuVk9NLkltYWdlTG9hZGVyLmxvYWRJbWFnZSggVmlld2VJbWdTaXplUmV0cmlldmVkLCBHLlZPTS5OR1kySXRlbSgtMSkgKTtcclxuICAgICAgRy5WT00uSW1hZ2VMb2FkZXIubG9hZEltYWdlKCBWaWV3ZUltZ1NpemVSZXRyaWV2ZWQsIEcuVk9NLk5HWTJJdGVtKDEpICApO1xyXG4gICAgICBcclxuICAgICAgRy5WT00ucGFkZGluZy5IID0gcGFyc2VJbnQoRy5WT00uJGNvbnRlbnQuY3NzKFwicGFkZGluZy1sZWZ0XCIpKSArIHBhcnNlSW50KEcuVk9NLiRjb250ZW50LmNzcyhcInBhZGRpbmctcmlnaHRcIikpO1xyXG4gICAgICBHLlZPTS5wYWRkaW5nLlYgPSBwYXJzZUludChHLlZPTS4kY29udGVudC5jc3MoXCJwYWRkaW5nLXRvcFwiKSkgKyBwYXJzZUludChHLlZPTS4kY29udGVudC5jc3MoXCJwYWRkaW5nLWJvdHRvbVwiKSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBidWlsZCBtZWRpYSB0b29sYmFyIGNvbnRhaW5lclxyXG4gICAgICB2YXIgdnRiQmcxID0gJyc7XHJcbiAgICAgIHZhciB2dGJCZzIgPSAnIHRvb2xiYXJCYWNrZ3JvdW5kJztcclxuICAgICAgaWYoIEcuTy52aWV3ZXJUb29sYmFyLmZ1bGxXaWR0aCApIHtcclxuICAgICAgICB2dGJCZzEgPSAnIHRvb2xiYXJCYWNrZ3JvdW5kJztcclxuICAgICAgICB2dGJCZzIgPSAnJztcclxuICAgICAgfVxyXG4gICAgICB2YXIgdnRiQWxpZ24gPSAndGV4dC1hbGlnbjpjZW50ZXI7JztcclxuICAgICAgc3dpdGNoICggRy5PLnZpZXdlclRvb2xiYXIuYWxpZ24gKSB7XHJcbiAgICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgICB2dGJBbGlnbiA9ICd0ZXh0LWFsaWduOmxlZnQ7JztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3JpZ2h0JzpcclxuICAgICAgICAgIHZ0YkFsaWduID0gJ3RleHQtYWxpZ246cmlnaHQ7JztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIHZhciBzVEIgPSAnPGRpdiBjbGFzcz1cInRvb2xiYXJDb250YWluZXIgbkdFdmVudCcgKyB2dGJCZzEgKyAnXCIgc3R5bGU9XCJ2aXNpYmlsaXR5OicgKyhHLk8udmlld2VyVG9vbGJhci5kaXNwbGF5ID8gXCJ2aXNpYmxlXCIgOiBcImhpZGRlblwiKSsnOycrdnRiQWxpZ24rJ1wiPjxkaXYgY2xhc3M9XCJ0b29sYmFyIG5HRXZlbnQnICsgdnRiQmcyICsgJ1wiPjwvZGl2PjwvZGl2Pic7XHJcbiAgICAgIEcuVk9NLiR0b29sYmFyID0galF1ZXJ5KHNUQikuYXBwZW5kVG8oRy5WT00uJHZpZXdlcik7XHJcblxyXG4gICAgICBpZiggRy5WT00udG9vbGJhck1vZGUgPT0gJ21pbicgfHwgKEcuTy52aWV3ZXJUb29sYmFyLmF1dG9NaW5pbWl6ZSA+IDAgJiYgRy5PLnZpZXdlclRvb2xiYXIuYXV0b01pbmltaXplID49IEcuR09NLmNhY2hlLnZpZXdwb3J0LncpICkge1xyXG4gICAgICAgIFZpZXdlclRvb2xiYXJGb3JWaXNpYmlsaXR5TWluKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgVmlld2VyVG9vbGJhckZvclZpc2liaWxpdHlTdGQoKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gdG9wLWxlZnQgdG9vbGJhclxyXG4gICAgICBpZiggRy5PLnZpZXdlclRvb2xzLnRvcExlZnQgIT0gJycgKSB7XHJcbiAgICAgICAgdmFyIHNUb3BMZWZ0ID0gJzxkaXYgY2xhc3M9XCJuR1kyVmlld2VyVG9vbHNUb3BMZWZ0IG5HRXZlbnRcIj48ZGl2IGNsYXNzPVwidG9vbGJhciBuR0V2ZW50XCI+JztcclxuICAgICAgICB2YXIgc1RMID0gRy5PLnZpZXdlclRvb2xzLnRvcExlZnQuc3BsaXQoJywnKTtcclxuICAgICAgICBmb3IoIHZhciBpID0gMCwgc1RMTCA9IHNUTC5sZW5ndGg7IGkgPCBzVExMOyBpKyspIHtcclxuICAgICAgICAgIHNUb3BMZWZ0ICs9IFRvb2xiYXJBZGRFbHQoIHNUTFtpXSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzVG9wTGVmdCArPSAnPC9kaXY+PC9kaXY+JztcclxuICAgICAgICBHLlZPTS4kdG9vbGJhclRMID0galF1ZXJ5KHNUb3BMZWZ0KS5hcHBlbmRUbyhHLlZPTS4kdmlld2VyKTtcclxuICAgICAgfVxyXG4gICAgICAvLyB0b3AtcmlnaHQgdG9vbGJhclxyXG4gICAgICBpZiggRy5PLnZpZXdlclRvb2xzLnRvcFJpZ2h0ICE9ICcnICkge1xyXG4gICAgICAgIHZhciBzVG9wUmlnaHQgPSAnPGRpdiBjbGFzcz1cIm5HWTJWaWV3ZXJUb29sc1RvcFJpZ2h0IG5HRXZlbnRcIj48ZGl2IGNsYXNzPVwidG9vbGJhciBuR0V2ZW50XCI+JztcclxuICAgICAgICB2YXIgc1RSID0gRy5PLnZpZXdlclRvb2xzLnRvcFJpZ2h0LnNwbGl0KCcsJyk7XHJcbiAgICAgICAgZm9yKCB2YXIgaSA9IDAsIHNUUkwgPSBzVFIubGVuZ3RoOyBpIDwgc1RSTDsgaSsrKSB7XHJcbiAgICAgICAgICBzVG9wUmlnaHQgKz0gVG9vbGJhckFkZEVsdCggc1RSW2ldICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNUb3BSaWdodCArPSAnPC9kaXY+PC9kaXY+JztcclxuICAgICAgICBHLlZPTS4kdG9vbGJhclRSID0galF1ZXJ5KHNUb3BSaWdodCkuYXBwZW5kVG8oRy5WT00uJHZpZXdlcik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIHNldCB0aGUgZXZlbnRzIGhhbmRsZXIgZm9yIHRvb2xiYXJzXHJcbiAgICAgIFZpZXdlclRvb2xzT24oKTtcclxuXHJcbiAgICAgIC8vIGRpc3BsYXkgbG9nb1xyXG4gICAgICBpZiggRy5PLnZpZXdlckRpc3BsYXlMb2dvICkgeyBHLiRFLnZ3TG9nbz1qUXVlcnkoJzxkaXYgY2xhc3M9XCJuR1kyIG5HWTJWaWV3ZXJMb2dvXCI+PC9kaXY+JykuYXBwZW5kVG8oRy5WT00uJHZpZXdlcik7IH1cclxuXHJcbiAgICAgIC8vIEdvIHRvIGZ1bGxzY3JlZW4gbW9kZVxyXG4gICAgICBpZiggbmdzY3JlZW5mdWxsLmVuYWJsZWQgJiYgRy5PLnZpZXdlckZ1bGxzY3JlZW4gKSB7IG5nc2NyZWVuZnVsbC5yZXF1ZXN0KCk7IH1cclxuXHJcbiAgICAgIHNldEVsZW1lbnRPblRvcCgnJywgRy5WT00uJHZpZXdlcik7XHJcbiAgICAgIFJlc2l6ZUludGVybmFsVmlld2VyKHRydWUpO1xyXG4gICAgICBHLlZPTS50aW1lSW1nQ2hhbmdlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICBcclxuICAgICAgLy8gdmlld2VyIGRpc3BsYXkgdHJhbnNpdGlvblxyXG4gICAgICB2YXIgdHdlZW5hYmxlID0gbmV3IE5HVHdlZW5hYmxlKCk7XHJcbiAgICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAgICAgICAgZnJvbTogICAgICAgICB7IG9wYWNpdHk6IDAsIHBvc1k6IEcuVk9NLndpbmRvdy5sYXN0SGVpZ2h0Ki41IH0sXHJcbiAgICAgICAgdG86ICAgICAgICAgICB7IG9wYWNpdHk6IDEsIHBvc1k6IDAgfSxcclxuICAgICAgICBkZWxheTogICAgICAgIDMwLFxyXG4gICAgICAgIGR1cmF0aW9uOiAgICAgNTAwLFxyXG4gICAgICAgIGVhc2luZzogICAgICAgJ2Vhc2VPdXRRdWFydCcsXHJcbiAgICAgICAgc3RlcDogICAgICAgICBmdW5jdGlvbiAoc3RhdGUpIHtcclxuICAgICAgICAgIEcuVk9NLiR2aWV3ZXIuY3NzKCdvcGFjaXR5Jywgc3RhdGUub3BhY2l0eSk7XHJcbiAgICAgICAgICBHLlZPTS4kdmlld2VyWzBdLnN0eWxlW0cuQ1NTdHJhbnNmb3JtTmFtZV0gPSAndHJhbnNsYXRlWSgnICsgKHN0YXRlLnBvc1kpICsgJ3B4KSAnO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBzdG9wIGNsaWNrIHByb3BhZ2F0aW9uIG9uIG1lZGlhID09PiBpZiB0aGUgdXNlciBjbGlja3Mgb3V0c2lkZSBvZiBhbiBtZWRpYSwgdGhlIHZpZXdlciBpcyBjbG9zZWRcclxuICAgICAgLy8gLS0+IG5vIG1vcmUgc3VwcG9ydGVkIHNpbmNlIHYyLjAuMFxyXG4gICAgICAvLyBHLlZPTS4kdmlld2VyLmZpbmQoJ2ltZycpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7IGUuc3RvcFByb3BhZ2F0aW9uKCk7IH0pO1xyXG4gICAgICBcclxuICAgICAgXHJcbiAgICAgIFZpZXdlck1lZGlhUGFuWCgwKTtcclxuICAgICAgVmlld2VyU2V0RXZlbnRzKCk7XHJcblxyXG4gICAgICBEaXNwbGF5SW50ZXJuYWxWaWV3ZXIoMCwgJycpO1xyXG4gICAgICBcclxuICAgICAgaWYoIEcuTy5zbGlkZXNob3dBdXRvU3RhcnQgKSB7XHJcbiAgICAgICAgRy5WT00ucGxheVNsaWRlc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIFNsaWRlc2hvd1RvZ2dsZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIFZpZXdlckV2ZW50cygpIHtcclxuICAgICAgaWYoICFHLlZPTS52aWV3ZXJEaXNwbGF5ZWQgfHwgRy5WT00udmlld2VyTWVkaWFJc0NoYW5nZWQgfHwgRy5WT00uTkdZMkl0ZW0oMCkubWVkaWFLaW5kICE9ICdpbWcnKSB7XHJcbiAgICAgICAgLy8gaWdub3JlIGZpcmVkIGV2ZW50IGlmIHZpZXdlciBub3QgZGlzcGxheWVkIG9yIGlmIGN1cnJlbnRseSBjaGFuZ2VkIG9yIGlmIGN1cnJlbnQgbWVkaWEgbm90IGFuIGltYWdlXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIC8vIHZpZXdlciBnZXN0dXJlIGhhbmRsaW5nXHJcbiAgICBmdW5jdGlvbiBWaWV3ZXJTZXRFdmVudHMoKSB7XHJcblxyXG4gICAgICBpZiggRy5WT00uaGFtbWVydGltZSA9PSBudWxsICkge1xyXG4gICAgICBcclxuICAgICAgICBHLlZPTS5oYW1tZXJ0aW1lID0gIG5ldyBOR0hhbW1lci5NYW5hZ2VyKEcuVk9NLiRjb250WzBdLCB7XHJcbiAgICAgICAgICByZWNvZ25pemVyczogW1xyXG4gICAgICAgICAgICBbTkdIYW1tZXIuUGluY2gsIHsgZW5hYmxlOiB0cnVlIH1dLFxyXG4gICAgICAgICAgICBbTkdIYW1tZXIuUGFuLCB7IGRpcmVjdGlvbjogTkdIYW1tZXIuRElSRUNUSU9OX0FMTCB9XVxyXG4gICAgICAgICAgXVxyXG4gICAgICAgIH0pO1xyXG4gICAgIFxyXG4gICAgICAgIC8vIFBBTlxyXG4gICAgICAgIEcuVk9NLmhhbW1lcnRpbWUub24oJ3BhbicsIGZ1bmN0aW9uKGV2KSB7XHJcbiAgICAgICAgICBpZiggIVZpZXdlckV2ZW50cygpICkgeyByZXR1cm47IH1cclxuXHJcbiAgICAgICAgICBpZiggRy5WT00uem9vbS5pc1pvb21pbmcgKSB7XHJcbiAgICAgICAgICAgIC8vIHBhbiB6b29tZWQgaW1hZ2VcclxuICAgICAgICAgICAgVmlld2VySW1hZ2VQYW5TZXRQb3NpdGlvbihHLlZPTS5wYW5Qb3NYICsgZXYuZGVsdGFYLCBHLlZPTS5wYW5Qb3NZICsgZXYuZGVsdGFZLCBHLlZPTS4kbWVkaWFDdXJyZW50LCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGlmKCBHLlZPTS50b29sYmFyc0Rpc3BsYXllZCA9PSB0cnVlICkge1xyXG4gICAgICAgICAgICAgIEcuVk9NLnRvb2xzSGlkZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYoIGV2LmRlbHRhWSA+IEcuVk9NLnBhblRocmVzaG9sZCAmJiBNYXRoLmFicyhldi5kZWx0YVgpIDwgRy5WT00ucGFuVGhyZXNob2xkICYmICFHLlZPTS5wYW5YT25seSApIHtcclxuICAgICAgICAgICAgICAvLyBwYW4gdmlld2VyIGRvd25cclxuICAgICAgICAgICAgICBWaWV3ZXJNZWRpYVBhblgoIDAgKTtcclxuICAgICAgICAgICAgICB2YXIgZGlzdCA9IE1hdGgubWluKGV2LmRlbHRhWSwgMjAwKTtcclxuICAgICAgICAgICAgICBHLlZPTS4kdmlld2VyWzBdLnN0eWxlW0cuQ1NTdHJhbnNmb3JtTmFtZV0gPSAndHJhbnNsYXRlWSgnICsgZGlzdCArICdweCkgJztcclxuICAgICAgICAgICAgICBHLlZPTS4kdmlld2VyLmNzcygnb3BhY2l0eScsIDEtZGlzdC8yMDAvMik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gcGFuIG1lZGlhIGxlZnQvcmlnaHRcbiAgICAgICAgICAgICAgaWYoIE1hdGguYWJzKGV2LmRlbHRhWCkgPiBHLlZPTS5wYW5UaHJlc2hvbGQgKSB7XG4gICAgICAgICAgICAgICAgRy5WT00ucGFuWE9ubHkgPSB0cnVlO1xuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgVmlld2VyTWVkaWFQYW5YKCBldi5kZWx0YVggKTtcclxuICAgICAgICAgICAgICBHLlZPTS4kdmlld2VyWzBdLnN0eWxlW0cuQ1NTdHJhbnNmb3JtTmFtZV0gPSAndHJhbnNsYXRlWSgwcHgpJztcclxuICAgICAgICAgICAgICBHLlZPTS4kdmlld2VyLmNzcygnb3BhY2l0eScsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFBBTiBFTkRcclxuICAgICAgICBHLlZPTS5oYW1tZXJ0aW1lLm9uKCdwYW5lbmQnLCBmdW5jdGlvbihldikge1xyXG4gICAgICAgICAgaWYoICFWaWV3ZXJFdmVudHMoKSApIHsgcmV0dXJuOyB9XG4gICAgICAgICAgaWYoIEcuVk9NLnpvb20uaXNab29taW5nICkge1xyXG4gICAgICAgICAgICBHLlZPTS50aW1lSW1nQ2hhbmdlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgICBWaWV3ZXJJbWFnZVBhblNldFBvc2l0aW9uKEcuVk9NLnBhblBvc1grZXYuZGVsdGFYLCBHLlZPTS5wYW5Qb3NZK2V2LmRlbHRhWSwgRy5WT00uJG1lZGlhQ3VycmVudCwgdHJ1ZSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBwYW5ZID0gZmFsc2U7XG4gICAgICAgICAgICBpZiggIUcuVk9NLnBhblhPbmx5ICkge1xyXG4gICAgICAgICAgICAgIGlmKCBldi5kZWx0YVkgPiA1MCAmJiBNYXRoLmFicyhldi5kZWx0YVgpIDwgNTAgKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBjbG9zZSB2aWV3ZXJcclxuICAgICAgICAgICAgICAgIENsb3NlSW50ZXJuYWxWaWV3ZXIoRy5WT00uY3Vyckl0ZW1JZHgpO1xuICAgICAgICAgICAgICAgIHBhblkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoICFwYW5ZICkge1xyXG4gICAgICAgICAgICAgIGlmKCBNYXRoLmFicyggZXYuZGVsdGFYICkgPCA1MCApIHtcclxuICAgICAgICAgICAgICAgIFZpZXdlck1lZGlhUGFuWCgwKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBldi5kZWx0YVggPiA1MCA/IERpc3BsYXlQcmV2aW91c01lZGlhKCkgOiBEaXNwbGF5TmV4dE1lZGlhKCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBHLlZPTS5wYW5YT25seSA9IGZhbHNlO1xuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBpZiggRy5PLnZpZXdlclpvb20gKSB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgICBHLlZPTS5oYW1tZXJ0aW1lLmFkZCggbmV3IE5HSGFtbWVyLlRhcCh7IGV2ZW50OiAnZG91YmxldGFwJywgdGFwczogMiB9KSApO1xyXG4gICAgICAgICAgRy5WT00uaGFtbWVydGltZS5hZGQoIG5ldyBOR0hhbW1lci5UYXAoeyBldmVudDogJ3NpbmdsZXRhcCcgfSkgKTtcclxuICAgICAgICAgIEcuVk9NLmhhbW1lcnRpbWUuZ2V0KCdkb3VibGV0YXAnKS5yZWNvZ25pemVXaXRoKCdzaW5nbGV0YXAnKTtcclxuICAgICAgICAgIEcuVk9NLmhhbW1lcnRpbWUuZ2V0KCdzaW5nbGV0YXAnKS5yZXF1aXJlRmFpbHVyZSgnZG91YmxldGFwJyk7XHJcblxyXG4gICAgICAgICAgLy8gc2luZ2xlIHRhcCAtPiBuZXh0L3ByZXZpb3VzIG1lZGlhXHJcbiAgICAgICAgICBHLlZPTS5oYW1tZXJ0aW1lLm9uKCdzaW5nbGV0YXAnLCBmdW5jdGlvbihldikge1xyXG4gICAgICAgICAgICBpZiggIVZpZXdlckV2ZW50cygpICkgeyByZXR1cm47IH1cclxuICAgICAgICAgICAgU3RvcFByb3BhZ2F0aW9uUHJldmVudERlZmF1bHQoZXYuc3JjRXZlbnQpO1xyXG4gICAgICAgICAgICBpZiggRy5WT00udG9vbGJhcnNEaXNwbGF5ZWQgPT0gZmFsc2UgKSB7XHJcbiAgICAgICAgICAgICAgZGVib3VuY2UoIFZpZXdlclRvb2xzVW5IaWRlLCAxMDAsIGZhbHNlKSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIGlmKCBldi50YXJnZXQuY2xhc3NOYW1lLmluZGV4T2YoJ25HWTJWaWV3ZXJNZWRpYScpICE9PSAtMSApIHtcclxuICAgICAgICAgICAgICAgIGlmKCBldi5zcmNFdmVudC5wYWdlWCA8IChHLkdPTS5jYWNoZS52aWV3cG9ydC53LzIpICkge1xyXG4gICAgICAgICAgICAgICAgICBEaXNwbGF5UHJldmlvdXNNZWRpYSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgIERpc3BsYXlOZXh0TWVkaWEoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICAvLyBkb3VibGUgdGFwIC0+IHpvb21cclxuICAgICAgICAgIEcuVk9NLmhhbW1lcnRpbWUub24oJ2RvdWJsZXRhcCcsIGZ1bmN0aW9uKGV2KSB7XHJcbiAgICAgICAgICAgIGlmKCAhVmlld2VyRXZlbnRzKCkgKSB7IHJldHVybjsgfVxyXG4gICAgICAgICAgICBTdG9wUHJvcGFnYXRpb25QcmV2ZW50RGVmYXVsdChldi5zcmNFdmVudCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiggZXYudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKCduR1kyVmlld2VyTWVkaWEnKSAhPT0gLTEgKSB7XHJcbiAgICAgICAgICAgICAgLy8gZG91YmxlIHRhcCBvbmx5IG9uIGltYWdlXHJcbiAgICAgICAgICAgICAgaWYoIEcuVk9NLnpvb20uaXNab29taW5nICkge1xyXG4gICAgICAgICAgICAgICAgRy5WT00uem9vbS5pc1pvb21pbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIC8vIEcuVk9NLnpvb20udXNlckZhY3RvciA9IDE7XHJcbiAgICAgICAgICAgICAgICBSZXNpemVJbnRlcm5hbFZpZXdlcih0cnVlKTtcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiggVmlld2VyWm9vbVN0YXJ0KCkgKSB7XHJcbiAgICAgICAgICAgICAgICAgIEcuVk9NLnpvb20udXNlckZhY3RvciA9IDEuNTtcclxuICAgICAgICAgICAgICAgICAgVmlld2VyTWVkaWFTZXRQb3NBbmRab29tKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICAgIC8vIHBpbmNoIGVuZFxyXG4gICAgICAgICAgRy5WT00uaGFtbWVydGltZS5vbigncGluY2hlbmQnLCBmdW5jdGlvbihldikge1xyXG4gICAgICAgICAgICBldi5zcmNFdmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgZXYuc3JjRXZlbnQucHJldmVudERlZmF1bHQoKTsgIC8vIGNhbmNlbCAgbW91c2VlbnRlciBldmVudFxyXG4gICAgICAgICAgICBHLlZPTS50aW1lSW1nQ2hhbmdlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBHLlZPTS5oYW1tZXJ0aW1lLm9uKCdwaW5jaCcsIGZ1bmN0aW9uKGV2KSB7XHJcbiAgICAgICAgICAgIGV2LnNyY0V2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICBldi5zcmNFdmVudC5wcmV2ZW50RGVmYXVsdCgpOyAgLy8gY2FuY2VsICBtb3VzZWVudGVyIGV2ZW50XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBpZiggVmlld2VyWm9vbVN0YXJ0KCkgKSB7XHJcbiAgICAgICAgICAgICAgRy5WT00uem9vbS51c2VyRmFjdG9yID0gZXYuc2NhbGU7XHJcbiAgICAgICAgICAgICAgVmlld2VyWm9vbU1heCgpO1xyXG4gICAgICAgICAgICAgIFZpZXdlclpvb21NaW4oKTtcclxuICAgICAgICAgICAgICBWaWV3ZXJNZWRpYVNldFBvc0FuZFpvb20oKTsgICAvLyBjZW50ZXIgbWVkaWFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgLy8gbm8gem9vbSAtPiBjbGljay90YXAgb24gaW1hZ2UgdG8gZ28gdG8gbmV4dC9wcmV2aW91cyBvbmVcclxuICAgICAgICAgIEcuVk9NLmhhbW1lcnRpbWUub24oJ3RhcCcsIGZ1bmN0aW9uKGV2KSB7XHJcbiAgICAgICAgICAgIGlmKCAhVmlld2VyRXZlbnRzKCkgKSB7IHJldHVybjsgfVxyXG4gICAgICAgICAgICBTdG9wUHJvcGFnYXRpb25QcmV2ZW50RGVmYXVsdChldi5zcmNFdmVudCk7XHJcbiAgICAgICAgICAgIGlmKCBHLlZPTS50b29sYmFyc0Rpc3BsYXllZCA9PSBmYWxzZSAgKXtcclxuICAgICAgICAgICAgICAvLyBkaXNwbGF5IHRvb2xzIG9uIHRhcCBpZiBoaWRkZW5cclxuICAgICAgICAgICAgICBkZWJvdW5jZSggVmlld2VyVG9vbHNVbkhpZGUsIDEwMCwgZmFsc2UpKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gZGlzcGxheSBuZXh0L3ByZXZpb3VzIGltYWdlIGlmIHRvb2xzIG5vdCBoaWRkZW5cclxuICAgICAgICAgICAgICBpZiggZXYudGFyZ2V0LmNsYXNzTmFtZS5pbmRleE9mKCduR1kyVmlld2VyTWVkaWEnKSAhPT0gLTEgKSB7XHJcbiAgICAgICAgICAgICAgICBpZiggZXYuc3JjRXZlbnQucGFnZVggPCAoRy5HT00uY2FjaGUudmlld3BvcnQudy8yKSApIHtcclxuICAgICAgICAgICAgICAgICAgRGlzcGxheVByZXZpb3VzTWVkaWEoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICBEaXNwbGF5TmV4dE1lZGlhKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIFN0b3BQcm9wYWdhdGlvblByZXZlbnREZWZhdWx0KGUpIHtcclxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEhpZGUgdG9vbGJhcnMgb24gdXNlciBpbmFjdGl2aXR5XHJcbiAgICBmdW5jdGlvbiBWaWV3ZXJUb29sc0hpZGUoKSB7XHJcbiAgICAgIGlmKCBHLlZPTS52aWV3ZXJEaXNwbGF5ZWQgKSB7XHJcbiAgICAgICAgRy5WT00udG9vbGJhcnNEaXNwbGF5ZWQgPSBmYWxzZTtcclxuICAgICAgICBWaWV3ZXJUb29sc09wYWNpdHkoMCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVmlld2VyVG9vbHNVbkhpZGUoKSB7XHJcbiAgICBpZiggRy5WT00udmlld2VyRGlzcGxheWVkICkge1xyXG4gICAgICAgIEcuVk9NLnRvb2xiYXJzRGlzcGxheWVkID0gdHJ1ZTtcclxuICAgICAgICBWaWV3ZXJUb29sc09wYWNpdHkoMSk7XHJcbiAgICAgICAgRy5WT00udG9vbHNIaWRlKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVmlld2VyVG9vbHNPcGFjaXR5KCBvcCApIHtcclxuICAgICAgaWYoIEcuVk9NLiR0b29sYmFyICE9IG51bGwgKSB7XG4gICAgICAgIEcuVk9NLiR0b29sYmFyLmNzcygnb3BhY2l0eScsIG9wKTtcbiAgICAgIH1cbiAgICAgIGlmKCBHLlZPTS4kdG9vbGJhclRMICE9IG51bGwgKSB7XHJcbiAgICAgICAgRy5WT00uJHRvb2xiYXJUTC5jc3MoJ29wYWNpdHknLCBvcCk7XHJcbiAgICAgIH1cclxuICAgICAgaWYoIEcuVk9NLiR0b29sYmFyVFIgIT0gbnVsbCApIHsgXHJcbiAgICAgICAgRy5WT00uJHRvb2xiYXJUUi5jc3MoJ29wYWNpdHknLCBvcCk7XHJcbiAgICAgIH1cclxuICAgICAgRy5WT00uJGNvbnRlbnQuZmluZCgnLm5HWTJWaWV3ZXJBcmVhTmV4dCcpLmNzcygnb3BhY2l0eScsIG9wKTtcclxuICAgICAgRy5WT00uJGNvbnRlbnQuZmluZCgnLm5HWTJWaWV3ZXJBcmVhUHJldmlvdXMnKS5jc3MoJ29wYWNpdHknLCBvcCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBWaWV3ZXJUb29sc09uKCkge1xyXG4gICAgICAvLyByZW1vdmVzIGFsbCBldmVudHNcclxuICAgICAgRy5WT00uJHZpZXdlci5vZmYoJ3RvdWNoc3RhcnQgY2xpY2snLCAnLm5neTJ2aWV3ZXJUb29sQWN0aW9uJywgVmlld2VyVG9vbHNBY3Rpb24pOyBcclxuICAgICAgXHJcbiAgICAgIC8vIGFjdGlvbiBidXR0b25cclxuICAgICAgRy5WT00uJHZpZXdlci5vbigndG91Y2hzdGFydCBjbGljaycsICcubmd5MnZpZXdlclRvb2xBY3Rpb24nLCBWaWV3ZXJUb29sc0FjdGlvbik7IFxyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgLy8gQWN0aW9ucyBvZiB0aGUgYnV0dHRvbi9lbGVtZW50c1xyXG4gICAgZnVuY3Rpb24gVmlld2VyVG9vbHNBY3Rpb24oZSkge1xyXG4gICAgICAvLyBkZWxheSB0byBhdm9pZCB0d2ljZSBoYW5kbGluZyBvbiBzbWFydHBob25lL3RhYmxldCAoYm90aCB0b3VjaHN0YXJ0IGNsaWNrIGV2ZW50cyBhcmUgZmlyZWQpXHJcbiAgICAgIGlmKCAobmV3IERhdGUoKS5nZXRUaW1lKCkpIC0gRy50aW1lTGFzdFRvdWNoU3RhcnQgPCAzMDAgKSB7IHJldHVybjsgfVxyXG4gICAgICBHLnRpbWVMYXN0VG91Y2hTdGFydCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICBcclxuICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcclxuICAgICAgdmFyIG5neTJhY3Rpb24gPSAkdGhpcy5kYXRhKCduZ3kyYWN0aW9uJyk7XHJcbiAgICAgIGlmKCBuZ3kyYWN0aW9uID09IHVuZGVmaW5lZCApIHsgcmV0dXJuOyB9XHJcbiAgICAgIHN3aXRjaCggbmd5MmFjdGlvbiApIHtcclxuICAgICAgICBjYXNlICduZXh0JzpcclxuICAgICAgICAgIFN0b3BQcm9wYWdhdGlvblByZXZlbnREZWZhdWx0KGUpO1xyXG4gICAgICAgICAgRGlzcGxheU5leHRNZWRpYSgpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncHJldmlvdXMnOlxyXG4gICAgICAgICAgU3RvcFByb3BhZ2F0aW9uUHJldmVudERlZmF1bHQoZSk7XHJcbiAgICAgICAgICBEaXNwbGF5UHJldmlvdXNNZWRpYSgpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncGxheVBhdXNlJzpcclxuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICBTbGlkZXNob3dUb2dnbGUoKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3pvb21Jbic6XHJcbiAgICAgICAgICBTdG9wUHJvcGFnYXRpb25QcmV2ZW50RGVmYXVsdChlKTtcclxuICAgICAgICAgIGlmKCBWaWV3ZXJab29tU3RhcnQoKSApIHsgVmlld2VyWm9vbUluKCB0cnVlICk7IH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3pvb21PdXQnOlxyXG4gICAgICAgICAgU3RvcFByb3BhZ2F0aW9uUHJldmVudERlZmF1bHQoZSk7XHJcbiAgICAgICAgICBpZiggVmlld2VyWm9vbVN0YXJ0KCkgKSB7IFZpZXdlclpvb21JbiggZmFsc2UgKTsgfVxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnbWluaW1pemUnOlxyXG4gICAgICAgICAgLy8gdG9nZ2xlIHRvb2xiYXIgdmlzaWJpbGl0eVxyXG4gICAgICAgICAgU3RvcFByb3BhZ2F0aW9uUHJldmVudERlZmF1bHQoZSk7XHJcbiAgICAgICAgICBpZiggRy5WT00udG9vbGJhck1vZGUgPT0gJ3N0ZCcgKSB7XHJcbiAgICAgICAgICAgIFZpZXdlclRvb2xiYXJGb3JWaXNpYmlsaXR5TWluKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgVmlld2VyVG9vbGJhckZvclZpc2liaWxpdHlTdGQoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2Z1bGxTY3JlZW4nOlxyXG4gICAgICAgICAgLy8gVG9nZ2xlIHZpZXdlciBmdWxsc2NyZWVuIG1vZGUgb24vb2ZmXHJcbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgaWYoIG5nc2NyZWVuZnVsbC5lbmFibGVkICkge1xyXG4gICAgICAgICAgICBuZ3NjcmVlbmZ1bGwudG9nZ2xlKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdpbmZvJzpcclxuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICBJdGVtRGlzcGxheUluZm8oRy5WT00uTkdZMkl0ZW0oMCkpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnY2xvc2UnOlxyXG4gICAgICAgICAgU3RvcFByb3BhZ2F0aW9uUHJldmVudERlZmF1bHQoZSk7XHJcbiAgICAgICAgICBpZiggKG5ldyBEYXRlKCkuZ2V0VGltZSgpKSAtIEcuVk9NLnRpbWVJbWdDaGFuZ2VkIDwgNDAwICkgeyByZXR1cm47IH1cclxuICAgICAgICAgIENsb3NlSW50ZXJuYWxWaWV3ZXIoRy5WT00uY3Vyckl0ZW1JZHgpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZG93bmxvYWQnOlxyXG4gICAgICAgICAgU3RvcFByb3BhZ2F0aW9uUHJldmVudERlZmF1bHQoZSk7XHJcbiAgICAgICAgICBEb3dubG9hZEltYWdlKEcuVk9NLml0ZW1zW0cuVk9NLmN1cnJJdGVtSWR4XS5uZ3kySXRlbUlkeCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdzaGFyZSc6XHJcbiAgICAgICAgICBTdG9wUHJvcGFnYXRpb25QcmV2ZW50RGVmYXVsdChlKTtcclxuICAgICAgICAgIFBvcHVwU2hhcmUoRy5WT00uaXRlbXNbRy5WT00uY3Vyckl0ZW1JZHhdLm5neTJJdGVtSWR4KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2xpbmtPcmlnaW5hbCc6XHJcbiAgICAgICAgICBTdG9wUHJvcGFnYXRpb25QcmV2ZW50RGVmYXVsdChlKTtcclxuICAgICAgICAgIE9wZW5PcmlnaW5hbCggRy5WT00uTkdZMkl0ZW0oMCkgKTtcclxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdyb3RhdGVMZWZ0JzpcbiAgICAgICAgICBTdG9wUHJvcGFnYXRpb25QcmV2ZW50RGVmYXVsdChlKTtcbiAgICAgICAgICBWaWV3ZXJJbWFnZVJvdGF0ZSgtOTApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdyb3RhdGVSaWdodCc6XG4gICAgICAgICAgU3RvcFByb3BhZ2F0aW9uUHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgICAgVmlld2VySW1hZ2VSb3RhdGUoOTApO1xuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBjdXN0b20gYnV0dG9uXHJcbiAgICAgIHZhciBmdSA9IEcuTy5mbkltZ1Rvb2xiYXJDdXN0Q2xpY2s7XHJcbiAgICAgIGlmKCBuZ3kyYWN0aW9uLmluZGV4T2YoJ2N1c3RvbScpID09IDAgICYmIGZ1ICE9PSBudWxsICkge1xuICAgICAgICB0eXBlb2YgZnUgPT0gJ2Z1bmN0aW9uJyA/IGZ1KG5neTJhY3Rpb24sICR0aGlzLCBHLlZPTS5OR1kySXRlbSgwKSkgOiB3aW5kb3dbZnVdKG5neTJhY3Rpb24sICR0aGlzLCBHLlZPTS5OR1kySXRlbSgwKSk7XHJcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyByb3RhdGUgZGlzcGxheWVkIGltYWdlXG4gICAgZnVuY3Rpb24gVmlld2VySW1hZ2VSb3RhdGUoIGFuZ2xlICkge1xuICAgICAgdmFyIGl0ZW0gPSBHLlZPTS5OR1kySXRlbSgwKTtcbiAgICAgIGlmKCBpdGVtLm1lZGlhS2luZCA9PSAnaW1nJyApIHtcbiAgICAgICAgaXRlbS5yb3RhdGlvbkFuZ2xlICs9IGFuZ2xlO1xuICAgICAgICBpdGVtLnJvdGF0aW9uQW5nbGUgPSBpdGVtLnJvdGF0aW9uQW5nbGUgJSAzNjA7XG4gICAgICAgIGlmKCBpdGVtLnJvdGF0aW9uQW5nbGUgPCAwICkge1xuICAgICAgICAgIGl0ZW0ucm90YXRpb25BbmdsZSArPSAzNjA7XG4gICAgICAgIH1cbiAgICAgICAgVmlld2VyTWVkaWFQYW5YKCAwICk7XG4gICAgICAgIFZpZXdlck1lZGlhU2V0UG9zQW5kWm9vbU9uZSggRy5WT00uTkdZMkl0ZW0oMCksIEcuVk9NLiRtZWRpYUN1cnJlbnQsIHRydWUgKTtcbiAgICAgIH1cbiAgICB9XHJcbiAgICAgXHJcblxyXG4gICAgLy8gRGlzcGxheSBwaG90byBpbmZvc1xyXG4gICAgZnVuY3Rpb24gSXRlbURpc3BsYXlJbmZvKCBpdGVtICkge1xyXG5cclxuICAgICAgdmFyIGNvbnRlbnQgPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1UZXh0XCI+JyArIGl0ZW0udGl0bGUgKyAnPC9kaXY+JztcclxuICAgICAgY29udGVudCAgICArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1UZXh0XCI+JyArIGl0ZW0uZGVzY3JpcHRpb24gKyAnPC9kaXY+JztcclxuICAgICAgaWYoIGl0ZW0uYXV0aG9yICE9ICcnICkge1xuICAgICAgICBjb250ZW50ICArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1UZXh0XCI+JyArIEcuTy5pY29ucy51c2VyICsgJyAnICsgaXRlbS5hdXRob3IgKyAnPC9kaXY+JztcclxuICAgICAgfVxuICAgICAgaWYoIGl0ZW0uZXhpZi5tb2RlbCAhPSAnJyApIHtcclxuICAgICAgICBjb250ZW50ICArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1UZXh0XCI+JyArIEcuTy5pY29ucy5jb25maWcgKyAnICcgKyBpdGVtLmV4aWYubW9kZWwgKyAnPC9kaXY+JztcclxuICAgICAgfVxyXG4gICAgICB2YXIgc2V4aWYgPSAnJztcclxuICAgICAgc2V4aWYgKz0gaXRlbS5leGlmLmZsYXNoID09ICcnID8gJycgOiAnICZuYnNwOyAnICsgaXRlbS5leGlmLmZsYXNoO1xyXG4gICAgICBzZXhpZiArPSBpdGVtLmV4aWYuZm9jYWxsZW5ndGggPT0gJycgPyAnJyA6ICcgJm5ic3A7ICcgKyBpdGVtLmV4aWYuZm9jYWxsZW5ndGgrJ21tJztcclxuICAgICAgc2V4aWYgKz0gaXRlbS5leGlmLmZzdG9wID09ICcnID8gJycgOiAnICZuYnNwOyBmJyArIGl0ZW0uZXhpZi5mc3RvcDtcclxuICAgICAgc2V4aWYgKz0gaXRlbS5leGlmLmV4cG9zdXJlID09ICcnID8gJycgOiAnICZuYnNwOyAnICsgaXRlbS5leGlmLmV4cG9zdXJlKydzJztcclxuICAgICAgc2V4aWYgKz0gaXRlbS5leGlmLmlzbyA9PSAnJyA/ICcnIDogJyAmbmJzcDsgJyArIGl0ZW0uZXhpZi5pc28rJyBJU08nO1xyXG4gICAgICBpZiggaXRlbS5leGlmLnRpbWUgIT0gJycgKSB7XHJcbiAgICAgICAgLy8gdmFyIGRhdGUgPSBuZXcgRGF0ZShwYXJzZUludChpdGVtLmV4aWYudGltZSkpO1xyXG4gICAgICAgIC8vIHNleGlmICs9ICcgJm5ic3A7ICcrZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoKTtcclxuICAgICAgICBzZXhpZiArPSAnICZuYnNwOyAnICsgaXRlbS5leGlmLnRpbWU7XHJcbiAgICAgIH1cclxuICAgICAgY29udGVudCArPSAnPGRpdiBjbGFzcz1cIm5HWTJQb3B1cE9uZUl0ZW1UZXh0XCI+JyArIHNleGlmICsgJzwvZGl2Pic7XHJcblxyXG4gICAgICBpZiggaXRlbS5leGlmLmxvY2F0aW9uICE9ICcnICkge1xyXG4gICAgICAgIGNvbnRlbnQgKz0gJzxkaXYgY2xhc3M9XCJuR1kyUG9wdXBPbmVJdGVtVGV4dFwiPicrRy5PLmljb25zLmxvY2F0aW9uKycgPGEgaHJlZj1cImh0dHA6Ly9tYXBzLmdvb2dsZS5jb20vbWFwcz96PTEyJnQ9bSZxPScrZW5jb2RlVVJJQ29tcG9uZW50KGl0ZW0uZXhpZi5sb2NhdGlvbikrJ1wiIHRhcmdldD1cIl9ibGFua1wiPicraXRlbS5leGlmLmxvY2F0aW9uKyc8L2E+PC9kaXY+JztcclxuICAgICAgICAvLyBlbWJlZCBnb29nbGUgbWFwIGluIGlmcmFtZSAobm8gYXBpIGtleSByZXF1aXJlZClcclxuICAgICAgICBjb250ZW50ICs9ICc8aWZyYW1lIHdpZHRoPVwiMzAwXCIgaGVpZ2h0PVwiMTUwXCIgZnJhbWVib3JkZXI9XCIwXCIgc2Nyb2xsaW5nPVwibm9cIiBtYXJnaW5oZWlnaHQ9XCIwXCIgbWFyZ2lud2lkdGg9XCIwXCIgc3JjPVwiaHR0cHM6Ly9tYXBzLmdvb2dsZS5jb20vbWFwcz8mYW1wO3Q9bSZhbXA7cT0nK2VuY29kZVVSSUNvbXBvbmVudCggaXRlbS5leGlmLmxvY2F0aW9uICkgKycmYW1wO291dHB1dD1lbWJlZFwiPjwvaWZyYW1lPic7ICBcclxuICAgICAgfVxyXG5cclxuICAgICAgUG9wdXAoRy5PLmljb25zLnZpZXdlckluZm8sIGNvbnRlbnQsICdMZWZ0Jyk7XHJcbiAgIFxyXG4gICAgfVxyXG4gICAgXHJcblxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBUb29sYmFyQWRkRWx0KCBlbHQgKSB7XHJcbiAgICAgIHZhciByID0gJzxkaXYgY2xhc3M9XCJuZ2J0IG5neTJ2aWV3ZXJUb29sQWN0aW9uICcsXHJcbiAgICAgIGU9ZWx0LnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTsgICAgLy8gcmVtb3ZlIHRyYWlsaW5nL2xlYWRpbmcgd2hpdGVzcGFjZVxyXG4gICAgICBzd2l0Y2goIGUgKSB7XHJcbiAgICAgICAgY2FzZSAnbWluaW1pemVCdXR0b24nOlxyXG4gICAgICAgICAgdmFyIGljID0gRy5PLmljb25zLnZpZXdlclRvb2xiYXJNaW47XHJcbiAgICAgICAgICBpZiggRy5WT00udG9vbGJhck1vZGUgPT0gJ21pbicgKSB7XHJcbiAgICAgICAgICAgIGljID0gRy5PLmljb25zLnZpZXdlclRvb2xiYXJTdGQ7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByICs9ICdtaW5pbWl6ZUJ1dHRvbiBuR0V2ZW50XCIgZGF0YS1uZ3kyYWN0aW9uPVwibWluaW1pemVcIj4nK2ljKyc8L2Rpdj4nO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncHJldmlvdXNCdXR0b24nOlxyXG4gICAgICAgICAgciArPSAncHJldmlvdXNCdXR0b24gbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cInByZXZpb3VzXCI+JytHLk8uaWNvbnMudmlld2VyUHJldmlvdXMrJzwvZGl2Pic7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdwYWdlQ291bnRlcic6XHJcbiAgICAgICAgICByICs9ICdwYWdlQ291bnRlciBuR0V2ZW50XCI+PC9kaXY+JztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ25leHRCdXR0b24nOlxyXG4gICAgICAgICAgciArPSAnbmV4dEJ1dHRvbiBuR0V2ZW50XCIgZGF0YS1uZ3kyYWN0aW9uPVwibmV4dFwiPicrRy5PLmljb25zLnZpZXdlck5leHQrJzwvZGl2Pic7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdwbGF5UGF1c2VCdXR0b24nOlxyXG4gICAgICAgICAgciArPSAncGxheUJ1dHRvbiBwbGF5UGF1c2VCdXR0b24gbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cInBsYXlQYXVzZVwiPicrRy5PLmljb25zLnZpZXdlclBsYXkrJzwvZGl2Pic7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdyb3RhdGVMZWZ0JzpcclxuICAgICAgICAgIHIgKz0gJ3JvdGF0ZUxlZnRCdXR0b24gbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cInJvdGF0ZUxlZnRcIj4nK0cuTy5pY29ucy52aWV3ZXJSb3RhdGVMZWZ0Kyc8L2Rpdj4nO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncm90YXRlUmlnaHQnOlxyXG4gICAgICAgICAgciArPSAncm90YXRlUmlnaHRCdXR0b24gbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cInJvdGF0ZVJpZ2h0XCI+JytHLk8uaWNvbnMudmlld2VyUm90YXRlUmlnaHQrJzwvZGl2Pic7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdkb3dubG9hZEJ1dHRvbic6XHJcbiAgICAgICAgICByICs9ICdkb3dubG9hZEJ1dHRvbiBuR0V2ZW50XCIgZGF0YS1uZ3kyYWN0aW9uPVwiZG93bmxvYWRcIj4nK0cuTy5pY29ucy52aWV3ZXJEb3dubG9hZCsnPC9kaXY+JztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ3pvb21CdXR0b24nOlxyXG4gICAgICAgICAgciArPSAnbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cInpvb21JblwiPicrRy5PLmljb25zLnZpZXdlclpvb21JbisnPC9kaXY+PGRpdiBjbGFzcz1cIm5nYnQgbmd5MnZpZXdlclRvb2xBY3Rpb24gbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cInpvb21PdXRcIj4nK0cuTy5pY29ucy52aWV3ZXJab29tT3V0Kyc8L2Rpdj4nO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnZnVsbHNjcmVlbkJ1dHRvbic6XHJcbiAgICAgICAgICB2YXIgcyA9IEcuTy5pY29ucy52aWV3ZXJGdWxsc2NyZWVuT247XHJcbiAgICAgICAgICBpZiggbmdzY3JlZW5mdWxsLmVuYWJsZWQgJiYgRy5WT00udmlld2VySXNGdWxsc2NyZWVuICkge1xyXG4gICAgICAgICAgICBzID0gRy5PLmljb25zLnZpZXdlckZ1bGxzY3JlZW5PZmY7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByICs9ICdzZXRGdWxsc2NyZWVuQnV0dG9uIGZ1bGxzY3JlZW5CdXR0b24gbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cImZ1bGxTY3JlZW5cIj4nK3MrJzwvZGl2Pic7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdpbmZvQnV0dG9uJzpcclxuICAgICAgICAgIHIgKz0gJ2luZm9CdXR0b24gbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cImluZm9cIj4nK0cuTy5pY29ucy52aWV3ZXJJbmZvKyc8L2Rpdj4nO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnbGlua09yaWdpbmFsQnV0dG9uJzpcclxuICAgICAgICAgIHIgKz0gJ2xpbmtPcmlnaW5hbEJ1dHRvbiBuR0V2ZW50XCIgZGF0YS1uZ3kyYWN0aW9uPVwibGlua09yaWdpbmFsXCI+JyArIEcuTy5pY29ucy52aWV3ZXJMaW5rT3JpZ2luYWwgKyAnPC9kaXY+JztcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2Nsb3NlQnV0dG9uJzpcclxuICAgICAgICAgIHIgKz0gJ2Nsb3NlQnV0dG9uIG5HRXZlbnRcIiBkYXRhLW5neTJhY3Rpb249XCJjbG9zZVwiPicrRy5PLmljb25zLmJ1dHRvbkNsb3NlKyc8L2Rpdj4nO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnc2hhcmVCdXR0b24nOlxyXG4gICAgICAgICAgciArPSAnbkdFdmVudFwiIGRhdGEtbmd5MmFjdGlvbj1cInNoYXJlXCI+JytHLk8uaWNvbnMudmlld2VyU2hhcmUrJzwvZGl2Pic7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdsYWJlbCc6XHJcbiAgICAgICAgICByICs9ICdcIj48ZGl2IGNsYXNzPVwidGl0bGUgbkdFdmVudFwiIGl0ZW1wcm9wPVwibmFtZVwiPjwvZGl2PjxkaXYgY2xhc3M9XCJkZXNjcmlwdGlvbiBuR0V2ZW50XCIgaXRlbXByb3A9XCJkZXNjcmlwdGlvblwiPjwvZGl2PjwvZGl2Pic7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgLy8gY3VzdG9tIGJ1dHRvblxyXG4gICAgICAgICAgaWYoIGUuaW5kZXhPZignY3VzdG9tJykgPT0gMCApIHtcclxuICAgICAgICAgICAgdmFyIHQgPSAnJztcclxuICAgICAgICAgICAgLy8gY29udGVudCB0byBkaXNwbGF5IGZyb20gY3VzdG9tIHNjcmlwdFxuICAgICAgICAgICAgdmFyIGZ1ID0gRy5PLmZuSW1nVG9vbGJhckN1c3RJbml0O1xyXG4gICAgICAgICAgICBpZiggZnUgIT09IG51bGwgKSB7XHJcbiAgICAgICAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdShlKSA6IHdpbmRvd1tmdV0oZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIHQgPT0gdW5kZWZpbmVkIHx8IHQgPT0gJycgKSB7XHJcbiAgICAgICAgICAgICAgLy8gY29udGVudCBmcm9tIGljb25zXHJcbiAgICAgICAgICAgICAgdmFyIG4gPSBlLnN1YnN0cmluZyg2KTtcclxuICAgICAgICAgICAgICB0ID0gRy5PLmljb25zWyd2aWV3ZXJDdXN0b21Ub29sJytuXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByICs9ICduZ3kyQ3VzdG9tQnRuICcgKyBlICsgJyBuR0V2ZW50XCIgZGF0YS1uZ3kyYWN0aW9uPVwiJyArIGUgKyAnXCI+JyArIHQgKyAnPC9kaXY+JztcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByID0gJyc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gcjtcclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyB0b2dnbGUgc2xpZGVzaG93IG1vZGUgb24vb2ZmXHJcbiAgICBmdW5jdGlvbiBTbGlkZXNob3dUb2dnbGUoKXtcclxuICAgICAgaWYoIEcuVk9NLnBsYXlTbGlkZXNob3cgKSB7XHJcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChHLlZPTS5wbGF5U2xpZGVzaG93VGltZXJJRCk7XHJcbiAgICAgICAgRy5WT00ucGxheVNsaWRlc2hvdyA9IGZhbHNlO1xyXG4gICAgICAgIEcuVk9NLiR2aWV3ZXIuZmluZCgnLnBsYXlQYXVzZUJ1dHRvbicpLmh0bWwoRy5PLmljb25zLnZpZXdlclBsYXkpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIEcuVk9NLnBsYXlTbGlkZXNob3cgPSB0cnVlO1xyXG4gICAgICAgIERpc3BsYXlOZXh0TWVkaWEoKTtcclxuICAgICAgICBHLlZPTS4kdmlld2VyLmZpbmQoJy5wbGF5UGF1c2VCdXR0b24nKS5odG1sKEcuTy5pY29ucy52aWV3ZXJQYXVzZSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBWaWV3ZXJUb29sYmFyRm9yVmlzaWJpbGl0eVN0ZCgpIHtcclxuICAgICAgRy5WT00udG9vbGJhck1vZGUgPSAnc3RkJztcclxuICAgICAgXHJcbiAgICAgIHZhciBzVEIgPSAnJztcclxuICAgICAgdmFyIHQgPSBHLk8udmlld2VyVG9vbGJhci5zdGFuZGFyZC5zcGxpdCgnLCcpO1xyXG4gICAgICBmb3IoIHZhciBpID0gMCwgbHQgPSB0Lmxlbmd0aDsgaSA8IGx0OyBpKyspIHtcclxuICAgICAgICBzVEIgKz0gVG9vbGJhckFkZEVsdCggdFtpXSApO1xyXG4gICAgICB9XHJcbiAgICAgIEcuVk9NLiR0b29sYmFyLmZpbmQoJy50b29sYmFyJykuaHRtbChzVEIpO1xyXG4gICAgICBWaWV3ZXJUb29sYmFyRWxlbWVudENvbnRlbnQoKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVmlld2VyVG9vbGJhckZvclZpc2liaWxpdHlNaW4oKSB7XHJcbiAgICAgIGlmKCBHLk8udmlld2VyVG9vbGJhci5taW5pbWl6ZWQgPT0gdW5kZWZpbmVkIHx8IEcuTy52aWV3ZXJUb29sYmFyLm1pbmltaXplZCA9PSAnJyApIHtcclxuICAgICAgICBWaWV3ZXJUb29sYmFyRm9yVmlzaWJpbGl0eVN0ZCgpO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIEcuVk9NLnRvb2xiYXJNb2RlID0gJ21pbic7XHJcbiAgICAgICAgdmFyIHNUQiA9ICcnO1xyXG4gICAgICAgIHZhciB0ID0gRy5PLnZpZXdlclRvb2xiYXIubWluaW1pemVkLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgZm9yKCB2YXIgaSA9IDAsIGx0ID0gdC5sZW5ndGg7IGkgPCBsdDsgaSsrKSB7XHJcbiAgICAgICAgICBzVEIgKz0gVG9vbGJhckFkZEVsdCggdFtpXSApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBHLlZPTS4kdG9vbGJhci5maW5kKCcudG9vbGJhcicpLmh0bWwoc1RCKTtcclxuICAgICAgICBWaWV3ZXJUb29sYmFyRWxlbWVudENvbnRlbnQoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBWaWV3ZXJUb29sYmFyRWxlbWVudENvbnRlbnQoKSB7XHJcbiAgICBcclxuICAgICAgdmFyIHZvbUlkeD1HLlZPTS5jdXJySXRlbUlkeDtcclxuICAgICAgaWYoIHZvbUlkeCA9PSBudWxsICkgeyByZXR1cm47IH1cclxuICAgICAgXHJcbiAgICAgIHZhciBpdGVtPUcuVk9NLk5HWTJJdGVtKDApO1xyXG4gICAgXHJcbiAgICAgIC8vIExBQkVMXHJcbiAgICAgIHZhciBzZXRUeHQgPSBmYWxzZTtcclxuICAgICAgLy8gc2V0IHRpdGxlXHJcbiAgICAgIGlmKCBpdGVtLnRpdGxlICE9PSB1bmRlZmluZWQgJiYgaXRlbS50aXRsZSAhPSAnJyApIHtcclxuICAgICAgICBHLlZPTS4kdmlld2VyLmZpbmQoJy5uZ3kydmlld2VyVG9vbEFjdGlvbicpLmZpbmQoJy50aXRsZScpLmh0bWwoaXRlbS50aXRsZSk7XHJcbiAgICAgICAgc2V0VHh0ID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBHLlZPTS4kdmlld2VyLmZpbmQoJy5uZ3kydmlld2VyVG9vbEFjdGlvbicpLmZpbmQoJy50aXRsZScpLmh0bWwoJycpO1xyXG4gICAgICB9XHJcbiAgICAgIC8vIHNldCBkZXNjcmlwdGlvblxyXG4gICAgICBpZiggaXRlbS5kZXNjcmlwdGlvbiAhPT0gdW5kZWZpbmVkICYmIGl0ZW0uZGVzY3JpcHRpb24gIT0gJycgKSB7XHJcbiAgICAgICAgRy5WT00uJHZpZXdlci5maW5kKCcubmd5MnZpZXdlclRvb2xBY3Rpb24nKS5maW5kKCcuZGVzY3JpcHRpb24nKS5odG1sKGl0ZW0uZGVzY3JpcHRpb24pO1xyXG4gICAgICAgIHNldFR4dCA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgRy5WT00uJHZpZXdlci5maW5kKCcubmd5MnZpZXdlclRvb2xBY3Rpb24nKS5maW5kKCcuZGVzY3JpcHRpb24nKS5odG1sKCcnKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYoIHNldFR4dCApIHtcclxuICAgICAgICBHLlZPTS4kdmlld2VyLmZpbmQoJy5uZ3kydmlld2VyVG9vbEFjdGlvbicpLmZpbmQoJy5sYWJlbCcpLnNob3coKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBHLlZPTS4kdmlld2VyLmZpbmQoJy5uZ3kydmlld2VyVG9vbEFjdGlvbicpLmZpbmQoJy5sYWJlbCcpLmhpZGUoKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gc2V0IHBhZ2UgbnVtYmVyXHJcbiAgICAgIHZhciB2aWV3ZXJNYXhJbWFnZXMgPSBHLlZPTS5pdGVtcy5sZW5ndGg7XHJcbiAgICAgIGlmKCB2aWV3ZXJNYXhJbWFnZXMgPiAwICkge1xyXG4gICAgICAgIEcuVk9NLiR2aWV3ZXIuZmluZCgnLnBhZ2VDb3VudGVyJykuaHRtbCgoRy5WT00uaXRlbXNbdm9tSWR4XS5tZWRpYU51bWJlcikrJy8nK3ZpZXdlck1heEltYWdlcyk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIGN1c3RvbSBlbGVtZW50c1xyXG4gICAgICB2YXIgJGN1ID0gRy5WT00uJHZpZXdlci5maW5kKCcubmd5MkN1c3RvbUJ0bicpO1xyXG4gICAgICB2YXIgZnUgPSBHLk8uZm5JbWdUb29sYmFyQ3VzdERpc3BsYXk7XHJcbiAgICAgIGlmKCAkY3UubGVuZ3RoID4gMCAmJiBmdSAhPT0gbnVsbCApIHtcbiAgICAgICAgdHlwZW9mIGZ1ID09ICdmdW5jdGlvbicgPyBmdSgkY3UsIGl0ZW0pIDogd2luZG93W2Z1XSgkY3UsIGl0ZW0pO1xyXG4gICAgICB9XG4gICAgICBcclxuICAgICAgLy8gc2V0IGV2ZW50IGhhbmRsZXJzIGFnYWluXHJcbiAgICAgIFZpZXdlclRvb2xzT24oKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUGFuIHRoZSBtZWRpYSBjb250YWluZXIgaW4gdGhlIGxpZ2h0Ym94IChsZWZ0L3JpZ2h0KVxyXG4gICAgZnVuY3Rpb24gVmlld2VyTWVkaWFQYW5YKCBwb3NYICkge1xyXG4gICAgICBHLlZPTS5zd2lwZVBvc1ggPSBwb3NYO1xyXG4gICAgICBpZiggRy5DU1N0cmFuc2Zvcm1OYW1lID09IG51bGwgKSB7XHJcbiAgICAgICAgLy8gbm8gcGFuIGlmIENTUyB0cmFuc2Zvcm0gbm90IHN1cHBvcnRlZFxyXG4gICAgICAgIC8vIEcuVk9NLiRtZWRpYUN1cnJlbnQuY3NzKHsgbGVmdDogcG9zWCB9KTsgXHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgIFxyXG4gICAgICAgIC8vIHBhbiBsZWZ0L3JpZ2h0IHRoZSBjdXJyZW50IG1lZGlhXHJcbiAgICAgICAgLy8gd2luZG93Lm5nX2RyYWYoIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgRy5WT00uJG1lZGlhQ3VycmVudFswXS5zdHlsZVtHLkNTU3RyYW5zZm9ybU5hbWVdID0gJ3RyYW5zbGF0ZSgnICsgcG9zWCArICdweCwgMHB4KSc7XHJcbiAgICAgICAgLy8gfSk7XHJcblxyXG4gICAgICAgIHZhciBpdGVtUHJldmlvdXMgPSBHLlZPTS5OR1kySXRlbSgtMSk7XG4gICAgICAgIHZhciBpdGVtTmV4dCA9IEcuVk9NLk5HWTJJdGVtKDEpO1xuICAgICAgICBcclxuICAgICAgICAvLyBuZXh0L3ByZXZpb3VzIG1lZGlhXHJcbiAgICAgICAgaWYoICBHLk8uaW1hZ2VUcmFuc2l0aW9uLnN0YXJ0c1dpdGgoJ1NXSVBFJykgKSB7XHJcbiAgICAgICAgICBpZiggaXRlbVByZXZpb3VzLm1lZGlhVHJhbnNpdGlvbigpICkge1xyXG4gICAgICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoRy5WT00uTkdZMkl0ZW0oLTEpLCBHLlZPTS4kbWVkaWFQcmV2aW91cywgMSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBpZiggaXRlbU5leHQubWVkaWFUcmFuc2l0aW9uKCkgKSB7XHJcbiAgICAgICAgICAgIFZpZXdlclNldE1lZGlhVmlzaWJpbGl0eShHLlZPTS5OR1kySXRlbSgxKSwgRy5WT00uJG1lZGlhTmV4dCwgMSk7XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgdmFyIHNjID0gTWF0aC5taW4oIE1hdGgubWF4KCBNYXRoLmFicyhwb3NYKSAvIEcuVk9NLndpbmRvdy5sYXN0V2lkdGgsIC44KSwgMSk7XHJcbiAgICAgICAgICBpZiggRy5PLmltYWdlVHJhbnNpdGlvbiA9PSAnU1dJUEUnICkgeyBzYyA9IDE7IH1cclxuXHJcbiAgICAgICAgICBpZiggcG9zWCA+IDAgKSB7XHJcbiAgICAgICAgICAgIHZhciBkaXIgPSBHLlZPTS53aW5kb3cubGFzdFdpZHRoO1xuICAgICAgICAgICAgaWYoIGl0ZW1QcmV2aW91cy5tZWRpYVRyYW5zaXRpb24oKSApIHtcclxuICAgICAgICAgICAgICAvLyB3aW5kb3cubmdfZHJhZiggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBHLlZPTS4kbWVkaWFQcmV2aW91c1swXS5zdHlsZVtHLkNTU3RyYW5zZm9ybU5hbWVdID0gJ3RyYW5zbGF0ZSgnICsgKC1kaXIgKyBwb3NYKSArICdweCwgMHB4KSBzY2FsZSgnICsgc2MgKyAnKSc7XHJcbiAgICAgICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYoIGl0ZW1OZXh0Lm1lZGlhVHJhbnNpdGlvbigpICkge1xyXG4gICAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIEcuVk9NLiRtZWRpYU5leHRbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXSA9ICd0cmFuc2xhdGUoJyArIChkaXIpICsgJ3B4LCAwcHgpIHNjYWxlKCcgKyBzYyArICcpJztcclxuICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBkaXIgPSAtRy5WT00ud2luZG93Lmxhc3RXaWR0aDtcclxuICAgICAgICAgICAgaWYoIGl0ZW1OZXh0Lm1lZGlhVHJhbnNpdGlvbigpICkge1xyXG4gICAgICAgICAgICAgIC8vIHdpbmRvdy5uZ19kcmFmKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIEcuVk9NLiRtZWRpYU5leHRbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXSA9ICd0cmFuc2xhdGUoJyArICgtZGlyICsgcG9zWCkgKyAncHgsIDBweCkgc2NhbGUoJyArIHNjICsgJyknO1xyXG4gICAgICAgICAgICAgIC8vIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCBpdGVtUHJldmlvdXMubWVkaWFUcmFuc2l0aW9uKCkgKSB7XHJcbiAgICAgICAgICAgICAgLy8gd2luZG93Lm5nX2RyYWYoIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgRy5WT00uJG1lZGlhUHJldmlvdXNbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXSA9ICd0cmFuc2xhdGUoJyArIChkaXIpICsgJ3B4LCAwcHgpIHNjYWxlKCcgKyBzYyArICcpJztcclxuICAgICAgICAgICAgICAvLyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBpZiggIEcuTy5pbWFnZVRyYW5zaXRpb24gPT0gJ1NMSURFQVBQRUFSJyApIHtcclxuICAgICAgICAgIEcuVk9NLiRtZWRpYVByZXZpb3VzWzBdLnN0eWxlW0cuQ1NTdHJhbnNmb3JtTmFtZV0gPSAnJztcclxuICAgICAgICAgIEcuVk9NLiRtZWRpYU5leHRbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXSA9ICcnO1xyXG4gICAgICAgICAgaWYoIHBvc1ggPCAwICkge1xyXG4gICAgICAgICAgICB2YXIgbyA9ICgtcG9zWCkgLyBHLlZPTS53aW5kb3cubGFzdFdpZHRoO1xyXG4gICAgICAgICAgICBpZiggaXRlbU5leHQubWVkaWFUcmFuc2l0aW9uKCkgKSB7XHJcbiAgICAgICAgICAgICAgVmlld2VyU2V0TWVkaWFWaXNpYmlsaXR5KGl0ZW1OZXh0LCBHLlZPTS4kbWVkaWFOZXh0LCBvKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiggaXRlbVByZXZpb3VzLm1lZGlhVHJhbnNpdGlvbigpICkge1xyXG4gICAgICAgICAgICAgIFZpZXdlclNldE1lZGlhVmlzaWJpbGl0eShpdGVtUHJldmlvdXMsIEcuVk9NLiRtZWRpYVByZXZpb3VzLCAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBvID0gcG9zWCAvIEcuVk9NLndpbmRvdy5sYXN0V2lkdGg7XHJcbiAgICAgICAgICAgIGlmKCBpdGVtUHJldmlvdXMubWVkaWFUcmFuc2l0aW9uKCkgKSB7XHJcbiAgICAgICAgICAgICAgVmlld2VyU2V0TWVkaWFWaXNpYmlsaXR5KGl0ZW1QcmV2aW91cywgRy5WT00uJG1lZGlhUHJldmlvdXMsIG8pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCBpdGVtTmV4dC5tZWRpYVRyYW5zaXRpb24oKSApIHtcclxuICAgICAgICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoaXRlbU5leHQsIEcuVk9NLiRtZWRpYU5leHQsIDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIERpc3BsYXkgbmV4dCBpbWFnZVxyXG4gICAgZnVuY3Rpb24gRGlzcGxheU5leHRNZWRpYSgpIHtcclxuICAgICAgaWYoIEcuVk9NLnZpZXdlck1lZGlhSXNDaGFuZ2VkIHx8ICgobmV3IERhdGUoKS5nZXRUaW1lKCkpIC0gRy5WT00udGltZUltZ0NoYW5nZWQgPCAzMDApICkgeyByZXR1cm47IH1cclxuICAgICAgXHJcbiAgICAgIFRyaWdnZXJDdXN0b21FdmVudCgnbGlnaHRib3hOZXh0SW1hZ2UnKTtcclxuICAgICAgRGlzcGxheUludGVybmFsVmlld2VyKEcuVk9NLklkeE5leHQoKSwgJ25leHRJbWFnZScpO1xyXG4gICAgfTtcclxuICAgIFxyXG4gICAgLy8gRGlzcGxheSBwcmV2aW91cyBpbWFnZVxyXG4gICAgZnVuY3Rpb24gRGlzcGxheVByZXZpb3VzTWVkaWEoKSB7XHJcbiAgICAgIGlmKCBHLlZPTS52aWV3ZXJNZWRpYUlzQ2hhbmdlZCB8fCAoKG5ldyBEYXRlKCkuZ2V0VGltZSgpKSAtIEcuVk9NLnRpbWVJbWdDaGFuZ2VkIDwgMzAwKSApIHsgcmV0dXJuOyB9XHJcbiAgICAgIGlmKCBHLlZPTS5wbGF5U2xpZGVzaG93ICkge1xyXG4gICAgICAgIFNsaWRlc2hvd1RvZ2dsZSgpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBUcmlnZ2VyQ3VzdG9tRXZlbnQoJ2xpZ2h0Ym94UHJldmlvdXNJbWFnZScpO1xyXG4gICAgICBEaXNwbGF5SW50ZXJuYWxWaWV3ZXIoRy5WT00uSWR4UHJldmlvdXMoKSwgJ3ByZXZpb3VzSW1hZ2UnKTtcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIERpc3BsYXkgaW1hZ2UgKGFuZCBydW4gYW5pbWF0aW9uKVxyXG4gICAgZnVuY3Rpb24gRGlzcGxheUludGVybmFsVmlld2VyKCBuZXdWb21JZHgsIGRpc3BsYXlUeXBlICkge1xyXG5cclxuICAgICAgaWYoIEcuVk9NLnBsYXlTbGlkZXNob3cgKSB7IHdpbmRvdy5jbGVhclRpbWVvdXQoRy5WT00ucGxheVNsaWRlc2hvd1RpbWVySUQpOyB9XHJcbiAgICAgIFxyXG4gICAgICB2YXIgaXRlbU9sZCA9IEcuVk9NLk5HWTJJdGVtKDApO1xuICAgICAgdmFyIGl0ZW1OZXcgPSBHLklbRy5WT00uaXRlbXNbbmV3Vm9tSWR4XS5uZ3kySXRlbUlkeF07XHJcbiAgICAgIHZhciAkbmV3ID0gKGRpc3BsYXlUeXBlID09ICduZXh0SW1hZ2UnID8gRy5WT00uJG1lZGlhTmV4dCA6IEcuVk9NLiRtZWRpYVByZXZpb3VzKTtcclxuICAgICAgaWYoIGRpc3BsYXlUeXBlID09ICduZXh0SW1hZ2UnICkge1xyXG4gICAgICAgIFZpZXdlclNldE1lZGlhVmlzaWJpbGl0eShHLlZPTS5OR1kySXRlbSgtMSksIEcuVk9NLiRtZWRpYVByZXZpb3VzLCAwKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoRy5WT00uTkdZMkl0ZW0oMSksIEcuVk9NLiRtZWRpYU5leHQsIDApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBHLlZPTS50aW1lSW1nQ2hhbmdlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICBHLlZPTS52aWV3ZXJNZWRpYUlzQ2hhbmdlZCA9IHRydWU7XHJcbiAgICAgIEcuVk9NLnpvb20uaXNab29taW5nID0gZmFsc2U7XHJcbiAgICAgIFJlc2l6ZUludGVybmFsVmlld2VyKHRydWUpO1xyXG4gXHJcbiAgICAgIGlmKCBHLk8uZGVidWdNb2RlICYmIGNvbnNvbGUudGltZWxpbmUgKSB7IGNvbnNvbGUudGltZWxpbmUoJ25hbm9nYWxsZXJ5Ml92aWV3ZXInKTsgfVxyXG5cclxuICAgICAgU2V0TG9jYXRpb25IYXNoKCBpdGVtTmV3LmFsYnVtSUQsIGl0ZW1OZXcuR2V0SUQoKSApO1xyXG4gICAgICBcclxuICAgICAgLy8gYW5pbWF0aW9uIGR1cmF0aW9uIGlzIHByb3BvcnRpb25hbCBvZiB0aGUgcmVtYWluaW5nIGRpc3RhbmNlXHJcbiAgICAgIHZhciB2UCA9IEcuR09NLmNhY2hlLnZpZXdwb3J0O1xyXG4gICAgICB2YXIgZHVyID0gNDAwICogKHZQLncgLSBNYXRoLmFicyhHLlZPTS5zd2lwZVBvc1gpKSAvIHZQLnc7XHJcbiAgICAgIFxyXG4gICAgICBpZiggZGlzcGxheVR5cGUgPT0gJycgKSB7XHJcbiAgICAgICAgLy8gZmlyc3QgaW1hZ2UgLS0+IGp1c3QgYXBwZWFyIC8gbm8gc2xpZGUgYW5pbWF0aW9uXHJcbiAgICAgICAgVmlld2VyU2V0TWVkaWFWaXNpYmlsaXR5KEcuVk9NLk5HWTJJdGVtKDApLCBHLlZPTS4kbWVkaWFDdXJyZW50LCAxKTtcclxuICAgICAgICBpZiggRy5DU1N0cmFuc2Zvcm1OYW1lID09IG51bGwgKSB7XHJcbiAgICAgICAgICAvLyBubyBDU1MgdHJhbnNmb3JtIHN1cHBvcnQgLT4gbm8gYW5pbWF0aW9uXHJcbiAgICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoaXRlbU5ldywgJG5ldywgMSk7XHJcbiAgICAgICAgICBEaXNwbGF5SW50ZXJuYWxWaWV3ZXJDb21wbGV0ZShkaXNwbGF5VHlwZSwgbmV3Vm9tSWR4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoaXRlbU5ldywgJG5ldywgMCk7XHJcbiAgICAgICAgICBuZXcgTkdUd2VlbmFibGUoKS50d2Vlbih7XHJcbiAgICAgICAgICAgIGZyb206ICAgICAgICAgeyBvcGFjaXR5OiAwIH0sXHJcbiAgICAgICAgICAgIHRvOiAgICAgICAgICAgeyBvcGFjaXR5OiAxIH0sXHJcbiAgICAgICAgICAgIGF0dGFjaG1lbnQ6ICAgeyBkVDogZGlzcGxheVR5cGUsIGl0ZW06IGl0ZW1PbGQgfSxcclxuICAgICAgICAgICAgZWFzaW5nOiAgICAgICAnZWFzZUluT3V0U2luZScsXHJcbiAgICAgICAgICAgIGRlbGF5OiAgICAgICAgMzAsXHJcbiAgICAgICAgICAgIGR1cmF0aW9uOiAgICAgNDAwLFxyXG4gICAgICAgICAgICBzdGVwOiAgICAgICAgIGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgLy8gdXNpbmcgc2NhbGUgaXMgbm90IGEgZ29vZCBpZGVhIG9uIENocm9tZSAtPiBpbWFnZSB3aWxsIGJlIGJsdXJyZWRcclxuICAgICAgICAgICAgICBHLlZPTS4kY29udGVudC5jc3MoJ29wYWNpdHknLCBzdGF0ZS5vcGFjaXR5KTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZmluaXNoOiAgICAgICBmdW5jdGlvbiAoc3RhdGUsIGF0dCkge1xyXG4gICAgICAgICAgICAgIFZpZXdlclRvb2xzVW5IaWRlKCk7XHJcbiAgICAgICAgICAgICAgRGlzcGxheUludGVybmFsVmlld2VyQ29tcGxldGUoYXR0LmRULCBuZXdWb21JZHgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgLy8gYW5pbWF0ZSB0aGUgaW1hZ2UgdHJhbnNpdGlvbiBiZXR3ZWVuIDIgaW1hZ2VzXHJcbiAgICAgICAgaWYoIEcuQ1NTdHJhbnNmb3JtTmFtZSA9PSBudWxsICApIHtcclxuICAgICAgICAgIC8vIG5vIENTUyB0cmFuc2Zvcm0gc3VwcG9ydCAtPiBubyBhbmltYXRpb25cclxuICAgICAgICAgIFZpZXdlclNldE1lZGlhVmlzaWJpbGl0eShpdGVtTmV3LCAkbmV3LCAxKTtcclxuICAgICAgICAgIFZpZXdlclNldE1lZGlhVmlzaWJpbGl0eShHLlZPTS5OR1kySXRlbSgwKSwgRy5WT00uJG1lZGlhQ3VycmVudCwgMSk7XHJcbiAgICAgICAgICBEaXNwbGF5SW50ZXJuYWxWaWV3ZXJDb21wbGV0ZShkaXNwbGF5VHlwZSwgbmV3Vm9tSWR4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBzd2l0Y2goIEcuTy5pbWFnZVRyYW5zaXRpb24gKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ1NXSVBFJzpcclxuICAgICAgICAgICAgY2FzZSAnU1dJUEUyJzpcclxuICAgICAgICAgICAgICB2YXIgZGlyID0gKCBkaXNwbGF5VHlwZSA9PSAnbmV4dEltYWdlJyA/IC0gdlAudyA6IHZQLncgKTtcclxuICAgICAgICAgICAgICAkbmV3WzBdLnN0eWxlW0cuQ1NTdHJhbnNmb3JtTmFtZV0gPSAndHJhbnNsYXRlKCcrKC1kaXIpKydweCwgMHB4KSAnXHJcblxyXG4gICAgICAgICAgICAgIG5ldyBOR1R3ZWVuYWJsZSgpLnR3ZWVuKHtcclxuICAgICAgICAgICAgICAgIGZyb206ICAgICAgICAgeyB0OiBHLlZPTS5zd2lwZVBvc1ggIH0sXHJcbiAgICAgICAgICAgICAgICB0bzogICAgICAgICAgIHsgdDogKGRpc3BsYXlUeXBlID09ICduZXh0SW1hZ2UnID8gLSB2UC53IDogdlAudykgfSxcclxuICAgICAgICAgICAgICAgIGF0dGFjaG1lbnQ6ICAgeyBkVDogZGlzcGxheVR5cGUsICRlOiAkbmV3LCBpdGVtTmV3OiBpdGVtTmV3LCBpdGVtT2xkOiBpdGVtT2xkLCBkaXI6IGRpciB9LFxyXG4gICAgICAgICAgICAgICAgZGVsYXk6ICAgICAgICAzMCxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAgICAgZHVyLFxyXG4gICAgICAgICAgICAgICAgZWFzaW5nOiAgICAgICAoRy5PLmltYWdlVHJhbnNpdGlvbiA9PSAnc3dpcGUnID8gJ2Vhc2VJbk91dFNpbmUnIDogJ2Vhc2VJbk91dEN1YmljJyksXHJcbiAgICAgICAgICAgICAgICBzdGVwOiAgICAgICAgIGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgbWVkaWFcclxuICAgICAgICAgICAgICAgICAgVmlld2VyU2V0TWVkaWFWaXNpYmlsaXR5KEcuVk9NLk5HWTJJdGVtKDApLCBHLlZPTS4kbWVkaWFDdXJyZW50LCAxKTtcclxuICAgICAgICAgICAgICAgICAgLy8gRy5WT00uJG1lZGlhQ3VycmVudFswXS5zdHlsZVtHLkNTU3RyYW5zZm9ybU5hbWVdID0gJ3RyYW5zbGF0ZSgnICsgc3RhdGUudCArICdweCwgMHB4KSByb3RhdGUoJyArIGF0dC5pdGVtT2xkLnJvdGF0aW9uQW5nbGUgKyAnZGVnKSc7XG4gICAgICAgICAgICAgICAgICBHLlZPTS4kbWVkaWFDdXJyZW50WzBdLnN0eWxlW0cuQ1NTdHJhbnNmb3JtTmFtZV0gPSAndHJhbnNsYXRlKCcgKyBzdGF0ZS50ICsgJ3B4LCAwcHgpJztcclxuICAgICAgICAgICAgICAgICAgLy8gbmV3IG1lZGlhXHJcbiAgICAgICAgICAgICAgICAgIGlmKCBhdHQuaXRlbU5ldy5tZWRpYVRyYW5zaXRpb24oKSApIHtcclxuICAgICAgICAgICAgICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoYXR0Lml0ZW1OZXcsIGF0dC4kZSwgMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzYyA9IE1hdGgubWluKCBNYXRoLm1heCggKE1hdGguYWJzKHN0YXRlLnQpKSAvIEcuVk9NLndpbmRvdy5sYXN0V2lkdGgsIC44KSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoIEcuTy5pbWFnZVRyYW5zaXRpb24gPT0gJ1NXSVBFJyApIHsgc2MgPSAxOyB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gYXR0LiRlWzBdLnN0eWxlW0cuQ1NTdHJhbnNmb3JtTmFtZV0gPSAndHJhbnNsYXRlKCcgKyAoLWF0dC5kaXIrc3RhdGUudCkgKyAncHgsIDBweCkgc2NhbGUoJyArIHNjICsgJykgcm90YXRlKCcgKyBhdHQuaXRlbU5ldy5yb3RhdGlvbkFuZ2xlICsgJ2RlZyknO1xuICAgICAgICAgICAgICAgICAgICBhdHQuJGVbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXSA9ICd0cmFuc2xhdGUoJyArICgtYXR0LmRpcitzdGF0ZS50KSArICdweCwgMHB4KSBzY2FsZSgnICsgc2MgKyAnKSc7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmaW5pc2g6ICAgICAgIGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgICAgIEcuVk9NLiRtZWRpYUN1cnJlbnRbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICBhdHQuJGVbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXSA9ICcnO1xyXG4gICAgICAgICAgICAgICAgICBEaXNwbGF5SW50ZXJuYWxWaWV3ZXJDb21wbGV0ZShhdHQuZFQsIG5ld1ZvbUlkeCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNhc2UgJ1NMSURFQVBQRUFSJzpcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICB2YXIgZGlyPShkaXNwbGF5VHlwZSA9PSAnbmV4dEltYWdlJyA/IC0gdlAudyA6IHZQLncpO1xyXG4gICAgICAgICAgICAgIHZhciBvcCA9IChNYXRoLmFicyhHLlZPTS5zd2lwZVBvc1gpKSAvIEcuVk9NLndpbmRvdy5sYXN0V2lkdGg7XHJcbiAgICAgICAgICAgICAgJG5ld1swXS5zdHlsZVtHLkNTU3RyYW5zZm9ybU5hbWVdID0gJyc7XHJcbiAgICAgICAgICAgICAgbmV3IE5HVHdlZW5hYmxlKCkudHdlZW4oe1xyXG4gICAgICAgICAgICAgICAgZnJvbTogICAgICAgICB7IG86IG9wLCB0OiBHLlZPTS5zd2lwZVBvc1ggfSxcclxuICAgICAgICAgICAgICAgIHRvOiAgICAgICAgICAgeyBvOiAxLCB0OiAoZGlzcGxheVR5cGUgPT0gJ25leHRJbWFnZScgPyAtIHZQLncgOiB2UC53KSB9LFxyXG4gICAgICAgICAgICAgICAgYXR0YWNobWVudDogICB7IGRUOmRpc3BsYXlUeXBlLCAkZTokbmV3LCBpdGVtTmV3OiBpdGVtTmV3LCBpdGVtT2xkOiBpdGVtT2xkLCBkaXI6IGRpciB9LFxyXG4gICAgICAgICAgICAgICAgZGVsYXk6ICAgICAgICAzMCxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAgICAgZHVyLFxyXG4gICAgICAgICAgICAgICAgZWFzaW5nOiAgICAgICAnZWFzZUluT3V0U2luZScsXHJcbiAgICAgICAgICAgICAgICBzdGVwOiAgICAgICAgIGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgbWVkaWEgLSB0cmFuc2xhdGVcclxuICAgICAgICAgICAgICAgICAgLy8gRy5WT00uJG1lZGlhQ3VycmVudFswXS5zdHlsZVtHLkNTU3RyYW5zZm9ybU5hbWVdPSAndHJhbnNsYXRlKCcrc3RhdGUudCsncHgsIDBweCkgcm90YXRlKCcgKyBhdHQuaXRlbU9sZC5yb3RhdGlvbkFuZ2xlICsgJ2RlZyknO1xuICAgICAgICAgICAgICAgICAgRy5WT00uJG1lZGlhQ3VycmVudFswXS5zdHlsZVtHLkNTU3RyYW5zZm9ybU5hbWVdPSAndHJhbnNsYXRlKCcrc3RhdGUudCsncHgsIDBweCknO1xyXG4gICAgICAgICAgICAgICAgICAvLyBuZXcgbWVkaWEgLSBvcGFjaXR5XHJcbiAgICAgICAgICAgICAgICAgIGlmKCBhdHQuaXRlbU5ldy5tZWRpYVRyYW5zaXRpb24oKSApIHtcclxuICAgICAgICAgICAgICAgICAgICBWaWV3ZXJTZXRNZWRpYVZpc2liaWxpdHkoYXR0Lml0ZW1OZXcsIGF0dC4kZSwgc3RhdGUubyk7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBmaW5pc2g6ICAgICAgIGZ1bmN0aW9uIChzdGF0ZSwgYXR0KSB7XHJcbiAgICAgICAgICAgICAgICAgIEcuVk9NLiRtZWRpYUN1cnJlbnRbMF0uc3R5bGVbRy5DU1N0cmFuc2Zvcm1OYW1lXT0gJyc7XHJcbiAgICAgICAgICAgICAgICAgIERpc3BsYXlJbnRlcm5hbFZpZXdlckNvbXBsZXRlKGF0dC5kVCwgbmV3Vm9tSWR4KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICBcclxuXHJcbiAgICBmdW5jdGlvbiBEaXNwbGF5SW50ZXJuYWxWaWV3ZXJDb21wbGV0ZSggZGlzcGxheVR5cGUsIG5ld1ZvbUlkeCApIHtcclxuICAgICAgRy5WT00uY3Vyckl0ZW1JZHggPSBuZXdWb21JZHg7XHJcbiAgICAgIFxyXG4gICAgICB2YXIgbmd5Mml0ZW0gPSBHLlZPTS5OR1kySXRlbSgwKTtcclxuXHJcbiAgICAgIFZpZXdlclRvb2xiYXJFbGVtZW50Q29udGVudCgpO1xyXG4gICAgICBpZiggRy5PLmRlYnVnTW9kZSAmJiBjb25zb2xlLnRpbWVsaW5lICkgeyBjb25zb2xlLnRpbWVsaW5lRW5kKCduYW5vZ2FsbGVyeTJfdmlld2VyJyk7IH1cclxuXHJcbiAgICAgIHZhciBmdT1HLk8uZm5JbWdEaXNwbGF5ZWQ7XHJcbiAgICAgIGlmKCBmdSAhPT0gbnVsbCApIHtcclxuICAgICAgICB0eXBlb2YgZnUgPT0gJ2Z1bmN0aW9uJyA/IGZ1KG5neTJpdGVtKSA6IHdpbmRvd1tmdV0obmd5Mml0ZW0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBHLlZPTS5zd2lwZVBvc1ggPSAwO1xyXG4gICAgICBpZiggZGlzcGxheVR5cGUgIT0gJycgKSB7XHJcbiAgICAgICAgLy8gbm90IG9uIGZpcnN0IG1lZGlhIGRpc3BsYXlcclxuICAgICAgICAvLyBHLlZPTS4kbWVkaWFDdXJyZW50Lm9mZihcImNsaWNrXCIpO1xyXG4gICAgICAgIEcuVk9NLiRtZWRpYUN1cnJlbnQucmVtb3ZlQ2xhc3MoJ2ltZ0N1cnJlbnQnKTtcclxuXHJcbiAgICAgICAgdmFyICR0bXAgPSBHLlZPTS4kbWVkaWFDdXJyZW50O1xyXG4gICAgICAgIHN3aXRjaCggZGlzcGxheVR5cGUgKSB7XHJcbiAgICAgICAgICBjYXNlICduZXh0SW1hZ2UnOlxyXG4gICAgICAgICAgICBHLlZPTS4kbWVkaWFDdXJyZW50ID0gRy5WT00uJG1lZGlhTmV4dDtcclxuICAgICAgICAgICAgRy5WT00uJG1lZGlhTmV4dCA9ICR0bXA7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgY2FzZSAncHJldmlvdXNJbWFnZSc6XHJcbiAgICAgICAgICAgIEcuVk9NLiRtZWRpYUN1cnJlbnQgPSBHLlZPTS4kbWVkaWFQcmV2aW91cztcclxuICAgICAgICAgICAgRy5WT00uJG1lZGlhUHJldmlvdXMgPSAkdG1wO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIEcuVk9NLiRtZWRpYUN1cnJlbnQuYWRkQ2xhc3MoJ2ltZ0N1cnJlbnQnKTtcclxuICAgICAgXHJcbiAgICAgIC8vIHJlLXNvcnQgdGhlIG1lZGlhIGNvbnRhaW5lcnMgLS0+IGN1cnJlbnQgb24gdG9wXHJcbiAgICAgIHZhciAkcGFucyA9IEcuVk9NLiRjb250ZW50LmZpbmQoJy5uR1kyVmlld2VyTWVkaWFQYW4nKTtcclxuICAgICAgRy5WT00uJG1lZGlhQ3VycmVudC5pbnNlcnRBZnRlcigkcGFucy5sYXN0KCkpO1xyXG4gICAgICBcclxuICAgICAgaWYoIG5neTJpdGVtLm1lZGlhS2luZCA9PSAnaW1nJyAmJiBuZ3kyaXRlbS5pbWFnZVdpZHRoID09IDAgKSB7XHJcbiAgICAgICAgVmlld2VyU2V0TWVkaWFWaXNpYmlsaXR5KEcuVk9NLk5HWTJJdGVtKDApLCBHLlZPTS4kbWVkaWFDdXJyZW50LCAwKTtcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICBHLlZPTS4kbWVkaWFDdXJyZW50LmNoaWxkcmVuKCkuZXEoMCkuYXR0cignY2xhc3MnLCAnbkdZMlZpZXdlck1lZGlhTG9hZGVySGlkZGVuJyk7ICAgIC8vIGhpZGUgcHJlbG9hZGVyXHJcbiAgICAgICAgVmlld2VyU2V0TWVkaWFWaXNpYmlsaXR5KEcuVk9NLk5HWTJJdGVtKDApLCBHLlZPTS4kbWVkaWFDdXJyZW50LCAxKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgXHJcbiAgICAgIC8vIHNldCB0aGUgbmV3IE5FWFQgbWVkaWFcclxuICAgICAgRy5WT00uJG1lZGlhTmV4dC5lbXB0eSgpO1xyXG4gICAgICB2YXIgbmV4dEl0ZW0gPSBHLlZPTS5OR1kySXRlbSgxKTtcclxuICAgICAgdmFyIHNwcmVsb2FkZXIgPSAnPGRpdiBjbGFzcz1cIm5HWTJWaWV3ZXJNZWRpYUxvYWRlckRpc3BsYXllZFwiPjwvZGl2Pic7XHJcbiAgICAgIGlmKCBuZXh0SXRlbS5tZWRpYUtpbmQgPT0gJ2ltZycgJiYgbmV4dEl0ZW0uaW1hZ2VXaWR0aCAhPSAwICYmIG5leHRJdGVtLmltYWdlSGVpZ2h0ICE9IDAgKSB7XHJcbiAgICAgICAgc3ByZWxvYWRlciA9ICc8ZGl2IGNsYXNzPVwibkdZMlZpZXdlck1lZGlhTG9hZGVySGlkZGVuXCI+PC9kaXY+JztcclxuICAgICAgfVxyXG4gICAgICBHLlZPTS4kbWVkaWFOZXh0LmFwcGVuZCggc3ByZWxvYWRlciArIG5leHRJdGVtLm1lZGlhTWFya3VwICk7XHJcbiAgICAgIFZpZXdlclNldE1lZGlhVmlzaWJpbGl0eShuZXh0SXRlbSwgRy5WT00uJG1lZGlhTmV4dCwgMCk7XHJcbiAgICAgIGlmKCBuZXh0SXRlbS5tZWRpYUtpbmQgPT0gJ2ltZycgKSB7XHJcbiAgICAgICAgRy5WT00uSW1hZ2VMb2FkZXIubG9hZEltYWdlKFZpZXdlSW1nU2l6ZVJldHJpZXZlZCwgbmV4dEl0ZW0pO1xyXG4gICAgICB9XG4gICAgICBlbHNlIHtcclxuICAgICAgICBWaWV3ZXJNZWRpYUNlbnRlck5vdEltZyggRy5WT00uJG1lZGlhTmV4dCApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBzZXQgdGhlIG5ldyBQUkVWSU9VUyBtZWRpYVxyXG4gICAgICBHLlZPTS4kbWVkaWFQcmV2aW91cy5lbXB0eSgpO1xyXG4gICAgICB2YXIgcHJldmlvdXNJdGVtID0gRy5WT00uTkdZMkl0ZW0oLTEpO1xyXG4gICAgICBzcHJlbG9hZGVyID0gJzxkaXYgY2xhc3M9XCJuR1kyVmlld2VyTWVkaWFMb2FkZXJEaXNwbGF5ZWRcIj48L2Rpdj4nO1xyXG4gICAgICBpZiggcHJldmlvdXNJdGVtLm1lZGlhS2luZCA9PSAnaW1nJyAmJiBwcmV2aW91c0l0ZW0uaW1hZ2VXaWR0aCAhPSAwICYmIHByZXZpb3VzSXRlbS5pbWFnZUhlaWdodCAhPSAwICkge1xyXG4gICAgICAgIHNwcmVsb2FkZXIgPSAnPGRpdiBjbGFzcz1cIm5HWTJWaWV3ZXJNZWRpYUxvYWRlckhpZGRlblwiPjwvZGl2Pic7XHJcbiAgICAgIH1cclxuICAgICAgRy5WT00uJG1lZGlhUHJldmlvdXMuYXBwZW5kKCBzcHJlbG9hZGVyICsgcHJldmlvdXNJdGVtLm1lZGlhTWFya3VwICk7XHJcbiAgICAgIFZpZXdlclNldE1lZGlhVmlzaWJpbGl0eShwcmV2aW91c0l0ZW0sIEcuVk9NLiRtZWRpYVByZXZpb3VzLCAwKTtcclxuICAgICAgaWYoIHByZXZpb3VzSXRlbS5tZWRpYUtpbmQgPT0gJ2ltZycgKSB7XHJcbiAgICAgICAgRy5WT00uSW1hZ2VMb2FkZXIubG9hZEltYWdlKCBWaWV3ZUltZ1NpemVSZXRyaWV2ZWQsIHByZXZpb3VzSXRlbSApO1xyXG4gICAgICB9XHJcbiAgICAgIGVsc2Uge1xyXG4gICAgICAgIFZpZXdlck1lZGlhQ2VudGVyTm90SW1nKCBHLlZPTS4kbWVkaWFQcmV2aW91cyApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAgIFxyXG4gICAgICAvLyBzbGlkZXNob3cgbW9kZSAtIHdhaXQgdW50aWwgaW1hZ2UgaXMgbG9hZGVkIHRvIHN0YXJ0IHRoZSBkZWxheSBmb3IgbmV4dCBpbWFnZVxyXG4gICAgICBpZiggRy5WT00ucGxheVNsaWRlc2hvdyApIHtcclxuICAgICAgICBHLlZPTS4kbWVkaWFDdXJyZW50LmNoaWxkcmVuKCkuZXEoMSkubmdpbWFnZXNMb2FkZWQoKS5hbHdheXMoIGZ1bmN0aW9uKCBpbnN0YW5jZSApIHtcclxuICAgICAgICAgIGlmKCBHLlZPTS5wbGF5U2xpZGVzaG93ICkge1xyXG4gICAgICAgICAgICAvLyBpbiB0aGUgbWVhbnRpbWUgdGhlIHVzZXIgY291bGQgaGF2ZSBzdG9wcGVkIHRoZSBzbGlkZXNob3dcclxuICAgICAgICAgICAgRy5WT00ucGxheVNsaWRlc2hvd1RpbWVySUQgPSB3aW5kb3cuc2V0VGltZW91dCggZnVuY3Rpb24oKXsgRGlzcGxheU5leHRNZWRpYSgpOyB9LCBHLlZPTS5zbGlkZXNob3dEZWxheSApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBjbG9zZSB2aWV3ZXIgd2hlbiB1c2VyIGNsaWNrcyBvdXRzaWRlIG9mIHRoZSBpbWFnZVxyXG4gICAgICAvLyBHLlZPTS4kbWVkaWFDdXJyZW50Lm9uKFwiY2xpY2tcIixmdW5jdGlvbihlKXtcclxuICAgICAgLy8gIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgIC8vICBpZiggKG5ldyBEYXRlKCkuZ2V0VGltZSgpKSAtIEcuVk9NLnRpbWVJbWdDaGFuZ2VkIDwgNDAwICkgeyByZXR1cm47IH1cclxuICAgICAgLy8gIFN0b3BQcm9wYWdhdGlvblByZXZlbnREZWZhdWx0KGUpO1xyXG4gICAgICAvLyAgQ2xvc2VJbnRlcm5hbFZpZXdlcihHLlZPTS5jdXJySXRlbUlkeCk7XHJcbiAgICAgIC8vICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIC8vIH0pO1xyXG5cclxuICAgICAgUmVzaXplSW50ZXJuYWxWaWV3ZXIoKTtcclxuXHJcbiAgICAgIEcuVk9NLnZpZXdlck1lZGlhSXNDaGFuZ2VkID0gZmFsc2U7XHJcbiAgICAgIFRyaWdnZXJDdXN0b21FdmVudCgnbGlnaHRib3hJbWFnZURpc3BsYXllZCcpO1xyXG4gICAgICBcclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIC8vIElzIGZpcmVkIGFzIHNvb24gYXMgdGhlIHNpemUgb2YgYW4gaW1hZ2UgaGFzIGJlZW4gcmV0cmlldmVkICh0aGUgZG93bmxvYWQgbWF5IG5vdCBiZSBmaW5pc2hlZClcclxuICAgIGZ1bmN0aW9uIFZpZXdlSW1nU2l6ZVJldHJpZXZlZCh3LCBoLCBpdGVtLCBuKSB7XHJcbiAgICAgIGl0ZW0uaW1hZ2VXaWR0aCA9IHc7XHJcbiAgICAgIGl0ZW0uaW1hZ2VIZWlnaHQgPSBoO1xyXG4gIFxyXG4gICAgICAvLyBpbWFnZSBzaXplZCByZXRyaWV2ZWQgZm9yIGN1cnJlbnRseSBkaXNwbGF5ZWQgbWVkaWFcclxuICAgICAgLy8gaWYoIEcuVk9NLiRtZWRpYUN1cnJlbnQgIT09IG51bGwgJiYgRy5WT00uJG1lZGlhQ3VycmVudC5jaGlsZHJlbigpLmF0dHIoJ3NyYycpID09IGl0ZW0ucmVzcG9uc2l2ZVVSTCgpICkge1xyXG4gICAgICBpZiggRy5WT00uTkdZMkl0ZW0oMCkgPT0gaXRlbSApIHtcclxuICAgICAgICAvLyBpdCBpcyB0aGUgY3VycmVudCBkaXNwbGF5ZWQgbWVkaWFcclxuICAgICAgICBHLlZPTS4kbWVkaWFDdXJyZW50LmNoaWxkcmVuKCkuZXEoMCkuYXR0cignY2xhc3MnLCAnbkdZMlZpZXdlck1lZGlhTG9hZGVySGlkZGVuJyk7ICAgIC8vIGhpZGUgcHJlbG9hZGVyXHJcbiAgICAgICAgVmlld2VyU2V0TWVkaWFWaXNpYmlsaXR5KEcuVk9NLk5HWTJJdGVtKDApLCBHLlZPTS4kbWVkaWFDdXJyZW50LCAxKTtcclxuICAgICAgICBHLlZPTS56b29tLnVzZXJGYWN0b3IgPSAxO1xyXG4gICAgICB9XHJcbiAgICAgIFxuICAgICAgaWYoIEcuVk9NLk5HWTJJdGVtKDEpID09IGl0ZW0gKSB7ICAgLy8gbmV4dCBtZWRpYVxuICAgICAgICBHLlZPTS4kbWVkaWFOZXh0LmNoaWxkcmVuKCkuZXEoMCkuYXR0cignY2xhc3MnLCAnbkdZMlZpZXdlck1lZGlhTG9hZGVySGlkZGVuJyk7ICAgIC8vIGhpZGUgcHJlbG9hZGVyXG4gICAgICB9XG4gICAgICBpZiggRy5WT00uTkdZMkl0ZW0oLTEpID09IGl0ZW0gKSB7ICAgLy8gcHJldmlvdXMgbWVkaWFcbiAgICAgICAgRy5WT00uJG1lZGlhUHJldmlvdXMuY2hpbGRyZW4oKS5lcSgwKS5hdHRyKCdjbGFzcycsICduR1kyVmlld2VyTWVkaWFMb2FkZXJIaWRkZW4nKTsgICAgLy8gaGlkZSBwcmVsb2FkZXJcbiAgICAgIH1cbiAgICAgIFxyXG4gICAgICBWaWV3ZXJNZWRpYVNldFBvc0FuZFpvb20oKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgLy8gVmlld2VyIC0gU2V0IHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBtZWRpYSBhbmQgaXQncyBjb250YWluZXJcclxuICAgIGZ1bmN0aW9uIFZpZXdlclNldE1lZGlhVmlzaWJpbGl0eShpdGVtLCAkbWVkaWEsIG9wYWNpdHkgKSB7XHJcbiAgICAgIFxyXG4gICAgICBpZiggaXRlbS5tZWRpYUtpbmQgPT0gJ2ltZycgJiYgaXRlbS5pbWFnZVdpZHRoID09IDAgKSB7XHJcbiAgICAgICAgLy8gZG8gbm90IGRpc3BsYXkgaW1hZ2UgaWYgd2lkdGggaXMgdW5rbm93biAoLS0+IGNhbGxiYWNrIHdpbGwgc2V0IHRoZSB3aWR0aCB3aGVuIGtub3cpXHJcbiAgICAgICAgLy8gc2V0dGluZyBvcGFjaXR5IHRvIDAgaXMgbm90IGVub3VnaCAtPiBpdCBpcyBtYW5kYXRvcnkgdG8gY2hhbmdlIGFsc28gdGhlIHZpc2liaWxpdHkgdG8gaGlkZGVuIHRvIGF2b2lkIHJlc3BvbmRzIHRvIGV2ZW50cyAoY2xpY2svdG91Y2gpXHJcbiAgICAgICAgLy8gJG1lZGlhLmNoaWxkcmVuKCkuY3NzKHsgb3BhY2l0eTogMCwgdmlzaWJpbGl0eTogJ2hpZGRlbicgfSk7XG4gICAgICAgICRtZWRpYS5jaGlsZHJlbigpLmVxKDEpLmNzcyh7IG9wYWNpdHk6IDAsIHZpc2liaWxpdHk6ICdoaWRkZW4nIH0pOyAgICAvLyBoaWRlIG1lZGlhXHJcbiAgICAgICAgLy8gJG1lZGlhLmNzcyh7IG9wYWNpdHk6IDAsIHZpc2liaWxpdHk6ICdoaWRkZW4nIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYoIG9wYWNpdHkgPT0gMCApIHtcclxuICAgICAgICAvLyBzZXR0aW5nIG9wYWNpdHkgdG8gMCBpcyBub3QgZW5vdWdoIC0+IGl0IGlzIG1hbmRhdG9yeSB0byBjaGFuZ2UgYWxzbyB0aGUgdmlzaWJpbGl0eSB0byBoaWRkZW4gdG8gYXZvaWQgcmVzcG9uZHMgdG8gZXZlbnRzIChjbGljay90b3VjaClcclxuICAgICAgICAvLyAkbWVkaWEuY3NzKHsgb3BhY2l0eTogMCwgdmlzaWJpbGl0eTogJ2hpZGRlbicgfSk7XHJcbiAgICAgICAgJG1lZGlhLmNoaWxkcmVuKCkuY3NzKHsgb3BhY2l0eTogMCwgdmlzaWJpbGl0eTogJ2hpZGRlbicgfSk7ICAgIC8vIGhpZGUgbWVkaWFcclxuICAgICAgfVxyXG4gICAgICBlbHNlIHtcclxuICAgICAgICAvLyAkbWVkaWEuY3NzKHsgb3BhY2l0eTogb3BhY2l0eSwgdmlzaWJpbGl0eTogJ3Zpc2libGUnIH0pO1xyXG4gICAgICAgICRtZWRpYS5jaGlsZHJlbigpLmNzcyh7IG9wYWNpdHk6IG9wYWNpdHksIHZpc2liaWxpdHk6ICd2aXNpYmxlJyB9KTsgICAgICAvLyBkaXNwbGF5IG1lZGlhXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgLy8gQ2xvc2UgdGhlIGludGVybmFsIGxpZ2h0Ym94XHJcbiAgICBmdW5jdGlvbiBDbG9zZUludGVybmFsVmlld2VyKCB2b21JZHggKSB7XHJcblxyXG4gICAgICBHLlZPTS52aWV3ZXJNZWRpYUlzQ2hhbmdlZCA9IGZhbHNlO1xyXG5cclxuICAgICAgaWYoIEcuVk9NLnZpZXdlckRpc3BsYXllZCApIHtcclxuXHJcbiAgICAgICAgLy8gc2V0IHNjcm9sbGJhciB2aXNpYmxlIGFnYWluXHJcbiAgICAgIGpRdWVyeSgnYm9keScpLmNzcyh7IG92ZXJmbG93WDogRy5WT00uc2F2ZU92ZXJmbG93WCwgb3ZlcmZsb3dZOiBHLlZPTS5zYXZlT3ZlcmZsb3dZfSk7XHJcbiAgICAgIC8vIGpRdWVyeSgnYm9keScpLmNzcyh7b3ZlcmZsb3c6ICd2aXNpYmxlJ30pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKCBHLlZPTS5wbGF5U2xpZGVzaG93ICkge1xyXG4gICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChHLlZPTS5wbGF5U2xpZGVzaG93VGltZXJJRCk7XHJcbiAgICAgICAgICBHLlZPTS5wbGF5U2xpZGVzaG93ID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHLlZPTS51c2VyRXZlbnRzLnJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgICAgICAgLy8gRy5WT00udXNlckV2ZW50cz1udWxsO1xyXG4gICAgICAgIEcuVk9NLmhhbW1lcnRpbWUuZGVzdHJveSgpO1xyXG4gICAgICAgIEcuVk9NLmhhbW1lcnRpbWUgPSBudWxsO1xyXG5cclxuICAgICAgICBpZiggbmdzY3JlZW5mdWxsLmVuYWJsZWQgJiYgRy5WT00udmlld2VySXNGdWxsc2NyZWVuICkge1xyXG4gICAgICAgICAgRy5WT00udmlld2VySXNGdWxsc2NyZWVuID0gZmFsc2U7XHJcbiAgICAgICAgICBuZ3NjcmVlbmZ1bGwuZXhpdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBHLlZPTS4kY29udC5oaWRlKDApLm9mZigpLnNob3coMCkuaHRtbCgnJykucmVtb3ZlKCk7XHJcbiAgICAgICAgRy5WT00udmlld2VyRGlzcGxheWVkID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmKCBHLk8udGh1bWJuYWlsQWxidW1EaXNwbGF5SW1hZ2UgKSB7XHJcbiAgICAgICAgICAvLyBjb250ZW50IG9mIGFsYnVtIGRpc3BsYXllZCBkaXJlY3RseSBpbiBsaWdodGJveCAobm8gZ2FsbGVyeSBkaXNwbGF5IGZvciBhbGJ1bSBjb250ZW50KVxyXG4gICAgICAgICAgaWYoIHZvbUlkeCA9PSBudWxsICkge1xyXG4gICAgICAgICAgICAvLyBsaWdodGJveCBjbG9zZWQgd2l0aCBicm93c2VyIGJhY2stYnV0dG9uXHJcbiAgICAgICAgICAgIC8vIHRoZSBnYWxsZXJ5IGlzIGFscmVhZHkgZGlzcGxheWVkXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSBHLklbRy5WT00uaXRlbXNbdm9tSWR4XS5uZ3kySXRlbUlkeF07XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnQgPSBOR1kySXRlbS5HZXQoRywgaXRlbS5hbGJ1bUlEKTtcclxuICAgICAgICAgICAgaWYoIEcuR09NLmFsYnVtSWR4ICE9IHBhcmVudC5hbGJ1bUlEICkge1xyXG4gICAgICAgICAgICAgIC8vIGRpc3BsYXkgYWxidW0gb25seSBpZiBub3QgYWxyZWFkeSBkaXNwbGF5ZWRcclxuICAgICAgICAgICAgICBEaXNwbGF5QWxidW0oJy0xJywgcGFyZW50LmFsYnVtSUQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIEdhbGxlcnlSZXNpemUoKTsgICAgICAgIFxyXG4gICAgICAgICAgICAgIFNldExvY2F0aW9uSGFzaCggJycsICcnICk7XHJcbiAgICAgICAgICAgICAgVGh1bWJuYWlsSG92ZXJSZUluaXRBbGwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBEaXNwbGF5QWxidW0oICctJywgRy5JW0cuVk9NLml0ZW1zW3ZvbUlkeF0ubmd5Mkl0ZW1JZHhdLmFsYnVtSUQgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBpZiggdm9tSWR4ICE9IG51bGwgKSB7XHJcbiAgICAgICAgICAgIGlmKCBHLkdPTS5hbGJ1bUlkeCA9PSAtMSApIHtcclxuICAgICAgICAgICAgICAvLyBhbGJ1bSBub3QgZGlzcGxheWVkIC0tPiBkaXNwbGF5IGdhbGxlcnlcclxuICAgICAgICAgICAgICBEaXNwbGF5QWxidW0oICcnLCBHLklbRy5WT00uaXRlbXNbdm9tSWR4XS5uZ3kySXRlbUlkeF0uYWxidW1JRCApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgIEdhbGxlcnlSZXNpemUoKTsgICAgICAgIFxyXG4gICAgICAgICAgICAgIFNldExvY2F0aW9uSGFzaCggRy5JW0cuVk9NLml0ZW1zW3ZvbUlkeF0ubmd5Mkl0ZW1JZHhdLmFsYnVtSUQsICcnICk7XHJcbiAgICAgICAgICAgICAgVGh1bWJuYWlsSG92ZXJSZUluaXRBbGwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBHLlZPTS50aW1lSW1nQ2hhbmdlZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgXHJcbiAgICAvLyBJbnRlcm5hbCB2aWV3ZXIgcmVzaXplZCAtPiByZXBvc2l0aW9uIGVsZW1lbnRzXHJcbiAgICBmdW5jdGlvbiBSZXNpemVJbnRlcm5hbFZpZXdlciggZm9yY2VVcGRhdGUgKSB7XHJcbiAgICAgIGZvcmNlVXBkYXRlID0gdHlwZW9mIGZvcmNlVXBkYXRlICE9PSAndW5kZWZpbmVkJyA/IGZvcmNlVXBkYXRlIDogZmFsc2U7XHJcbiAgICAgIFxyXG4gICAgICBpZiggRy5WT00uJHRvb2xiYXIgPT09IG51bGwgKSB7IHJldHVybjsgfSAgIC8vIHZpZXdlciBidWlsZCBub3QgZmluaXNoZWRcclxuICAgICAgXHJcbiAgICAgIFxyXG4gICAgICAvLyB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBmdW5jdGlvbigpIHsgICAgLy8gc3luY2hyb25pemUgd2l0aCBzY3JlZW5cclxuICAgICAgdmFyIHdpbmRvd3NXID0gRy5WT00uJHZpZXdlci53aWR0aCgpO1xyXG4gICAgICB2YXIgd2luZG93c0ggPSBHLlZPTS4kdmlld2VyLmhlaWdodCgpO1xyXG4gICAgICB2YXIgJGVsdCA9IEcuVk9NLiRtZWRpYUN1cnJlbnQuY2hpbGRyZW4oKS5lcSgxKTtcclxuICAgICAgaWYoICRlbHQgPT0gbnVsbCB8fCBHLlZPTS5jdXJySXRlbUlkeCA9PSAtMSApIHsgcmV0dXJuOyB9XHJcbiAgICAgIFxyXG4gICAgICBpZiggIWZvcmNlVXBkYXRlICYmIEcuVk9NLndpbmRvdy5sYXN0V2lkdGggPT0gd2luZG93c1cgICYmIEcuVk9NLndpbmRvdy5sYXN0SGVpZ2h0ID09IHdpbmRvd3NIICkgeyByZXR1cm47IH1cclxuICAgICAgXHJcbiAgICAgIEcuVk9NLndpbmRvdy5sYXN0V2lkdGggPSB3aW5kb3dzVztcclxuICAgICAgRy5WT00ud2luZG93Lmxhc3RIZWlnaHQgPSB3aW5kb3dzSDtcclxuXHJcbiAgICAgIC8vIHZhciB2d0ltZ0NfSD0kZWx0LmhlaWdodCgpLFxyXG4gICAgICAvLyB2d0ltZ0NfVz0kZWx0LndpZHRoKCksXHJcbiAgICAgIC8vIHZ3SW1nQ19PSHQ9JGVsdC5vdXRlckhlaWdodCh0cnVlKSxcclxuICAgICAgLy8gdndJbWdDX09IZj0kZWx0Lm91dGVySGVpZ2h0KGZhbHNlKTtcclxuXHJcbiAgICAgIHZhciAkdGIgPSBHLlZPTS4kdG9vbGJhci5maW5kKCcudG9vbGJhcicpO1xyXG4gICAgICB2YXIgdGJfT0h0ID0gJHRiLm91dGVySGVpZ2h0KHRydWUpO1xyXG5cclxuICAgICAgc3dpdGNoKCBHLk8udmlld2VyVG9vbGJhci5wb3NpdGlvbiApIHtcclxuICAgICAgICBjYXNlICd0b3BPdmVySW1hZ2UnOlxyXG4gICAgICAgICAgRy5WT00uJGNvbnRlbnQuY3NzKHtoZWlnaHQ6IHdpbmRvd3NILCB3aWR0aDogd2luZG93c1csIHRvcDogMCAgfSk7XHJcbiAgICAgICAgICBHLlZPTS4kdG9vbGJhci5jc3Moe3RvcDogMCwgYm90dG9tOiAnJ30pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAndG9wJzpcclxuICAgICAgICAgIHdpbmRvd3NIIC09IHRiX09IdDtcclxuICAgICAgICAgIEcuVk9NLiRjb250ZW50LmNzcyh7aGVpZ2h0OiB3aW5kb3dzSCwgd2lkdGg6IHdpbmRvd3NXLCB0b3A6IHRiX09IdCAgfSk7XHJcbiAgICAgICAgICBHLlZPTS4kdG9vbGJhci5jc3Moe3RvcDogMH0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnYm90dG9tT3ZlckltYWdlJzpcclxuICAgICAgICAgIEcuVk9NLiRjb250ZW50LmNzcyh7aGVpZ2h0OndpbmRvd3NILCB3aWR0aDogd2luZG93c1csIGJvdHRvbTogMCwgdG9wOiAwICB9KTtcclxuICAgICAgICAgIEcuVk9NLiR0b29sYmFyLmNzcyh7Ym90dG9tOiAwfSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdib3R0b20nOlxyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICB3aW5kb3dzSCAtPSB0Yl9PSHQ7XHJcbiAgICAgICAgICBHLlZPTS4kY29udGVudC5jc3MoeyB3aWR0aDogd2luZG93c1csIHRvcDogMCwgYm90dG9tOiB0Yl9PSHQgfSk7XHJcbiAgICAgICAgICBHLlZPTS4kdG9vbGJhci5jc3Moe2JvdHRvbTogMH0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmKCAhRy5WT00udmlld2VyTWVkaWFJc0NoYW5nZWQgJiYgRy5WT00uem9vbS5pc1pvb21pbmcgKSB7XHJcbiAgICAgICAgVmlld2VyTWVkaWFTZXRQb3NBbmRab29tKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcblx0XHRcdFx0aWYoICFHLlZPTS56b29tLmlzWm9vbWluZyAmJiAoIEcuVk9NLnpvb20udXNlckZhY3RvciAhPSAwIHx8IEcuVk9NLnBhblBvc1ggIT0gMCB8fCBHLlZPTS5wYW5Qb3NZICE9IDAgfHwgRy5WT00uem9vbS5wb3NYICE9IDAgfHwgRy5WT00uem9vbS5wb3NZICE9IDAgKSkge1xyXG5cdFx0XHRcdFx0Ly8gYW5pbWF0ZSBpbWFnZSB6b29tIGZhY3RvciBhbmQgcG9zaXRpb24gYmFjayB0byBpbml0aWFsIHZhbHVlc1xyXG5cdFx0XHRcdFx0Ry5WT00uem9vbS5pc1pvb21pbmc9IHRydWU7XHRcdC8vIGFjdGl2YXRlIHpvb21pbmcgdGVtcG9yYXJpbHlcclxuICAgICAgICAgIG5ldyBOR1R3ZWVuYWJsZSgpLnR3ZWVuKHtcclxuICAgICAgICAgICAgZnJvbTogICAgICAgICAgIHsgdXNlckZhY3RvcjogRy5WT00uem9vbS51c2VyRmFjdG9yLCBwYW5Qb3NYOiBHLlZPTS5wYW5Qb3NYLCBwYW5Qb3NZOiBHLlZPTS5wYW5Qb3NZLCB6b29tUG9zWDogRy5WT00uem9vbS5wb3NYLCB6b29tUG9zWTogRy5WT00uem9vbS5wb3NZIH0sXHJcbiAgICAgICAgICAgIHRvOiAgICAgICAgICAgeyB1c2VyRmFjdG9yOiAxLCBwYW5Qb3NYOiAwLCBwYW5Qb3NZOiAwLCB6b29tUG9zWDogMCwgem9vbVBvc1k6IDAgfSxcclxuICAgICAgICAgICAgZWFzaW5nOiAgICAgICAnZWFzZUluT3V0U2luZScsXHJcbiAgICAgICAgICAgIGRlbGF5OiAgICAgICAgMCxcclxuICAgICAgICAgICAgZHVyYXRpb246ICAgICAxNTAsXHJcbiAgICAgICAgICAgIHN0ZXA6ICAgICAgICAgZnVuY3Rpb24gKHN0YXRlKSB7XHJcblx0XHRcdFx0XHRcdFx0Ry5WT00uem9vbS51c2VyRmFjdG9yPXN0YXRlLnVzZXJGYWN0b3I7XHJcblx0XHRcdFx0XHRcdFx0Ry5WT00ucGFuUG9zWD1zdGF0ZS5wYW5Qb3NYO1xyXG5cdFx0XHRcdFx0XHRcdEcuVk9NLnBhblBvc1k9c3RhdGUucGFuUG9zWTtcclxuXHRcdFx0XHRcdFx0XHRHLlZPTS56b29tLnBvc1g9c3RhdGUuem9vbVBvc1g7XHJcblx0XHRcdFx0XHRcdFx0Ry5WT00uem9vbS5wb3NZPXN0YXRlLnpvb21Qb3NZO1xyXG5cdFx0XHRcdFx0XHRcdFZpZXdlck1lZGlhU2V0UG9zQW5kWm9vbSgpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmaW5pc2g6ICAgICAgIGZ1bmN0aW9uIChzdGF0ZSkge1xyXG5cdFx0XHRcdFx0XHRcdEcuVk9NLnpvb20uaXNab29taW5nPWZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuXHRcdFx0XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0Ry5WT00uem9vbS51c2VyRmFjdG9yID0gMTtcclxuXHRcdFx0XHRcdEcuVk9NLnpvb20uaXNab29taW5nID0gZmFsc2U7XHJcblx0XHRcdFx0XHRHLlZPTS5wYW5Qb3NYID0gMDtcclxuXHRcdFx0XHRcdEcuVk9NLnBhblBvc1kgPSAwO1xyXG5cdFx0XHRcdFx0Ry5WT00uem9vbS5wb3NYID0gMDtcclxuXHRcdFx0XHRcdEcuVk9NLnpvb20ucG9zWSA9IDA7XHJcblx0XHRcdFx0XHRWaWV3ZXJNZWRpYVNldFBvc0FuZFpvb20oKTtcclxuXHRcdFx0XHR9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG5cclxuICAgIC8qKiBAZnVuY3Rpb24gQnVpbGRTa2VsZXRvbiAqL1xyXG4gICAgLyoqIEJ1aWxkIHRoZSBnYWxsZXJ5IHN0cnVjdHVyZSAqKi9cclxuICAgIGZ1bmN0aW9uIEJ1aWxkU2tlbGV0b24oKSB7XHJcbiAgICBcclxuICAgICAgLy8gc3RvcmUgbWFya3VwIGlmIGRlZmluZWRcclxuICAgICAgdmFyICRlbGVtZW50cyA9IEcuJEUuYmFzZS5jaGlsZHJlbignYScpO1xyXG4gICAgICBpZiggJGVsZW1lbnRzLmxlbmd0aCA+IDAgKSB7XHJcbiAgICAgICAgRy5PLiRtYXJrdXAgPSAkZWxlbWVudHM7XHJcbiAgICAgIH1cclxuICAgICAgRy4kRS5iYXNlLnRleHQoJycpO1xyXG4gICAgICBHLiRFLmJhc2UuYWRkQ2xhc3MoJ25neTJfY29udGFpbmVyJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBSVEwgb3IgTFRSXHJcbiAgICAgIHZhciBzUlRMPScnO1xyXG4gICAgICBpZiggRy5PLlJUTCApIHtcclxuICAgICAgICBzUlRMID0gJ3N0eWxlPVwidGV4dC1hbGlnbjpyaWdodDtkaXJlY3Rpb246cnRsO1wiJztcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIC8vIHRoZW1lXHJcbiAgICAgIEcuJEUuYmFzZS5hZGRDbGFzcyhHLk8udGhlbWUpXHJcbiAgICAgIC8vIGdhbGxlcnkgY29sb3Igc2NoZW1lXHJcbiAgICAgIFNldEdhbGxlcnlUaGVtZSgpO1xyXG5cclxuICAgICAgLy8gSGlkZSBpY29ucyAodGh1bWJuYWlscyBhbmQgYnJlYWRjcnVtYilcclxuICAgICAgaWYoIEcuTy50aHVtYm5haWxMYWJlbC5nZXQoJ2hpZGVJY29ucycpICkge1xyXG4gICAgICAgIEcuTy5pY29ucy50aHVtYm5haWxBbGJ1bSA9ICcnO1xyXG4gICAgICAgIEcuTy5pY29ucy50aHVtYm5haWxJbWFnZSA9ICcnO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBOYXZpZ2F0aW9uIGJhclxyXG4gICAgICB2YXIgc3R5bGVOYXZpZ2F0aW9uPVwiXCI7XHJcbiAgICAgIGlmKCBHLk8ubmF2aWdhdGlvbkZvbnRTaXplICE9IHVuZGVmaW5lZCAmJiBHLk8ubmF2aWdhdGlvbkZvbnRTaXplICE9ICcnICkge1xyXG4gICAgICAgIHN0eWxlTmF2aWdhdGlvbj0nIHN0eWxlPVwiZm9udC1zaXplOicrRy5PLm5hdmlnYXRpb25Gb250U2l6ZSsnO1wiJztcclxuICAgICAgfSAgICAgIFxyXG4gICAgICBHLiRFLmNvbk5hdmlnYXRpb25CYXIgPSBqUXVlcnkoJzxkaXYgY2xhc3M9XCJuR1kyTmF2aWdhdGlvbmJhclwiICcrc3R5bGVOYXZpZ2F0aW9uKyc+PC9kaXY+JykuYXBwZW5kVG8oRy4kRS5iYXNlKTtcclxuXHJcbiAgICAgIC8vIHByZS1sb2FkZXJcclxuICAgICAgRy4kRS5jb25Mb2FkaW5nQiA9IGpRdWVyeSgnPGRpdiBjbGFzcz1cIm5hbm9HYWxsZXJ5TEJhck9mZlwiPjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48ZGl2PjwvZGl2PjxkaXY+PC9kaXY+PGRpdj48L2Rpdj48L2Rpdj4nKS5hcHBlbmRUbyhHLiRFLmJhc2UpO1xyXG5cclxuICAgICAgLy8gZ2FsbGVyeVxyXG4gICAgICBHLiRFLmNvblRuUGFyZW50ID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwibkdZMkdhbGxlcnlcIj48L2Rpdj4nKS5hcHBlbmRUbyggRy4kRS5iYXNlICk7XHJcbiAgICAgIEcuJEUuY29uVG4gPSBqUXVlcnkoJzxkaXYgY2xhc3M9XCJuR1kyR2FsbGVyeVN1YlwiPjwvZGl2PicpLmFwcGVuZFRvKCBHLiRFLmNvblRuUGFyZW50ICk7XHJcblxyXG4gICAgICAvLyBjb25maWd1cmUgZ2FsbGVyeVxyXG4gICAgICBzd2l0Y2goIEcuTy50aHVtYm5haWxBbGlnbm1lbnQgKSB7XHJcbiAgICAgICAgY2FzZSAnbGVmdCc6XHJcbiAgICAgICAgICBHLiRFLmNvblRuUGFyZW50LmNzcyh7J3RleHQtYWxpZ24nOidsZWZ0J30pO1xyXG4gICAgICAgICAgLy8gRy4kRS5jb25OYXZCQ29uLmNzcyh7J21hcmdpbi1sZWZ0JzowIH0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgICAgRy4kRS5jb25UblBhcmVudC5jc3Moeyd0ZXh0LWFsaWduJzoncmlnaHQnfSk7XHJcbiAgICAgICAgICAvLyBHLiRFLmNvbk5hdkJDb24uY3NzKHsgJ21hcmdpbi1yaWdodCc6MH0pO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIGFwcGx5IGdhbGxlcnlCdWlsZEluaXQyIGNzcyBzZXR0aW5ncyB0byB0aGUgZ2FsbGVyeVxyXG4gICAgICBpZiggRy5PLmdhbGxlcnlCdWlsZEluaXQyICE9PSB1bmRlZmluZWQgKSB7XHJcbiAgICAgIHZhciB0MT1HLk8uZ2FsbGVyeUJ1aWxkSW5pdDIuc3BsaXQoJ3wnKTtcclxuICAgICAgICBmb3IoIHZhciBpPTA7IGk8dDEubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgICB2YXIgbzE9dDFbaV0uc3BsaXQoJ18nKTtcclxuICAgICAgICAgIGlmKCBvMS5sZW5ndGggPT0gMiApIHtcclxuICAgICAgICAgICAgRy4kRS5jb25Ubi5jc3MobzFbMF0sIG8xWzFdKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIGNvbmZpZ3VyZSBnYWxsZXJ5IGRlcGVuZGluZyBvbiBzb21lIHRodW1ibmFpbCBob3ZlciBlZmZlY3RzXHJcbiAgICAgIHZhciBlZmZlY3RzPUcudG4uaG92ZXJFZmZlY3RzLnN0ZC5jb25jYXQoRy50bi5ob3ZlckVmZmVjdHMubGV2ZWwxKTtcclxuICAgICAgZm9yKCB2YXIgaj0wOyBqPGVmZmVjdHMubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICBzd2l0Y2goIGVmZmVjdHNbal0udHlwZSApIHtcclxuICAgICAgICAgIGNhc2UgJ3NjYWxlJzpcclxuICAgICAgICAgIGNhc2UgJ3JvdGF0ZVonOlxyXG4gICAgICAgICAgY2FzZSAncm90YXRlWCc6XHJcbiAgICAgICAgICBjYXNlICdyb3RhdGVZJzpcclxuICAgICAgICAgIGNhc2UgJ3RyYW5zbGF0ZVgnOlxyXG4gICAgICAgICAgY2FzZSAndHJhbnNsYXRlWSc6XHJcbiAgICAgICAgICAgIC8vIGhhbmRsZSBzb21lIHNwZWNpYWwgY2FzZXNcclxuICAgICAgICAgICAgaWYoIGVmZmVjdHNbal0uZWxlbWVudCA9PSAnLm5HWTJHVGh1bWJuYWlsJyApIHtcclxuICAgICAgICAgICAgICAvLyBhbGxvdyB0aHVtYm5haWwgdXBzY2FsZSBvdmVyIHRoZSBnYWxsZXJ5J3MgYWVyYVxyXG4gICAgICAgICAgICAgIEcuJEUuYmFzZS5jc3MoJ292ZXJmbG93JywgJ3Zpc2libGUnKTtcclxuICAgICAgICAgICAgICBHLiRFLmJhc2UuZmluZCgnLm5HWTJHYWxsZXJ5U3ViJykuY3NzKCdvdmVyZmxvdycsICd2aXNpYmxlJyk7XHJcbiAgICAgICAgICAgICAgRy4kRS5jb25UblBhcmVudC5jc3MoJ292ZXJmbG93JywgJ3Zpc2libGUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIEdhbGxlcnkgYm90dG9tIGNvbnRhaW5lclxyXG4gICAgICBHLiRFLmNvblRuQm90dG9tID0galF1ZXJ5KCc8ZGl2IGNsYXNzPVwibkdZMkdhbGxlcnlCb3R0b21cIiAnK3N0eWxlTmF2aWdhdGlvbisnPjwvZGl2PicpLmFwcGVuZFRvKCBHLiRFLmNvblRuUGFyZW50ICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBwb3J0YWJsZSBlZGl0aW9uXHJcbiAgICAgIGlmKCBHLk8ucG9ydGFibGUgKSB7XHJcbiAgICAgICAgLy8gaHR0cDovL3d3dy5waWNyZXNpemUuY29tL1xyXG4gICAgICAgIC8vIGh0dHA6Ly9iYXNlNjRlbmNvZGUubmV0L2Jhc2U2NC1pbWFnZS1lbmNvZGVyXHJcbiAgICAgICAgLy8gdmFyIGxvZ289J2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQjhBQUFBV0NBWUFBQUE0b1VmeEFBQUFCR2RCVFVFQUFMR1BDL3hoQlFBQUFDQmpTRkpOQUFCNkpnQUFnSVFBQVBvQUFBQ0E2QUFBZFRBQUFPcGdBQUE2bUFBQUYzQ2N1bEU4QUFBQUJtSkxSMFFBL3dEL0FQK2d2YWVUQUFBQUIzUkpUVVVINFFNUEJ3WTZteFpnc0FBQUJURkpSRUZVU01lMWxsOW9WR2NheG4vZmQ4NlpTV2JTa0VCTWlXTmRUVGZSeGlWYlhGaVUxYmpLR3FOZXhsVVJLeXMwdEhxWHBRWjY0U3E0RnhLcUZ5NHFGU205a0ExRkhOaEZJU2dKcUZDZDZsTC9ZQzdNM2pockp2NUptR1NTTXpQbnpEbmZ1eGRwWnRQNGIxdmFGMTU0UDNnUEQrL3pQQy9uVlNLaUFRT3NCajdPNVhLL25aaVllRXRFTEg2aVVFcUZOVFUxVTlYVjFkOEFud05mQTFxSkNNQ2ZIejE2OU5jalI0NVVYTDE2VldXeldRbkQwUHhVNEpabDZkcmFXdFhXMWlZSER4NHNMbG15NUMvQVp3UkIwSlZPcHlXUlNIaEFDTWpQbU9IQ2hRdUw2WFJhZ2lEb1VpSXl1bXZYcnBxK3ZyNm9iZHVxczdPVGpSdmJzYlNGVWdxVWdLanlGRzUrbWxLcFZINkxDTVlZUkFRUlFTbUYxaHF0TmQreGlqR0dWQ3BGTXBra0NBTFp1WE9uMTlmWE42R21wNmROYzNOek1EbzY2blIyZG5MKy9IbStPdjkzM1B3VUFQSEthZ3FlaTRnQkZOczdkeEdQeDM4VS9kdTJiU09aVE5MUTBGQjYrUENoYldlejJXSStuM2RFaEkzdGYrRGV0ME44ZGUwSW16OVlRV0hhNDh1LzNhZmpneGJxRXBVTS9lcy91RjhXK2ZpamZmaStUeXdXUTBTNGZ2MDZ0Mi9mSnBmTHNYanhZdGF1WFV0VFV4TkJFQ0FpaEdGSUpCSmgxYXBWWExod2dYdytyN0xaYk5HZVlVN01MRDFCRVBDTHhrV3MrSFVUK1NtUEpZMFR2UGVyZDZsL0owNVljTENHSFd6YnhyWnRIang0d1A3OSs3bDI3ZHIzSnF5dXJxYXJxNHVqUjQ5aTJ6WUFXbXZDTUp5VnlnQ2laN2RoOWtPdE5iNVhvcEQzS0JROGZMOUVzZUJSeUhzVUN6NnpTM0RuemgzV3JWdFhCcTZvcUdEQmdnVUE1SEk1amgwN3hvNGRPekRtZjB1alZCbEdBV2ptaFRHQzQxaEVvdzZSaUkzajJEZ1JoMGpVeG9uWVdKYUZHR0hQbmoyTWo0OWpXUllIRGh6Zzd0MjdEQTBOTVRBd3dPclZxd0ZJSnBPY09IRUN4M0ZlNm9FWHdHM2JZdXg1bHRISHozbVNHZVBwaytjOHljelVJK2tuVkZWVmNlUG1EZTdmdnc5QVQwOFB2YjI5TkRjM1UxZFh4NFlORzdoOCtUSXRMUzFvclRsNThpVDVmTDY4R2E4RW41NXlXYjZpaWZmZi9pUEQvMGlRR2ZnbEczL3pKNmErYmVIZi8zeUg2TWp2K1AyNjlWeTVjZ1dsRkRVMU5YUjNkeE9HWWRsY251ZFJWVlhGdm4zN01NYVFUcWNaSGg1K0tiZzk5ekhqU29kUHVqOTk3Y3FNalkwaEl0VFcxaEtQeDlGYWx6VzFMSXN3REZtMGFCRUFRUkRndXU2Yko1ODFoT2Q1R0JOaVRFZ1lodVhhOHoxRWhJYUdCZ0F5bVF6cGRCcWxGS1ZTaVRDYzZiY3NpNXMzYndKUVdWbEpmWDM5Zk1POVhITUF5N0xRZWlibjFvN3RvSlNpbzZNREFOLzM2ZTd1eHZkOUlwRUlsbVVSalVaSnBWS2NPWE1HcFJTdHJhMHNYYnIwcGVEZm8zMCtMUys0VTJ1TU1heGN1WkxkdTNkejd0dzUrdnY3YVd0clkrL2V2ZFRYMTNQcjFpMU9uVHJGNU9Ra0FJY1BIOGF5ck5lQ3Z4NTFualRHR0U2ZlBrMG1rMkZ3Y0pCVUtrVXFsWHFoOS9qeDQyemF0S25Nekp6aEJFQXJwWlQrempHV1pTRWlCRUh3eXB6VnRiS3lrb3NYTDNMbzBDRWFHeHZMcG92RllxeFpzNFpMbHk2VkpRbkRFQkVwTTZDMTFrb3BoZXU2SnBGSStGcHIyYkpsaS96WUdCa1prZUhoWVptY25IeGx6OWF0VzBWckxZbEV3bmRkMTlpeFdPeng1czJiM3o1NzlxenA3Ky9YN2UzdHRMYTJZb3g1UWFQNU1mZW5FWTFHMFZvVEJBSEZZaEZqVEpsSnJUWDM3dDFqWUdBQVk0enA2T2lRV0N6Mm1DQUl0ajk3OWt5V0wxL3VBd0UvN3pFUkxGdTJ6SC82OUtrRVFiQjk5b3phT3o0K2ZxeTN0N2QyY0hBd2RGMVhLYVhlNlA3LzE2QWlRandlbC9YcjErdWVucDZKdXJxNlQ0QXYxSndEOGozZ1EyQlZzVmg4UzcySjh4OFFJaUlWRlJWVFFBbzRDd3dCK3I5M3FDTEk5d0taOEFBQUFDVjBSVmgwWkdGMFpUcGpjbVZoZEdVQU1qQXhOeTB3TXkweE5WUXdOem93TmpvMU9DMHdORG93TUJOUXN5VUFBQUFsZEVWWWRHUmhkR1U2Ylc5a2FXWjVBREl3TVRjdE1ETXRNVFZVTURjNk1EWTZOVGd0TURRNk1EQmlEUXVaQUFBQUFFbEZUa1N1UW1DQyc7XHJcbiAgICAgICAgdmFyIGxvZ28gPSAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFZQ0FZQUFBQ2JVLzgwQUFBQUJHZEJUVUVBQUxHUEMveGhCUUFBQUNCalNGSk5BQUI2SmdBQWdJUUFBUG9BQUFDQTZBQUFkVEFBQU9wZ0FBQTZtQUFBRjNDY3VsRThBQUFBQm1KTFIwUUEvd0QvQVArZ3ZhZVRBQUFBQjNSSlRVVUg0UWdEQkNBV1ZWQy9od0FBQlJ4SlJFRlVTTWV0bGw5b1ZGY2V4ei9ubkR2SlJCbVN6V1RybUQ5dU5HWnNIdGEwL3FGSUZRVHhSY25DQmdURk5sWDBZUjhXKzFBSzlsR3dDQkpZZ24wS0tyNTEzNlM0Z3BVUVRSNGNhSlJzbGN4WVdWM2lhcGhRYXBKSnBwTzU5NTd6NjBNbWs0bU4xcTc1d2cvT1BlZmMrL3Y5dnQvZnVlZW5LRUZFcUlDcXNOV0FWTmlDQTdYd2FTMGlaZWVqbzZPSWlDbHRkSUJkSlhNTE9ZcDUvUGp4c29UVlM1bnIwbVlESklFL2xPYmVCaGFZQW40b0piYm9Bd0J2QmVkSEppY25QeDhZR0doLzhlSkYxZHZLb0pTU2hvWUdmLy8rL1psNFBQNGw4TTJ5SUVvU0xFcng2YzJiTjZXMXRYVlJnbFd6TFZ1MlNDcVZFaEU1TGlJNDU3U0lvRVJFVzJ1ZE1hWnRjbkx5KzJReVdaM0w1WFJIUjRmKzRNTmRvQlVhaFVKaGNXaWxtWi9ORTRaaE9RSG4zTElpMWxxanRTNnZqWTZPOHVUSkU5dmMzTXlEQncrbVlySFluMFVrNjNtZThnQ3RsSExBN3VIaDRiVzVYQzdvZVBkZFBUUTh4SGZmRGpNL1BZZTN0aHFNd3MzNWlBY0hQajVFTkJwOVl4bXkyU3c3ZCs0MHo1NDlDKzdkdTlld2I5KytENnkxM3dEYUsra0UwREF6TXlOS0tiWHR2ZmQ1RWZ6TStFZi80Qys4eDIzK3d6UG0rSWh0Zk1mMy9Lc3V5bCs3dTlGYVk2M2wrdlhycEZJcENvVUNtemR2cHF1cmk5YldWb0lnUUNsRklwRmc0OGFOUEgvK1hFOU5UUWtRTFRHbXZFWEtSRVJwclpXSUVJWWhRUmpRYk42aG1VYit0Q2FQTm5NMDU1djQwZjNJZjdYQkdNUFQ4YWYwZk5MRDBORFFzb3pQbkRsRGIyOHZ4NDRkSXd4RFJBUnJMU0tDS21VYmlVUVFrV1dub0xKMjBVcGpGWUFqVkE2ckJKVEZWNVpJSklJZkJCdzRlSUN4c1RIcTZ1bzRkT2dROFhpY2dZRUI3dDY5eS9Iang0bkg0M1IxZFZIQjhxK3c0aGxYU21HZDVlZHdtakNjbzVETGtaK2FKdlRueUlkVHJGbXpobjkrL1RWalkyTTBOVFZ4Ky9adCt2djdPWGZ1SEtsVWlwNmVIZ0JPbno2TjcvdmxZbDBKS3pJdzc4L1Qrc2RHYm42eWpmNVpTMkh0SmdJUCttY0M1a3lTSTF1U1hQanFBbHByVHAwNlJXZG5KOFZpRWFVVVZWVlZuRDkvbnF0WHI1TEpaSGo0OENGYnQyNzlmUUVFWVVpc1ppMmZYZWw5YldVNzUwZ21rd1JCZ05ZYXovT3cxbEpmWDA4OEhtZDJkcFpjTHZkYUJsNHBnUUNoSDRCMWlIVTRhOEU2UWo5QVJHaHBhVUZyemVEZ0lKRklCR01NMWxxTU1XUXlHU1ltSm9oRUlxeGZ2LzczMTRDSW9BRHRHVEFhWlRUYUxJMlZVaHcrZkJqbkhCY3ZYdVR5NWNzNDUvQThqM1E2emNtVEovRjluNzE3OTlMVzFyYmdTT3MzRCtCMWxCbGpjTTdSM2QzTjBhTkhLUlFLbkRoeGdzN09UbmJ0MnNYMjdkc1pHUmtoSG8vVDE5ZTMrS3QvZlExWWF3Rnd6b2xTQ3MvelVFcVZ0WDFWY0pjdVhTS1JTTkRmMzA4Nm5TNnY3OW16aDc2K1BqbzZPaWdXaTFSWFYyT01XWkMyOVBMOC9QeFNBTDd2RTQxR2Y0ckZZa3BFZVBUb0ViN3ZVMVZWeFcraHQ3ZVhzMmZQY3YvK2ZRcUZBcHMyYmFLbHBhVzhYbDFkVFM2WFkzeDhIQkZ4dGJXMUJpaVc0aEFsSW5wOGZOeHQyTENoUFp2Ti9ydTl2VDJTeitlOTNidDNxeDA3ZGl3cnpKV1ljTTVSVTFORE5Cb3RzNWJQNTNIT2xTK2tPM2Z1TURJeTRoS0poS1RUNmVuYTJ0cXR4V0p4b3FhbVJyOThIWDl4N2RvMXFhdXJFeFlhaVhDVnpLNWJ0MDRHQndkRlJQNzI4blZjV1pBTytIc21rL25zeG8wYlRUTXpNNUZYSFo4M2hZaFFYMS92SHp4NDhIOXRiVzFuZ1NzVnZwWUNtSjJkSlJhTEtSYmFwanBnT3hCN0srOUxtQWJ1QW5PQW5waVljSTJOalVzUkxsbzJteVVNUTFNNXQ1cm1uRE8zYnQxYU5sZm1kNFcyWEwvMC9IOHBVREYyck5DVy93TFJ1Q2t4eDhWNndnQUFBQ1YwUlZoMFpHRjBaVHBqY21WaGRHVUFNakF4Tnkwd09DMHdNMVF3TkRvek1qb3lNaTB3TkRvd01PN21ka3dBQUFBbGRFVllkR1JoZEdVNmJXOWthV1o1QURJd01UY3RNRGd0TUROVU1EUTZNekk2TWpJdE1EUTZNRENmdTg3d0FBQUFBRWxGVGtTdVFtQ0MnO1xyXG4gICAgICAgIHZhciBzdCA9IFwiZm9udC13ZWlnaHQ6Ym9sZCAhaW1wb3J0YW50O2NvbG9yOiAjRkYwMDc1ICFpbXBvcnRhbnQ7Zm9udC1zaXplOiAxNHB4ICFpbXBvcnRhbnQ7dGV4dC10cmFuc2Zvcm06IGxvd2VyY2FzZSAhaW1wb3J0YW50O2N1cnNvcjpwb2ludGVyICFpbXBvcnRhbnQ7dGV4dC1hbGlnbjogY2VudGVyICFpbXBvcnRhbnQ7VGV4dC1TaGFkb3c6ICMwMDAwMDAgMXB4IDBweCAwcHgsICMwMDAwMDAgMXB4IDFweCAwcHgsICMwMDAwMDAgMXB4IC0xcHggMHB4LCAjMDAwMDAwIC0xcHggMXB4IDBweCwgIzAwMDAwMCAtMXB4IDBweCAwcHgsICMwMDAwMDAgLTFweCAtMXB4IDBweCwgIzAwMDAwMCAwcHggMXB4IDBweCwgIzAwMDAwMCAwcHggLTFweCAwcHggIWltcG9ydGFudDtcIjtcclxuICAgICAgICBHLiRFLm5neTJpPWpRdWVyeSgnPGRpdiBjbGFzcz1cIm5HWTJQb3J0SW5mb1wiPjxhIGhyZWY9XCJodHRwOi8vbmFuby5nYWxsZXJ5XCIgdGFyZ2V0PVwiX2JsYW5rXCIgdGl0bGU9XCJuYW5vZ2FsbGVyeTIgfCBlYXN5IHBob3RvIGdhbGxlcnkgZm9yIHlvdXIgd2Vic2l0ZVwiIHN0eWxlPVwiJyArIHN0ICsgJ1wiPjxpbWcgc3JjPVwiJyArIGxvZ28gKyAnXCIgc3R5bGU9XCJoZWlnaHQ6MzJweCAhaW1wb3J0YW50O3dpZHRoOmluaXRpYWwgIWltcG9ydGFudDtib3gtc2hhZG93OiBub25lICFpbXBvcnRhbnQ7dmVydGljYWwtYWxpZ246IG1pZGRsZSAhaW1wb3J0YW50O1wiLz4gJm5ic3A7IG5hbm9nYWxsZXJ5MjwvYT48L2Rpdj4nKS5hcHBlbmRUbyhHLiRFLmJhc2UpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIEcuJEUubmd5MmkuZmluZCgnYScpLm9uKHtcclxuICAgICAgICAgIG1vdXNlZW50ZXI6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgalF1ZXJ5KHRoaXMpLmF0dHIoJ3N0eWxlJywgc3QpO1xyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgalF1ZXJ5KHRoaXMpLmF0dHIoJ3N0eWxlJywgc3QpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBFcnJvciBjb25zb2xlXHJcbiAgICAgIEcuJEUuY29uQ29uc29sZSA9IGpRdWVyeSgnPGRpdiBjbGFzcz1cIm5HWTJDb25zb2xlUGFyZW50XCI+PC9kaXY+JykuYXBwZW5kVG8oRy4kRS5iYXNlKTtcclxuXHJcbiAgICAgIC8vIGkxOG4gdHJhbnNsYXRpb25zXHJcbiAgICAgIGkxOG4oKTtcclxuXHJcbiAgICAgIC8vIGNhY2hlIHNvbWUgdGh1bWJuYWlscyBkYXRhIChzaXplcywgc3R5bGVzLi4uKVxyXG4gICAgICBUaHVtYm5haWxEZWZDYWNoZXMoKTtcclxuXHJcbiAgICAgIC8vIGRvIHNwZWNpYWwgc2V0dGluZ3MgZGVwZW5kaW5nIGZvciBzb21lIG9wdGlvbnNcclxuICAgICAgLy8gdGh1bWJuYWlsIGRpc3BsYXkgdHJhbnNpdGlvblxyXG4gICAgICBzd2l0Y2goIEcudG4ub3B0LkdldCgnZGlzcGxheVRyYW5zaXRpb24nKSApIHtcclxuICAgICAgICBjYXNlICdTQ0FMRURPV04nOlxyXG4gICAgICAgIGNhc2UgJ1JBTkRPTVNDQUxFJzpcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgRy4kRS5iYXNlLmNzcygnb3ZlcmZsb3cnLCAndmlzaWJsZScpO1xyXG4gICAgICAgICAgRy4kRS5jb25UblBhcmVudC5jc3MoJ292ZXJmbG93JywgJ3Zpc2libGUnKTtcclxuICAgICAgICAgIEcuJEUuY29uVG4uY3NzKCdvdmVyZmxvdycsICd2aXNpYmxlJyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gVHJpZ2dlckN1c3RvbUV2ZW50ICggZXZlbnROYW1lICkge1xyXG4gICAgICAvLyBHLiRFLmJhc2UudHJpZ2dlcigncGFnZUNoYW5nZWQubmFub2dhbGxlcnkyJywgbmV3IEV2ZW50KCdwYWdlQ2hhbmdlZC5uYW5vZ2FsbGVyeTInKSk7XHJcbiAgICAgIHZhciBlTiA9IGV2ZW50TmFtZSArICcubmFub2dhbGxlcnkyJztcclxuICAgICAgdmFyIGV2ZW50PW51bGw7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgICBldmVudCA9IG5ldyBFdmVudCggZU4gKTtcclxuICAgICAgICB9IGNhdGNoKGUpIHtcclxuICAgICAgICAgIGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7XHJcbiAgICAgICAgICBldmVudC5pbml0RXZlbnQoZU4sIGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIEcuJEUuYmFzZS50cmlnZ2VyKGVOLCBldmVudCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFxyXG4gICAgLyoqIEBmdW5jdGlvbiBTZXRHbG9iYWxFdmVudHMgKi9cclxuICAgIGZ1bmN0aW9uIFNldEdsb2JhbEV2ZW50cygpIHtcclxuICAgICAgLy8gR0xPQkFMIEVWRU5UIE1BTkFHRU1FTlRcclxuICAgICAgXHJcbiAgICAgIEcuJEUuY29uVG5QYXJlbnQub24oe1xyXG4gICAgICAgIG1vdXNlZW50ZXI6IEdhbGxlcnlNb3VzZUVudGVyLFxyXG4gICAgICAgIG1vdXNlbGVhdmU6IEdhbGxlcnlNb3VzZUxlYXZlXHJcbiAgICAgIH0sIFwiLm5HWTJHVGh1bWJuYWlsXCIpOyAgICAvL3Bhc3MgdGhlIGVsZW1lbnQgYXMgYW4gYXJndW1lbnQgdG8gLm9uXHJcbiAgICAgIFxyXG4gICAgICAvLyBHLkdPTS5oYW1tZXJ0aW1lID0gbmV3IE5HSGFtbWVyKEcuJEUuY29uVG5bMF0sIHsgdG91Y2hBY3Rpb246ICdub25lJyB9KTtcclxuICAgICAgRy5HT00uaGFtbWVydGltZSA9IG5ldyBOR0hhbW1lciggRy4kRS5jb25UblswXSApO1xyXG4gICAgICAvLyBHLkdPTS5oYW1tZXJ0aW1lLmRvbUV2ZW50cyA9IHRydWU7XHJcbiAgICAgIFxyXG4gICAgICBHLkdPTS5oYW1tZXJ0aW1lLm9uKCdwYW4nLCBmdW5jdGlvbihldikge1xyXG4gICAgICAgIGlmKCAhRy5WT00udmlld2VyRGlzcGxheWVkICkge1xyXG4gICAgICAgICAgaWYoIEcuTy5wYWdpbmF0aW9uU3dpcGUgJiYgRy5sYXlvdXQuc3VwcG9ydC5yb3dzICYmIEcuZ2FsbGVyeURpc3BsYXlNb2RlLkdldCgpID09ICdQQUdJTkFUSU9OJyApIHtcbiAgICAgICAgICAgIGlmKCBNYXRoLmFicyhldi5kZWx0YVkpID4gRy5HT00ucGFuVGhyZXNob2xkICkge1xuICAgICAgICAgICAgICBHLkdPTS5wYW5ZT25seSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggIUcuR09NLnBhbllPbmx5ICkge1xyXG4gICAgICAgICAgICAgIEcuJEUuY29uVG4uY3NzKCBHLkNTU3RyYW5zZm9ybU5hbWUgLCAndHJhbnNsYXRlKCcrKGV2LmRlbHRhWCkrJ3B4LDBweCknKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgRy5HT00uaGFtbWVydGltZS5vbigncGFuZW5kJywgZnVuY3Rpb24oZXYpIHtcclxuICAgICAgICBpZiggIUcuVk9NLnZpZXdlckRpc3BsYXllZCApIHtcclxuICAgICAgICAgIGlmKCBHLk8ucGFnaW5hdGlvblN3aXBlICYmIEcubGF5b3V0LnN1cHBvcnQucm93cyAmJiBHLmdhbGxlcnlEaXNwbGF5TW9kZS5HZXQoKSA9PSAnUEFHSU5BVElPTicgKSB7XHJcbiAgICAgICAgICAgIGlmKCAhRy5HT00ucGFuWU9ubHkgKSB7XHJcbiAgICAgICAgICAgICAgaWYoIGV2LmRlbHRhWCA+IDUwICkge1xyXG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvblByZXZpb3VzUGFnZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBpZiggIGV2LmRlbHRhWCA8IC01MCApIHtcclxuICAgICAgICAgICAgICAgIHBhZ2luYXRpb25OZXh0UGFnZSgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEcuR09NLnBhbllPbmx5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIEcuJEUuY29uVG4uY3NzKCBHLkNTU3RyYW5zZm9ybU5hbWUgLCAndHJhbnNsYXRlKDBweCwwcHgpJyk7XHJcbiAgICAgICAgICAgIC8vIHBYPTA7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgRy5HT00uaGFtbWVydGltZS5vbigndGFwJywgZnVuY3Rpb24oZXYpIHtcclxuICAgICAgICBpZiggIUcuVk9NLnZpZXdlckRpc3BsYXllZCApIHtcclxuICAgICAgICAgIGV2LnNyY0V2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgZXYuc3JjRXZlbnQucHJldmVudERlZmF1bHQoKTsgIC8vIGNhbmNlbCAgbW91c2VlbnRlciBldmVudFxyXG5cclxuICAgICAgICAgIGlmKCBldi5wb2ludGVyVHlwZSA9PSAnbW91c2UnKSB7XHJcbiAgICAgICAgICAgIGlmKCBHYWxsZXJ5Q2xpY2tlZChldi5zcmNFdmVudCkgPT0gJ2V4aXQnICkgeyByZXR1cm47IH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgciA9IEdhbGxlcnlFdmVudFJldHJpZXZlRWxlbWVudGwoZXYuc3JjRXZlbnQsIGZhbHNlKTtcclxuICAgICAgICAgICAgaWYoIHIuR09NaWR4ID09IC0xICkgeyByZXR1cm47IH1cclxuICAgICAgICAgICAgaWYoIHIuYWN0aW9uICE9ICdOT05FJyAmJiByLmFjdGlvbiAhPSAnT1BFTicgKSB7XHJcbiAgICAgICAgICAgICAgLy8gdG9vbGJhciB0b3VjaGVkIC0tPiBleGVjdXRlIGFjdGlvblxyXG4gICAgICAgICAgICAgIEdhbGxlcnlDbGlja2VkKGV2LnNyY0V2ZW50KTtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCBHLkdPTS5zbGlkZXIuaG9zdElkeCA9PSByLkdPTWlkeCApIHtcclxuICAgICAgICAgICAgICAvLyB0b3VjaCBvbiB0aHVtYm5haWwgc2xpZGVyIC0+IG9wZW4gaW1tZWRpYXRlbHlcclxuICAgICAgICAgICAgICBUaHVtYm5haWxIb3Zlck91dEFsbCgpO1xyXG4gICAgICAgICAgICAgIFRodW1ibmFpbE9wZW4oRy5HT00uaXRlbXNbRy5HT00uc2xpZGVyLmN1cnJlbnRJZHhdLnRodW1ibmFpbElkeCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiggKEcuR09NLmN1ck5hdkxldmVsID09ICdsMScgJiYgRy5PLnRvdWNoQW5pbWF0aW9uTDEgPT0gZmFsc2UpIHx8ICAoRy5HT00uY3VyTmF2TGV2ZWwgPT0gJ2xOJyAmJiBHLk8udG91Y2hBbmltYXRpb24gPT0gZmFsc2UpICkge1xyXG4gICAgICAgICAgICAgIC8vIG9wZW4gb24gc2luZ2xlIHRvdWNoIChubyBob3ZlciBhbmltYXRpb24pXHJcbiAgICAgICAgICAgICAgVGh1bWJuYWlsT3BlbihHLkdPTS5pdGVtc1tyLkdPTWlkeF0udGh1bWJuYWlsSWR4LCB0cnVlKTtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmKCBHLk8udG91Y2hBdXRvT3BlbkRlbGF5ID4gMCApIHtcclxuICAgICAgICAgICAgICAvLyBvcGVuIG9uIHNpbmdsZSB0b3VjaCBhZnRlciBlbmQgb2YgaG92ZXIgYW5pbWF0aW9uICg9ZGVmaW5lZCBkZWxheSlcclxuICAgICAgICAgICAgICBUaHVtYm5haWxIb3Zlck91dEFsbCgpO1xyXG4gICAgICAgICAgICAgIFRodW1ibmFpbEhvdmVyKCByLkdPTWlkeCApO1xyXG4gICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKCBHLnRvdWNoQXV0b09wZW5EZWxheVRpbWVySUQgKTtcclxuICAgICAgICAgICAgICBHLnRvdWNoQXV0b09wZW5EZWxheVRpbWVySUQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKCBHLnRvdWNoQXV0b09wZW5EZWxheVRpbWVySUQgKTtcclxuICAgICAgICAgICAgICAgIFRodW1ibmFpbE9wZW4oIEcuR09NLml0ZW1zW3IuR09NaWR4XS50aHVtYm5haWxJZHgsIHRydWUgKTtcclxuICAgICAgICAgICAgICB9LCBHLk8udG91Y2hBdXRvT3BlbkRlbGF5ICk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgLy8gdHdvIHRvdWNoIHNjZW5hcmlvXHJcbiAgICAgICAgICAgICAgaWYoICFHLklbRy5HT00uaXRlbXNbci5HT01pZHhdLnRodW1ibmFpbElkeF0uaG92ZXJlZCApIHtcclxuICAgICAgICAgICAgICAgIFRodW1ibmFpbEhvdmVyT3V0QWxsKCk7XHJcbiAgICAgICAgICAgICAgICBUaHVtYm5haWxIb3ZlcihyLkdPTWlkeCk7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gc2Vjb25kIHRvdWNoXHJcbiAgICAgICAgICAgICAgICBUaHVtYm5haWxPcGVuKEcuR09NLml0ZW1zW3IuR09NaWR4XS50aHVtYm5haWxJZHgsIHRydWUpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBcclxuICAgICAgLy8gYnJvd3NlciBsb2NhdGlvbiBoYXNoIG1hbmFnZW1lbnRcclxuICAgICAgaWYoIEcuTy5sb2NhdGlvbkhhc2ggKSB7XHJcbiAgICAgICAgLy8galF1ZXJ5KHdpbmRvdykuYmluZCggJ2hhc2hjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIC8vIFByb2Nlc3NMb2NhdGlvbkhhc2goKTtcclxuICAgICAgICAvLyB9KTtcclxuICAgICAgICBqUXVlcnkod2luZG93KS5vbignaGFzaGNoYW5nZS5uYW5vZ2FsbGVyeTIuJyArIEcuYmFzZUVsdElELCBmdW5jdGlvbigpIHtQcm9jZXNzTG9jYXRpb25IYXNoKCk7fSApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBQYWdlIHJlc2l6ZSAvIG9yaWVudGF0aW9uIGNoYW5nZVxyXG4gICAgICBqUXVlcnkod2luZG93KS5vbigncmVzaXplLm5hbm9nYWxsZXJ5Mi4nICsgRy5iYXNlRWx0SUQgKyAnIG9yaWVudGF0aW9uQ2hhbmdlLm5hbm9nYWxsZXJ5Mi4nICsgRy5iYXNlRWx0SUQsIGRlYm91bmNlKCBSZXNpemVXaW5kb3dFdmVudCwgRy5PLmV2ZW50c0RlYm91bmNlRGVsYXksIGZhbHNlKSApO1xyXG4gICAgICBcclxuICAgICAgLy8gRXZlbnQgcGFnZSBzY3JvbGxlZFxyXG4gICAgICBqUXVlcnkod2luZG93KS5vbignc2Nyb2xsLm5hbm9nYWxsZXJ5Mi4nICsgRy5iYXNlRWx0SUQsIGRlYm91bmNlKCBPblNjcm9sbEV2ZW50LCBHLk8uZXZlbnRzRGVib3VuY2VEZWxheSwgZmFsc2UpICk7XHJcblxyXG4gICAgICAvLyBEZWJvdW5jZWQgZnVuY3Rpb24gdG8gaGlkZSB0aGUgdG9vbGJhcnMgb24gdGhlIHZpZXdlclxyXG4gICAgICBHLlZPTS50b29sc0hpZGUgPSBkZWJvdW5jZSggVmlld2VyVG9vbHNIaWRlLCBHLk8udmlld2VySGlkZVRvb2xzRGVsYXksIGZhbHNlICk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBLZXlib2FyZCBtYW5hZ2VtZW50XHJcbiAgICAgIGpRdWVyeShkb2N1bWVudCkua2V5dXAoZnVuY3Rpb24oZSkge1xyXG4gICAgICAgIGlmKCBHLnBvcHVwLmlzRGlzcGxheWVkICkge1xyXG4gICAgICAgICAgc3dpdGNoKCBlLmtleUNvZGUpIHtcclxuICAgICAgICAgICAgY2FzZSAyNzogICAgLy8gRXNjIGtleVxyXG4gICAgICAgICAgICAgIEcucG9wdXAuY2xvc2UoKTtcclxuICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICBpZiggRy5WT00udmlld2VyRGlzcGxheWVkICkge1xyXG4gICAgICAgICAgICBWaWV3ZXJUb29sc1VuSGlkZSgpO1xyXG4gICAgICAgICAgICBzd2l0Y2goIGUua2V5Q29kZSkge1xyXG4gICAgICAgICAgICAgIGNhc2UgMjc6ICAgIC8vIEVzY2FwZSBrZXlcclxuICAgICAgICAgICAgICBjYXNlIDQwOiAgICAvLyBET1dOXHJcbiAgICAgICAgICAgICAgICBDbG9zZUludGVybmFsVmlld2VyKEcuVk9NLmN1cnJJdGVtSWR4KTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgMzI6ICAgIC8vIFNQQUNFXHJcbiAgICAgICAgICAgICAgY2FzZSAxMzogICAgLy8gRU5URVJcclxuICAgICAgICAgICAgICAgIFNsaWRlc2hvd1RvZ2dsZSgpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgY2FzZSAzODogICAgLy8gVVBcclxuICAgICAgICAgICAgICBjYXNlIDM5OiAgICAvLyBSSUdIVFxyXG4gICAgICAgICAgICAgIGNhc2UgMzM6ICAgIC8vIFBBR0UgVVBcclxuICAgICAgICAgICAgICAgIERpc3BsYXlOZXh0TWVkaWEoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgIGNhc2UgMzc6ICAgIC8vIExFRlRcclxuICAgICAgICAgICAgICBjYXNlIDM0OiAgICAvLyBQQUdFIERPV05cclxuICAgICAgICAgICAgICAgIERpc3BsYXlQcmV2aW91c01lZGlhKCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICBjYXNlIDM1OiAgICAvLyBFTkRcclxuICAgICAgICAgICAgICBjYXNlIDM2OiAgICAvLyBCRUdJTlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIG1vdXNlIHdoZWVsIHRvIHpvb20gaW4vb3V0IHRoZSBpbWFnZSBkaXNwbGF5ZWQgaW4gdGhlIGludGVybmFsIGxpZ2h0Ym94XHJcbiAgICAgIGpRdWVyeSh3aW5kb3cpLmJpbmQoJ21vdXNld2hlZWwgd2hlZWwnLCBmdW5jdGlvbihlKXtcclxuICAgICAgICBpZiggRy5WT00udmlld2VyRGlzcGxheWVkICkge1xyXG4gICAgICAgICAgdmFyIGRlbHRhWSA9IDA7XHJcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAgICAgaWYoIFZpZXdlclpvb21TdGFydCgpICkge1xyXG4gICAgICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LmRlbHRhWSkgeyAvLyBGaXJlRm94IDE3KyAoSUU5KywgQ2hyb21lIDMxKz8pXHJcbiAgICAgICAgICAgICAgZGVsdGFZID0gZS5vcmlnaW5hbEV2ZW50LmRlbHRhWTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChlLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YSkge1xyXG4gICAgICAgICAgICAgIGRlbHRhWSA9IC1lLm9yaWdpbmFsRXZlbnQud2hlZWxEZWx0YTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBWaWV3ZXJab29tSW4oIGRlbHRhWSA8PSAwID8gdHJ1ZSA6IGZhbHNlICk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIG1vdXNlIG1vdXNlIC0+IHVuaGlkZSBsaWdodGJveCB0b29sYmFyc1xyXG4gICAgICBqUXVlcnkod2luZG93KS5iaW5kKCdtb3VzZW1vdmUnLCBmdW5jdGlvbihlKXtcclxuICAgICAgICBpZiggRy5WT00udmlld2VyRGlzcGxheWVkICkge1xyXG4gICAgICAgICAgZGVib3VuY2UoIFZpZXdlclRvb2xzVW5IaWRlLCAxMDAsIGZhbHNlICkoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gZnVsbHNjcmVlbiBtb2RlIG9uL29mZiAtLT4gaW50ZXJuYWwgbGlnaHRib3hcclxuICAgICAgaWYoIG5nc2NyZWVuZnVsbC5lbmFibGVkICkge1xyXG4gICAgICAgIC8vIG5nc2NyZWVuZnVsbC5vbmNoYW5nZSgoKSA9PiB7XHJcbiAgICAgICAgbmdzY3JlZW5mdWxsLm9uY2hhbmdlKCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIGlmKCBHLlZPTS52aWV3ZXJEaXNwbGF5ZWQgKSB7XHJcbiAgICAgICAgICAgIGlmKCBuZ3NjcmVlbmZ1bGwuaXNGdWxsc2NyZWVuICkge1xyXG4gICAgICAgICAgICAgIEcuVk9NLnZpZXdlcklzRnVsbHNjcmVlbj10cnVlO1xyXG4gICAgICAgICAgICAgIEcuVk9NLiR2aWV3ZXIuZmluZCgnLmZ1bGxzY3JlZW5CdXR0b24nKS5odG1sKEcuTy5pY29ucy52aWV3ZXJGdWxsc2NyZWVuT2ZmKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICBHLlZPTS52aWV3ZXJJc0Z1bGxzY3JlZW49ZmFsc2U7XHJcbiAgICAgICAgICAgICAgRy5WT00uJHZpZXdlci5maW5kKCcuZnVsbHNjcmVlbkJ1dHRvbicpLmh0bWwoRy5PLmljb25zLnZpZXdlckZ1bGxzY3JlZW5Pbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8tLS0tLSBNYW5hZ2UgYnJvd3NlciBsb2NhdGlvbiBoYXNoIChkZWVwIGxpbmtpbmcgYW5kIGJyb3dzZXIgYmFjay9mb3J3YXJkKVxyXG4gICAgZnVuY3Rpb24gUHJvY2Vzc0xvY2F0aW9uSGFzaCgpIHtcclxuXHJcbiAgICAgIC8vIHN0YW5kYXJkIHVzZSBjYXNlIC0+IGxvY2F0aW9uIGhhc2ggcHJvY2Vzc2luZ1xyXG4gICAgICBpZiggIUcuTy5sb2NhdGlvbkhhc2ggKSB7IHJldHVybiBmYWxzZTsgfVxyXG5cclxuICAgICAgdmFyIGN1ckdhbCA9ICcjbmFub2dhbGxlcnkvJyArIEcuYmFzZUVsdElEICsgJy8nLFxyXG4gICAgICBuZXdMb2NhdGlvbkhhc2ggPSBsb2NhdGlvbi5oYXNoO1xyXG4gICAgICBpZiggRy5PLmRlYnVnTW9kZSApIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFBST0NFU1MgTE9DQVRJT04gSEFTSCcpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCduZXdMb2NhdGlvbkhhc2gxOiAnICtuZXdMb2NhdGlvbkhhc2gpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdHLmxvY2F0aW9uSGFzaExhc3RVc2VkOiAnICtHLmxvY2F0aW9uSGFzaExhc3RVc2VkKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYoIG5ld0xvY2F0aW9uSGFzaCA9PSAnJyApIHtcclxuICAgICAgICAvLyBpZiggRy5HT00ubGFzdERpc3BsYXllZElkeCAhPSAtMSApIHtcclxuICAgICAgICBpZiggRy5sb2NhdGlvbkhhc2hMYXN0VXNlZCAhPT0gJycgKSB7XHJcbiAgICAgICAgICAvLyBiYWNrIGJ1dHRvbiBhbmQgbm8gaGFzaCAtLT4gZGlzcGxheSBmaXJzdCBhbGJ1bVxyXG4gICAgICAgICAgaWYoIEcuTy5kZWJ1Z01vZGUgKSB7IGNvbnNvbGUubG9nKCdkaXNwbGF5IHJvb3QgYWxidW0nICApOyB9XHJcbiAgICAgICAgICBHLmxvY2F0aW9uSGFzaExhc3RVc2VkID0gJyc7XHJcbiAgICAgICAgICBpZiggRy5PLmRlYnVnTW9kZSApIHsgY29uc29sZS5sb2coJ25ldzMgRy5sb2NhdGlvbkhhc2hMYXN0VXNlZDogJyArIEcubG9jYXRpb25IYXNoTGFzdFVzZWQpOyB9XHJcbiAgICAgICAgICBEaXNwbGF5QWxidW0oJycsICcwJyk7XHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmKCBuZXdMb2NhdGlvbkhhc2ggPT0gRy5sb2NhdGlvbkhhc2hMYXN0VXNlZCApIHsgcmV0dXJuOyB9XHJcbiAgICAgIFxyXG4gICAgICBpZiggbmV3TG9jYXRpb25IYXNoLmluZGV4T2YoY3VyR2FsKSA9PSAwICkge1xyXG4gICAgICAgIC8vIGl0ZW0gSURzIGRldGVjdGVkXHJcbiAgICAgICAgdmFyIElEcz1wYXJzZUlEcyggbmV3TG9jYXRpb25IYXNoLnN1YnN0cmluZyhjdXJHYWwubGVuZ3RoKSApO1xyXG4gICAgICAgIGlmKCBJRHMuaW1hZ2VJRCAhPSAnMCcgKSB7XHJcbiAgICAgICAgICBpZiggRy5PLmRlYnVnTW9kZSApIHsgY29uc29sZS5sb2coJ2Rpc3BsYXkgaW1hZ2U6ICcgKyBJRHMuYWxidW1JRCArJy0nKyBJRHMuaW1hZ2VJRCApOyB9XHJcbiAgICAgICAgICBEaXNwbGF5UGhvdG8oIElEcy5pbWFnZUlELCBJRHMuYWxidW1JRCApO1xyXG4gICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgaWYoIEcuTy5kZWJ1Z01vZGUgKSB7IGNvbnNvbGUubG9nKCdkaXNwbGF5IGFsYnVtOiAnICsgSURzLmFsYnVtSUQgICk7IH1cclxuICAgICAgICAgIERpc3BsYXlBbGJ1bSggJy0xJywgSURzLmFsYnVtSUQgKTtcclxuICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSAgICBcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuXHJcbiAgICAvLy0tLS0gU2V0IGEgbmV3IGJyb3dzZXIgbG9jYXRpb24gaGFzaFxyXG4gICAgZnVuY3Rpb24gU2V0TG9jYXRpb25IYXNoKGFsYnVtSUQsIGltYWdlSUQgKSB7XHJcbiAgICAgIGlmKCAhRy5PLmxvY2F0aW9uSGFzaCApIHsgcmV0dXJuIGZhbHNlOyB9XHJcblxyXG4gICAgICBpZiggRy5PLmRlYnVnTW9kZSApIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFNFVCBMT0NBVElPTiBIQVNIJyk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmKCBpbWFnZUlEID09ICcnICYmIChhbGJ1bUlEID09ICctMScgfHwgYWxidW1JRCA9PSAnMCcgfHwgRy5PLmFsYnVtID09IGFsYnVtSUQgKSApIHtcclxuICAgICAgICAvLyByb290IGFsYnVtIGxldmVsIC0tPiBkbyBub3Qgc2V0IHRvcC5sb2NhdGlvbi5oYXNoIGlmIG5vdCBhbHJlYWR5IHNldFxyXG4gICAgICAgIGlmKCBsb2NhdGlvbi5oYXNoICE9ICcnICkge1xyXG4gICAgICAgICAgLy8gdHJ5IHRvIGNsZWFyIHRoZSBoYXNoIGlmIHNldFxyXG4gICAgICAgICAgaWYgKFwicHVzaFN0YXRlXCIgaW4gaGlzdG9yeSkge1xyXG4gICAgICAgICAgICBoaXN0b3J5LnB1c2hTdGF0ZShcIlwiLCBkb2N1bWVudC50aXRsZSwgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICsgd2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbG9jYXRpb24uaGFzaD0nJztcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgRy5sb2NhdGlvbkhhc2hMYXN0VXNlZD0nJztcclxuICAgICAgICBpZiggRy5PLmRlYnVnTW9kZSApIHsgY29uc29sZS5sb2coJ25ldzIgRy5sb2NhdGlvbkhhc2hMYXN0VXNlZDogJytHLmxvY2F0aW9uSGFzaExhc3RVc2VkKTsgfVxyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgdmFyIG5ld0xvY2F0aW9uSGFzaD0nIycrJ25hbm9nYWxsZXJ5LycrRy5iYXNlRWx0SUQrJy8nKyBhbGJ1bUlEO1xyXG4gICAgICBpZiggaW1hZ2VJRCAhPSAnJyApIHtcclxuICAgICAgICBuZXdMb2NhdGlvbkhhc2grPScvJytpbWFnZUlEO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgbEg9bG9jYXRpb24uaGFzaDtcclxuICAgICAgaWYoIEcuTy5kZWJ1Z01vZGUgKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ25ld0xvY2F0aW9uSGFzaDI6ICcrbmV3TG9jYXRpb25IYXNoKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnbG9jYXRpb24uaGFzaDogJytsSCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIEcubG9jYXRpb25IYXNoTGFzdFVzZWQ9bmV3TG9jYXRpb25IYXNoO1xyXG4gICAgICBpZiggRy5PLmRlYnVnTW9kZSApIHsgY29uc29sZS5sb2coJ25ldyBHLmxvY2F0aW9uSGFzaExhc3RVc2VkOiAnK0cubG9jYXRpb25IYXNoTGFzdFVzZWQpOyB9XHJcbiAgICAgIFxyXG4gICAgICBpZiggIGxIID09ICcnIHx8IGxIICE9IG5ld0xvY2F0aW9uSGFzaCApIHtcclxuICAgICAgICAvLyBHLmxvY2F0aW9uSGFzaExhc3RVc2VkPScjJytuZXdMb2NhdGlvbkhhc2g7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIHRvcC5sb2NhdGlvbi5oYXNoPW5ld0xvY2F0aW9uSGFzaDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0Y2goZSkge1xyXG4gICAgICAgICAgLy8gbG9jYXRpb24gaGFzaCBpcyBub3Qgc3VwcG9ydGVkIGJ5IGN1cnJlbnQgYnJvd3NlciAtLT4gZGlzYWJsZSB0aGUgb3B0aW9uXHJcbiAgICAgICAgICBHLk8ubG9jYXRpb25IYXNoPWZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIFJlc2l6ZVdpbmRvd0V2ZW50KCkge1xyXG4gICAgICBDYWNoZVZpZXdwb3J0KCk7XHJcblxyXG4gICAgICBpZiggRy5WT00udmlld2VyRGlzcGxheWVkICkge1xyXG4gICAgICAgIFJlc2l6ZUludGVybmFsVmlld2VyKCk7XHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgaWYoIEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCApIHtcclxuICAgICAgICAgIHZhciBudyA9IFJldHJpZXZlQ3VyV2lkdGgoKTtcclxuICAgICAgICAgIGlmKCBHLkdPTS5hbGJ1bUlkeCAhPSAtMSAmJiBcclxuICAgICAgICAgICAgICAgICggRy50bi5zZXR0aW5ncy5oZWlnaHRbRy5HT00uY3VyTmF2TGV2ZWxdW0cuR09NLmN1cldpZHRoXSAhPSBHLnRuLnNldHRpbmdzLmhlaWdodFtHLkdPTS5jdXJOYXZMZXZlbF1bbnddIHx8IFxyXG4gICAgICAgICAgICAgICAgRy50bi5zZXR0aW5ncy53aWR0aFtHLkdPTS5jdXJOYXZMZXZlbF1bRy5HT00uY3VyV2lkdGhdICE9IEcudG4uc2V0dGluZ3Mud2lkdGhbRy5HT00uY3VyTmF2TGV2ZWxdW253XSApICkge1xyXG4gICAgICAgICAgICAgICAgICAvLyBkbyBub3QgdXNlIHNldHRpbmdzLmdldEgoKSAvIHNldHRpbmdzLmdldFcoKVxyXG4gICAgICAgICAgICAvLyB0aHVtYm5haWwgc2l6ZSBjaGFuZ2VkIC0tPiByZW5kZXIgdGhlIGdhbGxlcnkgd2l0aCB0aGUgbmV3IHNpemVzXHJcbiAgICAgICAgICAgIEcuR09NLmN1cldpZHRoID0gbnc7XHJcbiAgICAgICAgICAgIC8vRy5sYXlvdXQuU2V0RW5naW5lKCk7XHJcbiAgICAgICAgICAgIEcuR09NLnBhZ2luYXRpb24uY3VycmVudFBhZ2UgPSAwO1xyXG4gICAgICAgICAgICBHYWxsZXJ5UmVuZGVyKCBHLkdPTS5hbGJ1bUlkeCApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIEdhbGxlcnlSZXNpemUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgIFxyXG4gICAgLy8gRGVwcmVjaWF0ZWQgLSBpZiBnYWxsZXJ5IGN1cnJlbnRseSByZWZyZXNoZWQgKEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZD1mYWxzZSksIHBhZ2UgbWF5IGJlIHNjcm9sbGVkIGJ1dCBpdCB3aWxsIG5vdCBiZSByZWZyZXNoZWQgYWdhaW5cclxuICAgIGZ1bmN0aW9uIE9uU2Nyb2xsRXZlbnRfT0xEKCkge1xyXG4gICAgICBpZiggIUcuVk9NLnZpZXdlckRpc3BsYXllZCApIHtcclxuICAgICAgICBpZiggRy5nYWxsZXJ5UmVzaXplRXZlbnRFbmFibGVkICkge1xyXG4gICAgICAgICAgR2FsbGVyeVJlc2l6ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgZnVuY3Rpb24gT25TY3JvbGxFdmVudCgpIHtcclxuICAgICAgaWYoICFHLlZPTS52aWV3ZXJEaXNwbGF5ZWQgKSB7XHJcbiAgICAgICAgR2FsbGVyeVJlc2l6ZU9uU2Nyb2xsRXZlbnQoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gdGhlIGdhbGxlcnkgbWF5IGN1cnJlbnRseSBiZSByZWZyZXNoZWQsIHNvIGVuc3VyZSB0aGF0IGF0IHRoZSBlbmQgb2YgdGhlIHJlZnJlc2gsIHRoZSBnYWxsZXJ5IGlzIHJlZnJlc2hlZCBhZ2FpbiBiZWNhdXNlIHRoZSBwYWdlIG1heSBoYXZlIGJlZW4gc2Nyb2xsZWQgaW4gdGhlIG1lYW50aW1lXHJcbiAgICBmdW5jdGlvbiBHYWxsZXJ5UmVzaXplT25TY3JvbGxFdmVudCgpIHtcclxuICAgICAgaWYoIEcuZ2FsbGVyeVJlc2l6ZUV2ZW50RW5hYmxlZCA9PSBmYWxzZSkge1xyXG4gICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KEdhbGxlcnlSZXNpemVPblNjcm9sbEV2ZW50LCAxMCk7ICAvLyBjaGVjayBhZ2FpbiBpbiAxMG1zXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgR2FsbGVyeVJlc2l6ZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG5cclxuICAgIFxyXG4gICAgLy8gSTE4TiA6IGRlZmluZSB0ZXh0IHRyYW5zbGF0aW9uc1xyXG4gICAgZnVuY3Rpb24gaTE4bigpIHtcclxuXHJcbiAgICAgIC8vIGJyb3dzZXIgbGFuZ3VhZ2VcclxuICAgICAgRy5pMThuTGFuZyA9IChuYXZpZ2F0b3IubGFuZ3VhZ2UgfHwgbmF2aWdhdG9yLnVzZXJMYW5ndWFnZSkudG9VcHBlckNhc2UoKTtcclxuICAgICAgaWYoIEcuaTE4bkxhbmcgPT09ICdVTkRFRklORUQnKSB7IEcuaTE4bkxhbmc9Jyc7IH1cclxuXHJcbiAgICAgIHZhciBsbGFuZz0tKCdfJytHLmkxOG5MYW5nKS5sZW5ndGg7XHJcbiAgICAgIFxyXG4gICAgICBpZiggdG9UeXBlKEcuTy5pMThuKSA9PSAnb2JqZWN0JyApe1xyXG4gICAgICBcclxuICAgICAgICBmb3IoIHZhciBrZXkgaW4gRy5PLmkxOG4gKSB7XHJcbiAgICAgICAgICAvL3ZhciB2YWx1ZSA9IEcuTy5pMThuW2tleV07XHJcbiAgICAgICAgICB2YXIgcz1rZXkuc3Vic3RyKGxsYW5nKTtcclxuICAgICAgICAgIGlmKCBzID09ICgnXycrRy5pMThuTGFuZykgKSB7XHJcbiAgICAgICAgICAgIEcuaTE4blRyYW5zbGF0aW9uc1trZXkuc3Vic3RyKDAsa2V5Lmxlbmd0aC1zLmxlbmd0aCldPUcuTy5pMThuW2tleV07XHJcbiAgICAgICAgICB9IFxyXG4gICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIEcuaTE4blRyYW5zbGF0aW9uc1trZXldPUcuTy5pMThuW2tleV07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gR2V0STE4bkl0ZW0oIGl0ZW0sIHByb3BlcnR5ICkge1xyXG4gICAgICB2YXIgcz0nJztcclxuICAgICAgaWYoIEcuaTE4bkxhbmcgIT0gJycgKSB7XHJcbiAgICAgICAgaWYoIGl0ZW1bcHJvcGVydHkrJ18nK0cuaTE4bkxhbmddICE9PSB1bmRlZmluZWQgJiYgaXRlbVtwcm9wZXJ0eSsnXycrRy5pMThuTGFuZ10ubGVuZ3RoPjAgKSB7XHJcbiAgICAgICAgICBzPWl0ZW1bcHJvcGVydHkrJ18nK0cuaTE4bkxhbmddO1xyXG4gICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIHM9aXRlbVtwcm9wZXJ0eV07XHJcbiAgICAgIHJldHVybiBzO1xyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gUmV0cmlldmVDdXJXaWR0aCgpIHtcclxuICAgICAgdmFyIHZwVyA9IEcuR09NLmNhY2hlLnZpZXdwb3J0Lnc7XHJcbiAgICAgIFxyXG4gICAgICBpZiggRy5PLmJyZWFrcG9pbnRTaXplU00gPiAwICYmIHZwVyA8IEcuTy5icmVha3BvaW50U2l6ZVNNKSB7IHJldHVybiAneHMnOyB9XHJcbiAgICAgIGlmKCBHLk8uYnJlYWtwb2ludFNpemVNRSA+IDAgJiYgdnBXIDwgRy5PLmJyZWFrcG9pbnRTaXplTUUpIHsgcmV0dXJuICdzbSc7IH1cclxuICAgICAgaWYoIEcuTy5icmVha3BvaW50U2l6ZUxBID4gMCAmJiB2cFcgPCBHLk8uYnJlYWtwb2ludFNpemVMQSkgeyByZXR1cm4gJ21lJzsgfVxyXG4gICAgICBpZiggRy5PLmJyZWFrcG9pbnRTaXplWEwgPiAwICYmIHZwVyA8IEcuTy5icmVha3BvaW50U2l6ZVhMKSB7IHJldHVybiAnbGEnOyB9XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4gJ3hsJztcclxuICAgIH1cclxuXHJcbiAgICBcclxuICAgIC8qKiBAZnVuY3Rpb24gYnJvd3Nlck5vdGlmaWNhdGlvbiAqL1xyXG4gICAgZnVuY3Rpb24gYnJvd3Nlck5vdGlmaWNhdGlvbigpIHtcclxuICAgICAgdmFyIG0gPSAnWW91ciBicm93c2VyIHZlcnNpb24gaXMgbm90IHN1cHBvcnRlZCBhbnltb3JlLiBUaGUgaW1hZ2UgZ2FsbGVyeSBjYW5ub3QgYmUgZGlzcGxheWVkLiA8YnI+PGJyPlBsZWFzZSB1cGRhdGUgdG8gYSBtb3JlIHJlY2VudCBvbmUuIERvd25sb2FkOjxicj4nO1xyXG4gICAgICBtICAgICs9ICcmbmJzcDsmbmJzcDsmbmJzcDsgPGEgaHJlZj1cImh0dHA6Ly93d3cuZ29vZ2xlLmNvbS9jaHJvbWUvP2hsPWVuLVVTKVwiPkNocm9tZTwvYT48YnI+JztcclxuICAgICAgbSAgICArPSAnJm5ic3A7Jm5ic3A7Jm5ic3A7IDxhIGhyZWY9XCJodHRwOi8vd3d3Lm1vemlsbGEuY29tL2ZpcmVmb3gvKVwiPkZpcmVmb3g8L2E+PGJyPic7XHJcbiAgICAgIG0gICAgKz0gJyZuYnNwOyZuYnNwOyZuYnNwOyA8YSBocmVmPVwiaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3dpbmRvd3MvaW50ZXJuZXQtZXhwbG9yZXIvZGVmYXVsdC5hc3B4XCI+SW50ZXJuZXQgRXhwbG9yZXI8L2E+PGJyPic7XHJcbiAgICAgIG0gICAgKz0gJyZuYnNwOyZuYnNwOyZuYnNwOyA8YSBocmVmPVwiaHR0cDovL3d3dy5hcHBsZS5jb20vc2FmYXJpL2Rvd25sb2FkL1wiPlNhZmFyaTwvYT4nO1xyXG4gICAgICBOYW5vQWxlcnQoRywgIG0sIGZhbHNlKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBPcmlnaW5hbCBhdXRob3IgOiBKb2huIEhydmF0aW4sIExlYWQgUHJvZ3JhbSBNYW5hZ2VyLCBJbnRlcm5ldCBFeHBsb3JlciAtIGh0dHA6Ly9ibG9ncy5tc2RuLmNvbS9iL2llL2FyY2hpdmUvMjAxMS8xMC8yOC9hLWJlc3QtcHJhY3RpY2UtZm9yLXByb2dyYW1taW5nLXdpdGgtdmVuZG9yLXByZWZpeGVzLmFzcHhcclxuICAgIGZ1bmN0aW9uIEZpcnN0U3VwcG9ydGVkUHJvcGVydHlOYW1lKHByZWZpeGVkUHJvcGVydHlOYW1lcykge1xyXG4gICAgICB2YXIgdGVtcERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJlZml4ZWRQcm9wZXJ0eU5hbWVzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wRGl2LnN0eWxlW3ByZWZpeGVkUHJvcGVydHlOYW1lc1tpXV0gIT0gJ3VuZGVmaW5lZCcpXHJcbiAgICAgICAgICByZXR1cm4gcHJlZml4ZWRQcm9wZXJ0eU5hbWVzW2ldO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIFxyXG4gICAgXHJcbiAgICBcclxuICB9XHJcbiAgXHJcblxyXG5cclxuLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4vLyMjIGltYWdlc0xvYWRlZCAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbi8vIGV4dGVybmFsIG1vZHVsZSBFTUJFREVEIGluIG5hbm9nYWxsZXJ5XHJcbi8vIE5HWSBCVUlMRDpcclxuLy8gcmVwbGFjZSBcImltYWdlc0xvYWRlZFwiIHdpdGggXCJuZ2ltYWdlc0xvYWRlZFwiXHJcbi8vIHJlcGxhY2UgXCJJbWFnZXNMb2FkZWRcIiB3aXRoIFwibmdJbWFnZXNMb2FkZWRcIlxyXG4vLyByZXBsYWNlIFwiRXZFbWl0dGVyXCIgd2l0aCBcIm5nRXZFbWl0dGVyXCJcclxuLy8gcmVwbGFjZSBcInZhciAkID0gd2luZG93LmpRdWVyeVwiIHdpdGggXCJ2YXIgJCA9IGpRdWVyeTtcIlxyXG4vLyAyeCAoZ2xvYmFsLm5nRXZFbWl0dGVyIGFuZCB3aW5kb3cubmdpbWFnZXNMb2FkZWQgPSBmLi4uKWlnbm9yZSBwYWNrYWdlIG1hbmFnZXIgYW5kIHNldCBicm93c2VyIGdsb2JhbFxyXG5cclxuXHJcblxyXG4vKiFcclxuICogaW1hZ2VzTG9hZGVkIFBBQ0tBR0VEIHY0LjEuMVxyXG4gKiBKYXZhU2NyaXB0IGlzIGFsbCBsaWtlIFwiWW91IGltYWdlcyBhcmUgZG9uZSB5ZXQgb3Igd2hhdD9cIlxyXG4gKiBNSVQgTGljZW5zZVxyXG4gKi9cclxuXHJcbi8qKlxyXG4gKiBFdkVtaXR0ZXIgdjEuMC4zXHJcbiAqIExpbCcgZXZlbnQgZW1pdHRlclxyXG4gKiBNSVQgTGljZW5zZVxyXG4gKi9cclxuXHJcbiBcclxuLyoganNoaW50IHVudXNlZDogdHJ1ZSwgdW5kZWY6IHRydWUsIHN0cmljdDogdHJ1ZSAqL1xyXG5cclxuKCBmdW5jdGlvbiggZ2xvYmFsLCBmYWN0b3J5ICkge1xyXG4gIC8vIHVuaXZlcnNhbCBtb2R1bGUgZGVmaW5pdGlvblxyXG4gIC8qIGpzaGludCBzdHJpY3Q6IGZhbHNlICovIC8qIGdsb2JhbHMgZGVmaW5lLCBtb2R1bGUsIHdpbmRvdyAqL1xyXG4vLyAgaWYgKCB0eXBlb2YgZGVmaW5lID09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCApIHtcclxuICAgIC8vIEFNRCAtIFJlcXVpcmVKU1xyXG4vLyAgICBkZWZpbmUoICdldi1lbWl0dGVyL2V2LWVtaXR0ZXInLGZhY3RvcnkgKTtcclxuLy8gIH0gZWxzZSBpZiAoIHR5cGVvZiBtb2R1bGUgPT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHMgKSB7XHJcbiAgICAvLyBDb21tb25KUyAtIEJyb3dzZXJpZnksIFdlYnBhY2tcclxuLy8gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XHJcbi8vICB9IGVsc2Uge1xyXG4gICAgLy8gQnJvd3NlciBnbG9iYWxzXHJcbiAgICBnbG9iYWwubmdFdkVtaXR0ZXIgPSBmYWN0b3J5KCk7XHJcbi8vICB9XHJcblxyXG59KCB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnID8gd2luZG93IDogdGhpcywgZnVuY3Rpb24oKSB7XHJcblxyXG5cclxuXHJcbmZ1bmN0aW9uIG5nRXZFbWl0dGVyKCkge31cclxuXHJcbnZhciBwcm90byA9IG5nRXZFbWl0dGVyLnByb3RvdHlwZTtcclxuXHJcbnByb3RvLm9uID0gZnVuY3Rpb24oIGV2ZW50TmFtZSwgbGlzdGVuZXIgKSB7XHJcbiAgaWYgKCAhZXZlbnROYW1lIHx8ICFsaXN0ZW5lciApIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgLy8gc2V0IGV2ZW50cyBoYXNoXHJcbiAgdmFyIGV2ZW50cyA9IHRoaXMuX2V2ZW50cyA9IHRoaXMuX2V2ZW50cyB8fCB7fTtcclxuICAvLyBzZXQgbGlzdGVuZXJzIGFycmF5XHJcbiAgdmFyIGxpc3RlbmVycyA9IGV2ZW50c1sgZXZlbnROYW1lIF0gPSBldmVudHNbIGV2ZW50TmFtZSBdIHx8IFtdO1xyXG4gIC8vIG9ubHkgYWRkIG9uY2VcclxuICBpZiAoIGxpc3RlbmVycy5pbmRleE9mKCBsaXN0ZW5lciApID09IC0xICkge1xyXG4gICAgbGlzdGVuZXJzLnB1c2goIGxpc3RlbmVyICk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gdGhpcztcclxufTtcclxuXHJcbnByb3RvLm9uY2UgPSBmdW5jdGlvbiggZXZlbnROYW1lLCBsaXN0ZW5lciApIHtcclxuICBpZiAoICFldmVudE5hbWUgfHwgIWxpc3RlbmVyICkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICAvLyBhZGQgZXZlbnRcclxuICB0aGlzLm9uKCBldmVudE5hbWUsIGxpc3RlbmVyICk7XHJcbiAgLy8gc2V0IG9uY2UgZmxhZ1xyXG4gIC8vIHNldCBvbmNlRXZlbnRzIGhhc2hcclxuICB2YXIgb25jZUV2ZW50cyA9IHRoaXMuX29uY2VFdmVudHMgPSB0aGlzLl9vbmNlRXZlbnRzIHx8IHt9O1xyXG4gIC8vIHNldCBvbmNlTGlzdGVuZXJzIG9iamVjdFxyXG4gIHZhciBvbmNlTGlzdGVuZXJzID0gb25jZUV2ZW50c1sgZXZlbnROYW1lIF0gPSBvbmNlRXZlbnRzWyBldmVudE5hbWUgXSB8fCB7fTtcclxuICAvLyBzZXQgZmxhZ1xyXG4gIG9uY2VMaXN0ZW5lcnNbIGxpc3RlbmVyIF0gPSB0cnVlO1xyXG5cclxuICByZXR1cm4gdGhpcztcclxufTtcclxuXHJcbnByb3RvLm9mZiA9IGZ1bmN0aW9uKCBldmVudE5hbWUsIGxpc3RlbmVyICkge1xyXG4gIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHMgJiYgdGhpcy5fZXZlbnRzWyBldmVudE5hbWUgXTtcclxuICBpZiAoICFsaXN0ZW5lcnMgfHwgIWxpc3RlbmVycy5sZW5ndGggKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIHZhciBpbmRleCA9IGxpc3RlbmVycy5pbmRleE9mKCBsaXN0ZW5lciApO1xyXG4gIGlmICggaW5kZXggIT0gLTEgKSB7XHJcbiAgICBsaXN0ZW5lcnMuc3BsaWNlKCBpbmRleCwgMSApO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHRoaXM7XHJcbn07XHJcblxyXG5wcm90by5lbWl0RXZlbnQgPSBmdW5jdGlvbiggZXZlbnROYW1lLCBhcmdzICkge1xyXG4gIHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9ldmVudHMgJiYgdGhpcy5fZXZlbnRzWyBldmVudE5hbWUgXTtcclxuICBpZiAoICFsaXN0ZW5lcnMgfHwgIWxpc3RlbmVycy5sZW5ndGggKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIHZhciBpID0gMDtcclxuICB2YXIgbGlzdGVuZXIgPSBsaXN0ZW5lcnNbaV07XHJcbiAgYXJncyA9IGFyZ3MgfHwgW107XHJcbiAgLy8gb25jZSBzdHVmZlxyXG4gIHZhciBvbmNlTGlzdGVuZXJzID0gdGhpcy5fb25jZUV2ZW50cyAmJiB0aGlzLl9vbmNlRXZlbnRzWyBldmVudE5hbWUgXTtcclxuXHJcbiAgd2hpbGUgKCBsaXN0ZW5lciApIHtcclxuICAgIHZhciBpc09uY2UgPSBvbmNlTGlzdGVuZXJzICYmIG9uY2VMaXN0ZW5lcnNbIGxpc3RlbmVyIF07XHJcbiAgICBpZiAoIGlzT25jZSApIHtcclxuICAgICAgLy8gcmVtb3ZlIGxpc3RlbmVyXHJcbiAgICAgIC8vIHJlbW92ZSBiZWZvcmUgdHJpZ2dlciB0byBwcmV2ZW50IHJlY3Vyc2lvblxyXG4gICAgICB0aGlzLm9mZiggZXZlbnROYW1lLCBsaXN0ZW5lciApO1xyXG4gICAgICAvLyB1bnNldCBvbmNlIGZsYWdcclxuICAgICAgZGVsZXRlIG9uY2VMaXN0ZW5lcnNbIGxpc3RlbmVyIF07XHJcbiAgICB9XHJcbiAgICAvLyB0cmlnZ2VyIGxpc3RlbmVyXHJcbiAgICBsaXN0ZW5lci5hcHBseSggdGhpcywgYXJncyApO1xyXG4gICAgLy8gZ2V0IG5leHQgbGlzdGVuZXJcclxuICAgIGkgKz0gaXNPbmNlID8gMCA6IDE7XHJcbiAgICBsaXN0ZW5lciA9IGxpc3RlbmVyc1tpXTtcclxuICB9XHJcblxyXG4gIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxucmV0dXJuIG5nRXZFbWl0dGVyO1xyXG5cclxufSkpO1xyXG5cclxuLyohXHJcbiAqIG5naW1hZ2VzTG9hZGVkIHY0LjEuMVxyXG4gKiBKYXZhU2NyaXB0IGlzIGFsbCBsaWtlIFwiWW91IGltYWdlcyBhcmUgZG9uZSB5ZXQgb3Igd2hhdD9cIlxyXG4gKiBNSVQgTGljZW5zZVxyXG4gKi9cclxuXHJcbiggZnVuY3Rpb24oIHdpbmRvdywgZmFjdG9yeSApIHsgJ3VzZSBzdHJpY3QnO1xyXG4gIC8vIHVuaXZlcnNhbCBtb2R1bGUgZGVmaW5pdGlvblxyXG5cclxuICAvKmdsb2JhbCBkZWZpbmU6IGZhbHNlLCBtb2R1bGU6IGZhbHNlLCByZXF1aXJlOiBmYWxzZSAqL1xyXG5cclxuLy8gIGlmICggdHlwZW9mIGRlZmluZSA9PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgKSB7XHJcbiAgICAvLyBBTURcclxuLy8gICAgZGVmaW5lKCBbXHJcbi8vICAgICAgJ2V2LWVtaXR0ZXIvZXYtZW1pdHRlcidcclxuLy8gICAgXSwgZnVuY3Rpb24oIG5nRXZFbWl0dGVyICkge1xyXG4vLyAgICAgIHJldHVybiBmYWN0b3J5KCB3aW5kb3csIG5nRXZFbWl0dGVyICk7XHJcbi8vICAgIH0pO1xyXG4vLyAgfSBlbHNlIGlmICggdHlwZW9mIG1vZHVsZSA9PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cyApIHtcclxuICAgIC8vIENvbW1vbkpTXHJcbi8vICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShcclxuLy8gICAgICB3aW5kb3csXHJcbi8vICAgICAgcmVxdWlyZSgnZXYtZW1pdHRlcicpXHJcbi8vICAgICk7XHJcbi8vICB9IGVsc2Uge1xyXG4gICAgLy8gYnJvd3NlciBnbG9iYWxcclxuICAgIHdpbmRvdy5uZ2ltYWdlc0xvYWRlZCA9IGZhY3RvcnkoXHJcbiAgICAgIHdpbmRvdyxcclxuICAgICAgd2luZG93Lm5nRXZFbWl0dGVyXHJcbiAgICApO1xyXG4gIC8vfVxyXG5cclxufSkoIHdpbmRvdyxcclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICBmYWN0b3J5IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vXHJcblxyXG5mdW5jdGlvbiBmYWN0b3J5KCB3aW5kb3csIG5nRXZFbWl0dGVyICkge1xyXG5cclxuXHJcblxyXG4vLyB2YXIgJCA9IHdpbmRvdy5qUXVlcnk7XHJcbnZhciAkID0galF1ZXJ5O1xyXG52YXIgY29uc29sZSA9IHdpbmRvdy5jb25zb2xlO1xyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gaGVscGVycyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xyXG5cclxuLy8gZXh0ZW5kIG9iamVjdHNcclxuZnVuY3Rpb24gZXh0ZW5kKCBhLCBiICkge1xyXG4gIGZvciAoIHZhciBwcm9wIGluIGIgKSB7XHJcbiAgICBhWyBwcm9wIF0gPSBiWyBwcm9wIF07XHJcbiAgfVxyXG4gIHJldHVybiBhO1xyXG59XHJcblxyXG4vLyB0dXJuIGVsZW1lbnQgb3Igbm9kZUxpc3QgaW50byBhbiBhcnJheVxyXG5mdW5jdGlvbiBtYWtlQXJyYXkoIG9iaiApIHtcclxuICB2YXIgYXJ5ID0gW107XHJcbiAgaWYgKCBBcnJheS5pc0FycmF5KCBvYmogKSApIHtcclxuICAgIC8vIHVzZSBvYmplY3QgaWYgYWxyZWFkeSBhbiBhcnJheVxyXG4gICAgYXJ5ID0gb2JqO1xyXG4gIH0gZWxzZSBpZiAoIHR5cGVvZiBvYmoubGVuZ3RoID09ICdudW1iZXInICkge1xyXG4gICAgLy8gY29udmVydCBub2RlTGlzdCB0byBhcnJheVxyXG4gICAgZm9yICggdmFyIGk9MDsgaSA8IG9iai5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgYXJ5LnB1c2goIG9ialtpXSApO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICAvLyBhcnJheSBvZiBzaW5nbGUgaW5kZXhcclxuICAgIGFyeS5wdXNoKCBvYmogKTtcclxuICB9XHJcbiAgcmV0dXJuIGFyeTtcclxufVxyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gbmdpbWFnZXNMb2FkZWQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge0FycmF5LCBFbGVtZW50LCBOb2RlTGlzdCwgU3RyaW5nfSBlbGVtXHJcbiAqIEBwYXJhbSB7T2JqZWN0IG9yIEZ1bmN0aW9ufSBvcHRpb25zIC0gaWYgZnVuY3Rpb24sIHVzZSBhcyBjYWxsYmFja1xyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBvbkFsd2F5cyAtIGNhbGxiYWNrIGZ1bmN0aW9uXHJcbiAqL1xyXG5mdW5jdGlvbiBuZ0ltYWdlc0xvYWRlZCggZWxlbSwgb3B0aW9ucywgb25BbHdheXMgKSB7XHJcbiAgLy8gY29lcmNlIG5nSW1hZ2VzTG9hZGVkKCkgd2l0aG91dCBuZXcsIHRvIGJlIG5ldyBuZ0ltYWdlc0xvYWRlZCgpXHJcbiAgaWYgKCAhKCB0aGlzIGluc3RhbmNlb2YgbmdJbWFnZXNMb2FkZWQgKSApIHtcclxuICAgIHJldHVybiBuZXcgbmdJbWFnZXNMb2FkZWQoIGVsZW0sIG9wdGlvbnMsIG9uQWx3YXlzICk7XHJcbiAgfVxyXG4gIC8vIHVzZSBlbGVtIGFzIHNlbGVjdG9yIHN0cmluZ1xyXG4gIGlmICggdHlwZW9mIGVsZW0gPT0gJ3N0cmluZycgKSB7XHJcbiAgICBlbGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCggZWxlbSApO1xyXG4gIH1cclxuXHJcbiAgdGhpcy5lbGVtZW50cyA9IG1ha2VBcnJheSggZWxlbSApO1xyXG4gIHRoaXMub3B0aW9ucyA9IGV4dGVuZCgge30sIHRoaXMub3B0aW9ucyApO1xyXG5cclxuICBpZiAoIHR5cGVvZiBvcHRpb25zID09ICdmdW5jdGlvbicgKSB7XHJcbiAgICBvbkFsd2F5cyA9IG9wdGlvbnM7XHJcbiAgfSBlbHNlIHtcclxuICAgIGV4dGVuZCggdGhpcy5vcHRpb25zLCBvcHRpb25zICk7XHJcbiAgfVxyXG5cclxuICBpZiAoIG9uQWx3YXlzICkge1xyXG4gICAgdGhpcy5vbiggJ2Fsd2F5cycsIG9uQWx3YXlzICk7XHJcbiAgfVxyXG5cclxuICB0aGlzLmdldEltYWdlcygpO1xyXG5cclxuICBpZiAoICQgKSB7XHJcbiAgICAvLyBhZGQgalF1ZXJ5IERlZmVycmVkIG9iamVjdFxyXG4gICAgdGhpcy5qcURlZmVycmVkID0gbmV3ICQuRGVmZXJyZWQoKTtcclxuICB9XHJcblxyXG4gIC8vIEhBQ0sgY2hlY2sgYXN5bmMgdG8gYWxsb3cgdGltZSB0byBiaW5kIGxpc3RlbmVyc1xyXG4gIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xyXG4gICAgdGhpcy5jaGVjaygpO1xyXG4gIH0uYmluZCggdGhpcyApKTtcclxufVxyXG5cclxubmdJbWFnZXNMb2FkZWQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggbmdFdkVtaXR0ZXIucHJvdG90eXBlICk7XHJcblxyXG5uZ0ltYWdlc0xvYWRlZC5wcm90b3R5cGUub3B0aW9ucyA9IHt9O1xyXG5cclxubmdJbWFnZXNMb2FkZWQucHJvdG90eXBlLmdldEltYWdlcyA9IGZ1bmN0aW9uKCkge1xyXG4gIHRoaXMuaW1hZ2VzID0gW107XHJcblxyXG4gIC8vIGZpbHRlciAmIGZpbmQgaXRlbXMgaWYgd2UgaGF2ZSBhbiBpdGVtIHNlbGVjdG9yXHJcbiAgdGhpcy5lbGVtZW50cy5mb3JFYWNoKCB0aGlzLmFkZEVsZW1lbnRJbWFnZXMsIHRoaXMgKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge05vZGV9IGVsZW1lbnRcclxuICovXHJcbm5nSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5hZGRFbGVtZW50SW1hZ2VzID0gZnVuY3Rpb24oIGVsZW0gKSB7XHJcbiAgLy8gZmlsdGVyIHNpYmxpbmdzXHJcbiAgaWYgKCBlbGVtLm5vZGVOYW1lID09ICdJTUcnICkge1xyXG4gICAgdGhpcy5hZGRJbWFnZSggZWxlbSApO1xyXG4gIH1cclxuICAvLyBnZXQgYmFja2dyb3VuZCBpbWFnZSBvbiBlbGVtZW50XHJcbiAgaWYgKCB0aGlzLm9wdGlvbnMuYmFja2dyb3VuZCA9PT0gdHJ1ZSApIHtcclxuICAgIHRoaXMuYWRkRWxlbWVudEJhY2tncm91bmRJbWFnZXMoIGVsZW0gKTtcclxuICB9XHJcblxyXG4gIC8vIGZpbmQgY2hpbGRyZW5cclxuICAvLyBubyBub24tZWxlbWVudCBub2RlcywgIzE0M1xyXG4gIHZhciBub2RlVHlwZSA9IGVsZW0ubm9kZVR5cGU7XHJcbiAgaWYgKCAhbm9kZVR5cGUgfHwgIWVsZW1lbnROb2RlVHlwZXNbIG5vZGVUeXBlIF0gKSB7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIHZhciBjaGlsZEltZ3MgPSBlbGVtLnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZycpO1xyXG4gIC8vIGNvbmNhdCBjaGlsZEVsZW1zIHRvIGZpbHRlckZvdW5kIGFycmF5XHJcbiAgZm9yICggdmFyIGk9MDsgaSA8IGNoaWxkSW1ncy5sZW5ndGg7IGkrKyApIHtcclxuICAgIHZhciBpbWcgPSBjaGlsZEltZ3NbaV07XHJcbiAgICB0aGlzLmFkZEltYWdlKCBpbWcgKTtcclxuICB9XHJcblxyXG4gIC8vIGdldCBjaGlsZCBiYWNrZ3JvdW5kIGltYWdlc1xyXG4gIGlmICggdHlwZW9mIHRoaXMub3B0aW9ucy5iYWNrZ3JvdW5kID09ICdzdHJpbmcnICkge1xyXG4gICAgdmFyIGNoaWxkcmVuID0gZWxlbS5xdWVyeVNlbGVjdG9yQWxsKCB0aGlzLm9wdGlvbnMuYmFja2dyb3VuZCApO1xyXG4gICAgZm9yICggaT0wOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICB0aGlzLmFkZEVsZW1lbnRCYWNrZ3JvdW5kSW1hZ2VzKCBjaGlsZCApO1xyXG4gICAgfVxyXG4gIH1cclxufTtcclxuXHJcbnZhciBlbGVtZW50Tm9kZVR5cGVzID0ge1xyXG4gIDE6IHRydWUsXHJcbiAgOTogdHJ1ZSxcclxuICAxMTogdHJ1ZVxyXG59O1xyXG5cclxubmdJbWFnZXNMb2FkZWQucHJvdG90eXBlLmFkZEVsZW1lbnRCYWNrZ3JvdW5kSW1hZ2VzID0gZnVuY3Rpb24oIGVsZW0gKSB7XHJcbiAgdmFyIHN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZSggZWxlbSApO1xyXG4gIGlmICggIXN0eWxlICkge1xyXG4gICAgLy8gRmlyZWZveCByZXR1cm5zIG51bGwgaWYgaW4gYSBoaWRkZW4gaWZyYW1lIGh0dHBzOi8vYnVnemlsLmxhLzU0ODM5N1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICAvLyBnZXQgdXJsIGluc2lkZSB1cmwoXCIuLi5cIilcclxuICB2YXIgcmVVUkwgPSAvdXJsXFwoKFsnXCJdKT8oLio/KVxcMVxcKS9naTtcclxuICB2YXIgbWF0Y2hlcyA9IHJlVVJMLmV4ZWMoIHN0eWxlLmJhY2tncm91bmRJbWFnZSApO1xyXG4gIHdoaWxlICggbWF0Y2hlcyAhPT0gbnVsbCApIHtcclxuICAgIHZhciB1cmwgPSBtYXRjaGVzICYmIG1hdGNoZXNbMl07XHJcbiAgICBpZiAoIHVybCApIHtcclxuICAgICAgdGhpcy5hZGRCYWNrZ3JvdW5kKCB1cmwsIGVsZW0gKTtcclxuICAgIH1cclxuICAgIG1hdGNoZXMgPSByZVVSTC5leGVjKCBzdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgKTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtJbWFnZX0gaW1nXHJcbiAqL1xyXG5uZ0ltYWdlc0xvYWRlZC5wcm90b3R5cGUuYWRkSW1hZ2UgPSBmdW5jdGlvbiggaW1nICkge1xyXG4gIHZhciBsb2FkaW5nSW1hZ2UgPSBuZXcgTG9hZGluZ0ltYWdlKCBpbWcgKTtcclxuICB0aGlzLmltYWdlcy5wdXNoKCBsb2FkaW5nSW1hZ2UgKTtcclxufTtcclxuXHJcbm5nSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5hZGRCYWNrZ3JvdW5kID0gZnVuY3Rpb24oIHVybCwgZWxlbSApIHtcclxuICB2YXIgYmFja2dyb3VuZCA9IG5ldyBCYWNrZ3JvdW5kKCB1cmwsIGVsZW0gKTtcclxuICB0aGlzLmltYWdlcy5wdXNoKCBiYWNrZ3JvdW5kICk7XHJcbn07XHJcblxyXG5uZ0ltYWdlc0xvYWRlZC5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbigpIHtcclxuICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gIHRoaXMucHJvZ3Jlc3NlZENvdW50ID0gMDtcclxuICB0aGlzLmhhc0FueUJyb2tlbiA9IGZhbHNlO1xyXG4gIC8vIGNvbXBsZXRlIGlmIG5vIGltYWdlc1xyXG4gIGlmICggIXRoaXMuaW1hZ2VzLmxlbmd0aCApIHtcclxuICAgIHRoaXMuY29tcGxldGUoKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIG9uUHJvZ3Jlc3MoIGltYWdlLCBlbGVtLCBtZXNzYWdlICkge1xyXG4gICAgLy8gSEFDSyAtIENocm9tZSB0cmlnZ2VycyBldmVudCBiZWZvcmUgb2JqZWN0IHByb3BlcnRpZXMgaGF2ZSBjaGFuZ2VkLiAjODNcclxuICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xyXG4gICAgICBfdGhpcy5wcm9ncmVzcyggaW1hZ2UsIGVsZW0sIG1lc3NhZ2UgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgdGhpcy5pbWFnZXMuZm9yRWFjaCggZnVuY3Rpb24oIGxvYWRpbmdJbWFnZSApIHtcclxuICAgIGxvYWRpbmdJbWFnZS5vbmNlKCAncHJvZ3Jlc3MnLCBvblByb2dyZXNzICk7XHJcbiAgICBsb2FkaW5nSW1hZ2UuY2hlY2soKTtcclxuICB9KTtcclxufTtcclxuXHJcbm5nSW1hZ2VzTG9hZGVkLnByb3RvdHlwZS5wcm9ncmVzcyA9IGZ1bmN0aW9uKCBpbWFnZSwgZWxlbSwgbWVzc2FnZSApIHtcclxuICB0aGlzLnByb2dyZXNzZWRDb3VudCsrO1xyXG4gIHRoaXMuaGFzQW55QnJva2VuID0gdGhpcy5oYXNBbnlCcm9rZW4gfHwgIWltYWdlLmlzTG9hZGVkO1xyXG4gIC8vIHByb2dyZXNzIGV2ZW50XHJcbiAgdGhpcy5lbWl0RXZlbnQoICdwcm9ncmVzcycsIFsgdGhpcywgaW1hZ2UsIGVsZW0gXSApO1xyXG4gIGlmICggdGhpcy5qcURlZmVycmVkICYmIHRoaXMuanFEZWZlcnJlZC5ub3RpZnkgKSB7XHJcbiAgICB0aGlzLmpxRGVmZXJyZWQubm90aWZ5KCB0aGlzLCBpbWFnZSApO1xyXG4gIH1cclxuICAvLyBjaGVjayBpZiBjb21wbGV0ZWRcclxuICBpZiAoIHRoaXMucHJvZ3Jlc3NlZENvdW50ID09IHRoaXMuaW1hZ2VzLmxlbmd0aCApIHtcclxuICAgIHRoaXMuY29tcGxldGUoKTtcclxuICB9XHJcblxyXG4gIGlmICggdGhpcy5vcHRpb25zLmRlYnVnICYmIGNvbnNvbGUgKSB7XHJcbiAgICBjb25zb2xlLmxvZyggJ3Byb2dyZXNzOiAnICsgbWVzc2FnZSwgaW1hZ2UsIGVsZW0gKTtcclxuICB9XHJcbn07XHJcblxyXG5uZ0ltYWdlc0xvYWRlZC5wcm90b3R5cGUuY29tcGxldGUgPSBmdW5jdGlvbigpIHtcclxuICB2YXIgZXZlbnROYW1lID0gdGhpcy5oYXNBbnlCcm9rZW4gPyAnZmFpbCcgOiAnZG9uZSc7XHJcbiAgdGhpcy5pc0NvbXBsZXRlID0gdHJ1ZTtcclxuICB0aGlzLmVtaXRFdmVudCggZXZlbnROYW1lLCBbIHRoaXMgXSApO1xyXG4gIHRoaXMuZW1pdEV2ZW50KCAnYWx3YXlzJywgWyB0aGlzIF0gKTtcclxuICBpZiAoIHRoaXMuanFEZWZlcnJlZCApIHtcclxuICAgIHZhciBqcU1ldGhvZCA9IHRoaXMuaGFzQW55QnJva2VuID8gJ3JlamVjdCcgOiAncmVzb2x2ZSc7XHJcbiAgICB0aGlzLmpxRGVmZXJyZWRbIGpxTWV0aG9kIF0oIHRoaXMgKTtcclxuICB9XHJcbn07XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cclxuXHJcbmZ1bmN0aW9uIExvYWRpbmdJbWFnZSggaW1nICkge1xyXG4gIHRoaXMuaW1nID0gaW1nO1xyXG59XHJcblxyXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggbmdFdkVtaXR0ZXIucHJvdG90eXBlICk7XHJcblxyXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLmNoZWNrID0gZnVuY3Rpb24oKSB7XHJcbiAgLy8gSWYgY29tcGxldGUgaXMgdHJ1ZSBhbmQgYnJvd3NlciBzdXBwb3J0cyBuYXR1cmFsIHNpemVzLFxyXG4gIC8vIHRyeSB0byBjaGVjayBmb3IgaW1hZ2Ugc3RhdHVzIG1hbnVhbGx5LlxyXG4gIHZhciBpc0NvbXBsZXRlID0gdGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtcclxuICBpZiAoIGlzQ29tcGxldGUgKSB7XHJcbiAgICAvLyByZXBvcnQgYmFzZWQgb24gbmF0dXJhbFdpZHRoXHJcbiAgICB0aGlzLmNvbmZpcm0oIHRoaXMuaW1nLm5hdHVyYWxXaWR0aCAhPT0gMCwgJ25hdHVyYWxXaWR0aCcgKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIC8vIElmIG5vbmUgb2YgdGhlIGNoZWNrcyBhYm92ZSBtYXRjaGVkLCBzaW11bGF0ZSBsb2FkaW5nIG9uIGRldGFjaGVkIGVsZW1lbnQuXHJcbiAgdGhpcy5wcm94eUltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgdGhpcy5wcm94eUltYWdlLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xyXG4gIHRoaXMucHJveHlJbWFnZS5hZGRFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XHJcbiAgLy8gYmluZCB0byBpbWFnZSBhcyB3ZWxsIGZvciBGaXJlZm94LiAjMTkxXHJcbiAgdGhpcy5pbWcuYWRkRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XHJcbiAgdGhpcy5pbWcuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xyXG4gIHRoaXMucHJveHlJbWFnZS5zcmMgPSB0aGlzLmltZy5zcmM7XHJcbn07XHJcblxyXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLmdldElzSW1hZ2VDb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xyXG4gIHJldHVybiB0aGlzLmltZy5jb21wbGV0ZSAmJiB0aGlzLmltZy5uYXR1cmFsV2lkdGggIT09IHVuZGVmaW5lZDtcclxufTtcclxuXHJcbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKCBpc0xvYWRlZCwgbWVzc2FnZSApIHtcclxuICB0aGlzLmlzTG9hZGVkID0gaXNMb2FkZWQ7XHJcbiAgdGhpcy5lbWl0RXZlbnQoICdwcm9ncmVzcycsIFsgdGhpcywgdGhpcy5pbWcsIG1lc3NhZ2UgXSApO1xyXG59O1xyXG5cclxuLy8gLS0tLS0gZXZlbnRzIC0tLS0tIC8vXHJcblxyXG4vLyB0cmlnZ2VyIHNwZWNpZmllZCBoYW5kbGVyIGZvciBldmVudCB0eXBlXHJcbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUuaGFuZGxlRXZlbnQgPSBmdW5jdGlvbiggZXZlbnQgKSB7XHJcbiAgdmFyIG1ldGhvZCA9ICdvbicgKyBldmVudC50eXBlO1xyXG4gIGlmICggdGhpc1sgbWV0aG9kIF0gKSB7XHJcbiAgICB0aGlzWyBtZXRob2QgXSggZXZlbnQgKTtcclxuICB9XHJcbn07XHJcblxyXG5Mb2FkaW5nSW1hZ2UucHJvdG90eXBlLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xyXG4gIHRoaXMuY29uZmlybSggdHJ1ZSwgJ29ubG9hZCcgKTtcclxuICB0aGlzLnVuYmluZEV2ZW50cygpO1xyXG59O1xyXG5cclxuTG9hZGluZ0ltYWdlLnByb3RvdHlwZS5vbmVycm9yID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy5jb25maXJtKCBmYWxzZSwgJ29uZXJyb3InICk7XHJcbiAgdGhpcy51bmJpbmRFdmVudHMoKTtcclxufTtcclxuXHJcbkxvYWRpbmdJbWFnZS5wcm90b3R5cGUudW5iaW5kRXZlbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy5wcm94eUltYWdlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdsb2FkJywgdGhpcyApO1xyXG4gIHRoaXMucHJveHlJbWFnZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XHJcbiAgdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XHJcbiAgdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xyXG59O1xyXG5cclxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gQmFja2dyb3VuZCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xyXG5cclxuZnVuY3Rpb24gQmFja2dyb3VuZCggdXJsLCBlbGVtZW50ICkge1xyXG4gIHRoaXMudXJsID0gdXJsO1xyXG4gIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgdGhpcy5pbWcgPSBuZXcgSW1hZ2UoKTtcclxufVxyXG5cclxuLy8gaW5oZXJpdCBMb2FkaW5nSW1hZ2UgcHJvdG90eXBlXHJcbkJhY2tncm91bmQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZSggTG9hZGluZ0ltYWdlLnByb3RvdHlwZSApO1xyXG5cclxuQmFja2dyb3VuZC5wcm90b3R5cGUuY2hlY2sgPSBmdW5jdGlvbigpIHtcclxuICB0aGlzLmltZy5hZGRFdmVudExpc3RlbmVyKCAnbG9hZCcsIHRoaXMgKTtcclxuICB0aGlzLmltZy5hZGRFdmVudExpc3RlbmVyKCAnZXJyb3InLCB0aGlzICk7XHJcbiAgdGhpcy5pbWcuc3JjID0gdGhpcy51cmw7XHJcbiAgLy8gY2hlY2sgaWYgaW1hZ2UgaXMgYWxyZWFkeSBjb21wbGV0ZVxyXG4gIHZhciBpc0NvbXBsZXRlID0gdGhpcy5nZXRJc0ltYWdlQ29tcGxldGUoKTtcclxuICBpZiAoIGlzQ29tcGxldGUgKSB7XHJcbiAgICB0aGlzLmNvbmZpcm0oIHRoaXMuaW1nLm5hdHVyYWxXaWR0aCAhPT0gMCwgJ25hdHVyYWxXaWR0aCcgKTtcclxuICAgIHRoaXMudW5iaW5kRXZlbnRzKCk7XHJcbiAgfVxyXG59O1xyXG5cclxuQmFja2dyb3VuZC5wcm90b3R5cGUudW5iaW5kRXZlbnRzID0gZnVuY3Rpb24oKSB7XHJcbiAgdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCB0aGlzICk7XHJcbiAgdGhpcy5pbWcucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgdGhpcyApO1xyXG59O1xyXG5cclxuQmFja2dyb3VuZC5wcm90b3R5cGUuY29uZmlybSA9IGZ1bmN0aW9uKCBpc0xvYWRlZCwgbWVzc2FnZSApIHtcclxuICB0aGlzLmlzTG9hZGVkID0gaXNMb2FkZWQ7XHJcbiAgdGhpcy5lbWl0RXZlbnQoICdwcm9ncmVzcycsIFsgdGhpcywgdGhpcy5lbGVtZW50LCBtZXNzYWdlIF0gKTtcclxufTtcclxuXHJcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIGpRdWVyeSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvL1xyXG5cclxubmdJbWFnZXNMb2FkZWQubWFrZUpRdWVyeVBsdWdpbiA9IGZ1bmN0aW9uKCBqUXVlcnkgKSB7XHJcbiAgalF1ZXJ5ID0galF1ZXJ5IHx8IHdpbmRvdy5qUXVlcnk7XHJcbiAgaWYgKCAhalF1ZXJ5ICkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICAvLyBzZXQgbG9jYWwgdmFyaWFibGVcclxuICAkID0galF1ZXJ5O1xyXG4gIC8vICQoKS5uZ2ltYWdlc0xvYWRlZCgpXHJcbiAgJC5mbi5uZ2ltYWdlc0xvYWRlZCA9IGZ1bmN0aW9uKCBvcHRpb25zLCBjYWxsYmFjayApIHtcclxuICAgIHZhciBpbnN0YW5jZSA9IG5ldyBuZ0ltYWdlc0xvYWRlZCggdGhpcywgb3B0aW9ucywgY2FsbGJhY2sgKTtcclxuICAgIHJldHVybiBpbnN0YW5jZS5qcURlZmVycmVkLnByb21pc2UoICQodGhpcykgKTtcclxuICB9O1xyXG59O1xyXG4vLyB0cnkgbWFraW5nIHBsdWdpblxyXG5uZ0ltYWdlc0xvYWRlZC5tYWtlSlF1ZXJ5UGx1Z2luKCk7XHJcblxyXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gLy9cclxuXHJcbnJldHVybiBuZ0ltYWdlc0xvYWRlZDtcclxuXHJcbn0pO1xyXG5cclxuXHJcblxyXG4vLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbi8vIyMgc2NyZWVuZnVsbC5qcyAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG5cclxuLy8gc2NyZWVuZnVsbC5qc1xyXG4vLyB2NC4wLjFcclxuLy8gYnkgc2luZHJlc29yaHVzIC0gaHR0cHM6Ly9naXRodWIuY29tL3NpbmRyZXNvcmh1c1xyXG4vLyBmcm9tOiBodHRwczovL2dpdGh1Yi5jb20vc2luZHJlc29yaHVzL3NjcmVlbmZ1bGwuanNcclxuXHJcbi8vIGV4dGVybmFsIG1vZHVsZSBlbWJlZGVkIGluIG5hbm9nYWxsZXJ5XHJcbi8vIE5HWSBCVUlMRDpcclxuLy8gcmVwbGFjZSBcInNjcmVlbmZ1bGxcIiB3aXRoIFwibmdzY3JlZW5mdWxsXCJcclxuLy8gXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG5cdCd1c2Ugc3RyaWN0JztcclxuXHJcblx0dmFyIGRvY3VtZW50ID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cuZG9jdW1lbnQgOiB7fTtcclxuXHR2YXIgaXNDb21tb25qcyA9IHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzO1xyXG5cdHZhciBrZXlib2FyZEFsbG93ZWQgPSB0eXBlb2YgRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgJ0FMTE9XX0tFWUJPQVJEX0lOUFVUJyBpbiBFbGVtZW50O1xyXG5cclxuXHR2YXIgZm4gPSAoZnVuY3Rpb24gKCkge1xyXG5cdFx0dmFyIHZhbDtcclxuXHJcblx0XHR2YXIgZm5NYXAgPSBbXHJcblx0XHRcdFtcclxuXHRcdFx0XHQncmVxdWVzdEZ1bGxzY3JlZW4nLFxyXG5cdFx0XHRcdCdleGl0RnVsbHNjcmVlbicsXHJcblx0XHRcdFx0J2Z1bGxzY3JlZW5FbGVtZW50JyxcclxuXHRcdFx0XHQnZnVsbHNjcmVlbkVuYWJsZWQnLFxyXG5cdFx0XHRcdCdmdWxsc2NyZWVuY2hhbmdlJyxcclxuXHRcdFx0XHQnZnVsbHNjcmVlbmVycm9yJ1xyXG5cdFx0XHRdLFxyXG5cdFx0XHQvLyBOZXcgV2ViS2l0XHJcblx0XHRcdFtcclxuXHRcdFx0XHQnd2Via2l0UmVxdWVzdEZ1bGxzY3JlZW4nLFxyXG5cdFx0XHRcdCd3ZWJraXRFeGl0RnVsbHNjcmVlbicsXHJcblx0XHRcdFx0J3dlYmtpdEZ1bGxzY3JlZW5FbGVtZW50JyxcclxuXHRcdFx0XHQnd2Via2l0RnVsbHNjcmVlbkVuYWJsZWQnLFxyXG5cdFx0XHRcdCd3ZWJraXRmdWxsc2NyZWVuY2hhbmdlJyxcclxuXHRcdFx0XHQnd2Via2l0ZnVsbHNjcmVlbmVycm9yJ1xyXG5cclxuXHRcdFx0XSxcclxuXHRcdFx0Ly8gT2xkIFdlYktpdCAoU2FmYXJpIDUuMSlcclxuXHRcdFx0W1xyXG5cdFx0XHRcdCd3ZWJraXRSZXF1ZXN0RnVsbFNjcmVlbicsXHJcblx0XHRcdFx0J3dlYmtpdENhbmNlbEZ1bGxTY3JlZW4nLFxyXG5cdFx0XHRcdCd3ZWJraXRDdXJyZW50RnVsbFNjcmVlbkVsZW1lbnQnLFxyXG5cdFx0XHRcdCd3ZWJraXRDYW5jZWxGdWxsU2NyZWVuJyxcclxuXHRcdFx0XHQnd2Via2l0ZnVsbHNjcmVlbmNoYW5nZScsXHJcblx0XHRcdFx0J3dlYmtpdGZ1bGxzY3JlZW5lcnJvcidcclxuXHJcblx0XHRcdF0sXHJcblx0XHRcdFtcclxuXHRcdFx0XHQnbW96UmVxdWVzdEZ1bGxTY3JlZW4nLFxyXG5cdFx0XHRcdCdtb3pDYW5jZWxGdWxsU2NyZWVuJyxcclxuXHRcdFx0XHQnbW96RnVsbFNjcmVlbkVsZW1lbnQnLFxyXG5cdFx0XHRcdCdtb3pGdWxsU2NyZWVuRW5hYmxlZCcsXHJcblx0XHRcdFx0J21vemZ1bGxzY3JlZW5jaGFuZ2UnLFxyXG5cdFx0XHRcdCdtb3pmdWxsc2NyZWVuZXJyb3InXHJcblx0XHRcdF0sXHJcblx0XHRcdFtcclxuXHRcdFx0XHQnbXNSZXF1ZXN0RnVsbHNjcmVlbicsXHJcblx0XHRcdFx0J21zRXhpdEZ1bGxzY3JlZW4nLFxyXG5cdFx0XHRcdCdtc0Z1bGxzY3JlZW5FbGVtZW50JyxcclxuXHRcdFx0XHQnbXNGdWxsc2NyZWVuRW5hYmxlZCcsXHJcblx0XHRcdFx0J01TRnVsbHNjcmVlbkNoYW5nZScsXHJcblx0XHRcdFx0J01TRnVsbHNjcmVlbkVycm9yJ1xyXG5cdFx0XHRdXHJcblx0XHRdO1xyXG5cclxuXHRcdHZhciBpID0gMDtcclxuXHRcdHZhciBsID0gZm5NYXAubGVuZ3RoO1xyXG5cdFx0dmFyIHJldCA9IHt9O1xyXG5cclxuXHRcdGZvciAoOyBpIDwgbDsgaSsrKSB7XHJcblx0XHRcdHZhbCA9IGZuTWFwW2ldO1xyXG5cdFx0XHRpZiAodmFsICYmIHZhbFsxXSBpbiBkb2N1bWVudCkge1xyXG5cdFx0XHRcdGZvciAoaSA9IDA7IGkgPCB2YWwubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHRcdHJldFtmbk1hcFswXVtpXV0gPSB2YWxbaV07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHJldHVybiByZXQ7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fSkoKTtcclxuXHJcblx0dmFyIGV2ZW50TmFtZU1hcCA9IHtcclxuXHRcdGNoYW5nZTogZm4uZnVsbHNjcmVlbmNoYW5nZSxcclxuXHRcdGVycm9yOiBmbi5mdWxsc2NyZWVuZXJyb3JcclxuXHR9O1xyXG5cclxuXHR2YXIgbmdzY3JlZW5mdWxsID0ge1xyXG5cdFx0cmVxdWVzdDogZnVuY3Rpb24gKGVsZW0pIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XHJcblx0XHRcdFx0dmFyIHJlcXVlc3QgPSBmbi5yZXF1ZXN0RnVsbHNjcmVlbjtcclxuXHJcblx0XHRcdFx0dmFyIG9uRnVsbFNjcmVlbkVudGVyZWQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHR0aGlzLm9mZignY2hhbmdlJywgb25GdWxsU2NyZWVuRW50ZXJlZCk7XHJcblx0XHRcdFx0XHRyZXNvbHZlKCk7XHJcblx0XHRcdFx0fS5iaW5kKHRoaXMpO1xyXG5cclxuXHRcdFx0XHRlbGVtID0gZWxlbSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XHJcblxyXG5cdFx0XHRcdC8vIFdvcmsgYXJvdW5kIFNhZmFyaSA1LjEgYnVnOiByZXBvcnRzIHN1cHBvcnQgZm9yXHJcblx0XHRcdFx0Ly8ga2V5Ym9hcmQgaW4gZnVsbHNjcmVlbiBldmVuIHRob3VnaCBpdCBkb2Vzbid0LlxyXG5cdFx0XHRcdC8vIEJyb3dzZXIgc25pZmZpbmcsIHNpbmNlIHRoZSBhbHRlcm5hdGl2ZSB3aXRoXHJcblx0XHRcdFx0Ly8gc2V0VGltZW91dCBpcyBldmVuIHdvcnNlLlxyXG5cdFx0XHRcdGlmICgvIFZlcnNpb25cXC81XFwuMSg/OlxcLlxcZCspPyBTYWZhcmlcXC8vLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcclxuXHRcdFx0XHRcdGVsZW1bcmVxdWVzdF0oKTtcclxuXHRcdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdFx0ZWxlbVtyZXF1ZXN0XShrZXlib2FyZEFsbG93ZWQgPyBFbGVtZW50LkFMTE9XX0tFWUJPQVJEX0lOUFVUIDoge30pO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dGhpcy5vbignY2hhbmdlJywgb25GdWxsU2NyZWVuRW50ZXJlZCk7XHJcblx0XHRcdH0uYmluZCh0aGlzKSk7XHJcblx0XHR9LFxyXG5cdFx0ZXhpdDogZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcclxuXHRcdFx0XHRpZiAoIXRoaXMuaXNGdWxsc2NyZWVuKSB7XHJcblx0XHRcdFx0XHRyZXNvbHZlKCk7XHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHR2YXIgb25GdWxsU2NyZWVuRXhpdCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdHRoaXMub2ZmKCdjaGFuZ2UnLCBvbkZ1bGxTY3JlZW5FeGl0KTtcclxuXHRcdFx0XHRcdHJlc29sdmUoKTtcclxuXHRcdFx0XHR9LmJpbmQodGhpcyk7XHJcblxyXG5cdFx0XHRcdGRvY3VtZW50W2ZuLmV4aXRGdWxsc2NyZWVuXSgpO1xyXG5cclxuXHRcdFx0XHR0aGlzLm9uKCdjaGFuZ2UnLCBvbkZ1bGxTY3JlZW5FeGl0KTtcclxuXHRcdFx0fS5iaW5kKHRoaXMpKTtcclxuXHRcdH0sXHJcblx0XHR0b2dnbGU6IGZ1bmN0aW9uIChlbGVtKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmlzRnVsbHNjcmVlbiA/IHRoaXMuZXhpdCgpIDogdGhpcy5yZXF1ZXN0KGVsZW0pO1xyXG5cdFx0fSxcclxuXHRcdG9uY2hhbmdlOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcclxuXHRcdFx0dGhpcy5vbignY2hhbmdlJywgY2FsbGJhY2spO1xyXG5cdFx0fSxcclxuXHRcdG9uZXJyb3I6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xyXG5cdFx0XHR0aGlzLm9uKCdlcnJvcicsIGNhbGxiYWNrKTtcclxuXHRcdH0sXHJcblx0XHRvbjogZnVuY3Rpb24gKGV2ZW50LCBjYWxsYmFjaykge1xyXG5cdFx0XHR2YXIgZXZlbnROYW1lID0gZXZlbnROYW1lTWFwW2V2ZW50XTtcclxuXHRcdFx0aWYgKGV2ZW50TmFtZSkge1xyXG5cdFx0XHRcdGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBjYWxsYmFjaywgZmFsc2UpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0b2ZmOiBmdW5jdGlvbiAoZXZlbnQsIGNhbGxiYWNrKSB7XHJcblx0XHRcdHZhciBldmVudE5hbWUgPSBldmVudE5hbWVNYXBbZXZlbnRdO1xyXG5cdFx0XHRpZiAoZXZlbnROYW1lKSB7XHJcblx0XHRcdFx0ZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGNhbGxiYWNrLCBmYWxzZSk7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHRyYXc6IGZuXHJcblx0fTtcclxuXHJcblx0aWYgKCFmbikge1xyXG5cdFx0aWYgKGlzQ29tbW9uanMpIHtcclxuXHRcdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWxzZTtcclxuXHRcdH0gZWxzZSB7XHJcblx0XHRcdHdpbmRvdy5uZ3NjcmVlbmZ1bGwgPSBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cclxuXHRPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuZ3NjcmVlbmZ1bGwsIHtcclxuXHRcdGlzRnVsbHNjcmVlbjoge1xyXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRyZXR1cm4gQm9vbGVhbihkb2N1bWVudFtmbi5mdWxsc2NyZWVuRWxlbWVudF0pO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0ZWxlbWVudDoge1xyXG5cdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxyXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRyZXR1cm4gZG9jdW1lbnRbZm4uZnVsbHNjcmVlbkVsZW1lbnRdO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0ZW5hYmxlZDoge1xyXG5cdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxyXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHQvLyBDb2VyY2UgdG8gYm9vbGVhbiBpbiBjYXNlIG9mIG9sZCBXZWJLaXRcclxuXHRcdFx0XHRyZXR1cm4gQm9vbGVhbihkb2N1bWVudFtmbi5mdWxsc2NyZWVuRW5hYmxlZF0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fSk7XHJcblxyXG5cdGlmIChpc0NvbW1vbmpzKSB7XHJcblx0XHRtb2R1bGUuZXhwb3J0cyA9IG5nc2NyZWVuZnVsbDtcclxuXHR9IGVsc2Uge1xyXG5cdFx0d2luZG93Lm5nc2NyZWVuZnVsbCA9IG5nc2NyZWVuZnVsbDtcclxuXHR9XHJcbn0pKCk7XHJcblxyXG5cclxuICBcclxuLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4vLyMjIFNoaWZ0eSAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuICBcclxuIC8qIVxyXG4gKiBTaGlmdHlcclxuICogQnkgSmVyZW15IEthaG4gLSBqZXJlbXlja2FobkBnbWFpbC5jb21cclxuICovXHJcblxyXG4vLyBleHRlcm5hbCBtb2R1bGUgRU1CRURFRCBpbiBuYW5vZ2FsbGVyeVxyXG4vLyBOR1kgQlVJTEQ6XHJcbi8vIFxyXG4vLyByZXBsYWNlIFwiVHdlZW5hYmxlXCIgd2l0aCBcIk5HVHdlZW5hYmxlXCJcclxuLy8gcmVwbGFjZSBcImRlZmluZS5hbWRcIiB3aXRoIFwiZGVmaW5lLmFtZERJU0FCTEVEXCJcclxuLyogc2hpZnR5IC0gdjEuNS4zIC0gMjAxNi0xMS0yOSAtIGh0dHA6Ly9qZXJlbXlja2Fobi5naXRodWIuaW8vc2hpZnR5ICovXHJcbjsoZnVuY3Rpb24gKCkge1xyXG4gIHZhciByb290ID0gdGhpcyB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xyXG5cclxuLyoqXHJcbiAqIFNoaWZ0eSBDb3JlXHJcbiAqIEJ5IEplcmVteSBLYWhuIC0gamVyZW15Y2thaG5AZ21haWwuY29tXHJcbiAqL1xyXG5cclxudmFyIE5HVHdlZW5hYmxlID0gKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAvLyBBbGlhc2VzIHRoYXQgZ2V0IGRlZmluZWQgbGF0ZXIgaW4gdGhpcyBmdW5jdGlvblxyXG4gIHZhciBmb3JtdWxhO1xyXG5cclxuICAvLyBDT05TVEFOVFNcclxuICB2YXIgREVGQVVMVF9TQ0hFRFVMRV9GVU5DVElPTjtcclxuICB2YXIgREVGQVVMVF9FQVNJTkcgPSAnbGluZWFyJztcclxuICB2YXIgREVGQVVMVF9EVVJBVElPTiA9IDUwMDtcclxuICB2YXIgVVBEQVRFX1RJTUUgPSAxMDAwIC8gNjA7XHJcblxyXG4gIHZhciBfbm93ID0gRGF0ZS5ub3dcclxuICAgICAgID8gRGF0ZS5ub3dcclxuICAgICAgIDogZnVuY3Rpb24gKCkge3JldHVybiArbmV3IERhdGUoKTt9O1xyXG5cclxuICB2YXIgbm93ID0gdHlwZW9mIFNISUZUWV9ERUJVR19OT1cgIT09ICd1bmRlZmluZWQnID8gU0hJRlRZX0RFQlVHX05PVyA6IF9ub3c7XHJcblxyXG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgLy8gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCkgc2hpbSBieSBQYXVsIElyaXNoIChtb2RpZmllZCBmb3IgU2hpZnR5KVxyXG4gICAgLy8gaHR0cDovL3BhdWxpcmlzaC5jb20vMjAxMS9yZXF1ZXN0YW5pbWF0aW9uZnJhbWUtZm9yLXNtYXJ0LWFuaW1hdGluZy9cclxuICAgIERFRkFVTFRfU0NIRURVTEVfRlVOQ1RJT04gPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lXHJcbiAgICAgICB8fCB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lXHJcbiAgICAgICB8fCB3aW5kb3cub1JlcXVlc3RBbmltYXRpb25GcmFtZVxyXG4gICAgICAgfHwgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lXHJcbiAgICAgICB8fCAod2luZG93Lm1vekNhbmNlbFJlcXVlc3RBbmltYXRpb25GcmFtZVxyXG4gICAgICAgJiYgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSlcclxuICAgICAgIHx8IHNldFRpbWVvdXQ7XHJcbiAgfSBlbHNlIHtcclxuICAgIERFRkFVTFRfU0NIRURVTEVfRlVOQ1RJT04gPSBzZXRUaW1lb3V0O1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gbm9vcCAoKSB7XHJcbiAgICAvLyBOT09QIVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZHkgc2hvcnRjdXQgZm9yIGRvaW5nIGEgZm9yLWluIGxvb3AuIFRoaXMgaXMgbm90IGEgXCJub3JtYWxcIiBlYWNoXHJcbiAgICogZnVuY3Rpb24sIGl0IGlzIG9wdGltaXplZCBmb3IgU2hpZnR5LiAgVGhlIGl0ZXJhdG9yIGZ1bmN0aW9uIG9ubHkgcmVjZWl2ZXNcclxuICAgKiB0aGUgcHJvcGVydHkgbmFtZSwgbm90IHRoZSB2YWx1ZS5cclxuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbihzdHJpbmcpfSBmblxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gZWFjaCAob2JqLCBmbikge1xyXG4gICAgdmFyIGtleTtcclxuICAgIGZvciAoa2V5IGluIG9iaikge1xyXG4gICAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7XHJcbiAgICAgICAgZm4oa2V5KTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUGVyZm9ybSBhIHNoYWxsb3cgY29weSBvZiBPYmplY3QgcHJvcGVydGllcy5cclxuICAgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0T2JqZWN0IFRoZSBvYmplY3QgdG8gY29weSBpbnRvXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHNyY09iamVjdCBUaGUgb2JqZWN0IHRvIGNvcHkgZnJvbVxyXG4gICAqIEByZXR1cm4ge09iamVjdH0gQSByZWZlcmVuY2UgdG8gdGhlIGF1Z21lbnRlZCBgdGFyZ2V0T2JqYCBPYmplY3RcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIHNoYWxsb3dDb3B5ICh0YXJnZXRPYmosIHNyY09iaikge1xyXG4gICAgZWFjaChzcmNPYmosIGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgIHRhcmdldE9ialtwcm9wXSA9IHNyY09ialtwcm9wXTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiB0YXJnZXRPYmo7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb3BpZXMgZWFjaCBwcm9wZXJ0eSBmcm9tIHNyYyBvbnRvIHRhcmdldCwgYnV0IG9ubHkgaWYgdGhlIHByb3BlcnR5IHRvXHJcbiAgICogY29weSB0byB0YXJnZXQgaXMgdW5kZWZpbmVkLlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXQgTWlzc2luZyBwcm9wZXJ0aWVzIGluIHRoaXMgT2JqZWN0IGFyZSBmaWxsZWQgaW5cclxuICAgKiBAcGFyYW0ge09iamVjdH0gc3JjXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBkZWZhdWx0cyAodGFyZ2V0LCBzcmMpIHtcclxuICAgIGVhY2goc3JjLCBmdW5jdGlvbiAocHJvcCkge1xyXG4gICAgICBpZiAodHlwZW9mIHRhcmdldFtwcm9wXSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICB0YXJnZXRbcHJvcF0gPSBzcmNbcHJvcF07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsY3VsYXRlcyB0aGUgaW50ZXJwb2xhdGVkIHR3ZWVuIHZhbHVlcyBvZiBhbiBPYmplY3QgZm9yIGEgZ2l2ZW5cclxuICAgKiB0aW1lc3RhbXAuXHJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGZvclBvc2l0aW9uIFRoZSBwb3NpdGlvbiB0byBjb21wdXRlIHRoZSBzdGF0ZSBmb3IuXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGN1cnJlbnRTdGF0ZSBDdXJyZW50IHN0YXRlIHByb3BlcnRpZXMuXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG9yaWdpbmFsU3RhdGU6IFRoZSBvcmlnaW5hbCBzdGF0ZSBwcm9wZXJ0aWVzIHRoZSBPYmplY3QgaXNcclxuICAgKiB0d2VlbmluZyBmcm9tLlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRTdGF0ZTogVGhlIGRlc3RpbmF0aW9uIHN0YXRlIHByb3BlcnRpZXMgdGhlIE9iamVjdFxyXG4gICAqIGlzIHR3ZWVuaW5nIHRvLlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBkdXJhdGlvbjogVGhlIGxlbmd0aCBvZiB0aGUgdHdlZW4gaW4gbWlsbGlzZWNvbmRzLlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lc3RhbXA6IFRoZSBVTklYIGVwb2NoIHRpbWUgYXQgd2hpY2ggdGhlIHR3ZWVuIGJlZ2FuLlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBlYXNpbmc6IFRoaXMgT2JqZWN0J3Mga2V5cyBtdXN0IGNvcnJlc3BvbmQgdG8gdGhlIGtleXMgaW5cclxuICAgKiB0YXJnZXRTdGF0ZS5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIHR3ZWVuUHJvcHMgKGZvclBvc2l0aW9uLCBjdXJyZW50U3RhdGUsIG9yaWdpbmFsU3RhdGUsIHRhcmdldFN0YXRlLFxyXG4gICAgZHVyYXRpb24sIHRpbWVzdGFtcCwgZWFzaW5nKSB7XHJcbiAgICB2YXIgbm9ybWFsaXplZFBvc2l0aW9uID1cclxuICAgICAgICBmb3JQb3NpdGlvbiA8IHRpbWVzdGFtcCA/IDAgOiAoZm9yUG9zaXRpb24gLSB0aW1lc3RhbXApIC8gZHVyYXRpb247XHJcblxyXG5cclxuICAgIHZhciBwcm9wO1xyXG4gICAgdmFyIGVhc2luZ09iamVjdFByb3A7XHJcbiAgICB2YXIgZWFzaW5nRm47XHJcbiAgICBmb3IgKHByb3AgaW4gY3VycmVudFN0YXRlKSB7XHJcbiAgICAgIGlmIChjdXJyZW50U3RhdGUuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcclxuICAgICAgICBlYXNpbmdPYmplY3RQcm9wID0gZWFzaW5nW3Byb3BdO1xyXG4gICAgICAgIGVhc2luZ0ZuID0gdHlwZW9mIGVhc2luZ09iamVjdFByb3AgPT09ICdmdW5jdGlvbidcclxuICAgICAgICAgID8gZWFzaW5nT2JqZWN0UHJvcFxyXG4gICAgICAgICAgOiBmb3JtdWxhW2Vhc2luZ09iamVjdFByb3BdO1xyXG5cclxuICAgICAgICBjdXJyZW50U3RhdGVbcHJvcF0gPSB0d2VlblByb3AoXHJcbiAgICAgICAgICBvcmlnaW5hbFN0YXRlW3Byb3BdLFxyXG4gICAgICAgICAgdGFyZ2V0U3RhdGVbcHJvcF0sXHJcbiAgICAgICAgICBlYXNpbmdGbixcclxuICAgICAgICAgIG5vcm1hbGl6ZWRQb3NpdGlvblxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY3VycmVudFN0YXRlO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHdlZW5zIGEgc2luZ2xlIHByb3BlcnR5LlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydCBUaGUgdmFsdWUgdGhhdCB0aGUgdHdlZW4gc3RhcnRlZCBmcm9tLlxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBlbmQgVGhlIHZhbHVlIHRoYXQgdGhlIHR3ZWVuIHNob3VsZCBlbmQgYXQuXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gZWFzaW5nRnVuYyBUaGUgZWFzaW5nIGN1cnZlIHRvIGFwcGx5IHRvIHRoZSB0d2Vlbi5cclxuICAgKiBAcGFyYW0ge251bWJlcn0gcG9zaXRpb24gVGhlIG5vcm1hbGl6ZWQgcG9zaXRpb24gKGJldHdlZW4gMC4wIGFuZCAxLjApIHRvXHJcbiAgICogY2FsY3VsYXRlIHRoZSBtaWRwb2ludCBvZiAnc3RhcnQnIGFuZCAnZW5kJyBhZ2FpbnN0LlxyXG4gICAqIEByZXR1cm4ge251bWJlcn0gVGhlIHR3ZWVuZWQgdmFsdWUuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiB0d2VlblByb3AgKHN0YXJ0LCBlbmQsIGVhc2luZ0Z1bmMsIHBvc2l0aW9uKSB7XHJcbiAgICByZXR1cm4gc3RhcnQgKyAoZW5kIC0gc3RhcnQpICogZWFzaW5nRnVuYyhwb3NpdGlvbik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBcHBsaWVzIGEgZmlsdGVyIHRvIE5HVHdlZW5hYmxlIGluc3RhbmNlLlxyXG4gICAqIEBwYXJhbSB7TkdUd2VlbmFibGV9IHR3ZWVuYWJsZSBUaGUgYE5HVHdlZW5hYmxlYCBpbnN0YW5jZSB0byBjYWxsIHRoZSBmaWx0ZXJcclxuICAgKiB1cG9uLlxyXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBmaWx0ZXJOYW1lIFRoZSBuYW1lIG9mIHRoZSBmaWx0ZXIgdG8gYXBwbHkuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBhcHBseUZpbHRlciAodHdlZW5hYmxlLCBmaWx0ZXJOYW1lKSB7XHJcbiAgICB2YXIgZmlsdGVycyA9IE5HVHdlZW5hYmxlLnByb3RvdHlwZS5maWx0ZXI7XHJcbiAgICB2YXIgYXJncyA9IHR3ZWVuYWJsZS5fZmlsdGVyQXJncztcclxuXHJcbiAgICBlYWNoKGZpbHRlcnMsIGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgIGlmICh0eXBlb2YgZmlsdGVyc1tuYW1lXVtmaWx0ZXJOYW1lXSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICBmaWx0ZXJzW25hbWVdW2ZpbHRlck5hbWVdLmFwcGx5KHR3ZWVuYWJsZSwgYXJncyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgdmFyIHRpbWVvdXRIYW5kbGVyX2VuZFRpbWU7XHJcbiAgdmFyIHRpbWVvdXRIYW5kbGVyX2N1cnJlbnRUaW1lO1xyXG4gIHZhciB0aW1lb3V0SGFuZGxlcl9pc0VuZGVkO1xyXG4gIHZhciB0aW1lb3V0SGFuZGxlcl9vZmZzZXQ7XHJcbiAgLyoqXHJcbiAgICogSGFuZGxlcyB0aGUgdXBkYXRlIGxvZ2ljIGZvciBvbmUgc3RlcCBvZiBhIHR3ZWVuLlxyXG4gICAqIEBwYXJhbSB7TkdUd2VlbmFibGV9IHR3ZWVuYWJsZVxyXG4gICAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lc3RhbXBcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZGVsYXlcclxuICAgKiBAcGFyYW0ge251bWJlcn0gZHVyYXRpb25cclxuICAgKiBAcGFyYW0ge09iamVjdH0gY3VycmVudFN0YXRlXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IG9yaWdpbmFsU3RhdGVcclxuICAgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0U3RhdGVcclxuICAgKiBAcGFyYW0ge09iamVjdH0gZWFzaW5nXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbihPYmplY3QsICosIG51bWJlcil9IHN0ZXBcclxuICAgKiBAcGFyYW0ge0Z1bmN0aW9uKEZ1bmN0aW9uLG51bWJlcil9fSBzY2hlZHVsZVxyXG4gICAqIEBwYXJhbSB7bnVtYmVyPX0gb3B0X2N1cnJlbnRUaW1lT3ZlcnJpZGUgTmVlZGVkIGZvciBhY2N1cmF0ZSB0aW1lc3RhbXAgaW5cclxuICAgKiBOR1R3ZWVuYWJsZSNzZWVrLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gdGltZW91dEhhbmRsZXIgKHR3ZWVuYWJsZSwgdGltZXN0YW1wLCBkZWxheSwgZHVyYXRpb24sIGN1cnJlbnRTdGF0ZSxcclxuICAgIG9yaWdpbmFsU3RhdGUsIHRhcmdldFN0YXRlLCBlYXNpbmcsIHN0ZXAsIHNjaGVkdWxlLFxyXG4gICAgb3B0X2N1cnJlbnRUaW1lT3ZlcnJpZGUpIHtcclxuXHJcbiAgICB0aW1lb3V0SGFuZGxlcl9lbmRUaW1lID0gdGltZXN0YW1wICsgZGVsYXkgKyBkdXJhdGlvbjtcclxuXHJcbiAgICB0aW1lb3V0SGFuZGxlcl9jdXJyZW50VGltZSA9XHJcbiAgICBNYXRoLm1pbihvcHRfY3VycmVudFRpbWVPdmVycmlkZSB8fCBub3coKSwgdGltZW91dEhhbmRsZXJfZW5kVGltZSk7XHJcblxyXG4gICAgdGltZW91dEhhbmRsZXJfaXNFbmRlZCA9XHJcbiAgICAgIHRpbWVvdXRIYW5kbGVyX2N1cnJlbnRUaW1lID49IHRpbWVvdXRIYW5kbGVyX2VuZFRpbWU7XHJcblxyXG4gICAgdGltZW91dEhhbmRsZXJfb2Zmc2V0ID0gZHVyYXRpb24gLSAoXHJcbiAgICAgIHRpbWVvdXRIYW5kbGVyX2VuZFRpbWUgLSB0aW1lb3V0SGFuZGxlcl9jdXJyZW50VGltZSk7XHJcblxyXG4gICAgaWYgKHR3ZWVuYWJsZS5pc1BsYXlpbmcoKSkge1xyXG4gICAgICBpZiAodGltZW91dEhhbmRsZXJfaXNFbmRlZCkge1xyXG4gICAgICAgIHN0ZXAodGFyZ2V0U3RhdGUsIHR3ZWVuYWJsZS5fYXR0YWNobWVudCwgdGltZW91dEhhbmRsZXJfb2Zmc2V0KTtcclxuICAgICAgICB0d2VlbmFibGUuc3RvcCh0cnVlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0d2VlbmFibGUuX3NjaGVkdWxlSWQgPVxyXG4gICAgICAgICAgc2NoZWR1bGUodHdlZW5hYmxlLl90aW1lb3V0SGFuZGxlciwgVVBEQVRFX1RJTUUpO1xyXG5cclxuICAgICAgICBhcHBseUZpbHRlcih0d2VlbmFibGUsICdiZWZvcmVUd2VlbicpO1xyXG5cclxuICAgICAgICAvLyBJZiB0aGUgYW5pbWF0aW9uIGhhcyBub3QgeWV0IHJlYWNoZWQgdGhlIHN0YXJ0IHBvaW50IChlLmcuLCB0aGVyZSB3YXNcclxuICAgICAgICAvLyBkZWxheSB0aGF0IGhhcyBub3QgeWV0IGNvbXBsZXRlZCksIGp1c3QgaW50ZXJwb2xhdGUgdGhlIHN0YXJ0aW5nXHJcbiAgICAgICAgLy8gcG9zaXRpb24gb2YgdGhlIHR3ZWVuLlxyXG4gICAgICAgIGlmICh0aW1lb3V0SGFuZGxlcl9jdXJyZW50VGltZSA8ICh0aW1lc3RhbXAgKyBkZWxheSkpIHtcclxuICAgICAgICAgIHR3ZWVuUHJvcHMoMSwgY3VycmVudFN0YXRlLCBvcmlnaW5hbFN0YXRlLCB0YXJnZXRTdGF0ZSwgMSwgMSwgZWFzaW5nKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgdHdlZW5Qcm9wcyh0aW1lb3V0SGFuZGxlcl9jdXJyZW50VGltZSwgY3VycmVudFN0YXRlLCBvcmlnaW5hbFN0YXRlLFxyXG4gICAgICAgICAgICB0YXJnZXRTdGF0ZSwgZHVyYXRpb24sIHRpbWVzdGFtcCArIGRlbGF5LCBlYXNpbmcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXBwbHlGaWx0ZXIodHdlZW5hYmxlLCAnYWZ0ZXJUd2VlbicpO1xyXG5cclxuICAgICAgICBzdGVwKGN1cnJlbnRTdGF0ZSwgdHdlZW5hYmxlLl9hdHRhY2htZW50LCB0aW1lb3V0SGFuZGxlcl9vZmZzZXQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogQ3JlYXRlcyBhIHVzYWJsZSBlYXNpbmcgT2JqZWN0IGZyb20gYSBzdHJpbmcsIGEgZnVuY3Rpb24gb3IgYW5vdGhlciBlYXNpbmdcclxuICAgKiBPYmplY3QuICBJZiBgZWFzaW5nYCBpcyBhbiBPYmplY3QsIHRoZW4gdGhpcyBmdW5jdGlvbiBjbG9uZXMgaXQgYW5kIGZpbGxzXHJcbiAgICogaW4gdGhlIG1pc3NpbmcgcHJvcGVydGllcyB3aXRoIGBcImxpbmVhclwiYC5cclxuICAgKiBAcGFyYW0ge09iamVjdC48c3RyaW5nfEZ1bmN0aW9uPn0gZnJvbVR3ZWVuUGFyYW1zXHJcbiAgICogQHBhcmFtIHtPYmplY3R8c3RyaW5nfEZ1bmN0aW9ufSBlYXNpbmdcclxuICAgKiBAcmV0dXJuIHtPYmplY3QuPHN0cmluZ3xGdW5jdGlvbj59XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBjb21wb3NlRWFzaW5nT2JqZWN0IChmcm9tVHdlZW5QYXJhbXMsIGVhc2luZykge1xyXG4gICAgdmFyIGNvbXBvc2VkRWFzaW5nID0ge307XHJcbiAgICB2YXIgdHlwZW9mRWFzaW5nID0gdHlwZW9mIGVhc2luZztcclxuXHJcbiAgICBpZiAodHlwZW9mRWFzaW5nID09PSAnc3RyaW5nJyB8fCB0eXBlb2ZFYXNpbmcgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgZWFjaChmcm9tVHdlZW5QYXJhbXMsIGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgICAgY29tcG9zZWRFYXNpbmdbcHJvcF0gPSBlYXNpbmc7XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZWFjaChmcm9tVHdlZW5QYXJhbXMsIGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgICAgaWYgKCFjb21wb3NlZEVhc2luZ1twcm9wXSkge1xyXG4gICAgICAgICAgY29tcG9zZWRFYXNpbmdbcHJvcF0gPSBlYXNpbmdbcHJvcF0gfHwgREVGQVVMVF9FQVNJTkc7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gY29tcG9zZWRFYXNpbmc7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBOR1R3ZWVuYWJsZSBjb25zdHJ1Y3Rvci5cclxuICAgKiBAY2xhc3MgTkdUd2VlbmFibGVcclxuICAgKiBAcGFyYW0ge09iamVjdD19IG9wdF9pbml0aWFsU3RhdGUgVGhlIHZhbHVlcyB0aGF0IHRoZSBpbml0aWFsIHR3ZWVuIHNob3VsZFxyXG4gICAqIHN0YXJ0IGF0IGlmIGEgYGZyb21gIG9iamVjdCBpcyBub3QgcHJvdmlkZWQgdG8gYHt7I2Nyb3NzTGlua1xyXG4gICAqIFwiTkdUd2VlbmFibGUvdHdlZW46bWV0aG9kXCJ9fXt7L2Nyb3NzTGlua319YCBvciBge3sjY3Jvc3NMaW5rXHJcbiAgICogXCJOR1R3ZWVuYWJsZS9zZXRDb25maWc6bWV0aG9kXCJ9fXt7L2Nyb3NzTGlua319YC5cclxuICAgKiBAcGFyYW0ge09iamVjdD19IG9wdF9jb25maWcgQ29uZmlndXJhdGlvbiBvYmplY3QgdG8gYmUgcGFzc2VkIHRvXHJcbiAgICogYHt7I2Nyb3NzTGluayBcIk5HVHdlZW5hYmxlL3NldENvbmZpZzptZXRob2RcIn19e3svY3Jvc3NMaW5rfX1gLlxyXG4gICAqIEBtb2R1bGUgTkdUd2VlbmFibGVcclxuICAgKiBAY29uc3RydWN0b3JcclxuICAgKi9cclxuICBmdW5jdGlvbiBOR1R3ZWVuYWJsZSAob3B0X2luaXRpYWxTdGF0ZSwgb3B0X2NvbmZpZykge1xyXG4gICAgdGhpcy5fY3VycmVudFN0YXRlID0gb3B0X2luaXRpYWxTdGF0ZSB8fCB7fTtcclxuICAgIHRoaXMuX2NvbmZpZ3VyZWQgPSBmYWxzZTtcclxuICAgIHRoaXMuX3NjaGVkdWxlRnVuY3Rpb24gPSBERUZBVUxUX1NDSEVEVUxFX0ZVTkNUSU9OO1xyXG5cclxuICAgIC8vIFRvIHByZXZlbnQgdW5uZWNlc3NhcnkgY2FsbHMgdG8gc2V0Q29uZmlnIGRvIG5vdCBzZXQgZGVmYXVsdFxyXG4gICAgLy8gY29uZmlndXJhdGlvbiBoZXJlLiAgT25seSBzZXQgZGVmYXVsdCBjb25maWd1cmF0aW9uIGltbWVkaWF0ZWx5IGJlZm9yZVxyXG4gICAgLy8gdHdlZW5pbmcgaWYgbm9uZSBoYXMgYmVlbiBzZXQuXHJcbiAgICBpZiAodHlwZW9mIG9wdF9jb25maWcgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgIHRoaXMuc2V0Q29uZmlnKG9wdF9jb25maWcpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29uZmlndXJlIGFuZCBzdGFydCBhIHR3ZWVuLlxyXG4gICAqIEBtZXRob2QgdHdlZW5cclxuICAgKiBAcGFyYW0ge09iamVjdD19IG9wdF9jb25maWcgQ29uZmlndXJhdGlvbiBvYmplY3QgdG8gYmUgcGFzc2VkIHRvXHJcbiAgICogYHt7I2Nyb3NzTGluayBcIk5HVHdlZW5hYmxlL3NldENvbmZpZzptZXRob2RcIn19e3svY3Jvc3NMaW5rfX1gLlxyXG4gICAqIEBjaGFpbmFibGVcclxuICAgKi9cclxuICBOR1R3ZWVuYWJsZS5wcm90b3R5cGUudHdlZW4gPSBmdW5jdGlvbiAob3B0X2NvbmZpZykge1xyXG4gICAgaWYgKHRoaXMuX2lzVHdlZW5pbmcpIHtcclxuICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gT25seSBzZXQgZGVmYXVsdCBjb25maWcgaWYgbm8gY29uZmlndXJhdGlvbiBoYXMgYmVlbiBzZXQgcHJldmlvdXNseSBhbmRcclxuICAgIC8vIG5vbmUgaXMgcHJvdmlkZWQgbm93LlxyXG4gICAgaWYgKG9wdF9jb25maWcgIT09IHVuZGVmaW5lZCB8fCAhdGhpcy5fY29uZmlndXJlZCkge1xyXG4gICAgICB0aGlzLnNldENvbmZpZyhvcHRfY29uZmlnKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl90aW1lc3RhbXAgPSBub3coKTtcclxuICAgIHRoaXMuX3N0YXJ0KHRoaXMuZ2V0KCksIHRoaXMuX2F0dGFjaG1lbnQpO1xyXG4gICAgcmV0dXJuIHRoaXMucmVzdW1lKCk7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogQ29uZmlndXJlIGEgdHdlZW4gdGhhdCB3aWxsIHN0YXJ0IGF0IHNvbWUgcG9pbnQgaW4gdGhlIGZ1dHVyZS5cclxuICAgKlxyXG4gICAqIEBtZXRob2Qgc2V0Q29uZmlnXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBUaGUgZm9sbG93aW5nIHZhbHVlcyBhcmUgdmFsaWQ6XHJcbiAgICogLSBfX2Zyb21fXyAoX09iamVjdD1fKTogU3RhcnRpbmcgcG9zaXRpb24uICBJZiBvbWl0dGVkLCBge3sjY3Jvc3NMaW5rXHJcbiAgICogICBcIk5HVHdlZW5hYmxlL2dldDptZXRob2RcIn19Z2V0KCl7ey9jcm9zc0xpbmt9fWAgaXMgdXNlZC5cclxuICAgKiAtIF9fdG9fXyAoX09iamVjdD1fKTogRW5kaW5nIHBvc2l0aW9uLlxyXG4gICAqIC0gX19kdXJhdGlvbl9fIChfbnVtYmVyPV8pOiBIb3cgbWFueSBtaWxsaXNlY29uZHMgdG8gYW5pbWF0ZSBmb3IuXHJcbiAgICogLSBfX2RlbGF5X18gKF9kZWxheT1fKTogSG93IG1hbnkgbWlsbGlzZWNvbmRzIHRvIHdhaXQgYmVmb3JlIHN0YXJ0aW5nIHRoZVxyXG4gICAqICAgdHdlZW4uXHJcbiAgICogLSBfX3N0YXJ0X18gKF9GdW5jdGlvbihPYmplY3QsICopXyk6IEZ1bmN0aW9uIHRvIGV4ZWN1dGUgd2hlbiB0aGUgdHdlZW5cclxuICAgKiAgIGJlZ2lucy4gIFJlY2VpdmVzIHRoZSBzdGF0ZSBvZiB0aGUgdHdlZW4gYXMgdGhlIGZpcnN0IHBhcmFtZXRlciBhbmRcclxuICAgKiAgIGBhdHRhY2htZW50YCBhcyB0aGUgc2Vjb25kIHBhcmFtZXRlci5cclxuICAgKiAtIF9fc3RlcF9fIChfRnVuY3Rpb24oT2JqZWN0LCAqLCBudW1iZXIpXyk6IEZ1bmN0aW9uIHRvIGV4ZWN1dGUgb24gZXZlcnlcclxuICAgKiAgIHRpY2suICBSZWNlaXZlcyBge3sjY3Jvc3NMaW5rXHJcbiAgICogICBcIk5HVHdlZW5hYmxlL2dldDptZXRob2RcIn19Z2V0KCl7ey9jcm9zc0xpbmt9fWAgYXMgdGhlIGZpcnN0IHBhcmFtZXRlcixcclxuICAgKiAgIGBhdHRhY2htZW50YCBhcyB0aGUgc2Vjb25kIHBhcmFtZXRlciwgYW5kIHRoZSB0aW1lIGVsYXBzZWQgc2luY2UgdGhlXHJcbiAgICogICBzdGFydCBvZiB0aGUgdHdlZW4gYXMgdGhlIHRoaXJkLiBUaGlzIGZ1bmN0aW9uIGlzIG5vdCBjYWxsZWQgb24gdGhlXHJcbiAgICogICBmaW5hbCBzdGVwIG9mIHRoZSBhbmltYXRpb24sIGJ1dCBgZmluaXNoYCBpcy5cclxuICAgKiAtIF9fZmluaXNoX18gKF9GdW5jdGlvbihPYmplY3QsICopXyk6IEZ1bmN0aW9uIHRvIGV4ZWN1dGUgdXBvbiB0d2VlblxyXG4gICAqICAgY29tcGxldGlvbi4gIFJlY2VpdmVzIHRoZSBzdGF0ZSBvZiB0aGUgdHdlZW4gYXMgdGhlIGZpcnN0IHBhcmFtZXRlciBhbmRcclxuICAgKiAgIGBhdHRhY2htZW50YCBhcyB0aGUgc2Vjb25kIHBhcmFtZXRlci5cclxuICAgKiAtIF9fZWFzaW5nX18gKF9PYmplY3QuPHN0cmluZ3xGdW5jdGlvbj58c3RyaW5nfEZ1bmN0aW9uPV8pOiBFYXNpbmcgY3VydmVcclxuICAgKiAgIG5hbWUocykgb3IgZnVuY3Rpb24ocykgdG8gdXNlIGZvciB0aGUgdHdlZW4uXHJcbiAgICogLSBfX2F0dGFjaG1lbnRfXyAoXypfKTogQ2FjaGVkIHZhbHVlIHRoYXQgaXMgcGFzc2VkIHRvIHRoZVxyXG4gICAqICAgYHN0ZXBgL2BzdGFydGAvYGZpbmlzaGAgbWV0aG9kcy5cclxuICAgKiBAY2hhaW5hYmxlXHJcbiAgICovXHJcbiAgTkdUd2VlbmFibGUucHJvdG90eXBlLnNldENvbmZpZyA9IGZ1bmN0aW9uIChjb25maWcpIHtcclxuICAgIGNvbmZpZyA9IGNvbmZpZyB8fCB7fTtcclxuICAgIHRoaXMuX2NvbmZpZ3VyZWQgPSB0cnVlO1xyXG5cclxuICAgIC8vIEF0dGFjaCBzb21ldGhpbmcgdG8gdGhpcyBOR1R3ZWVuYWJsZSBpbnN0YW5jZSAoZS5nLjogYSBET00gZWxlbWVudCwgYW5cclxuICAgIC8vIG9iamVjdCwgYSBzdHJpbmcsIGV0Yy4pO1xyXG4gICAgdGhpcy5fYXR0YWNobWVudCA9IGNvbmZpZy5hdHRhY2htZW50O1xyXG5cclxuICAgIC8vIEluaXQgdGhlIGludGVybmFsIHN0YXRlXHJcbiAgICB0aGlzLl9wYXVzZWRBdFRpbWUgPSBudWxsO1xyXG4gICAgdGhpcy5fc2NoZWR1bGVJZCA9IG51bGw7XHJcbiAgICB0aGlzLl9kZWxheSA9IGNvbmZpZy5kZWxheSB8fCAwO1xyXG4gICAgdGhpcy5fc3RhcnQgPSBjb25maWcuc3RhcnQgfHwgbm9vcDtcclxuICAgIHRoaXMuX3N0ZXAgPSBjb25maWcuc3RlcCB8fCBub29wO1xyXG4gICAgdGhpcy5fZmluaXNoID0gY29uZmlnLmZpbmlzaCB8fCBub29wO1xyXG4gICAgdGhpcy5fZHVyYXRpb24gPSBjb25maWcuZHVyYXRpb24gfHwgREVGQVVMVF9EVVJBVElPTjtcclxuICAgIHRoaXMuX2N1cnJlbnRTdGF0ZSA9IHNoYWxsb3dDb3B5KHt9LCBjb25maWcuZnJvbSB8fCB0aGlzLmdldCgpKTtcclxuICAgIHRoaXMuX29yaWdpbmFsU3RhdGUgPSB0aGlzLmdldCgpO1xyXG4gICAgdGhpcy5fdGFyZ2V0U3RhdGUgPSBzaGFsbG93Q29weSh7fSwgY29uZmlnLnRvIHx8IHRoaXMuZ2V0KCkpO1xyXG5cclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHRoaXMuX3RpbWVvdXRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICB0aW1lb3V0SGFuZGxlcihzZWxmLFxyXG4gICAgICAgIHNlbGYuX3RpbWVzdGFtcCxcclxuICAgICAgICBzZWxmLl9kZWxheSxcclxuICAgICAgICBzZWxmLl9kdXJhdGlvbixcclxuICAgICAgICBzZWxmLl9jdXJyZW50U3RhdGUsXHJcbiAgICAgICAgc2VsZi5fb3JpZ2luYWxTdGF0ZSxcclxuICAgICAgICBzZWxmLl90YXJnZXRTdGF0ZSxcclxuICAgICAgICBzZWxmLl9lYXNpbmcsXHJcbiAgICAgICAgc2VsZi5fc3RlcCxcclxuICAgICAgICBzZWxmLl9zY2hlZHVsZUZ1bmN0aW9uXHJcbiAgICAgICk7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEFsaWFzZXMgdXNlZCBiZWxvd1xyXG4gICAgdmFyIGN1cnJlbnRTdGF0ZSA9IHRoaXMuX2N1cnJlbnRTdGF0ZTtcclxuICAgIHZhciB0YXJnZXRTdGF0ZSA9IHRoaXMuX3RhcmdldFN0YXRlO1xyXG5cclxuICAgIC8vIEVuc3VyZSB0aGF0IHRoZXJlIGlzIGFsd2F5cyBzb21ldGhpbmcgdG8gdHdlZW4gdG8uXHJcbiAgICBkZWZhdWx0cyh0YXJnZXRTdGF0ZSwgY3VycmVudFN0YXRlKTtcclxuXHJcbiAgICB0aGlzLl9lYXNpbmcgPSBjb21wb3NlRWFzaW5nT2JqZWN0KFxyXG4gICAgICBjdXJyZW50U3RhdGUsIGNvbmZpZy5lYXNpbmcgfHwgREVGQVVMVF9FQVNJTkcpO1xyXG5cclxuICAgIHRoaXMuX2ZpbHRlckFyZ3MgPVxyXG4gICAgICBbY3VycmVudFN0YXRlLCB0aGlzLl9vcmlnaW5hbFN0YXRlLCB0YXJnZXRTdGF0ZSwgdGhpcy5fZWFzaW5nXTtcclxuXHJcbiAgICBhcHBseUZpbHRlcih0aGlzLCAndHdlZW5DcmVhdGVkJyk7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBAbWV0aG9kIGdldFxyXG4gICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGN1cnJlbnQgc3RhdGUuXHJcbiAgICovXHJcbiAgTkdUd2VlbmFibGUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBzaGFsbG93Q29weSh7fSwgdGhpcy5fY3VycmVudFN0YXRlKTtcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBAbWV0aG9kIHNldFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzdGF0ZSBUaGUgY3VycmVudCBzdGF0ZS5cclxuICAgKi9cclxuICBOR1R3ZWVuYWJsZS5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKHN0YXRlKSB7XHJcbiAgICB0aGlzLl9jdXJyZW50U3RhdGUgPSBzdGF0ZTtcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBQYXVzZSBhIHR3ZWVuLiAgUGF1c2VkIHR3ZWVucyBjYW4gYmUgcmVzdW1lZCBmcm9tIHRoZSBwb2ludCBhdCB3aGljaCB0aGV5XHJcbiAgICogd2VyZSBwYXVzZWQuICBUaGlzIGlzIGRpZmZlcmVudCBmcm9tIGB7eyNjcm9zc0xpbmtcclxuICAgKiBcIk5HVHdlZW5hYmxlL3N0b3A6bWV0aG9kXCJ9fXt7L2Nyb3NzTGlua319YCwgYXMgdGhhdCBtZXRob2RcclxuICAgKiBjYXVzZXMgYSB0d2VlbiB0byBzdGFydCBvdmVyIHdoZW4gaXQgaXMgcmVzdW1lZC5cclxuICAgKiBAbWV0aG9kIHBhdXNlXHJcbiAgICogQGNoYWluYWJsZVxyXG4gICAqL1xyXG4gIE5HVHdlZW5hYmxlLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMuX3BhdXNlZEF0VGltZSA9IG5vdygpO1xyXG4gICAgdGhpcy5faXNQYXVzZWQgPSB0cnVlO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdW1lIGEgcGF1c2VkIHR3ZWVuLlxyXG4gICAqIEBtZXRob2QgcmVzdW1lXHJcbiAgICogQGNoYWluYWJsZVxyXG4gICAqL1xyXG4gIE5HVHdlZW5hYmxlLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICBpZiAodGhpcy5faXNQYXVzZWQpIHtcclxuICAgICAgdGhpcy5fdGltZXN0YW1wICs9IG5vdygpIC0gdGhpcy5fcGF1c2VkQXRUaW1lO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2lzUGF1c2VkID0gZmFsc2U7XHJcbiAgICB0aGlzLl9pc1R3ZWVuaW5nID0gdHJ1ZTtcclxuXHJcbiAgICB0aGlzLl90aW1lb3V0SGFuZGxlcigpO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIE1vdmUgdGhlIHN0YXRlIG9mIHRoZSBhbmltYXRpb24gdG8gYSBzcGVjaWZpYyBwb2ludCBpbiB0aGUgdHdlZW4nc1xyXG4gICAqIHRpbWVsaW5lLiAgSWYgdGhlIGFuaW1hdGlvbiBpcyBub3QgcnVubmluZywgdGhpcyB3aWxsIGNhdXNlIHRoZSBgc3RlcGBcclxuICAgKiBoYW5kbGVycyB0byBiZSBjYWxsZWQuXHJcbiAgICogQG1ldGhvZCBzZWVrXHJcbiAgICogQHBhcmFtIHttaWxsaXNlY29uZH0gbWlsbGlzZWNvbmQgVGhlIG1pbGxpc2Vjb25kIG9mIHRoZSBhbmltYXRpb24gdG8gc2Vla1xyXG4gICAqIHRvLiAgVGhpcyBtdXN0IG5vdCBiZSBsZXNzIHRoYW4gYDBgLlxyXG4gICAqIEBjaGFpbmFibGVcclxuICAgKi9cclxuICBOR1R3ZWVuYWJsZS5wcm90b3R5cGUuc2VlayA9IGZ1bmN0aW9uIChtaWxsaXNlY29uZCkge1xyXG4gICAgbWlsbGlzZWNvbmQgPSBNYXRoLm1heChtaWxsaXNlY29uZCwgMCk7XHJcbiAgICB2YXIgY3VycmVudFRpbWUgPSBub3coKTtcclxuXHJcbiAgICBpZiAoKHRoaXMuX3RpbWVzdGFtcCArIG1pbGxpc2Vjb25kKSA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl90aW1lc3RhbXAgPSBjdXJyZW50VGltZSAtIG1pbGxpc2Vjb25kO1xyXG5cclxuICAgIGlmICghdGhpcy5pc1BsYXlpbmcoKSkge1xyXG4gICAgICB0aGlzLl9pc1R3ZWVuaW5nID0gdHJ1ZTtcclxuICAgICAgdGhpcy5faXNQYXVzZWQgPSBmYWxzZTtcclxuXHJcbiAgICAgIC8vIElmIHRoZSBhbmltYXRpb24gaXMgbm90IHJ1bm5pbmcsIGNhbGwgdGltZW91dEhhbmRsZXIgdG8gbWFrZSBzdXJlIHRoYXRcclxuICAgICAgLy8gYW55IHN0ZXAgaGFuZGxlcnMgYXJlIHJ1bi5cclxuICAgICAgdGltZW91dEhhbmRsZXIodGhpcyxcclxuICAgICAgICB0aGlzLl90aW1lc3RhbXAsXHJcbiAgICAgICAgdGhpcy5fZGVsYXksXHJcbiAgICAgICAgdGhpcy5fZHVyYXRpb24sXHJcbiAgICAgICAgdGhpcy5fY3VycmVudFN0YXRlLFxyXG4gICAgICAgIHRoaXMuX29yaWdpbmFsU3RhdGUsXHJcbiAgICAgICAgdGhpcy5fdGFyZ2V0U3RhdGUsXHJcbiAgICAgICAgdGhpcy5fZWFzaW5nLFxyXG4gICAgICAgIHRoaXMuX3N0ZXAsXHJcbiAgICAgICAgdGhpcy5fc2NoZWR1bGVGdW5jdGlvbixcclxuICAgICAgICBjdXJyZW50VGltZVxyXG4gICAgICApO1xyXG5cclxuICAgICAgdGhpcy5wYXVzZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIFN0b3BzIGFuZCBjYW5jZWxzIGEgdHdlZW4uXHJcbiAgICogQHBhcmFtIHtib29sZWFuPX0gZ290b0VuZCBJZiBgZmFsc2VgIG9yIG9taXR0ZWQsIHRoZSB0d2VlbiBqdXN0IHN0b3BzIGF0XHJcbiAgICogaXRzIGN1cnJlbnQgc3RhdGUsIGFuZCB0aGUgYGZpbmlzaGAgaGFuZGxlciBpcyBub3QgaW52b2tlZC4gIElmIGB0cnVlYCxcclxuICAgKiB0aGUgdHdlZW5lZCBvYmplY3QncyB2YWx1ZXMgYXJlIGluc3RhbnRseSBzZXQgdG8gdGhlIHRhcmdldCB2YWx1ZXMsIGFuZFxyXG4gICAqIGBmaW5pc2hgIGlzIGludm9rZWQuXHJcbiAgICogQG1ldGhvZCBzdG9wXHJcbiAgICogQGNoYWluYWJsZVxyXG4gICAqL1xyXG4gIE5HVHdlZW5hYmxlLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKGdvdG9FbmQpIHtcclxuICAgIHRoaXMuX2lzVHdlZW5pbmcgPSBmYWxzZTtcclxuICAgIHRoaXMuX2lzUGF1c2VkID0gZmFsc2U7XHJcbiAgICB0aGlzLl90aW1lb3V0SGFuZGxlciA9IG5vb3A7XHJcblxyXG4gICAgKHJvb3QuY2FuY2VsQW5pbWF0aW9uRnJhbWUgICAgICAgICAgICB8fFxyXG4gICAgcm9vdC53ZWJraXRDYW5jZWxBbmltYXRpb25GcmFtZSAgICAgfHxcclxuICAgIHJvb3Qub0NhbmNlbEFuaW1hdGlvbkZyYW1lICAgICAgICAgIHx8XHJcbiAgICByb290Lm1zQ2FuY2VsQW5pbWF0aW9uRnJhbWUgICAgICAgICB8fFxyXG4gICAgcm9vdC5tb3pDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcclxuICAgIHJvb3QuY2xlYXJUaW1lb3V0KSh0aGlzLl9zY2hlZHVsZUlkKTtcclxuXHJcbiAgICBpZiAoZ290b0VuZCkge1xyXG4gICAgICBhcHBseUZpbHRlcih0aGlzLCAnYmVmb3JlVHdlZW4nKTtcclxuICAgICAgdHdlZW5Qcm9wcyhcclxuICAgICAgICAxLFxyXG4gICAgICAgIHRoaXMuX2N1cnJlbnRTdGF0ZSxcclxuICAgICAgICB0aGlzLl9vcmlnaW5hbFN0YXRlLFxyXG4gICAgICAgIHRoaXMuX3RhcmdldFN0YXRlLFxyXG4gICAgICAgIDEsXHJcbiAgICAgICAgMCxcclxuICAgICAgICB0aGlzLl9lYXNpbmdcclxuICAgICAgKTtcclxuICAgICAgYXBwbHlGaWx0ZXIodGhpcywgJ2FmdGVyVHdlZW4nKTtcclxuICAgICAgYXBwbHlGaWx0ZXIodGhpcywgJ2FmdGVyVHdlZW5FbmQnKTtcclxuICAgICAgdGhpcy5fZmluaXNoLmNhbGwodGhpcywgdGhpcy5fY3VycmVudFN0YXRlLCB0aGlzLl9hdHRhY2htZW50KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBAbWV0aG9kIGlzUGxheWluZ1xyXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFdoZXRoZXIgb3Igbm90IGEgdHdlZW4gaXMgcnVubmluZy5cclxuICAgKi9cclxuICBOR1R3ZWVuYWJsZS5wcm90b3R5cGUuaXNQbGF5aW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2lzVHdlZW5pbmcgJiYgIXRoaXMuX2lzUGF1c2VkO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldCBhIGN1c3RvbSBzY2hlZHVsZSBmdW5jdGlvbi5cclxuICAgKlxyXG4gICAqIElmIGEgY3VzdG9tIGZ1bmN0aW9uIGlzIG5vdCBzZXQsXHJcbiAgICogW2ByZXF1ZXN0QW5pbWF0aW9uRnJhbWVgXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSlcclxuICAgKiBpcyB1c2VkIGlmIGF2YWlsYWJsZSwgb3RoZXJ3aXNlXHJcbiAgICogW2BzZXRUaW1lb3V0YF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1dpbmRvdy5zZXRUaW1lb3V0KVxyXG4gICAqIGlzIHVzZWQuXHJcbiAgICogQG1ldGhvZCBzZXRTY2hlZHVsZUZ1bmN0aW9uXHJcbiAgICogQHBhcmFtIHtGdW5jdGlvbihGdW5jdGlvbixudW1iZXIpfSBzY2hlZHVsZUZ1bmN0aW9uIFRoZSBmdW5jdGlvbiB0byBiZVxyXG4gICAqIHVzZWQgdG8gc2NoZWR1bGUgdGhlIG5leHQgZnJhbWUgdG8gYmUgcmVuZGVyZWQuXHJcbiAgICovXHJcbiAgTkdUd2VlbmFibGUucHJvdG90eXBlLnNldFNjaGVkdWxlRnVuY3Rpb24gPSBmdW5jdGlvbiAoc2NoZWR1bGVGdW5jdGlvbikge1xyXG4gICAgdGhpcy5fc2NoZWR1bGVGdW5jdGlvbiA9IHNjaGVkdWxlRnVuY3Rpb247XHJcbiAgfTtcclxuXHJcbiAgLyoqXHJcbiAgICogYGRlbGV0ZWAgYWxsIFwib3duXCIgcHJvcGVydGllcy4gIENhbGwgdGhpcyB3aGVuIHRoZSBgTkdUd2VlbmFibGVgIGluc3RhbmNlXHJcbiAgICogaXMgbm8gbG9uZ2VyIG5lZWRlZCB0byBmcmVlIG1lbW9yeS5cclxuICAgKiBAbWV0aG9kIGRpc3Bvc2VcclxuICAgKi9cclxuICBOR1R3ZWVuYWJsZS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBwcm9wO1xyXG4gICAgZm9yIChwcm9wIGluIHRoaXMpIHtcclxuICAgICAgaWYgKHRoaXMuaGFzT3duUHJvcGVydHkocHJvcCkpIHtcclxuICAgICAgICBkZWxldGUgdGhpc1twcm9wXTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIEZpbHRlcnMgYXJlIHVzZWQgZm9yIHRyYW5zZm9ybWluZyB0aGUgcHJvcGVydGllcyBvZiBhIHR3ZWVuIGF0IHZhcmlvdXNcclxuICAgKiBwb2ludHMgaW4gYSBOR1R3ZWVuYWJsZSdzIGxpZmUgY3ljbGUuICBTZWUgdGhlIFJFQURNRSBmb3IgbW9yZSBpbmZvIG9uIHRoaXMuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBOR1R3ZWVuYWJsZS5wcm90b3R5cGUuZmlsdGVyID0ge307XHJcblxyXG4gIC8qKlxyXG4gICAqIFRoaXMgb2JqZWN0IGNvbnRhaW5zIGFsbCBvZiB0aGUgdHdlZW5zIGF2YWlsYWJsZSB0byBTaGlmdHkuICBJdCBpc1xyXG4gICAqIGV4dGVuc2libGUgLSBzaW1wbHkgYXR0YWNoIHByb3BlcnRpZXMgdG8gdGhlIGBOR1R3ZWVuYWJsZS5wcm90b3R5cGUuZm9ybXVsYWBcclxuICAgKiBPYmplY3QgZm9sbG93aW5nIHRoZSBzYW1lIGZvcm1hdCBhcyBgbGluZWFyYC5cclxuICAgKlxyXG4gICAqIGBwb3NgIHNob3VsZCBiZSBhIG5vcm1hbGl6ZWQgYG51bWJlcmAgKGJldHdlZW4gMCBhbmQgMSkuXHJcbiAgICogQHByb3BlcnR5IGZvcm11bGFcclxuICAgKiBAdHlwZSB7T2JqZWN0KGZ1bmN0aW9uKX1cclxuICAgKi9cclxuICBOR1R3ZWVuYWJsZS5wcm90b3R5cGUuZm9ybXVsYSA9IHtcclxuICAgIGxpbmVhcjogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gcG9zO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGZvcm11bGEgPSBOR1R3ZWVuYWJsZS5wcm90b3R5cGUuZm9ybXVsYTtcclxuXHJcbiAgc2hhbGxvd0NvcHkoTkdUd2VlbmFibGUsIHtcclxuICAgICdub3cnOiBub3dcclxuICAgICwnZWFjaCc6IGVhY2hcclxuICAgICwndHdlZW5Qcm9wcyc6IHR3ZWVuUHJvcHNcclxuICAgICwndHdlZW5Qcm9wJzogdHdlZW5Qcm9wXHJcbiAgICAsJ2FwcGx5RmlsdGVyJzogYXBwbHlGaWx0ZXJcclxuICAgICwnc2hhbGxvd0NvcHknOiBzaGFsbG93Q29weVxyXG4gICAgLCdkZWZhdWx0cyc6IGRlZmF1bHRzXHJcbiAgICAsJ2NvbXBvc2VFYXNpbmdPYmplY3QnOiBjb21wb3NlRWFzaW5nT2JqZWN0XHJcbiAgfSk7XHJcblxyXG4gIC8vIGByb290YCBpcyBwcm92aWRlZCBpbiB0aGUgaW50cm8vb3V0cm8gZmlsZXMuXHJcblxyXG4gIC8vIEEgaG9vayB1c2VkIGZvciB1bml0IHRlc3RpbmcuXHJcbiAgaWYgKHR5cGVvZiBTSElGVFlfREVCVUdfTk9XID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICByb290LnRpbWVvdXRIYW5kbGVyID0gdGltZW91dEhhbmRsZXI7XHJcbiAgfVxyXG5cclxuICAvLyBCb290c3RyYXAgTkdUd2VlbmFibGUgYXBwcm9wcmlhdGVseSBmb3IgdGhlIGVudmlyb25tZW50LlxyXG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcclxuICAgIC8vIENvbW1vbkpTXHJcbiAgICBtb2R1bGUuZXhwb3J0cyA9IE5HVHdlZW5hYmxlO1xyXG4gIH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kRElTQUJMRUQpIHtcclxuICAgIC8vIEFNRFxyXG4gICAgZGVmaW5lKGZ1bmN0aW9uICgpIHtyZXR1cm4gTkdUd2VlbmFibGU7fSk7XHJcbiAgfSBlbHNlIGlmICh0eXBlb2Ygcm9vdC5OR1R3ZWVuYWJsZSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgIC8vIEJyb3dzZXI6IE1ha2UgYE5HVHdlZW5hYmxlYCBnbG9iYWxseSBhY2Nlc3NpYmxlLlxyXG4gICAgcm9vdC5OR1R3ZWVuYWJsZSA9IE5HVHdlZW5hYmxlO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIE5HVHdlZW5hYmxlO1xyXG5cclxufSAoKSk7XHJcblxyXG4vKiFcclxuICogQWxsIGVxdWF0aW9ucyBhcmUgYWRhcHRlZCBmcm9tIFRob21hcyBGdWNocydcclxuICogW1NjcmlwdHkyXShodHRwczovL2dpdGh1Yi5jb20vbWFkcm9iYnkvc2NyaXB0eTIvYmxvYi9tYXN0ZXIvc3JjL2VmZmVjdHMvdHJhbnNpdGlvbnMvcGVubmVyLmpzKS5cclxuICpcclxuICogQmFzZWQgb24gRWFzaW5nIEVxdWF0aW9ucyAoYykgMjAwMyBbUm9iZXJ0XHJcbiAqIFBlbm5lcl0oaHR0cDovL3d3dy5yb2JlcnRwZW5uZXIuY29tLyksIGFsbCByaWdodHMgcmVzZXJ2ZWQuIFRoaXMgd29yayBpc1xyXG4gKiBbc3ViamVjdCB0byB0ZXJtc10oaHR0cDovL3d3dy5yb2JlcnRwZW5uZXIuY29tL2Vhc2luZ190ZXJtc19vZl91c2UuaHRtbCkuXHJcbiAqL1xyXG5cclxuLyohXHJcbiAqICBURVJNUyBPRiBVU0UgLSBFQVNJTkcgRVFVQVRJT05TXHJcbiAqICBPcGVuIHNvdXJjZSB1bmRlciB0aGUgQlNEIExpY2Vuc2UuXHJcbiAqICBFYXNpbmcgRXF1YXRpb25zIChjKSAyMDAzIFJvYmVydCBQZW5uZXIsIGFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbiAqL1xyXG5cclxuOyhmdW5jdGlvbiAoKSB7XHJcblxyXG4gIE5HVHdlZW5hYmxlLnNoYWxsb3dDb3B5KE5HVHdlZW5hYmxlLnByb3RvdHlwZS5mb3JtdWxhLCB7XHJcbiAgICBlYXNlSW5RdWFkOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHJldHVybiBNYXRoLnBvdyhwb3MsIDIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlT3V0UXVhZDogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gLShNYXRoLnBvdygocG9zIC0gMSksIDIpIC0gMSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGVhc2VJbk91dFF1YWQ6IGZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgaWYgKChwb3MgLz0gMC41KSA8IDEpIHtyZXR1cm4gMC41ICogTWF0aC5wb3cocG9zLDIpO31cclxuICAgICAgcmV0dXJuIC0wLjUgKiAoKHBvcyAtPSAyKSAqIHBvcyAtIDIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlSW5DdWJpYzogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gTWF0aC5wb3cocG9zLCAzKTtcclxuICAgIH0sXHJcblxyXG4gICAgZWFzZU91dEN1YmljOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHJldHVybiAoTWF0aC5wb3coKHBvcyAtIDEpLCAzKSArIDEpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlSW5PdXRDdWJpYzogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICBpZiAoKHBvcyAvPSAwLjUpIDwgMSkge3JldHVybiAwLjUgKiBNYXRoLnBvdyhwb3MsMyk7fVxyXG4gICAgICByZXR1cm4gMC41ICogKE1hdGgucG93KChwb3MgLSAyKSwzKSArIDIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlSW5RdWFydDogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gTWF0aC5wb3cocG9zLCA0KTtcclxuICAgIH0sXHJcblxyXG4gICAgZWFzZU91dFF1YXJ0OiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHJldHVybiAtKE1hdGgucG93KChwb3MgLSAxKSwgNCkgLSAxKTtcclxuICAgIH0sXHJcblxyXG4gICAgZWFzZUluT3V0UXVhcnQ6IGZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgaWYgKChwb3MgLz0gMC41KSA8IDEpIHtyZXR1cm4gMC41ICogTWF0aC5wb3cocG9zLDQpO31cclxuICAgICAgcmV0dXJuIC0wLjUgKiAoKHBvcyAtPSAyKSAqIE1hdGgucG93KHBvcywzKSAtIDIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlSW5RdWludDogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gTWF0aC5wb3cocG9zLCA1KTtcclxuICAgIH0sXHJcblxyXG4gICAgZWFzZU91dFF1aW50OiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHJldHVybiAoTWF0aC5wb3coKHBvcyAtIDEpLCA1KSArIDEpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlSW5PdXRRdWludDogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICBpZiAoKHBvcyAvPSAwLjUpIDwgMSkge3JldHVybiAwLjUgKiBNYXRoLnBvdyhwb3MsNSk7fVxyXG4gICAgICByZXR1cm4gMC41ICogKE1hdGgucG93KChwb3MgLSAyKSw1KSArIDIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlSW5TaW5lOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHJldHVybiAtTWF0aC5jb3MocG9zICogKE1hdGguUEkgLyAyKSkgKyAxO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlT3V0U2luZTogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gTWF0aC5zaW4ocG9zICogKE1hdGguUEkgLyAyKSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGVhc2VJbk91dFNpbmU6IGZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgcmV0dXJuICgtMC41ICogKE1hdGguY29zKE1hdGguUEkgKiBwb3MpIC0gMSkpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlSW5FeHBvOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHJldHVybiAocG9zID09PSAwKSA/IDAgOiBNYXRoLnBvdygyLCAxMCAqIChwb3MgLSAxKSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGVhc2VPdXRFeHBvOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHJldHVybiAocG9zID09PSAxKSA/IDEgOiAtTWF0aC5wb3coMiwgLTEwICogcG9zKSArIDE7XHJcbiAgICB9LFxyXG5cclxuICAgIGVhc2VJbk91dEV4cG86IGZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgaWYgKHBvcyA9PT0gMCkge3JldHVybiAwO31cclxuICAgICAgaWYgKHBvcyA9PT0gMSkge3JldHVybiAxO31cclxuICAgICAgaWYgKChwb3MgLz0gMC41KSA8IDEpIHtyZXR1cm4gMC41ICogTWF0aC5wb3coMiwxMCAqIChwb3MgLSAxKSk7fVxyXG4gICAgICByZXR1cm4gMC41ICogKC1NYXRoLnBvdygyLCAtMTAgKiAtLXBvcykgKyAyKTtcclxuICAgIH0sXHJcblxyXG4gICAgZWFzZUluQ2lyYzogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gLShNYXRoLnNxcnQoMSAtIChwb3MgKiBwb3MpKSAtIDEpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlT3V0Q2lyYzogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gTWF0aC5zcXJ0KDEgLSBNYXRoLnBvdygocG9zIC0gMSksIDIpKTtcclxuICAgIH0sXHJcblxyXG4gICAgZWFzZUluT3V0Q2lyYzogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICBpZiAoKHBvcyAvPSAwLjUpIDwgMSkge3JldHVybiAtMC41ICogKE1hdGguc3FydCgxIC0gcG9zICogcG9zKSAtIDEpO31cclxuICAgICAgcmV0dXJuIDAuNSAqIChNYXRoLnNxcnQoMSAtIChwb3MgLT0gMikgKiBwb3MpICsgMSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGVhc2VPdXRCb3VuY2U6IGZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgaWYgKChwb3MpIDwgKDEgLyAyLjc1KSkge1xyXG4gICAgICAgIHJldHVybiAoNy41NjI1ICogcG9zICogcG9zKTtcclxuICAgICAgfSBlbHNlIGlmIChwb3MgPCAoMiAvIDIuNzUpKSB7XHJcbiAgICAgICAgcmV0dXJuICg3LjU2MjUgKiAocG9zIC09ICgxLjUgLyAyLjc1KSkgKiBwb3MgKyAwLjc1KTtcclxuICAgICAgfSBlbHNlIGlmIChwb3MgPCAoMi41IC8gMi43NSkpIHtcclxuICAgICAgICByZXR1cm4gKDcuNTYyNSAqIChwb3MgLT0gKDIuMjUgLyAyLjc1KSkgKiBwb3MgKyAwLjkzNzUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAoNy41NjI1ICogKHBvcyAtPSAoMi42MjUgLyAyLjc1KSkgKiBwb3MgKyAwLjk4NDM3NSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgZWFzZUluQmFjazogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICB2YXIgcyA9IDEuNzAxNTg7XHJcbiAgICAgIHJldHVybiAocG9zKSAqIHBvcyAqICgocyArIDEpICogcG9zIC0gcyk7XHJcbiAgICB9LFxyXG5cclxuICAgIGVhc2VPdXRCYWNrOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHZhciBzID0gMS43MDE1ODtcclxuICAgICAgcmV0dXJuIChwb3MgPSBwb3MgLSAxKSAqIHBvcyAqICgocyArIDEpICogcG9zICsgcykgKyAxO1xyXG4gICAgfSxcclxuXHJcbiAgICBlYXNlSW5PdXRCYWNrOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHZhciBzID0gMS43MDE1ODtcclxuICAgICAgaWYgKChwb3MgLz0gMC41KSA8IDEpIHtcclxuICAgICAgICByZXR1cm4gMC41ICogKHBvcyAqIHBvcyAqICgoKHMgKj0gKDEuNTI1KSkgKyAxKSAqIHBvcyAtIHMpKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gMC41ICogKChwb3MgLT0gMikgKiBwb3MgKiAoKChzICo9ICgxLjUyNSkpICsgMSkgKiBwb3MgKyBzKSArIDIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlbGFzdGljOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIC8vIGpzaGludCBtYXhsZW46OTBcclxuICAgICAgcmV0dXJuIC0xICogTWF0aC5wb3coNCwtOCAqIHBvcykgKiBNYXRoLnNpbigocG9zICogNiAtIDEpICogKDIgKiBNYXRoLlBJKSAvIDIpICsgMTtcclxuICAgIH0sXHJcblxyXG4gICAgc3dpbmdGcm9tVG86IGZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgdmFyIHMgPSAxLjcwMTU4O1xyXG4gICAgICByZXR1cm4gKChwb3MgLz0gMC41KSA8IDEpID9cclxuICAgICAgICAgIDAuNSAqIChwb3MgKiBwb3MgKiAoKChzICo9ICgxLjUyNSkpICsgMSkgKiBwb3MgLSBzKSkgOlxyXG4gICAgICAgICAgMC41ICogKChwb3MgLT0gMikgKiBwb3MgKiAoKChzICo9ICgxLjUyNSkpICsgMSkgKiBwb3MgKyBzKSArIDIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBzd2luZ0Zyb206IGZ1bmN0aW9uIChwb3MpIHtcclxuICAgICAgdmFyIHMgPSAxLjcwMTU4O1xyXG4gICAgICByZXR1cm4gcG9zICogcG9zICogKChzICsgMSkgKiBwb3MgLSBzKTtcclxuICAgIH0sXHJcblxyXG4gICAgc3dpbmdUbzogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICB2YXIgcyA9IDEuNzAxNTg7XHJcbiAgICAgIHJldHVybiAocG9zIC09IDEpICogcG9zICogKChzICsgMSkgKiBwb3MgKyBzKSArIDE7XHJcbiAgICB9LFxyXG5cclxuICAgIGJvdW5jZTogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICBpZiAocG9zIDwgKDEgLyAyLjc1KSkge1xyXG4gICAgICAgIHJldHVybiAoNy41NjI1ICogcG9zICogcG9zKTtcclxuICAgICAgfSBlbHNlIGlmIChwb3MgPCAoMiAvIDIuNzUpKSB7XHJcbiAgICAgICAgcmV0dXJuICg3LjU2MjUgKiAocG9zIC09ICgxLjUgLyAyLjc1KSkgKiBwb3MgKyAwLjc1KTtcclxuICAgICAgfSBlbHNlIGlmIChwb3MgPCAoMi41IC8gMi43NSkpIHtcclxuICAgICAgICByZXR1cm4gKDcuNTYyNSAqIChwb3MgLT0gKDIuMjUgLyAyLjc1KSkgKiBwb3MgKyAwLjkzNzUpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiAoNy41NjI1ICogKHBvcyAtPSAoMi42MjUgLyAyLjc1KSkgKiBwb3MgKyAwLjk4NDM3NSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgYm91bmNlUGFzdDogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICBpZiAocG9zIDwgKDEgLyAyLjc1KSkge1xyXG4gICAgICAgIHJldHVybiAoNy41NjI1ICogcG9zICogcG9zKTtcclxuICAgICAgfSBlbHNlIGlmIChwb3MgPCAoMiAvIDIuNzUpKSB7XHJcbiAgICAgICAgcmV0dXJuIDIgLSAoNy41NjI1ICogKHBvcyAtPSAoMS41IC8gMi43NSkpICogcG9zICsgMC43NSk7XHJcbiAgICAgIH0gZWxzZSBpZiAocG9zIDwgKDIuNSAvIDIuNzUpKSB7XHJcbiAgICAgICAgcmV0dXJuIDIgLSAoNy41NjI1ICogKHBvcyAtPSAoMi4yNSAvIDIuNzUpKSAqIHBvcyArIDAuOTM3NSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDIgLSAoNy41NjI1ICogKHBvcyAtPSAoMi42MjUgLyAyLjc1KSkgKiBwb3MgKyAwLjk4NDM3NSk7XHJcbiAgICAgIH1cclxuICAgIH0sXHJcblxyXG4gICAgZWFzZUZyb21UbzogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICBpZiAoKHBvcyAvPSAwLjUpIDwgMSkge3JldHVybiAwLjUgKiBNYXRoLnBvdyhwb3MsNCk7fVxyXG4gICAgICByZXR1cm4gLTAuNSAqICgocG9zIC09IDIpICogTWF0aC5wb3cocG9zLDMpIC0gMik7XHJcbiAgICB9LFxyXG5cclxuICAgIGVhc2VGcm9tOiBmdW5jdGlvbiAocG9zKSB7XHJcbiAgICAgIHJldHVybiBNYXRoLnBvdyhwb3MsNCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGVhc2VUbzogZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gTWF0aC5wb3cocG9zLDAuMjUpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxufSgpKTtcclxuXHJcbi8vIGpzaGludCBtYXhsZW46MTAwXHJcbi8qKlxyXG4gKiBUaGUgQmV6aWVyIG1hZ2ljIGluIHRoaXMgZmlsZSBpcyBhZGFwdGVkL2NvcGllZCBhbG1vc3Qgd2hvbGVzYWxlIGZyb21cclxuICogW1NjcmlwdHkyXShodHRwczovL2dpdGh1Yi5jb20vbWFkcm9iYnkvc2NyaXB0eTIvYmxvYi9tYXN0ZXIvc3JjL2VmZmVjdHMvdHJhbnNpdGlvbnMvY3ViaWMtYmV6aWVyLmpzKSxcclxuICogd2hpY2ggd2FzIGFkYXB0ZWQgZnJvbSBBcHBsZSBjb2RlICh3aGljaCBwcm9iYWJseSBjYW1lIGZyb21cclxuICogW2hlcmVdKGh0dHA6Ly9vcGVuc291cmNlLmFwcGxlLmNvbS9zb3VyY2UvV2ViQ29yZS9XZWJDb3JlLTk1NS42Ni9wbGF0Zm9ybS9ncmFwaGljcy9Vbml0QmV6aWVyLmgpKS5cclxuICogU3BlY2lhbCB0aGFua3MgdG8gQXBwbGUgYW5kIFRob21hcyBGdWNocyBmb3IgbXVjaCBvZiB0aGlzIGNvZGUuXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqICBDb3B5cmlnaHQgKGMpIDIwMDYgQXBwbGUgQ29tcHV0ZXIsIEluYy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxyXG4gKiAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XHJcbiAqXHJcbiAqICAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsXHJcbiAqICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLlxyXG4gKlxyXG4gKiAgMi4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLFxyXG4gKiAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvblxyXG4gKiAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXHJcbiAqXHJcbiAqICAzLiBOZWl0aGVyIHRoZSBuYW1lIG9mIHRoZSBjb3B5cmlnaHQgaG9sZGVyKHMpIG5vciB0aGUgbmFtZXMgb2YgYW55XHJcbiAqICBjb250cmlidXRvcnMgbWF5IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzIGRlcml2ZWQgZnJvbVxyXG4gKiAgdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cclxuICpcclxuICogIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiXHJcbiAqICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFXHJcbiAqICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRVxyXG4gKiAgQVJFIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgT1dORVIgT1IgQ09OVFJJQlVUT1JTIEJFXHJcbiAqICBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SXHJcbiAqICBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRlxyXG4gKiAgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTXHJcbiAqICBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTlxyXG4gKiAgQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSlcclxuICogIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFXHJcbiAqICBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS5cclxuICovXHJcbjsoZnVuY3Rpb24gKCkge1xyXG4gIC8vIHBvcnQgb2Ygd2Via2l0IGN1YmljIGJlemllciBoYW5kbGluZyBieSBodHRwOi8vd3d3Lm5ldHpnZXN0YS5kZS9kZXYvXHJcbiAgZnVuY3Rpb24gY3ViaWNCZXppZXJBdFRpbWUodCxwMXgscDF5LHAyeCxwMnksZHVyYXRpb24pIHtcclxuICAgIHZhciBheCA9IDAsYnggPSAwLGN4ID0gMCxheSA9IDAsYnkgPSAwLGN5ID0gMDtcclxuICAgIGZ1bmN0aW9uIHNhbXBsZUN1cnZlWCh0KSB7XHJcbiAgICAgIHJldHVybiAoKGF4ICogdCArIGJ4KSAqIHQgKyBjeCkgKiB0O1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gc2FtcGxlQ3VydmVZKHQpIHtcclxuICAgICAgcmV0dXJuICgoYXkgKiB0ICsgYnkpICogdCArIGN5KSAqIHQ7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBzYW1wbGVDdXJ2ZURlcml2YXRpdmVYKHQpIHtcclxuICAgICAgcmV0dXJuICgzLjAgKiBheCAqIHQgKyAyLjAgKiBieCkgKiB0ICsgY3g7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBzb2x2ZUVwc2lsb24oZHVyYXRpb24pIHtcclxuICAgICAgcmV0dXJuIDEuMCAvICgyMDAuMCAqIGR1cmF0aW9uKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHNvbHZlKHgsZXBzaWxvbikge1xyXG4gICAgICByZXR1cm4gc2FtcGxlQ3VydmVZKHNvbHZlQ3VydmVYKHgsIGVwc2lsb24pKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGZhYnMobikge1xyXG4gICAgICBpZiAobiA+PSAwKSB7XHJcbiAgICAgICAgcmV0dXJuIG47XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDAgLSBuO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBzb2x2ZUN1cnZlWCh4LCBlcHNpbG9uKSB7XHJcbiAgICAgIHZhciB0MCx0MSx0Mix4MixkMixpO1xyXG4gICAgICBmb3IgKHQyID0geCwgaSA9IDA7IGkgPCA4OyBpKyspIHtcclxuICAgICAgICB4MiA9IHNhbXBsZUN1cnZlWCh0MikgLSB4O1xyXG4gICAgICAgIGlmIChmYWJzKHgyKSA8IGVwc2lsb24pIHtcclxuICAgICAgICAgIHJldHVybiB0MjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZDIgPSBzYW1wbGVDdXJ2ZURlcml2YXRpdmVYKHQyKTtcclxuICAgICAgICBpZiAoZmFicyhkMikgPCAxZS02KSB7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgdDIgPSB0MiAtIHgyIC8gZDI7XHJcbiAgICAgIH1cclxuICAgICAgdDAgPSAwLjA7XHJcbiAgICAgIHQxID0gMS4wO1xyXG4gICAgICB0MiA9IHg7XHJcbiAgICAgIGlmICh0MiA8IHQwKSB7XHJcbiAgICAgICAgcmV0dXJuIHQwO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh0MiA+IHQxKSB7XHJcbiAgICAgICAgcmV0dXJuIHQxO1xyXG4gICAgICB9XHJcbiAgICAgIHdoaWxlICh0MCA8IHQxKSB7XHJcbiAgICAgICAgeDIgPSBzYW1wbGVDdXJ2ZVgodDIpO1xyXG4gICAgICAgIGlmIChmYWJzKHgyIC0geCkgPCBlcHNpbG9uKSB7XHJcbiAgICAgICAgICByZXR1cm4gdDI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh4ID4geDIpIHtcclxuICAgICAgICAgIHQwID0gdDI7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgdDEgPSB0MjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdDIgPSAodDEgLSB0MCkgKiAwLjUgKyB0MDtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdDI7IC8vIEZhaWx1cmUuXHJcbiAgICB9XHJcbiAgICBjeCA9IDMuMCAqIHAxeDtcclxuICAgIGJ4ID0gMy4wICogKHAyeCAtIHAxeCkgLSBjeDtcclxuICAgIGF4ID0gMS4wIC0gY3ggLSBieDtcclxuICAgIGN5ID0gMy4wICogcDF5O1xyXG4gICAgYnkgPSAzLjAgKiAocDJ5IC0gcDF5KSAtIGN5O1xyXG4gICAgYXkgPSAxLjAgLSBjeSAtIGJ5O1xyXG4gICAgcmV0dXJuIHNvbHZlKHQsIHNvbHZlRXBzaWxvbihkdXJhdGlvbikpO1xyXG4gIH1cclxuICAvKipcclxuICAgKiAgZ2V0Q3ViaWNCZXppZXJUcmFuc2l0aW9uKHgxLCB5MSwgeDIsIHkyKSAtPiBGdW5jdGlvblxyXG4gICAqXHJcbiAgICogIEdlbmVyYXRlcyBhIHRyYW5zaXRpb24gZWFzaW5nIGZ1bmN0aW9uIHRoYXQgaXMgY29tcGF0aWJsZVxyXG4gICAqICB3aXRoIFdlYktpdCdzIENTUyB0cmFuc2l0aW9ucyBgLXdlYmtpdC10cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvbmBcclxuICAgKiAgQ1NTIHByb3BlcnR5LlxyXG4gICAqXHJcbiAgICogIFRoZSBXM0MgaGFzIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgQ1NTMyB0cmFuc2l0aW9uIHRpbWluZyBmdW5jdGlvbnM6XHJcbiAgICogIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtdHJhbnNpdGlvbnMvI3RyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uX3RhZ1xyXG4gICAqXHJcbiAgICogIEBwYXJhbSB7bnVtYmVyfSB4MVxyXG4gICAqICBAcGFyYW0ge251bWJlcn0geTFcclxuICAgKiAgQHBhcmFtIHtudW1iZXJ9IHgyXHJcbiAgICogIEBwYXJhbSB7bnVtYmVyfSB5MlxyXG4gICAqICBAcmV0dXJuIHtmdW5jdGlvbn1cclxuICAgKiAgQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBnZXRDdWJpY0JlemllclRyYW5zaXRpb24gKHgxLCB5MSwgeDIsIHkyKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHBvcykge1xyXG4gICAgICByZXR1cm4gY3ViaWNCZXppZXJBdFRpbWUocG9zLHgxLHkxLHgyLHkyLDEpO1xyXG4gICAgfTtcclxuICB9XHJcbiAgLy8gRW5kIHBvcnRlZCBjb2RlXHJcblxyXG4gIC8qKlxyXG4gICAqIENyZWF0ZSBhIEJlemllciBlYXNpbmcgZnVuY3Rpb24gYW5kIGF0dGFjaCBpdCB0byBge3sjY3Jvc3NMaW5rXHJcbiAgICogXCJOR1R3ZWVuYWJsZS9mb3JtdWxhOnByb3BlcnR5XCJ9fU5HVHdlZW5hYmxlI2Zvcm11bGF7ey9jcm9zc0xpbmt9fWAuICBUaGlzXHJcbiAgICogZnVuY3Rpb24gZ2l2ZXMgeW91IHRvdGFsIGNvbnRyb2wgb3ZlciB0aGUgZWFzaW5nIGN1cnZlLiAgTWF0dGhldyBMZWluJ3NcclxuICAgKiBbQ2Vhc2VyXShodHRwOi8vbWF0dGhld2xlaW4uY29tL2NlYXNlci8pIGlzIGEgdXNlZnVsIHRvb2wgZm9yIHZpc3VhbGl6aW5nXHJcbiAgICogdGhlIGN1cnZlcyB5b3UgY2FuIG1ha2Ugd2l0aCB0aGlzIGZ1bmN0aW9uLlxyXG4gICAqIEBtZXRob2Qgc2V0QmV6aWVyRnVuY3Rpb25cclxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBUaGUgbmFtZSBvZiB0aGUgZWFzaW5nIGN1cnZlLiAgT3ZlcndyaXRlcyB0aGUgb2xkXHJcbiAgICogZWFzaW5nIGZ1bmN0aW9uIG9uIGB7eyNjcm9zc0xpbmtcclxuICAgKiBcIk5HVHdlZW5hYmxlL2Zvcm11bGE6cHJvcGVydHlcIn19TkdUd2VlbmFibGUjZm9ybXVsYXt7L2Nyb3NzTGlua319YCBpZiBpdFxyXG4gICAqIGV4aXN0cy5cclxuICAgKiBAcGFyYW0ge251bWJlcn0geDFcclxuICAgKiBAcGFyYW0ge251bWJlcn0geTFcclxuICAgKiBAcGFyYW0ge251bWJlcn0geDJcclxuICAgKiBAcGFyYW0ge251bWJlcn0geTJcclxuICAgKiBAcmV0dXJuIHtmdW5jdGlvbn0gVGhlIGVhc2luZyBmdW5jdGlvbiB0aGF0IHdhcyBhdHRhY2hlZCB0b1xyXG4gICAqIE5HVHdlZW5hYmxlLnByb3RvdHlwZS5mb3JtdWxhLlxyXG4gICAqL1xyXG4gIE5HVHdlZW5hYmxlLnNldEJlemllckZ1bmN0aW9uID0gZnVuY3Rpb24gKG5hbWUsIHgxLCB5MSwgeDIsIHkyKSB7XHJcbiAgICB2YXIgY3ViaWNCZXppZXJUcmFuc2l0aW9uID0gZ2V0Q3ViaWNCZXppZXJUcmFuc2l0aW9uKHgxLCB5MSwgeDIsIHkyKTtcclxuICAgIGN1YmljQmV6aWVyVHJhbnNpdGlvbi5kaXNwbGF5TmFtZSA9IG5hbWU7XHJcbiAgICBjdWJpY0JlemllclRyYW5zaXRpb24ueDEgPSB4MTtcclxuICAgIGN1YmljQmV6aWVyVHJhbnNpdGlvbi55MSA9IHkxO1xyXG4gICAgY3ViaWNCZXppZXJUcmFuc2l0aW9uLngyID0geDI7XHJcbiAgICBjdWJpY0JlemllclRyYW5zaXRpb24ueTIgPSB5MjtcclxuXHJcbiAgICByZXR1cm4gTkdUd2VlbmFibGUucHJvdG90eXBlLmZvcm11bGFbbmFtZV0gPSBjdWJpY0JlemllclRyYW5zaXRpb247XHJcbiAgfTtcclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIGBkZWxldGVgIGFuIGVhc2luZyBmdW5jdGlvbiBmcm9tIGB7eyNjcm9zc0xpbmtcclxuICAgKiBcIk5HVHdlZW5hYmxlL2Zvcm11bGE6cHJvcGVydHlcIn19TkdUd2VlbmFibGUjZm9ybXVsYXt7L2Nyb3NzTGlua319YC4gIEJlXHJcbiAgICogY2FyZWZ1bCB3aXRoIHRoaXMgbWV0aG9kLCBhcyBpdCBgZGVsZXRlYHMgd2hhdGV2ZXIgZWFzaW5nIGZvcm11bGEgbWF0Y2hlc1xyXG4gICAqIGBuYW1lYCAod2hpY2ggbWVhbnMgeW91IGNhbiBkZWxldGUgc3RhbmRhcmQgU2hpZnR5IGVhc2luZyBmdW5jdGlvbnMpLlxyXG4gICAqIEBtZXRob2QgdW5zZXRCZXppZXJGdW5jdGlvblxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIFRoZSBuYW1lIG9mIHRoZSBlYXNpbmcgZnVuY3Rpb24gdG8gZGVsZXRlLlxyXG4gICAqIEByZXR1cm4ge2Z1bmN0aW9ufVxyXG4gICAqL1xyXG4gIE5HVHdlZW5hYmxlLnVuc2V0QmV6aWVyRnVuY3Rpb24gPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgZGVsZXRlIE5HVHdlZW5hYmxlLnByb3RvdHlwZS5mb3JtdWxhW25hbWVdO1xyXG4gIH07XHJcblxyXG59KSgpO1xyXG5cclxuOyhmdW5jdGlvbiAoKSB7XHJcblxyXG4gIGZ1bmN0aW9uIGdldEludGVycG9sYXRlZFZhbHVlcyAoXHJcbiAgICBmcm9tLCBjdXJyZW50LCB0YXJnZXRTdGF0ZSwgcG9zaXRpb24sIGVhc2luZywgZGVsYXkpIHtcclxuICAgIHJldHVybiBOR1R3ZWVuYWJsZS50d2VlblByb3BzKFxyXG4gICAgICBwb3NpdGlvbiwgY3VycmVudCwgZnJvbSwgdGFyZ2V0U3RhdGUsIDEsIGRlbGF5LCBlYXNpbmcpO1xyXG4gIH1cclxuXHJcbiAgLy8gRmFrZSBhIE5HVHdlZW5hYmxlIGFuZCBwYXRjaCBzb21lIGludGVybmFscy4gIFRoaXMgYXBwcm9hY2ggYWxsb3dzIHVzIHRvXHJcbiAgLy8gc2tpcCB1bmVjY2Vzc2FyeSBwcm9jZXNzaW5nIGFuZCBvYmplY3QgcmVjcmVhdGlvbiwgY3V0dGluZyBkb3duIG9uIGdhcmJhZ2VcclxuICAvLyBjb2xsZWN0aW9uIHBhdXNlcy5cclxuICB2YXIgbW9ja05HVHdlZW5hYmxlID0gbmV3IE5HVHdlZW5hYmxlKCk7XHJcbiAgbW9ja05HVHdlZW5hYmxlLl9maWx0ZXJBcmdzID0gW107XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXB1dGUgdGhlIG1pZHBvaW50IG9mIHR3byBPYmplY3RzLiAgVGhpcyBtZXRob2QgZWZmZWN0aXZlbHkgY2FsY3VsYXRlcyBhXHJcbiAgICogc3BlY2lmaWMgZnJhbWUgb2YgYW5pbWF0aW9uIHRoYXQgYHt7I2Nyb3NzTGlua1xyXG4gICAqIFwiTkdUd2VlbmFibGUvdHdlZW46bWV0aG9kXCJ9fXt7L2Nyb3NzTGlua319YCBkb2VzIG1hbnkgdGltZXMgb3ZlciB0aGUgY291cnNlXHJcbiAgICogb2YgYSBmdWxsIHR3ZWVuLlxyXG4gICAqXHJcbiAgICogICAgIHZhciBpbnRlcnBvbGF0ZWRWYWx1ZXMgPSBOR1R3ZWVuYWJsZS5pbnRlcnBvbGF0ZSh7XHJcbiAgICogICAgICAgd2lkdGg6ICcxMDBweCcsXHJcbiAgICogICAgICAgb3BhY2l0eTogMCxcclxuICAgKiAgICAgICBjb2xvcjogJyNmZmYnXHJcbiAgICogICAgIH0sIHtcclxuICAgKiAgICAgICB3aWR0aDogJzIwMHB4JyxcclxuICAgKiAgICAgICBvcGFjaXR5OiAxLFxyXG4gICAqICAgICAgIGNvbG9yOiAnIzAwMCdcclxuICAgKiAgICAgfSwgMC41KTtcclxuICAgKlxyXG4gICAqICAgICBjb25zb2xlLmxvZyhpbnRlcnBvbGF0ZWRWYWx1ZXMpO1xyXG4gICAqICAgICAvLyB7b3BhY2l0eTogMC41LCB3aWR0aDogXCIxNTBweFwiLCBjb2xvcjogXCJyZ2IoMTI3LDEyNywxMjcpXCJ9XHJcbiAgICpcclxuICAgKiBAc3RhdGljXHJcbiAgICogQG1ldGhvZCBpbnRlcnBvbGF0ZVxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBmcm9tIFRoZSBzdGFydGluZyB2YWx1ZXMgdG8gdHdlZW4gZnJvbS5cclxuICAgKiBAcGFyYW0ge09iamVjdH0gdGFyZ2V0U3RhdGUgVGhlIGVuZGluZyB2YWx1ZXMgdG8gdHdlZW4gdG8uXHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IHBvc2l0aW9uIFRoZSBub3JtYWxpemVkIHBvc2l0aW9uIHZhbHVlIChiZXR3ZWVuIGAwLjBgIGFuZFxyXG4gICAqIGAxLjBgKSB0byBpbnRlcnBvbGF0ZSB0aGUgdmFsdWVzIGJldHdlZW4gYGZyb21gIGFuZCBgdG9gIGZvci4gIGBmcm9tYFxyXG4gICAqIHJlcHJlc2VudHMgYDBgIGFuZCBgdG9gIHJlcHJlc2VudHMgYDFgLlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0LjxzdHJpbmd8RnVuY3Rpb24+fHN0cmluZ3xGdW5jdGlvbn0gZWFzaW5nIFRoZSBlYXNpbmdcclxuICAgKiBjdXJ2ZShzKSB0byBjYWxjdWxhdGUgdGhlIG1pZHBvaW50IGFnYWluc3QuICBZb3UgY2FuIHJlZmVyZW5jZSBhbnkgZWFzaW5nXHJcbiAgICogZnVuY3Rpb24gYXR0YWNoZWQgdG8gYE5HVHdlZW5hYmxlLnByb3RvdHlwZS5mb3JtdWxhYCwgb3IgcHJvdmlkZSB0aGUgZWFzaW5nXHJcbiAgICogZnVuY3Rpb24ocykgZGlyZWN0bHkuICBJZiBvbWl0dGVkLCB0aGlzIGRlZmF1bHRzIHRvIFwibGluZWFyXCIuXHJcbiAgICogQHBhcmFtIHtudW1iZXI9fSBvcHRfZGVsYXkgT3B0aW9uYWwgZGVsYXkgdG8gcGFkIHRoZSBiZWdpbm5pbmcgb2YgdGhlXHJcbiAgICogaW50ZXJwb2xhdGVkIHR3ZWVuIHdpdGguICBUaGlzIGluY3JlYXNlcyB0aGUgcmFuZ2Ugb2YgYHBvc2l0aW9uYCBmcm9tIChgMGBcclxuICAgKiB0aHJvdWdoIGAxYCkgdG8gKGAwYCB0aHJvdWdoIGAxICsgb3B0X2RlbGF5YCkuICBTbywgYSBkZWxheSBvZiBgMC41YCB3b3VsZFxyXG4gICAqIGluY3JlYXNlIGFsbCB2YWxpZCB2YWx1ZXMgb2YgYHBvc2l0aW9uYCB0byBudW1iZXJzIGJldHdlZW4gYDBgIGFuZCBgMS41YC5cclxuICAgKiBAcmV0dXJuIHtPYmplY3R9XHJcbiAgICovXHJcbiAgTkdUd2VlbmFibGUuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbiAoXHJcbiAgICBmcm9tLCB0YXJnZXRTdGF0ZSwgcG9zaXRpb24sIGVhc2luZywgb3B0X2RlbGF5KSB7XHJcblxyXG4gICAgdmFyIGN1cnJlbnQgPSBOR1R3ZWVuYWJsZS5zaGFsbG93Q29weSh7fSwgZnJvbSk7XHJcbiAgICB2YXIgZGVsYXkgPSBvcHRfZGVsYXkgfHwgMDtcclxuICAgIHZhciBlYXNpbmdPYmplY3QgPSBOR1R3ZWVuYWJsZS5jb21wb3NlRWFzaW5nT2JqZWN0KFxyXG4gICAgICBmcm9tLCBlYXNpbmcgfHwgJ2xpbmVhcicpO1xyXG5cclxuICAgIG1vY2tOR1R3ZWVuYWJsZS5zZXQoe30pO1xyXG5cclxuICAgIC8vIEFsaWFzIGFuZCByZXVzZSB0aGUgX2ZpbHRlckFyZ3MgYXJyYXkgaW5zdGVhZCBvZiByZWNyZWF0aW5nIGl0LlxyXG4gICAgdmFyIGZpbHRlckFyZ3MgPSBtb2NrTkdUd2VlbmFibGUuX2ZpbHRlckFyZ3M7XHJcbiAgICBmaWx0ZXJBcmdzLmxlbmd0aCA9IDA7XHJcbiAgICBmaWx0ZXJBcmdzWzBdID0gY3VycmVudDtcclxuICAgIGZpbHRlckFyZ3NbMV0gPSBmcm9tO1xyXG4gICAgZmlsdGVyQXJnc1syXSA9IHRhcmdldFN0YXRlO1xyXG4gICAgZmlsdGVyQXJnc1szXSA9IGVhc2luZ09iamVjdDtcclxuXHJcbiAgICAvLyBBbnkgZGVmaW5lZCB2YWx1ZSB0cmFuc2Zvcm1hdGlvbiBtdXN0IGJlIGFwcGxpZWRcclxuICAgIE5HVHdlZW5hYmxlLmFwcGx5RmlsdGVyKG1vY2tOR1R3ZWVuYWJsZSwgJ3R3ZWVuQ3JlYXRlZCcpO1xyXG4gICAgTkdUd2VlbmFibGUuYXBwbHlGaWx0ZXIobW9ja05HVHdlZW5hYmxlLCAnYmVmb3JlVHdlZW4nKTtcclxuXHJcbiAgICB2YXIgaW50ZXJwb2xhdGVkVmFsdWVzID0gZ2V0SW50ZXJwb2xhdGVkVmFsdWVzKFxyXG4gICAgICBmcm9tLCBjdXJyZW50LCB0YXJnZXRTdGF0ZSwgcG9zaXRpb24sIGVhc2luZ09iamVjdCwgZGVsYXkpO1xyXG5cclxuICAgIC8vIFRyYW5zZm9ybSB2YWx1ZXMgYmFjayBpbnRvIHRoZWlyIG9yaWdpbmFsIGZvcm1hdFxyXG4gICAgTkdUd2VlbmFibGUuYXBwbHlGaWx0ZXIobW9ja05HVHdlZW5hYmxlLCAnYWZ0ZXJUd2VlbicpO1xyXG5cclxuICAgIHJldHVybiBpbnRlcnBvbGF0ZWRWYWx1ZXM7XHJcbiAgfTtcclxuXHJcbn0oKSk7XHJcblxyXG4vKipcclxuICogVGhpcyBtb2R1bGUgYWRkcyBzdHJpbmcgaW50ZXJwb2xhdGlvbiBzdXBwb3J0IHRvIFNoaWZ0eS5cclxuICpcclxuICogVGhlIFRva2VuIGV4dGVuc2lvbiBhbGxvd3MgU2hpZnR5IHRvIHR3ZWVuIG51bWJlcnMgaW5zaWRlIG9mIHN0cmluZ3MuICBBbW9uZ1xyXG4gKiBvdGhlciB0aGluZ3MsIHRoaXMgYWxsb3dzIHlvdSB0byBhbmltYXRlIENTUyBwcm9wZXJ0aWVzLiAgRm9yIGV4YW1wbGUsIHlvdVxyXG4gKiBjYW4gZG8gdGhpczpcclxuICpcclxuICogICAgIHZhciB0d2VlbmFibGUgPSBuZXcgTkdUd2VlbmFibGUoKTtcclxuICogICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAqICAgICAgIGZyb206IHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCg0NXB4KScgfSxcclxuICogICAgICAgdG86IHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCg5MHhwKScgfVxyXG4gKiAgICAgfSk7XHJcbiAqXHJcbiAqIGB0cmFuc2xhdGVYKDQ1KWAgd2lsbCBiZSB0d2VlbmVkIHRvIGB0cmFuc2xhdGVYKDkwKWAuICBUbyBkZW1vbnN0cmF0ZTpcclxuICpcclxuICogICAgIHZhciB0d2VlbmFibGUgPSBuZXcgTkdUd2VlbmFibGUoKTtcclxuICogICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAqICAgICAgIGZyb206IHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCg0NXB4KScgfSxcclxuICogICAgICAgdG86IHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCg5MHB4KScgfSxcclxuICogICAgICAgc3RlcDogZnVuY3Rpb24gKHN0YXRlKSB7XHJcbiAqICAgICAgICAgY29uc29sZS5sb2coc3RhdGUudHJhbnNmb3JtKTtcclxuICogICAgICAgfVxyXG4gKiAgICAgfSk7XHJcbiAqXHJcbiAqIFRoZSBhYm92ZSBzbmlwcGV0IHdpbGwgbG9nIHNvbWV0aGluZyBsaWtlIHRoaXMgaW4gdGhlIGNvbnNvbGU6XHJcbiAqXHJcbiAqICAgICB0cmFuc2xhdGVYKDYwLjNweClcclxuICogICAgIC4uLlxyXG4gKiAgICAgdHJhbnNsYXRlWCg3Ni4wNXB4KVxyXG4gKiAgICAgLi4uXHJcbiAqICAgICB0cmFuc2xhdGVYKDkwcHgpXHJcbiAqXHJcbiAqIEFub3RoZXIgdXNlIGZvciB0aGlzIGlzIGFuaW1hdGluZyBjb2xvcnM6XHJcbiAqXHJcbiAqICAgICB2YXIgdHdlZW5hYmxlID0gbmV3IE5HVHdlZW5hYmxlKCk7XHJcbiAqICAgICB0d2VlbmFibGUudHdlZW4oe1xyXG4gKiAgICAgICBmcm9tOiB7IGNvbG9yOiAncmdiKDAsMjU1LDApJyB9LFxyXG4gKiAgICAgICB0bzogeyBjb2xvcjogJ3JnYigyNTUsMCwyNTUpJyB9LFxyXG4gKiAgICAgICBzdGVwOiBmdW5jdGlvbiAoc3RhdGUpIHtcclxuICogICAgICAgICBjb25zb2xlLmxvZyhzdGF0ZS5jb2xvcik7XHJcbiAqICAgICAgIH1cclxuICogICAgIH0pO1xyXG4gKlxyXG4gKiBUaGUgYWJvdmUgc25pcHBldCB3aWxsIGxvZyBzb21ldGhpbmcgbGlrZSB0aGlzOlxyXG4gKlxyXG4gKiAgICAgcmdiKDg0LDE3MCw4NClcclxuICogICAgIC4uLlxyXG4gKiAgICAgcmdiKDE3MCw4NCwxNzApXHJcbiAqICAgICAuLi5cclxuICogICAgIHJnYigyNTUsMCwyNTUpXHJcbiAqXHJcbiAqIFRoaXMgZXh0ZW5zaW9uIGFsc28gc3VwcG9ydHMgaGV4YWRlY2ltYWwgY29sb3JzLCBpbiBib3RoIGxvbmcgKGAjZmYwMGZmYClcclxuICogYW5kIHNob3J0IChgI2YwZmApIGZvcm1zLiAgQmUgYXdhcmUgdGhhdCBoZXhhZGVjaW1hbCBpbnB1dCB2YWx1ZXMgd2lsbCBiZVxyXG4gKiBjb252ZXJ0ZWQgaW50byB0aGUgZXF1aXZhbGVudCBSR0Igb3V0cHV0IHZhbHVlcy4gIFRoaXMgaXMgZG9uZSB0byBvcHRpbWl6ZVxyXG4gKiBmb3IgcGVyZm9ybWFuY2UuXHJcbiAqXHJcbiAqICAgICB2YXIgdHdlZW5hYmxlID0gbmV3IE5HVHdlZW5hYmxlKCk7XHJcbiAqICAgICB0d2VlbmFibGUudHdlZW4oe1xyXG4gKiAgICAgICBmcm9tOiB7IGNvbG9yOiAnIzBmMCcgfSxcclxuICogICAgICAgdG86IHsgY29sb3I6ICcjZjBmJyB9LFxyXG4gKiAgICAgICBzdGVwOiBmdW5jdGlvbiAoc3RhdGUpIHtcclxuICogICAgICAgICBjb25zb2xlLmxvZyhzdGF0ZS5jb2xvcik7XHJcbiAqICAgICAgIH1cclxuICogICAgIH0pO1xyXG4gKlxyXG4gKiBUaGlzIHNuaXBwZXQgd2lsbCBnZW5lcmF0ZSB0aGUgc2FtZSBvdXRwdXQgYXMgdGhlIG9uZSBiZWZvcmUgaXQgYmVjYXVzZVxyXG4gKiBlcXVpdmFsZW50IHZhbHVlcyB3ZXJlIHN1cHBsaWVkIChqdXN0IGluIGhleGFkZWNpbWFsIGZvcm0gcmF0aGVyIHRoYW4gUkdCKTpcclxuICpcclxuICogICAgIHJnYig4NCwxNzAsODQpXHJcbiAqICAgICAuLi5cclxuICogICAgIHJnYigxNzAsODQsMTcwKVxyXG4gKiAgICAgLi4uXHJcbiAqICAgICByZ2IoMjU1LDAsMjU1KVxyXG4gKlxyXG4gKiAjIyBFYXNpbmcgc3VwcG9ydFxyXG4gKlxyXG4gKiBFYXNpbmcgd29ya3Mgc29tZXdoYXQgZGlmZmVyZW50bHkgaW4gdGhlIFRva2VuIGV4dGVuc2lvbi4gIFRoaXMgaXMgYmVjYXVzZVxyXG4gKiBzb21lIENTUyBwcm9wZXJ0aWVzIGhhdmUgbXVsdGlwbGUgdmFsdWVzIGluIHRoZW0sIGFuZCB5b3UgbWlnaHQgbmVlZCB0b1xyXG4gKiB0d2VlbiBlYWNoIHZhbHVlIGFsb25nIGl0cyBvd24gZWFzaW5nIGN1cnZlLiAgQSBiYXNpYyBleGFtcGxlOlxyXG4gKlxyXG4gKiAgICAgdmFyIHR3ZWVuYWJsZSA9IG5ldyBOR1R3ZWVuYWJsZSgpO1xyXG4gKiAgICAgdHdlZW5hYmxlLnR3ZWVuKHtcclxuICogICAgICAgZnJvbTogeyB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKDBweCkgdHJhbnNsYXRlWSgwcHgpJyB9LFxyXG4gKiAgICAgICB0bzogeyB0cmFuc2Zvcm06ICAgJ3RyYW5zbGF0ZVgoMTAwcHgpIHRyYW5zbGF0ZVkoMTAwcHgpJyB9LFxyXG4gKiAgICAgICBlYXNpbmc6IHsgdHJhbnNmb3JtOiAnZWFzZUluUXVhZCcgfSxcclxuICogICAgICAgc3RlcDogZnVuY3Rpb24gKHN0YXRlKSB7XHJcbiAqICAgICAgICAgY29uc29sZS5sb2coc3RhdGUudHJhbnNmb3JtKTtcclxuICogICAgICAgfVxyXG4gKiAgICAgfSk7XHJcbiAqXHJcbiAqIFRoZSBhYm92ZSBzbmlwcGV0IHdpbGwgY3JlYXRlIHZhbHVlcyBsaWtlIHRoaXM6XHJcbiAqXHJcbiAqICAgICB0cmFuc2xhdGVYKDExLjU2cHgpIHRyYW5zbGF0ZVkoMTEuNTZweClcclxuICogICAgIC4uLlxyXG4gKiAgICAgdHJhbnNsYXRlWCg0Ni4yNHB4KSB0cmFuc2xhdGVZKDQ2LjI0cHgpXHJcbiAqICAgICAuLi5cclxuICogICAgIHRyYW5zbGF0ZVgoMTAwcHgpIHRyYW5zbGF0ZVkoMTAwcHgpXHJcbiAqXHJcbiAqIEluIHRoaXMgY2FzZSwgdGhlIHZhbHVlcyBmb3IgYHRyYW5zbGF0ZVhgIGFuZCBgdHJhbnNsYXRlWWAgYXJlIGFsd2F5cyB0aGVcclxuICogc2FtZSBmb3IgZWFjaCBzdGVwIG9mIHRoZSB0d2VlbiwgYmVjYXVzZSB0aGV5IGhhdmUgdGhlIHNhbWUgc3RhcnQgYW5kIGVuZFxyXG4gKiBwb2ludHMgYW5kIGJvdGggdXNlIHRoZSBzYW1lIGVhc2luZyBjdXJ2ZS4gIFdlIGNhbiBhbHNvIHR3ZWVuIGB0cmFuc2xhdGVYYFxyXG4gKiBhbmQgYHRyYW5zbGF0ZVlgIGFsb25nIGluZGVwZW5kZW50IGN1cnZlczpcclxuICpcclxuICogICAgIHZhciB0d2VlbmFibGUgPSBuZXcgTkdUd2VlbmFibGUoKTtcclxuICogICAgIHR3ZWVuYWJsZS50d2Vlbih7XHJcbiAqICAgICAgIGZyb206IHsgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgwcHgpIHRyYW5zbGF0ZVkoMHB4KScgfSxcclxuICogICAgICAgdG86IHsgdHJhbnNmb3JtOiAgICd0cmFuc2xhdGVYKDEwMHB4KSB0cmFuc2xhdGVZKDEwMHB4KScgfSxcclxuICogICAgICAgZWFzaW5nOiB7IHRyYW5zZm9ybTogJ2Vhc2VJblF1YWQgYm91bmNlJyB9LFxyXG4gKiAgICAgICBzdGVwOiBmdW5jdGlvbiAoc3RhdGUpIHtcclxuICogICAgICAgICBjb25zb2xlLmxvZyhzdGF0ZS50cmFuc2Zvcm0pO1xyXG4gKiAgICAgICB9XHJcbiAqICAgICB9KTtcclxuICpcclxuICogVGhlIGFib3ZlIHNuaXBwZXQgd2lsbCBjcmVhdGUgdmFsdWVzIGxpa2UgdGhpczpcclxuICpcclxuICogICAgIHRyYW5zbGF0ZVgoMTAuODlweCkgdHJhbnNsYXRlWSg4Mi4zNXB4KVxyXG4gKiAgICAgLi4uXHJcbiAqICAgICB0cmFuc2xhdGVYKDQ0Ljg5cHgpIHRyYW5zbGF0ZVkoODYuNzNweClcclxuICogICAgIC4uLlxyXG4gKiAgICAgdHJhbnNsYXRlWCgxMDBweCkgdHJhbnNsYXRlWSgxMDBweClcclxuICpcclxuICogYHRyYW5zbGF0ZVhgIGFuZCBgdHJhbnNsYXRlWWAgYXJlIG5vdCBpbiBzeW5jIGFueW1vcmUsIGJlY2F1c2UgYGVhc2VJblF1YWRgXHJcbiAqIHdhcyBzcGVjaWZpZWQgZm9yIGB0cmFuc2xhdGVYYCBhbmQgYGJvdW5jZWAgZm9yIGB0cmFuc2xhdGVZYC4gIE1peGluZyBhbmRcclxuICogbWF0Y2hpbmcgZWFzaW5nIGN1cnZlcyBjYW4gbWFrZSBmb3Igc29tZSBpbnRlcmVzdGluZyBtb3Rpb24gaW4geW91clxyXG4gKiBhbmltYXRpb25zLlxyXG4gKlxyXG4gKiBUaGUgb3JkZXIgb2YgdGhlIHNwYWNlLXNlcGFyYXRlZCBlYXNpbmcgY3VydmVzIGNvcnJlc3BvbmQgdGhlIHRva2VuIHZhbHVlc1xyXG4gKiB0aGV5IGFwcGx5IHRvLiAgSWYgdGhlcmUgYXJlIG1vcmUgdG9rZW4gdmFsdWVzIHRoYW4gZWFzaW5nIGN1cnZlcyBsaXN0ZWQsXHJcbiAqIHRoZSBsYXN0IGVhc2luZyBjdXJ2ZSBsaXN0ZWQgaXMgdXNlZC5cclxuICogQHN1Ym1vZHVsZSBOR1R3ZWVuYWJsZS50b2tlblxyXG4gKi9cclxuXHJcbi8vIHRva2VuIGZ1bmN0aW9uIGlzIGRlZmluZWQgYWJvdmUgb25seSBzbyB0aGF0IGRveC1mb3VuZGF0aW9uIHNlZXMgaXQgYXNcclxuLy8gZG9jdW1lbnRhdGlvbiBhbmQgcmVuZGVycyBpdC4gIEl0IGlzIG5ldmVyIHVzZWQsIGFuZCBpcyBvcHRpbWl6ZWQgYXdheSBhdFxyXG4vLyBidWlsZCB0aW1lLlxyXG5cclxuOyhmdW5jdGlvbiAoTkdUd2VlbmFibGUpIHtcclxuXHJcbiAgLyoqXHJcbiAgICogQHR5cGVkZWYge3tcclxuICAgKiAgIGZvcm1hdFN0cmluZzogc3RyaW5nXHJcbiAgICogICBjaHVua05hbWVzOiBBcnJheS48c3RyaW5nPlxyXG4gICAqIH19XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICB2YXIgZm9ybWF0TWFuaWZlc3Q7XHJcblxyXG4gIC8vIENPTlNUQU5UU1xyXG5cclxuICB2YXIgUl9OVU1CRVJfQ09NUE9ORU5UID0gLyhcXGR8XFwtfFxcLikvO1xyXG4gIHZhciBSX0ZPUk1BVF9DSFVOS1MgPSAvKFteXFwtMC05XFwuXSspL2c7XHJcbiAgdmFyIFJfVU5GT1JNQVRURURfVkFMVUVTID0gL1swLTkuXFwtXSsvZztcclxuICB2YXIgUl9SR0IgPSBuZXcgUmVnRXhwKFxyXG4gICAgJ3JnYlxcXFwoJyArIFJfVU5GT1JNQVRURURfVkFMVUVTLnNvdXJjZSArXHJcbiAgICAoLyxcXHMqLy5zb3VyY2UpICsgUl9VTkZPUk1BVFRFRF9WQUxVRVMuc291cmNlICtcclxuICAgICgvLFxccyovLnNvdXJjZSkgKyBSX1VORk9STUFUVEVEX1ZBTFVFUy5zb3VyY2UgKyAnXFxcXCknLCAnZycpO1xyXG4gIHZhciBSX1JHQl9QUkVGSVggPSAvXi4qXFwoLztcclxuICB2YXIgUl9IRVggPSAvIyhbMC05XXxbYS1mXSl7Myw2fS9naTtcclxuICB2YXIgVkFMVUVfUExBQ0VIT0xERVIgPSAnVkFMJztcclxuXHJcbiAgLy8gSEVMUEVSU1xyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge0FycmF5Lm51bWJlcn0gcmF3VmFsdWVzXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IHByZWZpeFxyXG4gICAqXHJcbiAgICogQHJldHVybiB7QXJyYXkuPHN0cmluZz59XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBnZXRGb3JtYXRDaHVua3NGcm9tIChyYXdWYWx1ZXMsIHByZWZpeCkge1xyXG4gICAgdmFyIGFjY3VtdWxhdG9yID0gW107XHJcblxyXG4gICAgdmFyIHJhd1ZhbHVlc0xlbmd0aCA9IHJhd1ZhbHVlcy5sZW5ndGg7XHJcbiAgICB2YXIgaTtcclxuXHJcbiAgICBmb3IgKGkgPSAwOyBpIDwgcmF3VmFsdWVzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgYWNjdW11bGF0b3IucHVzaCgnXycgKyBwcmVmaXggKyAnXycgKyBpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYWNjdW11bGF0b3I7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gZm9ybWF0dGVkU3RyaW5nXHJcbiAgICpcclxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBnZXRGb3JtYXRTdHJpbmdGcm9tIChmb3JtYXR0ZWRTdHJpbmcpIHtcclxuICAgIHZhciBjaHVua3MgPSBmb3JtYXR0ZWRTdHJpbmcubWF0Y2goUl9GT1JNQVRfQ0hVTktTKTtcclxuXHJcbiAgICBpZiAoIWNodW5rcykge1xyXG4gICAgICAvLyBjaHVua3Mgd2lsbCBiZSBudWxsIGlmIHRoZXJlIHdlcmUgbm8gdG9rZW5zIHRvIHBhcnNlIGluXHJcbiAgICAgIC8vIGZvcm1hdHRlZFN0cmluZyAoZm9yIGV4YW1wbGUsIGlmIGZvcm1hdHRlZFN0cmluZyBpcyAnMicpLiAgQ29lcmNlXHJcbiAgICAgIC8vIGNodW5rcyB0byBiZSB1c2VmdWwgaGVyZS5cclxuICAgICAgY2h1bmtzID0gWycnLCAnJ107XHJcblxyXG4gICAgICAvLyBJZiB0aGVyZSBpcyBvbmx5IG9uZSBjaHVuaywgYXNzdW1lIHRoYXQgdGhlIHN0cmluZyBpcyBhIG51bWJlclxyXG4gICAgICAvLyBmb2xsb3dlZCBieSBhIHRva2VuLi4uXHJcbiAgICAgIC8vIE5PVEU6IFRoaXMgbWF5IGJlIGFuIHVud2lzZSBhc3N1bXB0aW9uLlxyXG4gICAgfSBlbHNlIGlmIChjaHVua3MubGVuZ3RoID09PSAxIHx8XHJcbiAgICAgIC8vIC4uLm9yIGlmIHRoZSBzdHJpbmcgc3RhcnRzIHdpdGggYSBudW1iZXIgY29tcG9uZW50IChcIi5cIiwgXCItXCIsIG9yIGFcclxuICAgICAgLy8gZGlnaXQpLi4uXHJcbiAgICBmb3JtYXR0ZWRTdHJpbmcuY2hhckF0KDApLm1hdGNoKFJfTlVNQkVSX0NPTVBPTkVOVCkpIHtcclxuICAgICAgLy8gLi4ucHJlcGVuZCBhbiBlbXB0eSBzdHJpbmcgaGVyZSB0byBtYWtlIHN1cmUgdGhhdCB0aGUgZm9ybWF0dGVkIG51bWJlclxyXG4gICAgICAvLyBpcyBwcm9wZXJseSByZXBsYWNlZCBieSBWQUxVRV9QTEFDRUhPTERFUlxyXG4gICAgICBjaHVua3MudW5zaGlmdCgnJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGNodW5rcy5qb2luKFZBTFVFX1BMQUNFSE9MREVSKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbnZlcnQgYWxsIGhleCBjb2xvciB2YWx1ZXMgd2l0aGluIGEgc3RyaW5nIHRvIGFuIHJnYiBzdHJpbmcuXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge09iamVjdH0gc3RhdGVPYmplY3RcclxuICAgKlxyXG4gICAqIEByZXR1cm4ge09iamVjdH0gVGhlIG1vZGlmaWVkIG9ialxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gc2FuaXRpemVPYmplY3RGb3JIZXhQcm9wcyAoc3RhdGVPYmplY3QpIHtcclxuICAgIE5HVHdlZW5hYmxlLmVhY2goc3RhdGVPYmplY3QsIGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgIHZhciBjdXJyZW50UHJvcCA9IHN0YXRlT2JqZWN0W3Byb3BdO1xyXG5cclxuICAgICAgaWYgKHR5cGVvZiBjdXJyZW50UHJvcCA9PT0gJ3N0cmluZycgJiYgY3VycmVudFByb3AubWF0Y2goUl9IRVgpKSB7XHJcbiAgICAgICAgc3RhdGVPYmplY3RbcHJvcF0gPSBzYW5pdGl6ZUhleENodW5rc1RvUkdCKGN1cnJlbnRQcm9wKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyXHJcbiAgICpcclxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiAgc2FuaXRpemVIZXhDaHVua3NUb1JHQiAoc3RyKSB7XHJcbiAgICByZXR1cm4gZmlsdGVyU3RyaW5nQ2h1bmtzKFJfSEVYLCBzdHIsIGNvbnZlcnRIZXhUb1JHQik7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBAcGFyYW0ge3N0cmluZ30gaGV4U3RyaW5nXHJcbiAgICpcclxuICAgKiBAcmV0dXJuIHtzdHJpbmd9XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBjb252ZXJ0SGV4VG9SR0IgKGhleFN0cmluZykge1xyXG4gICAgdmFyIHJnYkFyciA9IGhleFRvUkdCQXJyYXkoaGV4U3RyaW5nKTtcclxuICAgIHJldHVybiAncmdiKCcgKyByZ2JBcnJbMF0gKyAnLCcgKyByZ2JBcnJbMV0gKyAnLCcgKyByZ2JBcnJbMl0gKyAnKSc7XHJcbiAgfVxyXG5cclxuICB2YXIgaGV4VG9SR0JBcnJheV9yZXR1cm5BcnJheSA9IFtdO1xyXG4gIC8qKlxyXG4gICAqIENvbnZlcnQgYSBoZXhhZGVjaW1hbCBzdHJpbmcgdG8gYW4gYXJyYXkgd2l0aCB0aHJlZSBpdGVtcywgb25lIGVhY2ggZm9yXHJcbiAgICogdGhlIHJlZCwgYmx1ZSwgYW5kIGdyZWVuIGRlY2ltYWwgdmFsdWVzLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGhleCBBIGhleGFkZWNpbWFsIHN0cmluZy5cclxuICAgKlxyXG4gICAqIEByZXR1cm5zIHtBcnJheS48bnVtYmVyPn0gVGhlIGNvbnZlcnRlZCBBcnJheSBvZiBSR0IgdmFsdWVzIGlmIGBoZXhgIGlzIGFcclxuICAgKiB2YWxpZCBzdHJpbmcsIG9yIGFuIEFycmF5IG9mIHRocmVlIDAncy5cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIGhleFRvUkdCQXJyYXkgKGhleCkge1xyXG5cclxuICAgIGhleCA9IGhleC5yZXBsYWNlKC8jLywgJycpO1xyXG5cclxuICAgIC8vIElmIHRoZSBzdHJpbmcgaXMgYSBzaG9ydGhhbmQgdGhyZWUgZGlnaXQgaGV4IG5vdGF0aW9uLCBub3JtYWxpemUgaXQgdG9cclxuICAgIC8vIHRoZSBzdGFuZGFyZCBzaXggZGlnaXQgbm90YXRpb25cclxuICAgIGlmIChoZXgubGVuZ3RoID09PSAzKSB7XHJcbiAgICAgIGhleCA9IGhleC5zcGxpdCgnJyk7XHJcbiAgICAgIGhleCA9IGhleFswXSArIGhleFswXSArIGhleFsxXSArIGhleFsxXSArIGhleFsyXSArIGhleFsyXTtcclxuICAgIH1cclxuXHJcbiAgICBoZXhUb1JHQkFycmF5X3JldHVybkFycmF5WzBdID0gaGV4VG9EZWMoaGV4LnN1YnN0cigwLCAyKSk7XHJcbiAgICBoZXhUb1JHQkFycmF5X3JldHVybkFycmF5WzFdID0gaGV4VG9EZWMoaGV4LnN1YnN0cigyLCAyKSk7XHJcbiAgICBoZXhUb1JHQkFycmF5X3JldHVybkFycmF5WzJdID0gaGV4VG9EZWMoaGV4LnN1YnN0cig0LCAyKSk7XHJcblxyXG4gICAgcmV0dXJuIGhleFRvUkdCQXJyYXlfcmV0dXJuQXJyYXk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb252ZXJ0IGEgYmFzZS0xNiBudW1iZXIgdG8gYmFzZS0xMC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7TnVtYmVyfFN0cmluZ30gaGV4IFRoZSB2YWx1ZSB0byBjb252ZXJ0XHJcbiAgICpcclxuICAgKiBAcmV0dXJucyB7TnVtYmVyfSBUaGUgYmFzZS0xMCBlcXVpdmFsZW50IG9mIGBoZXhgLlxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gaGV4VG9EZWMgKGhleCkge1xyXG4gICAgcmV0dXJuIHBhcnNlSW50KGhleCwgMTYpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUnVucyBhIGZpbHRlciBvcGVyYXRpb24gb24gYWxsIGNodW5rcyBvZiBhIHN0cmluZyB0aGF0IG1hdGNoIGEgUmVnRXhwXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge1JlZ0V4cH0gcGF0dGVyblxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1bmZpbHRlcmVkU3RyaW5nXHJcbiAgICogQHBhcmFtIHtmdW5jdGlvbihzdHJpbmcpfSBmaWx0ZXJcclxuICAgKlxyXG4gICAqIEByZXR1cm4ge3N0cmluZ31cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIGZpbHRlclN0cmluZ0NodW5rcyAocGF0dGVybiwgdW5maWx0ZXJlZFN0cmluZywgZmlsdGVyKSB7XHJcbiAgICB2YXIgcGF0dGVuTWF0Y2hlcyA9IHVuZmlsdGVyZWRTdHJpbmcubWF0Y2gocGF0dGVybik7XHJcbiAgICB2YXIgZmlsdGVyZWRTdHJpbmcgPSB1bmZpbHRlcmVkU3RyaW5nLnJlcGxhY2UocGF0dGVybiwgVkFMVUVfUExBQ0VIT0xERVIpO1xyXG5cclxuICAgIGlmIChwYXR0ZW5NYXRjaGVzKSB7XHJcbiAgICAgIHZhciBwYXR0ZW5NYXRjaGVzTGVuZ3RoID0gcGF0dGVuTWF0Y2hlcy5sZW5ndGg7XHJcbiAgICAgIHZhciBjdXJyZW50Q2h1bms7XHJcblxyXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdHRlbk1hdGNoZXNMZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGN1cnJlbnRDaHVuayA9IHBhdHRlbk1hdGNoZXMuc2hpZnQoKTtcclxuICAgICAgICBmaWx0ZXJlZFN0cmluZyA9IGZpbHRlcmVkU3RyaW5nLnJlcGxhY2UoXHJcbiAgICAgICAgICBWQUxVRV9QTEFDRUhPTERFUiwgZmlsdGVyKGN1cnJlbnRDaHVuaykpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGZpbHRlcmVkU3RyaW5nO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgZm9yIGZsb2F0aW5nIHBvaW50IHZhbHVlcyB3aXRoaW4gcmdiIHN0cmluZ3MgYW5kIHJvdW5kcyB0aGVtLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZvcm1hdHRlZFN0cmluZ1xyXG4gICAqXHJcbiAgICogQHJldHVybiB7c3RyaW5nfVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gc2FuaXRpemVSR0JDaHVua3MgKGZvcm1hdHRlZFN0cmluZykge1xyXG4gICAgcmV0dXJuIGZpbHRlclN0cmluZ0NodW5rcyhSX1JHQiwgZm9ybWF0dGVkU3RyaW5nLCBzYW5pdGl6ZVJHQkNodW5rKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSByZ2JDaHVua1xyXG4gICAqXHJcbiAgICogQHJldHVybiB7c3RyaW5nfVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gc2FuaXRpemVSR0JDaHVuayAocmdiQ2h1bmspIHtcclxuICAgIHZhciBudW1iZXJzID0gcmdiQ2h1bmsubWF0Y2goUl9VTkZPUk1BVFRFRF9WQUxVRVMpO1xyXG4gICAgdmFyIG51bWJlcnNMZW5ndGggPSBudW1iZXJzLmxlbmd0aDtcclxuICAgIHZhciBzYW5pdGl6ZWRTdHJpbmcgPSByZ2JDaHVuay5tYXRjaChSX1JHQl9QUkVGSVgpWzBdO1xyXG5cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtYmVyc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgIHNhbml0aXplZFN0cmluZyArPSBwYXJzZUludChudW1iZXJzW2ldLCAxMCkgKyAnLCc7XHJcbiAgICB9XHJcblxyXG4gICAgc2FuaXRpemVkU3RyaW5nID0gc2FuaXRpemVkU3RyaW5nLnNsaWNlKDAsIC0xKSArICcpJztcclxuXHJcbiAgICByZXR1cm4gc2FuaXRpemVkU3RyaW5nO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHN0YXRlT2JqZWN0XHJcbiAgICpcclxuICAgKiBAcmV0dXJuIHtPYmplY3R9IEFuIE9iamVjdCBvZiBmb3JtYXRNYW5pZmVzdHMgdGhhdCBjb3JyZXNwb25kIHRvXHJcbiAgICogdGhlIHN0cmluZyBwcm9wZXJ0aWVzIG9mIHN0YXRlT2JqZWN0XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBnZXRGb3JtYXRNYW5pZmVzdHMgKHN0YXRlT2JqZWN0KSB7XHJcbiAgICB2YXIgbWFuaWZlc3RBY2N1bXVsYXRvciA9IHt9O1xyXG5cclxuICAgIE5HVHdlZW5hYmxlLmVhY2goc3RhdGVPYmplY3QsIGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgIHZhciBjdXJyZW50UHJvcCA9IHN0YXRlT2JqZWN0W3Byb3BdO1xyXG5cclxuICAgICAgaWYgKHR5cGVvZiBjdXJyZW50UHJvcCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICB2YXIgcmF3VmFsdWVzID0gZ2V0VmFsdWVzRnJvbShjdXJyZW50UHJvcCk7XHJcblxyXG4gICAgICAgIG1hbmlmZXN0QWNjdW11bGF0b3JbcHJvcF0gPSB7XHJcbiAgICAgICAgICAnZm9ybWF0U3RyaW5nJzogZ2V0Rm9ybWF0U3RyaW5nRnJvbShjdXJyZW50UHJvcClcclxuICAgICAgICAgICwnY2h1bmtOYW1lcyc6IGdldEZvcm1hdENodW5rc0Zyb20ocmF3VmFsdWVzLCBwcm9wKVxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBtYW5pZmVzdEFjY3VtdWxhdG9yO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHN0YXRlT2JqZWN0XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGZvcm1hdE1hbmlmZXN0c1xyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gZXhwYW5kRm9ybWF0dGVkUHJvcGVydGllcyAoc3RhdGVPYmplY3QsIGZvcm1hdE1hbmlmZXN0cykge1xyXG4gICAgTkdUd2VlbmFibGUuZWFjaChmb3JtYXRNYW5pZmVzdHMsIGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgIHZhciBjdXJyZW50UHJvcCA9IHN0YXRlT2JqZWN0W3Byb3BdO1xyXG4gICAgICB2YXIgcmF3VmFsdWVzID0gZ2V0VmFsdWVzRnJvbShjdXJyZW50UHJvcCk7XHJcbiAgICAgIHZhciByYXdWYWx1ZXNMZW5ndGggPSByYXdWYWx1ZXMubGVuZ3RoO1xyXG5cclxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYXdWYWx1ZXNMZW5ndGg7IGkrKykge1xyXG4gICAgICAgIHN0YXRlT2JqZWN0W2Zvcm1hdE1hbmlmZXN0c1twcm9wXS5jaHVua05hbWVzW2ldXSA9ICtyYXdWYWx1ZXNbaV07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGRlbGV0ZSBzdGF0ZU9iamVjdFtwcm9wXTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IHN0YXRlT2JqZWN0XHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGZvcm1hdE1hbmlmZXN0c1xyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gY29sbGFwc2VGb3JtYXR0ZWRQcm9wZXJ0aWVzIChzdGF0ZU9iamVjdCwgZm9ybWF0TWFuaWZlc3RzKSB7XHJcbiAgICBOR1R3ZWVuYWJsZS5lYWNoKGZvcm1hdE1hbmlmZXN0cywgZnVuY3Rpb24gKHByb3ApIHtcclxuICAgICAgdmFyIGN1cnJlbnRQcm9wID0gc3RhdGVPYmplY3RbcHJvcF07XHJcbiAgICAgIHZhciBmb3JtYXRDaHVua3MgPSBleHRyYWN0UHJvcGVydHlDaHVua3MoXHJcbiAgICAgICAgc3RhdGVPYmplY3QsIGZvcm1hdE1hbmlmZXN0c1twcm9wXS5jaHVua05hbWVzKTtcclxuICAgICAgdmFyIHZhbHVlc0xpc3QgPSBnZXRWYWx1ZXNMaXN0KFxyXG4gICAgICAgIGZvcm1hdENodW5rcywgZm9ybWF0TWFuaWZlc3RzW3Byb3BdLmNodW5rTmFtZXMpO1xyXG4gICAgICBjdXJyZW50UHJvcCA9IGdldEZvcm1hdHRlZFZhbHVlcyhcclxuICAgICAgICBmb3JtYXRNYW5pZmVzdHNbcHJvcF0uZm9ybWF0U3RyaW5nLCB2YWx1ZXNMaXN0KTtcclxuICAgICAgc3RhdGVPYmplY3RbcHJvcF0gPSBzYW5pdGl6ZVJHQkNodW5rcyhjdXJyZW50UHJvcCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzdGF0ZU9iamVjdFxyXG4gICAqIEBwYXJhbSB7QXJyYXkuPHN0cmluZz59IGNodW5rTmFtZXNcclxuICAgKlxyXG4gICAqIEByZXR1cm4ge09iamVjdH0gVGhlIGV4dHJhY3RlZCB2YWx1ZSBjaHVua3MuXHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBleHRyYWN0UHJvcGVydHlDaHVua3MgKHN0YXRlT2JqZWN0LCBjaHVua05hbWVzKSB7XHJcbiAgICB2YXIgZXh0cmFjdGVkVmFsdWVzID0ge307XHJcbiAgICB2YXIgY3VycmVudENodW5rTmFtZSwgY2h1bmtOYW1lc0xlbmd0aCA9IGNodW5rTmFtZXMubGVuZ3RoO1xyXG5cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2h1bmtOYW1lc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGN1cnJlbnRDaHVua05hbWUgPSBjaHVua05hbWVzW2ldO1xyXG4gICAgICBleHRyYWN0ZWRWYWx1ZXNbY3VycmVudENodW5rTmFtZV0gPSBzdGF0ZU9iamVjdFtjdXJyZW50Q2h1bmtOYW1lXTtcclxuICAgICAgZGVsZXRlIHN0YXRlT2JqZWN0W2N1cnJlbnRDaHVua05hbWVdO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBleHRyYWN0ZWRWYWx1ZXM7XHJcbiAgfVxyXG5cclxuICB2YXIgZ2V0VmFsdWVzTGlzdF9hY2N1bXVsYXRvciA9IFtdO1xyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBzdGF0ZU9iamVjdFxyXG4gICAqIEBwYXJhbSB7QXJyYXkuPHN0cmluZz59IGNodW5rTmFtZXNcclxuICAgKlxyXG4gICAqIEByZXR1cm4ge0FycmF5LjxudW1iZXI+fVxyXG4gICAqIEBwcml2YXRlXHJcbiAgICovXHJcbiAgZnVuY3Rpb24gZ2V0VmFsdWVzTGlzdCAoc3RhdGVPYmplY3QsIGNodW5rTmFtZXMpIHtcclxuICAgIGdldFZhbHVlc0xpc3RfYWNjdW11bGF0b3IubGVuZ3RoID0gMDtcclxuICAgIHZhciBjaHVua05hbWVzTGVuZ3RoID0gY2h1bmtOYW1lcy5sZW5ndGg7XHJcblxyXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVua05hbWVzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgZ2V0VmFsdWVzTGlzdF9hY2N1bXVsYXRvci5wdXNoKHN0YXRlT2JqZWN0W2NodW5rTmFtZXNbaV1dKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZ2V0VmFsdWVzTGlzdF9hY2N1bXVsYXRvcjtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmb3JtYXRTdHJpbmdcclxuICAgKiBAcGFyYW0ge0FycmF5LjxudW1iZXI+fSByYXdWYWx1ZXNcclxuICAgKlxyXG4gICAqIEByZXR1cm4ge3N0cmluZ31cclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIGdldEZvcm1hdHRlZFZhbHVlcyAoZm9ybWF0U3RyaW5nLCByYXdWYWx1ZXMpIHtcclxuICAgIHZhciBmb3JtYXR0ZWRWYWx1ZVN0cmluZyA9IGZvcm1hdFN0cmluZztcclxuICAgIHZhciByYXdWYWx1ZXNMZW5ndGggPSByYXdWYWx1ZXMubGVuZ3RoO1xyXG5cclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmF3VmFsdWVzTGVuZ3RoOyBpKyspIHtcclxuICAgICAgZm9ybWF0dGVkVmFsdWVTdHJpbmcgPSBmb3JtYXR0ZWRWYWx1ZVN0cmluZy5yZXBsYWNlKFxyXG4gICAgICAgIFZBTFVFX1BMQUNFSE9MREVSLCArcmF3VmFsdWVzW2ldLnRvRml4ZWQoNCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmb3JtYXR0ZWRWYWx1ZVN0cmluZztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE5vdGU6IEl0J3MgdGhlIGR1dHkgb2YgdGhlIGNhbGxlciB0byBjb252ZXJ0IHRoZSBBcnJheSBlbGVtZW50cyBvZiB0aGVcclxuICAgKiByZXR1cm4gdmFsdWUgaW50byBudW1iZXJzLiAgVGhpcyBpcyBhIHBlcmZvcm1hbmNlIG9wdGltaXphdGlvbi5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmb3JtYXR0ZWRTdHJpbmdcclxuICAgKlxyXG4gICAqIEByZXR1cm4ge0FycmF5LjxzdHJpbmc+fG51bGx9XHJcbiAgICogQHByaXZhdGVcclxuICAgKi9cclxuICBmdW5jdGlvbiBnZXRWYWx1ZXNGcm9tIChmb3JtYXR0ZWRTdHJpbmcpIHtcclxuICAgIHJldHVybiBmb3JtYXR0ZWRTdHJpbmcubWF0Y2goUl9VTkZPUk1BVFRFRF9WQUxVRVMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGVhc2luZ09iamVjdFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB0b2tlbkRhdGFcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIGV4cGFuZEVhc2luZ09iamVjdCAoZWFzaW5nT2JqZWN0LCB0b2tlbkRhdGEpIHtcclxuICAgIE5HVHdlZW5hYmxlLmVhY2godG9rZW5EYXRhLCBmdW5jdGlvbiAocHJvcCkge1xyXG4gICAgICB2YXIgY3VycmVudFByb3AgPSB0b2tlbkRhdGFbcHJvcF07XHJcbiAgICAgIHZhciBjaHVua05hbWVzID0gY3VycmVudFByb3AuY2h1bmtOYW1lcztcclxuICAgICAgdmFyIGNodW5rTGVuZ3RoID0gY2h1bmtOYW1lcy5sZW5ndGg7XHJcblxyXG4gICAgICB2YXIgZWFzaW5nID0gZWFzaW5nT2JqZWN0W3Byb3BdO1xyXG4gICAgICB2YXIgaTtcclxuXHJcbiAgICAgIGlmICh0eXBlb2YgZWFzaW5nID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHZhciBlYXNpbmdDaHVua3MgPSBlYXNpbmcuc3BsaXQoJyAnKTtcclxuICAgICAgICB2YXIgbGFzdEVhc2luZ0NodW5rID0gZWFzaW5nQ2h1bmtzW2Vhc2luZ0NodW5rcy5sZW5ndGggLSAxXTtcclxuXHJcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IGNodW5rTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgIGVhc2luZ09iamVjdFtjaHVua05hbWVzW2ldXSA9IGVhc2luZ0NodW5rc1tpXSB8fCBsYXN0RWFzaW5nQ2h1bms7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2h1bmtMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgZWFzaW5nT2JqZWN0W2NodW5rTmFtZXNbaV1dID0gZWFzaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgZGVsZXRlIGVhc2luZ09iamVjdFtwcm9wXTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQHBhcmFtIHtPYmplY3R9IGVhc2luZ09iamVjdFxyXG4gICAqIEBwYXJhbSB7T2JqZWN0fSB0b2tlbkRhdGFcclxuICAgKiBAcHJpdmF0ZVxyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIGNvbGxhcHNlRWFzaW5nT2JqZWN0IChlYXNpbmdPYmplY3QsIHRva2VuRGF0YSkge1xyXG4gICAgTkdUd2VlbmFibGUuZWFjaCh0b2tlbkRhdGEsIGZ1bmN0aW9uIChwcm9wKSB7XHJcbiAgICAgIHZhciBjdXJyZW50UHJvcCA9IHRva2VuRGF0YVtwcm9wXTtcclxuICAgICAgdmFyIGNodW5rTmFtZXMgPSBjdXJyZW50UHJvcC5jaHVua05hbWVzO1xyXG4gICAgICB2YXIgY2h1bmtMZW5ndGggPSBjaHVua05hbWVzLmxlbmd0aDtcclxuXHJcbiAgICAgIHZhciBmaXJzdEVhc2luZyA9IGVhc2luZ09iamVjdFtjaHVua05hbWVzWzBdXTtcclxuICAgICAgdmFyIHR5cGVvZkVhc2luZ3MgPSB0eXBlb2YgZmlyc3RFYXNpbmc7XHJcblxyXG4gICAgICBpZiAodHlwZW9mRWFzaW5ncyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICB2YXIgY29tcG9zZWRFYXNpbmdTdHJpbmcgPSAnJztcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVua0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICBjb21wb3NlZEVhc2luZ1N0cmluZyArPSAnICcgKyBlYXNpbmdPYmplY3RbY2h1bmtOYW1lc1tpXV07XHJcbiAgICAgICAgICBkZWxldGUgZWFzaW5nT2JqZWN0W2NodW5rTmFtZXNbaV1dO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZWFzaW5nT2JqZWN0W3Byb3BdID0gY29tcG9zZWRFYXNpbmdTdHJpbmcuc3Vic3RyKDEpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGVhc2luZ09iamVjdFtwcm9wXSA9IGZpcnN0RWFzaW5nO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIE5HVHdlZW5hYmxlLnByb3RvdHlwZS5maWx0ZXIudG9rZW4gPSB7XHJcbiAgICAndHdlZW5DcmVhdGVkJzogZnVuY3Rpb24gKGN1cnJlbnRTdGF0ZSwgZnJvbVN0YXRlLCB0b1N0YXRlLCBlYXNpbmdPYmplY3QpIHtcclxuICAgICAgc2FuaXRpemVPYmplY3RGb3JIZXhQcm9wcyhjdXJyZW50U3RhdGUpO1xyXG4gICAgICBzYW5pdGl6ZU9iamVjdEZvckhleFByb3BzKGZyb21TdGF0ZSk7XHJcbiAgICAgIHNhbml0aXplT2JqZWN0Rm9ySGV4UHJvcHModG9TdGF0ZSk7XHJcbiAgICAgIHRoaXMuX3Rva2VuRGF0YSA9IGdldEZvcm1hdE1hbmlmZXN0cyhjdXJyZW50U3RhdGUpO1xyXG4gICAgfSxcclxuXHJcbiAgICAnYmVmb3JlVHdlZW4nOiBmdW5jdGlvbiAoY3VycmVudFN0YXRlLCBmcm9tU3RhdGUsIHRvU3RhdGUsIGVhc2luZ09iamVjdCkge1xyXG4gICAgICBleHBhbmRFYXNpbmdPYmplY3QoZWFzaW5nT2JqZWN0LCB0aGlzLl90b2tlbkRhdGEpO1xyXG4gICAgICBleHBhbmRGb3JtYXR0ZWRQcm9wZXJ0aWVzKGN1cnJlbnRTdGF0ZSwgdGhpcy5fdG9rZW5EYXRhKTtcclxuICAgICAgZXhwYW5kRm9ybWF0dGVkUHJvcGVydGllcyhmcm9tU3RhdGUsIHRoaXMuX3Rva2VuRGF0YSk7XHJcbiAgICAgIGV4cGFuZEZvcm1hdHRlZFByb3BlcnRpZXModG9TdGF0ZSwgdGhpcy5fdG9rZW5EYXRhKTtcclxuICAgIH0sXHJcblxyXG4gICAgJ2FmdGVyVHdlZW4nOiBmdW5jdGlvbiAoY3VycmVudFN0YXRlLCBmcm9tU3RhdGUsIHRvU3RhdGUsIGVhc2luZ09iamVjdCkge1xyXG4gICAgICBjb2xsYXBzZUZvcm1hdHRlZFByb3BlcnRpZXMoY3VycmVudFN0YXRlLCB0aGlzLl90b2tlbkRhdGEpO1xyXG4gICAgICBjb2xsYXBzZUZvcm1hdHRlZFByb3BlcnRpZXMoZnJvbVN0YXRlLCB0aGlzLl90b2tlbkRhdGEpO1xyXG4gICAgICBjb2xsYXBzZUZvcm1hdHRlZFByb3BlcnRpZXModG9TdGF0ZSwgdGhpcy5fdG9rZW5EYXRhKTtcclxuICAgICAgY29sbGFwc2VFYXNpbmdPYmplY3QoZWFzaW5nT2JqZWN0LCB0aGlzLl90b2tlbkRhdGEpO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG59IChOR1R3ZWVuYWJsZSkpO1xyXG5cclxufSkuY2FsbChudWxsKTtcclxuXHJcblxyXG5cclxuXHJcbi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuLy8jIyBIQU1NRVIuSlMgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4vLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcblxyXG4vLyBIQU1NRVIuSlNcclxuXHJcbi8vIGV4dGVybmFsIG1vZHVsZSBFTUJFREVEIGluIG5hbm9nYWxsZXJ5XHJcbi8vIE5HWSBCVUlMRDpcclxuLy8gcmVwbGFjZSBcIkhhbW1lclwiIHdpdGggXCJOR0hhbW1lclwiIChjYXNlIHNlbnNpdGl2ZSlcclxuLy8gcmVwbGFjZSBcInZhciBTVVBQT1JUX1BPSU5URVJfRVZFTlRTID0gcHJlZml4ZWQod2luZG93LCAnUG9pbnRlckV2ZW50JykgIT09IHVuZGVmaW5lZDtcIiB3aXRoIFwidmFyIFNVUFBPUlRfUE9JTlRFUl9FVkVOVFMgPSBmYWxzZTtcIlxyXG4vLyByZXBsYWNlIFwiZGVmaW5lLmFtZFwiIHdpdGggXCJkZWZpbmUuYW1kRElTQUJMRURcIlxyXG5cclxuXHJcblxyXG4vKiEgTkdIYW1tZXIuSlMgLSB2Mi4wLjcgLSAyMDE2LTA0LTIyXHJcbiAqIGh0dHA6Ly9oYW1tZXJqcy5naXRodWIuaW8vXHJcbiAqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNiBKb3JpayBUYW5nZWxkZXI7XHJcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSAqL1xyXG4oZnVuY3Rpb24od2luZG93LCBkb2N1bWVudCwgZXhwb3J0TmFtZSwgdW5kZWZpbmVkKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIFZFTkRPUl9QUkVGSVhFUyA9IFsnJywgJ3dlYmtpdCcsICdNb3onLCAnTVMnLCAnbXMnLCAnbyddO1xyXG52YXIgVEVTVF9FTEVNRU5UID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcblxyXG52YXIgVFlQRV9GVU5DVElPTiA9ICdmdW5jdGlvbic7XHJcblxyXG52YXIgcm91bmQgPSBNYXRoLnJvdW5kO1xyXG52YXIgYWJzID0gTWF0aC5hYnM7XHJcbnZhciBub3cgPSBEYXRlLm5vdztcclxuXHJcbi8qKlxyXG4gKiBzZXQgYSB0aW1lb3V0IHdpdGggYSBnaXZlbiBzY29wZVxyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmblxyXG4gKiBAcGFyYW0ge051bWJlcn0gdGltZW91dFxyXG4gKiBAcGFyYW0ge09iamVjdH0gY29udGV4dFxyXG4gKiBAcmV0dXJucyB7bnVtYmVyfVxyXG4gKi9cclxuZnVuY3Rpb24gc2V0VGltZW91dENvbnRleHQoZm4sIHRpbWVvdXQsIGNvbnRleHQpIHtcclxuICAgIHJldHVybiBzZXRUaW1lb3V0KGJpbmRGbihmbiwgY29udGV4dCksIHRpbWVvdXQpO1xyXG59XHJcblxyXG4vKipcclxuICogaWYgdGhlIGFyZ3VtZW50IGlzIGFuIGFycmF5LCB3ZSB3YW50IHRvIGV4ZWN1dGUgdGhlIGZuIG9uIGVhY2ggZW50cnlcclxuICogaWYgaXQgYWludCBhbiBhcnJheSB3ZSBkb24ndCB3YW50IHRvIGRvIGEgdGhpbmcuXHJcbiAqIHRoaXMgaXMgdXNlZCBieSBhbGwgdGhlIG1ldGhvZHMgdGhhdCBhY2NlcHQgYSBzaW5nbGUgYW5kIGFycmF5IGFyZ3VtZW50LlxyXG4gKiBAcGFyYW0geyp8QXJyYXl9IGFyZ1xyXG4gKiBAcGFyYW0ge1N0cmluZ30gZm5cclxuICogQHBhcmFtIHtPYmplY3R9IFtjb250ZXh0XVxyXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn1cclxuICovXHJcbmZ1bmN0aW9uIGludm9rZUFycmF5QXJnKGFyZywgZm4sIGNvbnRleHQpIHtcclxuICAgIGlmIChBcnJheS5pc0FycmF5KGFyZykpIHtcclxuICAgICAgICBlYWNoKGFyZywgY29udGV4dFtmbl0sIGNvbnRleHQpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG4vKipcclxuICogd2FsayBvYmplY3RzIGFuZCBhcnJheXNcclxuICogQHBhcmFtIHtPYmplY3R9IG9ialxyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBpdGVyYXRvclxyXG4gKiBAcGFyYW0ge09iamVjdH0gY29udGV4dFxyXG4gKi9cclxuZnVuY3Rpb24gZWFjaChvYmosIGl0ZXJhdG9yLCBjb250ZXh0KSB7XHJcbiAgICB2YXIgaTtcclxuXHJcbiAgICBpZiAoIW9iaikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob2JqLmZvckVhY2gpIHtcclxuICAgICAgICBvYmouZm9yRWFjaChpdGVyYXRvciwgY29udGV4dCk7XHJcbiAgICB9IGVsc2UgaWYgKG9iai5sZW5ndGggIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGkgPSAwO1xyXG4gICAgICAgIHdoaWxlIChpIDwgb2JqLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpdGVyYXRvci5jYWxsKGNvbnRleHQsIG9ialtpXSwgaSwgb2JqKTtcclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZm9yIChpIGluIG9iaikge1xyXG4gICAgICAgICAgICBvYmouaGFzT3duUHJvcGVydHkoaSkgJiYgaXRlcmF0b3IuY2FsbChjb250ZXh0LCBvYmpbaV0sIGksIG9iaik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogd3JhcCBhIG1ldGhvZCB3aXRoIGEgZGVwcmVjYXRpb24gd2FybmluZyBhbmQgc3RhY2sgdHJhY2VcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gbWV0aG9kXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBtZXNzYWdlXHJcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBuZXcgZnVuY3Rpb24gd3JhcHBpbmcgdGhlIHN1cHBsaWVkIG1ldGhvZC5cclxuICovXHJcbmZ1bmN0aW9uIGRlcHJlY2F0ZShtZXRob2QsIG5hbWUsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBkZXByZWNhdGlvbk1lc3NhZ2UgPSAnREVQUkVDQVRFRCBNRVRIT0Q6ICcgKyBuYW1lICsgJ1xcbicgKyBtZXNzYWdlICsgJyBBVCBcXG4nO1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBlID0gbmV3IEVycm9yKCdnZXQtc3RhY2stdHJhY2UnKTtcclxuICAgICAgICB2YXIgc3RhY2sgPSBlICYmIGUuc3RhY2sgPyBlLnN0YWNrLnJlcGxhY2UoL15bXlxcKF0rP1tcXG4kXS9nbSwgJycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxzK2F0XFxzKy9nbSwgJycpXHJcbiAgICAgICAgICAgIC5yZXBsYWNlKC9eT2JqZWN0Ljxhbm9ueW1vdXM+XFxzKlxcKC9nbSwgJ3thbm9ueW1vdXN9KClAJykgOiAnVW5rbm93biBTdGFjayBUcmFjZSc7XHJcblxyXG4gICAgICAgIHZhciBsb2cgPSB3aW5kb3cuY29uc29sZSAmJiAod2luZG93LmNvbnNvbGUud2FybiB8fCB3aW5kb3cuY29uc29sZS5sb2cpO1xyXG4gICAgICAgIGlmIChsb2cpIHtcclxuICAgICAgICAgICAgbG9nLmNhbGwod2luZG93LmNvbnNvbGUsIGRlcHJlY2F0aW9uTWVzc2FnZSwgc3RhY2spO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbiAgICB9O1xyXG59XHJcblxyXG4vKipcclxuICogZXh0ZW5kIG9iamVjdC5cclxuICogbWVhbnMgdGhhdCBwcm9wZXJ0aWVzIGluIGRlc3Qgd2lsbCBiZSBvdmVyd3JpdHRlbiBieSB0aGUgb25lcyBpbiBzcmMuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSB0YXJnZXRcclxuICogQHBhcmFtIHsuLi5PYmplY3R9IG9iamVjdHNfdG9fYXNzaWduXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IHRhcmdldFxyXG4gKi9cclxudmFyIGFzc2lnbjtcclxuaWYgKHR5cGVvZiBPYmplY3QuYXNzaWduICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICBhc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24odGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IHRhcmdldCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCB1bmRlZmluZWQgb3IgbnVsbCB0byBvYmplY3QnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBvdXRwdXQgPSBPYmplY3QodGFyZ2V0KTtcclxuICAgICAgICBmb3IgKHZhciBpbmRleCA9IDE7IGluZGV4IDwgYXJndW1lbnRzLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2luZGV4XTtcclxuICAgICAgICAgICAgaWYgKHNvdXJjZSAhPT0gdW5kZWZpbmVkICYmIHNvdXJjZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbmV4dEtleSBpbiBzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlLmhhc093blByb3BlcnR5KG5leHRLZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dFtuZXh0S2V5XSA9IHNvdXJjZVtuZXh0S2V5XTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG91dHB1dDtcclxuICAgIH07XHJcbn0gZWxzZSB7XHJcbiAgICBhc3NpZ24gPSBPYmplY3QuYXNzaWduO1xyXG59XHJcblxyXG4vKipcclxuICogZXh0ZW5kIG9iamVjdC5cclxuICogbWVhbnMgdGhhdCBwcm9wZXJ0aWVzIGluIGRlc3Qgd2lsbCBiZSBvdmVyd3JpdHRlbiBieSB0aGUgb25lcyBpbiBzcmMuXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBkZXN0XHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBzcmNcclxuICogQHBhcmFtIHtCb29sZWFufSBbbWVyZ2U9ZmFsc2VdXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IGRlc3RcclxuICovXHJcbnZhciBleHRlbmQgPSBkZXByZWNhdGUoZnVuY3Rpb24gZXh0ZW5kKGRlc3QsIHNyYywgbWVyZ2UpIHtcclxuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoc3JjKTtcclxuICAgIHZhciBpID0gMDtcclxuICAgIHdoaWxlIChpIDwga2V5cy5sZW5ndGgpIHtcclxuICAgICAgICBpZiAoIW1lcmdlIHx8IChtZXJnZSAmJiBkZXN0W2tleXNbaV1dID09PSB1bmRlZmluZWQpKSB7XHJcbiAgICAgICAgICAgIGRlc3Rba2V5c1tpXV0gPSBzcmNba2V5c1tpXV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGkrKztcclxuICAgIH1cclxuICAgIHJldHVybiBkZXN0O1xyXG59LCAnZXh0ZW5kJywgJ1VzZSBgYXNzaWduYC4nKTtcclxuXHJcbi8qKlxyXG4gKiBtZXJnZSB0aGUgdmFsdWVzIGZyb20gc3JjIGluIHRoZSBkZXN0LlxyXG4gKiBtZWFucyB0aGF0IHByb3BlcnRpZXMgdGhhdCBleGlzdCBpbiBkZXN0IHdpbGwgbm90IGJlIG92ZXJ3cml0dGVuIGJ5IHNyY1xyXG4gKiBAcGFyYW0ge09iamVjdH0gZGVzdFxyXG4gKiBAcGFyYW0ge09iamVjdH0gc3JjXHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IGRlc3RcclxuICovXHJcbnZhciBtZXJnZSA9IGRlcHJlY2F0ZShmdW5jdGlvbiBtZXJnZShkZXN0LCBzcmMpIHtcclxuICAgIHJldHVybiBleHRlbmQoZGVzdCwgc3JjLCB0cnVlKTtcclxufSwgJ21lcmdlJywgJ1VzZSBgYXNzaWduYC4nKTtcclxuXHJcbi8qKlxyXG4gKiBzaW1wbGUgY2xhc3MgaW5oZXJpdGFuY2VcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2hpbGRcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gYmFzZVxyXG4gKiBAcGFyYW0ge09iamVjdH0gW3Byb3BlcnRpZXNdXHJcbiAqL1xyXG5mdW5jdGlvbiBpbmhlcml0KGNoaWxkLCBiYXNlLCBwcm9wZXJ0aWVzKSB7XHJcbiAgICB2YXIgYmFzZVAgPSBiYXNlLnByb3RvdHlwZSxcclxuICAgICAgICBjaGlsZFA7XHJcblxyXG4gICAgY2hpbGRQID0gY2hpbGQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShiYXNlUCk7XHJcbiAgICBjaGlsZFAuY29uc3RydWN0b3IgPSBjaGlsZDtcclxuICAgIGNoaWxkUC5fc3VwZXIgPSBiYXNlUDtcclxuXHJcbiAgICBpZiAocHJvcGVydGllcykge1xyXG4gICAgICAgIGFzc2lnbihjaGlsZFAsIHByb3BlcnRpZXMpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogc2ltcGxlIGZ1bmN0aW9uIGJpbmRcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm5cclxuICogQHBhcmFtIHtPYmplY3R9IGNvbnRleHRcclxuICogQHJldHVybnMge0Z1bmN0aW9ufVxyXG4gKi9cclxuZnVuY3Rpb24gYmluZEZuKGZuLCBjb250ZXh0KSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gYm91bmRGbigpIHtcclxuICAgICAgICByZXR1cm4gZm4uYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTtcclxuICAgIH07XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBsZXQgYSBib29sZWFuIHZhbHVlIGFsc28gYmUgYSBmdW5jdGlvbiB0aGF0IG11c3QgcmV0dXJuIGEgYm9vbGVhblxyXG4gKiB0aGlzIGZpcnN0IGl0ZW0gaW4gYXJncyB3aWxsIGJlIHVzZWQgYXMgdGhlIGNvbnRleHRcclxuICogQHBhcmFtIHtCb29sZWFufEZ1bmN0aW9ufSB2YWxcclxuICogQHBhcmFtIHtBcnJheX0gW2FyZ3NdXHJcbiAqIEByZXR1cm5zIHtCb29sZWFufVxyXG4gKi9cclxuZnVuY3Rpb24gYm9vbE9yRm4odmFsLCBhcmdzKSB7XHJcbiAgICBpZiAodHlwZW9mIHZhbCA9PSBUWVBFX0ZVTkNUSU9OKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbC5hcHBseShhcmdzID8gYXJnc1swXSB8fCB1bmRlZmluZWQgOiB1bmRlZmluZWQsIGFyZ3MpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbDtcclxufVxyXG5cclxuLyoqXHJcbiAqIHVzZSB0aGUgdmFsMiB3aGVuIHZhbDEgaXMgdW5kZWZpbmVkXHJcbiAqIEBwYXJhbSB7Kn0gdmFsMVxyXG4gKiBAcGFyYW0geyp9IHZhbDJcclxuICogQHJldHVybnMgeyp9XHJcbiAqL1xyXG5mdW5jdGlvbiBpZlVuZGVmaW5lZCh2YWwxLCB2YWwyKSB7XHJcbiAgICByZXR1cm4gKHZhbDEgPT09IHVuZGVmaW5lZCkgPyB2YWwyIDogdmFsMTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGFkZEV2ZW50TGlzdGVuZXIgd2l0aCBtdWx0aXBsZSBldmVudHMgYXQgb25jZVxyXG4gKiBAcGFyYW0ge0V2ZW50VGFyZ2V0fSB0YXJnZXRcclxuICogQHBhcmFtIHtTdHJpbmd9IHR5cGVzXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXJcclxuICovXHJcbmZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJzKHRhcmdldCwgdHlwZXMsIGhhbmRsZXIpIHtcclxuICAgIGVhY2goc3BsaXRTdHIodHlwZXMpLCBmdW5jdGlvbih0eXBlKSB7XHJcbiAgICAgICAgdGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgZmFsc2UpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiByZW1vdmVFdmVudExpc3RlbmVyIHdpdGggbXVsdGlwbGUgZXZlbnRzIGF0IG9uY2VcclxuICogQHBhcmFtIHtFdmVudFRhcmdldH0gdGFyZ2V0XHJcbiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlc1xyXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyXHJcbiAqL1xyXG5mdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycyh0YXJnZXQsIHR5cGVzLCBoYW5kbGVyKSB7XHJcbiAgICBlYWNoKHNwbGl0U3RyKHR5cGVzKSwgZnVuY3Rpb24odHlwZSkge1xyXG4gICAgICAgIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIsIGZhbHNlKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogZmluZCBpZiBhIG5vZGUgaXMgaW4gdGhlIGdpdmVuIHBhcmVudFxyXG4gKiBAbWV0aG9kIGhhc1BhcmVudFxyXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBub2RlXHJcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IHBhcmVudFxyXG4gKiBAcmV0dXJuIHtCb29sZWFufSBmb3VuZFxyXG4gKi9cclxuZnVuY3Rpb24gaGFzUGFyZW50KG5vZGUsIHBhcmVudCkge1xyXG4gICAgd2hpbGUgKG5vZGUpIHtcclxuICAgICAgICBpZiAobm9kZSA9PSBwYXJlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG5vZGUgPSBub2RlLnBhcmVudE5vZGU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBzbWFsbCBpbmRleE9mIHdyYXBwZXJcclxuICogQHBhcmFtIHtTdHJpbmd9IHN0clxyXG4gKiBAcGFyYW0ge1N0cmluZ30gZmluZFxyXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gZm91bmRcclxuICovXHJcbmZ1bmN0aW9uIGluU3RyKHN0ciwgZmluZCkge1xyXG4gICAgcmV0dXJuIHN0ci5pbmRleE9mKGZpbmQpID4gLTE7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBzcGxpdCBzdHJpbmcgb24gd2hpdGVzcGFjZVxyXG4gKiBAcGFyYW0ge1N0cmluZ30gc3RyXHJcbiAqIEByZXR1cm5zIHtBcnJheX0gd29yZHNcclxuICovXHJcbmZ1bmN0aW9uIHNwbGl0U3RyKHN0cikge1xyXG4gICAgcmV0dXJuIHN0ci50cmltKCkuc3BsaXQoL1xccysvZyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBmaW5kIGlmIGEgYXJyYXkgY29udGFpbnMgdGhlIG9iamVjdCB1c2luZyBpbmRleE9mIG9yIGEgc2ltcGxlIHBvbHlGaWxsXHJcbiAqIEBwYXJhbSB7QXJyYXl9IHNyY1xyXG4gKiBAcGFyYW0ge1N0cmluZ30gZmluZFxyXG4gKiBAcGFyYW0ge1N0cmluZ30gW2ZpbmRCeUtleV1cclxuICogQHJldHVybiB7Qm9vbGVhbnxOdW1iZXJ9IGZhbHNlIHdoZW4gbm90IGZvdW5kLCBvciB0aGUgaW5kZXhcclxuICovXHJcbmZ1bmN0aW9uIGluQXJyYXkoc3JjLCBmaW5kLCBmaW5kQnlLZXkpIHtcclxuICAgIGlmIChzcmMuaW5kZXhPZiAmJiAhZmluZEJ5S2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIHNyYy5pbmRleE9mKGZpbmQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgd2hpbGUgKGkgPCBzcmMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGlmICgoZmluZEJ5S2V5ICYmIHNyY1tpXVtmaW5kQnlLZXldID09IGZpbmQpIHx8ICghZmluZEJ5S2V5ICYmIHNyY1tpXSA9PT0gZmluZCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgfVxyXG59XHJcblxyXG4vKipcclxuICogY29udmVydCBhcnJheS1saWtlIG9iamVjdHMgdG8gcmVhbCBhcnJheXNcclxuICogQHBhcmFtIHtPYmplY3R9IG9ialxyXG4gKiBAcmV0dXJucyB7QXJyYXl9XHJcbiAqL1xyXG5mdW5jdGlvbiB0b0FycmF5KG9iaikge1xyXG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG9iaiwgMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiB1bmlxdWUgYXJyYXkgd2l0aCBvYmplY3RzIGJhc2VkIG9uIGEga2V5IChsaWtlICdpZCcpIG9yIGp1c3QgYnkgdGhlIGFycmF5J3MgdmFsdWVcclxuICogQHBhcmFtIHtBcnJheX0gc3JjIFt7aWQ6MX0se2lkOjJ9LHtpZDoxfV1cclxuICogQHBhcmFtIHtTdHJpbmd9IFtrZXldXHJcbiAqIEBwYXJhbSB7Qm9vbGVhbn0gW3NvcnQ9RmFsc2VdXHJcbiAqIEByZXR1cm5zIHtBcnJheX0gW3tpZDoxfSx7aWQ6Mn1dXHJcbiAqL1xyXG5mdW5jdGlvbiB1bmlxdWVBcnJheShzcmMsIGtleSwgc29ydCkge1xyXG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcclxuICAgIHZhciB2YWx1ZXMgPSBbXTtcclxuICAgIHZhciBpID0gMDtcclxuXHJcbiAgICB3aGlsZSAoaSA8IHNyYy5sZW5ndGgpIHtcclxuICAgICAgICB2YXIgdmFsID0ga2V5ID8gc3JjW2ldW2tleV0gOiBzcmNbaV07XHJcbiAgICAgICAgaWYgKGluQXJyYXkodmFsdWVzLCB2YWwpIDwgMCkge1xyXG4gICAgICAgICAgICByZXN1bHRzLnB1c2goc3JjW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFsdWVzW2ldID0gdmFsO1xyXG4gICAgICAgIGkrKztcclxuICAgIH1cclxuXHJcbiAgICBpZiAoc29ydCkge1xyXG4gICAgICAgIGlmICgha2V5KSB7XHJcbiAgICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLnNvcnQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5zb3J0KGZ1bmN0aW9uIHNvcnRVbmlxdWVBcnJheShhLCBiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYVtrZXldID4gYltrZXldO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdHM7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBnZXQgdGhlIHByZWZpeGVkIHByb3BlcnR5XHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmpcclxuICogQHBhcmFtIHtTdHJpbmd9IHByb3BlcnR5XHJcbiAqIEByZXR1cm5zIHtTdHJpbmd8VW5kZWZpbmVkfSBwcmVmaXhlZFxyXG4gKi9cclxuZnVuY3Rpb24gcHJlZml4ZWQob2JqLCBwcm9wZXJ0eSkge1xyXG4gICAgdmFyIHByZWZpeCwgcHJvcDtcclxuICAgIHZhciBjYW1lbFByb3AgPSBwcm9wZXJ0eVswXS50b1VwcGVyQ2FzZSgpICsgcHJvcGVydHkuc2xpY2UoMSk7XHJcblxyXG4gICAgdmFyIGkgPSAwO1xyXG4gICAgd2hpbGUgKGkgPCBWRU5ET1JfUFJFRklYRVMubGVuZ3RoKSB7XHJcbiAgICAgICAgcHJlZml4ID0gVkVORE9SX1BSRUZJWEVTW2ldO1xyXG4gICAgICAgIHByb3AgPSAocHJlZml4KSA/IHByZWZpeCArIGNhbWVsUHJvcCA6IHByb3BlcnR5O1xyXG5cclxuICAgICAgICBpZiAocHJvcCBpbiBvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIHByb3A7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGkrKztcclxuICAgIH1cclxuICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBnZXQgYSB1bmlxdWUgaWRcclxuICogQHJldHVybnMge251bWJlcn0gdW5pcXVlSWRcclxuICovXHJcbnZhciBfdW5pcXVlSWQgPSAxO1xyXG5mdW5jdGlvbiB1bmlxdWVJZCgpIHtcclxuICAgIHJldHVybiBfdW5pcXVlSWQrKztcclxufVxyXG5cclxuLyoqXHJcbiAqIGdldCB0aGUgd2luZG93IG9iamVjdCBvZiBhbiBlbGVtZW50XHJcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcclxuICogQHJldHVybnMge0RvY3VtZW50Vmlld3xXaW5kb3d9XHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRXaW5kb3dGb3JFbGVtZW50KGVsZW1lbnQpIHtcclxuICAgIHZhciBkb2MgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQgfHwgZWxlbWVudDtcclxuICAgIHJldHVybiAoZG9jLmRlZmF1bHRWaWV3IHx8IGRvYy5wYXJlbnRXaW5kb3cgfHwgd2luZG93KTtcclxufVxyXG5cclxudmFyIE1PQklMRV9SRUdFWCA9IC9tb2JpbGV8dGFibGV0fGlwKGFkfGhvbmV8b2QpfGFuZHJvaWQvaTtcclxuXHJcbnZhciBTVVBQT1JUX1RPVUNIID0gKCdvbnRvdWNoc3RhcnQnIGluIHdpbmRvdyk7XHJcbi8vIHZhciBTVVBQT1JUX1BPSU5URVJfRVZFTlRTID0gcHJlZml4ZWQod2luZG93LCAnUG9pbnRlckV2ZW50JykgIT09IHVuZGVmaW5lZDtcclxudmFyIFNVUFBPUlRfUE9JTlRFUl9FVkVOVFMgPSBmYWxzZTtcclxudmFyIFNVUFBPUlRfT05MWV9UT1VDSCA9IFNVUFBPUlRfVE9VQ0ggJiYgTU9CSUxFX1JFR0VYLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcblxyXG52YXIgSU5QVVRfVFlQRV9UT1VDSCA9ICd0b3VjaCc7XHJcbnZhciBJTlBVVF9UWVBFX1BFTiA9ICdwZW4nO1xyXG52YXIgSU5QVVRfVFlQRV9NT1VTRSA9ICdtb3VzZSc7XHJcbnZhciBJTlBVVF9UWVBFX0tJTkVDVCA9ICdraW5lY3QnO1xyXG5cclxudmFyIENPTVBVVEVfSU5URVJWQUwgPSAyNTtcclxuXHJcbnZhciBJTlBVVF9TVEFSVCA9IDE7XHJcbnZhciBJTlBVVF9NT1ZFID0gMjtcclxudmFyIElOUFVUX0VORCA9IDQ7XHJcbnZhciBJTlBVVF9DQU5DRUwgPSA4O1xyXG5cclxudmFyIERJUkVDVElPTl9OT05FID0gMTtcclxudmFyIERJUkVDVElPTl9MRUZUID0gMjtcclxudmFyIERJUkVDVElPTl9SSUdIVCA9IDQ7XHJcbnZhciBESVJFQ1RJT05fVVAgPSA4O1xyXG52YXIgRElSRUNUSU9OX0RPV04gPSAxNjtcclxuXHJcbnZhciBESVJFQ1RJT05fSE9SSVpPTlRBTCA9IERJUkVDVElPTl9MRUZUIHwgRElSRUNUSU9OX1JJR0hUO1xyXG52YXIgRElSRUNUSU9OX1ZFUlRJQ0FMID0gRElSRUNUSU9OX1VQIHwgRElSRUNUSU9OX0RPV047XHJcbnZhciBESVJFQ1RJT05fQUxMID0gRElSRUNUSU9OX0hPUklaT05UQUwgfCBESVJFQ1RJT05fVkVSVElDQUw7XHJcblxyXG52YXIgUFJPUFNfWFkgPSBbJ3gnLCAneSddO1xyXG52YXIgUFJPUFNfQ0xJRU5UX1hZID0gWydjbGllbnRYJywgJ2NsaWVudFknXTtcclxuXHJcbi8qKlxyXG4gKiBjcmVhdGUgbmV3IGlucHV0IHR5cGUgbWFuYWdlclxyXG4gKiBAcGFyYW0ge01hbmFnZXJ9IG1hbmFnZXJcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2tcclxuICogQHJldHVybnMge0lucHV0fVxyXG4gKiBAY29uc3RydWN0b3JcclxuICovXHJcbmZ1bmN0aW9uIElucHV0KG1hbmFnZXIsIGNhbGxiYWNrKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyO1xyXG4gICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrO1xyXG4gICAgdGhpcy5lbGVtZW50ID0gbWFuYWdlci5lbGVtZW50O1xyXG4gICAgdGhpcy50YXJnZXQgPSBtYW5hZ2VyLm9wdGlvbnMuaW5wdXRUYXJnZXQ7XHJcblxyXG4gICAgLy8gc21hbGxlciB3cmFwcGVyIGFyb3VuZCB0aGUgaGFuZGxlciwgZm9yIHRoZSBzY29wZSBhbmQgdGhlIGVuYWJsZWQgc3RhdGUgb2YgdGhlIG1hbmFnZXIsXHJcbiAgICAvLyBzbyB3aGVuIGRpc2FibGVkIHRoZSBpbnB1dCBldmVudHMgYXJlIGNvbXBsZXRlbHkgYnlwYXNzZWQuXHJcbiAgICB0aGlzLmRvbUhhbmRsZXIgPSBmdW5jdGlvbihldikge1xyXG4gICAgICAgIGlmIChib29sT3JGbihtYW5hZ2VyLm9wdGlvbnMuZW5hYmxlLCBbbWFuYWdlcl0pKSB7XHJcbiAgICAgICAgICAgIHNlbGYuaGFuZGxlcihldik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmluaXQoKTtcclxuXHJcbn1cclxuXHJcbklucHV0LnByb3RvdHlwZSA9IHtcclxuICAgIC8qKlxyXG4gICAgICogc2hvdWxkIGhhbmRsZSB0aGUgaW5wdXRFdmVudCBkYXRhIGFuZCB0cmlnZ2VyIHRoZSBjYWxsYmFja1xyXG4gICAgICogQHZpcnR1YWxcclxuICAgICAqL1xyXG4gICAgaGFuZGxlcjogZnVuY3Rpb24oKSB7IH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBiaW5kIHRoZSBldmVudHNcclxuICAgICAqL1xyXG4gICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5ldkVsICYmIGFkZEV2ZW50TGlzdGVuZXJzKHRoaXMuZWxlbWVudCwgdGhpcy5ldkVsLCB0aGlzLmRvbUhhbmRsZXIpO1xyXG4gICAgICAgIHRoaXMuZXZUYXJnZXQgJiYgYWRkRXZlbnRMaXN0ZW5lcnModGhpcy50YXJnZXQsIHRoaXMuZXZUYXJnZXQsIHRoaXMuZG9tSGFuZGxlcik7XHJcbiAgICAgICAgdGhpcy5ldldpbiAmJiBhZGRFdmVudExpc3RlbmVycyhnZXRXaW5kb3dGb3JFbGVtZW50KHRoaXMuZWxlbWVudCksIHRoaXMuZXZXaW4sIHRoaXMuZG9tSGFuZGxlcik7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogdW5iaW5kIHRoZSBldmVudHNcclxuICAgICAqL1xyXG4gICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5ldkVsICYmIHJlbW92ZUV2ZW50TGlzdGVuZXJzKHRoaXMuZWxlbWVudCwgdGhpcy5ldkVsLCB0aGlzLmRvbUhhbmRsZXIpO1xyXG4gICAgICAgIHRoaXMuZXZUYXJnZXQgJiYgcmVtb3ZlRXZlbnRMaXN0ZW5lcnModGhpcy50YXJnZXQsIHRoaXMuZXZUYXJnZXQsIHRoaXMuZG9tSGFuZGxlcik7XHJcbiAgICAgICAgdGhpcy5ldldpbiAmJiByZW1vdmVFdmVudExpc3RlbmVycyhnZXRXaW5kb3dGb3JFbGVtZW50KHRoaXMuZWxlbWVudCksIHRoaXMuZXZXaW4sIHRoaXMuZG9tSGFuZGxlcik7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vKipcclxuICogY3JlYXRlIG5ldyBpbnB1dCB0eXBlIG1hbmFnZXJcclxuICogY2FsbGVkIGJ5IHRoZSBNYW5hZ2VyIGNvbnN0cnVjdG9yXHJcbiAqIEBwYXJhbSB7TkdIYW1tZXJ9IG1hbmFnZXJcclxuICogQHJldHVybnMge0lucHV0fVxyXG4gKi9cclxuZnVuY3Rpb24gY3JlYXRlSW5wdXRJbnN0YW5jZShtYW5hZ2VyKSB7XHJcbiAgICB2YXIgVHlwZTtcclxuICAgIHZhciBpbnB1dENsYXNzID0gbWFuYWdlci5vcHRpb25zLmlucHV0Q2xhc3M7XHJcblxyXG4gICAgaWYgKGlucHV0Q2xhc3MpIHtcclxuICAgICAgICBUeXBlID0gaW5wdXRDbGFzcztcclxuICAgIH0gZWxzZSBpZiAoU1VQUE9SVF9QT0lOVEVSX0VWRU5UUykge1xyXG4gICAgICAgIFR5cGUgPSBQb2ludGVyRXZlbnRJbnB1dDtcclxuICAgIH0gZWxzZSBpZiAoU1VQUE9SVF9PTkxZX1RPVUNIKSB7XHJcbiAgICAgICAgVHlwZSA9IFRvdWNoSW5wdXQ7XHJcbiAgICB9IGVsc2UgaWYgKCFTVVBQT1JUX1RPVUNIKSB7XHJcbiAgICAgICAgVHlwZSA9IE1vdXNlSW5wdXQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIFR5cGUgPSBUb3VjaE1vdXNlSW5wdXQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmV3IChUeXBlKShtYW5hZ2VyLCBpbnB1dEhhbmRsZXIpO1xyXG59XHJcblxyXG4vKipcclxuICogaGFuZGxlIGlucHV0IGV2ZW50c1xyXG4gKiBAcGFyYW0ge01hbmFnZXJ9IG1hbmFnZXJcclxuICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50VHlwZVxyXG4gKiBAcGFyYW0ge09iamVjdH0gaW5wdXRcclxuICovXHJcbmZ1bmN0aW9uIGlucHV0SGFuZGxlcihtYW5hZ2VyLCBldmVudFR5cGUsIGlucHV0KSB7XHJcbiAgICB2YXIgcG9pbnRlcnNMZW4gPSBpbnB1dC5wb2ludGVycy5sZW5ndGg7XHJcbiAgICB2YXIgY2hhbmdlZFBvaW50ZXJzTGVuID0gaW5wdXQuY2hhbmdlZFBvaW50ZXJzLmxlbmd0aDtcclxuICAgIHZhciBpc0ZpcnN0ID0gKGV2ZW50VHlwZSAmIElOUFVUX1NUQVJUICYmIChwb2ludGVyc0xlbiAtIGNoYW5nZWRQb2ludGVyc0xlbiA9PT0gMCkpO1xyXG4gICAgdmFyIGlzRmluYWwgPSAoZXZlbnRUeXBlICYgKElOUFVUX0VORCB8IElOUFVUX0NBTkNFTCkgJiYgKHBvaW50ZXJzTGVuIC0gY2hhbmdlZFBvaW50ZXJzTGVuID09PSAwKSk7XHJcblxyXG4gICAgaW5wdXQuaXNGaXJzdCA9ICEhaXNGaXJzdDtcclxuICAgIGlucHV0LmlzRmluYWwgPSAhIWlzRmluYWw7XHJcblxyXG4gICAgaWYgKGlzRmlyc3QpIHtcclxuICAgICAgICBtYW5hZ2VyLnNlc3Npb24gPSB7fTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBzb3VyY2UgZXZlbnQgaXMgdGhlIG5vcm1hbGl6ZWQgdmFsdWUgb2YgdGhlIGRvbUV2ZW50c1xyXG4gICAgLy8gbGlrZSAndG91Y2hzdGFydCwgbW91c2V1cCwgcG9pbnRlcmRvd24nXHJcbiAgICBpbnB1dC5ldmVudFR5cGUgPSBldmVudFR5cGU7XHJcblxyXG4gICAgLy8gY29tcHV0ZSBzY2FsZSwgcm90YXRpb24gZXRjXHJcbiAgICBjb21wdXRlSW5wdXREYXRhKG1hbmFnZXIsIGlucHV0KTtcclxuXHJcbiAgICAvLyBlbWl0IHNlY3JldCBldmVudFxyXG4gICAgbWFuYWdlci5lbWl0KCdoYW1tZXIuaW5wdXQnLCBpbnB1dCk7XHJcblxyXG4gICAgbWFuYWdlci5yZWNvZ25pemUoaW5wdXQpO1xyXG4gICAgbWFuYWdlci5zZXNzaW9uLnByZXZJbnB1dCA9IGlucHV0O1xyXG59XHJcblxyXG4vKipcclxuICogZXh0ZW5kIHRoZSBkYXRhIHdpdGggc29tZSB1c2FibGUgcHJvcGVydGllcyBsaWtlIHNjYWxlLCByb3RhdGUsIHZlbG9jaXR5IGV0Y1xyXG4gKiBAcGFyYW0ge09iamVjdH0gbWFuYWdlclxyXG4gKiBAcGFyYW0ge09iamVjdH0gaW5wdXRcclxuICovXHJcbmZ1bmN0aW9uIGNvbXB1dGVJbnB1dERhdGEobWFuYWdlciwgaW5wdXQpIHtcclxuICAgIHZhciBzZXNzaW9uID0gbWFuYWdlci5zZXNzaW9uO1xyXG4gICAgdmFyIHBvaW50ZXJzID0gaW5wdXQucG9pbnRlcnM7XHJcbiAgICB2YXIgcG9pbnRlcnNMZW5ndGggPSBwb2ludGVycy5sZW5ndGg7XHJcblxyXG4gICAgLy8gc3RvcmUgdGhlIGZpcnN0IGlucHV0IHRvIGNhbGN1bGF0ZSB0aGUgZGlzdGFuY2UgYW5kIGRpcmVjdGlvblxyXG4gICAgaWYgKCFzZXNzaW9uLmZpcnN0SW5wdXQpIHtcclxuICAgICAgICBzZXNzaW9uLmZpcnN0SW5wdXQgPSBzaW1wbGVDbG9uZUlucHV0RGF0YShpbnB1dCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gdG8gY29tcHV0ZSBzY2FsZSBhbmQgcm90YXRpb24gd2UgbmVlZCB0byBzdG9yZSB0aGUgbXVsdGlwbGUgdG91Y2hlc1xyXG4gICAgaWYgKHBvaW50ZXJzTGVuZ3RoID4gMSAmJiAhc2Vzc2lvbi5maXJzdE11bHRpcGxlKSB7XHJcbiAgICAgICAgc2Vzc2lvbi5maXJzdE11bHRpcGxlID0gc2ltcGxlQ2xvbmVJbnB1dERhdGEoaW5wdXQpO1xyXG4gICAgfSBlbHNlIGlmIChwb2ludGVyc0xlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgIHNlc3Npb24uZmlyc3RNdWx0aXBsZSA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBmaXJzdElucHV0ID0gc2Vzc2lvbi5maXJzdElucHV0O1xyXG4gICAgdmFyIGZpcnN0TXVsdGlwbGUgPSBzZXNzaW9uLmZpcnN0TXVsdGlwbGU7XHJcbiAgICB2YXIgb2Zmc2V0Q2VudGVyID0gZmlyc3RNdWx0aXBsZSA/IGZpcnN0TXVsdGlwbGUuY2VudGVyIDogZmlyc3RJbnB1dC5jZW50ZXI7XHJcblxyXG4gICAgdmFyIGNlbnRlciA9IGlucHV0LmNlbnRlciA9IGdldENlbnRlcihwb2ludGVycyk7XHJcbiAgICBpbnB1dC50aW1lU3RhbXAgPSBub3coKTtcclxuICAgIGlucHV0LmRlbHRhVGltZSA9IGlucHV0LnRpbWVTdGFtcCAtIGZpcnN0SW5wdXQudGltZVN0YW1wO1xyXG5cclxuICAgIGlucHV0LmFuZ2xlID0gZ2V0QW5nbGUob2Zmc2V0Q2VudGVyLCBjZW50ZXIpO1xyXG4gICAgaW5wdXQuZGlzdGFuY2UgPSBnZXREaXN0YW5jZShvZmZzZXRDZW50ZXIsIGNlbnRlcik7XHJcblxyXG4gICAgY29tcHV0ZURlbHRhWFkoc2Vzc2lvbiwgaW5wdXQpO1xyXG4gICAgaW5wdXQub2Zmc2V0RGlyZWN0aW9uID0gZ2V0RGlyZWN0aW9uKGlucHV0LmRlbHRhWCwgaW5wdXQuZGVsdGFZKTtcclxuXHJcbiAgICB2YXIgb3ZlcmFsbFZlbG9jaXR5ID0gZ2V0VmVsb2NpdHkoaW5wdXQuZGVsdGFUaW1lLCBpbnB1dC5kZWx0YVgsIGlucHV0LmRlbHRhWSk7XHJcbiAgICBpbnB1dC5vdmVyYWxsVmVsb2NpdHlYID0gb3ZlcmFsbFZlbG9jaXR5Lng7XHJcbiAgICBpbnB1dC5vdmVyYWxsVmVsb2NpdHlZID0gb3ZlcmFsbFZlbG9jaXR5Lnk7XHJcbiAgICBpbnB1dC5vdmVyYWxsVmVsb2NpdHkgPSAoYWJzKG92ZXJhbGxWZWxvY2l0eS54KSA+IGFicyhvdmVyYWxsVmVsb2NpdHkueSkpID8gb3ZlcmFsbFZlbG9jaXR5LnggOiBvdmVyYWxsVmVsb2NpdHkueTtcclxuXHJcbiAgICBpbnB1dC5zY2FsZSA9IGZpcnN0TXVsdGlwbGUgPyBnZXRTY2FsZShmaXJzdE11bHRpcGxlLnBvaW50ZXJzLCBwb2ludGVycykgOiAxO1xyXG4gICAgaW5wdXQucm90YXRpb24gPSBmaXJzdE11bHRpcGxlID8gZ2V0Um90YXRpb24oZmlyc3RNdWx0aXBsZS5wb2ludGVycywgcG9pbnRlcnMpIDogMDtcclxuXHJcbiAgICBpbnB1dC5tYXhQb2ludGVycyA9ICFzZXNzaW9uLnByZXZJbnB1dCA/IGlucHV0LnBvaW50ZXJzLmxlbmd0aCA6ICgoaW5wdXQucG9pbnRlcnMubGVuZ3RoID5cclxuICAgICAgICBzZXNzaW9uLnByZXZJbnB1dC5tYXhQb2ludGVycykgPyBpbnB1dC5wb2ludGVycy5sZW5ndGggOiBzZXNzaW9uLnByZXZJbnB1dC5tYXhQb2ludGVycyk7XHJcblxyXG4gICAgY29tcHV0ZUludGVydmFsSW5wdXREYXRhKHNlc3Npb24sIGlucHV0KTtcclxuXHJcbiAgICAvLyBmaW5kIHRoZSBjb3JyZWN0IHRhcmdldFxyXG4gICAgdmFyIHRhcmdldCA9IG1hbmFnZXIuZWxlbWVudDtcclxuICAgIGlmIChoYXNQYXJlbnQoaW5wdXQuc3JjRXZlbnQudGFyZ2V0LCB0YXJnZXQpKSB7XHJcbiAgICAgICAgdGFyZ2V0ID0gaW5wdXQuc3JjRXZlbnQudGFyZ2V0O1xyXG4gICAgfVxyXG4gICAgaW5wdXQudGFyZ2V0ID0gdGFyZ2V0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb21wdXRlRGVsdGFYWShzZXNzaW9uLCBpbnB1dCkge1xyXG4gICAgdmFyIGNlbnRlciA9IGlucHV0LmNlbnRlcjtcclxuICAgIHZhciBvZmZzZXQgPSBzZXNzaW9uLm9mZnNldERlbHRhIHx8IHt9O1xyXG4gICAgdmFyIHByZXZEZWx0YSA9IHNlc3Npb24ucHJldkRlbHRhIHx8IHt9O1xyXG4gICAgdmFyIHByZXZJbnB1dCA9IHNlc3Npb24ucHJldklucHV0IHx8IHt9O1xyXG5cclxuICAgIGlmIChpbnB1dC5ldmVudFR5cGUgPT09IElOUFVUX1NUQVJUIHx8IHByZXZJbnB1dC5ldmVudFR5cGUgPT09IElOUFVUX0VORCkge1xyXG4gICAgICAgIHByZXZEZWx0YSA9IHNlc3Npb24ucHJldkRlbHRhID0ge1xyXG4gICAgICAgICAgICB4OiBwcmV2SW5wdXQuZGVsdGFYIHx8IDAsXHJcbiAgICAgICAgICAgIHk6IHByZXZJbnB1dC5kZWx0YVkgfHwgMFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIG9mZnNldCA9IHNlc3Npb24ub2Zmc2V0RGVsdGEgPSB7XHJcbiAgICAgICAgICAgIHg6IGNlbnRlci54LFxyXG4gICAgICAgICAgICB5OiBjZW50ZXIueVxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaW5wdXQuZGVsdGFYID0gcHJldkRlbHRhLnggKyAoY2VudGVyLnggLSBvZmZzZXQueCk7XHJcbiAgICBpbnB1dC5kZWx0YVkgPSBwcmV2RGVsdGEueSArIChjZW50ZXIueSAtIG9mZnNldC55KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIHZlbG9jaXR5IGlzIGNhbGN1bGF0ZWQgZXZlcnkgeCBtc1xyXG4gKiBAcGFyYW0ge09iamVjdH0gc2Vzc2lvblxyXG4gKiBAcGFyYW0ge09iamVjdH0gaW5wdXRcclxuICovXHJcbmZ1bmN0aW9uIGNvbXB1dGVJbnRlcnZhbElucHV0RGF0YShzZXNzaW9uLCBpbnB1dCkge1xyXG4gICAgdmFyIGxhc3QgPSBzZXNzaW9uLmxhc3RJbnRlcnZhbCB8fCBpbnB1dCxcclxuICAgICAgICBkZWx0YVRpbWUgPSBpbnB1dC50aW1lU3RhbXAgLSBsYXN0LnRpbWVTdGFtcCxcclxuICAgICAgICB2ZWxvY2l0eSwgdmVsb2NpdHlYLCB2ZWxvY2l0eVksIGRpcmVjdGlvbjtcclxuXHJcbiAgICBpZiAoaW5wdXQuZXZlbnRUeXBlICE9IElOUFVUX0NBTkNFTCAmJiAoZGVsdGFUaW1lID4gQ09NUFVURV9JTlRFUlZBTCB8fCBsYXN0LnZlbG9jaXR5ID09PSB1bmRlZmluZWQpKSB7XHJcbiAgICAgICAgdmFyIGRlbHRhWCA9IGlucHV0LmRlbHRhWCAtIGxhc3QuZGVsdGFYO1xyXG4gICAgICAgIHZhciBkZWx0YVkgPSBpbnB1dC5kZWx0YVkgLSBsYXN0LmRlbHRhWTtcclxuXHJcbiAgICAgICAgdmFyIHYgPSBnZXRWZWxvY2l0eShkZWx0YVRpbWUsIGRlbHRhWCwgZGVsdGFZKTtcclxuICAgICAgICB2ZWxvY2l0eVggPSB2Lng7XHJcbiAgICAgICAgdmVsb2NpdHlZID0gdi55O1xyXG4gICAgICAgIHZlbG9jaXR5ID0gKGFicyh2LngpID4gYWJzKHYueSkpID8gdi54IDogdi55O1xyXG4gICAgICAgIGRpcmVjdGlvbiA9IGdldERpcmVjdGlvbihkZWx0YVgsIGRlbHRhWSk7XHJcblxyXG4gICAgICAgIHNlc3Npb24ubGFzdEludGVydmFsID0gaW5wdXQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIHVzZSBsYXRlc3QgdmVsb2NpdHkgaW5mbyBpZiBpdCBkb2Vzbid0IG92ZXJ0YWtlIGEgbWluaW11bSBwZXJpb2RcclxuICAgICAgICB2ZWxvY2l0eSA9IGxhc3QudmVsb2NpdHk7XHJcbiAgICAgICAgdmVsb2NpdHlYID0gbGFzdC52ZWxvY2l0eVg7XHJcbiAgICAgICAgdmVsb2NpdHlZID0gbGFzdC52ZWxvY2l0eVk7XHJcbiAgICAgICAgZGlyZWN0aW9uID0gbGFzdC5kaXJlY3Rpb247XHJcbiAgICB9XHJcblxyXG4gICAgaW5wdXQudmVsb2NpdHkgPSB2ZWxvY2l0eTtcclxuICAgIGlucHV0LnZlbG9jaXR5WCA9IHZlbG9jaXR5WDtcclxuICAgIGlucHV0LnZlbG9jaXR5WSA9IHZlbG9jaXR5WTtcclxuICAgIGlucHV0LmRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcclxufVxyXG5cclxuLyoqXHJcbiAqIGNyZWF0ZSBhIHNpbXBsZSBjbG9uZSBmcm9tIHRoZSBpbnB1dCB1c2VkIGZvciBzdG9yYWdlIG9mIGZpcnN0SW5wdXQgYW5kIGZpcnN0TXVsdGlwbGVcclxuICogQHBhcmFtIHtPYmplY3R9IGlucHV0XHJcbiAqIEByZXR1cm5zIHtPYmplY3R9IGNsb25lZElucHV0RGF0YVxyXG4gKi9cclxuZnVuY3Rpb24gc2ltcGxlQ2xvbmVJbnB1dERhdGEoaW5wdXQpIHtcclxuICAgIC8vIG1ha2UgYSBzaW1wbGUgY29weSBvZiB0aGUgcG9pbnRlcnMgYmVjYXVzZSB3ZSB3aWxsIGdldCBhIHJlZmVyZW5jZSBpZiB3ZSBkb24ndFxyXG4gICAgLy8gd2Ugb25seSBuZWVkIGNsaWVudFhZIGZvciB0aGUgY2FsY3VsYXRpb25zXHJcbiAgICB2YXIgcG9pbnRlcnMgPSBbXTtcclxuICAgIHZhciBpID0gMDtcclxuICAgIHdoaWxlIChpIDwgaW5wdXQucG9pbnRlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgcG9pbnRlcnNbaV0gPSB7XHJcbiAgICAgICAgICAgIGNsaWVudFg6IHJvdW5kKGlucHV0LnBvaW50ZXJzW2ldLmNsaWVudFgpLFxyXG4gICAgICAgICAgICBjbGllbnRZOiByb3VuZChpbnB1dC5wb2ludGVyc1tpXS5jbGllbnRZKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaSsrO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdGltZVN0YW1wOiBub3coKSxcclxuICAgICAgICBwb2ludGVyczogcG9pbnRlcnMsXHJcbiAgICAgICAgY2VudGVyOiBnZXRDZW50ZXIocG9pbnRlcnMpLFxyXG4gICAgICAgIGRlbHRhWDogaW5wdXQuZGVsdGFYLFxyXG4gICAgICAgIGRlbHRhWTogaW5wdXQuZGVsdGFZXHJcbiAgICB9O1xyXG59XHJcblxyXG4vKipcclxuICogZ2V0IHRoZSBjZW50ZXIgb2YgYWxsIHRoZSBwb2ludGVyc1xyXG4gKiBAcGFyYW0ge0FycmF5fSBwb2ludGVyc1xyXG4gKiBAcmV0dXJuIHtPYmplY3R9IGNlbnRlciBjb250YWlucyBgeGAgYW5kIGB5YCBwcm9wZXJ0aWVzXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRDZW50ZXIocG9pbnRlcnMpIHtcclxuICAgIHZhciBwb2ludGVyc0xlbmd0aCA9IHBvaW50ZXJzLmxlbmd0aDtcclxuXHJcbiAgICAvLyBubyBuZWVkIHRvIGxvb3Agd2hlbiBvbmx5IG9uZSB0b3VjaFxyXG4gICAgaWYgKHBvaW50ZXJzTGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgeDogcm91bmQocG9pbnRlcnNbMF0uY2xpZW50WCksXHJcbiAgICAgICAgICAgIHk6IHJvdW5kKHBvaW50ZXJzWzBdLmNsaWVudFkpXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgeCA9IDAsIHkgPSAwLCBpID0gMDtcclxuICAgIHdoaWxlIChpIDwgcG9pbnRlcnNMZW5ndGgpIHtcclxuICAgICAgICB4ICs9IHBvaW50ZXJzW2ldLmNsaWVudFg7XHJcbiAgICAgICAgeSArPSBwb2ludGVyc1tpXS5jbGllbnRZO1xyXG4gICAgICAgIGkrKztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHg6IHJvdW5kKHggLyBwb2ludGVyc0xlbmd0aCksXHJcbiAgICAgICAgeTogcm91bmQoeSAvIHBvaW50ZXJzTGVuZ3RoKVxyXG4gICAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGNhbGN1bGF0ZSB0aGUgdmVsb2NpdHkgYmV0d2VlbiB0d28gcG9pbnRzLiB1bml0IGlzIGluIHB4IHBlciBtcy5cclxuICogQHBhcmFtIHtOdW1iZXJ9IGRlbHRhVGltZVxyXG4gKiBAcGFyYW0ge051bWJlcn0geFxyXG4gKiBAcGFyYW0ge051bWJlcn0geVxyXG4gKiBAcmV0dXJuIHtPYmplY3R9IHZlbG9jaXR5IGB4YCBhbmQgYHlgXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRWZWxvY2l0eShkZWx0YVRpbWUsIHgsIHkpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgeDogeCAvIGRlbHRhVGltZSB8fCAwLFxyXG4gICAgICAgIHk6IHkgLyBkZWx0YVRpbWUgfHwgMFxyXG4gICAgfTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGdldCB0aGUgZGlyZWN0aW9uIGJldHdlZW4gdHdvIHBvaW50c1xyXG4gKiBAcGFyYW0ge051bWJlcn0geFxyXG4gKiBAcGFyYW0ge051bWJlcn0geVxyXG4gKiBAcmV0dXJuIHtOdW1iZXJ9IGRpcmVjdGlvblxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0RGlyZWN0aW9uKHgsIHkpIHtcclxuICAgIGlmICh4ID09PSB5KSB7XHJcbiAgICAgICAgcmV0dXJuIERJUkVDVElPTl9OT05FO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhYnMoeCkgPj0gYWJzKHkpKSB7XHJcbiAgICAgICAgcmV0dXJuIHggPCAwID8gRElSRUNUSU9OX0xFRlQgOiBESVJFQ1RJT05fUklHSFQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4geSA8IDAgPyBESVJFQ1RJT05fVVAgOiBESVJFQ1RJT05fRE9XTjtcclxufVxyXG5cclxuLyoqXHJcbiAqIGNhbGN1bGF0ZSB0aGUgYWJzb2x1dGUgZGlzdGFuY2UgYmV0d2VlbiB0d28gcG9pbnRzXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBwMSB7eCwgeX1cclxuICogQHBhcmFtIHtPYmplY3R9IHAyIHt4LCB5fVxyXG4gKiBAcGFyYW0ge0FycmF5fSBbcHJvcHNdIGNvbnRhaW5pbmcgeCBhbmQgeSBrZXlzXHJcbiAqIEByZXR1cm4ge051bWJlcn0gZGlzdGFuY2VcclxuICovXHJcbmZ1bmN0aW9uIGdldERpc3RhbmNlKHAxLCBwMiwgcHJvcHMpIHtcclxuICAgIGlmICghcHJvcHMpIHtcclxuICAgICAgICBwcm9wcyA9IFBST1BTX1hZO1xyXG4gICAgfVxyXG4gICAgdmFyIHggPSBwMltwcm9wc1swXV0gLSBwMVtwcm9wc1swXV0sXHJcbiAgICAgICAgeSA9IHAyW3Byb3BzWzFdXSAtIHAxW3Byb3BzWzFdXTtcclxuXHJcbiAgICByZXR1cm4gTWF0aC5zcXJ0KCh4ICogeCkgKyAoeSAqIHkpKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGNhbGN1bGF0ZSB0aGUgYW5nbGUgYmV0d2VlbiB0d28gY29vcmRpbmF0ZXNcclxuICogQHBhcmFtIHtPYmplY3R9IHAxXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBwMlxyXG4gKiBAcGFyYW0ge0FycmF5fSBbcHJvcHNdIGNvbnRhaW5pbmcgeCBhbmQgeSBrZXlzXHJcbiAqIEByZXR1cm4ge051bWJlcn0gYW5nbGVcclxuICovXHJcbmZ1bmN0aW9uIGdldEFuZ2xlKHAxLCBwMiwgcHJvcHMpIHtcclxuICAgIGlmICghcHJvcHMpIHtcclxuICAgICAgICBwcm9wcyA9IFBST1BTX1hZO1xyXG4gICAgfVxyXG4gICAgdmFyIHggPSBwMltwcm9wc1swXV0gLSBwMVtwcm9wc1swXV0sXHJcbiAgICAgICAgeSA9IHAyW3Byb3BzWzFdXSAtIHAxW3Byb3BzWzFdXTtcclxuICAgIHJldHVybiBNYXRoLmF0YW4yKHksIHgpICogMTgwIC8gTWF0aC5QSTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGNhbGN1bGF0ZSB0aGUgcm90YXRpb24gZGVncmVlcyBiZXR3ZWVuIHR3byBwb2ludGVyc2V0c1xyXG4gKiBAcGFyYW0ge0FycmF5fSBzdGFydCBhcnJheSBvZiBwb2ludGVyc1xyXG4gKiBAcGFyYW0ge0FycmF5fSBlbmQgYXJyYXkgb2YgcG9pbnRlcnNcclxuICogQHJldHVybiB7TnVtYmVyfSByb3RhdGlvblxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0Um90YXRpb24oc3RhcnQsIGVuZCkge1xyXG4gICAgcmV0dXJuIGdldEFuZ2xlKGVuZFsxXSwgZW5kWzBdLCBQUk9QU19DTElFTlRfWFkpICsgZ2V0QW5nbGUoc3RhcnRbMV0sIHN0YXJ0WzBdLCBQUk9QU19DTElFTlRfWFkpO1xyXG59XHJcblxyXG4vKipcclxuICogY2FsY3VsYXRlIHRoZSBzY2FsZSBmYWN0b3IgYmV0d2VlbiB0d28gcG9pbnRlcnNldHNcclxuICogbm8gc2NhbGUgaXMgMSwgYW5kIGdvZXMgZG93biB0byAwIHdoZW4gcGluY2hlZCB0b2dldGhlciwgYW5kIGJpZ2dlciB3aGVuIHBpbmNoZWQgb3V0XHJcbiAqIEBwYXJhbSB7QXJyYXl9IHN0YXJ0IGFycmF5IG9mIHBvaW50ZXJzXHJcbiAqIEBwYXJhbSB7QXJyYXl9IGVuZCBhcnJheSBvZiBwb2ludGVyc1xyXG4gKiBAcmV0dXJuIHtOdW1iZXJ9IHNjYWxlXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRTY2FsZShzdGFydCwgZW5kKSB7XHJcbiAgICByZXR1cm4gZ2V0RGlzdGFuY2UoZW5kWzBdLCBlbmRbMV0sIFBST1BTX0NMSUVOVF9YWSkgLyBnZXREaXN0YW5jZShzdGFydFswXSwgc3RhcnRbMV0sIFBST1BTX0NMSUVOVF9YWSk7XHJcbn1cclxuXHJcbnZhciBNT1VTRV9JTlBVVF9NQVAgPSB7XHJcbiAgICBtb3VzZWRvd246IElOUFVUX1NUQVJULFxyXG4gICAgbW91c2Vtb3ZlOiBJTlBVVF9NT1ZFLFxyXG4gICAgbW91c2V1cDogSU5QVVRfRU5EXHJcbn07XHJcblxyXG52YXIgTU9VU0VfRUxFTUVOVF9FVkVOVFMgPSAnbW91c2Vkb3duJztcclxudmFyIE1PVVNFX1dJTkRPV19FVkVOVFMgPSAnbW91c2Vtb3ZlIG1vdXNldXAnO1xyXG5cclxuLyoqXHJcbiAqIE1vdXNlIGV2ZW50cyBpbnB1dFxyXG4gKiBAY29uc3RydWN0b3JcclxuICogQGV4dGVuZHMgSW5wdXRcclxuICovXHJcbmZ1bmN0aW9uIE1vdXNlSW5wdXQoKSB7XHJcbiAgICB0aGlzLmV2RWwgPSBNT1VTRV9FTEVNRU5UX0VWRU5UUztcclxuICAgIHRoaXMuZXZXaW4gPSBNT1VTRV9XSU5ET1dfRVZFTlRTO1xyXG5cclxuICAgIHRoaXMucHJlc3NlZCA9IGZhbHNlOyAvLyBtb3VzZWRvd24gc3RhdGVcclxuXHJcbiAgICBJbnB1dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59XHJcblxyXG5pbmhlcml0KE1vdXNlSW5wdXQsIElucHV0LCB7XHJcbiAgICAvKipcclxuICAgICAqIGhhbmRsZSBtb3VzZSBldmVudHNcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldlxyXG4gICAgICovXHJcbiAgICBoYW5kbGVyOiBmdW5jdGlvbiBNRWhhbmRsZXIoZXYpIHtcclxuICAgICAgICB2YXIgZXZlbnRUeXBlID0gTU9VU0VfSU5QVVRfTUFQW2V2LnR5cGVdO1xyXG5cclxuICAgICAgICAvLyBvbiBzdGFydCB3ZSB3YW50IHRvIGhhdmUgdGhlIGxlZnQgbW91c2UgYnV0dG9uIGRvd25cclxuICAgICAgICBpZiAoZXZlbnRUeXBlICYgSU5QVVRfU1RBUlQgJiYgZXYuYnV0dG9uID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJlc3NlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXZlbnRUeXBlICYgSU5QVVRfTU9WRSAmJiBldi53aGljaCAhPT0gMSkge1xyXG4gICAgICAgICAgICBldmVudFR5cGUgPSBJTlBVVF9FTkQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBtb3VzZSBtdXN0IGJlIGRvd25cclxuICAgICAgICBpZiAoIXRoaXMucHJlc3NlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZXZlbnRUeXBlICYgSU5QVVRfRU5EKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJlc3NlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jYWxsYmFjayh0aGlzLm1hbmFnZXIsIGV2ZW50VHlwZSwge1xyXG4gICAgICAgICAgICBwb2ludGVyczogW2V2XSxcclxuICAgICAgICAgICAgY2hhbmdlZFBvaW50ZXJzOiBbZXZdLFxyXG4gICAgICAgICAgICBwb2ludGVyVHlwZTogSU5QVVRfVFlQRV9NT1VTRSxcclxuICAgICAgICAgICAgc3JjRXZlbnQ6IGV2XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxudmFyIFBPSU5URVJfSU5QVVRfTUFQID0ge1xyXG4gICAgcG9pbnRlcmRvd246IElOUFVUX1NUQVJULFxyXG4gICAgcG9pbnRlcm1vdmU6IElOUFVUX01PVkUsXHJcbiAgICBwb2ludGVydXA6IElOUFVUX0VORCxcclxuICAgIHBvaW50ZXJjYW5jZWw6IElOUFVUX0NBTkNFTCxcclxuICAgIHBvaW50ZXJvdXQ6IElOUFVUX0NBTkNFTFxyXG59O1xyXG5cclxuLy8gaW4gSUUxMCB0aGUgcG9pbnRlciB0eXBlcyBpcyBkZWZpbmVkIGFzIGFuIGVudW1cclxudmFyIElFMTBfUE9JTlRFUl9UWVBFX0VOVU0gPSB7XHJcbiAgICAyOiBJTlBVVF9UWVBFX1RPVUNILFxyXG4gICAgMzogSU5QVVRfVFlQRV9QRU4sXHJcbiAgICA0OiBJTlBVVF9UWVBFX01PVVNFLFxyXG4gICAgNTogSU5QVVRfVFlQRV9LSU5FQ1QgLy8gc2VlIGh0dHBzOi8vdHdpdHRlci5jb20vamFjb2Jyb3NzaS9zdGF0dXMvNDgwNTk2NDM4NDg5ODkwODE2XHJcbn07XHJcblxyXG52YXIgUE9JTlRFUl9FTEVNRU5UX0VWRU5UUyA9ICdwb2ludGVyZG93bic7XHJcbnZhciBQT0lOVEVSX1dJTkRPV19FVkVOVFMgPSAncG9pbnRlcm1vdmUgcG9pbnRlcnVwIHBvaW50ZXJjYW5jZWwnO1xyXG5cclxuLy8gSUUxMCBoYXMgcHJlZml4ZWQgc3VwcG9ydCwgYW5kIGNhc2Utc2Vuc2l0aXZlXHJcbmlmICh3aW5kb3cuTVNQb2ludGVyRXZlbnQgJiYgIXdpbmRvdy5Qb2ludGVyRXZlbnQpIHtcclxuICAgIFBPSU5URVJfRUxFTUVOVF9FVkVOVFMgPSAnTVNQb2ludGVyRG93bic7XHJcbiAgICBQT0lOVEVSX1dJTkRPV19FVkVOVFMgPSAnTVNQb2ludGVyTW92ZSBNU1BvaW50ZXJVcCBNU1BvaW50ZXJDYW5jZWwnO1xyXG59XHJcblxyXG4vKipcclxuICogUG9pbnRlciBldmVudHMgaW5wdXRcclxuICogQGNvbnN0cnVjdG9yXHJcbiAqIEBleHRlbmRzIElucHV0XHJcbiAqL1xyXG5mdW5jdGlvbiBQb2ludGVyRXZlbnRJbnB1dCgpIHtcclxuICAgIHRoaXMuZXZFbCA9IFBPSU5URVJfRUxFTUVOVF9FVkVOVFM7XHJcbiAgICB0aGlzLmV2V2luID0gUE9JTlRFUl9XSU5ET1dfRVZFTlRTO1xyXG5cclxuICAgIElucHV0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblxyXG4gICAgdGhpcy5zdG9yZSA9ICh0aGlzLm1hbmFnZXIuc2Vzc2lvbi5wb2ludGVyRXZlbnRzID0gW10pO1xyXG59XHJcblxyXG5pbmhlcml0KFBvaW50ZXJFdmVudElucHV0LCBJbnB1dCwge1xyXG4gICAgLyoqXHJcbiAgICAgKiBoYW5kbGUgbW91c2UgZXZlbnRzXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZcclxuICAgICAqL1xyXG4gICAgaGFuZGxlcjogZnVuY3Rpb24gUEVoYW5kbGVyKGV2KSB7XHJcbiAgICAgICAgdmFyIHN0b3JlID0gdGhpcy5zdG9yZTtcclxuICAgICAgICB2YXIgcmVtb3ZlUG9pbnRlciA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2YXIgZXZlbnRUeXBlTm9ybWFsaXplZCA9IGV2LnR5cGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCdtcycsICcnKTtcclxuICAgICAgICB2YXIgZXZlbnRUeXBlID0gUE9JTlRFUl9JTlBVVF9NQVBbZXZlbnRUeXBlTm9ybWFsaXplZF07XHJcbiAgICAgICAgdmFyIHBvaW50ZXJUeXBlID0gSUUxMF9QT0lOVEVSX1RZUEVfRU5VTVtldi5wb2ludGVyVHlwZV0gfHwgZXYucG9pbnRlclR5cGU7XHJcblxyXG4gICAgICAgIHZhciBpc1RvdWNoID0gKHBvaW50ZXJUeXBlID09IElOUFVUX1RZUEVfVE9VQ0gpO1xyXG5cclxuICAgICAgICAvLyBnZXQgaW5kZXggb2YgdGhlIGV2ZW50IGluIHRoZSBzdG9yZVxyXG4gICAgICAgIHZhciBzdG9yZUluZGV4ID0gaW5BcnJheShzdG9yZSwgZXYucG9pbnRlcklkLCAncG9pbnRlcklkJyk7XHJcblxyXG4gICAgICAgIC8vIHN0YXJ0IGFuZCBtb3VzZSBtdXN0IGJlIGRvd25cclxuICAgICAgICBpZiAoZXZlbnRUeXBlICYgSU5QVVRfU1RBUlQgJiYgKGV2LmJ1dHRvbiA9PT0gMCB8fCBpc1RvdWNoKSkge1xyXG4gICAgICAgICAgICBpZiAoc3RvcmVJbmRleCA8IDApIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlLnB1c2goZXYpO1xyXG4gICAgICAgICAgICAgICAgc3RvcmVJbmRleCA9IHN0b3JlLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50VHlwZSAmIChJTlBVVF9FTkQgfCBJTlBVVF9DQU5DRUwpKSB7XHJcbiAgICAgICAgICAgIHJlbW92ZVBvaW50ZXIgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gaXQgbm90IGZvdW5kLCBzbyB0aGUgcG9pbnRlciBoYXNuJ3QgYmVlbiBkb3duIChzbyBpdCdzIHByb2JhYmx5IGEgaG92ZXIpXHJcbiAgICAgICAgaWYgKHN0b3JlSW5kZXggPCAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHVwZGF0ZSB0aGUgZXZlbnQgaW4gdGhlIHN0b3JlXHJcbiAgICAgICAgc3RvcmVbc3RvcmVJbmRleF0gPSBldjtcclxuXHJcbiAgICAgICAgdGhpcy5jYWxsYmFjayh0aGlzLm1hbmFnZXIsIGV2ZW50VHlwZSwge1xyXG4gICAgICAgICAgICBwb2ludGVyczogc3RvcmUsXHJcbiAgICAgICAgICAgIGNoYW5nZWRQb2ludGVyczogW2V2XSxcclxuICAgICAgICAgICAgcG9pbnRlclR5cGU6IHBvaW50ZXJUeXBlLFxyXG4gICAgICAgICAgICBzcmNFdmVudDogZXZcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKHJlbW92ZVBvaW50ZXIpIHtcclxuICAgICAgICAgICAgLy8gcmVtb3ZlIGZyb20gdGhlIHN0b3JlXHJcbiAgICAgICAgICAgIHN0b3JlLnNwbGljZShzdG9yZUluZGV4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pO1xyXG5cclxudmFyIFNJTkdMRV9UT1VDSF9JTlBVVF9NQVAgPSB7XHJcbiAgICB0b3VjaHN0YXJ0OiBJTlBVVF9TVEFSVCxcclxuICAgIHRvdWNobW92ZTogSU5QVVRfTU9WRSxcclxuICAgIHRvdWNoZW5kOiBJTlBVVF9FTkQsXHJcbiAgICB0b3VjaGNhbmNlbDogSU5QVVRfQ0FOQ0VMXHJcbn07XHJcblxyXG52YXIgU0lOR0xFX1RPVUNIX1RBUkdFVF9FVkVOVFMgPSAndG91Y2hzdGFydCc7XHJcbnZhciBTSU5HTEVfVE9VQ0hfV0lORE9XX0VWRU5UUyA9ICd0b3VjaHN0YXJ0IHRvdWNobW92ZSB0b3VjaGVuZCB0b3VjaGNhbmNlbCc7XHJcblxyXG4vKipcclxuICogVG91Y2ggZXZlbnRzIGlucHV0XHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKiBAZXh0ZW5kcyBJbnB1dFxyXG4gKi9cclxuZnVuY3Rpb24gU2luZ2xlVG91Y2hJbnB1dCgpIHtcclxuICAgIHRoaXMuZXZUYXJnZXQgPSBTSU5HTEVfVE9VQ0hfVEFSR0VUX0VWRU5UUztcclxuICAgIHRoaXMuZXZXaW4gPSBTSU5HTEVfVE9VQ0hfV0lORE9XX0VWRU5UUztcclxuICAgIHRoaXMuc3RhcnRlZCA9IGZhbHNlO1xyXG5cclxuICAgIElucHV0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmluaGVyaXQoU2luZ2xlVG91Y2hJbnB1dCwgSW5wdXQsIHtcclxuICAgIGhhbmRsZXI6IGZ1bmN0aW9uIFRFaGFuZGxlcihldikge1xyXG4gICAgICAgIHZhciB0eXBlID0gU0lOR0xFX1RPVUNIX0lOUFVUX01BUFtldi50eXBlXTtcclxuXHJcbiAgICAgICAgLy8gc2hvdWxkIHdlIGhhbmRsZSB0aGUgdG91Y2ggZXZlbnRzP1xyXG4gICAgICAgIGlmICh0eXBlID09PSBJTlBVVF9TVEFSVCkge1xyXG4gICAgICAgICAgICB0aGlzLnN0YXJ0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLnN0YXJ0ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHRvdWNoZXMgPSBub3JtYWxpemVTaW5nbGVUb3VjaGVzLmNhbGwodGhpcywgZXYsIHR5cGUpO1xyXG5cclxuICAgICAgICAvLyB3aGVuIGRvbmUsIHJlc2V0IHRoZSBzdGFydGVkIHN0YXRlXHJcbiAgICAgICAgaWYgKHR5cGUgJiAoSU5QVVRfRU5EIHwgSU5QVVRfQ0FOQ0VMKSAmJiB0b3VjaGVzWzBdLmxlbmd0aCAtIHRvdWNoZXNbMV0ubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnRlZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5jYWxsYmFjayh0aGlzLm1hbmFnZXIsIHR5cGUsIHtcclxuICAgICAgICAgICAgcG9pbnRlcnM6IHRvdWNoZXNbMF0sXHJcbiAgICAgICAgICAgIGNoYW5nZWRQb2ludGVyczogdG91Y2hlc1sxXSxcclxuICAgICAgICAgICAgcG9pbnRlclR5cGU6IElOUFVUX1RZUEVfVE9VQ0gsXHJcbiAgICAgICAgICAgIHNyY0V2ZW50OiBldlxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBAdGhpcyB7VG91Y2hJbnB1dH1cclxuICogQHBhcmFtIHtPYmplY3R9IGV2XHJcbiAqIEBwYXJhbSB7TnVtYmVyfSB0eXBlIGZsYWdcclxuICogQHJldHVybnMge3VuZGVmaW5lZHxBcnJheX0gW2FsbCwgY2hhbmdlZF1cclxuICovXHJcbmZ1bmN0aW9uIG5vcm1hbGl6ZVNpbmdsZVRvdWNoZXMoZXYsIHR5cGUpIHtcclxuICAgIHZhciBhbGwgPSB0b0FycmF5KGV2LnRvdWNoZXMpO1xyXG4gICAgdmFyIGNoYW5nZWQgPSB0b0FycmF5KGV2LmNoYW5nZWRUb3VjaGVzKTtcclxuXHJcbiAgICBpZiAodHlwZSAmIChJTlBVVF9FTkQgfCBJTlBVVF9DQU5DRUwpKSB7XHJcbiAgICAgICAgYWxsID0gdW5pcXVlQXJyYXkoYWxsLmNvbmNhdChjaGFuZ2VkKSwgJ2lkZW50aWZpZXInLCB0cnVlKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gW2FsbCwgY2hhbmdlZF07XHJcbn1cclxuXHJcbnZhciBUT1VDSF9JTlBVVF9NQVAgPSB7XHJcbiAgICB0b3VjaHN0YXJ0OiBJTlBVVF9TVEFSVCxcclxuICAgIHRvdWNobW92ZTogSU5QVVRfTU9WRSxcclxuICAgIHRvdWNoZW5kOiBJTlBVVF9FTkQsXHJcbiAgICB0b3VjaGNhbmNlbDogSU5QVVRfQ0FOQ0VMXHJcbn07XHJcblxyXG52YXIgVE9VQ0hfVEFSR0VUX0VWRU5UUyA9ICd0b3VjaHN0YXJ0IHRvdWNobW92ZSB0b3VjaGVuZCB0b3VjaGNhbmNlbCc7XHJcblxyXG4vKipcclxuICogTXVsdGktdXNlciB0b3VjaCBldmVudHMgaW5wdXRcclxuICogQGNvbnN0cnVjdG9yXHJcbiAqIEBleHRlbmRzIElucHV0XHJcbiAqL1xyXG5mdW5jdGlvbiBUb3VjaElucHV0KCkge1xyXG4gICAgdGhpcy5ldlRhcmdldCA9IFRPVUNIX1RBUkdFVF9FVkVOVFM7XHJcbiAgICB0aGlzLnRhcmdldElkcyA9IHt9O1xyXG5cclxuICAgIElucHV0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmluaGVyaXQoVG91Y2hJbnB1dCwgSW5wdXQsIHtcclxuICAgIGhhbmRsZXI6IGZ1bmN0aW9uIE1URWhhbmRsZXIoZXYpIHtcclxuICAgICAgICB2YXIgdHlwZSA9IFRPVUNIX0lOUFVUX01BUFtldi50eXBlXTtcclxuICAgICAgICB2YXIgdG91Y2hlcyA9IGdldFRvdWNoZXMuY2FsbCh0aGlzLCBldiwgdHlwZSk7XHJcbiAgICAgICAgaWYgKCF0b3VjaGVzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2FsbGJhY2sodGhpcy5tYW5hZ2VyLCB0eXBlLCB7XHJcbiAgICAgICAgICAgIHBvaW50ZXJzOiB0b3VjaGVzWzBdLFxyXG4gICAgICAgICAgICBjaGFuZ2VkUG9pbnRlcnM6IHRvdWNoZXNbMV0sXHJcbiAgICAgICAgICAgIHBvaW50ZXJUeXBlOiBJTlBVVF9UWVBFX1RPVUNILFxyXG4gICAgICAgICAgICBzcmNFdmVudDogZXZcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSk7XHJcblxyXG4vKipcclxuICogQHRoaXMge1RvdWNoSW5wdXR9XHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBldlxyXG4gKiBAcGFyYW0ge051bWJlcn0gdHlwZSBmbGFnXHJcbiAqIEByZXR1cm5zIHt1bmRlZmluZWR8QXJyYXl9IFthbGwsIGNoYW5nZWRdXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRUb3VjaGVzKGV2LCB0eXBlKSB7XHJcbiAgICB2YXIgYWxsVG91Y2hlcyA9IHRvQXJyYXkoZXYudG91Y2hlcyk7XHJcbiAgICB2YXIgdGFyZ2V0SWRzID0gdGhpcy50YXJnZXRJZHM7XHJcblxyXG4gICAgLy8gd2hlbiB0aGVyZSBpcyBvbmx5IG9uZSB0b3VjaCwgdGhlIHByb2Nlc3MgY2FuIGJlIHNpbXBsaWZpZWRcclxuICAgIGlmICh0eXBlICYgKElOUFVUX1NUQVJUIHwgSU5QVVRfTU9WRSkgJiYgYWxsVG91Y2hlcy5sZW5ndGggPT09IDEpIHtcclxuICAgICAgICB0YXJnZXRJZHNbYWxsVG91Y2hlc1swXS5pZGVudGlmaWVyXSA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIFthbGxUb3VjaGVzLCBhbGxUb3VjaGVzXTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgaSxcclxuICAgICAgICB0YXJnZXRUb3VjaGVzLFxyXG4gICAgICAgIGNoYW5nZWRUb3VjaGVzID0gdG9BcnJheShldi5jaGFuZ2VkVG91Y2hlcyksXHJcbiAgICAgICAgY2hhbmdlZFRhcmdldFRvdWNoZXMgPSBbXSxcclxuICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldDtcclxuXHJcbiAgICAvLyBnZXQgdGFyZ2V0IHRvdWNoZXMgZnJvbSB0b3VjaGVzXHJcbiAgICB0YXJnZXRUb3VjaGVzID0gYWxsVG91Y2hlcy5maWx0ZXIoZnVuY3Rpb24odG91Y2gpIHtcclxuICAgICAgICByZXR1cm4gaGFzUGFyZW50KHRvdWNoLnRhcmdldCwgdGFyZ2V0KTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIGNvbGxlY3QgdG91Y2hlc1xyXG4gICAgaWYgKHR5cGUgPT09IElOUFVUX1NUQVJUKSB7XHJcbiAgICAgICAgaSA9IDA7XHJcbiAgICAgICAgd2hpbGUgKGkgPCB0YXJnZXRUb3VjaGVzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0YXJnZXRJZHNbdGFyZ2V0VG91Y2hlc1tpXS5pZGVudGlmaWVyXSA9IHRydWU7XHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gZmlsdGVyIGNoYW5nZWQgdG91Y2hlcyB0byBvbmx5IGNvbnRhaW4gdG91Y2hlcyB0aGF0IGV4aXN0IGluIHRoZSBjb2xsZWN0ZWQgdGFyZ2V0IGlkc1xyXG4gICAgaSA9IDA7XHJcbiAgICB3aGlsZSAoaSA8IGNoYW5nZWRUb3VjaGVzLmxlbmd0aCkge1xyXG4gICAgICAgIGlmICh0YXJnZXRJZHNbY2hhbmdlZFRvdWNoZXNbaV0uaWRlbnRpZmllcl0pIHtcclxuICAgICAgICAgICAgY2hhbmdlZFRhcmdldFRvdWNoZXMucHVzaChjaGFuZ2VkVG91Y2hlc1tpXSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjbGVhbnVwIHJlbW92ZWQgdG91Y2hlc1xyXG4gICAgICAgIGlmICh0eXBlICYgKElOUFVUX0VORCB8IElOUFVUX0NBTkNFTCkpIHtcclxuICAgICAgICAgICAgZGVsZXRlIHRhcmdldElkc1tjaGFuZ2VkVG91Y2hlc1tpXS5pZGVudGlmaWVyXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaSsrO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghY2hhbmdlZFRhcmdldFRvdWNoZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBbXHJcbiAgICAgICAgLy8gbWVyZ2UgdGFyZ2V0VG91Y2hlcyB3aXRoIGNoYW5nZWRUYXJnZXRUb3VjaGVzIHNvIGl0IGNvbnRhaW5zIEFMTCB0b3VjaGVzLCBpbmNsdWRpbmcgJ2VuZCcgYW5kICdjYW5jZWwnXHJcbiAgICAgICAgdW5pcXVlQXJyYXkodGFyZ2V0VG91Y2hlcy5jb25jYXQoY2hhbmdlZFRhcmdldFRvdWNoZXMpLCAnaWRlbnRpZmllcicsIHRydWUpLFxyXG4gICAgICAgIGNoYW5nZWRUYXJnZXRUb3VjaGVzXHJcbiAgICBdO1xyXG59XHJcblxyXG4vKipcclxuICogQ29tYmluZWQgdG91Y2ggYW5kIG1vdXNlIGlucHV0XHJcbiAqXHJcbiAqIFRvdWNoIGhhcyBhIGhpZ2hlciBwcmlvcml0eSB0aGVuIG1vdXNlLCBhbmQgd2hpbGUgdG91Y2hpbmcgbm8gbW91c2UgZXZlbnRzIGFyZSBhbGxvd2VkLlxyXG4gKiBUaGlzIGJlY2F1c2UgdG91Y2ggZGV2aWNlcyBhbHNvIGVtaXQgbW91c2UgZXZlbnRzIHdoaWxlIGRvaW5nIGEgdG91Y2guXHJcbiAqXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKiBAZXh0ZW5kcyBJbnB1dFxyXG4gKi9cclxuXHJcbnZhciBERURVUF9USU1FT1VUID0gMjUwMDtcclxudmFyIERFRFVQX0RJU1RBTkNFID0gMjU7XHJcblxyXG5mdW5jdGlvbiBUb3VjaE1vdXNlSW5wdXQoKSB7XHJcbiAgICBJbnB1dC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cclxuICAgIHZhciBoYW5kbGVyID0gYmluZEZuKHRoaXMuaGFuZGxlciwgdGhpcyk7XHJcbiAgICB0aGlzLnRvdWNoID0gbmV3IFRvdWNoSW5wdXQodGhpcy5tYW5hZ2VyLCBoYW5kbGVyKTtcclxuICAgIHRoaXMubW91c2UgPSBuZXcgTW91c2VJbnB1dCh0aGlzLm1hbmFnZXIsIGhhbmRsZXIpO1xyXG5cclxuICAgIHRoaXMucHJpbWFyeVRvdWNoID0gbnVsbDtcclxuICAgIHRoaXMubGFzdFRvdWNoZXMgPSBbXTtcclxufVxyXG5cclxuaW5oZXJpdChUb3VjaE1vdXNlSW5wdXQsIElucHV0LCB7XHJcbiAgICAvKipcclxuICAgICAqIGhhbmRsZSBtb3VzZSBhbmQgdG91Y2ggZXZlbnRzXHJcbiAgICAgKiBAcGFyYW0ge05HSGFtbWVyfSBtYW5hZ2VyXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaW5wdXRFdmVudFxyXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0RGF0YVxyXG4gICAgICovXHJcbiAgICBoYW5kbGVyOiBmdW5jdGlvbiBUTUVoYW5kbGVyKG1hbmFnZXIsIGlucHV0RXZlbnQsIGlucHV0RGF0YSkge1xyXG4gICAgICAgIHZhciBpc1RvdWNoID0gKGlucHV0RGF0YS5wb2ludGVyVHlwZSA9PSBJTlBVVF9UWVBFX1RPVUNIKSxcclxuICAgICAgICAgICAgaXNNb3VzZSA9IChpbnB1dERhdGEucG9pbnRlclR5cGUgPT0gSU5QVVRfVFlQRV9NT1VTRSk7XHJcblxyXG4gICAgICAgIGlmIChpc01vdXNlICYmIGlucHV0RGF0YS5zb3VyY2VDYXBhYmlsaXRpZXMgJiYgaW5wdXREYXRhLnNvdXJjZUNhcGFiaWxpdGllcy5maXJlc1RvdWNoRXZlbnRzKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHdoZW4gd2UncmUgaW4gYSB0b3VjaCBldmVudCwgcmVjb3JkIHRvdWNoZXMgdG8gIGRlLWR1cGUgc3ludGhldGljIG1vdXNlIGV2ZW50XHJcbiAgICAgICAgaWYgKGlzVG91Y2gpIHtcclxuICAgICAgICAgICAgcmVjb3JkVG91Y2hlcy5jYWxsKHRoaXMsIGlucHV0RXZlbnQsIGlucHV0RGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpc01vdXNlICYmIGlzU3ludGhldGljRXZlbnQuY2FsbCh0aGlzLCBpbnB1dERhdGEpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuY2FsbGJhY2sobWFuYWdlciwgaW5wdXRFdmVudCwgaW5wdXREYXRhKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiByZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVyc1xyXG4gICAgICovXHJcbiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95KCkge1xyXG4gICAgICAgIHRoaXMudG91Y2guZGVzdHJveSgpO1xyXG4gICAgICAgIHRoaXMubW91c2UuZGVzdHJveSgpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIHJlY29yZFRvdWNoZXMoZXZlbnRUeXBlLCBldmVudERhdGEpIHtcclxuICAgIGlmIChldmVudFR5cGUgJiBJTlBVVF9TVEFSVCkge1xyXG4gICAgICAgIHRoaXMucHJpbWFyeVRvdWNoID0gZXZlbnREYXRhLmNoYW5nZWRQb2ludGVyc1swXS5pZGVudGlmaWVyO1xyXG4gICAgICAgIHNldExhc3RUb3VjaC5jYWxsKHRoaXMsIGV2ZW50RGF0YSk7XHJcbiAgICB9IGVsc2UgaWYgKGV2ZW50VHlwZSAmIChJTlBVVF9FTkQgfCBJTlBVVF9DQU5DRUwpKSB7XHJcbiAgICAgICAgc2V0TGFzdFRvdWNoLmNhbGwodGhpcywgZXZlbnREYXRhKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0TGFzdFRvdWNoKGV2ZW50RGF0YSkge1xyXG4gICAgdmFyIHRvdWNoID0gZXZlbnREYXRhLmNoYW5nZWRQb2ludGVyc1swXTtcclxuXHJcbiAgICBpZiAodG91Y2guaWRlbnRpZmllciA9PT0gdGhpcy5wcmltYXJ5VG91Y2gpIHtcclxuICAgICAgICB2YXIgbGFzdFRvdWNoID0ge3g6IHRvdWNoLmNsaWVudFgsIHk6IHRvdWNoLmNsaWVudFl9O1xyXG4gICAgICAgIHRoaXMubGFzdFRvdWNoZXMucHVzaChsYXN0VG91Y2gpO1xyXG4gICAgICAgIHZhciBsdHMgPSB0aGlzLmxhc3RUb3VjaGVzO1xyXG4gICAgICAgIHZhciByZW1vdmVMYXN0VG91Y2ggPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGkgPSBsdHMuaW5kZXhPZihsYXN0VG91Y2gpO1xyXG4gICAgICAgICAgICBpZiAoaSA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBsdHMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBzZXRUaW1lb3V0KHJlbW92ZUxhc3RUb3VjaCwgREVEVVBfVElNRU9VVCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzU3ludGhldGljRXZlbnQoZXZlbnREYXRhKSB7XHJcbiAgICB2YXIgeCA9IGV2ZW50RGF0YS5zcmNFdmVudC5jbGllbnRYLCB5ID0gZXZlbnREYXRhLnNyY0V2ZW50LmNsaWVudFk7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGFzdFRvdWNoZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB2YXIgdCA9IHRoaXMubGFzdFRvdWNoZXNbaV07XHJcbiAgICAgICAgdmFyIGR4ID0gTWF0aC5hYnMoeCAtIHQueCksIGR5ID0gTWF0aC5hYnMoeSAtIHQueSk7XHJcbiAgICAgICAgaWYgKGR4IDw9IERFRFVQX0RJU1RBTkNFICYmIGR5IDw9IERFRFVQX0RJU1RBTkNFKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxudmFyIFBSRUZJWEVEX1RPVUNIX0FDVElPTiA9IHByZWZpeGVkKFRFU1RfRUxFTUVOVC5zdHlsZSwgJ3RvdWNoQWN0aW9uJyk7XHJcbnZhciBOQVRJVkVfVE9VQ0hfQUNUSU9OID0gUFJFRklYRURfVE9VQ0hfQUNUSU9OICE9PSB1bmRlZmluZWQ7XHJcblxyXG4vLyBtYWdpY2FsIHRvdWNoQWN0aW9uIHZhbHVlXHJcbnZhciBUT1VDSF9BQ1RJT05fQ09NUFVURSA9ICdjb21wdXRlJztcclxudmFyIFRPVUNIX0FDVElPTl9BVVRPID0gJ2F1dG8nO1xyXG52YXIgVE9VQ0hfQUNUSU9OX01BTklQVUxBVElPTiA9ICdtYW5pcHVsYXRpb24nOyAvLyBub3QgaW1wbGVtZW50ZWRcclxudmFyIFRPVUNIX0FDVElPTl9OT05FID0gJ25vbmUnO1xyXG52YXIgVE9VQ0hfQUNUSU9OX1BBTl9YID0gJ3Bhbi14JztcclxudmFyIFRPVUNIX0FDVElPTl9QQU5fWSA9ICdwYW4teSc7XHJcbnZhciBUT1VDSF9BQ1RJT05fTUFQID0gZ2V0VG91Y2hBY3Rpb25Qcm9wcygpO1xyXG5cclxuLyoqXHJcbiAqIFRvdWNoIEFjdGlvblxyXG4gKiBzZXRzIHRoZSB0b3VjaEFjdGlvbiBwcm9wZXJ0eSBvciB1c2VzIHRoZSBqcyBhbHRlcm5hdGl2ZVxyXG4gKiBAcGFyYW0ge01hbmFnZXJ9IG1hbmFnZXJcclxuICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKi9cclxuZnVuY3Rpb24gVG91Y2hBY3Rpb24obWFuYWdlciwgdmFsdWUpIHtcclxuICAgIHRoaXMubWFuYWdlciA9IG1hbmFnZXI7XHJcbiAgICB0aGlzLnNldCh2YWx1ZSk7XHJcbn1cclxuXHJcblRvdWNoQWN0aW9uLnByb3RvdHlwZSA9IHtcclxuICAgIC8qKlxyXG4gICAgICogc2V0IHRoZSB0b3VjaEFjdGlvbiB2YWx1ZSBvbiB0aGUgZWxlbWVudCBvciBlbmFibGUgdGhlIHBvbHlmaWxsXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWVcclxuICAgICAqL1xyXG4gICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkge1xyXG4gICAgICAgIC8vIGZpbmQgb3V0IHRoZSB0b3VjaC1hY3Rpb24gYnkgdGhlIGV2ZW50IGhhbmRsZXJzXHJcbiAgICAgICAgaWYgKHZhbHVlID09IFRPVUNIX0FDVElPTl9DT01QVVRFKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5jb21wdXRlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoTkFUSVZFX1RPVUNIX0FDVElPTiAmJiB0aGlzLm1hbmFnZXIuZWxlbWVudC5zdHlsZSAmJiBUT1VDSF9BQ1RJT05fTUFQW3ZhbHVlXSkge1xyXG4gICAgICAgICAgICB0aGlzLm1hbmFnZXIuZWxlbWVudC5zdHlsZVtQUkVGSVhFRF9UT1VDSF9BQ1RJT05dID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWN0aW9ucyA9IHZhbHVlLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIGp1c3QgcmUtc2V0IHRoZSB0b3VjaEFjdGlvbiB2YWx1ZVxyXG4gICAgICovXHJcbiAgICB1cGRhdGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHRoaXMuc2V0KHRoaXMubWFuYWdlci5vcHRpb25zLnRvdWNoQWN0aW9uKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBjb21wdXRlIHRoZSB2YWx1ZSBmb3IgdGhlIHRvdWNoQWN0aW9uIHByb3BlcnR5IGJhc2VkIG9uIHRoZSByZWNvZ25pemVyJ3Mgc2V0dGluZ3NcclxuICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IHZhbHVlXHJcbiAgICAgKi9cclxuICAgIGNvbXB1dGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHZhciBhY3Rpb25zID0gW107XHJcbiAgICAgICAgZWFjaCh0aGlzLm1hbmFnZXIucmVjb2duaXplcnMsIGZ1bmN0aW9uKHJlY29nbml6ZXIpIHtcclxuICAgICAgICAgICAgaWYgKGJvb2xPckZuKHJlY29nbml6ZXIub3B0aW9ucy5lbmFibGUsIFtyZWNvZ25pemVyXSkpIHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbnMgPSBhY3Rpb25zLmNvbmNhdChyZWNvZ25pemVyLmdldFRvdWNoQWN0aW9uKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGNsZWFuVG91Y2hBY3Rpb25zKGFjdGlvbnMuam9pbignICcpKTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiB0aGlzIG1ldGhvZCBpcyBjYWxsZWQgb24gZWFjaCBpbnB1dCBjeWNsZSBhbmQgcHJvdmlkZXMgdGhlIHByZXZlbnRpbmcgb2YgdGhlIGJyb3dzZXIgYmVoYXZpb3JcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dFxyXG4gICAgICovXHJcbiAgICBwcmV2ZW50RGVmYXVsdHM6IGZ1bmN0aW9uKGlucHV0KSB7XHJcbiAgICAgICAgdmFyIHNyY0V2ZW50ID0gaW5wdXQuc3JjRXZlbnQ7XHJcbiAgICAgICAgdmFyIGRpcmVjdGlvbiA9IGlucHV0Lm9mZnNldERpcmVjdGlvbjtcclxuXHJcbiAgICAgICAgLy8gaWYgdGhlIHRvdWNoIGFjdGlvbiBkaWQgcHJldmVudGVkIG9uY2UgdGhpcyBzZXNzaW9uXHJcbiAgICAgICAgaWYgKHRoaXMubWFuYWdlci5zZXNzaW9uLnByZXZlbnRlZCkge1xyXG4gICAgICAgICAgICBzcmNFdmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgYWN0aW9ucyA9IHRoaXMuYWN0aW9ucztcclxuICAgICAgICB2YXIgaGFzTm9uZSA9IGluU3RyKGFjdGlvbnMsIFRPVUNIX0FDVElPTl9OT05FKSAmJiAhVE9VQ0hfQUNUSU9OX01BUFtUT1VDSF9BQ1RJT05fTk9ORV07XHJcbiAgICAgICAgdmFyIGhhc1BhblkgPSBpblN0cihhY3Rpb25zLCBUT1VDSF9BQ1RJT05fUEFOX1kpICYmICFUT1VDSF9BQ1RJT05fTUFQW1RPVUNIX0FDVElPTl9QQU5fWV07XHJcbiAgICAgICAgdmFyIGhhc1BhblggPSBpblN0cihhY3Rpb25zLCBUT1VDSF9BQ1RJT05fUEFOX1gpICYmICFUT1VDSF9BQ1RJT05fTUFQW1RPVUNIX0FDVElPTl9QQU5fWF07XHJcblxyXG4gICAgICAgIGlmIChoYXNOb25lKSB7XHJcbiAgICAgICAgICAgIC8vZG8gbm90IHByZXZlbnQgZGVmYXVsdHMgaWYgdGhpcyBpcyBhIHRhcCBnZXN0dXJlXHJcblxyXG4gICAgICAgICAgICB2YXIgaXNUYXBQb2ludGVyID0gaW5wdXQucG9pbnRlcnMubGVuZ3RoID09PSAxO1xyXG4gICAgICAgICAgICB2YXIgaXNUYXBNb3ZlbWVudCA9IGlucHV0LmRpc3RhbmNlIDwgMjtcclxuICAgICAgICAgICAgdmFyIGlzVGFwVG91Y2hUaW1lID0gaW5wdXQuZGVsdGFUaW1lIDwgMjUwO1xyXG5cclxuICAgICAgICAgICAgaWYgKGlzVGFwUG9pbnRlciAmJiBpc1RhcE1vdmVtZW50ICYmIGlzVGFwVG91Y2hUaW1lKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChoYXNQYW5YICYmIGhhc1BhblkpIHtcclxuICAgICAgICAgICAgLy8gYHBhbi14IHBhbi15YCBtZWFucyBicm93c2VyIGhhbmRsZXMgYWxsIHNjcm9sbGluZy9wYW5uaW5nLCBkbyBub3QgcHJldmVudFxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaGFzTm9uZSB8fFxyXG4gICAgICAgICAgICAoaGFzUGFuWSAmJiBkaXJlY3Rpb24gJiBESVJFQ1RJT05fSE9SSVpPTlRBTCkgfHxcclxuICAgICAgICAgICAgKGhhc1BhblggJiYgZGlyZWN0aW9uICYgRElSRUNUSU9OX1ZFUlRJQ0FMKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcmV2ZW50U3JjKHNyY0V2ZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogY2FsbCBwcmV2ZW50RGVmYXVsdCB0byBwcmV2ZW50IHRoZSBicm93c2VyJ3MgZGVmYXVsdCBiZWhhdmlvciAoc2Nyb2xsaW5nIGluIG1vc3QgY2FzZXMpXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gc3JjRXZlbnRcclxuICAgICAqL1xyXG4gICAgcHJldmVudFNyYzogZnVuY3Rpb24oc3JjRXZlbnQpIHtcclxuICAgICAgICB0aGlzLm1hbmFnZXIuc2Vzc2lvbi5wcmV2ZW50ZWQgPSB0cnVlO1xyXG4gICAgICAgIHNyY0V2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vKipcclxuICogd2hlbiB0aGUgdG91Y2hBY3Rpb25zIGFyZSBjb2xsZWN0ZWQgdGhleSBhcmUgbm90IGEgdmFsaWQgdmFsdWUsIHNvIHdlIG5lZWQgdG8gY2xlYW4gdGhpbmdzIHVwLiAqXHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBhY3Rpb25zXHJcbiAqIEByZXR1cm5zIHsqfVxyXG4gKi9cclxuZnVuY3Rpb24gY2xlYW5Ub3VjaEFjdGlvbnMoYWN0aW9ucykge1xyXG4gICAgLy8gbm9uZVxyXG4gICAgaWYgKGluU3RyKGFjdGlvbnMsIFRPVUNIX0FDVElPTl9OT05FKSkge1xyXG4gICAgICAgIHJldHVybiBUT1VDSF9BQ1RJT05fTk9ORTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgaGFzUGFuWCA9IGluU3RyKGFjdGlvbnMsIFRPVUNIX0FDVElPTl9QQU5fWCk7XHJcbiAgICB2YXIgaGFzUGFuWSA9IGluU3RyKGFjdGlvbnMsIFRPVUNIX0FDVElPTl9QQU5fWSk7XHJcblxyXG4gICAgLy8gaWYgYm90aCBwYW4teCBhbmQgcGFuLXkgYXJlIHNldCAoZGlmZmVyZW50IHJlY29nbml6ZXJzXHJcbiAgICAvLyBmb3IgZGlmZmVyZW50IGRpcmVjdGlvbnMsIGUuZy4gaG9yaXpvbnRhbCBwYW4gYnV0IHZlcnRpY2FsIHN3aXBlPylcclxuICAgIC8vIHdlIG5lZWQgbm9uZSAoYXMgb3RoZXJ3aXNlIHdpdGggcGFuLXggcGFuLXkgY29tYmluZWQgbm9uZSBvZiB0aGVzZVxyXG4gICAgLy8gcmVjb2duaXplcnMgd2lsbCB3b3JrLCBzaW5jZSB0aGUgYnJvd3NlciB3b3VsZCBoYW5kbGUgYWxsIHBhbm5pbmdcclxuICAgIGlmIChoYXNQYW5YICYmIGhhc1BhblkpIHtcclxuICAgICAgICByZXR1cm4gVE9VQ0hfQUNUSU9OX05PTkU7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcGFuLXggT1IgcGFuLXlcclxuICAgIGlmIChoYXNQYW5YIHx8IGhhc1BhblkpIHtcclxuICAgICAgICByZXR1cm4gaGFzUGFuWCA/IFRPVUNIX0FDVElPTl9QQU5fWCA6IFRPVUNIX0FDVElPTl9QQU5fWTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBtYW5pcHVsYXRpb25cclxuICAgIGlmIChpblN0cihhY3Rpb25zLCBUT1VDSF9BQ1RJT05fTUFOSVBVTEFUSU9OKSkge1xyXG4gICAgICAgIHJldHVybiBUT1VDSF9BQ1RJT05fTUFOSVBVTEFUSU9OO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBUT1VDSF9BQ1RJT05fQVVUTztcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VG91Y2hBY3Rpb25Qcm9wcygpIHtcclxuICAgIGlmICghTkFUSVZFX1RPVUNIX0FDVElPTikge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHZhciB0b3VjaE1hcCA9IHt9O1xyXG4gICAgdmFyIGNzc1N1cHBvcnRzID0gd2luZG93LkNTUyAmJiB3aW5kb3cuQ1NTLnN1cHBvcnRzO1xyXG4gICAgWydhdXRvJywgJ21hbmlwdWxhdGlvbicsICdwYW4teScsICdwYW4teCcsICdwYW4teCBwYW4teScsICdub25lJ10uZm9yRWFjaChmdW5jdGlvbih2YWwpIHtcclxuXHJcbiAgICAgICAgLy8gSWYgY3NzLnN1cHBvcnRzIGlzIG5vdCBzdXBwb3J0ZWQgYnV0IHRoZXJlIGlzIG5hdGl2ZSB0b3VjaC1hY3Rpb24gYXNzdW1lIGl0IHN1cHBvcnRzXHJcbiAgICAgICAgLy8gYWxsIHZhbHVlcy4gVGhpcyBpcyB0aGUgY2FzZSBmb3IgSUUgMTAgYW5kIDExLlxyXG4gICAgICAgIHRvdWNoTWFwW3ZhbF0gPSBjc3NTdXBwb3J0cyA/IHdpbmRvdy5DU1Muc3VwcG9ydHMoJ3RvdWNoLWFjdGlvbicsIHZhbCkgOiB0cnVlO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdG91Y2hNYXA7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZWNvZ25pemVyIGZsb3cgZXhwbGFpbmVkOyAqXHJcbiAqIEFsbCByZWNvZ25pemVycyBoYXZlIHRoZSBpbml0aWFsIHN0YXRlIG9mIFBPU1NJQkxFIHdoZW4gYSBpbnB1dCBzZXNzaW9uIHN0YXJ0cy5cclxuICogVGhlIGRlZmluaXRpb24gb2YgYSBpbnB1dCBzZXNzaW9uIGlzIGZyb20gdGhlIGZpcnN0IGlucHV0IHVudGlsIHRoZSBsYXN0IGlucHV0LCB3aXRoIGFsbCBpdCdzIG1vdmVtZW50IGluIGl0LiAqXHJcbiAqIEV4YW1wbGUgc2Vzc2lvbiBmb3IgbW91c2UtaW5wdXQ6IG1vdXNlZG93biAtPiBtb3VzZW1vdmUgLT4gbW91c2V1cFxyXG4gKlxyXG4gKiBPbiBlYWNoIHJlY29nbml6aW5nIGN5Y2xlIChzZWUgTWFuYWdlci5yZWNvZ25pemUpIHRoZSAucmVjb2duaXplKCkgbWV0aG9kIGlzIGV4ZWN1dGVkXHJcbiAqIHdoaWNoIGRldGVybWluZXMgd2l0aCBzdGF0ZSBpdCBzaG91bGQgYmUuXHJcbiAqXHJcbiAqIElmIHRoZSByZWNvZ25pemVyIGhhcyB0aGUgc3RhdGUgRkFJTEVELCBDQU5DRUxMRUQgb3IgUkVDT0dOSVpFRCAoZXF1YWxzIEVOREVEKSwgaXQgaXMgcmVzZXQgdG9cclxuICogUE9TU0lCTEUgdG8gZ2l2ZSBpdCBhbm90aGVyIGNoYW5nZSBvbiB0aGUgbmV4dCBjeWNsZS5cclxuICpcclxuICogICAgICAgICAgICAgICBQb3NzaWJsZVxyXG4gKiAgICAgICAgICAgICAgICAgIHxcclxuICogICAgICAgICAgICArLS0tLS0rLS0tLS0tLS0tLS0tLS0tK1xyXG4gKiAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICB8XHJcbiAqICAgICAgKy0tLS0tKy0tLS0tKyAgICAgICAgICAgICAgIHxcclxuICogICAgICB8ICAgICAgICAgICB8ICAgICAgICAgICAgICAgfFxyXG4gKiAgIEZhaWxlZCAgICAgIENhbmNlbGxlZCAgICAgICAgICB8XHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICArLS0tLS0tLSstLS0tLS0rXHJcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgICB8XHJcbiAqICAgICAgICAgICAgICAgICAgICAgIFJlY29nbml6ZWQgICAgICAgQmVnYW5cclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYW5nZWRcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRW5kZWQvUmVjb2duaXplZFxyXG4gKi9cclxudmFyIFNUQVRFX1BPU1NJQkxFID0gMTtcclxudmFyIFNUQVRFX0JFR0FOID0gMjtcclxudmFyIFNUQVRFX0NIQU5HRUQgPSA0O1xyXG52YXIgU1RBVEVfRU5ERUQgPSA4O1xyXG52YXIgU1RBVEVfUkVDT0dOSVpFRCA9IFNUQVRFX0VOREVEO1xyXG52YXIgU1RBVEVfQ0FOQ0VMTEVEID0gMTY7XHJcbnZhciBTVEFURV9GQUlMRUQgPSAzMjtcclxuXHJcbi8qKlxyXG4gKiBSZWNvZ25pemVyXHJcbiAqIEV2ZXJ5IHJlY29nbml6ZXIgbmVlZHMgdG8gZXh0ZW5kIGZyb20gdGhpcyBjbGFzcy5cclxuICogQGNvbnN0cnVjdG9yXHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXHJcbiAqL1xyXG5mdW5jdGlvbiBSZWNvZ25pemVyKG9wdGlvbnMpIHtcclxuICAgIHRoaXMub3B0aW9ucyA9IGFzc2lnbih7fSwgdGhpcy5kZWZhdWx0cywgb3B0aW9ucyB8fCB7fSk7XHJcblxyXG4gICAgdGhpcy5pZCA9IHVuaXF1ZUlkKCk7XHJcblxyXG4gICAgdGhpcy5tYW5hZ2VyID0gbnVsbDtcclxuXHJcbiAgICAvLyBkZWZhdWx0IGlzIGVuYWJsZSB0cnVlXHJcbiAgICB0aGlzLm9wdGlvbnMuZW5hYmxlID0gaWZVbmRlZmluZWQodGhpcy5vcHRpb25zLmVuYWJsZSwgdHJ1ZSk7XHJcblxyXG4gICAgdGhpcy5zdGF0ZSA9IFNUQVRFX1BPU1NJQkxFO1xyXG5cclxuICAgIHRoaXMuc2ltdWx0YW5lb3VzID0ge307XHJcbiAgICB0aGlzLnJlcXVpcmVGYWlsID0gW107XHJcbn1cclxuXHJcblJlY29nbml6ZXIucHJvdG90eXBlID0ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAdmlydHVhbFxyXG4gICAgICogQHR5cGUge09iamVjdH1cclxuICAgICAqL1xyXG4gICAgZGVmYXVsdHM6IHt9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogc2V0IG9wdGlvbnNcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXHJcbiAgICAgKiBAcmV0dXJuIHtSZWNvZ25pemVyfVxyXG4gICAgICovXHJcbiAgICBzZXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuICAgICAgICBhc3NpZ24odGhpcy5vcHRpb25zLCBvcHRpb25zKTtcclxuXHJcbiAgICAgICAgLy8gYWxzbyB1cGRhdGUgdGhlIHRvdWNoQWN0aW9uLCBpbiBjYXNlIHNvbWV0aGluZyBjaGFuZ2VkIGFib3V0IHRoZSBkaXJlY3Rpb25zL2VuYWJsZWQgc3RhdGVcclxuICAgICAgICB0aGlzLm1hbmFnZXIgJiYgdGhpcy5tYW5hZ2VyLnRvdWNoQWN0aW9uLnVwZGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIHJlY29nbml6ZSBzaW11bHRhbmVvdXMgd2l0aCBhbiBvdGhlciByZWNvZ25pemVyLlxyXG4gICAgICogQHBhcmFtIHtSZWNvZ25pemVyfSBvdGhlclJlY29nbml6ZXJcclxuICAgICAqIEByZXR1cm5zIHtSZWNvZ25pemVyfSB0aGlzXHJcbiAgICAgKi9cclxuICAgIHJlY29nbml6ZVdpdGg6IGZ1bmN0aW9uKG90aGVyUmVjb2duaXplcikge1xyXG4gICAgICAgIGlmIChpbnZva2VBcnJheUFyZyhvdGhlclJlY29nbml6ZXIsICdyZWNvZ25pemVXaXRoJywgdGhpcykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgc2ltdWx0YW5lb3VzID0gdGhpcy5zaW11bHRhbmVvdXM7XHJcbiAgICAgICAgb3RoZXJSZWNvZ25pemVyID0gZ2V0UmVjb2duaXplckJ5TmFtZUlmTWFuYWdlcihvdGhlclJlY29nbml6ZXIsIHRoaXMpO1xyXG4gICAgICAgIGlmICghc2ltdWx0YW5lb3VzW290aGVyUmVjb2duaXplci5pZF0pIHtcclxuICAgICAgICAgICAgc2ltdWx0YW5lb3VzW290aGVyUmVjb2duaXplci5pZF0gPSBvdGhlclJlY29nbml6ZXI7XHJcbiAgICAgICAgICAgIG90aGVyUmVjb2duaXplci5yZWNvZ25pemVXaXRoKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBkcm9wIHRoZSBzaW11bHRhbmVvdXMgbGluay4gaXQgZG9lc250IHJlbW92ZSB0aGUgbGluayBvbiB0aGUgb3RoZXIgcmVjb2duaXplci5cclxuICAgICAqIEBwYXJhbSB7UmVjb2duaXplcn0gb3RoZXJSZWNvZ25pemVyXHJcbiAgICAgKiBAcmV0dXJucyB7UmVjb2duaXplcn0gdGhpc1xyXG4gICAgICovXHJcbiAgICBkcm9wUmVjb2duaXplV2l0aDogZnVuY3Rpb24ob3RoZXJSZWNvZ25pemVyKSB7XHJcbiAgICAgICAgaWYgKGludm9rZUFycmF5QXJnKG90aGVyUmVjb2duaXplciwgJ2Ryb3BSZWNvZ25pemVXaXRoJywgdGhpcykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvdGhlclJlY29nbml6ZXIgPSBnZXRSZWNvZ25pemVyQnlOYW1lSWZNYW5hZ2VyKG90aGVyUmVjb2duaXplciwgdGhpcyk7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMuc2ltdWx0YW5lb3VzW290aGVyUmVjb2duaXplci5pZF07XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmVjb2duaXplciBjYW4gb25seSBydW4gd2hlbiBhbiBvdGhlciBpcyBmYWlsaW5nXHJcbiAgICAgKiBAcGFyYW0ge1JlY29nbml6ZXJ9IG90aGVyUmVjb2duaXplclxyXG4gICAgICogQHJldHVybnMge1JlY29nbml6ZXJ9IHRoaXNcclxuICAgICAqL1xyXG4gICAgcmVxdWlyZUZhaWx1cmU6IGZ1bmN0aW9uKG90aGVyUmVjb2duaXplcikge1xyXG4gICAgICAgIGlmIChpbnZva2VBcnJheUFyZyhvdGhlclJlY29nbml6ZXIsICdyZXF1aXJlRmFpbHVyZScsIHRoaXMpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHJlcXVpcmVGYWlsID0gdGhpcy5yZXF1aXJlRmFpbDtcclxuICAgICAgICBvdGhlclJlY29nbml6ZXIgPSBnZXRSZWNvZ25pemVyQnlOYW1lSWZNYW5hZ2VyKG90aGVyUmVjb2duaXplciwgdGhpcyk7XHJcbiAgICAgICAgaWYgKGluQXJyYXkocmVxdWlyZUZhaWwsIG90aGVyUmVjb2duaXplcikgPT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJlcXVpcmVGYWlsLnB1c2gob3RoZXJSZWNvZ25pemVyKTtcclxuICAgICAgICAgICAgb3RoZXJSZWNvZ25pemVyLnJlcXVpcmVGYWlsdXJlKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBkcm9wIHRoZSByZXF1aXJlRmFpbHVyZSBsaW5rLiBpdCBkb2VzIG5vdCByZW1vdmUgdGhlIGxpbmsgb24gdGhlIG90aGVyIHJlY29nbml6ZXIuXHJcbiAgICAgKiBAcGFyYW0ge1JlY29nbml6ZXJ9IG90aGVyUmVjb2duaXplclxyXG4gICAgICogQHJldHVybnMge1JlY29nbml6ZXJ9IHRoaXNcclxuICAgICAqL1xyXG4gICAgZHJvcFJlcXVpcmVGYWlsdXJlOiBmdW5jdGlvbihvdGhlclJlY29nbml6ZXIpIHtcclxuICAgICAgICBpZiAoaW52b2tlQXJyYXlBcmcob3RoZXJSZWNvZ25pemVyLCAnZHJvcFJlcXVpcmVGYWlsdXJlJywgdGhpcykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvdGhlclJlY29nbml6ZXIgPSBnZXRSZWNvZ25pemVyQnlOYW1lSWZNYW5hZ2VyKG90aGVyUmVjb2duaXplciwgdGhpcyk7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gaW5BcnJheSh0aGlzLnJlcXVpcmVGYWlsLCBvdGhlclJlY29nbml6ZXIpO1xyXG4gICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVxdWlyZUZhaWwuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogaGFzIHJlcXVpcmUgZmFpbHVyZXMgYm9vbGVhblxyXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59XHJcbiAgICAgKi9cclxuICAgIGhhc1JlcXVpcmVGYWlsdXJlczogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVxdWlyZUZhaWwubGVuZ3RoID4gMDtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpZiB0aGUgcmVjb2duaXplciBjYW4gcmVjb2duaXplIHNpbXVsdGFuZW91cyB3aXRoIGFuIG90aGVyIHJlY29nbml6ZXJcclxuICAgICAqIEBwYXJhbSB7UmVjb2duaXplcn0gb3RoZXJSZWNvZ25pemVyXHJcbiAgICAgKiBAcmV0dXJucyB7Qm9vbGVhbn1cclxuICAgICAqL1xyXG4gICAgY2FuUmVjb2duaXplV2l0aDogZnVuY3Rpb24ob3RoZXJSZWNvZ25pemVyKSB7XHJcbiAgICAgICAgcmV0dXJuICEhdGhpcy5zaW11bHRhbmVvdXNbb3RoZXJSZWNvZ25pemVyLmlkXTtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBZb3Ugc2hvdWxkIHVzZSBgdHJ5RW1pdGAgaW5zdGVhZCBvZiBgZW1pdGAgZGlyZWN0bHkgdG8gY2hlY2tcclxuICAgICAqIHRoYXQgYWxsIHRoZSBuZWVkZWQgcmVjb2duaXplcnMgaGFzIGZhaWxlZCBiZWZvcmUgZW1pdHRpbmcuXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXRcclxuICAgICAqL1xyXG4gICAgZW1pdDogZnVuY3Rpb24oaW5wdXQpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHN0YXRlID0gdGhpcy5zdGF0ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZW1pdChldmVudCkge1xyXG4gICAgICAgICAgICBzZWxmLm1hbmFnZXIuZW1pdChldmVudCwgaW5wdXQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gJ3BhbnN0YXJ0JyBhbmQgJ3Bhbm1vdmUnXHJcbiAgICAgICAgaWYgKHN0YXRlIDwgU1RBVEVfRU5ERUQpIHtcclxuICAgICAgICAgICAgZW1pdChzZWxmLm9wdGlvbnMuZXZlbnQgKyBzdGF0ZVN0cihzdGF0ZSkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZW1pdChzZWxmLm9wdGlvbnMuZXZlbnQpOyAvLyBzaW1wbGUgJ2V2ZW50TmFtZScgZXZlbnRzXHJcblxyXG4gICAgICAgIGlmIChpbnB1dC5hZGRpdGlvbmFsRXZlbnQpIHsgLy8gYWRkaXRpb25hbCBldmVudChwYW5sZWZ0LCBwYW5yaWdodCwgcGluY2hpbiwgcGluY2hvdXQuLi4pXHJcbiAgICAgICAgICAgIGVtaXQoaW5wdXQuYWRkaXRpb25hbEV2ZW50KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHBhbmVuZCBhbmQgcGFuY2FuY2VsXHJcbiAgICAgICAgaWYgKHN0YXRlID49IFNUQVRFX0VOREVEKSB7XHJcbiAgICAgICAgICAgIGVtaXQoc2VsZi5vcHRpb25zLmV2ZW50ICsgc3RhdGVTdHIoc3RhdGUpKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ2hlY2sgdGhhdCBhbGwgdGhlIHJlcXVpcmUgZmFpbHVyZSByZWNvZ25pemVycyBoYXMgZmFpbGVkLFxyXG4gICAgICogaWYgdHJ1ZSwgaXQgZW1pdHMgYSBnZXN0dXJlIGV2ZW50LFxyXG4gICAgICogb3RoZXJ3aXNlLCBzZXR1cCB0aGUgc3RhdGUgdG8gRkFJTEVELlxyXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0XHJcbiAgICAgKi9cclxuICAgIHRyeUVtaXQ6IGZ1bmN0aW9uKGlucHV0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2FuRW1pdCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmVtaXQoaW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBpdCdzIGZhaWxpbmcgYW55d2F5XHJcbiAgICAgICAgdGhpcy5zdGF0ZSA9IFNUQVRFX0ZBSUxFRDtcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBjYW4gd2UgZW1pdD9cclxuICAgICAqIEByZXR1cm5zIHtib29sZWFufVxyXG4gICAgICovXHJcbiAgICBjYW5FbWl0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgd2hpbGUgKGkgPCB0aGlzLnJlcXVpcmVGYWlsLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpZiAoISh0aGlzLnJlcXVpcmVGYWlsW2ldLnN0YXRlICYgKFNUQVRFX0ZBSUxFRCB8IFNUQVRFX1BPU1NJQkxFKSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpKys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIHVwZGF0ZSB0aGUgcmVjb2duaXplclxyXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0RGF0YVxyXG4gICAgICovXHJcbiAgICByZWNvZ25pemU6IGZ1bmN0aW9uKGlucHV0RGF0YSkge1xyXG4gICAgICAgIC8vIG1ha2UgYSBuZXcgY29weSBvZiB0aGUgaW5wdXREYXRhXHJcbiAgICAgICAgLy8gc28gd2UgY2FuIGNoYW5nZSB0aGUgaW5wdXREYXRhIHdpdGhvdXQgbWVzc2luZyB1cCB0aGUgb3RoZXIgcmVjb2duaXplcnNcclxuICAgICAgICB2YXIgaW5wdXREYXRhQ2xvbmUgPSBhc3NpZ24oe30sIGlucHV0RGF0YSk7XHJcblxyXG4gICAgICAgIC8vIGlzIGlzIGVuYWJsZWQgYW5kIGFsbG93IHJlY29nbml6aW5nP1xyXG4gICAgICAgIGlmICghYm9vbE9yRm4odGhpcy5vcHRpb25zLmVuYWJsZSwgW3RoaXMsIGlucHV0RGF0YUNsb25lXSkpIHtcclxuICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xyXG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gU1RBVEVfRkFJTEVEO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyByZXNldCB3aGVuIHdlJ3ZlIHJlYWNoZWQgdGhlIGVuZFxyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlICYgKFNUQVRFX1JFQ09HTklaRUQgfCBTVEFURV9DQU5DRUxMRUQgfCBTVEFURV9GQUlMRUQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBTVEFURV9QT1NTSUJMRTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc3RhdGUgPSB0aGlzLnByb2Nlc3MoaW5wdXREYXRhQ2xvbmUpO1xyXG5cclxuICAgICAgICAvLyB0aGUgcmVjb2duaXplciBoYXMgcmVjb2duaXplZCBhIGdlc3R1cmVcclxuICAgICAgICAvLyBzbyB0cmlnZ2VyIGFuIGV2ZW50XHJcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUgJiAoU1RBVEVfQkVHQU4gfCBTVEFURV9DSEFOR0VEIHwgU1RBVEVfRU5ERUQgfCBTVEFURV9DQU5DRUxMRUQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMudHJ5RW1pdChpbnB1dERhdGFDbG9uZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIHJldHVybiB0aGUgc3RhdGUgb2YgdGhlIHJlY29nbml6ZXJcclxuICAgICAqIHRoZSBhY3R1YWwgcmVjb2duaXppbmcgaGFwcGVucyBpbiB0aGlzIG1ldGhvZFxyXG4gICAgICogQHZpcnR1YWxcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dERhdGFcclxuICAgICAqIEByZXR1cm5zIHtDb25zdH0gU1RBVEVcclxuICAgICAqL1xyXG4gICAgcHJvY2VzczogZnVuY3Rpb24oaW5wdXREYXRhKSB7IH0sIC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmV0dXJuIHRoZSBwcmVmZXJyZWQgdG91Y2gtYWN0aW9uXHJcbiAgICAgKiBAdmlydHVhbFxyXG4gICAgICogQHJldHVybnMge0FycmF5fVxyXG4gICAgICovXHJcbiAgICBnZXRUb3VjaEFjdGlvbjogZnVuY3Rpb24oKSB7IH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBjYWxsZWQgd2hlbiB0aGUgZ2VzdHVyZSBpc24ndCBhbGxvd2VkIHRvIHJlY29nbml6ZVxyXG4gICAgICogbGlrZSB3aGVuIGFub3RoZXIgaXMgYmVpbmcgcmVjb2duaXplZCBvciBpdCBpcyBkaXNhYmxlZFxyXG4gICAgICogQHZpcnR1YWxcclxuICAgICAqL1xyXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKCkgeyB9XHJcbn07XHJcblxyXG4vKipcclxuICogZ2V0IGEgdXNhYmxlIHN0cmluZywgdXNlZCBhcyBldmVudCBwb3N0Zml4XHJcbiAqIEBwYXJhbSB7Q29uc3R9IHN0YXRlXHJcbiAqIEByZXR1cm5zIHtTdHJpbmd9IHN0YXRlXHJcbiAqL1xyXG5mdW5jdGlvbiBzdGF0ZVN0cihzdGF0ZSkge1xyXG4gICAgaWYgKHN0YXRlICYgU1RBVEVfQ0FOQ0VMTEVEKSB7XHJcbiAgICAgICAgcmV0dXJuICdjYW5jZWwnO1xyXG4gICAgfSBlbHNlIGlmIChzdGF0ZSAmIFNUQVRFX0VOREVEKSB7XHJcbiAgICAgICAgcmV0dXJuICdlbmQnO1xyXG4gICAgfSBlbHNlIGlmIChzdGF0ZSAmIFNUQVRFX0NIQU5HRUQpIHtcclxuICAgICAgICByZXR1cm4gJ21vdmUnO1xyXG4gICAgfSBlbHNlIGlmIChzdGF0ZSAmIFNUQVRFX0JFR0FOKSB7XHJcbiAgICAgICAgcmV0dXJuICdzdGFydCc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJyc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBkaXJlY3Rpb24gY29ucyB0byBzdHJpbmdcclxuICogQHBhcmFtIHtDb25zdH0gZGlyZWN0aW9uXHJcbiAqIEByZXR1cm5zIHtTdHJpbmd9XHJcbiAqL1xyXG5mdW5jdGlvbiBkaXJlY3Rpb25TdHIoZGlyZWN0aW9uKSB7XHJcbiAgICBpZiAoZGlyZWN0aW9uID09IERJUkVDVElPTl9ET1dOKSB7XHJcbiAgICAgICAgcmV0dXJuICdkb3duJztcclxuICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09IERJUkVDVElPTl9VUCkge1xyXG4gICAgICAgIHJldHVybiAndXAnO1xyXG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT0gRElSRUNUSU9OX0xFRlQpIHtcclxuICAgICAgICByZXR1cm4gJ2xlZnQnO1xyXG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT0gRElSRUNUSU9OX1JJR0hUKSB7XHJcbiAgICAgICAgcmV0dXJuICdyaWdodCc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJyc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBnZXQgYSByZWNvZ25pemVyIGJ5IG5hbWUgaWYgaXQgaXMgYm91bmQgdG8gYSBtYW5hZ2VyXHJcbiAqIEBwYXJhbSB7UmVjb2duaXplcnxTdHJpbmd9IG90aGVyUmVjb2duaXplclxyXG4gKiBAcGFyYW0ge1JlY29nbml6ZXJ9IHJlY29nbml6ZXJcclxuICogQHJldHVybnMge1JlY29nbml6ZXJ9XHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRSZWNvZ25pemVyQnlOYW1lSWZNYW5hZ2VyKG90aGVyUmVjb2duaXplciwgcmVjb2duaXplcikge1xyXG4gICAgdmFyIG1hbmFnZXIgPSByZWNvZ25pemVyLm1hbmFnZXI7XHJcbiAgICBpZiAobWFuYWdlcikge1xyXG4gICAgICAgIHJldHVybiBtYW5hZ2VyLmdldChvdGhlclJlY29nbml6ZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG90aGVyUmVjb2duaXplcjtcclxufVxyXG5cclxuLyoqXHJcbiAqIFRoaXMgcmVjb2duaXplciBpcyBqdXN0IHVzZWQgYXMgYSBiYXNlIGZvciB0aGUgc2ltcGxlIGF0dHJpYnV0ZSByZWNvZ25pemVycy5cclxuICogQGNvbnN0cnVjdG9yXHJcbiAqIEBleHRlbmRzIFJlY29nbml6ZXJcclxuICovXHJcbmZ1bmN0aW9uIEF0dHJSZWNvZ25pemVyKCkge1xyXG4gICAgUmVjb2duaXplci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG59XHJcblxyXG5pbmhlcml0KEF0dHJSZWNvZ25pemVyLCBSZWNvZ25pemVyLCB7XHJcbiAgICAvKipcclxuICAgICAqIEBuYW1lc3BhY2VcclxuICAgICAqIEBtZW1iZXJvZiBBdHRyUmVjb2duaXplclxyXG4gICAgICovXHJcbiAgICBkZWZhdWx0czoge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEB0eXBlIHtOdW1iZXJ9XHJcbiAgICAgICAgICogQGRlZmF1bHQgMVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHBvaW50ZXJzOiAxXHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogVXNlZCB0byBjaGVjayBpZiBpdCB0aGUgcmVjb2duaXplciByZWNlaXZlcyB2YWxpZCBpbnB1dCwgbGlrZSBpbnB1dC5kaXN0YW5jZSA+IDEwLlxyXG4gICAgICogQG1lbWJlcm9mIEF0dHJSZWNvZ25pemVyXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gaW5wdXRcclxuICAgICAqIEByZXR1cm5zIHtCb29sZWFufSByZWNvZ25pemVkXHJcbiAgICAgKi9cclxuICAgIGF0dHJUZXN0OiBmdW5jdGlvbihpbnB1dCkge1xyXG4gICAgICAgIHZhciBvcHRpb25Qb2ludGVycyA9IHRoaXMub3B0aW9ucy5wb2ludGVycztcclxuICAgICAgICByZXR1cm4gb3B0aW9uUG9pbnRlcnMgPT09IDAgfHwgaW5wdXQucG9pbnRlcnMubGVuZ3RoID09PSBvcHRpb25Qb2ludGVycztcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQcm9jZXNzIHRoZSBpbnB1dCBhbmQgcmV0dXJuIHRoZSBzdGF0ZSBmb3IgdGhlIHJlY29nbml6ZXJcclxuICAgICAqIEBtZW1iZXJvZiBBdHRyUmVjb2duaXplclxyXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0XHJcbiAgICAgKiBAcmV0dXJucyB7Kn0gU3RhdGVcclxuICAgICAqL1xyXG4gICAgcHJvY2VzczogZnVuY3Rpb24oaW5wdXQpIHtcclxuICAgICAgICB2YXIgc3RhdGUgPSB0aGlzLnN0YXRlO1xyXG4gICAgICAgIHZhciBldmVudFR5cGUgPSBpbnB1dC5ldmVudFR5cGU7XHJcblxyXG4gICAgICAgIHZhciBpc1JlY29nbml6ZWQgPSBzdGF0ZSAmIChTVEFURV9CRUdBTiB8IFNUQVRFX0NIQU5HRUQpO1xyXG4gICAgICAgIHZhciBpc1ZhbGlkID0gdGhpcy5hdHRyVGVzdChpbnB1dCk7XHJcblxyXG4gICAgICAgIC8vIG9uIGNhbmNlbCBpbnB1dCBhbmQgd2UndmUgcmVjb2duaXplZCBiZWZvcmUsIHJldHVybiBTVEFURV9DQU5DRUxMRURcclxuICAgICAgICBpZiAoaXNSZWNvZ25pemVkICYmIChldmVudFR5cGUgJiBJTlBVVF9DQU5DRUwgfHwgIWlzVmFsaWQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZSB8IFNUQVRFX0NBTkNFTExFRDtcclxuICAgICAgICB9IGVsc2UgaWYgKGlzUmVjb2duaXplZCB8fCBpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGlmIChldmVudFR5cGUgJiBJTlBVVF9FTkQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZSB8IFNUQVRFX0VOREVEO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKCEoc3RhdGUgJiBTVEFURV9CRUdBTikpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBTVEFURV9CRUdBTjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gc3RhdGUgfCBTVEFURV9DSEFOR0VEO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gU1RBVEVfRkFJTEVEO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBQYW5cclxuICogUmVjb2duaXplZCB3aGVuIHRoZSBwb2ludGVyIGlzIGRvd24gYW5kIG1vdmVkIGluIHRoZSBhbGxvd2VkIGRpcmVjdGlvbi5cclxuICogQGNvbnN0cnVjdG9yXHJcbiAqIEBleHRlbmRzIEF0dHJSZWNvZ25pemVyXHJcbiAqL1xyXG5mdW5jdGlvbiBQYW5SZWNvZ25pemVyKCkge1xyXG4gICAgQXR0clJlY29nbml6ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxuXHJcbiAgICB0aGlzLnBYID0gbnVsbDtcclxuICAgIHRoaXMucFkgPSBudWxsO1xyXG59XHJcblxyXG5pbmhlcml0KFBhblJlY29nbml6ZXIsIEF0dHJSZWNvZ25pemVyLCB7XHJcbiAgICAvKipcclxuICAgICAqIEBuYW1lc3BhY2VcclxuICAgICAqIEBtZW1iZXJvZiBQYW5SZWNvZ25pemVyXHJcbiAgICAgKi9cclxuICAgIGRlZmF1bHRzOiB7XHJcbiAgICAgICAgZXZlbnQ6ICdwYW4nLFxyXG4gICAgICAgIHRocmVzaG9sZDogMTAsXHJcbiAgICAgICAgcG9pbnRlcnM6IDEsXHJcbiAgICAgICAgZGlyZWN0aW9uOiBESVJFQ1RJT05fQUxMXHJcbiAgICB9LFxyXG5cclxuICAgIGdldFRvdWNoQWN0aW9uOiBmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgZGlyZWN0aW9uID0gdGhpcy5vcHRpb25zLmRpcmVjdGlvbjtcclxuICAgICAgICB2YXIgYWN0aW9ucyA9IFtdO1xyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gJiBESVJFQ1RJT05fSE9SSVpPTlRBTCkge1xyXG4gICAgICAgICAgICBhY3Rpb25zLnB1c2goVE9VQ0hfQUNUSU9OX1BBTl9ZKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGRpcmVjdGlvbiAmIERJUkVDVElPTl9WRVJUSUNBTCkge1xyXG4gICAgICAgICAgICBhY3Rpb25zLnB1c2goVE9VQ0hfQUNUSU9OX1BBTl9YKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGFjdGlvbnM7XHJcbiAgICB9LFxyXG5cclxuICAgIGRpcmVjdGlvblRlc3Q6IGZ1bmN0aW9uKGlucHV0KSB7XHJcbiAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XHJcbiAgICAgICAgdmFyIGhhc01vdmVkID0gdHJ1ZTtcclxuICAgICAgICB2YXIgZGlzdGFuY2UgPSBpbnB1dC5kaXN0YW5jZTtcclxuICAgICAgICB2YXIgZGlyZWN0aW9uID0gaW5wdXQuZGlyZWN0aW9uO1xyXG4gICAgICAgIHZhciB4ID0gaW5wdXQuZGVsdGFYO1xyXG4gICAgICAgIHZhciB5ID0gaW5wdXQuZGVsdGFZO1xyXG5cclxuICAgICAgICAvLyBsb2NrIHRvIGF4aXM/XHJcbiAgICAgICAgaWYgKCEoZGlyZWN0aW9uICYgb3B0aW9ucy5kaXJlY3Rpb24pKSB7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLmRpcmVjdGlvbiAmIERJUkVDVElPTl9IT1JJWk9OVEFMKSB7XHJcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAoeCA9PT0gMCkgPyBESVJFQ1RJT05fTk9ORSA6ICh4IDwgMCkgPyBESVJFQ1RJT05fTEVGVCA6IERJUkVDVElPTl9SSUdIVDtcclxuICAgICAgICAgICAgICAgIGhhc01vdmVkID0geCAhPSB0aGlzLnBYO1xyXG4gICAgICAgICAgICAgICAgZGlzdGFuY2UgPSBNYXRoLmFicyhpbnB1dC5kZWx0YVgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gKHkgPT09IDApID8gRElSRUNUSU9OX05PTkUgOiAoeSA8IDApID8gRElSRUNUSU9OX1VQIDogRElSRUNUSU9OX0RPV047XHJcbiAgICAgICAgICAgICAgICBoYXNNb3ZlZCA9IHkgIT0gdGhpcy5wWTtcclxuICAgICAgICAgICAgICAgIGRpc3RhbmNlID0gTWF0aC5hYnMoaW5wdXQuZGVsdGFZKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpbnB1dC5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XHJcbiAgICAgICAgcmV0dXJuIGhhc01vdmVkICYmIGRpc3RhbmNlID4gb3B0aW9ucy50aHJlc2hvbGQgJiYgZGlyZWN0aW9uICYgb3B0aW9ucy5kaXJlY3Rpb247XHJcbiAgICB9LFxyXG5cclxuICAgIGF0dHJUZXN0OiBmdW5jdGlvbihpbnB1dCkge1xyXG4gICAgICAgIHJldHVybiBBdHRyUmVjb2duaXplci5wcm90b3R5cGUuYXR0clRlc3QuY2FsbCh0aGlzLCBpbnB1dCkgJiZcclxuICAgICAgICAgICAgKHRoaXMuc3RhdGUgJiBTVEFURV9CRUdBTiB8fCAoISh0aGlzLnN0YXRlICYgU1RBVEVfQkVHQU4pICYmIHRoaXMuZGlyZWN0aW9uVGVzdChpbnB1dCkpKTtcclxuICAgIH0sXHJcblxyXG4gICAgZW1pdDogZnVuY3Rpb24oaW5wdXQpIHtcclxuXHJcbiAgICAgICAgdGhpcy5wWCA9IGlucHV0LmRlbHRhWDtcclxuICAgICAgICB0aGlzLnBZID0gaW5wdXQuZGVsdGFZO1xyXG5cclxuICAgICAgICB2YXIgZGlyZWN0aW9uID0gZGlyZWN0aW9uU3RyKGlucHV0LmRpcmVjdGlvbik7XHJcblxyXG4gICAgICAgIGlmIChkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgaW5wdXQuYWRkaXRpb25hbEV2ZW50ID0gdGhpcy5vcHRpb25zLmV2ZW50ICsgZGlyZWN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9zdXBlci5lbWl0LmNhbGwodGhpcywgaW5wdXQpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBQaW5jaFxyXG4gKiBSZWNvZ25pemVkIHdoZW4gdHdvIG9yIG1vcmUgcG9pbnRlcnMgYXJlIG1vdmluZyB0b3dhcmQgKHpvb20taW4pIG9yIGF3YXkgZnJvbSBlYWNoIG90aGVyICh6b29tLW91dCkuXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKiBAZXh0ZW5kcyBBdHRyUmVjb2duaXplclxyXG4gKi9cclxuZnVuY3Rpb24gUGluY2hSZWNvZ25pemVyKCkge1xyXG4gICAgQXR0clJlY29nbml6ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufVxyXG5cclxuaW5oZXJpdChQaW5jaFJlY29nbml6ZXIsIEF0dHJSZWNvZ25pemVyLCB7XHJcbiAgICAvKipcclxuICAgICAqIEBuYW1lc3BhY2VcclxuICAgICAqIEBtZW1iZXJvZiBQaW5jaFJlY29nbml6ZXJcclxuICAgICAqL1xyXG4gICAgZGVmYXVsdHM6IHtcclxuICAgICAgICBldmVudDogJ3BpbmNoJyxcclxuICAgICAgICB0aHJlc2hvbGQ6IDAsXHJcbiAgICAgICAgcG9pbnRlcnM6IDJcclxuICAgIH0sXHJcblxyXG4gICAgZ2V0VG91Y2hBY3Rpb246IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBbVE9VQ0hfQUNUSU9OX05PTkVdO1xyXG4gICAgfSxcclxuXHJcbiAgICBhdHRyVGVzdDogZnVuY3Rpb24oaW5wdXQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc3VwZXIuYXR0clRlc3QuY2FsbCh0aGlzLCBpbnB1dCkgJiZcclxuICAgICAgICAgICAgKE1hdGguYWJzKGlucHV0LnNjYWxlIC0gMSkgPiB0aGlzLm9wdGlvbnMudGhyZXNob2xkIHx8IHRoaXMuc3RhdGUgJiBTVEFURV9CRUdBTik7XHJcbiAgICB9LFxyXG5cclxuICAgIGVtaXQ6IGZ1bmN0aW9uKGlucHV0KSB7XHJcbiAgICAgICAgaWYgKGlucHV0LnNjYWxlICE9PSAxKSB7XHJcbiAgICAgICAgICAgIHZhciBpbk91dCA9IGlucHV0LnNjYWxlIDwgMSA/ICdpbicgOiAnb3V0JztcclxuICAgICAgICAgICAgaW5wdXQuYWRkaXRpb25hbEV2ZW50ID0gdGhpcy5vcHRpb25zLmV2ZW50ICsgaW5PdXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3N1cGVyLmVtaXQuY2FsbCh0aGlzLCBpbnB1dCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIFByZXNzXHJcbiAqIFJlY29nbml6ZWQgd2hlbiB0aGUgcG9pbnRlciBpcyBkb3duIGZvciB4IG1zIHdpdGhvdXQgYW55IG1vdmVtZW50LlxyXG4gKiBAY29uc3RydWN0b3JcclxuICogQGV4dGVuZHMgUmVjb2duaXplclxyXG4gKi9cclxuZnVuY3Rpb24gUHJlc3NSZWNvZ25pemVyKCkge1xyXG4gICAgUmVjb2duaXplci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cclxuICAgIHRoaXMuX3RpbWVyID0gbnVsbDtcclxuICAgIHRoaXMuX2lucHV0ID0gbnVsbDtcclxufVxyXG5cclxuaW5oZXJpdChQcmVzc1JlY29nbml6ZXIsIFJlY29nbml6ZXIsIHtcclxuICAgIC8qKlxyXG4gICAgICogQG5hbWVzcGFjZVxyXG4gICAgICogQG1lbWJlcm9mIFByZXNzUmVjb2duaXplclxyXG4gICAgICovXHJcbiAgICBkZWZhdWx0czoge1xyXG4gICAgICAgIGV2ZW50OiAncHJlc3MnLFxyXG4gICAgICAgIHBvaW50ZXJzOiAxLFxyXG4gICAgICAgIHRpbWU6IDI1MSwgLy8gbWluaW1hbCB0aW1lIG9mIHRoZSBwb2ludGVyIHRvIGJlIHByZXNzZWRcclxuICAgICAgICB0aHJlc2hvbGQ6IDkgLy8gYSBtaW5pbWFsIG1vdmVtZW50IGlzIG9rLCBidXQga2VlcCBpdCBsb3dcclxuICAgIH0sXHJcblxyXG4gICAgZ2V0VG91Y2hBY3Rpb246IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBbVE9VQ0hfQUNUSU9OX0FVVE9dO1xyXG4gICAgfSxcclxuXHJcbiAgICBwcm9jZXNzOiBmdW5jdGlvbihpbnB1dCkge1xyXG4gICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xyXG4gICAgICAgIHZhciB2YWxpZFBvaW50ZXJzID0gaW5wdXQucG9pbnRlcnMubGVuZ3RoID09PSBvcHRpb25zLnBvaW50ZXJzO1xyXG4gICAgICAgIHZhciB2YWxpZE1vdmVtZW50ID0gaW5wdXQuZGlzdGFuY2UgPCBvcHRpb25zLnRocmVzaG9sZDtcclxuICAgICAgICB2YXIgdmFsaWRUaW1lID0gaW5wdXQuZGVsdGFUaW1lID4gb3B0aW9ucy50aW1lO1xyXG5cclxuICAgICAgICB0aGlzLl9pbnB1dCA9IGlucHV0O1xyXG5cclxuICAgICAgICAvLyB3ZSBvbmx5IGFsbG93IGxpdHRsZSBtb3ZlbWVudFxyXG4gICAgICAgIC8vIGFuZCB3ZSd2ZSByZWFjaGVkIGFuIGVuZCBldmVudCwgc28gYSB0YXAgaXMgcG9zc2libGVcclxuICAgICAgICBpZiAoIXZhbGlkTW92ZW1lbnQgfHwgIXZhbGlkUG9pbnRlcnMgfHwgKGlucHV0LmV2ZW50VHlwZSAmIChJTlBVVF9FTkQgfCBJTlBVVF9DQU5DRUwpICYmICF2YWxpZFRpbWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGlucHV0LmV2ZW50VHlwZSAmIElOUFVUX1NUQVJUKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgICAgICAgICAgdGhpcy5fdGltZXIgPSBzZXRUaW1lb3V0Q29udGV4dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBTVEFURV9SRUNPR05JWkVEO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50cnlFbWl0KCk7XHJcbiAgICAgICAgICAgIH0sIG9wdGlvbnMudGltZSwgdGhpcyk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChpbnB1dC5ldmVudFR5cGUgJiBJTlBVVF9FTkQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFNUQVRFX1JFQ09HTklaRUQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBTVEFURV9GQUlMRUQ7XHJcbiAgICB9LFxyXG5cclxuICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlbWl0OiBmdW5jdGlvbihpbnB1dCkge1xyXG4gICAgICAgIGlmICh0aGlzLnN0YXRlICE9PSBTVEFURV9SRUNPR05JWkVEKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChpbnB1dCAmJiAoaW5wdXQuZXZlbnRUeXBlICYgSU5QVVRfRU5EKSkge1xyXG4gICAgICAgICAgICB0aGlzLm1hbmFnZXIuZW1pdCh0aGlzLm9wdGlvbnMuZXZlbnQgKyAndXAnLCBpbnB1dCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5faW5wdXQudGltZVN0YW1wID0gbm93KCk7XHJcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5lbWl0KHRoaXMub3B0aW9ucy5ldmVudCwgdGhpcy5faW5wdXQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcblxyXG4vKipcclxuICogUm90YXRlXHJcbiAqIFJlY29nbml6ZWQgd2hlbiB0d28gb3IgbW9yZSBwb2ludGVyIGFyZSBtb3ZpbmcgaW4gYSBjaXJjdWxhciBtb3Rpb24uXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKiBAZXh0ZW5kcyBBdHRyUmVjb2duaXplclxyXG4gKi9cclxuZnVuY3Rpb24gUm90YXRlUmVjb2duaXplcigpIHtcclxuICAgIEF0dHJSZWNvZ25pemVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn1cclxuXHJcbmluaGVyaXQoUm90YXRlUmVjb2duaXplciwgQXR0clJlY29nbml6ZXIsIHtcclxuICAgIC8qKlxyXG4gICAgICogQG5hbWVzcGFjZVxyXG4gICAgICogQG1lbWJlcm9mIFJvdGF0ZVJlY29nbml6ZXJcclxuICAgICAqL1xyXG4gICAgZGVmYXVsdHM6IHtcclxuICAgICAgICBldmVudDogJ3JvdGF0ZScsXHJcbiAgICAgICAgdGhyZXNob2xkOiAwLFxyXG4gICAgICAgIHBvaW50ZXJzOiAyXHJcbiAgICB9LFxyXG5cclxuICAgIGdldFRvdWNoQWN0aW9uOiBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gW1RPVUNIX0FDVElPTl9OT05FXTtcclxuICAgIH0sXHJcblxyXG4gICAgYXR0clRlc3Q6IGZ1bmN0aW9uKGlucHV0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyLmF0dHJUZXN0LmNhbGwodGhpcywgaW5wdXQpICYmXHJcbiAgICAgICAgICAgIChNYXRoLmFicyhpbnB1dC5yb3RhdGlvbikgPiB0aGlzLm9wdGlvbnMudGhyZXNob2xkIHx8IHRoaXMuc3RhdGUgJiBTVEFURV9CRUdBTik7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIFN3aXBlXHJcbiAqIFJlY29nbml6ZWQgd2hlbiB0aGUgcG9pbnRlciBpcyBtb3ZpbmcgZmFzdCAodmVsb2NpdHkpLCB3aXRoIGVub3VnaCBkaXN0YW5jZSBpbiB0aGUgYWxsb3dlZCBkaXJlY3Rpb24uXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKiBAZXh0ZW5kcyBBdHRyUmVjb2duaXplclxyXG4gKi9cclxuZnVuY3Rpb24gU3dpcGVSZWNvZ25pemVyKCkge1xyXG4gICAgQXR0clJlY29nbml6ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcclxufVxyXG5cclxuaW5oZXJpdChTd2lwZVJlY29nbml6ZXIsIEF0dHJSZWNvZ25pemVyLCB7XHJcbiAgICAvKipcclxuICAgICAqIEBuYW1lc3BhY2VcclxuICAgICAqIEBtZW1iZXJvZiBTd2lwZVJlY29nbml6ZXJcclxuICAgICAqL1xyXG4gICAgZGVmYXVsdHM6IHtcclxuICAgICAgICBldmVudDogJ3N3aXBlJyxcclxuICAgICAgICB0aHJlc2hvbGQ6IDEwLFxyXG4gICAgICAgIHZlbG9jaXR5OiAwLjMsXHJcbiAgICAgICAgZGlyZWN0aW9uOiBESVJFQ1RJT05fSE9SSVpPTlRBTCB8IERJUkVDVElPTl9WRVJUSUNBTCxcclxuICAgICAgICBwb2ludGVyczogMVxyXG4gICAgfSxcclxuXHJcbiAgICBnZXRUb3VjaEFjdGlvbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgcmV0dXJuIFBhblJlY29nbml6ZXIucHJvdG90eXBlLmdldFRvdWNoQWN0aW9uLmNhbGwodGhpcyk7XHJcbiAgICB9LFxyXG5cclxuICAgIGF0dHJUZXN0OiBmdW5jdGlvbihpbnB1dCkge1xyXG4gICAgICAgIHZhciBkaXJlY3Rpb24gPSB0aGlzLm9wdGlvbnMuZGlyZWN0aW9uO1xyXG4gICAgICAgIHZhciB2ZWxvY2l0eTtcclxuXHJcbiAgICAgICAgaWYgKGRpcmVjdGlvbiAmIChESVJFQ1RJT05fSE9SSVpPTlRBTCB8IERJUkVDVElPTl9WRVJUSUNBTCkpIHtcclxuICAgICAgICAgICAgdmVsb2NpdHkgPSBpbnB1dC5vdmVyYWxsVmVsb2NpdHk7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gJiBESVJFQ1RJT05fSE9SSVpPTlRBTCkge1xyXG4gICAgICAgICAgICB2ZWxvY2l0eSA9IGlucHV0Lm92ZXJhbGxWZWxvY2l0eVg7XHJcbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gJiBESVJFQ1RJT05fVkVSVElDQUwpIHtcclxuICAgICAgICAgICAgdmVsb2NpdHkgPSBpbnB1dC5vdmVyYWxsVmVsb2NpdHlZO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyLmF0dHJUZXN0LmNhbGwodGhpcywgaW5wdXQpICYmXHJcbiAgICAgICAgICAgIGRpcmVjdGlvbiAmIGlucHV0Lm9mZnNldERpcmVjdGlvbiAmJlxyXG4gICAgICAgICAgICBpbnB1dC5kaXN0YW5jZSA+IHRoaXMub3B0aW9ucy50aHJlc2hvbGQgJiZcclxuICAgICAgICAgICAgaW5wdXQubWF4UG9pbnRlcnMgPT0gdGhpcy5vcHRpb25zLnBvaW50ZXJzICYmXHJcbiAgICAgICAgICAgIGFicyh2ZWxvY2l0eSkgPiB0aGlzLm9wdGlvbnMudmVsb2NpdHkgJiYgaW5wdXQuZXZlbnRUeXBlICYgSU5QVVRfRU5EO1xyXG4gICAgfSxcclxuXHJcbiAgICBlbWl0OiBmdW5jdGlvbihpbnB1dCkge1xyXG4gICAgICAgIHZhciBkaXJlY3Rpb24gPSBkaXJlY3Rpb25TdHIoaW5wdXQub2Zmc2V0RGlyZWN0aW9uKTtcclxuICAgICAgICBpZiAoZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMubWFuYWdlci5lbWl0KHRoaXMub3B0aW9ucy5ldmVudCArIGRpcmVjdGlvbiwgaW5wdXQpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5tYW5hZ2VyLmVtaXQodGhpcy5vcHRpb25zLmV2ZW50LCBpbnB1dCk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEEgdGFwIGlzIGVjb2duaXplZCB3aGVuIHRoZSBwb2ludGVyIGlzIGRvaW5nIGEgc21hbGwgdGFwL2NsaWNrLiBNdWx0aXBsZSB0YXBzIGFyZSByZWNvZ25pemVkIGlmIHRoZXkgb2NjdXJcclxuICogYmV0d2VlbiB0aGUgZ2l2ZW4gaW50ZXJ2YWwgYW5kIHBvc2l0aW9uLiBUaGUgZGVsYXkgb3B0aW9uIGNhbiBiZSB1c2VkIHRvIHJlY29nbml6ZSBtdWx0aS10YXBzIHdpdGhvdXQgZmlyaW5nXHJcbiAqIGEgc2luZ2xlIHRhcC5cclxuICpcclxuICogVGhlIGV2ZW50RGF0YSBmcm9tIHRoZSBlbWl0dGVkIGV2ZW50IGNvbnRhaW5zIHRoZSBwcm9wZXJ0eSBgdGFwQ291bnRgLCB3aGljaCBjb250YWlucyB0aGUgYW1vdW50IG9mXHJcbiAqIG11bHRpLXRhcHMgYmVpbmcgcmVjb2duaXplZC5cclxuICogQGNvbnN0cnVjdG9yXHJcbiAqIEBleHRlbmRzIFJlY29nbml6ZXJcclxuICovXHJcbmZ1bmN0aW9uIFRhcFJlY29nbml6ZXIoKSB7XHJcbiAgICBSZWNvZ25pemVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblxyXG4gICAgLy8gcHJldmlvdXMgdGltZSBhbmQgY2VudGVyLFxyXG4gICAgLy8gdXNlZCBmb3IgdGFwIGNvdW50aW5nXHJcbiAgICB0aGlzLnBUaW1lID0gZmFsc2U7XHJcbiAgICB0aGlzLnBDZW50ZXIgPSBmYWxzZTtcclxuXHJcbiAgICB0aGlzLl90aW1lciA9IG51bGw7XHJcbiAgICB0aGlzLl9pbnB1dCA9IG51bGw7XHJcbiAgICB0aGlzLmNvdW50ID0gMDtcclxufVxyXG5cclxuaW5oZXJpdChUYXBSZWNvZ25pemVyLCBSZWNvZ25pemVyLCB7XHJcbiAgICAvKipcclxuICAgICAqIEBuYW1lc3BhY2VcclxuICAgICAqIEBtZW1iZXJvZiBQaW5jaFJlY29nbml6ZXJcclxuICAgICAqL1xyXG4gICAgZGVmYXVsdHM6IHtcclxuICAgICAgICBldmVudDogJ3RhcCcsXHJcbiAgICAgICAgcG9pbnRlcnM6IDEsXHJcbiAgICAgICAgdGFwczogMSxcclxuICAgICAgICBpbnRlcnZhbDogMzAwLCAvLyBtYXggdGltZSBiZXR3ZWVuIHRoZSBtdWx0aS10YXAgdGFwc1xyXG4gICAgICAgIHRpbWU6IDI1MCwgLy8gbWF4IHRpbWUgb2YgdGhlIHBvaW50ZXIgdG8gYmUgZG93biAobGlrZSBmaW5nZXIgb24gdGhlIHNjcmVlbilcclxuICAgICAgICB0aHJlc2hvbGQ6IDksIC8vIGEgbWluaW1hbCBtb3ZlbWVudCBpcyBvaywgYnV0IGtlZXAgaXQgbG93XHJcbiAgICAgICAgcG9zVGhyZXNob2xkOiAxMCAvLyBhIG11bHRpLXRhcCBjYW4gYmUgYSBiaXQgb2ZmIHRoZSBpbml0aWFsIHBvc2l0aW9uXHJcbiAgICB9LFxyXG5cclxuICAgIGdldFRvdWNoQWN0aW9uOiBmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gW1RPVUNIX0FDVElPTl9NQU5JUFVMQVRJT05dO1xyXG4gICAgfSxcclxuXHJcbiAgICBwcm9jZXNzOiBmdW5jdGlvbihpbnB1dCkge1xyXG4gICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zO1xyXG5cclxuICAgICAgICB2YXIgdmFsaWRQb2ludGVycyA9IGlucHV0LnBvaW50ZXJzLmxlbmd0aCA9PT0gb3B0aW9ucy5wb2ludGVycztcclxuICAgICAgICB2YXIgdmFsaWRNb3ZlbWVudCA9IGlucHV0LmRpc3RhbmNlIDwgb3B0aW9ucy50aHJlc2hvbGQ7XHJcbiAgICAgICAgdmFyIHZhbGlkVG91Y2hUaW1lID0gaW5wdXQuZGVsdGFUaW1lIDwgb3B0aW9ucy50aW1lO1xyXG5cclxuICAgICAgICB0aGlzLnJlc2V0KCk7XHJcblxyXG4gICAgICAgIGlmICgoaW5wdXQuZXZlbnRUeXBlICYgSU5QVVRfU1RBUlQpICYmICh0aGlzLmNvdW50ID09PSAwKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mYWlsVGltZW91dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gd2Ugb25seSBhbGxvdyBsaXR0bGUgbW92ZW1lbnRcclxuICAgICAgICAvLyBhbmQgd2UndmUgcmVhY2hlZCBhbiBlbmQgZXZlbnQsIHNvIGEgdGFwIGlzIHBvc3NpYmxlXHJcbiAgICAgICAgaWYgKHZhbGlkTW92ZW1lbnQgJiYgdmFsaWRUb3VjaFRpbWUgJiYgdmFsaWRQb2ludGVycykge1xyXG4gICAgICAgICAgICBpZiAoaW5wdXQuZXZlbnRUeXBlICE9IElOUFVUX0VORCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmFpbFRpbWVvdXQoKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHZhbGlkSW50ZXJ2YWwgPSB0aGlzLnBUaW1lID8gKGlucHV0LnRpbWVTdGFtcCAtIHRoaXMucFRpbWUgPCBvcHRpb25zLmludGVydmFsKSA6IHRydWU7XHJcbiAgICAgICAgICAgIHZhciB2YWxpZE11bHRpVGFwID0gIXRoaXMucENlbnRlciB8fCBnZXREaXN0YW5jZSh0aGlzLnBDZW50ZXIsIGlucHV0LmNlbnRlcikgPCBvcHRpb25zLnBvc1RocmVzaG9sZDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMucFRpbWUgPSBpbnB1dC50aW1lU3RhbXA7XHJcbiAgICAgICAgICAgIHRoaXMucENlbnRlciA9IGlucHV0LmNlbnRlcjtcclxuXHJcbiAgICAgICAgICAgIGlmICghdmFsaWRNdWx0aVRhcCB8fCAhdmFsaWRJbnRlcnZhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb3VudCA9IDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvdW50ICs9IDE7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuX2lucHV0ID0gaW5wdXQ7XHJcblxyXG4gICAgICAgICAgICAvLyBpZiB0YXAgY291bnQgbWF0Y2hlcyB3ZSBoYXZlIHJlY29nbml6ZWQgaXQsXHJcbiAgICAgICAgICAgIC8vIGVsc2UgaXQgaGFzIGJlZ2FuIHJlY29nbml6aW5nLi4uXHJcbiAgICAgICAgICAgIHZhciB0YXBDb3VudCA9IHRoaXMuY291bnQgJSBvcHRpb25zLnRhcHM7XHJcbiAgICAgICAgICAgIGlmICh0YXBDb3VudCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gbm8gZmFpbGluZyByZXF1aXJlbWVudHMsIGltbWVkaWF0ZWx5IHRyaWdnZXIgdGhlIHRhcCBldmVudFxyXG4gICAgICAgICAgICAgICAgLy8gb3Igd2FpdCBhcyBsb25nIGFzIHRoZSBtdWx0aXRhcCBpbnRlcnZhbCB0byB0cmlnZ2VyXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaGFzUmVxdWlyZUZhaWx1cmVzKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gU1RBVEVfUkVDT0dOSVpFRDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGltZXIgPSBzZXRUaW1lb3V0Q29udGV4dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFNUQVRFX1JFQ09HTklaRUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJ5RW1pdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIG9wdGlvbnMuaW50ZXJ2YWwsIHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTVEFURV9CRUdBTjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gU1RBVEVfRkFJTEVEO1xyXG4gICAgfSxcclxuXHJcbiAgICBmYWlsVGltZW91dDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5fdGltZXIgPSBzZXRUaW1lb3V0Q29udGV4dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IFNUQVRFX0ZBSUxFRDtcclxuICAgICAgICB9LCB0aGlzLm9wdGlvbnMuaW50ZXJ2YWwsIHRoaXMpO1xyXG4gICAgICAgIHJldHVybiBTVEFURV9GQUlMRUQ7XHJcbiAgICB9LFxyXG5cclxuICAgIHJlc2V0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpO1xyXG4gICAgfSxcclxuXHJcbiAgICBlbWl0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAodGhpcy5zdGF0ZSA9PSBTVEFURV9SRUNPR05JWkVEKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2lucHV0LnRhcENvdW50ID0gdGhpcy5jb3VudDtcclxuICAgICAgICAgICAgdGhpcy5tYW5hZ2VyLmVtaXQodGhpcy5vcHRpb25zLmV2ZW50LCB0aGlzLl9pbnB1dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiBTaW1wbGUgd2F5IHRvIGNyZWF0ZSBhIG1hbmFnZXIgd2l0aCBhIGRlZmF1bHQgc2V0IG9mIHJlY29nbml6ZXJzLlxyXG4gKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbGVtZW50XHJcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cclxuICogQGNvbnN0cnVjdG9yXHJcbiAqL1xyXG5mdW5jdGlvbiBOR0hhbW1lcihlbGVtZW50LCBvcHRpb25zKSB7XHJcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcclxuICAgIG9wdGlvbnMucmVjb2duaXplcnMgPSBpZlVuZGVmaW5lZChvcHRpb25zLnJlY29nbml6ZXJzLCBOR0hhbW1lci5kZWZhdWx0cy5wcmVzZXQpO1xyXG4gICAgcmV0dXJuIG5ldyBNYW5hZ2VyKGVsZW1lbnQsIG9wdGlvbnMpO1xyXG59XHJcblxyXG4vKipcclxuICogQGNvbnN0IHtzdHJpbmd9XHJcbiAqL1xyXG5OR0hhbW1lci5WRVJTSU9OID0gJzIuMC43JztcclxuXHJcbi8qKlxyXG4gKiBkZWZhdWx0IHNldHRpbmdzXHJcbiAqIEBuYW1lc3BhY2VcclxuICovXHJcbk5HSGFtbWVyLmRlZmF1bHRzID0ge1xyXG4gICAgLyoqXHJcbiAgICAgKiBzZXQgaWYgRE9NIGV2ZW50cyBhcmUgYmVpbmcgdHJpZ2dlcmVkLlxyXG4gICAgICogQnV0IHRoaXMgaXMgc2xvd2VyIGFuZCB1bnVzZWQgYnkgc2ltcGxlIGltcGxlbWVudGF0aW9ucywgc28gZGlzYWJsZWQgYnkgZGVmYXVsdC5cclxuICAgICAqIEB0eXBlIHtCb29sZWFufVxyXG4gICAgICogQGRlZmF1bHQgZmFsc2VcclxuICAgICAqL1xyXG4gICAgZG9tRXZlbnRzOiBmYWxzZSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIFRoZSB2YWx1ZSBmb3IgdGhlIHRvdWNoQWN0aW9uIHByb3BlcnR5L2ZhbGxiYWNrLlxyXG4gICAgICogV2hlbiBzZXQgdG8gYGNvbXB1dGVgIGl0IHdpbGwgbWFnaWNhbGx5IHNldCB0aGUgY29ycmVjdCB2YWx1ZSBiYXNlZCBvbiB0aGUgYWRkZWQgcmVjb2duaXplcnMuXHJcbiAgICAgKiBAdHlwZSB7U3RyaW5nfVxyXG4gICAgICogQGRlZmF1bHQgY29tcHV0ZVxyXG4gICAgICovXHJcbiAgICB0b3VjaEFjdGlvbjogVE9VQ0hfQUNUSU9OX0NPTVBVVEUsXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBAdHlwZSB7Qm9vbGVhbn1cclxuICAgICAqIEBkZWZhdWx0IHRydWVcclxuICAgICAqL1xyXG4gICAgZW5hYmxlOiB0cnVlLFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRVhQRVJJTUVOVEFMIEZFQVRVUkUgLS0gY2FuIGJlIHJlbW92ZWQvY2hhbmdlZFxyXG4gICAgICogQ2hhbmdlIHRoZSBwYXJlbnQgaW5wdXQgdGFyZ2V0IGVsZW1lbnQuXHJcbiAgICAgKiBJZiBOdWxsLCB0aGVuIGl0IGlzIGJlaW5nIHNldCB0aGUgdG8gbWFpbiBlbGVtZW50LlxyXG4gICAgICogQHR5cGUge051bGx8RXZlbnRUYXJnZXR9XHJcbiAgICAgKiBAZGVmYXVsdCBudWxsXHJcbiAgICAgKi9cclxuICAgIGlucHV0VGFyZ2V0OiBudWxsLFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogZm9yY2UgYW4gaW5wdXQgY2xhc3NcclxuICAgICAqIEB0eXBlIHtOdWxsfEZ1bmN0aW9ufVxyXG4gICAgICogQGRlZmF1bHQgbnVsbFxyXG4gICAgICovXHJcbiAgICBpbnB1dENsYXNzOiBudWxsLFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRGVmYXVsdCByZWNvZ25pemVyIHNldHVwIHdoZW4gY2FsbGluZyBgTkdIYW1tZXIoKWBcclxuICAgICAqIFdoZW4gY3JlYXRpbmcgYSBuZXcgTWFuYWdlciB0aGVzZSB3aWxsIGJlIHNraXBwZWQuXHJcbiAgICAgKiBAdHlwZSB7QXJyYXl9XHJcbiAgICAgKi9cclxuICAgIHByZXNldDogW1xyXG4gICAgICAgIC8vIFJlY29nbml6ZXJDbGFzcywgb3B0aW9ucywgW3JlY29nbml6ZVdpdGgsIC4uLl0sIFtyZXF1aXJlRmFpbHVyZSwgLi4uXVxyXG4gICAgICAgIFtSb3RhdGVSZWNvZ25pemVyLCB7ZW5hYmxlOiBmYWxzZX1dLFxyXG4gICAgICAgIFtQaW5jaFJlY29nbml6ZXIsIHtlbmFibGU6IGZhbHNlfSwgWydyb3RhdGUnXV0sXHJcbiAgICAgICAgW1N3aXBlUmVjb2duaXplciwge2RpcmVjdGlvbjogRElSRUNUSU9OX0hPUklaT05UQUx9XSxcclxuICAgICAgICBbUGFuUmVjb2duaXplciwge2RpcmVjdGlvbjogRElSRUNUSU9OX0hPUklaT05UQUx9LCBbJ3N3aXBlJ11dLFxyXG4gICAgICAgIFtUYXBSZWNvZ25pemVyXSxcclxuICAgICAgICBbVGFwUmVjb2duaXplciwge2V2ZW50OiAnZG91YmxldGFwJywgdGFwczogMn0sIFsndGFwJ11dLFxyXG4gICAgICAgIFtQcmVzc1JlY29nbml6ZXJdXHJcbiAgICBdLFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU29tZSBDU1MgcHJvcGVydGllcyBjYW4gYmUgdXNlZCB0byBpbXByb3ZlIHRoZSB3b3JraW5nIG9mIE5HSGFtbWVyLlxyXG4gICAgICogQWRkIHRoZW0gdG8gdGhpcyBtZXRob2QgYW5kIHRoZXkgd2lsbCBiZSBzZXQgd2hlbiBjcmVhdGluZyBhIG5ldyBNYW5hZ2VyLlxyXG4gICAgICogQG5hbWVzcGFjZVxyXG4gICAgICovXHJcbiAgICBjc3NQcm9wczoge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERpc2FibGVzIHRleHQgc2VsZWN0aW9uIHRvIGltcHJvdmUgdGhlIGRyYWdnaW5nIGdlc3R1cmUuIE1haW5seSBmb3IgZGVza3RvcCBicm93c2Vycy5cclxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxyXG4gICAgICAgICAqIEBkZWZhdWx0ICdub25lJ1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHVzZXJTZWxlY3Q6ICdub25lJyxcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRGlzYWJsZSB0aGUgV2luZG93cyBQaG9uZSBncmlwcGVycyB3aGVuIHByZXNzaW5nIGFuIGVsZW1lbnQuXHJcbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cclxuICAgICAgICAgKiBAZGVmYXVsdCAnbm9uZSdcclxuICAgICAgICAgKi9cclxuICAgICAgICB0b3VjaFNlbGVjdDogJ25vbmUnLFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEaXNhYmxlcyB0aGUgZGVmYXVsdCBjYWxsb3V0IHNob3duIHdoZW4geW91IHRvdWNoIGFuZCBob2xkIGEgdG91Y2ggdGFyZ2V0LlxyXG4gICAgICAgICAqIE9uIGlPUywgd2hlbiB5b3UgdG91Y2ggYW5kIGhvbGQgYSB0b3VjaCB0YXJnZXQgc3VjaCBhcyBhIGxpbmssIFNhZmFyaSBkaXNwbGF5c1xyXG4gICAgICAgICAqIGEgY2FsbG91dCBjb250YWluaW5nIGluZm9ybWF0aW9uIGFib3V0IHRoZSBsaW5rLiBUaGlzIHByb3BlcnR5IGFsbG93cyB5b3UgdG8gZGlzYWJsZSB0aGF0IGNhbGxvdXQuXHJcbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cclxuICAgICAgICAgKiBAZGVmYXVsdCAnbm9uZSdcclxuICAgICAgICAgKi9cclxuICAgICAgICB0b3VjaENhbGxvdXQ6ICdub25lJyxcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogU3BlY2lmaWVzIHdoZXRoZXIgem9vbWluZyBpcyBlbmFibGVkLiBVc2VkIGJ5IElFMTA+XHJcbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cclxuICAgICAgICAgKiBAZGVmYXVsdCAnbm9uZSdcclxuICAgICAgICAgKi9cclxuICAgICAgICBjb250ZW50Wm9vbWluZzogJ25vbmUnLFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBTcGVjaWZpZXMgdGhhdCBhbiBlbnRpcmUgZWxlbWVudCBzaG91bGQgYmUgZHJhZ2dhYmxlIGluc3RlYWQgb2YgaXRzIGNvbnRlbnRzLiBNYWlubHkgZm9yIGRlc2t0b3AgYnJvd3NlcnMuXHJcbiAgICAgICAgICogQHR5cGUge1N0cmluZ31cclxuICAgICAgICAgKiBAZGVmYXVsdCAnbm9uZSdcclxuICAgICAgICAgKi9cclxuICAgICAgICB1c2VyRHJhZzogJ25vbmUnLFxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBPdmVycmlkZXMgdGhlIGhpZ2hsaWdodCBjb2xvciBzaG93biB3aGVuIHRoZSB1c2VyIHRhcHMgYSBsaW5rIG9yIGEgSmF2YVNjcmlwdFxyXG4gICAgICAgICAqIGNsaWNrYWJsZSBlbGVtZW50IGluIGlPUy4gVGhpcyBwcm9wZXJ0eSBvYmV5cyB0aGUgYWxwaGEgdmFsdWUsIGlmIHNwZWNpZmllZC5cclxuICAgICAgICAgKiBAdHlwZSB7U3RyaW5nfVxyXG4gICAgICAgICAqIEBkZWZhdWx0ICdyZ2JhKDAsMCwwLDApJ1xyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRhcEhpZ2hsaWdodENvbG9yOiAncmdiYSgwLDAsMCwwKSdcclxuICAgIH1cclxufTtcclxuXHJcbnZhciBTVE9QID0gMTtcclxudmFyIEZPUkNFRF9TVE9QID0gMjtcclxuXHJcbi8qKlxyXG4gKiBNYW5hZ2VyXHJcbiAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsZW1lbnRcclxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxyXG4gKiBAY29uc3RydWN0b3JcclxuICovXHJcbmZ1bmN0aW9uIE1hbmFnZXIoZWxlbWVudCwgb3B0aW9ucykge1xyXG4gICAgdGhpcy5vcHRpb25zID0gYXNzaWduKHt9LCBOR0hhbW1lci5kZWZhdWx0cywgb3B0aW9ucyB8fCB7fSk7XHJcblxyXG4gICAgdGhpcy5vcHRpb25zLmlucHV0VGFyZ2V0ID0gdGhpcy5vcHRpb25zLmlucHV0VGFyZ2V0IHx8IGVsZW1lbnQ7XHJcblxyXG4gICAgdGhpcy5oYW5kbGVycyA9IHt9O1xyXG4gICAgdGhpcy5zZXNzaW9uID0ge307XHJcbiAgICB0aGlzLnJlY29nbml6ZXJzID0gW107XHJcbiAgICB0aGlzLm9sZENzc1Byb3BzID0ge307XHJcblxyXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgIHRoaXMuaW5wdXQgPSBjcmVhdGVJbnB1dEluc3RhbmNlKHRoaXMpO1xyXG4gICAgdGhpcy50b3VjaEFjdGlvbiA9IG5ldyBUb3VjaEFjdGlvbih0aGlzLCB0aGlzLm9wdGlvbnMudG91Y2hBY3Rpb24pO1xyXG5cclxuICAgIHRvZ2dsZUNzc1Byb3BzKHRoaXMsIHRydWUpO1xyXG5cclxuICAgIGVhY2godGhpcy5vcHRpb25zLnJlY29nbml6ZXJzLCBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgdmFyIHJlY29nbml6ZXIgPSB0aGlzLmFkZChuZXcgKGl0ZW1bMF0pKGl0ZW1bMV0pKTtcclxuICAgICAgICBpdGVtWzJdICYmIHJlY29nbml6ZXIucmVjb2duaXplV2l0aChpdGVtWzJdKTtcclxuICAgICAgICBpdGVtWzNdICYmIHJlY29nbml6ZXIucmVxdWlyZUZhaWx1cmUoaXRlbVszXSk7XHJcbiAgICB9LCB0aGlzKTtcclxufVxyXG5cclxuTWFuYWdlci5wcm90b3R5cGUgPSB7XHJcbiAgICAvKipcclxuICAgICAqIHNldCBvcHRpb25zXHJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9uc1xyXG4gICAgICogQHJldHVybnMge01hbmFnZXJ9XHJcbiAgICAgKi9cclxuICAgIHNldDogZnVuY3Rpb24ob3B0aW9ucykge1xyXG4gICAgICAgIGFzc2lnbih0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICAvLyBPcHRpb25zIHRoYXQgbmVlZCBhIGxpdHRsZSBtb3JlIHNldHVwXHJcbiAgICAgICAgaWYgKG9wdGlvbnMudG91Y2hBY3Rpb24pIHtcclxuICAgICAgICAgICAgdGhpcy50b3VjaEFjdGlvbi51cGRhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG9wdGlvbnMuaW5wdXRUYXJnZXQpIHtcclxuICAgICAgICAgICAgLy8gQ2xlYW4gdXAgZXhpc3RpbmcgZXZlbnQgbGlzdGVuZXJzIGFuZCByZWluaXRpYWxpemVcclxuICAgICAgICAgICAgdGhpcy5pbnB1dC5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgIHRoaXMuaW5wdXQudGFyZ2V0ID0gb3B0aW9ucy5pbnB1dFRhcmdldDtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dC5pbml0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIHN0b3AgcmVjb2duaXppbmcgZm9yIHRoaXMgc2Vzc2lvbi5cclxuICAgICAqIFRoaXMgc2Vzc2lvbiB3aWxsIGJlIGRpc2NhcmRlZCwgd2hlbiBhIG5ldyBbaW5wdXRdc3RhcnQgZXZlbnQgaXMgZmlyZWQuXHJcbiAgICAgKiBXaGVuIGZvcmNlZCwgdGhlIHJlY29nbml6ZXIgY3ljbGUgaXMgc3RvcHBlZCBpbW1lZGlhdGVseS5cclxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gW2ZvcmNlXVxyXG4gICAgICovXHJcbiAgICBzdG9wOiBmdW5jdGlvbihmb3JjZSkge1xyXG4gICAgICAgIHRoaXMuc2Vzc2lvbi5zdG9wcGVkID0gZm9yY2UgPyBGT1JDRURfU1RPUCA6IFNUT1A7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogcnVuIHRoZSByZWNvZ25pemVycyFcclxuICAgICAqIGNhbGxlZCBieSB0aGUgaW5wdXRIYW5kbGVyIGZ1bmN0aW9uIG9uIGV2ZXJ5IG1vdmVtZW50IG9mIHRoZSBwb2ludGVycyAodG91Y2hlcylcclxuICAgICAqIGl0IHdhbGtzIHRocm91Z2ggYWxsIHRoZSByZWNvZ25pemVycyBhbmQgdHJpZXMgdG8gZGV0ZWN0IHRoZSBnZXN0dXJlIHRoYXQgaXMgYmVpbmcgbWFkZVxyXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGlucHV0RGF0YVxyXG4gICAgICovXHJcbiAgICByZWNvZ25pemU6IGZ1bmN0aW9uKGlucHV0RGF0YSkge1xyXG4gICAgICAgIHZhciBzZXNzaW9uID0gdGhpcy5zZXNzaW9uO1xyXG4gICAgICAgIGlmIChzZXNzaW9uLnN0b3BwZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gcnVuIHRoZSB0b3VjaC1hY3Rpb24gcG9seWZpbGxcclxuICAgICAgICB0aGlzLnRvdWNoQWN0aW9uLnByZXZlbnREZWZhdWx0cyhpbnB1dERhdGEpO1xyXG5cclxuICAgICAgICB2YXIgcmVjb2duaXplcjtcclxuICAgICAgICB2YXIgcmVjb2duaXplcnMgPSB0aGlzLnJlY29nbml6ZXJzO1xyXG5cclxuICAgICAgICAvLyB0aGlzIGhvbGRzIHRoZSByZWNvZ25pemVyIHRoYXQgaXMgYmVpbmcgcmVjb2duaXplZC5cclxuICAgICAgICAvLyBzbyB0aGUgcmVjb2duaXplcidzIHN0YXRlIG5lZWRzIHRvIGJlIEJFR0FOLCBDSEFOR0VELCBFTkRFRCBvciBSRUNPR05JWkVEXHJcbiAgICAgICAgLy8gaWYgbm8gcmVjb2duaXplciBpcyBkZXRlY3RpbmcgYSB0aGluZywgaXQgaXMgc2V0IHRvIGBudWxsYFxyXG4gICAgICAgIHZhciBjdXJSZWNvZ25pemVyID0gc2Vzc2lvbi5jdXJSZWNvZ25pemVyO1xyXG5cclxuICAgICAgICAvLyByZXNldCB3aGVuIHRoZSBsYXN0IHJlY29nbml6ZXIgaXMgcmVjb2duaXplZFxyXG4gICAgICAgIC8vIG9yIHdoZW4gd2UncmUgaW4gYSBuZXcgc2Vzc2lvblxyXG4gICAgICAgIGlmICghY3VyUmVjb2duaXplciB8fCAoY3VyUmVjb2duaXplciAmJiBjdXJSZWNvZ25pemVyLnN0YXRlICYgU1RBVEVfUkVDT0dOSVpFRCkpIHtcclxuICAgICAgICAgICAgY3VyUmVjb2duaXplciA9IHNlc3Npb24uY3VyUmVjb2duaXplciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgd2hpbGUgKGkgPCByZWNvZ25pemVycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcmVjb2duaXplciA9IHJlY29nbml6ZXJzW2ldO1xyXG5cclxuICAgICAgICAgICAgLy8gZmluZCBvdXQgaWYgd2UgYXJlIGFsbG93ZWQgdHJ5IHRvIHJlY29nbml6ZSB0aGUgaW5wdXQgZm9yIHRoaXMgb25lLlxyXG4gICAgICAgICAgICAvLyAxLiAgIGFsbG93IGlmIHRoZSBzZXNzaW9uIGlzIE5PVCBmb3JjZWQgc3RvcHBlZCAoc2VlIHRoZSAuc3RvcCgpIG1ldGhvZClcclxuICAgICAgICAgICAgLy8gMi4gICBhbGxvdyBpZiB3ZSBzdGlsbCBoYXZlbid0IHJlY29nbml6ZWQgYSBnZXN0dXJlIGluIHRoaXMgc2Vzc2lvbiwgb3IgdGhlIHRoaXMgcmVjb2duaXplciBpcyB0aGUgb25lXHJcbiAgICAgICAgICAgIC8vICAgICAgdGhhdCBpcyBiZWluZyByZWNvZ25pemVkLlxyXG4gICAgICAgICAgICAvLyAzLiAgIGFsbG93IGlmIHRoZSByZWNvZ25pemVyIGlzIGFsbG93ZWQgdG8gcnVuIHNpbXVsdGFuZW91cyB3aXRoIHRoZSBjdXJyZW50IHJlY29nbml6ZWQgcmVjb2duaXplci5cclxuICAgICAgICAgICAgLy8gICAgICB0aGlzIGNhbiBiZSBzZXR1cCB3aXRoIHRoZSBgcmVjb2duaXplV2l0aCgpYCBtZXRob2Qgb24gdGhlIHJlY29nbml6ZXIuXHJcbiAgICAgICAgICAgIGlmIChzZXNzaW9uLnN0b3BwZWQgIT09IEZPUkNFRF9TVE9QICYmICggLy8gMVxyXG4gICAgICAgICAgICAgICAgICAgICFjdXJSZWNvZ25pemVyIHx8IHJlY29nbml6ZXIgPT0gY3VyUmVjb2duaXplciB8fCAvLyAyXHJcbiAgICAgICAgICAgICAgICAgICAgcmVjb2duaXplci5jYW5SZWNvZ25pemVXaXRoKGN1clJlY29nbml6ZXIpKSkgeyAvLyAzXHJcbiAgICAgICAgICAgICAgICByZWNvZ25pemVyLnJlY29nbml6ZShpbnB1dERhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVjb2duaXplci5yZXNldCgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBpZiB0aGUgcmVjb2duaXplciBoYXMgYmVlbiByZWNvZ25pemluZyB0aGUgaW5wdXQgYXMgYSB2YWxpZCBnZXN0dXJlLCB3ZSB3YW50IHRvIHN0b3JlIHRoaXMgb25lIGFzIHRoZVxyXG4gICAgICAgICAgICAvLyBjdXJyZW50IGFjdGl2ZSByZWNvZ25pemVyLiBidXQgb25seSBpZiB3ZSBkb24ndCBhbHJlYWR5IGhhdmUgYW4gYWN0aXZlIHJlY29nbml6ZXJcclxuICAgICAgICAgICAgaWYgKCFjdXJSZWNvZ25pemVyICYmIHJlY29nbml6ZXIuc3RhdGUgJiAoU1RBVEVfQkVHQU4gfCBTVEFURV9DSEFOR0VEIHwgU1RBVEVfRU5ERUQpKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJSZWNvZ25pemVyID0gc2Vzc2lvbi5jdXJSZWNvZ25pemVyID0gcmVjb2duaXplcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpKys7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIGdldCBhIHJlY29nbml6ZXIgYnkgaXRzIGV2ZW50IG5hbWUuXHJcbiAgICAgKiBAcGFyYW0ge1JlY29nbml6ZXJ8U3RyaW5nfSByZWNvZ25pemVyXHJcbiAgICAgKiBAcmV0dXJucyB7UmVjb2duaXplcnxOdWxsfVxyXG4gICAgICovXHJcbiAgICBnZXQ6IGZ1bmN0aW9uKHJlY29nbml6ZXIpIHtcclxuICAgICAgICBpZiAocmVjb2duaXplciBpbnN0YW5jZW9mIFJlY29nbml6ZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlY29nbml6ZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgcmVjb2duaXplcnMgPSB0aGlzLnJlY29nbml6ZXJzO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVjb2duaXplcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHJlY29nbml6ZXJzW2ldLm9wdGlvbnMuZXZlbnQgPT0gcmVjb2duaXplcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29nbml6ZXJzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIGFkZCBhIHJlY29nbml6ZXIgdG8gdGhlIG1hbmFnZXJcclxuICAgICAqIGV4aXN0aW5nIHJlY29nbml6ZXJzIHdpdGggdGhlIHNhbWUgZXZlbnQgbmFtZSB3aWxsIGJlIHJlbW92ZWRcclxuICAgICAqIEBwYXJhbSB7UmVjb2duaXplcn0gcmVjb2duaXplclxyXG4gICAgICogQHJldHVybnMge1JlY29nbml6ZXJ8TWFuYWdlcn1cclxuICAgICAqL1xyXG4gICAgYWRkOiBmdW5jdGlvbihyZWNvZ25pemVyKSB7XHJcbiAgICAgICAgaWYgKGludm9rZUFycmF5QXJnKHJlY29nbml6ZXIsICdhZGQnLCB0aGlzKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIHJlbW92ZSBleGlzdGluZ1xyXG4gICAgICAgIHZhciBleGlzdGluZyA9IHRoaXMuZ2V0KHJlY29nbml6ZXIub3B0aW9ucy5ldmVudCk7XHJcbiAgICAgICAgaWYgKGV4aXN0aW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKGV4aXN0aW5nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMucmVjb2duaXplcnMucHVzaChyZWNvZ25pemVyKTtcclxuICAgICAgICByZWNvZ25pemVyLm1hbmFnZXIgPSB0aGlzO1xyXG5cclxuICAgICAgICB0aGlzLnRvdWNoQWN0aW9uLnVwZGF0ZSgpO1xyXG4gICAgICAgIHJldHVybiByZWNvZ25pemVyO1xyXG4gICAgfSxcclxuXHJcbiAgICAvKipcclxuICAgICAqIHJlbW92ZSBhIHJlY29nbml6ZXIgYnkgbmFtZSBvciBpbnN0YW5jZVxyXG4gICAgICogQHBhcmFtIHtSZWNvZ25pemVyfFN0cmluZ30gcmVjb2duaXplclxyXG4gICAgICogQHJldHVybnMge01hbmFnZXJ9XHJcbiAgICAgKi9cclxuICAgIHJlbW92ZTogZnVuY3Rpb24ocmVjb2duaXplcikge1xyXG4gICAgICAgIGlmIChpbnZva2VBcnJheUFyZyhyZWNvZ25pemVyLCAncmVtb3ZlJywgdGhpcykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZWNvZ25pemVyID0gdGhpcy5nZXQocmVjb2duaXplcik7XHJcblxyXG4gICAgICAgIC8vIGxldCdzIG1ha2Ugc3VyZSB0aGlzIHJlY29nbml6ZXIgZXhpc3RzXHJcbiAgICAgICAgaWYgKHJlY29nbml6ZXIpIHtcclxuICAgICAgICAgICAgdmFyIHJlY29nbml6ZXJzID0gdGhpcy5yZWNvZ25pemVycztcclxuICAgICAgICAgICAgdmFyIGluZGV4ID0gaW5BcnJheShyZWNvZ25pemVycywgcmVjb2duaXplcik7XHJcblxyXG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICByZWNvZ25pemVycy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50b3VjaEFjdGlvbi51cGRhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogYmluZCBldmVudFxyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50c1xyXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlclxyXG4gICAgICogQHJldHVybnMge0V2ZW50RW1pdHRlcn0gdGhpc1xyXG4gICAgICovXHJcbiAgICBvbjogZnVuY3Rpb24oZXZlbnRzLCBoYW5kbGVyKSB7XHJcbiAgICAgICAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGhhbmRsZXIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzO1xyXG4gICAgICAgIGVhY2goc3BsaXRTdHIoZXZlbnRzKSwgZnVuY3Rpb24oZXZlbnQpIHtcclxuICAgICAgICAgICAgaGFuZGxlcnNbZXZlbnRdID0gaGFuZGxlcnNbZXZlbnRdIHx8IFtdO1xyXG4gICAgICAgICAgICBoYW5kbGVyc1tldmVudF0ucHVzaChoYW5kbGVyKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH0sXHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiB1bmJpbmQgZXZlbnQsIGxlYXZlIGVtaXQgYmxhbmsgdG8gcmVtb3ZlIGFsbCBoYW5kbGVyc1xyXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50c1xyXG4gICAgICogQHBhcmFtIHtGdW5jdGlvbn0gW2hhbmRsZXJdXHJcbiAgICAgKiBAcmV0dXJucyB7RXZlbnRFbWl0dGVyfSB0aGlzXHJcbiAgICAgKi9cclxuICAgIG9mZjogZnVuY3Rpb24oZXZlbnRzLCBoYW5kbGVyKSB7XHJcbiAgICAgICAgaWYgKGV2ZW50cyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHZhciBoYW5kbGVycyA9IHRoaXMuaGFuZGxlcnM7XHJcbiAgICAgICAgZWFjaChzcGxpdFN0cihldmVudHMpLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICAgICBpZiAoIWhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBoYW5kbGVyc1tldmVudF07XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVyc1tldmVudF0gJiYgaGFuZGxlcnNbZXZlbnRdLnNwbGljZShpbkFycmF5KGhhbmRsZXJzW2V2ZW50XSwgaGFuZGxlciksIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogZW1pdCBldmVudCB0byB0aGUgbGlzdGVuZXJzXHJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZXZlbnRcclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhXHJcbiAgICAgKi9cclxuICAgIGVtaXQ6IGZ1bmN0aW9uKGV2ZW50LCBkYXRhKSB7XHJcbiAgICAgICAgLy8gd2UgYWxzbyB3YW50IHRvIHRyaWdnZXIgZG9tIGV2ZW50c1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZG9tRXZlbnRzKSB7XHJcbiAgICAgICAgICAgIHRyaWdnZXJEb21FdmVudChldmVudCwgZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBubyBoYW5kbGVycywgc28gc2tpcCBpdCBhbGxcclxuICAgICAgICB2YXIgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzW2V2ZW50XSAmJiB0aGlzLmhhbmRsZXJzW2V2ZW50XS5zbGljZSgpO1xyXG4gICAgICAgIGlmICghaGFuZGxlcnMgfHwgIWhhbmRsZXJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBkYXRhLnR5cGUgPSBldmVudDtcclxuICAgICAgICBkYXRhLnByZXZlbnREZWZhdWx0ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGRhdGEuc3JjRXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgaSA9IDA7XHJcbiAgICAgICAgd2hpbGUgKGkgPCBoYW5kbGVycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgaGFuZGxlcnNbaV0oZGF0YSk7XHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIC8qKlxyXG4gICAgICogZGVzdHJveSB0aGUgbWFuYWdlciBhbmQgdW5iaW5kcyBhbGwgZXZlbnRzXHJcbiAgICAgKiBpdCBkb2Vzbid0IHVuYmluZCBkb20gZXZlbnRzLCB0aGF0IGlzIHRoZSB1c2VyIG93biByZXNwb25zaWJpbGl0eVxyXG4gICAgICovXHJcbiAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgJiYgdG9nZ2xlQ3NzUHJvcHModGhpcywgZmFsc2UpO1xyXG5cclxuICAgICAgICB0aGlzLmhhbmRsZXJzID0ge307XHJcbiAgICAgICAgdGhpcy5zZXNzaW9uID0ge307XHJcbiAgICAgICAgdGhpcy5pbnB1dC5kZXN0cm95KCk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gbnVsbDtcclxuICAgIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBhZGQvcmVtb3ZlIHRoZSBjc3MgcHJvcGVydGllcyBhcyBkZWZpbmVkIGluIG1hbmFnZXIub3B0aW9ucy5jc3NQcm9wc1xyXG4gKiBAcGFyYW0ge01hbmFnZXJ9IG1hbmFnZXJcclxuICogQHBhcmFtIHtCb29sZWFufSBhZGRcclxuICovXHJcbmZ1bmN0aW9uIHRvZ2dsZUNzc1Byb3BzKG1hbmFnZXIsIGFkZCkge1xyXG4gICAgdmFyIGVsZW1lbnQgPSBtYW5hZ2VyLmVsZW1lbnQ7XHJcbiAgICBpZiAoIWVsZW1lbnQuc3R5bGUpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgcHJvcDtcclxuICAgIGVhY2gobWFuYWdlci5vcHRpb25zLmNzc1Byb3BzLCBmdW5jdGlvbih2YWx1ZSwgbmFtZSkge1xyXG4gICAgICAgIHByb3AgPSBwcmVmaXhlZChlbGVtZW50LnN0eWxlLCBuYW1lKTtcclxuICAgICAgICBpZiAoYWRkKSB7XHJcbiAgICAgICAgICAgIG1hbmFnZXIub2xkQ3NzUHJvcHNbcHJvcF0gPSBlbGVtZW50LnN0eWxlW3Byb3BdO1xyXG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlW3Byb3BdID0gdmFsdWU7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZWxlbWVudC5zdHlsZVtwcm9wXSA9IG1hbmFnZXIub2xkQ3NzUHJvcHNbcHJvcF0gfHwgJyc7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBpZiAoIWFkZCkge1xyXG4gICAgICAgIG1hbmFnZXIub2xkQ3NzUHJvcHMgPSB7fTtcclxuICAgIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIHRyaWdnZXIgZG9tIGV2ZW50XHJcbiAqIEBwYXJhbSB7U3RyaW5nfSBldmVudFxyXG4gKiBAcGFyYW0ge09iamVjdH0gZGF0YVxyXG4gKi9cclxuZnVuY3Rpb24gdHJpZ2dlckRvbUV2ZW50KGV2ZW50LCBkYXRhKSB7XHJcbiAgICB2YXIgZ2VzdHVyZUV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0V2ZW50Jyk7XHJcbiAgICBnZXN0dXJlRXZlbnQuaW5pdEV2ZW50KGV2ZW50LCB0cnVlLCB0cnVlKTtcclxuICAgIGdlc3R1cmVFdmVudC5nZXN0dXJlID0gZGF0YTtcclxuICAgIGRhdGEudGFyZ2V0LmRpc3BhdGNoRXZlbnQoZ2VzdHVyZUV2ZW50KTtcclxufVxyXG5cclxuYXNzaWduKE5HSGFtbWVyLCB7XHJcbiAgICBJTlBVVF9TVEFSVDogSU5QVVRfU1RBUlQsXHJcbiAgICBJTlBVVF9NT1ZFOiBJTlBVVF9NT1ZFLFxyXG4gICAgSU5QVVRfRU5EOiBJTlBVVF9FTkQsXHJcbiAgICBJTlBVVF9DQU5DRUw6IElOUFVUX0NBTkNFTCxcclxuXHJcbiAgICBTVEFURV9QT1NTSUJMRTogU1RBVEVfUE9TU0lCTEUsXHJcbiAgICBTVEFURV9CRUdBTjogU1RBVEVfQkVHQU4sXHJcbiAgICBTVEFURV9DSEFOR0VEOiBTVEFURV9DSEFOR0VELFxyXG4gICAgU1RBVEVfRU5ERUQ6IFNUQVRFX0VOREVELFxyXG4gICAgU1RBVEVfUkVDT0dOSVpFRDogU1RBVEVfUkVDT0dOSVpFRCxcclxuICAgIFNUQVRFX0NBTkNFTExFRDogU1RBVEVfQ0FOQ0VMTEVELFxyXG4gICAgU1RBVEVfRkFJTEVEOiBTVEFURV9GQUlMRUQsXHJcblxyXG4gICAgRElSRUNUSU9OX05PTkU6IERJUkVDVElPTl9OT05FLFxyXG4gICAgRElSRUNUSU9OX0xFRlQ6IERJUkVDVElPTl9MRUZULFxyXG4gICAgRElSRUNUSU9OX1JJR0hUOiBESVJFQ1RJT05fUklHSFQsXHJcbiAgICBESVJFQ1RJT05fVVA6IERJUkVDVElPTl9VUCxcclxuICAgIERJUkVDVElPTl9ET1dOOiBESVJFQ1RJT05fRE9XTixcclxuICAgIERJUkVDVElPTl9IT1JJWk9OVEFMOiBESVJFQ1RJT05fSE9SSVpPTlRBTCxcclxuICAgIERJUkVDVElPTl9WRVJUSUNBTDogRElSRUNUSU9OX1ZFUlRJQ0FMLFxyXG4gICAgRElSRUNUSU9OX0FMTDogRElSRUNUSU9OX0FMTCxcclxuXHJcbiAgICBNYW5hZ2VyOiBNYW5hZ2VyLFxyXG4gICAgSW5wdXQ6IElucHV0LFxyXG4gICAgVG91Y2hBY3Rpb246IFRvdWNoQWN0aW9uLFxyXG5cclxuICAgIFRvdWNoSW5wdXQ6IFRvdWNoSW5wdXQsXHJcbiAgICBNb3VzZUlucHV0OiBNb3VzZUlucHV0LFxyXG4gICAgUG9pbnRlckV2ZW50SW5wdXQ6IFBvaW50ZXJFdmVudElucHV0LFxyXG4gICAgVG91Y2hNb3VzZUlucHV0OiBUb3VjaE1vdXNlSW5wdXQsXHJcbiAgICBTaW5nbGVUb3VjaElucHV0OiBTaW5nbGVUb3VjaElucHV0LFxyXG5cclxuICAgIFJlY29nbml6ZXI6IFJlY29nbml6ZXIsXHJcbiAgICBBdHRyUmVjb2duaXplcjogQXR0clJlY29nbml6ZXIsXHJcbiAgICBUYXA6IFRhcFJlY29nbml6ZXIsXHJcbiAgICBQYW46IFBhblJlY29nbml6ZXIsXHJcbiAgICBTd2lwZTogU3dpcGVSZWNvZ25pemVyLFxyXG4gICAgUGluY2g6IFBpbmNoUmVjb2duaXplcixcclxuICAgIFJvdGF0ZTogUm90YXRlUmVjb2duaXplcixcclxuICAgIFByZXNzOiBQcmVzc1JlY29nbml6ZXIsXHJcblxyXG4gICAgb246IGFkZEV2ZW50TGlzdGVuZXJzLFxyXG4gICAgb2ZmOiByZW1vdmVFdmVudExpc3RlbmVycyxcclxuICAgIGVhY2g6IGVhY2gsXHJcbiAgICBtZXJnZTogbWVyZ2UsXHJcbiAgICBleHRlbmQ6IGV4dGVuZCxcclxuICAgIGFzc2lnbjogYXNzaWduLFxyXG4gICAgaW5oZXJpdDogaW5oZXJpdCxcclxuICAgIGJpbmRGbjogYmluZEZuLFxyXG4gICAgcHJlZml4ZWQ6IHByZWZpeGVkXHJcbn0pO1xyXG5cclxuLy8gdGhpcyBwcmV2ZW50cyBlcnJvcnMgd2hlbiBOR0hhbW1lciBpcyBsb2FkZWQgaW4gdGhlIHByZXNlbmNlIG9mIGFuIEFNRFxyXG4vLyAgc3R5bGUgbG9hZGVyIGJ1dCBieSBzY3JpcHQgdGFnLCBub3QgYnkgdGhlIGxvYWRlci5cclxudmFyIGZyZWVHbG9iYWwgPSAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9KSk7IC8vIGpzaGludCBpZ25vcmU6bGluZVxyXG5mcmVlR2xvYmFsLk5HSGFtbWVyID0gTkdIYW1tZXI7XHJcblxyXG5pZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kRElTQUJMRUQpIHtcclxuICAgIGRlZmluZShmdW5jdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gTkdIYW1tZXI7XHJcbiAgICB9KTtcclxufSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XHJcbiAgICBtb2R1bGUuZXhwb3J0cyA9IE5HSGFtbWVyO1xyXG59IGVsc2Uge1xyXG4gICAgd2luZG93W2V4cG9ydE5hbWVdID0gTkdIYW1tZXI7XHJcbn1cclxuXHJcbn0pKHdpbmRvdywgZG9jdW1lbnQsICdOR0hhbW1lcicpO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4vLyBFTkQgTkFOT0dBTExFUlkyXHJcbi8vIH0oIGpRdWVyeSApKSk7XHJcbn0pKTtcclxuXHJcblxyXG4vLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuLy8jIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjI1xyXG4vLyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXHJcbi8vIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcclxuXHJcbi8vIG5hbm9nYWxsZXJ5MiBhdXRvIHN0YXJ0IHdoaXRob3V0IGphdmFzY3JpcHQgY2FsbFxyXG4oZnVuY3Rpb24oKXtcclxuICAndXNlIHN0cmljdCc7XHJcbiAgalF1ZXJ5KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcbiAgXHJcbiAgICAvLyB2YXIgdD1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1uYW5vZ2FsbGVyeTItcG9ydGFibGVdJyk7XHJcbiAgICAvLyBpZiggdC5sZW5ndGggPiAwICkge1xyXG4gICAgICAvLyBwb3J0YWJsZSBtb2RlXHJcbiAgICAgIC8vIHZhciBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGluaycpO1xyXG4gICAgICAvLyBsaW5rLnNldEF0dHJpYnV0ZShcInJlbFwiLCBcInN0eWxlc2hlZXRcIik7XHJcbiAgICAgIC8vIGxpbmsuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRleHQvY3NzXCIpO1xyXG4gICAgICAvLyBsaW5rLm9ubG9hZCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgLy8gZm9yKCB2YXIgaT0wOyBpIDwgdC5sZW5ndGg7IGkrKyApIHtcclxuICAgICAgICAgIC8vIGpRdWVyeSh0W2ldKS5uYW5vZ2FsbGVyeTIoalF1ZXJ5KHRbaV0pLmRhdGEoJ25hbm9nYWxsZXJ5Mi1wb3J0YWJsZScpKTtcclxuICAgICAgICAvLyB9XHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gbGluay5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsICcvL25hbm8uZ2FsbGVyeS9jc3MvbmFub2dhbGxlcnkyLmNzcycpO1xyXG4gICAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF0uYXBwZW5kQ2hpbGQobGluayk7XHJcbiAgICAvLyB9XHJcbiAgICAvLyBlbHNlIHtcclxuICAgICAgLy8gc3RhbmRhcmQgbW9kZVxyXG4gICAgICB2YXIgdD1kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS1uYW5vZ2FsbGVyeTJdJyk7XHJcbiAgICAgIGZvciggdmFyIGk9MDsgaSA8IHQubGVuZ3RoOyBpKysgKSB7XHJcbiAgICAgICAgalF1ZXJ5KCB0W2ldICkubmFub2dhbGxlcnkyKCBqUXVlcnkodFtpXSkuZGF0YSgnbmFub2dhbGxlcnkyJykgKTtcclxuICAgICAgfVxyXG4gICAgLy8gfVxyXG4gICAgXHJcbiAgfSk7XHJcbn0pLmNhbGwobnVsbCk7XHJcblxyXG5cbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./node_modules/nanogallery2/src/jquery.nanogallery2.core.js\n");

/***/ }),

/***/ "./course-v2/assets/nanogallery2-imports.js":
/*!**************************************************!*\
  !*** ./course-v2/assets/nanogallery2-imports.js ***!
  \**************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var nanogallery2_src_jquery_nanogallery2_core_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! nanogallery2/src/jquery.nanogallery2.core.js */ \"./node_modules/nanogallery2/src/jquery.nanogallery2.core.js\");\n/* harmony import */ var nanogallery2_src_jquery_nanogallery2_core_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(nanogallery2_src_jquery_nanogallery2_core_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_nanogallery2_src_css_nanogallery2_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/nanogallery2/src/css/nanogallery2.css */ \"./node_modules/nanogallery2/src/css/nanogallery2.css\");\n/*** IMPORTS FROM imports-loader ***/\nvar module = (module || {});\nmodule.exports = undefined;\nvar exports = undefined;\n\n\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9jb3Vyc2UtdjIvYXNzZXRzL25hbm9nYWxsZXJ5Mi1pbXBvcnRzLmpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFxRDtBQUNZIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2N3LWh1Z28tdGhlbWVzLy4vY291cnNlLXYyL2Fzc2V0cy9uYW5vZ2FsbGVyeTItaW1wb3J0cy5qcz9mZGUxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcIm5hbm9nYWxsZXJ5Mi9zcmMvanF1ZXJ5Lm5hbm9nYWxsZXJ5Mi5jb3JlLmpzXCJcbmltcG9ydCBcIi4uLy4uL25vZGVfbW9kdWxlcy9uYW5vZ2FsbGVyeTIvc3JjL2Nzcy9uYW5vZ2FsbGVyeTIuY3NzXCJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./course-v2/assets/nanogallery2-imports.js\n");

/***/ })

}]);